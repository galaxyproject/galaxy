<tool id="export_remote" name="å¯¼å‡ºæ•°æ®é›†" version="0.1.0" profile="21.05">
    <description>åˆ°è¿œç¨‹æ–‡ä»¶æº</description>
    <!-- TODO
    <requirements>
        <requirement type="package" version="21.05">galaxy-files</requirement>
    </requirements>
    -->
    <command><![CDATA[
python '$__tool_directory__/export_remote.py'
    --file-sources '$file_sources'
    --directory-uri '$d_uri'
    --files-to-export '$files_to_export'
    #if $include_metadata_files:
        --export-metadata-files $include_metadata_files
    #end if
    > '$out'
    ]]></command>
    <configfiles>
        <file_sources name="file_sources"/>
        <configfile name="files_to_export">#import json
#from galaxy.util import filesystem_safe_string
#if $export_type.export_type_selector == "datasets_auto":
#set $fileconfig = json.dumps($export_type.infiles.serialize(invalid_chars=tuple(str($invalid_chars))))
#else if $export_type.export_type_selector == "collection_auto":
#set $fileconfig = json.dumps($export_type.incollection.serialize(invalid_chars=tuple(str($invalid_chars)), include_collection_name=bool($export_type.include_collection_name)))
#else
#set $fileconfig = [d['infile'].serialize() for d in $export_type.datasets]
#for $i, $dataset in enumerate($export_type.datasets):
    #silent $fileconfig[$i]['staging_path'] = filesystem_safe_string(str(dataset["name"]), 255, invalid_chars=())
#end for
#silent fileconfig = json.dumps($fileconfig)
#end if
$fileconfig
        </configfile>
    </configfiles>
    <inputs>
        <conditional name="export_type">
            <param name="export_type_selector" type="select" label="æ‚¨æƒ³å¯¼å‡ºä»€ä¹ˆå†…å®¹ï¼Ÿ">
                <option value="datasets_auto" selected="true">ä½¿ç”¨Galaxyåç§°å’Œæ‰©å±•åå¯¼å‡ºæ•°æ®é›†</option>
                <option value="collection_auto">ä½¿ç”¨åç§°ã€ç»“æ„å’Œæ‰©å±•åå¯¼å‡ºæ•°æ®é›†é›†åˆ</option>
                <option value="datasets_named">æŒ‡å®šåç§°å¯¼å‡ºæ•°æ®é›†</option>
                <!-- Allow more options - e.g. HTML, collections preserving their structure... -->
            </param>
            <when value="datasets_auto">
                <param name="infiles" type="data" format="data" multiple="true" label="é€‰æ‹©æ‚¨çš„æ•°æ®é›†" help="æ•°æ®é›†å¿…é¡»å…·æœ‰å”¯ä¸€åç§°"/>
            </when>
            <when value="collection_auto">
                <param name="incollection" type="data_collection" format="data" label="é€‰æ‹©æ‚¨çš„æ•°æ®é›†é›†åˆ" help="æ•°æ®é›†é›†åˆå°†è¢«å¯¼å‡ºã€‚é›†åˆå°†å˜æˆæ–‡ä»¶å¤¹ï¼Œæ•°æ®é›†å°†å˜æˆæ–‡ä»¶"/>
                <param name="include_collection_name" type="boolean" label="å°†é›†åˆåç§°åŒ…å«ä¸ºé¡¶çº§ç›®å½•ï¼Ÿ"/>
            </when>
            <when value="datasets_named">
                <repeat name="datasets" title="æ•°æ®é›†">
                    <param type="data" format="data" name="infile" label="è¾“å…¥æ•°æ®é›†"/>
                    <param type="text" name="name" label="è¾“å…¥æ–‡ä»¶å" help="è¦åœ¨åä¸º"dir1"çš„ç›®å½•ä¸­åˆ›å»ºåä¸º"f1.txt"çš„æ–‡ä»¶ï¼Œè¯·è¾“å…¥"dir1/f1.txt"">
                        <!-- ğŸ”¥ turn off sanitizer, so unicode strings can be used. Is sanitized in configfile -->
                        <sanitizer sanitize="false"/>
                        <validator type="length" min="1" max="255"/>
                    </param>
                </repeat>
            </when>
        </conditional>
        <param type="directory_uri" name="d_uri" label="ç›®å½•URI"/>
        <param name="include_metadata_files" type="boolean" checked="true" label="åœ¨å¯¼å‡ºä¸­åŒ…å«å…ƒæ•°æ®æ–‡ä»¶ï¼Ÿ" help="å…ƒæ•°æ®æ–‡ä»¶çš„ä¾‹å­åŒ…æ‹¬å¯ä»¥ä»åŸå§‹æ•°æ®é‡æ–°ç”Ÿæˆçš„bamã€cramå’Œvcfç´¢å¼•"/>
        <param name="invalid_chars" type="select" label="é€‰æ‹©åº”ä»å¯¼å‡ºè·¯å¾„ä¸­åˆ é™¤çš„å­—ç¬¦">
            <option value="/">å‡€åŒ– /</option>
            <option value="">ä¸å‡€åŒ–å€¼</option>
        </param>
    </inputs>
    <outputs>
        <data name="out" format="txt" label="å¯¼å‡ºæ—¥å¿—"/>
    </outputs>
    <tests>
    </tests>
</tool>
