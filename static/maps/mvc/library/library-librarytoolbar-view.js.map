{"version":3,"sources":["mvc/library/library-librarytoolbar-view.js"],"names":["define","mod_toastr","mod_library_model","LibraryToolbarView","Backbone","View","extend","el","search_term","events","click #create_new_library_btn","click #exclude_restricted_chk","click .page_size_prompt","keyup .library-search-input","initialize","options","this","_","defaults","render","toolbar_template","templateToolBar","is_admin","is_anonym","user","isAdmin","Galaxy","isAnonymous","anon_user","html","find","admin_user","get","checked","libraries","preferences","renderPaginator","paginator_template","templatePaginator","$el","show_page","page_count","parseInt","total_libraries_count","libraries_shown","library_page_size","event","stopPropagation","self","modal","show","closing_events","title","body","templateNewLibraryInModal","buttons","Create","Close","createNewLibrary","hide","validateNewLibrary","libraryDetails","library","success","Library","clearLibraryModal","collection","add","libraryListView","error","model","response","responseJSON","err_msg","showPageSizePrompt","prompt","e","preventDefault","set","$","val","serializeNewLibrary","name","description","synopsis","with_deleted","fetchDeleted","excludeRestrictedChecked","without_restricted","searchLibraries","template","join"],"mappings":"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","file":"../../../scripts/mvc/library/library-librarytoolbar-view.js","sourcesContent":["define([\"libs/toastr\", \"mvc/library/library-model\"], function(mod_toastr, mod_library_model) {\n    /**\n * This view represents the top part of the library page.\n * It contains the tool bar with controls.\n */\n    var LibraryToolbarView = Backbone.View.extend({\n        el: \"#center\",\n\n        defaults: {\n            search_term: \"\"\n        },\n\n        events: {\n            \"click #create_new_library_btn\": \"createLibraryFromModal\",\n            \"click #include_deleted_chk\": \"includeDeletedChecked\",\n            \"click #exclude_restricted_chk\": \"excludeRestrictedChecked\",\n            \"click .page_size_prompt\": \"showPageSizePrompt\",\n            \"keyup .library-search-input\": \"searchLibraries\"\n        },\n\n        initialize: function(options) {\n            this.options = _.defaults(this.options || {}, options, this.defaults);\n            this.render();\n        },\n\n        render: function() {\n            var toolbar_template = this.templateToolBar();\n            var is_admin = false;\n            var is_anonym = true;\n            if (Galaxy.user) {\n                is_admin = Galaxy.user.isAdmin();\n                is_anonym = Galaxy.user.isAnonymous();\n            }\n            this.$el.html(toolbar_template({ admin_user: is_admin, anon_user: is_anonym }));\n            if (is_admin) {\n                this.$el.find(\"#include_deleted_chk\")[0].checked = Galaxy.libraries.preferences.get(\"with_deleted\");\n                this.$el.find(\"#exclude_restricted_chk\")[0].checked = Galaxy.libraries.preferences.get(\n                    \"without_restricted\"\n                );\n            }\n        },\n\n        /**\n   * Renders the element that shows pages into its div within the toolbar.\n   */\n        renderPaginator: function(options) {\n            this.options = _.extend(this.options, options);\n            var paginator_template = this.templatePaginator();\n            this.$el.find(\"#library_paginator\").html(\n                paginator_template({\n                    show_page: parseInt(this.options.show_page),\n                    page_count: parseInt(this.options.page_count),\n                    total_libraries_count: this.options.total_libraries_count,\n                    libraries_shown: this.options.libraries_shown,\n                    library_page_size: Galaxy.libraries.preferences.get(\"library_page_size\")\n                })\n            );\n        },\n\n        /**\n   * User clicked on 'New library' button. Show modal to\n   * satisfy the wish.\n   */\n        createLibraryFromModal: function(event) {\n            event.preventDefault();\n            event.stopPropagation();\n            var self = this;\n            this.modal = Galaxy.modal;\n            this.modal.show({\n                closing_events: true,\n                title: \"Create New Library\",\n                body: this.templateNewLibraryInModal(),\n                buttons: {\n                    Create: function() {\n                        self.createNewLibrary();\n                    },\n                    Close: function() {\n                        self.modal.hide();\n                    }\n                }\n            });\n        },\n\n        /**\n   * Create the new library using the API asynchronously.\n   */\n        createNewLibrary: function() {\n            var libraryDetails = this.serializeNewLibrary();\n            if (this.validateNewLibrary(libraryDetails)) {\n                var library = new mod_library_model.Library();\n                var self = this;\n                library.save(libraryDetails, {\n                    success: function(library) {\n                        Galaxy.libraries.libraryListView.collection.add(library);\n                        self.modal.hide();\n                        self.clearLibraryModal();\n                        Galaxy.libraries.libraryListView.render();\n                        mod_toastr.success(\"Library created.\");\n                    },\n                    error: function(model, response) {\n                        if (typeof response.responseJSON !== \"undefined\") {\n                            mod_toastr.error(response.responseJSON.err_msg);\n                        } else {\n                            mod_toastr.error(\"An error occured.\");\n                        }\n                    }\n                });\n            } else {\n                mod_toastr.error(\"Library's name is missing.\");\n            }\n            return false;\n        },\n\n        /**\n   * Show user the propmpt to change the number of libs shown on page.\n   */\n        showPageSizePrompt: function(e) {\n            e.preventDefault();\n            var library_page_size = prompt(\n                \"How many libraries per page do you want to see?\",\n                Galaxy.libraries.preferences.get(\"library_page_size\")\n            );\n            if (library_page_size != null && library_page_size == parseInt(library_page_size)) {\n                Galaxy.libraries.preferences.set({\n                    library_page_size: parseInt(library_page_size)\n                });\n                Galaxy.libraries.libraryListView.render({ show_page: 1 });\n            }\n        },\n\n        /**\n   * Clear the library modal once it is saved.\n   */\n        clearLibraryModal: function() {\n            $(\"input[name='Name']\").val(\"\");\n            $(\"input[name='Description']\").val(\"\");\n            $(\"input[name='Synopsis']\").val(\"\");\n        },\n\n        /**\n   * Prepare new library variables to be submitted to API.\n   */\n        serializeNewLibrary: function() {\n            return {\n                name: $(\"input[name='Name']\").val(),\n                description: $(\"input[name='Description']\").val(),\n                synopsis: $(\"input[name='Synopsis']\").val()\n            };\n        },\n\n        /**\n   * Check whether entered values are valid.\n   */\n        validateNewLibrary: function(libraryDetails) {\n            return libraryDetails.name !== \"\";\n        },\n\n        /**\n   * Include or exclude deleted libraries in the view.\n   */\n        includeDeletedChecked: function(event) {\n            if (event.target.checked) {\n                Galaxy.libraries.preferences.set({ with_deleted: true });\n                Galaxy.libraries.libraryListView.fetchDeleted();\n            } else {\n                Galaxy.libraries.preferences.set({ with_deleted: false });\n                Galaxy.libraries.libraryListView.render();\n            }\n        },\n\n        /**\n   * Include or exclude restricted libraries in the view.\n   */\n        excludeRestrictedChecked: function(event) {\n            if (event.target.checked) {\n                Galaxy.libraries.preferences.set({ without_restricted: true });\n            } else {\n                Galaxy.libraries.preferences.set({ without_restricted: false });\n            }\n            Galaxy.libraries.libraryListView.render();\n        },\n\n        /**\n   * Take the contents of the search field and send it to the list view\n   * to query the collection of libraries.\n   */\n        searchLibraries: function(event) {\n            var search_term = $(\".library-search-input\").val();\n            this.options.search_term = search_term;\n            Galaxy.libraries.libraryListView.searchLibraries(search_term);\n        },\n\n        templateToolBar: function() {\n            return _.template(\n                [\n                    '<div class=\"library_style_container\">',\n                    '<div id=\"toolbar_form\">',\n                    '<div id=\"library_toolbar\">',\n                    '<form class=\"form-inline\" role=\"form\">',\n                    '<span><strong><a href=\"#\" title=\"Go to first page\">DATA LIBRARIES</a></strong></span>',\n                    '<span id=\"library_paginator\" class=\"library-paginator\">',\n                    // paginator will append here\n                    \"</span>\",\n                    '<div class=\"form-group toolbar-item\">',\n                    '<input type=\"text\" class=\"form-control library-search-input\" placeholder=\"Search\" size=\"30\">',\n                    \"</div>\",\n                    // only admins see the following\n                    \"<% if(admin_user === true) { %>\",\n                    '<div class=\"checkbox toolbar-item\" style=\"height: 20px;\">',\n                    \"<label>\",\n                    '<input id=\"include_deleted_chk\" type=\"checkbox\">',\n                    \"include deleted \",\n                    \"</input>\",\n                    \"</label>\",\n                    \"<label>\",\n                    '<input id=\"exclude_restricted_chk\" type=\"checkbox\">',\n                    \"exclude restricted\",\n                    \"</input>\",\n                    \"</label>\",\n                    \"</div>\",\n                    '<span class=\"toolbar-item\" data-toggle=\"tooltip\" data-placement=\"top\" title=\"Create New Library\">',\n                    '<button id=\"create_new_library_btn\" class=\"primary-button btn-xs\" type=\"button\"><span class=\"fa fa-plus\"></span> New Library</button>',\n                    \"</span>\",\n                    \"<% } %>\",\n                    '<span class=\"help-button\" data-toggle=\"tooltip\" data-placement=\"top\" title=\"See this screen annotated\">',\n                    '<a href=\"https://galaxyproject.org/data-libraries/screen/list-of-libraries/\" target=\"_blank\">',\n                    '<button class=\"primary-button\" type=\"button\"><span class=\"fa fa-question-circle\"></span> Help</button>',\n                    \"</a>\",\n                    \"</span>\",\n                    \"</form>\",\n                    \"</div>\",\n                    \"</div>\",\n                    '<div id=\"libraries_element\">',\n                    // table with libraries will append here\n                    \"</div>\",\n                    \"</div>\"\n                ].join(\"\")\n            );\n        },\n\n        templatePaginator: function() {\n            return _.template(\n                [\n                    '<ul class=\"pagination pagination-sm\">',\n                    \"<% if ( ( show_page - 1 ) > 0 ) { %>\",\n                    \"<% if ( ( show_page - 1 ) > page_count ) { %>\", // we are on higher page than total page count\n                    '<li><a href=\"#page/1\"><span class=\"fa fa-angle-double-left\"></span></a></li>',\n                    '<li class=\"disabled\"><a href=\"#page/<% print( show_page ) %>\"><% print( show_page - 1 ) %></a></li>',\n                    \"<% } else { %>\",\n                    '<li><a href=\"#page/1\"><span class=\"fa fa-angle-double-left\"></span></a></li>',\n                    '<li><a href=\"#page/<% print( show_page - 1 ) %>\"><% print( show_page - 1 ) %></a></li>',\n                    \"<% } %>\",\n                    \"<% } else { %>\", // we are on the first page\n                    '<li class=\"disabled\"><a href=\"#page/1\"><span class=\"fa fa-angle-double-left\"></span></a></li>',\n                    '<li class=\"disabled\"><a href=\"#page/<% print( show_page ) %>\"><% print( show_page - 1 ) %></a></li>',\n                    \"<% } %>\",\n                    '<li class=\"active\">',\n                    '<a href=\"#page/<% print( show_page ) %>\"><% print( show_page ) %></a>',\n                    \"</li>\",\n                    \"<% if ( ( show_page ) < page_count ) { %>\",\n                    '<li><a href=\"#page/<% print( show_page + 1 ) %>\"><% print( show_page + 1 ) %></a></li>',\n                    '<li><a href=\"#page/<% print( page_count ) %>\"><span class=\"fa fa-angle-double-right\"></span></a></li>',\n                    \"<% } else { %>\",\n                    '<li class=\"disabled\"><a href=\"#page/<% print( show_page  ) %>\"><% print( show_page + 1 ) %></a></li>',\n                    '<li class=\"disabled\"><a href=\"#page/<% print( page_count ) %>\"><span class=\"fa fa-angle-double-right\"></span></a></li>',\n                    \"<% } %>\",\n                    \"</ul>\",\n                    \"<span>\",\n                    ' <%- libraries_shown %> libraries shown <a href=\"\" data-toggle=\"tooltip\" data-placement=\"top\" title=\"currently <%- library_page_size %> per page\" class=\"page_size_prompt\">(change)</a>',\n                    \"</span>\",\n                    \"<span>\",\n                    \" <%- total_libraries_count %> total\",\n                    \"</span>\"\n                ].join(\"\")\n            );\n        },\n\n        templateNewLibraryInModal: function() {\n            return _.template(\n                [\n                    '<div id=\"new_library_modal\">',\n                    \"<form>\",\n                    '<input type=\"text\" name=\"Name\" value=\"\" placeholder=\"Name\" autofocus>',\n                    '<input type=\"text\" name=\"Description\" value=\"\" placeholder=\"Description\">',\n                    '<input type=\"text\" name=\"Synopsis\" value=\"\" placeholder=\"Synopsis\">',\n                    \"</form>\",\n                    \"</div>\"\n                ].join(\"\")\n            );\n        }\n    });\n\n    return {\n        LibraryToolbarView: LibraryToolbarView\n    };\n});\n"]}