define("mvc/history/history-list",["exports","utils/localization","utils/ajax-queue","utils/utils","mvc/grid/grid-view","mvc/history/history-model","mvc/history/copy-dialog","ui/loading-indicator"],function(t,e,i,a,n,o,l,r){"use strict";function s(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(t,"__esModule",{value:!0});var d=s(e),c=s(i),u=s(a),f=s(n),y=s(o),h=s(l),v=s(r),p=f.default.extend({initialize:function(t){this.ajaxQueue=new c.default.AjaxQueue,f.default.prototype.initialize.call(this,t)},init_grid_elements:function(){var t=this.ajaxQueue;t.stop(),f.default.prototype.init_grid_elements.call(this),$.makeArray(this.$el.find(".delayed-value-datasets_by_state").map(function(t,e){return function(){var t=$(e).data("history-id"),i=Galaxy.root+"api/histories/"+t+"?keys=nice_size,contents_active,contents_states",a={};return a.url=i,a.type="GET",a.success=function(e){for(var i=e.contents_states,a="",n=["ok","running","queued","new","error"],o=0;o<n.length;o++){var l=n[o],r=i[l];r&&(a+='<div class="count-box state-color-'+l+'" title="Datasets in '+l+' state">'+r+"</div> ")}var s=e.contents_active,d=s.deleted;d&&(a+='<div class="count-box state-color-deleted" title="Deleted datasets">'+d+"</div> ");var c=s.hidden;c&&(a+='<div class="count-box state-color-hidden" title="Hidden datasets">'+c+"</div> "),$(".delayed-value-datasets_by_state[data-history-id='"+t+"']").html(a),$(".delayed-value-disk_size[data-history-id='"+t+"']").html(e.nice_size)},jQuery.ajax(a)}})).forEach(function(e){return t.add(e)}),t.start()},_showCopyDialog:function(t){var e=new y.default.History({id:t});e.fetch().fail(function(){alert("History could not be fetched. Please contact an administrator")}).done(function(){(0,h.default)(e,{}).done(function(){window.parent&&window.parent.Galaxy&&window.parent.Galaxy.currHistoryPanel&&window.parent.Galaxy.currHistoryPanel.loadCurrentHistory(),window.location.reload(!0)})})},_add_operation:function(t,e,i){var a=this,n=i.operation_config[e.label];"Copy"==e.label&&(e.onclick=function(t){a._showCopyDialog(t)}),n.allowed&&e.allow_popup&&t.addItem({html:e.label,href:n.url_args,target:n.target,confirmation_text:e.confirm,func:function(t){t.preventDefault();var n=$(t.target).html();e.onclick?e.onclick(i.encode_id):a.execute(this.findItemByHtml(n))}})}}),_=Backbone.View.extend({title:(0,d.default)("Histories"),initialize:function(t){var e=this;v.default.markViewAsLoading(this),this.model=new Backbone.Model,u.default.get({url:Galaxy.root+"history/"+t.action_id+"?"+$.param(Galaxy.params),success:function(t){e.model.set(t),e.render()}})},render:function(){var t=new p(this.model.attributes);this.$el.empty().append(t.$el)}});t.default={View:_}});
//# sourceMappingURL=../../../maps/mvc/history/history-list.js.map
