"use strict";define(["mvc/toolshed/toolshed-model","mvc/toolshed/util"],function(e,t){return{RepoQueueView:Backbone.View.extend({el:"#center",defaults:[{}],initialize:function(t){var o=this;this.model=new e.RepoQueue,this.listenTo(this.model,"sync",this.render),this.model.fetch(),o.render()},render:function(e){var o=this,i=o.templateRepoQueue,r=o.model.models;o.$el.html(i({title:"Repository Installation Queue",repositories:r,queue:t.queueLength()})),$("#center").css("overflow","auto"),o.bindEvents()},bindEvents:function(){var e=this;$(".install_one").on("click",function(){var t=e.loadFromQueue($(this).attr("data-repokey"));e.installFromQueue(t,$(this).attr("data-repokey"))}),$(".remove_one").on("click",function(){var e=$(this).attr("data-repokey"),t=JSON.parse(localStorage.repositories);if(t.hasOwnProperty(e)){var o=t[e].repository.id;delete t[e],$("#queued_repository_"+o).remove()}localStorage.repositories=JSON.stringify(t)}),$("#clear_queue").on("click",function(){localStorage.repositories="{}"}),$("#from_workflow").on("click",function(){Backbone.history.navigate("workflows",{trigger:!0,replace:!0})})},installFromQueue:function(e,o){var i=Object();i.install_tool_dependencies=e.install_tool_dependencies,i.install_repository_dependencies=e.install_repository_dependencies,i.install_resolver_dependencies=e.install_resolver_dependencies,i.tool_panel_section=e.tool_panel_section,i.shed_tool_conf=e.shed_tool_conf,i.repositories=JSON.stringify([[e.repository.id,e.changeset_revision]]),i.tool_shed_repository_ids=JSON.stringify([e.repository.id]),i.tool_shed_url=o.split("|")[0],i.changeset=e.changeset_revision;var r=Galaxy.root+"api/tool_shed_repositories/install?async=True";if($("#queued_repository_"+e.repository.id).remove(),localStorage.repositories){void 0===o&&(o=t.queueKey(e));var s=JSON.parse(localStorage.repositories);s.hasOwnProperty(o)&&(delete s[o],localStorage.repositories=JSON.stringify(s))}$.post(r,i,function(e){var t=JSON.parse(e),o="status/r/"+t.repositories.join("|");$.post(Galaxy.root+"admin_toolshed/manage_repositories",t,function(e){console.log("Initializing repository installation succeeded")}),Backbone.history.navigate(o,{trigger:!0,replace:!0})})},loadFromQueue:function(e){var t=JSON.parse(localStorage.repositories);if(t.hasOwnProperty(e))return t[e]},reDraw:function(e){this.$el.empty(),this.initialize(e),this.model.fetch(),this.render(e)},templateRepoQueue:_.template(['<div class="unified-panel-header" id="panel_header" unselectable="on">','<div class="unified-panel-header-inner"><%= title %></div>','<div class="unified-panel-header-inner" style="position: absolute; right: 5px; top: 0px;"><a href="#/queue">Repository Queue (<%= queue %>)</a></div>',"</div>",'<div class="tab-pane" id="panel_header" id="repository_queue">','<table id="queued_repositories" class="grid" border="0" cellpadding="2" cellspacing="2" width="100%">','<thead id="grid-table-header">',"<tr>",'<th class="datasetRow">Name</th>','<th class="datasetRow">Owner</th>','<th class="datasetRow">Revision</th>','<th class="datasetRow">ToolShed</th>','<th class="datasetRow">Install</th>','<th class="datasetRow"><input class="btn btn-primary" type="submit" id="clear_queue" name="clear_queue" value="Clear queue" /></th>',"</tr>","</thead>","<tbody>","<% _.each(repositories, function(repository) { %>",'<tr id="queued_repository_<%= repository.get("id") %>">','<td class="datasetRow"><%= repository.get("repository").name %></td>','<td class="datasetRow"><%= repository.get("repository").owner %></td>','<td class="datasetRow"><%= repository.get("changeset_revision") %></td>','<td class="datasetRow"><%= repository.get("tool_shed_url") %></td>','<td class="datasetRow">','<input class="btn btn-primary install_one" data-repokey="<%= repository.get("queue_key") %>" type="submit" id="install_repository_<%= repository.get("id") %>" name="install_repository" value="Install now" />',"</td>",'<td class="datasetRow">','<input class="btn btn-primary remove_one" data-repokey="<%= repository.get("queue_key") %>" type="submit" id="unqueue_repository_<%= repository.get("id") %>" name="unqueue_repository" value="Remove from queue" />',"</td>","</tr>","<% }); %>","</tbody>","</table>",'<input type="button" class="btn btn-primary" id="from_workflow" value="Add from workflow" />',"</div>"].join(""))})}});
//# sourceMappingURL=../../../maps/mvc/toolshed/repository-queue-view.js.map
