define(["mvc/base-mvc","utils/localization"],function(a,b){var d={initialize:function(e){this.debug("HistoryContentViewMixin",e);this.selectable=e.selectable||false;this.log("\t selectable:",this.selectable);this.selected=e.selected||false;this.log("\t selected:",this.selected);this.expanded=e.expanded||false;this.log("\t expanded:",this.expanded)},render:function(f){var e=this._buildNewRender();this._queueNewRender(e,f);return this},_buildNewRender:function(){var e=$(this.templates.skeleton(this.model.toJSON()));e.find(".primary-actions").append(this._render_primaryActions());e.children(".details").replaceWith(this._renderBody());this._setUpBehaviors(e);return e},_queueNewRender:function(f,g){g=(g===undefined)?(true):(g);var e=this;if(g){$(e).queue(function(h){this.$el.fadeOut(e.fxSpeed,h)})}$(e).queue(function(h){this.$el.empty().attr("class",e.className).append(f.children());if(this.model.has("state")){this.$el.addClass("state-"+e.model.get("state"))}if(this.selectable){this.showSelector(0)}h()});if(g){$(e).queue(function(h){this.$el.fadeIn(e.fxSpeed,h)})}$(e).queue(function(h){this.trigger("rendered",e);if(this.model.inReadyState()){this.trigger("rendered:ready",e)}if(this.draggable){this.draggableOn()}h()})},_setUpBehaviors:function(e){e=e||this.$el;make_popup_menus(e);e.find("[title]").tooltip({placement:"bottom"})},_render_primaryActions:function(){return[]},_renderBody:function(){return null},toggleExpanded:function(e){e=(e===undefined)?(!this.expanded):(e);if(e){this.expand()}else{this.collapse()}return this},expand:function(){this.warn(this+".expand");var e=this;function f(){e.$(".details").replaceWith(e._renderBody());e.expanded=true;e.$(".details").slideDown(e.fxSpeed,function(){e.trigger("expanded",e)})}if(this.model.inReadyState()&&!this.model.hasDetails()){this.model.fetch().always(function(g){f()})}else{f()}},collapse:function(){var e=this;e.expanded=false;this.$(".details").slideUp(e.fxSpeed,function(){e.trigger("collapsed",e)})},showSelector:function(){if(this.selected){this.select(null,true)}this.selectable=true;this.trigger("selectable",true,this);this.$(".primary-actions").hide();this.$(".selector").show()},hideSelector:function(){this.selectable=false;this.trigger("selectable",false,this);this.$(".selector").hide();this.$(".primary-actions").show()},toggleSelector:function(){if(!this.$el.find(".selector").is(":visible")){this.showSelector()}else{this.hideSelector()}},select:function(e){this.$el.find(".selector span").removeClass("fa-square-o").addClass("fa-check-square-o");if(!this.selected){this.trigger("selected",this,e);this.selected=true}return false},deselect:function(e){this.$el.find(".selector span").removeClass("fa-check-square-o").addClass("fa-square-o");if(this.selected){this.trigger("de-selected",this,e);this.selected=false}return false},toggleSelect:function(e){if(this.selected){this.deselect(e)}else{this.select(e)}},draggableOn:function(){this.draggable=true;this.dragStartHandler=_.bind(this._dragStartHandler,this);this.dragEndHandler=_.bind(this._dragEndHandler,this);var e=this.$el.find(".title-bar").attr("draggable",true).get(0);e.addEventListener("dragstart",this.dragStartHandler,false);e.addEventListener("dragend",this.dragEndHandler,false)},draggableOff:function(){this.draggable=false;var e=this.$el.find(".title-bar").attr("draggable",false).get(0);e.removeEventListener("dragstart",this.dragStartHandler,false);e.removeEventListener("dragend",this.dragEndHandler,false)},toggleDraggable:function(){if(this.draggable){this.draggableOff()}else{this.draggableOn()}},_dragStartHandler:function(e){this.trigger("dragstart",this);e.dataTransfer.effectAllowed="move";e.dataTransfer.setData("text",JSON.stringify(this.model.toJSON()));return false},_dragEndHandler:function(e){this.trigger("dragend",this);return false},events:{"click .title-bar":"_clickTitleBar","keydown .title-bar":"_keyDownTitleBar","click .selector":"toggleSelect"},_clickTitleBar:function(e){e.stopPropagation();this.toggleExpanded()},_keyDownTitleBar:function(g){var e=32,f=13;if(g&&(g.type==="keydown")&&(g.keyCode===e||g.keyCode===f)){this.toggleExpanded();g.stopPropagation();return false}return true}};var c=Backbone.View.extend(a.LoggableMixin).extend(d);return{HistoryContentViewMixin:d,HistoryContentBaseView:c}});