webpackJsonp([1],{10:function(e,t,n){"use strict";(function(e,i){Object.defineProperty(t,"__esModule",{value:!0});var r=n(4),a=function(e){return e&&e.__esModule?e:{default:e}}(r),o=e.View.extend({optionsDefault:{css:"",placeholder:"No data available",data:[],value:null,multiple:!1,minimumInputLength:0,initialData:""},initialize:function(e){if(this.options=a.default.merge(e,this.optionsDefault),this.setElement(this._template(this.options)),!this.options.container)return void console.log("ui-select::initialize() : container not specified.");if(this.options.container.append(this.$el),this.select_data=this.options.data,this._refresh(),!this.options.multiple){this.options.value&&this._setValue(this.options.value);var t=this;this.options.onchange&&this.$el.on("change",function(){t.options.onchange(t.value())})}},value:function(e){var t=this._getValue();void 0!==e&&this._setValue(e);var n=this._getValue();return n!=t&&this.options.onchange&&this.options.onchange(n),n},text:function(){return this.$el.select2("data").text},disabled:function(){return!this.$el.select2("enable")},enable:function(){this.$el.select2("enable",!0)},disable:function(){this.$el.select2("enable",!1)},add:function(e){this.select_data.push({id:e.id,text:e.text}),this._refresh()},del:function(e){var t=this._getIndex(e);-1!=t&&(this.select_data.splice(t,1),this._refresh())},remove:function(){this.$el.select2("destroy")},update:function(e){this.select_data=[];for(var t in e.data)this.select_data.push(e.data[t]);this._refresh()},_refresh:function(){if(this.options.multiple){var e={multiple:this.options.multiple,containerCssClass:this.options.css,placeholder:this.options.placeholder,minimumInputLength:this.options.minimumInputLength,ajax:this.options.ajax,dropdownCssClass:this.options.dropdownCssClass,escapeMarkup:this.options.escapeMarkup,formatResult:this.options.formatResult,formatSelection:this.options.formatSelection,initSelection:this.options.initSelection,initialData:this.options.initialData};this.$el.select2(e)}else{var t=this._getValue(),e={data:this.select_data,containerCssClass:this.options.css,placeholder:this.options.placeholder,dropdownAutoWidth:!0};this.$el.select2(e),this._setValue(t)}},_getIndex:function(e){i.findIndex(this.select_data,{id:e})},_getValue:function(){return this.$el.select2("val")},_setValue:function(e){-1==this._getIndex(e)&&this.select_data.length>0&&(e=this.select_data[0].id),this.$el.select2("val",e)},_template:function(e){return'<input type="hidden" value="'+this.options.initialData+'"/>'}});t.default={View:o}}).call(t,n(2),n(1))},125:function(e,t,n){"use strict";(function(e){function n(e,t){this.canvas=null,this.dragging=!1,this.inner_color="#FFFFFF",this.outer_color="#D8B365",e&&t&&this.connect(e,t)}Object.defineProperty(t,"__esModule",{value:!0}),e.extend(n.prototype,{connect:function(e,t){this.handle1=e,this.handle1&&this.handle1.connect(this),this.handle2=t,this.handle2&&this.handle2.connect(this)},destroy:function(){this.handle1&&this.handle1.disconnect(this),this.handle2&&this.handle2.disconnect(this),e(this.canvas).remove()},destroyIfInvalid:function(){this.handle1&&this.handle2&&!this.handle2.attachable(this.handle1)&&this.destroy()},redraw:function(){var t=e("#canvas-container");this.canvas||(this.canvas=document.createElement("canvas"),t.append(e(this.canvas)),this.dragging&&(this.canvas.style.zIndex="300"));var n=function(n){return e(n).offset().left-t.offset().left},i=function(n){return e(n).offset().top-t.offset().top};if(this.handle1&&this.handle2){var r=n(this.handle1.element)+5,a=i(this.handle1.element)+5,o=n(this.handle2.element)+5,s=i(this.handle2.element)+5,l=Math.min(r,o),c=Math.max(r,o),d=Math.min(a,s),u=Math.max(a,s),h=Math.min(Math.max(Math.abs(u-d)/2,100),300),f=l-100,p=d-100,_=c-l+200,g=u-d+200;this.canvas.style.left=f+"px",this.canvas.style.top=p+"px",this.canvas.setAttribute("width",_),this.canvas.setAttribute("height",g),r-=f,a-=p,o-=f,s-=p;var m=(this.canvas.getContext("2d"),null),v=null,y=1;if(this.handle1&&this.handle1.isMappedOver()){var m=[-6,-3,0,3,6];y=5}else var m=[0];if(this.handle2&&this.handle2.isMappedOver()){var v=[-6,-3,0,3,6];y=5}else var v=[0];for(var b=this,w=0;w<y;w++){var x=5,k=7;(m.length>1||v.length>1)&&(x=1,k=3),b.draw_outlined_curve(r,a,o,s,h,x,k,m[w%m.length],v[w%v.length])}}},draw_outlined_curve:function(e,t,n,i,r,a,o,s,l){var s=s||0,l=l||0,c=this.canvas.getContext("2d");c.lineCap="round",c.strokeStyle=this.outer_color,c.lineWidth=o,c.beginPath(),c.moveTo(e,t+s),c.bezierCurveTo(e+r,t+s,n-r,i+l,n,i+l),c.stroke(),c.strokeStyle=this.inner_color,c.lineWidth=a,c.beginPath(),c.moveTo(e,t+s),c.bezierCurveTo(e+r,t+s,n-r,i+l,n,i+l),c.stroke()}}),t.default=n}).call(t,n(0))},126:function(e,t,n){"use strict";(function(e,i,r,a){function o(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var s=n(3),l=o(s),c=n(7),d=o(c),u=n(13),h=o(u),f=n(4),p=o(f),_=n(10),g=o(_),m=e.View.extend({el:"#center",model:null,options:{},defaults:{edit_mode:!1},events:{"click .toolbtn_modify_dataset":"enableModification","click .toolbtn_cancel_modifications":"render","click .toolbtn-download-dataset":"downloadDataset","click .toolbtn-import-dataset":"importIntoHistory","click .copy-link-to-clipboard":"copyToClipboard","click .make-private":"makeDatasetPrivate","click .remove-restrictions":"removeDatasetRestrictions","click .toolbtn_save_permissions":"savePermissions","click .toolbtn_save_modifications":"saveModifications"},select_genome:null,select_extension:null,list_extensions:[],auto:{id:"auto",text:"Auto-detect",description:"This system will try to detect the file type automatically. If your file is not detected properly as one of the known formats, it most likely means that it has some format problems (e.g., different number of columns on different rows). You can still coerce the system to set your data to the format you think it should be. You can also upload compressed files, which will automatically be decompressed."},list_genomes:[],initialize:function(e){this.options=i.extend(this.options,e),this.fetchExtAndGenomes(),this.options.id&&this.fetchDataset()},fetchDataset:function(e){this.options=i.extend(this.options,e),this.model=new h.default.Item({id:this.options.id});var t=this;this.model.fetch({success:function(){t.options.show_permissions?t.showPermissions():t.options.show_version?t.fetchVersion():t.render()},error:function(e,t){void 0!==t.responseJSON?d.default.error(t.responseJSON.err_msg+" Click this to go back.","",{onclick:function(){Galaxy.libraries.library_router.back()}}):d.default.error("An error occurred. Click this to go back.","",{onclick:function(){Galaxy.libraries.library_router.back()}})}})},render:function(e){this.options=i.extend(this.options,e),r(".tooltip").remove();var t=this.templateDataset();this.$el.html(t({item:this.model})),r(".peek").html(this.model.get("peek")),r("#center [data-toggle]").tooltip()},fetchVersion:function(e){this.options=i.extend(this.options,e);var t=this;this.options.ldda_id?(this.ldda=new h.default.Ldda({id:this.options.ldda_id}),this.ldda.url=this.ldda.urlRoot+this.model.id+"/versions/"+this.ldda.id,this.ldda.fetch({success:function(){t.renderVersion()},error:function(e,t){void 0!==t.responseJSON?d.default.error(t.responseJSON.err_msg):d.default.error("An error occurred.")}})):(this.render(),d.default.error("Library dataset version requested but no id provided."))},renderVersion:function(){r(".tooltip").remove();var e=this.templateVersion();this.$el.html(e({item:this.model,ldda:this.ldda})),r(".peek").html(this.ldda.get("peek"))},enableModification:function(){r(".tooltip").remove();var e=this.templateModifyDataset();this.$el.html(e({item:this.model})),this.renderSelectBoxes({genome_build:this.model.get("genome_build"),file_ext:this.model.get("file_ext")}),r(".peek").html(this.model.get("peek")),r("#center [data-toggle]").tooltip()},downloadDataset:function(){var e=Galaxy.root+"api/libraries/datasets/download/uncompressed",t={ld_ids:this.id};this.processDownload(e,t)},processDownload:function(e,t,n){if(e&&t){t="string"==typeof t?t:r.param(t);var i="";r.each(t.split("&"),function(){var e=this.split("=");i+='<input type="hidden" name="'+e[0]+'" value="'+e[1]+'" />'}),r('<form action="'+e+'" method="'+(n||"post")+'">'+i+"</form>").appendTo("body").submit().remove(),d.default.info("Your download will begin soon.")}},importIntoHistory:function(){this.refreshUserHistoriesList(function(e){var t=e.templateBulkImportInModal();e.modal=Galaxy.modal,e.modal.show({closing_events:!0,title:(0,l.default)("Import into History"),body:t({histories:e.histories.models}),buttons:{Import:function(){e.importCurrentIntoHistory()},Close:function(){Galaxy.modal.hide()}}})})},refreshUserHistoriesList:function(e){var t=this;this.histories=new h.default.GalaxyHistories,this.histories.fetch({success:function(n){0===n.length?d.default.warning("You have to create history first. Click this to do so.","",{onclick:function(){window.location=Galaxy.root}}):e(t)},error:function(e,t){void 0!==t.responseJSON?d.default.error(t.responseJSON.err_msg):d.default.error("An error occurred.")}})},importCurrentIntoHistory:function(){this.modal.disableButton("Import");var e=this.modal.$("input[name=history_name]").val(),t=this;if(""!==e)r.post(Galaxy.root+"api/histories",{name:e}).done(function(e){t.processImportToHistory(e.id)}).fail(function(e,t,n){d.default.error("An error occurred.")}).always(function(){t.modal.enableButton("Import")});else{var n=r(this.modal.$el).find("select[name=dataset_import_single] option:selected").val();this.processImportToHistory(n),this.modal.enableButton("Import")}},processImportToHistory:function(e){var t=new h.default.HistoryItem;t.url=t.urlRoot+e+"/contents",a.getJSON(Galaxy.root+"history/set_as_current?id="+e),t.save({content:this.id,source:"library"},{success:function(){Galaxy.modal.hide(),d.default.success("Dataset imported. Click this to start analyzing it.","",{onclick:function(){window.location=Galaxy.root}})},error:function(e,t){void 0!==t.responseJSON?d.default.error("Dataset not imported. "+t.responseJSON.err_msg):d.default.error("An error occured. Dataset not imported. Please try again.")}})},showPermissions:function(e){var t=this.templateDatasetPermissions(),n=this;this.options=i.extend(this.options,e),r(".tooltip").remove(),void 0!==this.options.fetched_permissions&&(0===this.options.fetched_permissions.access_dataset_roles.length?this.model.set({is_unrestricted:!0}):this.model.set({is_unrestricted:!1})),this.$el.html(t({item:this.model,is_admin:Galaxy.config.is_admin_user})),r.get(Galaxy.root+"api/libraries/datasets/"+n.id+"/permissions?scope=current").done(function(e){n.prepareSelectBoxes({fetched_permissions:e,is_admin:Galaxy.config.is_admin_user})}).fail(function(){d.default.error("An error occurred while attempting to fetch dataset permissions.")}),r("#center [data-toggle]").tooltip(),r("#center").css("overflow","auto")},_serializeRoles:function(e){for(var t=[],n=0;n<e.length;n++)t.push(e[n][1]+":"+e[n][0].replace(":"," ").replace(","," &"));return t},prepareSelectBoxes:function(e){this.options=i.extend(this.options,e),this.accessSelectObject=new g.default.View(this._generate_select_options({selector:"access_perm",initialData:this._serializeRoles(this.options.fetched_permissions.access_dataset_roles)})),this.modifySelectObject=new g.default.View(this._generate_select_options({selector:"modify_perm",initialData:this._serializeRoles(this.options.fetched_permissions.modify_item_roles)})),this.manageSelectObject=new g.default.View(this._generate_select_options({selector:"manage_perm",initialData:this._serializeRoles(this.options.fetched_permissions.manage_dataset_roles)}))},_generate_select_options:function(e){var t={minimumInputLength:0,multiple:!0,placeholder:"Click to select a role",formatResult:function(e){return e.name+" type: "+e.type},formatSelection:function(e){return e.name},initSelection:function(e,t){var n=[];r(e.val().split(",")).each(function(){var e=this.split(":");n.push({id:e[0],name:e[1]})}),t(n)},dropdownCssClass:"bigdrop"};return t.container=this.$el.find("#"+e.selector),t.css=e.selector,t.initialData=e.initialData.join(","),t.ajax={url:Galaxy.root+"api/libraries/datasets/"+this.id+"/permissions?scope=available",dataType:"json",quietMillis:100,data:function(e,t){return{q:e,page_limit:10,page:t}},results:function(e,t){var n=10*t<e.total;return{results:e.roles,more:n}}},t},saveModifications:function(e){var t=!1,n=this.model,i=this.$el.find(".input_dataset_name").val();if(void 0!==i&&i!==n.get("name")){if(!(i.length>0))return void d.default.warning("Library dataset name has to be at least 1 character long.");n.set("name",i),t=!0}var r=this.$el.find(".input_dataset_misc_info").val();void 0!==r&&r!==n.get("misc_info")&&(n.set("misc_info",r),t=!0);var a=this.select_genome.$el.select2("data").id;void 0!==a&&a!==n.get("genome_build")&&(n.set("genome_build",a),t=!0);var o=this.select_extension.$el.select2("data").id;void 0!==o&&o!==n.get("file_ext")&&(n.set("file_ext",o),t=!0);var s=this;t?n.save(null,{patch:!0,success:function(e){s.render(),d.default.success("Changes to library dataset saved.")},error:function(e,t){void 0!==t.responseJSON?d.default.error(t.responseJSON.err_msg):d.default.error("An error occured while attempting to update the library dataset.")}}):(s.render(),d.default.info("Nothing has changed."))},copyToClipboard:function(t){t.preventDefault();var n=e.history.location.href;-1!==n.lastIndexOf("/permissions")&&(n=n.substr(0,n.lastIndexOf("/permissions"))),window.prompt("Copy to clipboard: Ctrl+C, Enter",n)},makeDatasetPrivate:function(){var e=this;r.post(Galaxy.root+"api/libraries/datasets/"+e.id+"/permissions?action=make_private").done(function(t){e.model.set({is_unrestricted:!1}),e.showPermissions({fetched_permissions:t}),d.default.success("The dataset is now private to you.")}).fail(function(){d.default.error("An error occurred while attempting to make dataset private.")})},removeDatasetRestrictions:function(){var e=this;r.post(Galaxy.root+"api/libraries/datasets/"+e.id+"/permissions?action=remove_restrictions").done(function(t){e.model.set({is_unrestricted:!0}),e.showPermissions({fetched_permissions:t}),d.default.success("Access to this dataset is now unrestricted.")}).fail(function(){d.default.error("An error occurred while attempting to make dataset unrestricted.")})},_extractIds:function(e){for(var t=[],n=e.length-1;n>=0;n--)t.push(e[n].id);return t},savePermissions:function(e){var t=this,n=this._extractIds(this.accessSelectObject.$el.select2("data")),i=this._extractIds(this.manageSelectObject.$el.select2("data")),a=this._extractIds(this.modifySelectObject.$el.select2("data"));r.post(Galaxy.root+"api/libraries/datasets/"+t.id+"/permissions?action=set_permissions",{"access_ids[]":n,"manage_ids[]":i,"modify_ids[]":a}).done(function(e){t.showPermissions({fetched_permissions:e}),d.default.success("Permissions saved.")}).fail(function(){d.default.error("An error occurred while attempting to set dataset permissions.")})},fetchExtAndGenomes:function(){var e=this;0==this.list_genomes.length&&p.default.get({url:Galaxy.root+"api/datatypes?extension_only=False",success:function(t){for(var n in t)e.list_extensions.push({id:t[n].extension,text:t[n].extension,description:t[n].description,description_url:t[n].description_url});e.list_extensions.sort(function(e,t){return e.id>t.id?1:e.id<t.id?-1:0}),e.list_extensions.unshift(e.auto)}}),0==this.list_extensions.length&&p.default.get({url:Galaxy.root+"api/genomes",success:function(t){for(var n in t)e.list_genomes.push({id:t[n][1],text:t[n][0]});e.list_genomes.sort(function(e,t){return e.id>t.id?1:e.id<t.id?-1:0})}})},renderSelectBoxes:function(e){var t=this,n="?",i="auto";void 0!==e&&(void 0!==e.genome_build&&(n=e.genome_build),void 0!==e.file_ext&&(i=e.file_ext)),this.select_genome=new g.default.View({css:"dataset-genome-select",data:t.list_genomes,container:t.$el.find("#dataset_genome_select"),value:n}),this.select_extension=new g.default.View({css:"dataset-extension-select",data:t.list_extensions,container:t.$el.find("#dataset_extension_select"),value:i})},templateDataset:function(){return i.template(['<div class="library_style_container">','<div id="library_toolbar">','<button data-toggle="tooltip" data-placement="top" title="Download dataset" class="btn btn-default toolbtn-download-dataset primary-button toolbar-item" type="button">','<span class="fa fa-download"></span>',"&nbsp;Download","</button>",'<button data-toggle="tooltip" data-placement="top" title="Import dataset into history" class="btn btn-default toolbtn-import-dataset primary-button toolbar-item" type="button">','<span class="fa fa-book"></span>',"&nbsp;to History","</button>",'<% if (item.get("can_user_modify")) { %>','<button data-toggle="tooltip" data-placement="top" title="Modify library item" class="btn btn-default toolbtn_modify_dataset primary-button toolbar-item" type="button">','<span class="fa fa-pencil"></span>',"&nbsp;Modify","</button>","<% } %>",'<% if (item.get("can_user_manage")) { %>','<a href="#folders/<%- item.get("folder_id") %>/datasets/<%- item.id %>/permissions">','<button data-toggle="tooltip" data-placement="top" title="Manage permissions" class="btn btn-default toolbtn_change_permissions primary-button toolbar-item" type="button">','<span class="fa fa-group"></span>',"&nbsp;Permissions","</button>","</a>","<% } %>","</div>",'<ol class="breadcrumb">','<li><a title="Return to the list of libraries" href="#">Libraries</a></li>','<% _.each(item.get("full_path"), function(path_item) { %>',"<% if (path_item[0] != item.id) { %>",'<li><a title="Return to this folder" href="#/folders/<%- path_item[0] %>"><%- path_item[1] %></a> </li> ',"<% } else { %>",'<li class="active"><span title="You are here"><%- path_item[1] %></span></li>',"<% } %>","<% }); %>","</ol>",'<% if (item.get("is_unrestricted")) { %>',"<div>",'This dataset is unrestricted so everybody with the link can access it. Just share <span class="copy-link-to-clipboard"><a href=""a>this page</a></span>.',"</div>","<% } %>",'<div class="dataset_table">','<table class="grid table table-striped table-condensed">',"<tr>",'<th class="dataset-first-column" scope="row" id="id_row" data-id="<%= _.escape(item.get("ldda_id")) %>">Name</th>','<td><%= _.escape(item.get("name")) %></td>',"</tr>",'<% if (item.get("file_ext")) { %>',"<tr>",'<th scope="row">Data type</th>','<td><%= _.escape(item.get("file_ext")) %></td>',"</tr>","<% } %>",'<% if (item.get("genome_build")) { %>',"<tr>",'<th scope="row">Genome build</th>','<td><%= _.escape(item.get("genome_build")) %></td>',"</tr>","<% } %>",'<% if (item.get("file_size")) { %>',"<tr>",'<th scope="row">Size</th>','<td><%= _.escape(item.get("file_size")) %></td>',"</tr>","<% } %>",'<% if (item.get("date_uploaded")) { %>',"<tr>",'<th scope="row">Date uploaded (UTC)</th>','<td><%= _.escape(item.get("date_uploaded")) %></td>',"</tr>","<% } %>",'<% if (item.get("uploaded_by")) { %>',"<tr>",'<th scope="row">Uploaded by</th>','<td><%= _.escape(item.get("uploaded_by")) %></td>',"</tr>","<% } %>",'<% if (item.get("metadata_data_lines")) { %>',"<tr>",'<th scope="row">Data Lines</th>','<td scope="row"><%= _.escape(item.get("metadata_data_lines")) %></td>',"</tr>","<% } %>",'<% if (item.get("metadata_comment_lines")) { %>',"<tr>",'<th scope="row">Comment Lines</th>','<td scope="row"><%= _.escape(item.get("metadata_comment_lines")) %></td>',"</tr>","<% } %>",'<% if (item.get("metadata_columns")) { %>',"<tr>",'<th scope="row">Number of Columns</th>','<td scope="row"><%= _.escape(item.get("metadata_columns")) %></td>',"</tr>","<% } %>",'<% if (item.get("metadata_column_types")) { %>',"<tr>",'<th scope="row">Column Types</th>','<td scope="row"><%= _.escape(item.get("metadata_column_types")) %></td>',"</tr>","<% } %>",'<% if (item.get("message")) { %>',"<tr>",'<th scope="row">Message</th>','<td scope="row"><%= _.escape(item.get("message")) %></td>',"</tr>","<% } %>",'<% if (item.get("misc_blurb")) { %>',"<tr>",'<th scope="row">Misc. blurb</th>','<td scope="row"><%= _.escape(item.get("misc_blurb")) %></td>',"</tr>","<% } %>",'<% if (item.get("misc_info")) { %>',"<tr>",'<th scope="row">Misc. info</th>','<td scope="row"><%= _.escape(item.get("misc_info")) %></td>',"</tr>","<% } %>",'<% if (item.get("tags")) { %>',"<tr>",'<th scope="row">Tags</th>','<td scope="row"><%= _.escape(item.get("tags")) %></td>',"</tr>","<% } %>",'<% if ( item.get("uuid") !== "ok" ) { %>',"<tr>",'<th scope="row">UUID</th>','<td scope="row"><%= _.escape(item.get("uuid")) %></td>',"</tr>","<% } %>",'<% if ( item.get("state") !== "ok" ) { %>',"<tr>",'<th scope="row">State</th>','<td scope="row"><%= _.escape(item.get("state")) %></td>',"</tr>","<% } %>","</table>",'<% if (item.get("job_stderr")) { %>',"<h4>Job Standard Error</h4>",'<pre class="code">','<%= _.escape(item.get("job_stderr")) %>',"</pre>","<% } %>",'<% if (item.get("job_stdout")) { %>',"<h4>Job Standard Output</h4>",'<pre class="code">','<%= _.escape(item.get("job_stdout")) %>',"</pre>","<% } %>","<div>",'<pre class="peek">',"</pre>","</div>",'<% if (item.get("has_versions")) { %>',"<div>","<h3>Expired versions:</h3>","<ul>",'<% _.each(item.get("expired_versions"), function(version) { %>','<li><a title="See details of this version" href="#folders/<%- item.get("folder_id") %>/datasets/<%- item.id %>/versions/<%- version[0] %>"><%- version[1] %></a></li>',"<% }) %>","<ul>","</div>","<% } %>","</div>","</div>"].join(""))},templateVersion:function(){return i.template(['<div class="library_style_container">','<div id="library_toolbar">','<a href="#folders/<%- item.get("folder_id") %>/datasets/<%- item.id %>">','<button data-toggle="tooltip" data-placement="top" title="Go to latest dataset" class="btn btn-default primary-button toolbar-item" type="button">','<span class="fa fa-caret-left fa-lg"></span>',"&nbsp;Latest dataset","</button>","<a>","</div>",'<ol class="breadcrumb">','<li><a title="Return to the list of libraries" href="#">Libraries</a></li>','<% _.each(item.get("full_path"), function(path_item) { %>',"<% if (path_item[0] != item.id) { %>",'<li><a title="Return to this folder" href="#/folders/<%- path_item[0] %>"><%- path_item[1] %></a> </li> ',"<% } else { %>",'<li class="active"><span title="You are here"><%- path_item[1] %></span></li>',"<% } %>","<% }); %>","</ol>",'<div class="alert alert-warning">This is an expired version of the library dataset: <%= _.escape(item.get("name")) %></div>','<div class="dataset_table">','<table class="grid table table-striped table-condensed">',"<tr>",'<th scope="row" id="id_row" data-id="<%= _.escape(ldda.id) %>">Name</th>','<td><%= _.escape(ldda.get("name")) %></td>',"</tr>",'<% if (ldda.get("file_ext")) { %>',"<tr>",'<th scope="row">Data type</th>','<td><%= _.escape(ldda.get("file_ext")) %></td>',"</tr>","<% } %>",'<% if (ldda.get("genome_build")) { %>',"<tr>",'<th scope="row">Genome build</th>','<td><%= _.escape(ldda.get("genome_build")) %></td>',"</tr>","<% } %>",'<% if (ldda.get("file_size")) { %>',"<tr>",'<th scope="row">Size</th>','<td><%= _.escape(ldda.get("file_size")) %></td>',"</tr>","<% } %>",'<% if (ldda.get("date_uploaded")) { %>',"<tr>",'<th scope="row">Date uploaded (UTC)</th>','<td><%= _.escape(ldda.get("date_uploaded")) %></td>',"</tr>","<% } %>",'<% if (ldda.get("uploaded_by")) { %>',"<tr>",'<th scope="row">Uploaded by</th>','<td><%= _.escape(ldda.get("uploaded_by")) %></td>',"</tr>","<% } %>",'<% if (ldda.get("metadata_data_lines")) { %>',"<tr>",'<th scope="row">Data Lines</th>','<td scope="row"><%= _.escape(ldda.get("metadata_data_lines")) %></td>',"</tr>","<% } %>",'<% if (ldda.get("metadata_comment_lines")) { %>',"<tr>",'<th scope="row">Comment Lines</th>','<td scope="row"><%= _.escape(ldda.get("metadata_comment_lines")) %></td>',"</tr>","<% } %>",'<% if (ldda.get("metadata_columns")) { %>',"<tr>",'<th scope="row">Number of Columns</th>','<td scope="row"><%= _.escape(ldda.get("metadata_columns")) %></td>',"</tr>","<% } %>",'<% if (ldda.get("metadata_column_types")) { %>',"<tr>",'<th scope="row">Column Types</th>','<td scope="row"><%= _.escape(ldda.get("metadata_column_types")) %></td>',"</tr>","<% } %>",'<% if (ldda.get("message")) { %>',"<tr>",'<th scope="row">Message</th>','<td scope="row"><%= _.escape(ldda.get("message")) %></td>',"</tr>","<% } %>",'<% if (ldda.get("misc_blurb")) { %>',"<tr>",'<th scope="row">Miscellaneous blurb</th>','<td scope="row"><%= _.escape(ldda.get("misc_blurb")) %></td>',"</tr>","<% } %>",'<% if (ldda.get("misc_info")) { %>',"<tr>",'<th scope="row">Miscellaneous information</th>','<td scope="row"><%= _.escape(ldda.get("misc_info")) %></td>',"</tr>","<% } %>",'<% if (item.get("tags")) { %>',"<tr>",'<th scope="row">Tags</th>','<td scope="row"><%= _.escape(item.get("tags")) %></td>',"</tr>","<% } %>","</table>","<div>",'<pre class="peek">',"</pre>","</div>","</div>","</div>"].join(""))},templateModifyDataset:function(){return i.template(['<div class="library_style_container">','<div id="library_toolbar">','<button data-toggle="tooltip" data-placement="top" title="Cancel modifications" class="btn btn-default toolbtn_cancel_modifications primary-button toolbar-item" type="button">','<span class="fa fa-times"></span>',"&nbsp;Cancel","</button>",'<button data-toggle="tooltip" data-placement="top" title="Save modifications" class="btn btn-default toolbtn_save_modifications primary-button toolbar-item" type="button">','<span class="fa fa-floppy-o"></span>',"&nbsp;Save","</button>","</div>",'<ol class="breadcrumb">','<li><a title="Return to the list of libraries" href="#">Libraries</a></li>','<% _.each(item.get("full_path"), function(path_item) { %>',"<% if (path_item[0] != item.id) { %>",'<li><a title="Return to this folder" href="#/folders/<%- path_item[0] %>"><%- path_item[1] %></a> </li> ',"<% } else { %>",'<li class="active"><span title="You are here"><%- path_item[1] %></span></li>',"<% } %>","<% }); %>","</ol>",'<div class="dataset_table">','<table class="grid table table-striped table-condensed">',"<tr>",'<th class="dataset-first-column" scope="row" id="id_row" data-id="<%= _.escape(item.get("ldda_id")) %>">Name</th>','<td><input class="input_dataset_name form-control" type="text" placeholder="name" value="<%= _.escape(item.get("name")) %>"></td>',"</tr>","<tr>",'<th scope="row">Data type</th>',"<td>",'<span id="dataset_extension_select" class="dataset-extension-select" />',"</td>","</tr>","<tr>",'<th scope="row">Genome build</th>',"<td>",'<span id="dataset_genome_select" class="dataset-genome-select" />',"</td>","</tr>","<tr>",'<th scope="row">Size</th>','<td><%= _.escape(item.get("file_size")) %></td>',"</tr>","<tr>",'<th scope="row">Date uploaded (UTC)</th>','<td><%= _.escape(item.get("date_uploaded")) %></td>',"</tr>","<tr>",'<th scope="row">Uploaded by</th>','<td><%= _.escape(item.get("uploaded_by")) %></td>',"</tr>",'<tr scope="row">','<th scope="row">Data Lines</th>','<td scope="row"><%= _.escape(item.get("metadata_data_lines")) %></td>',"</tr>",'<th scope="row">Comment Lines</th>','<% if (item.get("metadata_comment_lines") === "") { %>','<td scope="row"><%= _.escape(item.get("metadata_comment_lines")) %></td>',"<% } else { %>",'<td scope="row">unknown</td>',"<% } %>","</tr>","<tr>",'<th scope="row">Number of Columns</th>','<td scope="row"><%= _.escape(item.get("metadata_columns")) %></td>',"</tr>","<tr>",'<th scope="row">Column Types</th>','<td scope="row"><%= _.escape(item.get("metadata_column_types")) %></td>',"</tr>","<tr>",'<th scope="row">Message</th>','<td scope="row"><%= _.escape(item.get("message")) %></td>',"</tr>","<tr>",'<th scope="row">Misc. blurb</th>','<td scope="row"><%= _.escape(item.get("misc_blurb")) %></td>',"</tr>","<tr>",'<th scope="row">Misc. information</th>','<td><input class="input_dataset_misc_info form-control" type="text" placeholder="info" value="<%= _.escape(item.get("misc_info")) %>"></td>',"</tr>",'<% if (item.get("tags")) { %>',"<tr>",'<th scope="row">Tags</th>','<td scope="row"><%= _.escape(item.get("tags")) %></td>',"</tr>","<% } %>","</table>","<div>",'<pre class="peek">',"</pre>","</div>","</div>","</div>"].join(""))},templateDatasetPermissions:function(){return i.template(['<div class="library_style_container">','<div id="library_toolbar">','<a href="#folders/<%- item.get("folder_id") %>/datasets/<%- item.id %>">','<button data-toggle="tooltip" data-placement="top" title="Go back to dataset" class="btn btn-default primary-button toolbar-item" type="button">','<span class="fa fa-file-o"></span>',"&nbsp;Dataset Details","</button>","<a>","</div>",'<ol class="breadcrumb">','<li><a title="Return to the list of libraries" href="#">Libraries</a></li>','<% _.each(item.get("full_path"), function(path_item) { %>',"<% if (path_item[0] != item.id) { %>",'<li><a title="Return to this folder" href="#/folders/<%- path_item[0] %>"><%- path_item[1] %></a> </li> ',"<% } else { %>",'<li class="active"><span title="You are here"><%- path_item[1] %></span></li>',"<% } %>","<% }); %>","</ol>",'<h1>Dataset: <%= _.escape(item.get("name")) %></h1>','<div class="alert alert-warning">',"<% if (is_admin) { %>","You are logged in as an <strong>administrator</strong> therefore you can manage any dataset on this Galaxy instance. Please make sure you understand the consequences.","<% } else { %>","You can assign any number of roles to any of the following permission types. However please read carefully the implications of such actions.","<% } %>","</div>",'<div class="dataset_table">',"<h2>Library-related permissions</h2>","<h4>Roles that can modify the library item</h4>",'<div id="modify_perm" class="modify_perm roles-selection"></div>','<div class="alert alert-info roles-selection">User with <strong>any</strong> of these roles can modify name, metadata, and other information about this library item.</div>',"<hr/>","<h2>Dataset-related permissions</h2>",'<div class="alert alert-warning">Changes made below will affect <strong>every</strong> library item that was created from this dataset and also every history this dataset is part of.</div>','<% if (!item.get("is_unrestricted")) { %>','<p>You can <span class="remove-restrictions"><a href="">remove all access restrictions</a></span> on this dataset.</p>',"<% } else { %>",'<p>You can <span class="make-private"><a href="">make this dataset private</a></span> to you.</p>',"<% } %>","<h4>Roles that can access the dataset</h4>",'<div id="access_perm" class="access_perm roles-selection"></div>','<div class="alert alert-info roles-selection">',"User has to have <strong>all these roles</strong> in order to access this dataset."," Users without access permission <strong>cannot</strong> have other permissions on this dataset."," If there are no access roles set on the dataset it is considered <strong>unrestricted</strong>.","</div>","<h4>Roles that can manage permissions on the dataset</h4>",'<div id="manage_perm" class="manage_perm roles-selection"></div>','<div class="alert alert-info roles-selection">',"User with <strong>any</strong> of these roles can manage permissions of this dataset. If you remove yourself you will lose the ability manage this dataset unless you are an admin.","</div>",'<button data-toggle="tooltip" data-placement="top" title="Save modifications made on this page" class="btn btn-default toolbtn_save_permissions primary-button" type="button">','<span class="fa fa-floppy-o"></span>',"&nbsp;Save","</button>","</div>","</div>"].join(""))},templateBulkImportInModal:function(){return i.template(["<div>",'<div class="library-modal-item">',"Select history: ",'<select id="dataset_import_single" name="dataset_import_single" style="width:50%; margin-bottom: 1em; " autofocus>',"<% _.each(histories, function(history) { %>",'<option value="<%= _.escape(history.get("id")) %>"><%= _.escape(history.get("name")) %></option>',"<% }); %>","</select>","</div>",'<div class="library-modal-item">',"or create new: ",'<input type="text" name="history_name" value="" placeholder="name of the new history" style="width:50%;">',"</input>","</div>","</div>"].join(""))}});t.default={LibraryDatasetView:m}}).call(t,n(2),n(1),n(0),n(0))},127:function(e,t,n){var i,r,a;!function(o){"use strict";r=[n(0)],i=o,void 0!==(a="function"==typeof i?i.apply(t,r):i)&&(e.exports=a)}(function(e,t){"use strict";/*!
 * jsTree 3.0.3
 * http://jstree.com/
 *
 * Copyright (c) 2014 Ivan Bozhanov (http://vakata.com)
 *
 * Licensed same as jquery - under the terms of the MIT License
 *   http://www.opensource.org/licenses/mit-license.php
 */
/*!
 * if using jslint please allow for the jQuery global and use following options: 
 * jslint: browser: true, ass: true, bitwise: true, continue: true, nomen: true, plusplus: true, regexp: true, unparam: true, todo: true, white: true
 */
if(!e.jstree){var n,i,r=0,a=!1,o=!1,s=!1,l=[],c=e("script:last").attr("src"),d=document,u=d.createElement("LI");u.setAttribute("role","treeitem"),n=d.createElement("I"),n.className="jstree-icon jstree-ocl",u.appendChild(n),n=d.createElement("A"),n.className="jstree-anchor",n.setAttribute("href","#"),i=d.createElement("I"),i.className="jstree-icon jstree-themeicon",n.appendChild(i),u.appendChild(n),n=i=null,e.jstree={version:"3.0.3",defaults:{plugins:[]},plugins:{},path:c&&-1!==c.indexOf("/")?c.replace(/\/[^\/]+$/,""):"",idregex:/[\\:&!^|()\[\]<>@*'+~#";.,=\- \/${}%]/g},e.jstree.create=function(t,n){var i=new e.jstree.core(++r),a=n;return n=e.extend(!0,{},e.jstree.defaults,n),a&&a.plugins&&(n.plugins=a.plugins),e.each(n.plugins,function(e,t){"core"!==e&&(i=i.plugin(t,n[t]))}),i.init(t,n),i},e.jstree.core=function(e){this._id=e,this._cnt=0,this._wrk=null,this._data={core:{themes:{name:!1,dots:!1,icons:!1},selected:[],last_error:{},working:!1,worker_queue:[]}}},e.jstree.reference=function(t){var n=null,i=null;if(t&&t.id&&(t=t.id),!i||!i.length)try{i=e(t)}catch(e){}if(!i||!i.length)try{i=e("#"+t.replace(e.jstree.idregex,"\\$&"))}catch(e){}return i&&i.length&&(i=i.closest(".jstree")).length&&(i=i.data("jstree"))?n=i:e(".jstree").each(function(){var i=e(this).data("jstree");if(i&&i._model.data[t])return n=i,!1}),n},e.fn.jstree=function(n){var i="string"==typeof n,r=Array.prototype.slice.call(arguments,1),a=null;return this.each(function(){var o=e.jstree.reference(this),s=i&&o?o[n]:null;if(a=i&&s?s.apply(o,r):null,o||i||n!==t&&!e.isPlainObject(n)||e(this).data("jstree",new e.jstree.create(this,n)),(o&&!i||!0===n)&&(a=o||!1),null!==a&&a!==t)return!1}),null!==a&&a!==t?a:this},e.expr[":"].jstree=e.expr.createPseudo(function(n){return function(n){return e(n).hasClass("jstree")&&e(n).data("jstree")!==t}}),e.jstree.defaults.core={data:!1,strings:!1,check_callback:!1,error:e.noop,animation:200,multiple:!0,themes:{name:!1,url:!1,dir:!1,dots:!0,icons:!0,stripes:!1,variant:!1,responsive:!1},expand_selected_onload:!0,worker:!0,force_text:!1},e.jstree.core.prototype={plugin:function(t,n){var i=e.jstree.plugins[t];return i?(this._data[t]={},i.prototype=this,new i(n,this)):this},init:function(t,n){this._model={data:{"#":{id:"#",parent:null,parents:[],children:[],children_d:[],state:{loaded:!1}}},changed:[],force_full_redraw:!1,redraw_timeout:!1,default_state:{loaded:!0,opened:!1,selected:!1,disabled:!1}},this.element=e(t).addClass("jstree jstree-"+this._id),this.settings=n,this.element.bind("destroyed",e.proxy(this.teardown,this)),this._data.core.ready=!1,this._data.core.loaded=!1,this._data.core.rtl="rtl"===this.element.css("direction"),this.element[this._data.core.rtl?"addClass":"removeClass"]("jstree-rtl"),this.element.attr("role","tree"),this.bind(),this.trigger("init"),this._data.core.original_container_html=this.element.find(" > ul > li").clone(!0),this._data.core.original_container_html.find("li").addBack().contents().filter(function(){return 3===this.nodeType&&(!this.nodeValue||/^\s+$/.test(this.nodeValue))}).remove(),this.element.html("<ul class='jstree-container-ul jstree-children'><li class='jstree-initial-node jstree-loading jstree-leaf jstree-last'><i class='jstree-icon jstree-ocl'></i><a class='jstree-anchor' href='#'><i class='jstree-icon jstree-themeicon-hidden'></i>"+this.get_string("Loading ...")+"</a></li></ul>"),this._data.core.li_height=this.get_container_ul().children("li:eq(0)").height()||24,this.trigger("loading"),this.load_node("#")},destroy:function(e){e||this.element.empty(),this.element.unbind("destroyed",this.teardown),this.teardown()},teardown:function(){this.unbind(),this.element.removeClass("jstree").removeData("jstree").find("[class^='jstree']").addBack().attr("class",function(){return this.className.replace(/jstree[^ ]*|$/gi,"")}),this.element=null},bind:function(){this.element.on("dblclick.jstree",function(){if(document.selection&&document.selection.empty)document.selection.empty();else if(window.getSelection){var e=window.getSelection();try{e.removeAllRanges(),e.collapse()}catch(e){}}}).on("click.jstree",".jstree-ocl",e.proxy(function(e){this.toggle_node(e.target)},this)).on("click.jstree",".jstree-anchor",e.proxy(function(t){t.preventDefault(),e(t.currentTarget).focus(),this.activate_node(t.currentTarget,t)},this)).on("keydown.jstree",".jstree-anchor",e.proxy(function(t){if("INPUT"===t.target.tagName)return!0;var n=null;switch(t.which){case 13:case 32:t.type="click",e(t.currentTarget).trigger(t);break;case 37:t.preventDefault(),this.is_open(t.currentTarget)?this.close_node(t.currentTarget):(n=this.get_prev_dom(t.currentTarget))&&n.length&&n.children(".jstree-anchor").focus();break;case 38:t.preventDefault(),n=this.get_prev_dom(t.currentTarget),n&&n.length&&n.children(".jstree-anchor").focus();break;case 39:t.preventDefault(),this.is_closed(t.currentTarget)?this.open_node(t.currentTarget,function(e){this.get_node(e,!0).children(".jstree-anchor").focus()}):(n=this.get_next_dom(t.currentTarget))&&n.length&&n.children(".jstree-anchor").focus();break;case 40:t.preventDefault(),n=this.get_next_dom(t.currentTarget),n&&n.length&&n.children(".jstree-anchor").focus();break;case 46:t.preventDefault(),n=this.get_node(t.currentTarget),n&&n.id&&"#"!==n.id&&(n=this.is_selected(n)?this.get_selected():n);break;case 113:t.preventDefault(),n=this.get_node(t.currentTarget)}},this)).on("load_node.jstree",e.proxy(function(t,n){if(n.status&&("#"!==n.node.id||this._data.core.loaded||(this._data.core.loaded=!0,this.trigger("loaded")),!this._data.core.ready&&!this.get_container_ul().find(".jstree-loading:eq(0)").length)){if(this._data.core.ready=!0,this._data.core.selected.length){if(this.settings.core.expand_selected_onload){var i,r,a=[];for(i=0,r=this._data.core.selected.length;i<r;i++)a=a.concat(this._model.data[this._data.core.selected[i]].parents);for(a=e.vakata.array_unique(a),i=0,r=a.length;i<r;i++)this.open_node(a[i],!1,0)}this.trigger("changed",{action:"ready",selected:this._data.core.selected})}setTimeout(e.proxy(function(){this.trigger("ready")},this),0)}},this)).on("init.jstree",e.proxy(function(){var e=this.settings.core.themes;this._data.core.themes.dots=e.dots,this._data.core.themes.stripes=e.stripes,this._data.core.themes.icons=e.icons,this.set_theme(e.name||"default",e.url),this.set_theme_variant(e.variant)},this)).on("loading.jstree",e.proxy(function(){this[this._data.core.themes.dots?"show_dots":"hide_dots"](),this[this._data.core.themes.icons?"show_icons":"hide_icons"](),this[this._data.core.themes.stripes?"show_stripes":"hide_stripes"]()},this)).on("blur.jstree",".jstree-anchor",e.proxy(function(t){e(t.currentTarget).filter(".jstree-hovered").mouseleave()},this)).on("focus.jstree",".jstree-anchor",e.proxy(function(t){this.element.find(".jstree-hovered").not(t.currentTarget).mouseleave(),e(t.currentTarget).mouseenter()},this)).on("mouseenter.jstree",".jstree-anchor",e.proxy(function(e){this.hover_node(e.currentTarget)},this)).on("mouseleave.jstree",".jstree-anchor",e.proxy(function(e){this.dehover_node(e.currentTarget)},this))},unbind:function(){this.element.off(".jstree"),e(document).off(".jstree-"+this._id)},trigger:function(e,t){t||(t={}),t.instance=this,this.element.triggerHandler(e.replace(".jstree","")+".jstree",t)},get_container:function(){return this.element},get_container_ul:function(){return this.element.children(".jstree-children:eq(0)")},get_string:function(t){var n=this.settings.core.strings;return e.isFunction(n)?n.call(this,t):n&&n[t]?n[t]:t},_firstChild:function(e){for(e=e?e.firstChild:null;null!==e&&1!==e.nodeType;)e=e.nextSibling;return e},_nextSibling:function(e){for(e=e?e.nextSibling:null;null!==e&&1!==e.nodeType;)e=e.nextSibling;return e},_previousSibling:function(e){for(e=e?e.previousSibling:null;null!==e&&1!==e.nodeType;)e=e.previousSibling;return e},get_node:function(t,n){t&&t.id&&(t=t.id);var i;try{if(this._model.data[t])t=this._model.data[t];else if(((i=e(t,this.element)).length||(i=e("#"+t.replace(e.jstree.idregex,"\\$&"),this.element)).length)&&this._model.data[i.closest(".jstree-node").attr("id")])t=this._model.data[i.closest(".jstree-node").attr("id")];else{if(!(i=e(t,this.element)).length||!i.hasClass("jstree"))return!1;t=this._model.data["#"]}return n&&(t="#"===t.id?this.element:e("#"+t.id.replace(e.jstree.idregex,"\\$&"),this.element)),t}catch(e){return!1}},get_path:function(e,t,n){if(!(e=e.parents?e:this.get_node(e))||"#"===e.id||!e.parents)return!1;var i,r,a=[];for(a.push(n?e.id:e.text),i=0,r=e.parents.length;i<r;i++)a.push(n?e.parents[i]:this.get_text(e.parents[i]));return a=a.reverse().slice(1),t?a.join(t):a},get_next_dom:function(t,n){var i;return t=this.get_node(t,!0),t[0]===this.element[0]?!!(i=this._firstChild(this.get_container_ul()[0]))&&e(i):!(!t||!t.length)&&(n?!!(i=this._nextSibling(t[0]))&&e(i):t.hasClass("jstree-open")?!!(i=this._firstChild(t.children(".jstree-children")[0]))&&e(i):null!==(i=this._nextSibling(t[0]))?e(i):t.parentsUntil(".jstree",".jstree-node").next(".jstree-node").eq(0))},get_prev_dom:function(t,n){var i;if(t=this.get_node(t,!0),t[0]===this.element[0])return!!(i=this.get_container_ul()[0].lastChild)&&e(i);if(!t||!t.length)return!1;if(n)return!!(i=this._previousSibling(t[0]))&&e(i);if(null!==(i=this._previousSibling(t[0]))){for(t=e(i);t.hasClass("jstree-open");)t=t.children(".jstree-children:eq(0)").children(".jstree-node:last");return t}return!(!(i=t[0].parentNode.parentNode)||!i.className||-1===i.className.indexOf("jstree-node"))&&e(i)},get_parent:function(e){return!(!(e=this.get_node(e))||"#"===e.id)&&e.parent},get_children_dom:function(e){return e=this.get_node(e,!0),e[0]===this.element[0]?this.get_container_ul().children(".jstree-node"):!(!e||!e.length)&&e.children(".jstree-children").children(".jstree-node")},is_parent:function(e){return(e=this.get_node(e))&&(!1===e.state.loaded||e.children.length>0)},is_loaded:function(e){return(e=this.get_node(e))&&e.state.loaded},is_loading:function(e){return(e=this.get_node(e))&&e.state&&e.state.loading},is_open:function(e){return(e=this.get_node(e))&&e.state.opened},is_closed:function(e){return(e=this.get_node(e))&&this.is_parent(e)&&!e.state.opened},is_leaf:function(e){return!this.is_parent(e)},load_node:function(t,n){var i,r,a,o,s;if(e.isArray(t))return this._load_nodes(t.slice(),n),!0;if(!(t=this.get_node(t)))return n&&n.call(this,t,!1),!1;if(t.state.loaded){for(t.state.loaded=!1,i=0,r=t.children_d.length;i<r;i++){for(a=0,o=t.parents.length;a<o;a++)this._model.data[t.parents[a]].children_d=e.vakata.array_remove_item(this._model.data[t.parents[a]].children_d,t.children_d[i]);this._model.data[t.children_d[i]].state.selected&&(s=!0,this._data.core.selected=e.vakata.array_remove_item(this._data.core.selected,t.children_d[i])),delete this._model.data[t.children_d[i]]}t.children=[],t.children_d=[],s&&this.trigger("changed",{action:"load_node",node:t,selected:this._data.core.selected})}return t.state.loading=!0,this.get_node(t,!0).addClass("jstree-loading"),this._load_node(t,e.proxy(function(e){t=this._model.data[t.id],t.state.loading=!1,t.state.loaded=e;var i=this.get_node(t,!0);t.state.loaded&&!t.children.length&&i&&i.length&&!i.hasClass("jstree-leaf")&&i.removeClass("jstree-closed jstree-open").addClass("jstree-leaf"),i.removeClass("jstree-loading"),this.trigger("load_node",{node:t,status:e}),n&&n.call(this,t,e)},this)),!0},_load_nodes:function(e,t,n){var i,r,a=!0,o=function(){this._load_nodes(e,t,!0)},s=this._model.data;for(i=0,r=e.length;i<r;i++)!s[e[i]]||s[e[i]].state.loaded&&n||(this.is_loading(e[i])||this.load_node(e[i],o),a=!1);a&&t&&!t.done&&(t.call(this,e),t.done=!0)},_load_node:function(t,n){var i,r=this.settings.core.data;return r?e.isFunction(r)?r.call(this,t,e.proxy(function(i){!1===i&&n.call(this,!1),this["string"==typeof i?"_append_html_data":"_append_json_data"](t,"string"==typeof i?e(i):i,function(e){n.call(this,e)})},this)):"object"==typeof r?r.url?(r=e.extend(!0,{},r),e.isFunction(r.url)&&(r.url=r.url.call(this,t)),e.isFunction(r.data)&&(r.data=r.data.call(this,t)),e.ajax(r).done(e.proxy(function(i,r,a){var o=a.getResponseHeader("Content-Type");return-1!==o.indexOf("json")||"object"==typeof i?this._append_json_data(t,i,function(e){n.call(this,e)}):-1!==o.indexOf("html")||"string"==typeof i?this._append_html_data(t,e(i),function(e){n.call(this,e)}):(this._data.core.last_error={error:"ajax",plugin:"core",id:"core_04",reason:"Could not load node",data:JSON.stringify({id:t.id,xhr:a})},this.settings.core.error.call(this,this._data.core.last_error),n.call(this,!1))},this)).fail(e.proxy(function(e){n.call(this,!1),this._data.core.last_error={error:"ajax",plugin:"core",id:"core_04",reason:"Could not load node",data:JSON.stringify({id:t.id,xhr:e})},this.settings.core.error.call(this,this._data.core.last_error)},this))):(i=e.isArray(r)||e.isPlainObject(r)?JSON.parse(JSON.stringify(r)):r,"#"===t.id?this._append_json_data(t,i,function(e){n.call(this,e)}):(this._data.core.last_error={error:"nodata",plugin:"core",id:"core_05",reason:"Could not load node",data:JSON.stringify({id:t.id})},this.settings.core.error.call(this,this._data.core.last_error),n.call(this,!1))):"string"==typeof r?"#"===t.id?this._append_html_data(t,e(r),function(e){n.call(this,e)}):(this._data.core.last_error={error:"nodata",plugin:"core",id:"core_06",reason:"Could not load node",data:JSON.stringify({id:t.id})},this.settings.core.error.call(this,this._data.core.last_error),n.call(this,!1)):n.call(this,!1):"#"===t.id?this._append_html_data(t,this._data.core.original_container_html.clone(!0),function(e){n.call(this,e)}):n.call(this,!1)},_node_changed:function(e){(e=this.get_node(e))&&this._model.changed.push(e.id)},_append_html_data:function(t,n,i){t=this.get_node(t),t.children=[],t.children_d=[];var r,a,o,s=n.is("ul")?n.children():n,l=t.id,c=[],d=[],u=this._model.data,h=u[l],f=this._data.core.selected.length;for(s.each(e.proxy(function(t,n){(r=this._parse_model_from_html(e(n),l,h.parents.concat()))&&(c.push(r),d.push(r),u[r].children_d.length&&(d=d.concat(u[r].children_d)))},this)),h.children=c,h.children_d=d,a=0,o=h.parents.length;a<o;a++)u[h.parents[a]].children_d=u[h.parents[a]].children_d.concat(d);this.trigger("model",{nodes:d,parent:l}),"#"!==l?(this._node_changed(l),this.redraw()):(this.get_container_ul().children(".jstree-initial-node").remove(),this.redraw(!0)),this._data.core.selected.length!==f&&this.trigger("changed",{action:"model",selected:this._data.core.selected}),i.call(this,!0)},_append_json_data:function(t,n,i){t=this.get_node(t),t.children=[],t.children_d=[],n.d&&"string"==typeof(n=n.d)&&(n=JSON.parse(n)),e.isArray(n)||(n=[n]);var r=null,a={df:this._model.default_state,dat:n,par:t.id,m:this._model.data,t_id:this._id,t_cnt:this._cnt,sel:this._data.core.selected},o=function(e,t){e.data&&(e=e.data);var n,i,r,a,o=e.dat,s=e.par,l=[],c=[],d=[],u=e.df,h=e.t_id,f=e.t_cnt,p=e.m,_=p[s],g=e.sel,m=function(e,n,i){i=i?i.concat():[],n&&i.unshift(n);var r,a,o,s,l=e.id.toString(),c={id:l,text:e.text||"",icon:e.icon===t||e.icon,parent:n,parents:i,children:e.children||[],children_d:e.children_d||[],data:e.data,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(r in u)u.hasOwnProperty(r)&&(c.state[r]=u[r]);if(e&&e.data&&e.data.jstree&&e.data.jstree.icon&&(c.icon=e.data.jstree.icon),e&&e.data&&(c.data=e.data,e.data.jstree))for(r in e.data.jstree)e.data.jstree.hasOwnProperty(r)&&(c.state[r]=e.data.jstree[r]);if(e&&"object"==typeof e.state)for(r in e.state)e.state.hasOwnProperty(r)&&(c.state[r]=e.state[r]);if(e&&"object"==typeof e.li_attr)for(r in e.li_attr)e.li_attr.hasOwnProperty(r)&&(c.li_attr[r]=e.li_attr[r]);if(c.li_attr.id||(c.li_attr.id=l),e&&"object"==typeof e.a_attr)for(r in e.a_attr)e.a_attr.hasOwnProperty(r)&&(c.a_attr[r]=e.a_attr[r]);for(e&&e.children&&!0===e.children&&(c.state.loaded=!1,c.children=[],c.children_d=[]),p[c.id]=c,r=0,a=c.children.length;r<a;r++)o=m(p[c.children[r]],c.id,i),s=p[o],c.children_d.push(o),s.children_d.length&&(c.children_d=c.children_d.concat(s.children_d));return delete e.data,delete e.children,p[c.id].original=e,c.state.selected&&d.push(c.id),c.id},v=function(e,n,i){i=i?i.concat():[],n&&i.unshift(n);var r,a,o,s,l,c=!1;do{c="j"+h+"_"+ ++f}while(p[c]);l={id:!1,text:"string"==typeof e?e:"",icon:"object"!=typeof e||e.icon===t||e.icon,parent:n,parents:i,children:[],children_d:[],data:null,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(r in u)u.hasOwnProperty(r)&&(l.state[r]=u[r]);if(e&&e.id&&(l.id=e.id.toString()),e&&e.text&&(l.text=e.text),e&&e.data&&e.data.jstree&&e.data.jstree.icon&&(l.icon=e.data.jstree.icon),e&&e.data&&(l.data=e.data,e.data.jstree))for(r in e.data.jstree)e.data.jstree.hasOwnProperty(r)&&(l.state[r]=e.data.jstree[r]);if(e&&"object"==typeof e.state)for(r in e.state)e.state.hasOwnProperty(r)&&(l.state[r]=e.state[r]);if(e&&"object"==typeof e.li_attr)for(r in e.li_attr)e.li_attr.hasOwnProperty(r)&&(l.li_attr[r]=e.li_attr[r]);if(l.li_attr.id&&!l.id&&(l.id=l.li_attr.id.toString()),l.id||(l.id=c),l.li_attr.id||(l.li_attr.id=l.id),e&&"object"==typeof e.a_attr)for(r in e.a_attr)e.a_attr.hasOwnProperty(r)&&(l.a_attr[r]=e.a_attr[r]);if(e&&e.children&&e.children.length){for(r=0,a=e.children.length;r<a;r++)o=v(e.children[r],l.id,i),s=p[o],l.children.push(o),s.children_d.length&&(l.children_d=l.children_d.concat(s.children_d));l.children_d=l.children_d.concat(l.children)}return e&&e.children&&!0===e.children&&(l.state.loaded=!1,l.children=[],l.children_d=[]),delete e.data,delete e.children,l.original=e,p[l.id]=l,l.state.selected&&d.push(l.id),l.id};if(o.length&&o[0].id!==t&&o[0].parent!==t){for(i=0,r=o.length;i<r;i++)o[i].children||(o[i].children=[]),p[o[i].id.toString()]=o[i];for(i=0,r=o.length;i<r;i++)p[o[i].parent.toString()].children.push(o[i].id.toString()),_.children_d.push(o[i].id.toString());for(i=0,r=_.children.length;i<r;i++)n=m(p[_.children[i]],s,_.parents.concat()),c.push(n),p[n].children_d.length&&(c=c.concat(p[n].children_d));for(i=0,r=_.parents.length;i<r;i++)p[_.parents[i]].children_d=p[_.parents[i]].children_d.concat(c);a={cnt:f,mod:p,sel:g,par:s,dpc:c,add:d}}else{for(i=0,r=o.length;i<r;i++)(n=v(o[i],s,_.parents.concat()))&&(l.push(n),c.push(n),p[n].children_d.length&&(c=c.concat(p[n].children_d)));for(_.children=l,_.children_d=c,i=0,r=_.parents.length;i<r;i++)p[_.parents[i]].children_d=p[_.parents[i]].children_d.concat(c);a={cnt:f,mod:p,sel:g,par:s,dpc:c,add:d}}return a},s=function(t,n){if(this._cnt=t.cnt,this._model.data=t.mod,n){var r,a,o=t.add,s=t.sel,l=this._data.core.selected.slice(),c=this._model.data;if(s.length!==l.length||e.vakata.array_unique(s.concat(l)).length!==s.length){for(r=0,a=s.length;r<a;r++)-1===e.inArray(s[r],o)&&-1===e.inArray(s[r],l)&&(c[s[r]].state.selected=!1);for(r=0,a=l.length;r<a;r++)-1===e.inArray(l[r],s)&&(c[l[r]].state.selected=!0)}}t.add.length&&(this._data.core.selected=this._data.core.selected.concat(t.add)),this.trigger("model",{nodes:t.dpc,parent:t.par}),"#"!==t.par?(this._node_changed(t.par),this.redraw()):this.redraw(!0),t.add.length&&this.trigger("changed",{action:"model",selected:this._data.core.selected}),i.call(this,!0)};if(this.settings.core.worker&&window.Blob&&window.URL&&window.Worker)try{null===this._wrk&&(this._wrk=window.URL.createObjectURL(new window.Blob(["self.onmessage = "+o.toString().replace(/return ([^;}]+)[\s;}]+$/,"postMessage($1);}")],{type:"text/javascript"}))),r=new window.Worker(this._wrk),r.onmessage=e.proxy(function(e){s.call(this,e.data,!0),this._data.core.working=!1,this._data.core.worker_queue.length&&this._append_json_data.apply(this,this._data.core.worker_queue.shift())},this),this._data.core.working?this._data.core.worker_queue.push([t,n,i]):(this._data.core.working=!0,r.postMessage(a))}catch(e){s.call(this,o(a),!1)}else s.call(this,o(a),!1)},_parse_model_from_html:function(t,n,i){i=i?[].concat(i):[],n&&i.unshift(n);var r,a,o,s,l,c=this._model.data,d={id:!1,text:!1,icon:!0,parent:n,parents:i,children:[],children_d:[],data:null,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(o in this._model.default_state)this._model.default_state.hasOwnProperty(o)&&(d.state[o]=this._model.default_state[o]);if(s=e.vakata.attributes(t,!0),e.each(s,function(t,n){if(n=e.trim(n),!n.length)return!0;d.li_attr[t]=n,"id"===t&&(d.id=n.toString())}),s=t.children("a").eq(0),s.length&&(s=e.vakata.attributes(s,!0),e.each(s,function(t,n){n=e.trim(n),n.length&&(d.a_attr[t]=n)})),s=t.children("a:eq(0)").length?t.children("a:eq(0)").clone():t.clone(),s.children("ins, i, ul").remove(),s=s.html(),s=e("<div />").html(s),d.text=this.settings.core.force_text?s.text():s.html(),s=t.data(),d.data=s?e.extend(!0,{},s):null,d.state.opened=t.hasClass("jstree-open"),d.state.selected=t.children("a").hasClass("jstree-clicked"),d.state.disabled=t.children("a").hasClass("jstree-disabled"),d.data&&d.data.jstree)for(o in d.data.jstree)d.data.jstree.hasOwnProperty(o)&&(d.state[o]=d.data.jstree[o]);s=t.children("a").children(".jstree-themeicon"),s.length&&(d.icon=!s.hasClass("jstree-themeicon-hidden")&&s.attr("rel")),d.state.icon&&(d.icon=d.state.icon),s=t.children("ul").children("li");do{l="j"+this._id+"_"+ ++this._cnt}while(c[l]);return d.id=d.li_attr.id?d.li_attr.id.toString():l,s.length?(s.each(e.proxy(function(t,n){r=this._parse_model_from_html(e(n),d.id,i),a=this._model.data[r],d.children.push(r),a.children_d.length&&(d.children_d=d.children_d.concat(a.children_d))},this)),d.children_d=d.children_d.concat(d.children)):t.hasClass("jstree-closed")&&(d.state.loaded=!1),d.li_attr.class&&(d.li_attr.class=d.li_attr.class.replace("jstree-closed","").replace("jstree-open","")),d.a_attr.class&&(d.a_attr.class=d.a_attr.class.replace("jstree-clicked","").replace("jstree-disabled","")),c[d.id]=d,d.state.selected&&this._data.core.selected.push(d.id),d.id},_parse_model_from_flat_json:function(e,n,i){i=i?i.concat():[],n&&i.unshift(n);var r,a,o,s,l=e.id.toString(),c=this._model.data,d=this._model.default_state,u={id:l,text:e.text||"",icon:e.icon===t||e.icon,parent:n,parents:i,children:e.children||[],children_d:e.children_d||[],data:e.data,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(r in d)d.hasOwnProperty(r)&&(u.state[r]=d[r]);if(e&&e.data&&e.data.jstree&&e.data.jstree.icon&&(u.icon=e.data.jstree.icon),e&&e.data&&(u.data=e.data,e.data.jstree))for(r in e.data.jstree)e.data.jstree.hasOwnProperty(r)&&(u.state[r]=e.data.jstree[r]);if(e&&"object"==typeof e.state)for(r in e.state)e.state.hasOwnProperty(r)&&(u.state[r]=e.state[r]);if(e&&"object"==typeof e.li_attr)for(r in e.li_attr)e.li_attr.hasOwnProperty(r)&&(u.li_attr[r]=e.li_attr[r]);if(u.li_attr.id||(u.li_attr.id=l),e&&"object"==typeof e.a_attr)for(r in e.a_attr)e.a_attr.hasOwnProperty(r)&&(u.a_attr[r]=e.a_attr[r]);for(e&&e.children&&!0===e.children&&(u.state.loaded=!1,u.children=[],u.children_d=[]),c[u.id]=u,r=0,a=u.children.length;r<a;r++)o=this._parse_model_from_flat_json(c[u.children[r]],u.id,i),s=c[o],u.children_d.push(o),s.children_d.length&&(u.children_d=u.children_d.concat(s.children_d));return delete e.data,delete e.children,c[u.id].original=e,u.state.selected&&this._data.core.selected.push(u.id),u.id},_parse_model_from_json:function(e,n,i){i=i?i.concat():[],n&&i.unshift(n);var r,a,o,s,l,c=!1,d=this._model.data,u=this._model.default_state;do{c="j"+this._id+"_"+ ++this._cnt}while(d[c]);l={id:!1,text:"string"==typeof e?e:"",icon:"object"!=typeof e||e.icon===t||e.icon,parent:n,parents:i,children:[],children_d:[],data:null,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(r in u)u.hasOwnProperty(r)&&(l.state[r]=u[r]);if(e&&e.id&&(l.id=e.id.toString()),e&&e.text&&(l.text=e.text),e&&e.data&&e.data.jstree&&e.data.jstree.icon&&(l.icon=e.data.jstree.icon),e&&e.data&&(l.data=e.data,e.data.jstree))for(r in e.data.jstree)e.data.jstree.hasOwnProperty(r)&&(l.state[r]=e.data.jstree[r]);if(e&&"object"==typeof e.state)for(r in e.state)e.state.hasOwnProperty(r)&&(l.state[r]=e.state[r]);if(e&&"object"==typeof e.li_attr)for(r in e.li_attr)e.li_attr.hasOwnProperty(r)&&(l.li_attr[r]=e.li_attr[r]);if(l.li_attr.id&&!l.id&&(l.id=l.li_attr.id.toString()),l.id||(l.id=c),l.li_attr.id||(l.li_attr.id=l.id),e&&"object"==typeof e.a_attr)for(r in e.a_attr)e.a_attr.hasOwnProperty(r)&&(l.a_attr[r]=e.a_attr[r]);if(e&&e.children&&e.children.length){for(r=0,a=e.children.length;r<a;r++)o=this._parse_model_from_json(e.children[r],l.id,i),s=d[o],l.children.push(o),s.children_d.length&&(l.children_d=l.children_d.concat(s.children_d));l.children_d=l.children_d.concat(l.children)}return e&&e.children&&!0===e.children&&(l.state.loaded=!1,l.children=[],l.children_d=[]),delete e.data,delete e.children,l.original=e,d[l.id]=l,l.state.selected&&this._data.core.selected.push(l.id),l.id},_redraw:function(){var e,t,n,i=this._model.force_full_redraw?this._model.data["#"].children.concat([]):this._model.changed.concat([]),r=document.createElement("UL");for(t=0,n=i.length;t<n;t++)(e=this.redraw_node(i[t],!0,this._model.force_full_redraw))&&this._model.force_full_redraw&&r.appendChild(e);this._model.force_full_redraw&&(r.className=this.get_container_ul()[0].className,this.element.empty().append(r)),this._model.force_full_redraw=!1,this._model.changed=[],this.trigger("redraw",{nodes:i})},redraw:function(e){e&&(this._model.force_full_redraw=!0),this._redraw()},redraw_node:function(t,n,i){var r=this.get_node(t),a=!1,o=!1,s=!1,l=!1,c=!1,d=!1,h="",f=document,p=this._model.data,_=!1,g=!1,m=null;if(!r)return!1;if("#"===r.id)return this.redraw(!0);if(n=n||0===r.children.length,t=document.querySelector?this.element[0].querySelector("#"+(-1!=="0123456789".indexOf(r.id[0])?"\\3"+r.id[0]+" "+r.id.substr(1).replace(e.jstree.idregex,"\\$&"):r.id.replace(e.jstree.idregex,"\\$&"))):document.getElementById(r.id))t=e(t),i||(a=t.parent().parent()[0],a===this.element[0]&&(a=null),o=t.index()),n||!r.children.length||t.children(".jstree-children").length||(n=!0),n||(s=t.children(".jstree-children")[0]),g=t.attr("aria-selected"),_=t.children(".jstree-anchor")[0]===document.activeElement,t.remove();else if(n=!0,!i){if(!(null===(a="#"!==r.parent?e("#"+r.parent.replace(e.jstree.idregex,"\\$&"),this.element)[0]:null)||a&&p[r.parent].state.opened))return!1;o=e.inArray(r.id,null===a?p["#"].children:p[r.parent].children)}t=u.cloneNode(!0),h="jstree-node ";for(l in r.li_attr)if(r.li_attr.hasOwnProperty(l)){if("id"===l)continue;"class"!==l?t.setAttribute(l,r.li_attr[l]):h+=r.li_attr[l]}g&&"false"!==g&&t.setAttribute("aria-selected",!0),r.state.loaded&&!r.children.length?h+=" jstree-leaf":(h+=r.state.opened&&r.state.loaded?" jstree-open":" jstree-closed",t.setAttribute("aria-expanded",r.state.opened&&r.state.loaded)),null!==r.parent&&p[r.parent].children[p[r.parent].children.length-1]===r.id&&(h+=" jstree-last"),t.id=r.id,t.className=h,h=(r.state.selected?" jstree-clicked":"")+(r.state.disabled?" jstree-disabled":"");for(c in r.a_attr)if(r.a_attr.hasOwnProperty(c)){if("href"===c&&"#"===r.a_attr[c])continue;"class"!==c?t.childNodes[1].setAttribute(c,r.a_attr[c]):h+=" "+r.a_attr[c]}if(h.length&&(t.childNodes[1].className="jstree-anchor "+h),(r.icon&&!0!==r.icon||!1===r.icon)&&(!1===r.icon?t.childNodes[1].childNodes[0].className+=" jstree-themeicon-hidden":-1===r.icon.indexOf("/")&&-1===r.icon.indexOf(".")?t.childNodes[1].childNodes[0].className+=" "+r.icon+" jstree-themeicon-custom":(t.childNodes[1].childNodes[0].style.backgroundImage="url("+r.icon+")",t.childNodes[1].childNodes[0].style.backgroundPosition="center center",t.childNodes[1].childNodes[0].style.backgroundSize="auto",t.childNodes[1].childNodes[0].className+=" jstree-themeicon-custom")),this.settings.core.force_text?t.childNodes[1].appendChild(f.createTextNode(r.text)):t.childNodes[1].innerHTML+=r.text,n&&r.children.length&&r.state.opened&&r.state.loaded){for(d=f.createElement("UL"),d.setAttribute("role","group"),d.className="jstree-children",l=0,c=r.children.length;l<c;l++)d.appendChild(this.redraw_node(r.children[l],n,!0));t.appendChild(d)}if(s&&t.appendChild(s),!i){for(a||(a=this.element[0]),l=0,c=a.childNodes.length;l<c;l++)if(a.childNodes[l]&&a.childNodes[l].className&&-1!==a.childNodes[l].className.indexOf("jstree-children")){m=a.childNodes[l];break}m||(m=f.createElement("UL"),m.setAttribute("role","group"),m.className="jstree-children",a.appendChild(m)),a=m,o<a.childNodes.length?a.insertBefore(t,a.childNodes[o]):a.appendChild(t),_&&t.childNodes[1].focus()}return r.state.opened&&!r.state.loaded&&(r.state.opened=!1,setTimeout(e.proxy(function(){this.open_node(r.id,!1,0)},this),0)),t},open_node:function(n,i,r){var a,o,s,l;if(e.isArray(n)){for(n=n.slice(),a=0,o=n.length;a<o;a++)this.open_node(n[a],i,r);return!0}if(!(n=this.get_node(n))||"#"===n.id)return!1;if(r=r===t?this.settings.core.animation:r,!this.is_closed(n))return i&&i.call(this,n,!1),!1;if(this.is_loaded(n))s=this.get_node(n,!0),l=this,s.length&&(n.children.length&&!this._firstChild(s.children(".jstree-children")[0])&&(n.state.opened=!0,this.redraw_node(n,!0),s=this.get_node(n,!0)),r?(this.trigger("before_open",{node:n}),s.children(".jstree-children").css("display","none").end().removeClass("jstree-closed").addClass("jstree-open").attr("aria-expanded",!0).children(".jstree-children").stop(!0,!0).slideDown(r,function(){this.style.display="",l.trigger("after_open",{node:n})})):(this.trigger("before_open",{node:n}),s[0].className=s[0].className.replace("jstree-closed","jstree-open"),s[0].setAttribute("aria-expanded",!0))),n.state.opened=!0,i&&i.call(this,n,!0),s.length||this.trigger("before_open",{node:n}),this.trigger("open_node",{node:n}),r&&s.length||this.trigger("after_open",{node:n});else{if(this.is_loading(n))return setTimeout(e.proxy(function(){this.open_node(n,i,r)},this),500);this.load_node(n,function(e,t){return t?this.open_node(e,i,r):!!i&&i.call(this,e,!1)})}},_open_to:function(t){if(!(t=this.get_node(t))||"#"===t.id)return!1;var n,i,r=t.parents;for(n=0,i=r.length;n<i;n+=1)"#"!==n&&this.open_node(r[n],!1,0);return e("#"+t.id.replace(e.jstree.idregex,"\\$&"),this.element)},close_node:function(n,i){var r,a,o,s;if(e.isArray(n)){for(n=n.slice(),r=0,a=n.length;r<a;r++)this.close_node(n[r],i);return!0}return!(!(n=this.get_node(n))||"#"===n.id)&&(!this.is_closed(n)&&(i=i===t?this.settings.core.animation:i,o=this,s=this.get_node(n,!0),s.length&&(i?s.children(".jstree-children").attr("style","display:block !important").end().removeClass("jstree-open").addClass("jstree-closed").attr("aria-expanded",!1).children(".jstree-children").stop(!0,!0).slideUp(i,function(){this.style.display="",s.children(".jstree-children").remove(),o.trigger("after_close",{node:n})}):(s[0].className=s[0].className.replace("jstree-open","jstree-closed"),s.attr("aria-expanded",!1).children(".jstree-children").remove())),n.state.opened=!1,this.trigger("close_node",{node:n}),void(i&&s.length||this.trigger("after_close",{node:n}))))},toggle_node:function(t){var n,i;if(e.isArray(t)){for(t=t.slice(),n=0,i=t.length;n<i;n++)this.toggle_node(t[n]);return!0}return this.is_closed(t)?this.open_node(t):this.is_open(t)?this.close_node(t):void 0},open_all:function(e,t,n){if(e||(e="#"),!(e=this.get_node(e)))return!1;var i,r,a,o="#"===e.id?this.get_container_ul():this.get_node(e,!0);if(!o.length){for(i=0,r=e.children_d.length;i<r;i++)this.is_closed(this._model.data[e.children_d[i]])&&(this._model.data[e.children_d[i]].state.opened=!0);return this.trigger("open_all",{node:e})}n=n||o,a=this,o=this.is_closed(e)?o.find(".jstree-closed").addBack():o.find(".jstree-closed"),o.each(function(){a.open_node(this,function(e,i){i&&this.is_parent(e)&&this.open_all(e,t,n)},t||0)}),0===n.find(".jstree-closed").length&&this.trigger("open_all",{node:this.get_node(n)})},close_all:function(t,n){if(t||(t="#"),!(t=this.get_node(t)))return!1;var i,r,a="#"===t.id?this.get_container_ul():this.get_node(t,!0),o=this;if(!a.length){for(i=0,r=t.children_d.length;i<r;i++)this._model.data[t.children_d[i]].state.opened=!1;return this.trigger("close_all",{node:t})}a=this.is_open(t)?a.find(".jstree-open").addBack():a.find(".jstree-open"),e(a.get().reverse()).each(function(){o.close_node(this,n||0)}),this.trigger("close_all",{node:t})},is_disabled:function(e){return(e=this.get_node(e))&&e.state&&e.state.disabled},enable_node:function(t){var n,i;if(e.isArray(t)){for(t=t.slice(),n=0,i=t.length;n<i;n++)this.enable_node(t[n]);return!0}if(!(t=this.get_node(t))||"#"===t.id)return!1;t.state.disabled=!1,this.get_node(t,!0).children(".jstree-anchor").removeClass("jstree-disabled"),this.trigger("enable_node",{node:t})},disable_node:function(t){var n,i;if(e.isArray(t)){for(t=t.slice(),n=0,i=t.length;n<i;n++)this.disable_node(t[n]);return!0}if(!(t=this.get_node(t))||"#"===t.id)return!1;t.state.disabled=!0,this.get_node(t,!0).children(".jstree-anchor").addClass("jstree-disabled"),this.trigger("disable_node",{node:t})},activate_node:function(e,n){if(this.is_disabled(e))return!1;if(this._data.core.last_clicked=this._data.core.last_clicked&&this._data.core.last_clicked.id!==t?this.get_node(this._data.core.last_clicked.id):null,this._data.core.last_clicked&&!this._data.core.last_clicked.state.selected&&(this._data.core.last_clicked=null),!this._data.core.last_clicked&&this._data.core.selected.length&&(this._data.core.last_clicked=this.get_node(this._data.core.selected[this._data.core.selected.length-1])),this.settings.core.multiple&&(n.metaKey||n.ctrlKey||n.shiftKey)&&(!n.shiftKey||this._data.core.last_clicked&&this.get_parent(e)&&this.get_parent(e)===this._data.core.last_clicked.parent))if(n.shiftKey){var i,r,a=this.get_node(e).id,o=this._data.core.last_clicked.id,s=this.get_node(this._data.core.last_clicked.parent).children,l=!1;for(i=0,r=s.length;i<r;i+=1)s[i]===a&&(l=!l),s[i]===o&&(l=!l),l||s[i]===a||s[i]===o?this.select_node(s[i],!1,!1,n):this.deselect_node(s[i],!1,n)}else this.is_selected(e)?this.deselect_node(e,!1,n):this.select_node(e,!1,!1,n);else!this.settings.core.multiple&&(n.metaKey||n.ctrlKey||n.shiftKey)&&this.is_selected(e)?this.deselect_node(e,!1,n):(this.deselect_all(!0),this.select_node(e,!1,!1,n),this._data.core.last_clicked=this.get_node(e));this.trigger("activate_node",{node:this.get_node(e)})},hover_node:function(e){if(!(e=this.get_node(e,!0))||!e.length||e.children(".jstree-hovered").length)return!1;var t=this.element.find(".jstree-hovered"),n=this.element;t&&t.length&&this.dehover_node(t),e.children(".jstree-anchor").addClass("jstree-hovered"),this.trigger("hover_node",{node:this.get_node(e)}),setTimeout(function(){n.attr("aria-activedescendant",e[0].id),e.attr("aria-selected",!0)},0)},dehover_node:function(e){if(!(e=this.get_node(e,!0))||!e.length||!e.children(".jstree-hovered").length)return!1;e.attr("aria-selected",!1).children(".jstree-anchor").removeClass("jstree-hovered"),this.trigger("dehover_node",{node:this.get_node(e)})},select_node:function(t,n,i,r){var a,o,s;if(e.isArray(t)){for(t=t.slice(),o=0,s=t.length;o<s;o++)this.select_node(t[o],n,i,r);return!0}if(!(t=this.get_node(t))||"#"===t.id)return!1;a=this.get_node(t,!0),t.state.selected||(t.state.selected=!0,this._data.core.selected.push(t.id),i||(a=this._open_to(t)),a&&a.length&&a.children(".jstree-anchor").addClass("jstree-clicked"),this.trigger("select_node",{node:t,selected:this._data.core.selected,event:r}),n||this.trigger("changed",{action:"select_node",node:t,selected:this._data.core.selected,event:r}))},deselect_node:function(t,n,i){var r,a,o;if(e.isArray(t)){for(t=t.slice(),r=0,a=t.length;r<a;r++)this.deselect_node(t[r],n,i);return!0}if(!(t=this.get_node(t))||"#"===t.id)return!1;o=this.get_node(t,!0),t.state.selected&&(t.state.selected=!1,this._data.core.selected=e.vakata.array_remove_item(this._data.core.selected,t.id),o.length&&o.children(".jstree-anchor").removeClass("jstree-clicked"),this.trigger("deselect_node",{node:t,selected:this._data.core.selected,event:i}),n||this.trigger("changed",{action:"deselect_node",node:t,selected:this._data.core.selected,event:i}))},select_all:function(e){var t,n,i=this._data.core.selected.concat([]);for(this._data.core.selected=this._model.data["#"].children_d.concat(),t=0,n=this._data.core.selected.length;t<n;t++)this._model.data[this._data.core.selected[t]]&&(this._model.data[this._data.core.selected[t]].state.selected=!0);this.redraw(!0),this.trigger("select_all",{selected:this._data.core.selected}),e||this.trigger("changed",{action:"select_all",selected:this._data.core.selected,old_selection:i})},deselect_all:function(e){var t,n,i=this._data.core.selected.concat([]);for(t=0,n=this._data.core.selected.length;t<n;t++)this._model.data[this._data.core.selected[t]]&&(this._model.data[this._data.core.selected[t]].state.selected=!1);this._data.core.selected=[],this.element.find(".jstree-clicked").removeClass("jstree-clicked"),this.trigger("deselect_all",{selected:this._data.core.selected,node:i}),e||this.trigger("changed",{action:"deselect_all",selected:this._data.core.selected,old_selection:i})},is_selected:function(e){return!(!(e=this.get_node(e))||"#"===e.id)&&e.state.selected},get_selected:function(t){return t?e.map(this._data.core.selected,e.proxy(function(e){return this.get_node(e)},this)):this._data.core.selected.slice()},get_top_selected:function(t){var n,i,r,a,o=this.get_selected(!0),s={};for(n=0,i=o.length;n<i;n++)s[o[n].id]=o[n];for(n=0,i=o.length;n<i;n++)for(r=0,a=o[n].children_d.length;r<a;r++)s[o[n].children_d[r]]&&delete s[o[n].children_d[r]];o=[];for(n in s)s.hasOwnProperty(n)&&o.push(n);return t?e.map(o,e.proxy(function(e){return this.get_node(e)},this)):o},get_bottom_selected:function(t){var n,i,r=this.get_selected(!0),a=[];for(n=0,i=r.length;n<i;n++)r[n].children.length||a.push(r[n].id);return t?e.map(a,e.proxy(function(e){return this.get_node(e)},this)):a},get_state:function(){var e,t={core:{open:[],scroll:{left:this.element.scrollLeft(),top:this.element.scrollTop()},/*!
					'themes' : {
						'name' : this.get_theme(),
						'icons' : this._data.core.themes.icons,
						'dots' : this._data.core.themes.dots
					},
					*/
selected:[]}};for(e in this._model.data)this._model.data.hasOwnProperty(e)&&"#"!==e&&(this._model.data[e].state.opened&&t.core.open.push(e),this._model.data[e].state.selected&&t.core.selected.push(e));return t},set_state:function(n,i){if(n){if(n.core){var r,a,o,s;if(n.core.open)return e.isArray(n.core.open)?(r=!0,a=!1,o=this,e.each(n.core.open.concat([]),function(t,s){(a=o.get_node(s))&&(o.is_loaded(s)?(o.is_closed(s)&&o.open_node(s,!1,0),n&&n.core&&n.core.open&&e.vakata.array_remove_item(n.core.open,s)):(o.is_loading(s)||o.open_node(s,e.proxy(function(t,r){!r&&n&&n.core&&n.core.open&&e.vakata.array_remove_item(n.core.open,t.id),this.set_state(n,i)},o),0),r=!1))}),r&&(delete n.core.open,this.set_state(n,i)),!1):(delete n.core.open,this.set_state(n,i),!1);if(n.core.scroll)return n.core.scroll&&n.core.scroll.left!==t&&this.element.scrollLeft(n.core.scroll.left),n.core.scroll&&n.core.scroll.top!==t&&this.element.scrollTop(n.core.scroll.top),delete n.core.scroll,this.set_state(n,i),!1;/*!
					if(state.core.themes) {
						if(state.core.themes.name) {
							this.set_theme(state.core.themes.name);
						}
						if(typeof state.core.themes.dots !== 'undefined') {
							this[ state.core.themes.dots ? "show_dots" : "hide_dots" ]();
						}
						if(typeof state.core.themes.icons !== 'undefined') {
							this[ state.core.themes.icons ? "show_icons" : "hide_icons" ]();
						}
						delete state.core.themes;
						delete state.core.open;
						this.set_state(state, callback);
						return false;
					}
					*/
if(n.core.selected)return s=this,this.deselect_all(),e.each(n.core.selected,function(e,t){s.select_node(t)}),delete n.core.selected,this.set_state(n,i),!1;if(e.isEmptyObject(n.core))return delete n.core,this.set_state(n,i),!1}return!e.isEmptyObject(n)||(n=null,i&&i.call(this),this.trigger("set_state"),!1)}return!1},refresh:function(t,n){this._data.core.state=!0===n?{}:this.get_state(),n&&e.isFunction(n)&&(this._data.core.state=n.call(this,this._data.core.state)),this._cnt=0,this._model.data={"#":{id:"#",parent:null,parents:[],children:[],children_d:[],state:{loaded:!1}}};var i=this.get_container_ul()[0].className;t||this.element.html("<ul class='"+i+"'><li class='jstree-initial-node jstree-loading jstree-leaf jstree-last'><i class='jstree-icon jstree-ocl'></i><a class='jstree-anchor' href='#'><i class='jstree-icon jstree-themeicon-hidden'></i>"+this.get_string("Loading ...")+"</a></li></ul>"),this.load_node("#",function(t,n){n&&(this.get_container_ul()[0].className=i,this.set_state(e.extend(!0,{},this._data.core.state),function(){this.trigger("refresh")})),this._data.core.state=null})},refresh_node:function(t){if(!(t=this.get_node(t))||"#"===t.id)return!1;var n=[],i=[];this._data.core.selected.concat([]);i.push(t.id),!0===t.state.opened&&n.push(t.id),this.get_node(t,!0).find(".jstree-open").each(function(){n.push(this.id)}),this._load_nodes(i,e.proxy(function(e){this.open_node(n,!1,0),this.select_node(this._data.core.selected),this.trigger("refresh_node",{node:t,nodes:e})},this))},set_id:function(t,n){if(!(t=this.get_node(t))||"#"===t.id)return!1;var i,r,a=this._model.data;for(n=n.toString(),a[t.parent].children[e.inArray(t.id,a[t.parent].children)]=n,i=0,r=t.parents.length;i<r;i++)a[t.parents[i]].children_d[e.inArray(t.id,a[t.parents[i]].children_d)]=n;for(i=0,r=t.children.length;i<r;i++)a[t.children[i]].parent=n;for(i=0,r=t.children_d.length;i<r;i++)a[t.children_d[i]].parents[e.inArray(t.id,a[t.children_d[i]].parents)]=n;return i=e.inArray(t.id,this._data.core.selected),-1!==i&&(this._data.core.selected[i]=n),i=this.get_node(t.id,!0),i&&i.attr("id",n),delete a[t.id],t.id=n,a[n]=t,!0},get_text:function(e){return!(!(e=this.get_node(e))||"#"===e.id)&&e.text},set_text:function(t,n){var i,r;if(e.isArray(t)){for(t=t.slice(),i=0,r=t.length;i<r;i++)this.set_text(t[i],n);return!0}return!(!(t=this.get_node(t))||"#"===t.id)&&(t.text=n,this.get_node(t,!0).length&&this.redraw_node(t.id),this.trigger("set_text",{obj:t,text:n}),!0)},get_json:function(e,t,n){if(!(e=this.get_node(e||"#")))return!1;t&&t.flat&&!n&&(n=[]);var i,r,a={id:e.id,text:e.text,icon:this.get_icon(e),li_attr:e.li_attr,a_attr:e.a_attr,state:{},data:(!t||!t.no_data)&&e.data};if(t&&t.flat?a.parent=e.parent:a.children=[],!t||!t.no_state)for(i in e.state)e.state.hasOwnProperty(i)&&(a.state[i]=e.state[i]);if(t&&t.no_id&&(delete a.id,a.li_attr&&a.li_attr.id&&delete a.li_attr.id),t&&t.flat&&"#"!==e.id&&n.push(a),!t||!t.no_children)for(i=0,r=e.children.length;i<r;i++)t&&t.flat?this.get_json(e.children[i],t,n):a.children.push(this.get_json(e.children[i],t));return t&&t.flat?n:"#"===e.id?a.children:a},create_node:function(n,i,r,a,o){if(null===n&&(n="#"),!(n=this.get_node(n)))return!1;if(r=r===t?"last":r,!r.toString().match(/^(before|after)$/)&&!o&&!this.is_loaded(n))return this.load_node(n,function(){this.create_node(n,i,r,a,!0)});i||(i={text:this.get_string("New node")}),i.text===t&&(i.text=this.get_string("New node"));var s,l,c,d;switch("#"===n.id&&("before"===r&&(r="first"),"after"===r&&(r="last")),r){case"before":s=this.get_node(n.parent),r=e.inArray(n.id,s.children),n=s;break;case"after":s=this.get_node(n.parent),r=e.inArray(n.id,s.children)+1,n=s;break;case"inside":case"first":r=0;break;case"last":r=n.children.length;break;default:r||(r=0)}if(r>n.children.length&&(r=n.children.length),i.id||(i.id=!0),!this.check("create_node",i,n,r))return this.settings.core.error.call(this,this._data.core.last_error),!1;if(!0===i.id&&delete i.id,!(i=this._parse_model_from_json(i,n.id,n.parents.concat())))return!1;for(s=this.get_node(i),l=[],l.push(i),l=l.concat(s.children_d),this.trigger("model",{nodes:l,parent:n.id}),n.children_d=n.children_d.concat(l),c=0,d=n.parents.length;c<d;c++)this._model.data[n.parents[c]].children_d=this._model.data[n.parents[c]].children_d.concat(l);for(i=s,s=[],c=0,d=n.children.length;c<d;c++)s[c>=r?c+1:c]=n.children[c];return s[r]=i.id,n.children=s,this.redraw_node(n,!0),a&&a.call(this,this.get_node(i)),this.trigger("create_node",{node:this.get_node(i),parent:n.id,position:r}),i.id},rename_node:function(t,n){var i,r,a;if(e.isArray(t)){for(t=t.slice(),i=0,r=t.length;i<r;i++)this.rename_node(t[i],n);return!0}return!(!(t=this.get_node(t))||"#"===t.id)&&(a=t.text,this.check("rename_node",t,this.get_parent(t),n)?(this.set_text(t,n),this.trigger("rename_node",{node:t,text:n,old:a}),!0):(this.settings.core.error.call(this,this._data.core.last_error),!1))},delete_node:function(t){var n,i,r,a,o,s,l,c,d,u;if(e.isArray(t)){for(t=t.slice(),n=0,i=t.length;n<i;n++)this.delete_node(t[n]);return!0}if(!(t=this.get_node(t))||"#"===t.id)return!1;if(r=this.get_node(t.parent),a=e.inArray(t.id,r.children),u=!1,!this.check("delete_node",t,r,a))return this.settings.core.error.call(this,this._data.core.last_error),!1;for(-1!==a&&(r.children=e.vakata.array_remove(r.children,a)),o=t.children_d.concat([]),o.push(t.id),c=0,d=o.length;c<d;c++){for(s=0,l=t.parents.length;s<l;s++)-1!==(a=e.inArray(o[c],this._model.data[t.parents[s]].children_d))&&(this._model.data[t.parents[s]].children_d=e.vakata.array_remove(this._model.data[t.parents[s]].children_d,a));this._model.data[o[c]].state.selected&&(u=!0,-1!==(a=e.inArray(o[c],this._data.core.selected))&&(this._data.core.selected=e.vakata.array_remove(this._data.core.selected,a)))}for(this.trigger("delete_node",{node:t,parent:r.id}),u&&this.trigger("changed",{action:"delete_node",node:t,selected:this._data.core.selected,parent:r.id}),c=0,d=o.length;c<d;c++)delete this._model.data[o[c]];return this.redraw_node(r,!0),!0},check:function(t,n,i,r,a){n=n&&n.id?n:this.get_node(n),i=i&&i.id?i:this.get_node(i);var o=t.match(/^move_node|copy_node|create_node$/i)?i:n,s=this.settings.core.check_callback;return"move_node"!==t&&"copy_node"!==t||a&&a.is_multi||n.id!==i.id&&e.inArray(n.id,i.children)!==r&&-1===e.inArray(i.id,n.children_d)?(o&&o.data&&(o=o.data),o&&o.functions&&(!1===o.functions[t]||!0===o.functions[t])?(!1===o.functions[t]&&(this._data.core.last_error={error:"check",plugin:"core",id:"core_02",reason:"Node data prevents function: "+t,data:JSON.stringify({chk:t,pos:r,obj:!(!n||!n.id)&&n.id,par:!(!i||!i.id)&&i.id})}),o.functions[t]):!(!1===s||e.isFunction(s)&&!1===s.call(this,t,n,i,r,a)||s&&!1===s[t])||(this._data.core.last_error={error:"check",plugin:"core",id:"core_03",reason:"User config for core.check_callback prevents function: "+t,data:JSON.stringify({chk:t,pos:r,obj:!(!n||!n.id)&&n.id,par:!(!i||!i.id)&&i.id})},!1)):(this._data.core.last_error={error:"check",plugin:"core",id:"core_01",reason:"Moving parent inside child",data:JSON.stringify({chk:t,pos:r,obj:!(!n||!n.id)&&n.id,par:!(!i||!i.id)&&i.id})},!1)},last_error:function(){return this._data.core.last_error},move_node:function(n,i,r,a,o){var s,l,c,d,u,h,f,p,_,g,m,v,y,b;if(i=this.get_node(i),r=r===t?0:r,!i)return!1;if(!r.toString().match(/^(before|after)$/)&&!o&&!this.is_loaded(i))return this.load_node(i,function(){this.move_node(n,i,r,a,!0)});if(e.isArray(n)){for(n=n.reverse().slice(),s=0,l=n.length;s<l;s++)this.move_node(n[s],i,r,a,o);return!0}if(!(n=n&&n.id?n:this.get_node(n))||"#"===n.id)return!1;if(c=(n.parent||"#").toString(),u=r.toString().match(/^(before|after)$/)&&"#"!==i.id?this.get_node(i.parent):i,h=n.instance?n.instance:this._model.data[n.id]?this:e.jstree.reference(n.id),f=!h||!h._id||this._id!==h._id,d=h&&h._id&&c&&h._model.data[c]&&h._model.data[c].children?e.inArray(n.id,h._model.data[c].children):-1,f)return!!this.copy_node(n,i,r,a,o)&&(h&&h.delete_node(n),!0);switch("#"===u.id&&("before"===r&&(r="first"),"after"===r&&(r="last")),r){case"before":r=e.inArray(i.id,u.children);break;case"after":r=e.inArray(i.id,u.children)+1;break;case"inside":case"first":r=0;break;case"last":r=u.children.length;break;default:r||(r=0)}if(r>u.children.length&&(r=u.children.length),!this.check("move_node",n,u,r,{core:!0,is_multi:h&&h._id&&h._id!==this._id,is_foreign:!h||!h._id}))return this.settings.core.error.call(this,this._data.core.last_error),!1;if(n.parent===u.id){for(p=u.children.concat(),_=e.inArray(n.id,p),-1!==_&&(p=e.vakata.array_remove(p,_),r>_&&r--),_=[],g=0,m=p.length;g<m;g++)_[g>=r?g+1:g]=p[g];_[r]=n.id,u.children=_,this._node_changed(u.id),this.redraw("#"===u.id)}else{for(_=n.children_d.concat(),_.push(n.id),g=0,m=n.parents.length;g<m;g++){for(p=[],b=h._model.data[n.parents[g]].children_d,v=0,y=b.length;v<y;v++)-1===e.inArray(b[v],_)&&p.push(b[v]);h._model.data[n.parents[g]].children_d=p}for(h._model.data[c].children=e.vakata.array_remove_item(h._model.data[c].children,n.id),g=0,m=u.parents.length;g<m;g++)this._model.data[u.parents[g]].children_d=this._model.data[u.parents[g]].children_d.concat(_);for(p=[],g=0,m=u.children.length;g<m;g++)p[g>=r?g+1:g]=u.children[g];for(p[r]=n.id,u.children=p,u.children_d.push(n.id),u.children_d=u.children_d.concat(n.children_d),n.parent=u.id,_=u.parents.concat(),_.unshift(u.id),b=n.parents.length,n.parents=_,_=_.concat(),g=0,m=n.children_d.length;g<m;g++)this._model.data[n.children_d[g]].parents=this._model.data[n.children_d[g]].parents.slice(0,-1*b),Array.prototype.push.apply(this._model.data[n.children_d[g]].parents,_);this._node_changed(c),this._node_changed(u.id),this.redraw("#"===c||"#"===u.id)}return a&&a.call(this,n,u,r),this.trigger("move_node",{node:n,parent:u.id,position:r,old_parent:c,old_position:d,is_multi:h&&h._id&&h._id!==this._id,is_foreign:!h||!h._id,old_instance:h,new_instance:this}),!0},copy_node:function(n,i,r,a,o){var s,l,c,d,u,h,f,p,_,g;if(i=this.get_node(i),r=r===t?0:r,!i)return!1;if(!r.toString().match(/^(before|after)$/)&&!o&&!this.is_loaded(i))return this.load_node(i,function(){this.copy_node(n,i,r,a,!0)});if(e.isArray(n)){for(n=n.reverse().slice(),s=0,l=n.length;s<l;s++)this.copy_node(n[s],i,r,a,o);return!0}if(!(n=n&&n.id?n:this.get_node(n))||"#"===n.id)return!1;switch(p=(n.parent||"#").toString(),_=r.toString().match(/^(before|after)$/)&&"#"!==i.id?this.get_node(i.parent):i,g=n.instance?n.instance:this._model.data[n.id]?this:e.jstree.reference(n.id),!g||!g._id||this._id!==g._id,"#"===_.id&&("before"===r&&(r="first"),"after"===r&&(r="last")),r){case"before":r=e.inArray(i.id,_.children);break;case"after":r=e.inArray(i.id,_.children)+1;break;case"inside":case"first":r=0;break;case"last":r=_.children.length;break;default:r||(r=0)}if(r>_.children.length&&(r=_.children.length),!this.check("copy_node",n,_,r,{core:!0,is_multi:g&&g._id&&g._id!==this._id,is_foreign:!g||!g._id}))return this.settings.core.error.call(this,this._data.core.last_error),!1;if(!(f=g?g.get_json(n,{no_id:!0,no_data:!0,no_state:!0}):n))return!1;if(!0===f.id&&delete f.id,!(f=this._parse_model_from_json(f,_.id,_.parents.concat())))return!1;for(d=this.get_node(f),n&&n.state&&!1===n.state.loaded&&(d.state.loaded=!1),c=[],c.push(f),c=c.concat(d.children_d),this.trigger("model",{nodes:c,parent:_.id}),u=0,h=_.parents.length;u<h;u++)this._model.data[_.parents[u]].children_d=this._model.data[_.parents[u]].children_d.concat(c);for(c=[],u=0,h=_.children.length;u<h;u++)c[u>=r?u+1:u]=_.children[u];return c[r]=d.id,_.children=c,_.children_d.push(d.id),_.children_d=_.children_d.concat(d.children_d),this._node_changed(_.id),this.redraw("#"===_.id),a&&a.call(this,d,_,r),this.trigger("copy_node",{node:d,original:n,parent:_.id,position:r,old_parent:p,old_position:g&&g._id&&p&&g._model.data[p]&&g._model.data[p].children?e.inArray(n.id,g._model.data[p].children):-1,is_multi:g&&g._id&&g._id!==this._id,is_foreign:!g||!g._id,old_instance:g,new_instance:this}),d.id},cut:function(t){if(t||(t=this._data.core.selected.concat()),e.isArray(t)||(t=[t]),!t.length)return!1;var n,i,r,l=[];for(i=0,r=t.length;i<r;i++)(n=this.get_node(t[i]))&&n.id&&"#"!==n.id&&l.push(n);if(!l.length)return!1;a=l,s=this,o="move_node",this.trigger("cut",{node:t})},copy:function(t){if(t||(t=this._data.core.selected.concat()),e.isArray(t)||(t=[t]),!t.length)return!1;var n,i,r,l=[];for(i=0,r=t.length;i<r;i++)(n=this.get_node(t[i]))&&n.id&&"#"!==n.id&&l.push(n);if(!l.length)return!1;a=l,s=this,o="copy_node",this.trigger("copy",{node:t})},get_buffer:function(){return{mode:o,node:a,inst:s}},can_paste:function(){return!1!==o&&!1!==a},paste:function(e,t){if(!((e=this.get_node(e))&&o&&o.match(/^(copy_node|move_node)$/)&&a))return!1;this[o](a,e,t)&&this.trigger("paste",{parent:e.id,node:a,mode:o}),a=!1,o=!1,s=!1},edit:function(t,n){if(!(t=this.get_node(t)))return!1;if(!1===this.settings.core.check_callback)return this._data.core.last_error={error:"check",plugin:"core",id:"core_07",reason:"Could not edit node because of check_callback"},this.settings.core.error.call(this,this._data.core.last_error),!1;n="string"==typeof n?n:t.text,this.set_text(t,""),t=this._open_to(t);var i=this._data.core.rtl,r=this.element.width(),a=t.children(".jstree-anchor"),o=e("<span>"),/*!
				oi = obj.children("i:visible"),
				ai = a.children("i:visible"),
				w1 = oi.width() * oi.length,
				w2 = ai.width() * ai.length,
				*/
s=n,l=e("<div />",{css:{position:"absolute",top:"-200px",left:i?"0px":"-1000px",visibility:"hidden"}}).appendTo("body"),c=e("<input />",{value:s,class:"jstree-rename-input",css:{padding:"0",border:"1px solid silver","box-sizing":"border-box",display:"inline-block",height:this._data.core.li_height+"px",lineHeight:this._data.core.li_height+"px",width:"150px"},blur:e.proxy(function(){var n=o.children(".jstree-rename-input"),i=n.val();""===i&&(i=s),l.remove(),o.replaceWith(a),o.remove(),this.set_text(t,s),!1===this.rename_node(t,e("<div></div>").text(i)[this.settings.core.force_text?"text":"html"]())&&this.set_text(t,s)},this),keydown:function(e){var t=e.which;27===t&&(this.value=s),27!==t&&13!==t&&37!==t&&38!==t&&39!==t&&40!==t&&32!==t||e.stopImmediatePropagation(),27!==t&&13!==t||(e.preventDefault(),this.blur())},click:function(e){e.stopImmediatePropagation()},mousedown:function(e){e.stopImmediatePropagation()},keyup:function(e){c.width(Math.min(l.text("pW"+this.value).width(),r))},keypress:function(e){if(13===e.which)return!1}}),d={fontFamily:a.css("fontFamily")||"",fontSize:a.css("fontSize")||"",fontWeight:a.css("fontWeight")||"",fontStyle:a.css("fontStyle")||"",fontStretch:a.css("fontStretch")||"",fontVariant:a.css("fontVariant")||"",letterSpacing:a.css("letterSpacing")||"",wordSpacing:a.css("wordSpacing")||""};o.attr("class",a.attr("class")).append(a.contents().clone()).append(c),a.replaceWith(o),l.css(d),c.css(d).width(Math.min(l.text("pW"+c[0].value).width(),r))[0].select()},set_theme:function(t,n){if(!t)return!1;if(!0===n){var i=this.settings.core.themes.dir;i||(i=e.jstree.path+"/themes"),n=i+"/"+t+"/style.css"}n&&-1===e.inArray(n,l)&&(e("head").append('<link rel="stylesheet" href="'+n+'" type="text/css" />'),l.push(n)),this._data.core.themes.name&&this.element.removeClass("jstree-"+this._data.core.themes.name),this._data.core.themes.name=t,this.element.addClass("jstree-"+t),this.element[this.settings.core.themes.responsive?"addClass":"removeClass"]("jstree-"+t+"-responsive"),this.trigger("set_theme",{theme:t})},get_theme:function(){return this._data.core.themes.name},set_theme_variant:function(e){this._data.core.themes.variant&&this.element.removeClass("jstree-"+this._data.core.themes.name+"-"+this._data.core.themes.variant),this._data.core.themes.variant=e,e&&this.element.addClass("jstree-"+this._data.core.themes.name+"-"+this._data.core.themes.variant)},get_theme_variant:function(){return this._data.core.themes.variant},show_stripes:function(){this._data.core.themes.stripes=!0,this.get_container_ul().addClass("jstree-striped")},hide_stripes:function(){this._data.core.themes.stripes=!1,this.get_container_ul().removeClass("jstree-striped")},toggle_stripes:function(){this._data.core.themes.stripes?this.hide_stripes():this.show_stripes()},show_dots:function(){this._data.core.themes.dots=!0,this.get_container_ul().removeClass("jstree-no-dots")},hide_dots:function(){this._data.core.themes.dots=!1,this.get_container_ul().addClass("jstree-no-dots")},toggle_dots:function(){this._data.core.themes.dots?this.hide_dots():this.show_dots()},show_icons:function(){this._data.core.themes.icons=!0,this.get_container_ul().removeClass("jstree-no-icons")},hide_icons:function(){this._data.core.themes.icons=!1,this.get_container_ul().addClass("jstree-no-icons")},toggle_icons:function(){this._data.core.themes.icons?this.hide_icons():this.show_icons()},set_icon:function(t,n){var i,r,a,o;if(e.isArray(t)){for(t=t.slice(),i=0,r=t.length;i<r;i++)this.set_icon(t[i],n);return!0}return!(!(t=this.get_node(t))||"#"===t.id)&&(o=t.icon,t.icon=n,a=this.get_node(t,!0).children(".jstree-anchor").children(".jstree-themeicon"),!1===n?this.hide_icon(t):!0===n?a.removeClass("jstree-themeicon-custom "+o).css("background","").removeAttr("rel"):-1===n.indexOf("/")&&-1===n.indexOf(".")?(a.removeClass(o).css("background",""),a.addClass(n+" jstree-themeicon-custom").attr("rel",n)):(a.removeClass(o).css("background",""),a.addClass("jstree-themeicon-custom").css("background","url('"+n+"') center center no-repeat").attr("rel",n)),!0)},get_icon:function(e){return!(!(e=this.get_node(e))||"#"===e.id)&&e.icon},hide_icon:function(t){var n,i;if(e.isArray(t)){for(t=t.slice(),n=0,i=t.length;n<i;n++)this.hide_icon(t[n]);return!0}return!(!(t=this.get_node(t))||"#"===t)&&(t.icon=!1,this.get_node(t,!0).children(".jstree-anchor").children(".jstree-themeicon").addClass("jstree-themeicon-hidden"),!0)},show_icon:function(t){var n,i,r;if(e.isArray(t)){for(t=t.slice(),n=0,i=t.length;n<i;n++)this.show_icon(t[n]);return!0}return!(!(t=this.get_node(t))||"#"===t)&&(r=this.get_node(t,!0),t.icon=!r.length||r.children(".jstree-anchor").children(".jstree-themeicon").attr("rel"),t.icon||(t.icon=!0),r.children(".jstree-anchor").children(".jstree-themeicon").removeClass("jstree-themeicon-hidden"),!0)}},e.vakata={},e.vakata.attributes=function(t,n){t=e(t)[0];var i=n?{}:[];return t&&t.attributes&&e.each(t.attributes,function(t,r){-1===e.inArray(r.nodeName.toLowerCase(),["style","contenteditable","hasfocus","tabindex"])&&null!==r.nodeValue&&""!==e.trim(r.nodeValue)&&(n?i[r.nodeName]=r.nodeValue:i.push(r.nodeName))}),i},e.vakata.array_unique=function(e){var t,n,i,r=[];for(t=0,i=e.length;t<i;t++){for(n=0;n<=t&&e[t]!==e[n];n++);n===t&&r.push(e[t])}return r},e.vakata.array_remove=function(e,t,n){var i=e.slice((n||t)+1||e.length);return e.length=t<0?e.length+t:t,e.push.apply(e,i),e},e.vakata.array_remove_item=function(t,n){var i=e.inArray(n,t);return-1!==i?e.vakata.array_remove(t,i):t};var h=document.createElement("I");h.className="jstree-icon jstree-checkbox",e.jstree.defaults.checkbox={visible:!0,three_state:!0,whole_node:!0,keep_selected_style:!0,cascade:"",tie_selection:!0},e.jstree.plugins.checkbox=function(t,n){this.bind=function(){n.bind.call(this),this._data.checkbox.uto=!1,this._data.checkbox.selected=[],this.settings.checkbox.three_state&&(this.settings.checkbox.cascade="up+down+undetermined"),this.element.on("init.jstree",e.proxy(function(){this._data.checkbox.visible=this.settings.checkbox.visible,this.settings.checkbox.keep_selected_style||this.element.addClass("jstree-checkbox-no-clicked"),this.settings.checkbox.tie_selection&&this.element.addClass("jstree-checkbox-selection")},this)).on("loading.jstree",e.proxy(function(){this[this._data.checkbox.visible?"show_checkboxes":"hide_checkboxes"]()},this)),-1!==this.settings.checkbox.cascade.indexOf("undetermined")&&this.element.on("changed.jstree uncheck_node.jstree check_node.jstree uncheck_all.jstree check_all.jstree move_node.jstree copy_node.jstree redraw.jstree open_node.jstree",e.proxy(function(){this._data.checkbox.uto&&clearTimeout(this._data.checkbox.uto),this._data.checkbox.uto=setTimeout(e.proxy(this._undetermined,this),50)},this)),this.settings.checkbox.tie_selection||this.element.on("model.jstree",e.proxy(function(e,t){var n,i,r=this._model.data,a=(r[t.parent],t.nodes);for(n=0,i=a.length;n<i;n++)r[a[n]].state.checked=r[a[n]].original&&r[a[n]].original.state&&r[a[n]].original.state.checked,r[a[n]].state.checked&&this._data.checkbox.selected.push(a[n])},this)),-1===this.settings.checkbox.cascade.indexOf("up")&&-1===this.settings.checkbox.cascade.indexOf("down")||this.element.on("model.jstree",e.proxy(function(t,n){var i,r,a,o,s,l,c=this._model.data,d=c[n.parent],u=n.nodes,h=[],f=this.settings.checkbox.cascade,p=this.settings.checkbox.tie_selection;if(-1!==f.indexOf("down"))if(d.state[p?"selected":"checked"]){for(r=0,a=u.length;r<a;r++)c[u[r]].state[p?"selected":"checked"]=!0;this._data[p?"core":"checkbox"].selected=this._data[p?"core":"checkbox"].selected.concat(u)}else for(r=0,a=u.length;r<a;r++)if(c[u[r]].state[p?"selected":"checked"]){for(o=0,s=c[u[r]].children_d.length;o<s;o++)c[c[u[r]].children_d[o]].state[p?"selected":"checked"]=!0;this._data[p?"core":"checkbox"].selected=this._data[p?"core":"checkbox"].selected.concat(c[u[r]].children_d)}if(-1!==f.indexOf("up")){for(r=0,a=d.children_d.length;r<a;r++)c[d.children_d[r]].children.length||h.push(c[d.children_d[r]].parent);for(h=e.vakata.array_unique(h),o=0,s=h.length;o<s;o++)for(d=c[h[o]];d&&"#"!==d.id;){for(i=0,r=0,a=d.children.length;r<a;r++)i+=c[d.children[r]].state[p?"selected":"checked"];if(i!==a)break;d.state[p?"selected":"checked"]=!0,this._data[p?"core":"checkbox"].selected.push(d.id),(l=this.get_node(d,!0))&&l.length&&l.children(".jstree-anchor").addClass(p?"jstree-clicked":"jstree-checked"),d=this.get_node(d.parent)}}this._data[p?"core":"checkbox"].selected=e.vakata.array_unique(this._data[p?"core":"checkbox"].selected)},this)).on(this.settings.checkbox.tie_selection?"select_node.jstree":"check_node.jstree",e.proxy(function(t,n){var i,r,a,o,s=n.node,l=this._model.data,c=this.get_node(s.parent),d=this.get_node(s,!0),u=this.settings.checkbox.cascade,h=this.settings.checkbox.tie_selection;if(-1!==u.indexOf("down"))for(this._data[h?"core":"checkbox"].selected=e.vakata.array_unique(this._data[h?"core":"checkbox"].selected.concat(s.children_d)),i=0,r=s.children_d.length;i<r;i++)o=l[s.children_d[i]],o.state[h?"selected":"checked"]=!0,o&&o.original&&o.original.state&&o.original.state.undetermined&&(o.original.state.undetermined=!1);if(-1!==u.indexOf("up"))for(;c&&"#"!==c.id;){for(a=0,i=0,r=c.children.length;i<r;i++)a+=l[c.children[i]].state[h?"selected":"checked"];if(a!==r)break;c.state[h?"selected":"checked"]=!0,this._data[h?"core":"checkbox"].selected.push(c.id),(o=this.get_node(c,!0))&&o.length&&o.children(".jstree-anchor").addClass(h?"jstree-clicked":"jstree-checked"),c=this.get_node(c.parent)}-1!==u.indexOf("down")&&d.length&&d.find(".jstree-anchor").addClass(h?"jstree-clicked":"jstree-checked")},this)).on(this.settings.checkbox.tie_selection?"deselect_all.jstree":"uncheck_all.jstree",e.proxy(function(e,t){var n,i,r,a=this.get_node("#"),o=this._model.data;for(n=0,i=a.children_d.length;n<i;n++)(r=o[a.children_d[n]])&&r.original&&r.original.state&&r.original.state.undetermined&&(r.original.state.undetermined=!1)},this)).on(this.settings.checkbox.tie_selection?"deselect_node.jstree":"uncheck_node.jstree",e.proxy(function(t,n){var i,r,a,o=n.node,s=this.get_node(o,!0),l=this.settings.checkbox.cascade,c=this.settings.checkbox.tie_selection;if(o&&o.original&&o.original.state&&o.original.state.undetermined&&(o.original.state.undetermined=!1),-1!==l.indexOf("down"))for(i=0,r=o.children_d.length;i<r;i++)a=this._model.data[o.children_d[i]],a.state[c?"selected":"checked"]=!1,a&&a.original&&a.original.state&&a.original.state.undetermined&&(a.original.state.undetermined=!1);if(-1!==l.indexOf("up"))for(i=0,r=o.parents.length;i<r;i++)a=this._model.data[o.parents[i]],a.state[c?"selected":"checked"]=!1,a&&a.original&&a.original.state&&a.original.state.undetermined&&(a.original.state.undetermined=!1),(a=this.get_node(o.parents[i],!0))&&a.length&&a.children(".jstree-anchor").removeClass(c?"jstree-clicked":"jstree-checked");for(a=[],i=0,r=this._data[c?"core":"checkbox"].selected.length;i<r;i++)-1!==l.indexOf("down")&&-1!==e.inArray(this._data[c?"core":"checkbox"].selected[i],o.children_d)||-1!==l.indexOf("up")&&-1!==e.inArray(this._data[c?"core":"checkbox"].selected[i],o.parents)||a.push(this._data[c?"core":"checkbox"].selected[i]);this._data[c?"core":"checkbox"].selected=e.vakata.array_unique(a),-1!==l.indexOf("down")&&s.length&&s.find(".jstree-anchor").removeClass(c?"jstree-clicked":"jstree-checked")},this)),-1!==this.settings.checkbox.cascade.indexOf("up")&&this.element.on("delete_node.jstree",e.proxy(function(e,t){for(var n,i,r,a,o=this.get_node(t.parent),s=this._model.data,l=this.settings.checkbox.tie_selection;o&&"#"!==o.id;){for(r=0,n=0,i=o.children.length;n<i;n++)r+=s[o.children[n]].state[l?"selected":"checked"];if(r!==i)break;o.state[l?"selected":"checked"]=!0,this._data[l?"core":"checkbox"].selected.push(o.id),(a=this.get_node(o,!0))&&a.length&&a.children(".jstree-anchor").addClass(l?"jstree-clicked":"jstree-checked"),o=this.get_node(o.parent)}},this)).on("move_node.jstree",e.proxy(function(t,n){var i,r,a,o,s,l=n.is_multi,c=n.old_parent,d=this.get_node(n.parent),u=this._model.data,h=this.settings.checkbox.tie_selection;if(!l)for(i=this.get_node(c);i&&"#"!==i.id;){for(r=0,a=0,o=i.children.length;a<o;a++)r+=u[i.children[a]].state[h?"selected":"checked"];if(r!==o)break;i.state[h?"selected":"checked"]=!0,this._data[h?"core":"checkbox"].selected.push(i.id),(s=this.get_node(i,!0))&&s.length&&s.children(".jstree-anchor").addClass(h?"jstree-clicked":"jstree-checked"),i=this.get_node(i.parent)}for(i=d;i&&"#"!==i.id;){for(r=0,a=0,o=i.children.length;a<o;a++)r+=u[i.children[a]].state[h?"selected":"checked"];if(r===o)i.state[h?"selected":"checked"]||(i.state[h?"selected":"checked"]=!0,this._data[h?"core":"checkbox"].selected.push(i.id),(s=this.get_node(i,!0))&&s.length&&s.children(".jstree-anchor").addClass(h?"jstree-clicked":"jstree-checked"));else{if(!i.state[h?"selected":"checked"])break;i.state[h?"selected":"checked"]=!1,this._data[h?"core":"checkbox"].selected=e.vakata.array_remove_item(this._data[h?"core":"checkbox"].selected,i.id),(s=this.get_node(i,!0))&&s.length&&s.children(".jstree-anchor").removeClass(h?"jstree-clicked":"jstree-checked")}i=this.get_node(i.parent)}},this))},this._undetermined=function(){var t,n,i=this._model.data,r=this.settings.checkbox.tie_selection,a=this._data[r?"core":"checkbox"].selected,o=[],s=this;for(t=0,n=a.length;t<n;t++)i[a[t]]&&i[a[t]].parents&&(o=o.concat(i[a[t]].parents));for(this.element.find(".jstree-closed").not(":has(.jstree-children)").each(function(){var e,r=s.get_node(this);if(r.state.loaded)for(t=0,n=r.children_d.length;t<n;t++)e=i[r.children_d[t]],!e.state.loaded&&e.original&&e.original.state&&e.original.state.undetermined&&!0===e.original.state.undetermined&&(o.push(e.id),o=o.concat(e.parents));else r.original&&r.original.state&&r.original.state.undetermined&&!0===r.original.state.undetermined&&(o.push(r.id),o=o.concat(r.parents))}),o=e.vakata.array_unique(o),o=e.vakata.array_remove_item(o,"#"),this.element.find(".jstree-undetermined").removeClass("jstree-undetermined"),t=0,n=o.length;t<n;t++)i[o[t]].state[r?"selected":"checked"]||(a=this.get_node(o[t],!0))&&a.length&&a.children(".jstree-anchor").children(".jstree-checkbox").addClass("jstree-undetermined")},this.redraw_node=function(t,i,r){if(t=n.redraw_node.call(this,t,i,r)){var a,o,s=null;for(a=0,o=t.childNodes.length;a<o;a++)if(t.childNodes[a]&&t.childNodes[a].className&&-1!==t.childNodes[a].className.indexOf("jstree-anchor")){s=t.childNodes[a];break}s&&(!this.settings.checkbox.tie_selection&&this._model.data[t.id].state.checked&&(s.className+=" jstree-checked"),s.insertBefore(h.cloneNode(!1),s.childNodes[0]))}return r||-1===this.settings.checkbox.cascade.indexOf("undetermined")||(this._data.checkbox.uto&&clearTimeout(this._data.checkbox.uto),this._data.checkbox.uto=setTimeout(e.proxy(this._undetermined,this),50)),t},this.show_checkboxes=function(){this._data.core.themes.checkboxes=!0,this.get_container_ul().removeClass("jstree-no-checkboxes")},this.hide_checkboxes=function(){this._data.core.themes.checkboxes=!1,this.get_container_ul().addClass("jstree-no-checkboxes")},this.toggle_checkboxes=function(){this._data.core.themes.checkboxes?this.hide_checkboxes():this.show_checkboxes()},this.is_undetermined=function(t){t=this.get_node(t);var n,i,r=this.settings.checkbox.cascade,a=this.settings.checkbox.tie_selection,o=this._data[a?"core":"checkbox"].selected,s=this._model.data;if(!t||!0===t.state[a?"selected":"checked"]||-1===r.indexOf("undetermined")||-1===r.indexOf("down")&&-1===r.indexOf("up"))return!1;if(!t.state.loaded&&!0===t.original.state.undetermined)return!0;for(n=0,i=t.children_d.length;n<i;n++)if(-1!==e.inArray(t.children_d[n],o)||!s[t.children_d[n]].state.loaded&&s[t.children_d[n]].original.state.undetermined)return!0;return!1},this.activate_node=function(t,i){if(this.settings.checkbox.tie_selection&&(this.settings.checkbox.whole_node||e(i.target).hasClass("jstree-checkbox"))&&(i.ctrlKey=!0),this.settings.checkbox.tie_selection||!this.settings.checkbox.whole_node&&!e(i.target).hasClass("jstree-checkbox"))return n.activate_node.call(this,t,i);this.is_checked(t)?this.uncheck_node(t,i):this.check_node(t,i),this.trigger("activate_node",{node:this.get_node(t)})},this.check_node=function(t,n){if(this.settings.checkbox.tie_selection)return this.select_node(t,!1,!0,n);var i,r,a;if(e.isArray(t)){for(t=t.slice(),r=0,a=t.length;r<a;r++)this.check_node(t[r],n);return!0}if(!(t=this.get_node(t))||"#"===t.id)return!1;i=this.get_node(t,!0),t.state.checked||(t.state.checked=!0,this._data.checkbox.selected.push(t.id),i&&i.length&&i.children(".jstree-anchor").addClass("jstree-checked"),this.trigger("check_node",{node:t,selected:this._data.checkbox.selected,event:n}))},this.uncheck_node=function(t,n){if(this.settings.checkbox.tie_selection)return this.deselect_node(t,!1,n);var i,r,a;if(e.isArray(t)){for(t=t.slice(),i=0,r=t.length;i<r;i++)this.uncheck_node(t[i],n);return!0}if(!(t=this.get_node(t))||"#"===t.id)return!1;a=this.get_node(t,!0),t.state.checked&&(t.state.checked=!1,this._data.checkbox.selected=e.vakata.array_remove_item(this._data.checkbox.selected,t.id),a.length&&a.children(".jstree-anchor").removeClass("jstree-checked"),this.trigger("uncheck_node",{node:t,selected:this._data.checkbox.selected,event:n}))},this.check_all=function(){if(this.settings.checkbox.tie_selection)return this.select_all();var e,t;this._data.checkbox.selected.concat([]);for(this._data.checkbox.selected=this._model.data["#"].children_d.concat(),e=0,t=this._data.checkbox.selected.length;e<t;e++)this._model.data[this._data.checkbox.selected[e]]&&(this._model.data[this._data.checkbox.selected[e]].state.checked=!0);this.redraw(!0),this.trigger("check_all",{selected:this._data.checkbox.selected})},this.uncheck_all=function(){if(this.settings.checkbox.tie_selection)return this.deselect_all();var e,t,n=this._data.checkbox.selected.concat([]);for(e=0,t=this._data.checkbox.selected.length;e<t;e++)this._model.data[this._data.checkbox.selected[e]]&&(this._model.data[this._data.checkbox.selected[e]].state.checked=!1);this._data.checkbox.selected=[],this.element.find(".jstree-checked").removeClass("jstree-checked"),this.trigger("uncheck_all",{selected:this._data.checkbox.selected,node:n})},this.is_checked=function(e){return this.settings.checkbox.tie_selection?this.is_selected(e):!(!(e=this.get_node(e))||"#"===e.id)&&e.state.checked},this.get_checked=function(t){return this.settings.checkbox.tie_selection?this.get_selected(t):t?e.map(this._data.checkbox.selected,e.proxy(function(e){return this.get_node(e)},this)):this._data.checkbox.selected},this.get_top_checked=function(t){if(this.settings.checkbox.tie_selection)return this.get_top_selected(t);var n,i,r,a,o=this.get_checked(!0),s={};for(n=0,i=o.length;n<i;n++)s[o[n].id]=o[n];for(n=0,i=o.length;n<i;n++)for(r=0,a=o[n].children_d.length;r<a;r++)s[o[n].children_d[r]]&&delete s[o[n].children_d[r]];o=[];for(n in s)s.hasOwnProperty(n)&&o.push(n);return t?e.map(o,e.proxy(function(e){return this.get_node(e)},this)):o},this.get_bottom_checked=function(t){if(this.settings.checkbox.tie_selection)return this.get_bottom_selected(t);var n,i,r=this.get_checked(!0),a=[];for(n=0,i=r.length;n<i;n++)r[n].children.length||a.push(r[n].id);return t?e.map(a,e.proxy(function(e){return this.get_node(e)},this)):a}},e.jstree.defaults.contextmenu={select_node:!0,show_at_node:!0,items:function(t,n){return{create:{separator_before:!1,separator_after:!0,_disabled:!1,label:"Create",action:function(t){var n=e.jstree.reference(t.reference),i=n.get_node(t.reference);n.create_node(i,{},"last",function(e){setTimeout(function(){n.edit(e)},0)})}},rename:{separator_before:!1,separator_after:!1,_disabled:!1,label:"Rename",action:function(t){var n=e.jstree.reference(t.reference),i=n.get_node(t.reference);n.edit(i)}},remove:{separator_before:!1,icon:!1,separator_after:!1,_disabled:!1,label:"Delete",action:function(t){var n=e.jstree.reference(t.reference),i=n.get_node(t.reference);n.is_selected(i)?n.delete_node(n.get_selected()):n.delete_node(i)}},ccp:{separator_before:!0,icon:!1,separator_after:!1,label:"Edit",action:!1,submenu:{cut:{separator_before:!1,separator_after:!1,label:"Cut",action:function(t){var n=e.jstree.reference(t.reference),i=n.get_node(t.reference);n.is_selected(i)?n.cut(n.get_selected()):n.cut(i)}},copy:{separator_before:!1,icon:!1,separator_after:!1,label:"Copy",action:function(t){var n=e.jstree.reference(t.reference),i=n.get_node(t.reference);n.is_selected(i)?n.copy(n.get_selected()):n.copy(i)}},paste:{separator_before:!1,icon:!1,_disabled:function(t){return!e.jstree.reference(t.reference).can_paste()},separator_after:!1,label:"Paste",action:function(t){var n=e.jstree.reference(t.reference),i=n.get_node(t.reference);n.paste(i)}}}}}}},e.jstree.plugins.contextmenu=function(n,i){this.bind=function(){i.bind.call(this);var t=0;this.element.on("contextmenu.jstree",".jstree-anchor",e.proxy(function(e){e.preventDefault(),t=e.ctrlKey?e.timeStamp:0,this.is_loading(e.currentTarget)||this.show_contextmenu(e.currentTarget,e.pageX,e.pageY,e)},this)).on("click.jstree",".jstree-anchor",e.proxy(function(n){this._data.contextmenu.visible&&(!t||n.timeStamp-t>250)&&e.vakata.context.hide()},this)),e(document).on("context_hide.vakata",e.proxy(function(){this._data.contextmenu.visible=!1},this))},this.teardown=function(){this._data.contextmenu.visible&&e.vakata.context.hide(),i.teardown.call(this)},this.show_contextmenu=function(n,i,r,a){if(!(n=this.get_node(n))||"#"===n.id)return!1;var o=this.settings.contextmenu,s=this.get_node(n,!0),l=s.children(".jstree-anchor"),c=!1,d=!1;(o.show_at_node||i===t||r===t)&&(c=l.offset(),i=c.left,r=c.top+this._data.core.li_height),this.settings.contextmenu.select_node&&!this.is_selected(n)&&this.activate_node(n,a),d=o.items,e.isFunction(d)&&(d=d.call(this,n,e.proxy(function(e){this._show_contextmenu(n,i,r,e)},this))),e.isPlainObject(d)&&this._show_contextmenu(n,i,r,d)},this._show_contextmenu=function(t,n,i,r){var a=this.get_node(t,!0),o=a.children(".jstree-anchor");e(document).one("context_show.vakata",e.proxy(function(t,n){var i="jstree-contextmenu jstree-"+this.get_theme()+"-contextmenu";e(n.element).addClass(i)},this)),this._data.contextmenu.visible=!0,e.vakata.context.show(o,{x:n,y:i},r),this.trigger("show_contextmenu",{node:t,x:n,y:i})}},function(e){var t=!1,n={element:!1,reference:!1,position_x:0,position_y:0,items:[],html:"",is_visible:!1};e.vakata.context={settings:{hide_onmouseleave:0,icons:!0},_trigger:function(t){e(document).triggerHandler("context_"+t+".vakata",{reference:n.reference,element:n.element,position:{x:n.position_x,y:n.position_y}})},_execute:function(t){return!(!(t=n.items[t])||t._disabled&&(!e.isFunction(t._disabled)||t._disabled({item:t,reference:n.reference,element:n.element}))||!t.action)&&t.action.call(null,{item:t,reference:n.reference,element:n.element,position:{x:n.position_x,y:n.position_y}})},_parse:function(t,i){if(!t)return!1;i||(n.html="",n.items=[]);var r,a="",o=!1;return i&&(a+="<ul>"),e.each(t,function(t,i){if(!i)return!0;n.items.push(i),!o&&i.separator_before&&(a+="<li class='vakata-context-separator'><a href='#' "+(e.vakata.context.settings.icons?"":'style="margin-left:0px;"')+">&#160;</a></li>"),o=!1,a+="<li class='"+(i._class||"")+(!0===i._disabled||e.isFunction(i._disabled)&&i._disabled({item:i,reference:n.reference,element:n.element})?" vakata-contextmenu-disabled ":"")+"' "+(i.shortcut?" data-shortcut='"+i.shortcut+"' ":"")+">",a+="<a href='#' rel='"+(n.items.length-1)+"'>",e.vakata.context.settings.icons&&(a+="<i ",i.icon&&(-1!==i.icon.indexOf("/")||-1!==i.icon.indexOf(".")?a+=" style='background:url(\""+i.icon+"\") center center no-repeat' ":a+=" class='"+i.icon+"' "),a+="></i><span class='vakata-contextmenu-sep'>&#160;</span>"),a+=(e.isFunction(i.label)?i.label({item:t,reference:n.reference,element:n.element}):i.label)+(i.shortcut?' <span class="vakata-contextmenu-shortcut vakata-contextmenu-shortcut-'+i.shortcut+'">'+(i.shortcut_label||"")+"</span>":"")+"</a>",i.submenu&&(r=e.vakata.context._parse(i.submenu,!0))&&(a+=r),a+="</li>",i.separator_after&&(a+="<li class='vakata-context-separator'><a href='#' "+(e.vakata.context.settings.icons?"":'style="margin-left:0px;"')+">&#160;</a></li>",o=!0)}),a=a.replace(/<li class\='vakata-context-separator'\><\/li\>$/,""),i&&(a+="</ul>"),i||(n.html=a,e.vakata.context._trigger("parse")),a.length>10&&a},_show_submenu:function(n){if(n=e(n),n.length&&n.children("ul").length){var i=n.children("ul"),r=n.offset().left+n.outerWidth(),a=n.offset().top,o=i.width(),s=i.height(),l=e(window).width()+e(window).scrollLeft(),c=e(window).height()+e(window).scrollTop();t?n[r-(o+10+n.outerWidth())<0?"addClass":"removeClass"]("vakata-context-left"):n[r+o+10>l?"addClass":"removeClass"]("vakata-context-right"),a+s+10>c&&i.css("bottom","-1px"),i.show()}},show:function(i,r,a){var o,s,l,c,d,u,h,f;switch(n.element&&n.element.length&&n.element.width(""),!0){case!r&&!i:return!1;case!!r&&!!i:n.reference=i,n.position_x=r.x,n.position_y=r.y;break;case!r&&!!i:n.reference=i,o=i.offset(),n.position_x=o.left+i.outerHeight(),n.position_y=o.top;break;case!!r&&!i:n.position_x=r.x,n.position_y=r.y}i&&!a&&e(i).data("vakata_contextmenu")&&(a=e(i).data("vakata_contextmenu")),e.vakata.context._parse(a)&&n.element.html(n.html),n.items.length&&(s=n.element,l=n.position_x,c=n.position_y,d=s.width(),u=s.height(),h=e(window).width()+e(window).scrollLeft(),f=e(window).height()+e(window).scrollTop(),t&&(l-=s.outerWidth())<e(window).scrollLeft()+20&&(l=e(window).scrollLeft()+20),l+d+20>h&&(l=h-(d+20)),c+u+20>f&&(c=f-(u+20)),n.element.css({left:l,top:c}).show().find("a:eq(0)").focus().parent().addClass("vakata-context-hover"),n.is_visible=!0,e.vakata.context._trigger("show"))},hide:function(){n.is_visible&&(n.element.hide().find("ul").hide().end().find(":focus").blur(),n.is_visible=!1,e.vakata.context._trigger("hide"))}},e(function(){t="rtl"===e("body").css("direction");var i=!1;n.element=e("<ul class='vakata-context'></ul>"),n.element.on("mouseenter","li",function(t){t.stopImmediatePropagation(),e.contains(this,t.relatedTarget)||(i&&clearTimeout(i),n.element.find(".vakata-context-hover").removeClass("vakata-context-hover").end(),e(this).siblings().find("ul").hide().end().end().parentsUntil(".vakata-context","li").addBack().addClass("vakata-context-hover"),e.vakata.context._show_submenu(this))}).on("mouseleave","li",function(t){e.contains(this,t.relatedTarget)||e(this).find(".vakata-context-hover").addBack().removeClass("vakata-context-hover")}).on("mouseleave",function(t){e(this).find(".vakata-context-hover").removeClass("vakata-context-hover"),e.vakata.context.settings.hide_onmouseleave&&(i=setTimeout(function(t){return function(){e.vakata.context.hide()}}(),e.vakata.context.settings.hide_onmouseleave))}).on("click","a",function(t){t.preventDefault(),e(this).blur().parent().hasClass("vakata-context-disabled")||!1===e.vakata.context._execute(e(this).attr("rel"))||e.vakata.context.hide()}).on("keydown","a",function(t){var i=null;switch(t.which){case 13:case 32:t.type="mouseup",t.preventDefault(),e(t.currentTarget).trigger(t);break;case 37:n.is_visible&&(n.element.find(".vakata-context-hover").last().parents("li:eq(0)").find("ul").hide().find(".vakata-context-hover").removeClass("vakata-context-hover").end().end().children("a").focus(),t.stopImmediatePropagation(),t.preventDefault());break;case 38:n.is_visible&&(i=n.element.find("ul:visible").addBack().last().children(".vakata-context-hover").removeClass("vakata-context-hover").prevAll("li:not(.vakata-context-separator)").first(),i.length||(i=n.element.find("ul:visible").addBack().last().children("li:not(.vakata-context-separator)").last()),i.addClass("vakata-context-hover").children("a").focus(),t.stopImmediatePropagation(),t.preventDefault());break;case 39:n.is_visible&&(n.element.find(".vakata-context-hover").last().children("ul").show().children("li:not(.vakata-context-separator)").removeClass("vakata-context-hover").first().addClass("vakata-context-hover").children("a").focus(),t.stopImmediatePropagation(),t.preventDefault());break;case 40:n.is_visible&&(i=n.element.find("ul:visible").addBack().last().children(".vakata-context-hover").removeClass("vakata-context-hover").nextAll("li:not(.vakata-context-separator)").first(),i.length||(i=n.element.find("ul:visible").addBack().last().children("li:not(.vakata-context-separator)").first()),i.addClass("vakata-context-hover").children("a").focus(),t.stopImmediatePropagation(),t.preventDefault());break;case 27:e.vakata.context.hide(),t.preventDefault()}}).on("keydown",function(e){e.preventDefault();var t=n.element.find(".vakata-contextmenu-shortcut-"+e.which).parent();t.parent().not(".vakata-context-disabled")&&t.mouseup()}).appendTo("body"),e(document).on("mousedown",function(t){n.is_visible&&!e.contains(n.element[0],t.target)&&e.vakata.context.hide()}).on("context_show.vakata",function(e,i){n.element.find("li:has(ul)").children("a").addClass("vakata-context-parent"),t&&n.element.addClass("vakata-context-rtl").css("direction","rtl"),n.element.find("ul").hide().end()})})}(e),e.jstree.defaults.dnd={copy:!0,open_timeout:500,is_draggable:!0,check_while_dragging:!0,always_copy:!1,inside_pos:0},e.jstree.plugins.dnd=function(t,n){this.bind=function(){n.bind.call(this),this.element.on("mousedown.jstree touchstart.jstree",".jstree-anchor",e.proxy(function(t){var n=this.get_node(t.target),i=this.is_selected(n)?this.get_selected().length:1;if(n&&n.id&&"#"!==n.id&&(1===t.which||"touchstart"===t.type)&&(!0===this.settings.dnd.is_draggable||e.isFunction(this.settings.dnd.is_draggable)&&this.settings.dnd.is_draggable.call(this,i>1?this.get_selected(!0):[n])))return this.element.trigger("mousedown.jstree"),e.vakata.dnd.start(t,{jstree:!0,origin:this,obj:this.get_node(n,!0),nodes:i>1?this.get_selected():[n.id]},'<div id="jstree-dnd" class="jstree-'+this.get_theme()+(this.settings.core.themes.responsive?" jstree-dnd-responsive":"")+'"><i class="jstree-icon jstree-er"></i>'+(i>1?i+" "+this.get_string("nodes"):this.get_text(t.currentTarget,!0))+'<ins class="jstree-copy" style="display:none;">+</ins></div>')},this))}},e(function(){var t=!1,n=!1,i=!1,r=e('<div id="jstree-marker">&#160;</div>').hide().appendTo("body");e(document).bind("dnd_start.vakata",function(e,n){t=!1}).bind("dnd_move.vakata",function(a,o){if(i&&clearTimeout(i),o&&o.data&&o.data.jstree&&(!o.event.target.id||"jstree-marker"!==o.event.target.id)){var s,l,c,d,u,h,f,p,_,g,m,v,y,b,w=e.jstree.reference(o.event.target),x=!1,k=!1,j=!1;if(w&&w._data&&w._data.dnd)if(r.attr("class","jstree-"+w.get_theme()+(w.settings.core.themes.responsive?" jstree-dnd-responsive":"")),o.helper.children().attr("class","jstree-"+w.get_theme()+(w.settings.core.themes.responsive?" jstree-dnd-responsive":"")).find(".jstree-copy:eq(0)")[o.data.origin&&(o.data.origin.settings.dnd.always_copy||o.data.origin.settings.dnd.copy&&(o.event.metaKey||o.event.ctrlKey))?"show":"hide"](),o.event.target!==w.element[0]&&o.event.target!==w.get_container_ul()[0]||0!==w.get_container_ul().children().length){if((x=e(o.event.target).closest(".jstree-anchor"))&&x.length&&x.parent().is(".jstree-closed, .jstree-open, .jstree-leaf")&&(k=x.offset(),j=o.event.pageY-k.top,c=x.height(),h=j<c/3?["b","i","a"]:j>c-c/3?["a","i","b"]:j>c/2?["i","a","b"]:["i","b","a"],e.each(h,function(a,j){switch(j){case"b":s=k.left-6,l=k.top,d=w.get_parent(x),u=x.parent().index();break;case"i":y=w.settings.dnd.inside_pos,b=w.get_node(x.parent()),s=k.left-2,l=k.top+c/2+1,d=b.id,u="first"===y?0:"last"===y?b.children.length:Math.min(y,b.children.length);break;case"a":s=k.left-6,l=k.top+c,d=w.get_parent(x),u=x.parent().index()+1}for(/*!
								// TODO: moving inside, but the node is not yet loaded?
								// the check will work anyway, as when moving the node will be loaded first and checked again
								if(v === 'i' && !ins.is_loaded(p)) { }
								*/
f=!0,p=0,_=o.data.nodes.length;p<_;p++)if(g=o.data.origin&&(o.data.origin.settings.dnd.always_copy||o.data.origin.settings.dnd.copy&&(o.event.metaKey||o.event.ctrlKey))?"copy_node":"move_node",m=u,"move_node"===g&&"a"===j&&o.data.origin&&o.data.origin===w&&d===w.get_parent(o.data.nodes[p])&&(v=w.get_node(d),m>e.inArray(o.data.nodes[p],v.children)&&(m-=1)),!(f=f&&(w&&w.settings&&w.settings.dnd&&!1===w.settings.dnd.check_while_dragging||w.check(g,o.data.origin&&o.data.origin!==w?o.data.origin.get_node(o.data.nodes[p]):o.data.nodes[p],d,m,{dnd:!0,ref:w.get_node(x.parent()),pos:j,is_multi:o.data.origin&&o.data.origin!==w,is_foreign:!o.data.origin})))){w&&w.last_error&&(n=w.last_error());break}if(f)return"i"===j&&x.parent().is(".jstree-closed")&&w.settings.dnd.open_timeout&&(i=setTimeout(function(e,t){return function(){e.open_node(t)}}(w,x),w.settings.dnd.open_timeout)),t={ins:w,par:d,pos:"i"!==j||"last"!==y||0!==u||w.is_loaded(b)?u:"last"},r.css({left:s+"px",top:l+"px"}).show(),o.helper.find(".jstree-icon:eq(0)").removeClass("jstree-er").addClass("jstree-ok"),n={},h=!0,!1}),!0===h))return}else{for(f=!0,p=0,_=o.data.nodes.length;p<_&&(f=f&&w.check(o.data.origin&&(o.data.origin.settings.dnd.always_copy||o.data.origin.settings.dnd.copy&&(o.event.metaKey||o.event.ctrlKey))?"copy_node":"move_node",o.data.origin&&o.data.origin!==w?o.data.origin.get_node(o.data.nodes[p]):o.data.nodes[p],"#","last",{dnd:!0,ref:w.get_node("#"),pos:"i",is_multi:o.data.origin&&o.data.origin!==w,is_foreign:!o.data.origin}));p++);if(f)return t={ins:w,par:"#",pos:"last"},r.hide(),void o.helper.find(".jstree-icon:eq(0)").removeClass("jstree-er").addClass("jstree-ok")}t=!1,o.helper.find(".jstree-icon").removeClass("jstree-ok").addClass("jstree-er"),r.hide()}}).bind("dnd_scroll.vakata",function(e,n){n&&n.data&&n.data.jstree&&(r.hide(),t=!1,n.helper.find(".jstree-icon:eq(0)").removeClass("jstree-ok").addClass("jstree-er"))}).bind("dnd_stop.vakata",function(a,o){if(i&&clearTimeout(i),o&&o.data&&o.data.jstree){r.hide();var s,l,c=[];if(t){for(s=0,l=o.data.nodes.length;s<l;s++)c[s]=o.data.origin?o.data.origin.get_node(o.data.nodes[s]):o.data.nodes[s],o.data.origin&&(c[s].instance=o.data.origin);t.ins[o.data.origin&&(o.data.origin.settings.dnd.always_copy||o.data.origin.settings.dnd.copy&&(o.event.metaKey||o.event.ctrlKey))?"copy_node":"move_node"](c,t.par,t.pos)}else s=e(o.event.target).closest(".jstree"),s.length&&n&&n.error&&"check"===n.error&&(s=s.jstree(!0))&&s.settings.core.error.call(this,n)}}).bind("keyup keydown",function(t,n){(n=e.vakata.dnd._get())&&n.data&&n.data.jstree&&n.helper.find(".jstree-copy:eq(0)")[n.data.origin&&(n.data.origin.settings.dnd.always_copy||n.data.origin.settings.dnd.copy&&(t.metaKey||t.ctrlKey))?"show":"hide"]()})}),function(e){var t={element:!1,target:!1,is_down:!1,is_drag:!1,helper:!1,helper_w:0,data:!1,init_x:0,init_y:0,scroll_l:0,scroll_t:0,scroll_e:!1,scroll_i:!1,is_touch:!1};e.vakata.dnd={settings:{scroll_speed:10,scroll_proximity:20,helper_left:5,helper_top:10,threshold:5,threshold_touch:50},_trigger:function(t,n){var i=e.vakata.dnd._get();i.event=n,e(document).triggerHandler("dnd_"+t+".vakata",i)},_get:function(){return{data:t.data,element:t.element,helper:t.helper}},_clean:function(){t.helper&&t.helper.remove(),t.scroll_i&&(clearInterval(t.scroll_i),t.scroll_i=!1),t={element:!1,target:!1,is_down:!1,is_drag:!1,helper:!1,helper_w:0,data:!1,init_x:0,init_y:0,scroll_l:0,scroll_t:0,scroll_e:!1,scroll_i:!1,is_touch:!1},e(document).off("mousemove touchmove",e.vakata.dnd.drag),e(document).off("mouseup touchend",e.vakata.dnd.stop)},_scroll:function(n){if(!t.scroll_e||!t.scroll_l&&!t.scroll_t)return t.scroll_i&&(clearInterval(t.scroll_i),t.scroll_i=!1),!1;if(!t.scroll_i)return t.scroll_i=setInterval(e.vakata.dnd._scroll,100),!1;if(!0===n)return!1;var i=t.scroll_e.scrollTop(),r=t.scroll_e.scrollLeft();t.scroll_e.scrollTop(i+t.scroll_t*e.vakata.dnd.settings.scroll_speed),t.scroll_e.scrollLeft(r+t.scroll_l*e.vakata.dnd.settings.scroll_speed),i===t.scroll_e.scrollTop()&&r===t.scroll_e.scrollLeft()||e.vakata.dnd._trigger("scroll",t.scroll_e)},start:function(n,i,r){"touchstart"===n.type&&n.originalEvent&&n.originalEvent.changedTouches&&n.originalEvent.changedTouches[0]&&(n.pageX=n.originalEvent.changedTouches[0].pageX,n.pageY=n.originalEvent.changedTouches[0].pageY,n.target=document.elementFromPoint(n.originalEvent.changedTouches[0].pageX-window.pageXOffset,n.originalEvent.changedTouches[0].pageY-window.pageYOffset)),t.is_drag&&e.vakata.dnd.stop({});try{n.currentTarget.unselectable="on",n.currentTarget.onselectstart=function(){return!1},n.currentTarget.style&&(n.currentTarget.style.MozUserSelect="none")}catch(e){}return t.init_x=n.pageX,t.init_y=n.pageY,t.data=i,t.is_down=!0,t.element=n.currentTarget,t.target=n.target,t.is_touch="touchstart"===n.type,!1!==r&&(t.helper=e("<div id='vakata-dnd'></div>").html(r).css({display:"block",margin:"0",padding:"0",position:"absolute",top:"-2000px",lineHeight:"16px",zIndex:"10000"})),e(document).bind("mousemove touchmove",e.vakata.dnd.drag),e(document).bind("mouseup touchend",e.vakata.dnd.stop),!1},drag:function(n){if("touchmove"===n.type&&n.originalEvent&&n.originalEvent.changedTouches&&n.originalEvent.changedTouches[0]&&(n.pageX=n.originalEvent.changedTouches[0].pageX,n.pageY=n.originalEvent.changedTouches[0].pageY,n.target=document.elementFromPoint(n.originalEvent.changedTouches[0].pageX-window.pageXOffset,n.originalEvent.changedTouches[0].pageY-window.pageYOffset)),t.is_down){if(!t.is_drag){if(!(Math.abs(n.pageX-t.init_x)>(t.is_touch?e.vakata.dnd.settings.threshold_touch:e.vakata.dnd.settings.threshold)||Math.abs(n.pageY-t.init_y)>(t.is_touch?e.vakata.dnd.settings.threshold_touch:e.vakata.dnd.settings.threshold)))return;t.helper&&(t.helper.appendTo("body"),t.helper_w=t.helper.outerWidth()),t.is_drag=!0,e.vakata.dnd._trigger("start",n)}var i=!1,r=!1,a=!1,o=!1,s=!1,l=!1,c=!1,d=!1,u=!1,h=!1;return t.scroll_t=0,t.scroll_l=0,t.scroll_e=!1,e(e(n.target).parentsUntil("body").addBack().get().reverse()).filter(function(){return/^auto|scroll$/.test(e(this).css("overflow"))&&(this.scrollHeight>this.offsetHeight||this.scrollWidth>this.offsetWidth)}).each(function(){var i=e(this),r=i.offset();if(this.scrollHeight>this.offsetHeight&&(r.top+i.height()-n.pageY<e.vakata.dnd.settings.scroll_proximity&&(t.scroll_t=1),n.pageY-r.top<e.vakata.dnd.settings.scroll_proximity&&(t.scroll_t=-1)),this.scrollWidth>this.offsetWidth&&(r.left+i.width()-n.pageX<e.vakata.dnd.settings.scroll_proximity&&(t.scroll_l=1),n.pageX-r.left<e.vakata.dnd.settings.scroll_proximity&&(t.scroll_l=-1)),t.scroll_t||t.scroll_l)return t.scroll_e=e(this),!1}),t.scroll_e||(i=e(document),r=e(window),a=i.height(),o=r.height(),s=i.width(),l=r.width(),c=i.scrollTop(),d=i.scrollLeft(),a>o&&n.pageY-c<e.vakata.dnd.settings.scroll_proximity&&(t.scroll_t=-1),a>o&&o-(n.pageY-c)<e.vakata.dnd.settings.scroll_proximity&&(t.scroll_t=1),s>l&&n.pageX-d<e.vakata.dnd.settings.scroll_proximity&&(t.scroll_l=-1),s>l&&l-(n.pageX-d)<e.vakata.dnd.settings.scroll_proximity&&(t.scroll_l=1),(t.scroll_t||t.scroll_l)&&(t.scroll_e=i)),t.scroll_e&&e.vakata.dnd._scroll(!0),t.helper&&(u=parseInt(n.pageY+e.vakata.dnd.settings.helper_top,10),h=parseInt(n.pageX+e.vakata.dnd.settings.helper_left,10),a&&u+25>a&&(u=a-50),s&&h+t.helper_w>s&&(h=s-(t.helper_w+2)),t.helper.css({left:h+"px",top:u+"px"})),e.vakata.dnd._trigger("move",n),!1}},stop:function(n){if("touchend"===n.type&&n.originalEvent&&n.originalEvent.changedTouches&&n.originalEvent.changedTouches[0]&&(n.pageX=n.originalEvent.changedTouches[0].pageX,n.pageY=n.originalEvent.changedTouches[0].pageY,n.target=document.elementFromPoint(n.originalEvent.changedTouches[0].pageX-window.pageXOffset,n.originalEvent.changedTouches[0].pageY-window.pageYOffset)),t.is_drag)e.vakata.dnd._trigger("stop",n);else if("touchend"===n.type&&n.target===t.target){var i=setTimeout(function(){e(n.target).click()},100);e(n.target).one("click",function(){i&&clearTimeout(i)})}return e.vakata.dnd._clean(),!1}}}(e),e.jstree.defaults.search={ajax:!1,fuzzy:!1,case_sensitive:!1,show_only_matches:!1,close_opened_onclear:!0,search_leaves_only:!1,search_callback:!1},e.jstree.plugins.search=function(t,n){this.bind=function(){n.bind.call(this),this._data.search.str="",this._data.search.dom=e(),this._data.search.res=[],this._data.search.opn=[],this.element.on("before_open.jstree",e.proxy(function(t,n){var i,r,a=this._data.search.res,o=[],s=e();if(a&&a.length&&(this._data.search.dom=e(this.element[0].querySelectorAll("#"+e.map(a,function(t){return-1!=="0123456789".indexOf(t[0])?"\\3"+t[0]+" "+t.substr(1).replace(e.jstree.idregex,"\\$&"):t.replace(e.jstree.idregex,"\\$&")}).join(", #"))),this._data.search.dom.children(".jstree-anchor").addClass("jstree-search"),this.settings.search.show_only_matches&&this._data.search.res.length)){for(i=0,r=a.length;i<r;i++)o=o.concat(this.get_node(a[i]).parents);o=e.vakata.array_remove_item(e.vakata.array_unique(o),"#"),s=o.length?e(this.element[0].querySelectorAll("#"+e.map(o,function(t){return-1!=="0123456789".indexOf(t[0])?"\\3"+t[0]+" "+t.substr(1).replace(e.jstree.idregex,"\\$&"):t.replace(e.jstree.idregex,"\\$&")}).join(", #"))):e(),this.element.find(".jstree-node").hide().filter(".jstree-last").filter(function(){return this.nextSibling}).removeClass("jstree-last"),s=s.add(this._data.search.dom),s.parentsUntil(".jstree").addBack().show().filter(".jstree-children").each(function(){e(this).children(".jstree-node:visible").eq(-1).addClass("jstree-last")})}},this)),this.settings.search.show_only_matches&&this.element.on("search.jstree",function(t,n){n.nodes.length&&(e(this).find(".jstree-node").hide().filter(".jstree-last").filter(function(){return this.nextSibling}).removeClass("jstree-last"),n.nodes.parentsUntil(".jstree").addBack().show().filter(".jstree-children").each(function(){e(this).children(".jstree-node:visible").eq(-1).addClass("jstree-last")}))}).on("clear_search.jstree",function(t,n){n.nodes.length&&e(this).find(".jstree-node").css("display","").filter(".jstree-last").filter(function(){return this.nextSibling}).removeClass("jstree-last")})},this.search=function(t,n){if(!1===t||""===e.trim(t.toString()))return this.clear_search();t=t.toString();var i=this.settings.search,r=!!i.ajax&&i.ajax,a=null,o=[],s=[];if(this._data.search.res.length&&this.clear_search(),!n&&!1!==r)return e.isFunction(r)?r.call(this,t,e.proxy(function(n){n&&n.d&&(n=n.d),this._load_nodes(e.isArray(n)?e.vakata.array_unique(n):[],function(){this.search(t,!0)},!0)},this)):(r=e.extend({},r),r.data||(r.data={}),r.data.str=t,e.ajax(r).fail(e.proxy(function(){this._data.core.last_error={error:"ajax",plugin:"search",id:"search_01",reason:"Could not load search parents",data:JSON.stringify(r)},this.settings.core.error.call(this,this._data.core.last_error)},this)).done(e.proxy(function(n){n&&n.d&&(n=n.d),this._load_nodes(e.isArray(n)?e.vakata.array_unique(n):[],function(){this.search(t,!0)},!0)},this)));this._data.search.str=t,this._data.search.dom=e(),this._data.search.res=[],this._data.search.opn=[],a=new e.vakata.search(t,!0,{caseSensitive:i.case_sensitive,fuzzy:i.fuzzy}),e.each(this._model.data,function(e,n){n.text&&(i.search_callback&&i.search_callback.call(this,t,n)||!i.search_callback&&a.search(n.text).isMatch)&&(!i.search_leaves_only||n.state.loaded&&0===n.children.length)&&(o.push(e),s=s.concat(n.parents))}),o.length&&(s=e.vakata.array_unique(s),this._search_open(s),this._data.search.dom=e(this.element[0].querySelectorAll("#"+e.map(o,function(t){return-1!=="0123456789".indexOf(t[0])?"\\3"+t[0]+" "+t.substr(1).replace(e.jstree.idregex,"\\$&"):t.replace(e.jstree.idregex,"\\$&")}).join(", #"))),this._data.search.res=o,this._data.search.dom.children(".jstree-anchor").addClass("jstree-search")),this.trigger("search",{nodes:this._data.search.dom,str:t,res:this._data.search.res})},this.clear_search=function(){this._data.search.dom.children(".jstree-anchor").removeClass("jstree-search"),this.settings.search.close_opened_onclear&&this.close_node(this._data.search.opn,0),this.trigger("clear_search",{nodes:this._data.search.dom,str:this._data.search.str,res:this._data.search.res}),this._data.search.str="",this._data.search.res=[],this._data.search.opn=[],this._data.search.dom=e()},this._search_open=function(t){var n=this;e.each(t.concat([]),function(i,r){if("#"===r)return!0;try{r=e("#"+r.replace(e.jstree.idregex,"\\$&"),n.element)}catch(e){}r&&r.length&&n.is_closed(r)&&(n._data.search.opn.push(r[0].id),n.open_node(r,function(){n._search_open(t)},0))})}},function(e){e.vakata.search=function(e,t,n){n=n||{},!1!==n.fuzzy&&(n.fuzzy=!0),e=n.caseSensitive?e:e.toLowerCase();var i,r,a,o,s=n.location||0,l=n.distance||100,c=n.threshold||.6,d=e.length;return d>32&&(n.fuzzy=!1),n.fuzzy&&(i=1<<d-1,r=function(){var t={},n=0;for(n=0;n<d;n++)t[e.charAt(n)]=0;for(n=0;n<d;n++)t[e.charAt(n)]|=1<<d-n-1;return t}(),a=function(e,t){var n=e/d,i=Math.abs(s-t);return l?n+i/l:i?1:n}),o=function(t){if(t=n.caseSensitive?t:t.toLowerCase(),e===t||-1!==t.indexOf(e))return{isMatch:!0,score:0};if(!n.fuzzy)return{isMatch:!1,score:1};var o,l,u,h,f,p,_,g,m,v=t.length,y=c,b=t.indexOf(e,s),w=d+v,x=1,k=[];for(-1!==b&&(y=Math.min(a(0,b),y),-1!==(b=t.lastIndexOf(e,s+d))&&(y=Math.min(a(0,b),y))),b=-1,o=0;o<d;o++){for(u=0,h=w;u<h;)a(o,s+h)<=y?u=h:w=h,h=Math.floor((w-u)/2+u);for(w=h,p=Math.max(1,s-h+1),_=Math.min(s+h,v)+d,g=new Array(_+2),g[_+1]=(1<<o)-1,l=_;l>=p;l--)if(m=r[t.charAt(l-1)],g[l]=0===o?(g[l+1]<<1|1)&m:(g[l+1]<<1|1)&m|(f[l+1]|f[l])<<1|1|f[l+1],g[l]&i&&(x=a(o,l-1))<=y){if(y=x,b=l-1,k.push(b),!(b>s))break;p=Math.max(1,2*s-b)}if(a(o+1,s)>y)break;f=g}return{isMatch:b>=0,score:x}},!0===t?{search:o}:o(t)}}(e),e.jstree.defaults.sort=function(e,t){return this.get_text(e)>this.get_text(t)?1:-1},e.jstree.plugins.sort=function(t,n){this.bind=function(){n.bind.call(this),this.element.on("model.jstree",e.proxy(function(e,t){this.sort(t.parent,!0)},this)).on("rename_node.jstree create_node.jstree",e.proxy(function(e,t){this.sort(t.parent||t.node.parent,!1),this.redraw_node(t.parent||t.node.parent,!0)},this)).on("move_node.jstree copy_node.jstree",e.proxy(function(e,t){this.sort(t.parent,!1),this.redraw_node(t.parent,!0)},this))},this.sort=function(t,n){var i,r;if((t=this.get_node(t))&&t.children&&t.children.length&&(t.children.sort(e.proxy(this.settings.sort,this)),n))for(i=0,r=t.children_d.length;i<r;i++)this.sort(t.children_d[i],!1)}};var f=!1;e.jstree.defaults.state={key:"jstree",events:"changed.jstree open_node.jstree close_node.jstree",ttl:!1,filter:!1},e.jstree.plugins.state=function(t,n){this.bind=function(){n.bind.call(this);var t=e.proxy(function(){this.element.on(this.settings.state.events,e.proxy(function(){f&&clearTimeout(f),f=setTimeout(e.proxy(function(){this.save_state()},this),100)},this))},this);this.element.on("ready.jstree",e.proxy(function(e,n){this.element.one("restore_state.jstree",t),this.restore_state()||t()},this))},this.save_state=function(){var t={state:this.get_state(),ttl:this.settings.state.ttl,sec:+new Date};e.vakata.storage.set(this.settings.state.key,JSON.stringify(t))},this.restore_state=function(){var t=e.vakata.storage.get(this.settings.state.key);if(t)try{t=JSON.parse(t)}catch(e){return!1}return!(t&&t.ttl&&t.sec&&+new Date-t.sec>t.ttl)&&(t&&t.state&&(t=t.state),t&&e.isFunction(this.settings.state.filter)&&(t=this.settings.state.filter.call(this,t)),!!t&&(this.element.one("set_state.jstree",function(n,i){i.instance.trigger("restore_state",{state:e.extend(!0,{},t)})}),this.set_state(t),!0))},this.clear_state=function(){return e.vakata.storage.del(this.settings.state.key)}},function(e,t){e.vakata.storage={set:function(e,t){return window.localStorage.setItem(e,t)},get:function(e){return window.localStorage.getItem(e)},del:function(e){return window.localStorage.removeItem(e)}}}(e),e.jstree.defaults.types={"#":{},default:{}},e.jstree.plugins.types=function(n,i){this.init=function(e,n){var r,a;if(n&&n.types&&n.types.default)for(r in n.types)if("default"!==r&&"#"!==r&&n.types.hasOwnProperty(r))for(a in n.types.default)n.types.default.hasOwnProperty(a)&&n.types[r][a]===t&&(n.types[r][a]=n.types.default[a]);i.init.call(this,e,n),this._model.data["#"].type="#"},this.refresh=function(e,t){i.refresh.call(this,e,t),this._model.data["#"].type="#"},this.bind=function(){this.element.on("model.jstree",e.proxy(function(e,n){var i,r,a=this._model.data,o=n.nodes,s=this.settings.types,l="default";for(i=0,r=o.length;i<r;i++)l="default",a[o[i]].original&&a[o[i]].original.type&&s[a[o[i]].original.type]&&(l=a[o[i]].original.type),a[o[i]].data&&a[o[i]].data.jstree&&a[o[i]].data.jstree.type&&s[a[o[i]].data.jstree.type]&&(l=a[o[i]].data.jstree.type),a[o[i]].type=l,!0===a[o[i]].icon&&s[l].icon!==t&&(a[o[i]].icon=s[l].icon);a["#"].type="#"},this)),i.bind.call(this)},this.get_json=function(t,n,r){var a,o,s=this._model.data,l=n?e.extend(!0,{},n,{no_id:!1}):{},c=i.get_json.call(this,t,l,r);if(!1===c)return!1;if(e.isArray(c))for(a=0,o=c.length;a<o;a++)c[a].type=c[a].id&&s[c[a].id]&&s[c[a].id].type?s[c[a].id].type:"default",n&&n.no_id&&(delete c[a].id,c[a].li_attr&&c[a].li_attr.id&&delete c[a].li_attr.id);else c.type=c.id&&s[c.id]&&s[c.id].type?s[c.id].type:"default",n&&n.no_id&&(c=this._delete_ids(c));return c},this._delete_ids=function(t){if(e.isArray(t)){for(var n=0,i=t.length;n<i;n++)t[n]=this._delete_ids(t[n]);return t}return delete t.id,t.li_attr&&t.li_attr.id&&delete t.li_attr.id,t.children&&e.isArray(t.children)&&(t.children=this._delete_ids(t.children)),t},this.check=function(n,r,a,o,s){if(!1===i.check.call(this,n,r,a,o,s))return!1;r=r&&r.id?r:this.get_node(r),a=a&&a.id?a:this.get_node(a);var l,c,d,u,h=r&&r.id?e.jstree.reference(r.id):null;switch(h=h&&h._model&&h._model.data?h._model.data:null,n){case"create_node":case"move_node":case"copy_node":if("move_node"!==n||-1===e.inArray(r.id,a.children)){if(l=this.get_rules(a),l.max_children!==t&&-1!==l.max_children&&l.max_children===a.children.length)return this._data.core.last_error={error:"check",plugin:"types",id:"types_01",reason:"max_children prevents function: "+n,data:JSON.stringify({chk:n,pos:o,obj:!(!r||!r.id)&&r.id,par:!(!a||!a.id)&&a.id})},!1;if(l.valid_children!==t&&-1!==l.valid_children&&-1===e.inArray(r.type,l.valid_children))return this._data.core.last_error={error:"check",plugin:"types",id:"types_02",reason:"valid_children prevents function: "+n,data:JSON.stringify({chk:n,pos:o,obj:!(!r||!r.id)&&r.id,par:!(!a||!a.id)&&a.id})},!1;if(h&&r.children_d&&r.parents){for(c=0,d=0,u=r.children_d.length;d<u;d++)c=Math.max(c,h[r.children_d[d]].parents.length);c=c-r.parents.length+1}(c<=0||c===t)&&(c=1);do{if(l.max_depth!==t&&-1!==l.max_depth&&l.max_depth<c)return this._data.core.last_error={error:"check",plugin:"types",id:"types_03",reason:"max_depth prevents function: "+n,data:JSON.stringify({chk:n,pos:o,obj:!(!r||!r.id)&&r.id,par:!(!a||!a.id)&&a.id})},!1;a=this.get_node(a.parent),l=this.get_rules(a),c++}while(a)}}return!0},this.get_rules=function(e){if(!(e=this.get_node(e)))return!1;var n=this.get_type(e,!0);return n.max_depth===t&&(n.max_depth=-1),n.max_children===t&&(n.max_children=-1),n.valid_children===t&&(n.valid_children=-1),n},this.get_type=function(t,n){return!!(t=this.get_node(t))&&(n?e.extend({type:t.type},this.settings.types[t.type]):t.type)},this.set_type=function(n,i){var r,a,o,s,l;if(e.isArray(n)){for(n=n.slice(),a=0,o=n.length;a<o;a++)this.set_type(n[a],i);return!0}return r=this.settings.types,n=this.get_node(n),!(!r[i]||!n)&&(s=n.type,l=this.get_icon(n),n.type=i,(!0===l||r[s]&&r[s].icon&&l===r[s].icon)&&this.set_icon(n,r[i].icon===t||r[i].icon),!0)}},e.jstree.defaults.unique={case_sensitive:!1,duplicate:function(e,t){return e+" ("+t+")"}},e.jstree.plugins.unique=function(n,i){this.check=function(t,n,r,a,o){if(!1===i.check.call(this,t,n,r,a,o))return!1;if(n=n&&n.id?n:this.get_node(n),!(r=r&&r.id?r:this.get_node(r))||!r.children)return!0;var s,l,c="rename_node"===t?a:n.text,d=[],u=this.settings.unique.case_sensitive,h=this._model.data;for(s=0,l=r.children.length;s<l;s++)d.push(u?h[r.children[s]].text:h[r.children[s]].text.toLowerCase());switch(u||(c=c.toLowerCase()),t){case"delete_node":return!0;case"rename_node":return s=-1===e.inArray(c,d)||n.text&&n.text[u?"toString":"toLowerCase"]()===c,s||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_01",reason:"Child with name "+c+" already exists. Preventing: "+t,data:JSON.stringify({chk:t,pos:a,obj:!(!n||!n.id)&&n.id,par:!(!r||!r.id)&&r.id})}),s;case"create_node":return s=-1===e.inArray(c,d),s||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_04",reason:"Child with name "+c+" already exists. Preventing: "+t,data:JSON.stringify({chk:t,pos:a,obj:!(!n||!n.id)&&n.id,par:!(!r||!r.id)&&r.id})}),s;case"copy_node":return s=-1===e.inArray(c,d),s||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_02",reason:"Child with name "+c+" already exists. Preventing: "+t,data:JSON.stringify({chk:t,pos:a,obj:!(!n||!n.id)&&n.id,par:!(!r||!r.id)&&r.id})}),s;case"move_node":return s=n.parent===r.id||-1===e.inArray(c,d),s||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_03",reason:"Child with name "+c+" already exists. Preventing: "+t,data:JSON.stringify({chk:t,pos:a,obj:!(!n||!n.id)&&n.id,par:!(!r||!r.id)&&r.id})}),s}return!0},this.create_node=function(n,r,a,o,s){if(!r||r.text===t){if(null===n&&(n="#"),!(n=this.get_node(n)))return i.create_node.call(this,n,r,a,o,s);if(a=a===t?"last":a,!a.toString().match(/^(before|after)$/)&&!s&&!this.is_loaded(n))return i.create_node.call(this,n,r,a,o,s);r||(r={});var l,c,d,u,h,f=this._model.data,p=this.settings.unique.case_sensitive,_=this.settings.unique.duplicate;for(c=l=this.get_string("New node"),d=[],u=0,h=n.children.length;u<h;u++)d.push(p?f[n.children[u]].text:f[n.children[u]].text.toLowerCase());for(u=1;-1!==e.inArray(p?c:c.toLowerCase(),d);)c=_.call(this,l,++u).toString();r.text=c}return i.create_node.call(this,n,r,a,o,s)}};var p=document.createElement("DIV");p.setAttribute("unselectable","on"),p.className="jstree-wholerow",p.innerHTML="&#160;",e.jstree.plugins.wholerow=function(t,n){this.bind=function(){n.bind.call(this),this.element.on("ready.jstree set_state.jstree",e.proxy(function(){this.hide_dots()},this)).on("init.jstree loading.jstree ready.jstree",e.proxy(function(){this.get_container_ul().addClass("jstree-wholerow-ul")},this)).on("deselect_all.jstree",e.proxy(function(e,t){this.element.find(".jstree-wholerow-clicked").removeClass("jstree-wholerow-clicked")},this)).on("changed.jstree",e.proxy(function(e,t){this.element.find(".jstree-wholerow-clicked").removeClass("jstree-wholerow-clicked");var n,i,r=!1;for(n=0,i=t.selected.length;n<i;n++)(r=this.get_node(t.selected[n],!0))&&r.length&&r.children(".jstree-wholerow").addClass("jstree-wholerow-clicked")},this)).on("open_node.jstree",e.proxy(function(e,t){this.get_node(t.node,!0).find(".jstree-clicked").parent().children(".jstree-wholerow").addClass("jstree-wholerow-clicked")},this)).on("hover_node.jstree dehover_node.jstree",e.proxy(function(e,t){this.get_node(t.node,!0).children(".jstree-wholerow")["hover_node"===e.type?"addClass":"removeClass"]("jstree-wholerow-hovered")},this)).on("contextmenu.jstree",".jstree-wholerow",e.proxy(function(t){t.preventDefault();var n=e.Event("contextmenu",{metaKey:t.metaKey,ctrlKey:t.ctrlKey,altKey:t.altKey,shiftKey:t.shiftKey,pageX:t.pageX,pageY:t.pageY});e(t.currentTarget).closest(".jstree-node").children(".jstree-anchor:eq(0)").trigger(n)},this)).on("click.jstree",".jstree-wholerow",function(t){t.stopImmediatePropagation();var n=e.Event("click",{metaKey:t.metaKey,ctrlKey:t.ctrlKey,altKey:t.altKey,shiftKey:t.shiftKey});e(t.currentTarget).closest(".jstree-node").children(".jstree-anchor:eq(0)").trigger(n).focus()}).on("click.jstree",".jstree-leaf > .jstree-ocl",e.proxy(function(t){t.stopImmediatePropagation();var n=e.Event("click",{metaKey:t.metaKey,ctrlKey:t.ctrlKey,altKey:t.altKey,shiftKey:t.shiftKey});e(t.currentTarget).closest(".jstree-node").children(".jstree-anchor:eq(0)").trigger(n).focus()},this)).on("mouseover.jstree",".jstree-wholerow, .jstree-icon",e.proxy(function(e){return e.stopImmediatePropagation(),this.hover_node(e.currentTarget),!1},this)).on("mouseleave.jstree",".jstree-node",e.proxy(function(e){this.dehover_node(e.currentTarget)},this))},this.teardown=function(){this.settings.wholerow&&this.element.find(".jstree-wholerow").remove(),n.teardown.call(this)},this.redraw_node=function(t,i,r){if(t=n.redraw_node.call(this,t,i,r)){var a=p.cloneNode(!0);-1!==e.inArray(t.id,this._data.core.selected)&&(a.className+=" jstree-wholerow-clicked"),t.insertBefore(a,t.childNodes[0])}return t}}}})},13:function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0});var i=n(312),r=function(e){return e&&e.__esModule?e:{default:e}}(i),a=e.Model.extend({urlRoot:Galaxy.root+"api/libraries/",isVisible:function(e){var t=!0;return!e&&this.get("deleted")&&(t=!1),t}}),o=e.Collection.extend({urlRoot:Galaxy.root+"api/libraries",model:a,initialize:function(e){e=e||{}},search:function(e){if(""==e)return this;var t=e.toLowerCase();return this.filter(function(e){return-1!==e.get("name").toLowerCase().indexOf(t)})},getVisible:function(e,t){return t=t||[],new o(this.filter(function(t){return t.isVisible(e)}))},sortLibraries:function(e,t){this.comparator=r.default.generateLibraryComparator(e,t),this.sort()}}),s=e.Model.extend({}),l=s.extend({urlRoot:Galaxy.root+"api/libraries/datasets/"}),c=s.extend({urlRoot:Galaxy.root+"api/folders/"}),d=e.Collection.extend({model:s,sortFolder:function(e,t){this.comparator=r.default.generateFolderComparator(e,t),this.sort()}}),u=e.Model.extend({defaults:{folder:new d,urlRoot:Galaxy.root+"api/folders/",id:"unknown"},parse:function(e){this.get("folder").reset();for(var t=0;t<e.folder_contents.length;t++)if("folder"===e.folder_contents[t].type){var n=new c(e.folder_contents[t]);this.get("folder").add(n)}else if("file"===e.folder_contents[t].type){var i=new l(e.folder_contents[t]);this.get("folder").add(i)}else Galaxy.emit.error("Unknown folder item type encountered while parsing response.");return e}}),h=e.Model.extend({urlRoot:Galaxy.root+"api/histories/"}),f=e.Collection.extend({urlRoot:Galaxy.root+"api/histories/",initialize:function(e){this.id=e.id},url:function(){return this.urlRoot+this.id+"/contents"},model:h}),p=e.Model.extend({urlRoot:Galaxy.root+"api/histories/"}),_=e.Collection.extend({url:Galaxy.root+"api/histories",model:p}),g=e.Model.extend({urlRoot:Galaxy.root+"api/remote_files"});t.default={Library:a,Libraries:o,Item:l,Ldda:l,FolderAsModel:c,Folder:d,FolderContainer:u,HistoryItem:h,HistoryContents:f,GalaxyHistory:p,GalaxyHistories:_,Jstree:g}}).call(t,n(2))},18:function(e,t,n){"use strict";(function(e,n){Object.defineProperty(t,"__esModule",{value:!0});var i=e.Model.extend({defaults:{url:"https://toolshed.g2.bx.psu.edu/",name:"Galaxy Main Tool Shed"},urlRoot:Galaxy.root+"api/tool_shed"}),r=e.Collection.extend({url:Galaxy.root+"api/tool_shed",model:i}),a=e.Model.extend({defaults:[{}],urlRoot:Galaxy.root+"api/tool_shed/contents"}),o=e.Collection.extend({url:Galaxy.root+"api/tool_shed/contents",model:a}),s=e.Model.extend({defaults:[{}],urlRoot:Galaxy.root+"api/tool_shed/category"}),l=e.Collection.extend({url:Galaxy.root+"api/tool_shed/category",model:s}),c=e.Model.extend({defaults:[{}],urlRoot:Galaxy.root+"api/tool_shed/repository"}),d=e.Collection.extend({url:Galaxy.root+"api/tool_shed/repository",model:c}),u=e.Model.extend({url:"#"}),h=e.Collection.extend({url:"#",model:u,fetch:function(){var t=this,i=Array(),r=JSON.parse(localStorage.repositories),a=Object.keys(r);return n.each(a,function(e){var t=r[e];t.queue_key=e,i.push(t)}),t.reset(i),e.Collection.prototype.fetch.call(this)}}),f=e.Model.extend({defaults:[{}],urlRoot:Galaxy.root+"api/tool_shed/status"}),p=e.Collection.extend({url:Galaxy.root+"api/tool_shed/status",model:f}),_=e.Model.extend({defaults:[{}],urlRoot:Galaxy.root+"api/workflows?missing_tools=True"}),g=e.Collection.extend({url:Galaxy.root+"api/workflows?missing_tools=True",model:_});t.default={ShedModel:i,ShedsCollection:r,Category:a,Categories:o,CategoryModel:s,CategoryCollection:l,RepositoryModel:c,RepositoryCollection:d,RepoQueue:h,RepoStatus:p,WorkflowTools:g}}).call(t,n(2),n(1))},19:function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0});var n=function(t,n){var i=this,r=this.shed_url,a=Galaxy.root+"api/tool_shed/search";e.get(a,{term:t.term,tool_shed_url:r},function(e){var t=i.shedParser(e);n(t)})},i=function(t){var n=[],i=t.hits;return e.each(i,function(e){var t=i[e],r=t.repository.name+" by "+t.repository.repo_owner_username+": "+t.repository.description,a={value:t.repository.id,label:r};n.push(a)}),n},r=function(e){"/"==e.tool_shed_url.substr(-1)&&(e.tool_shed_url=e.tool_shed_url.substr(0,e.tool_shed_url.length-1));var t=e.tool_shed_url+"|"+e.repository_id+"|"+e.changeset_revision,n=new Object;localStorage.repositories&&(n=JSON.parse(localStorage.repositories)),n[t]=e,localStorage.repositories=JSON.stringify(n)},a=function(){if(localStorage.hasOwnProperty("repositories")){var e=JSON.parse(localStorage.repositories);return Object.keys(e).length}return 0};t.default={searchShed:n,shedParser:i,addToQueue:r,queueLength:a}}).call(t,n(0))},299:function(e,t,n){"use strict";(function(e){function i(e){return e&&e.__esModule?e:{default:e}}function r(t){Galaxy.user||(Galaxy.user=new k.default.User(t.user_json)),Galaxy.masthead||(Galaxy.masthead=new w.default.View(t),Galaxy.modal=new M.default.View,e("#masthead").replaceWith(Galaxy.masthead.render().$el))}function a(e){new y.default.GalaxyApp(e)}function o(e){new f.default.GalaxyApp(e)}function s(e){new _.default.GalaxyApp(e)}function l(e){new u.default(e)}function c(e){new m.default.GalaxyApp(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.bundleEntries=void 0,t.mastheadEntry=r,t.adminToolshedEntry=a,t.tracksterEntry=o,t.circsterEntry=s,t.workflowEntry=l;var d=n(300),u=i(d),h=n(85),f=i(h),p=n(309),_=i(p),g=n(311),m=i(g),v=n(321),y=i(v),b=n(34),w=i(b),x=n(25),k=i(x),j=n(8),M=i(j),C=t.bundleEntries={library:c,masthead:r,workflow:l,trackster:o,circster:s,adminToolshed:a};window.bundleEntries=C}).call(t,n(0))},300:function(e,t,n){"use strict";(function(e,i,r){function a(e){return e&&e.__esModule?e:{default:e}}function o(t){var n=e("#galaxy_tools").contents();if(0===n.length&&(n=e(document),e(this).removeClass("search_active"),n.find(".toolTitle").removeClass("search_match"),n.find(".toolSectionBody").hide(),n.find(".toolTitle").show(),n.find(".toolPanelLabel").show(),n.find(".toolSectionWrapper").each(function(){"recently_used_wrapper"!==e(this).attr("id")?e(this).show():e(this).hasClass("user_pref_visible")&&e(this).show()}),n.find("#search-no-results").hide(),n.find("#search-spinner").hide(),t)){n.find("#tool-search-query").val("search tools")}}function s(t,n){var i=y.default[n];if(i){var r=e('<i class="icon fa">&nbsp;</i>').addClass(i);t.before(r)}}Object.defineProperty(t,"__esModule",{value:!0});var l=n(3),c=a(l),d=n(4),u=a(d),h=n(301),f=a(h),p=n(302),_=a(p),g=n(303),m=a(g),v=n(62),y=a(v),b=n(308),w=a(b),x=n(6),k=a(x),j=n(80),M=a(j),C=n(7);!function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);t.default=e}(C);n(21),window.workflow_globals=window.workflow_globals||{},t.default=i.View.extend({initialize:function(t){function n(){var t=e('<form><label style="display:inline-block; width: 100%;">Save as name: </label><input type="text" id="workflow_rename" style="width: 80%;" autofocus/><br><label style="display:inline-block; width: 100%;">Annotation: </label><input type="text" id="wf_annotation" style="width: 80%;" /></form>');window.show_modal("Save As a New Workflow",t,{OK:function(){var t=e("#workflow_rename").val().length>0?e("#workflow_rename").val():"SavedAs_"+l.workflow.name,n=e("#wf_annotation").val().length>0?e("#wf_annotation").val():"";e.ajax({url:l.urls.workflow_save_as,type:"POST",data:{workflow_name:t,workflow_annotation:n,workflow_data:function(){return JSON.stringify(l.workflow.to_simple())}}}).done(function(e){window.onbeforeunload=void 0,window.location=Galaxy.root+"workflow/editor?id="+e,hide_modal()}).fail(function(){hide_modal(),alert("Saving this workflow failed. Please contact this site's administrator.")})},Cancel:hide_modal})}function i(){l.workflow.layout(),l.workflow.fit_canvas_to_nodes(),l.scroll_to_nodes(),l.canvas_manager.draw_overview()}function a(){e.jStorage.set("overview-off",!1),e("#overview-border").css("right","0px"),e("#close-viewport").css("background-position","0px 0px")}function s(){e.jStorage.set("overview-off",!0),e("#overview-border").css("right","20000px"),e("#close-viewport").css("background-position","12px 0px")}var l=window.workflow_globals.app=this;this.options=t,this.urls=t&&t.urls||{};var c=function(){if(l.workflow.check_changes_in_active_form(),workflow&&l.workflow.has_changes){var e=function(){window.onbeforeunload=void 0,window.document.location=l.urls.workflow_index};window.show_modal("Close workflow editor","There are unsaved changes to your workflow which will be lost.",{Cancel:hide_modal,"Save Changes":function(){d(null,e)}},{"Don't Save":e})}else window.document.location=l.urls.workflow_index},d=function(t,n){if(show_message("Saving workflow","progress"),l.workflow.check_changes_in_active_form(),!l.workflow.has_changes)return hide_modal(),void(n&&n());l.workflow.rectify_workflow_outputs(),u.default.request({url:Galaxy.root+"api/workflows/"+l.options.id,type:"PUT",data:{workflow:l.workflow.to_simple()},success:function(t){var i=e("<div/>").text(t.message);if(t.errors){i.addClass("warningmark");var r=e("<ul/>");e.each(t.errors,function(t,n){e("<li/>").text(n).appendTo(r)}),i.append(r)}else i.addClass("donemark");l.workflow.name=t.name,l.workflow.has_changes=!1,l.workflow.stored=!0,l.showWorkflowParameters(),t.errors?window.show_modal("Saving workflow",i,{Ok:hide_modal}):(n&&n(),hide_modal())},error:function(e){window.show_modal("Saving workflow failed.",e.err_msg,{Ok:hide_modal})}})};e("#tool-search-query").click(function(){e(this).focus(),e(this).select()}).keyup(function(){if(e(this).css("font-style","normal"),this.value.length<3)o(!1);else if(this.value!=this.lastValue){e(this).addClass("search_active");var t=this.value;this.timer&&clearTimeout(this.timer),e("#search-spinner").show(),this.timer=setTimeout(function(){e.get(l.urls.tool_search,{q:t},function(t){if(e("#search-no-results").hide(),e(".toolSectionWrapper").hide(),e(".toolSectionWrapper").find(".toolTitle").hide(),0!=t.length){var n=e.map(t,function(e,t){return"link-"+e});e(n).each(function(t,n){e("[id='"+n+"']").parent().addClass("search_match"),e("[id='"+n+"']").parent().show().parent().parent().show().parent().show()}),e(".toolPanelLabel").each(function(){for(var t=e(this),n=t.next(),i=!0;0!==n.length&&n.hasClass("toolTitle");){if(n.is(":visible")){i=!1;break}n=n.next()}i&&t.hide()})}else e("#search-no-results").show();e("#search-spinner").hide()},"json")},400)}this.lastValue=this.value}),this.canvas_manager=window.workflow_globals.canvas_manager=new _.default(this,e("#canvas-viewport"),e("#overview")),this.reset(),this.datatypes=JSON.parse(e.ajax({url:Galaxy.root+"api/datatypes",async:!1}).responseText),this.datatypes_mapping=JSON.parse(e.ajax({url:Galaxy.root+"api/datatypes/mapping",async:!1}).responseText),this.ext_to_type=this.datatypes_mapping.ext_to_class_name,this.type_to_type=this.datatypes_mapping.class_to_classes,this._workflowLoadAjax(l.options.id,{success:function(e){l.reset(),l.workflow.from_simple(e,!0),l.workflow.has_changes=!1,l.workflow.fit_canvas_to_nodes(),l.scroll_to_nodes(),l.canvas_manager.draw_overview();var t="";r.each(e.steps,function(n,i){var a="";n.errors&&(a+="<li>"+n.errors+"</li>"),r.each(e.upgrade_messages[i],function(e){a+="<li>"+e+"</li>"}),a&&(t+="<li>Step "+(parseInt(i,10)+1)+": "+l.workflow.nodes[i].name+"<ul>"+a+"</ul></li>")}),t?window.show_modal("Issues loading this workflow","Please review the following issues, possibly resulting from tool upgrades or changes.<p><ul>"+t+"</ul></p>",{Continue:hide_modal}):hide_modal(),l.showWorkflowParameters()},beforeSubmit:function(e){show_message("Loading workflow","progress")}}),window.make_popupmenu&&make_popupmenu(e("#workflow-options-button"),{Save:d,"Save As":n,Run:function(){window.location=Galaxy.root+"workflows/run?id="+l.options.id},"Edit Attributes":function(){l.workflow.clear_active_node()},"Auto Re-layout":i,Close:c});var h=e.jStorage.get("overview-size");void 0!==h&&e("#overview-border").css({width:h,height:h}),e.jStorage.get("overview-off")?s():a(),e("#overview-border").bind("dragend",function(t,n){var i=e(this).offsetParent(),r=i.offset(),a=Math.max(i.width()-(n.offsetX-r.left),i.height()-(n.offsetY-r.top));e.jStorage.set("overview-size",a+"px")}),e("#close-viewport").click(function(){"0px"===e("#overview-border").css("right")?s():a()}),window.onbeforeunload=function(){if(workflow&&l.workflow.has_changes)return"There are unsaved changes to your workflow which will be lost."},this.options.workflows.length>0&&e("#left").find(".toolMenu").append(this._buildToolPanelWorkflows()),e("div.toolSectionBody").hide(),e("div.toolSectionTitle > span").wrap("<a href='#'></a>");var f=null;e("div.toolSectionTitle").each(function(){var t=e(this).next("div.toolSectionBody");e(this).click(function(){t.is(":hidden")?(f&&f.slideUp("fast"),f=t,t.slideDown("fast")):(t.slideUp("fast"),f=null)})}),(0,M.default)("workflow-name","workflow-name",l.urls.rename_async,"new_name"),e("#workflow-tag").click(function(){return e(".tag-area").click(),!1}),(0,M.default)("workflow-annotation","workflow-annotation",l.urls.annotate_async,"new_annotation",25,!0,4)},_buildToolPanelWorkflows:function(){var t=this,n=e('<div class="toolSectionWrapper"><div class="toolSectionTitle"><a href="#"><span>Workflows</span></a></div><div class="toolSectionBody"><div class="toolSectionBg"/></div></div>');return r.each(this.options.workflows,function(i){if(i.id!==t.options.id){var r=new k.default.ButtonIcon({icon:"fa fa-copy",cls:"ui-button-icon-plain",tooltip:(0,c.default)("Copy and insert individual steps"),onclick:function(){i.step_count<2?t.copy_into_workflow(i.id,i.name):Galaxy.modal.show({title:(0,c.default)("Warning"),body:"This will copy "+i.step_count+" new steps into your workflow.",buttons:{Cancel:function(){Galaxy.modal.hide()},Copy:function(){Galaxy.modal.hide(),t.copy_into_workflow(i.id,i.name)}}})}}),a=e("<a/>").attr("href","#").html(i.name).on("click",function(){t.add_node_for_subworkflow(i.latest_id,i.name)});n.find(".toolSectionBg").append(e("<div/>").addClass("toolTitle").append(a).append(r.$el))}}),n},copy_into_workflow:function(t){var n=this;this._workflowLoadAjax(t,{success:function(t){n.workflow.from_simple(t,!1);var i="";e.each(t.upgrade_messages,function(t,r){i+="<li>Step "+(parseInt(t,10)+1)+": "+n.workflow.nodes[t].name+"<ul>",e.each(r,function(e,t){i+="<li>"+t+"</li>"}),i+="</ul></li>"}),i?window.show_modal("Subworkflow embedded with changes","Problems were encountered loading this workflow (possibly a result of tool upgrades). Please review the following parameters and then save.<ul>"+i+"</ul>",{Continue:hide_modal}):hide_modal()},beforeSubmit:function(e){show_message("Importing workflow","progress")}})},reset:function(){this.workflow&&this.workflow.remove_all(),this.workflow=window.workflow_globals.workflow=new f.default(this,e("#canvas-container"))},scroll_to_nodes:function(){var t,n,i=e("#canvas-viewport"),r=e("#canvas-container");n=r.width()<i.width()?(i.width()-r.width())/2:0,t=r.height()<i.height()?(i.height()-r.height())/2:0,r.css({left:n,top:t})},_workflowLoadAjax:function(t,n){e.ajax(u.default.merge(n,{url:this.urls.load_workflow,data:{id:t,_:"true"},dataType:"json",cache:!1}))},_moduleInitAjax:function(e,t){var n=this;u.default.request({type:"POST",url:Galaxy.root+"api/workflows/build_module",data:t,success:function(t){e.init_field_data(t),e.update_field_data(t),n.workflow.activate_node(e)}})},add_node_for_tool:function(e,t){var n=this.workflow.create_node("tool",t,e);this._moduleInitAjax(n,{type:"tool",tool_id:e,_:"true"})},add_node_for_subworkflow:function(e,t){var n=this.workflow.create_node("subworkflow",t,e);this._moduleInitAjax(n,{type:"subworkflow",content_id:e,_:"true"})},add_node_for_module:function(e,t){var n=this.workflow.create_node(e,t);this._moduleInitAjax(n,{type:e,_:"true"})},display_file_list:function(e){var t="<select id='node_data_list' name='node_data_list'>";for(var n in e.output_terminals)t+="<option value='"+n+"'>"+n+"</option>";return t+="</select>"},showWorkflowParameters:function(){var t=/\$\{.+?\}/g,n=[],i=e("#workflow-parameters-container"),r=e("#workflow-parameters-box"),a="",o=[];e.each(this.workflow.nodes,function(i,r){r.config_form&&r.config_form.inputs&&u.default.deepeach(r.config_form.inputs,function(e){if("string"==typeof e.value){var n=e.value.match(t);n&&(o=o.concat(n))}}),r.post_job_actions&&e.each(r.post_job_actions,function(n,i){i.action_arguments&&e.each(i.action_arguments,function(e,n){var i=n.match(t);i&&(o=o.concat(i))})}),o&&e.each(o,function(t,i){-1===e.inArray(i,n)&&n.push(i)})}),n&&0!==n.length?(e.each(n,function(e,t){a+="<div>"+t.substring(2,t.length-1)+"</div>"}),i.html(a),r.show()):(i.html(a),r.hide())},showAttributes:function(){e(".right-content").hide(),e("#edit-attributes").show()},showForm:function(t,n){var i="right-content",r=i+"-"+n.id,a=e("#"+i);if(t&&0==a.find("#"+r).length){var o=e('<div id="'+r+'" class="'+i+'"/>');if(t.node=n,t.workflow=this.workflow,t.datatypes=this.datatypes,t.icon=y.default[n.type],t.cls="ui-portlet-narrow",n){var s="tool"==n.type?"Tool":"Default";o.append(new w.default[s](t).form.$el),a.append(o)}else Galaxy.emit.debug("workflow-view::initialize()","Node not found in workflow.")}e("."+i).hide(),a.find("#"+r).show(),a.show(),a.scrollTop()},isSubType:function(e,t){return e=this.ext_to_type[e],t=this.ext_to_type[t],this.type_to_type[e]&&t in this.type_to_type[e]},prebuildNode:function(t,n,i){var r=this,a=e("<div class='toolForm toolFormInCanvas'/>"),o=e("<div class='toolFormTitle unselectable'><span class='nodeTitle'>"+n+"</div></div>");s(o.find(".nodeTitle"),t),a.append(o),a.css("left",e(window).scrollLeft()+20),a.css("top",e(window).scrollTop()+20),a.append(e("<div class='toolFormBody'></div>"));var l=new m.default(this,{element:a});l.type=t,l.content_id=i;var c="<div><img height='16' align='middle' src='"+Galaxy.root+"static/images/loading_small_white_bg.gif'/> loading tool info...</div>";a.find(".toolFormBody").append(c);var d=e("<div class='buttons' style='float: right;'></div>");"subworkflow"!==t&&d.append(e("<div/>").addClass("fa-icon-button fa fa-files-o").click(function(e){l.clone()})),d.append(e("<div/>").addClass("fa-icon-button fa fa-times").click(function(e){l.destroy()})),a.appendTo("#canvas-container");var u=e("#canvas-container").position(),h=e("#canvas-container").parent(),f=a.width(),p=a.height();return a.css({left:-u.left+h.width()/2-f/2,top:-u.top+h.height()/2-p/2}),d.prependTo(a.find(".toolFormTitle")),f+=d.width()+10,a.css("width",f),a.bind("dragstart",function(){r.workflow.activate_node(l)}).bind("dragend",function(){r.workflow.node_changed(this),r.workflow.fit_canvas_to_nodes(),r.canvas_manager.draw_overview()}).bind("dragclickonly",function(){r.workflow.activate_node(l)}).bind("drag",function(t,n){var i=e(this).offsetParent().offset(),r=n.offsetX-i.left,a=n.offsetY-i.top;e(this).css({left:r,top:a}),e(this).find(".terminal").each(function(){this.terminal.redraw()})}),l}})}).call(t,n(0),n(2),n(1))},301:function(e,t,n){"use strict";(function(e){function i(e,t){this.app=e,this.canvas_container=t,this.id_counter=0,this.nodes={},this.name=null,this.has_changes=!1,this.active_form_has_changes=!1,this.workflowOutputLabels={}}Object.defineProperty(t,"__esModule",{value:!0});var r=n(125),a=function(e){return e&&e.__esModule?e:{default:e}}(r),o=n(7),s=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(o);e.extend(i.prototype,{canLabelOutputWith:function(e){return!e||!(e in this.workflowOutputLabels)},registerOutputLabel:function(e){e&&(this.workflowOutputLabels[e]=!0)},unregisterOutputLabel:function(e){e&&delete this.workflowOutputLabels[e]},updateOutputLabel:function(e,t){e&&this.unregisterOutputLabel(e),this.canLabelOutputWith(t)||s.warning("Workflow contains duplicate workflow output labels "+t+". This must be fixed before it can be saved."),t&&this.registerOutputLabel(t)},attemptUpdateOutputLabel:function(e,t,n){return!!this.canLabelOutputWith(n)&&(e.labelWorkflowOutput(t,n),e.nodeView.redrawWorkflowOutputs(),!0)},create_node:function(e,t,n){var i=this.app.prebuildNode(e,t,n);return this.add_node(i),this.fit_canvas_to_nodes(),this.app.canvas_manager.draw_overview(),this.activate_node(i),i},add_node:function(e){e.id=this.id_counter,e.element.attr("id","wf-node-step-"+e.id),this.id_counter++,this.nodes[e.id]=e,this.has_changes=!0,e.workflow=this},remove_node:function(e){this.active_node==e&&this.clear_active_node(),delete this.nodes[e.id],this.has_changes=!0},remove_all:function(){var t=this;e.each(this.nodes,function(e,n){n.destroy(),t.remove_node(n)})},rectify_workflow_outputs:function(){var t=!1,n=!1;if(e.each(this.nodes,function(i,r){r.workflow_outputs&&r.workflow_outputs.length>0&&(t=!0),e.each(r.post_job_actions,function(e,t){"HideDatasetAction"===t.action_type&&(n=!0)})}),!1!==t||!1!==n){var i=this;e.each(this.nodes,function(n,r){if("tool"===r.type){var a=!1;null===r.post_job_actions&&(r.post_job_actions={},a=!0);var o=[];e.each(r.post_job_actions,function(e,t){"HideDatasetAction"==t.action_type&&o.push(e)}),o.length>0&&e.each(o,function(e,t){a=!0,delete r.post_job_actions[t]}),t&&e.each(r.output_terminals,function(e,t){if(!0==!r.isWorkflowOutput(t.name)){a=!0;var n={action_type:"HideDatasetAction",output_name:t.name,action_arguments:{}};r.post_job_actions["HideDatasetAction"+t.name]=null,r.post_job_actions["HideDatasetAction"+t.name]=n}}),i.active_node==r&&!0===a&&i.reload_active_node()}})}},to_simple:function(){var t={};return e.each(this.nodes,function(n,i){var r={};e.each(i.input_terminals,function(t,n){r[n.name]=null;var i=[];e.each(n.connectors,function(e,t){if(t.handle1){var a={id:t.handle1.node.id,output_name:t.handle1.name},o=n.attributes.input.input_subworkflow_step_id;void 0!==o&&(a.input_subworkflow_step_id=o),i[e]=a,r[n.name]=i}})});var a={};i.post_job_actions&&e.each(i.post_job_actions,function(e,t){var n={action_type:t.action_type,output_name:t.output_name,action_arguments:t.action_arguments};a[t.action_type+t.output_name]=null,a[t.action_type+t.output_name]=n}),i.workflow_outputs||(i.workflow_outputs=[]);var o={id:i.id,type:i.type,content_id:i.content_id,tool_version:i.config_form.version,tool_state:i.tool_state,errors:i.errors,input_connections:r,position:e(i.element).position(),annotation:i.annotation,post_job_actions:i.post_job_actions,uuid:i.uuid,label:i.label,workflow_outputs:i.workflow_outputs};t[i.id]=o}),{steps:t}},from_simple:function(t,n){var i=void 0===n||n,r=this,o=0;i?r.name=t.name:o=Object.keys(r.nodes).length;var s=o,l=!1;e.each(t.steps,function(t,n){var a=r.app.prebuildNode(n.type,n.name,n.content_id);i||(n.uuid=null,e.each(n.workflow_outputs,function(e,t){t.uuid=null})),a.init_field_data(n),n.position&&a.element.css({top:n.position.top,left:n.position.left}),a.id=parseInt(n.id)+o,r.nodes[a.id]=a,s=Math.max(s,parseInt(t)+o),l||(a.workflow_outputs.length>0?l=!0:e.each(a.post_job_actions||[],function(e,t){"HideDatasetAction"===t.action_type&&(l=!0)}))}),r.id_counter=s+1,e.each(t.steps,function(t,n){var i=r.nodes[parseInt(t)+o];e.each(n.input_connections,function(t,n){n&&(e.isArray(n)||(n=[n]),e.each(n,function(e,n){var s=r.nodes[parseInt(n.id)+o],l=new a.default;l.connect(s.output_terminals[n.output_name],i.input_terminals[t]),l.redraw()}))}),l&&e.each(i.output_terminals,function(t,n){if(void 0===i.post_job_actions["HideDatasetAction"+n.name]){i.addWorkflowOutput(n.name);e(i.element).find(".callout."+n.name).find("img").attr("src",Galaxy.root+"static/images/fugue/asterisk-small.png"),r.has_changes=!0}})})},check_changes_in_active_form:function(){this.active_form_has_changes&&(this.has_changes=!0,e("#right-content").find("form").submit(),this.active_form_has_changes=!1)},reload_active_node:function(){if(this.active_node){var e=this.active_node;this.clear_active_node(),this.activate_node(e)}},clear_active_node:function(){this.active_node&&(this.active_node.make_inactive(),this.active_node=null),document.activeElement.blur(),this.app.showAttributes()},activate_node:function(e){this.active_node!=e&&(this.check_changes_in_active_form(),this.clear_active_node(),this.app.showForm(e.config_form,e),e.make_active(),this.active_node=e)},node_changed:function(e,t){this.has_changes=!0,this.active_node==e&&t&&(this.check_changes_in_active_form(),this.app.showForm(e.config_form,e)),this.app.showWorkflowParameters()},layout:function(){this.check_changes_in_active_form(),this.has_changes=!0;var t={},n={};e.each(this.nodes,function(e,i){void 0===t[e]&&(t[e]=0),void 0===n[e]&&(n[e]=[])}),e.each(this.nodes,function(i,r){e.each(r.input_terminals,function(i,a){e.each(a.connectors,function(e,i){var a=i.handle1.node;t[r.id]+=1,n[a.id].push(r.id)})})});for(var i=[];;){var r=[];for(var a in t)0===t[a]&&r.push(a);if(0===r.length)break;i.push(r);for(var o in r){var s=r[o];delete t[s];for(var l in n[s])t[n[s][l]]-=1}}if(!t.length){var c=this.nodes,d=80;e.each(i,function(t,n){n.sort(function(t,n){return e(c[t].element).position().top-e(c[n].element).position().top});var i=0,r=30;e.each(n,function(t,n){var a=c[n],o=e(a.element);e(o).css({top:r,left:d}),i=Math.max(i,e(o).width()),r+=e(o).height()+30}),d+=i+80}),e.each(c,function(e,t){t.redraw()})}},bounds_for_all_nodes:function(){var t,n=1/0,i=-1/0,r=1/0,a=-1/0;return e.each(this.nodes,function(o,s){var l=e(s.element);t=l.position(),n=Math.min(n,t.left),i=Math.max(i,t.left+l.width()),r=Math.min(r,t.top),a=Math.max(a,t.top+l.width())}),{xmin:n,xmax:i,ymin:r,ymax:a}},fit_canvas_to_nodes:function(){function t(e,t){return Math.ceil(e/t)*t}function n(e,t){if(e<t||e>3*t){return-(e-(Math.ceil(e%t/t)+1)*t)}return 0}var i=this.bounds_for_all_nodes(),r=this.canvas_container.position(),a=this.canvas_container.parent(),o=n(i.xmin,100),s=n(i.ymin,100);o=Math.max(o,r.left),s=Math.max(s,r.top);var l=r.left-o,c=r.top-s,d=t(i.xmax+100,100)+o,u=t(i.ymax+100,100)+s;d=Math.max(d,-l+a.width()),u=Math.max(u,-c+a.height()),this.canvas_container.css({left:l,top:c,width:d,height:u}),this.canvas_container.children().each(function(){var t=e(this).position();e(this).css("left",t.left+o),e(this).css("top",t.top+s)})}}),t.default=i}).call(t,n(0))},302:function(e,t,n){"use strict";(function(e){function n(e,t,n){this.app=e,this.cv=t,this.cc=this.cv.find("#canvas-container"),this.overview=n,this.oc=n.find("#overview-canvas"),this.ov=n.find("#overview-viewport"),this.init_drag(),this.init_copy_paste()}function i(e){this.panel=e}Object.defineProperty(t,"__esModule",{value:!0}),e.extend(n.prototype,{init_drag:function(){var t=this,n=function(e,n){e=Math.min(e,t.cv.width()/2),e=Math.max(e,-t.cc.width()+t.cv.width()/2),n=Math.min(n,t.cv.height()/2),n=Math.max(n,-t.cc.height()+t.cv.height()/2),t.cc.css({left:e,top:n}),t.cv.css({"background-position-x":e,"background-position-y":n}),t.update_viewport_overlay()};this.cc.each(function(){this.scroll_panel=new i(this)});var r,a;this.cv.bind("click",function(){document.activeElement.blur()}).bind("dragstart",function(){var n=e(this).offset(),i=t.cc.position();a=i.top-n.top,r=i.left-n.left}).bind("drag",function(e,t){n(t.offsetX+r,t.offsetY+a)}).bind("dragend",function(){t.app.workflow.fit_canvas_to_nodes(),t.draw_overview()}),this.overview.click(function(e){if(t.overview.hasClass("blockaclick"))t.overview.removeClass("blockaclick");else{var i=t.cc.width(),r=t.cc.height(),a=t.oc.width(),o=t.oc.height(),s=e.pageX-t.oc.offset().left-t.ov.width()/2,l=e.pageY-t.oc.offset().top-t.ov.height()/2;n(-s/a*i,-l/o*r),t.app.workflow.fit_canvas_to_nodes(),t.draw_overview()}}),this.ov.bind("drag",function(e,i){var r=t.cc.width(),a=t.cc.height(),o=t.oc.width(),s=t.oc.height(),l=i.offsetX-t.overview.offset().left,c=i.offsetY-t.overview.offset().top;n(-l/o*r,-c/s*a)}).bind("dragend",function(){t.overview.addClass("blockaclick"),t.app.workflow.fit_canvas_to_nodes(),t.draw_overview()}),e("#overview-border").bind("drag",function(n,i){var r=e(this).offsetParent(),a=r.offset(),o=Math.max(r.width()-(i.offsetX-a.left),r.height()-(i.offsetY-a.top));e(this).css({width:o,height:o}),t.draw_overview()}),e("#overview-border div").bind("drag",function(){})},init_copy_paste:function(){var e=this;document.addEventListener("copy",function(t){""===window.getSelection().toString()&&(e.app.workflow.active_node&&"subworkflow"!==e.app.workflow.active_node.type&&t.clipboardData.setData("application/json",JSON.stringify({nodeId:e.app.workflow.active_node.id})),t.preventDefault())}),document.addEventListener("paste",function(t){if(document.activeElement&&"textarea"!==document.activeElement.type&&"text"!==document.activeElement.type){var n;try{n=JSON.parse(t.clipboardData.getData("application/json")).nodeId}catch(e){}n&&e.app.workflow.nodes.hasOwnProperty(n)&&e.app.workflow.nodes[n].clone(),t.preventDefault()}})},update_viewport_overlay:function(){var e=this.cc,t=this.cv,n=this.oc,i=this.ov,r=e.width(),a=e.height(),o=n.width(),s=n.height(),l=e.position();i.css({left:-l.left/r*o,top:-l.top/a*s,width:t.width()/r*o-2,height:t.height()/a*s-2})},draw_overview:function(){var t,n,i,r,a=e("#overview-canvas"),o=a.parent().parent().width(),s=a.get(0).getContext("2d"),l=e("#canvas-container").width(),c=e("#canvas-container").height(),d=this.cv.width(),u=this.cv.height();l<d&&c<u?(i=l/d*o,r=(o-i)/2,t=c/u*o,n=(o-t)/2):l<c?(n=0,t=o,i=Math.ceil(t*l/c),r=(o-i)/2):(i=o,r=0,t=Math.ceil(i*c/l),n=(o-t)/2),a.parent().css({left:r,top:n,width:i,height:t}),a.attr("width",i),a.attr("height",t),e.each(this.app.workflow.nodes,function(n,r){s.fillStyle="#D2C099",s.strokeStyle="#D8B365",s.lineWidth=1;var a=e(r.element),o=a.position(),d=o.left/l*i,u=o.top/c*t,h=a.width()/l*i,f=a.height()/c*t;r.errors?(s.fillStyle="#FFCCCC",s.strokeStyle="#AA6666"):void 0!==r.workflow_outputs&&r.workflow_outputs.length>0&&(s.fillStyle="#E8A92D",s.strokeStyle="#E8A92D"),s.fillRect(d,u,h,f),s.strokeRect(d,u,h,f)}),this.update_viewport_overlay()}}),e.extend(i.prototype,{test:function(t,n){var i=this;clearTimeout(this.timeout);var r=t.pageX,a=t.pageY,o=e(this.panel),s=o.position(),l=o.width(),c=o.height(),d=o.parent(),u=d.width(),h=d.height(),f=d.offset(),p=f.left,_=f.top,g=p+d.width(),m=_+d.height(),v=-(l-u/2),y=-(c-h/2),b=u/2,w=h/2,x=!1,k=0;r-5<p?s.left<b&&(k=Math.min(23,b-s.left),o.css("left",s.left+k),x=!0):r+5>g?s.left>v&&(k=Math.min(23,s.left-v),o.css("left",s.left-k),x=!0):a-5<_?s.top<w&&(k=Math.min(23,w-s.top),o.css("top",s.top+k),x=!0):a+5>m&&s.top>y&&(k=Math.min(23,s.top-v),o.css("top",s.top-k+"px"),x=!0),x&&(n(),this.timeout=setTimeout(function(){i.test(t,n)},50))},stop:function(){clearTimeout(this.timeout)}}),t.default=n}).call(t,n(0))},303:function(e,t,n){"use strict";(function(e,i,r){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(4),s=a(o),l=n(304),c=a(l),d=e.Model.extend({initialize:function(e,t){this.app=e,this.element=t.element,this.input_terminals={},this.output_terminals={},this.errors={},this.workflow_outputs=[]},getWorkflowOutput:function(e){return i.findWhere(this.workflow_outputs,{output_name:e})},isWorkflowOutput:function(e){return void 0!==this.getWorkflowOutput(e)},removeWorkflowOutput:function(e){for(;this.isWorkflowOutput(e);)this.workflow_outputs.splice(this.getWorkflowOutput(e),1)},addWorkflowOutput:function(e,t){if(!this.isWorkflowOutput(e)){var n={output_name:e};return t&&(n.label=t),this.workflow_outputs.push(n),!0}return!1},labelWorkflowOutput:function(e,t){var n=!1,i=null;if(this.isWorkflowOutput(e)){var r=this.getWorkflowOutput(e);i=r.label,r.label=t,n=i!=t}else n=this.addWorkflowOutput(e,t);return n&&(this.app.workflow.updateOutputLabel(i,t),this.markChanged(),this.nodeView.redrawWorkflowOutputs()),n},connectedOutputTerminals:function(){return this._connectedTerminals(this.output_terminals)},_connectedTerminals:function(e){var t=[];return r.each(e,function(e,n){n.connectors.length>0&&t.push(n)}),t},hasConnectedOutputTerminals:function(){var e=this.output_terminals;for(var t in e)if(e[t].connectors.length>0)return!0;return!1},connectedMappedInputTerminals:function(){return this._connectedMappedTerminals(this.input_terminals)},hasConnectedMappedInputTerminals:function(){var e=this.input_terminals;for(var t in e){var n=e[t];if(n.connectors.length>0&&n.isMappedOver())return!0}return!1},_connectedMappedTerminals:function(e){var t=[];return r.each(e,function(e,n){n.mapOver().isCollection&&n.connectors.length>0&&t.push(n)}),t},mappedInputTerminals:function(){return this._mappedTerminals(this.input_terminals)},_mappedTerminals:function(e){var t=[];return r.each(e,function(e,n){n.mapOver().isCollection&&t.push(n)}),t},hasMappedOverInputTerminals:function(){var e=!1;return i.each(this.input_terminals,function(t){t.mapOver().isCollection&&(e=!0)}),e},redraw:function(){r.each(this.input_terminals,function(e,t){t.redraw()}),r.each(this.output_terminals,function(e,t){t.redraw()})},clone:function(){var e=this,t={name:this.name,label:this.label,annotation:this.annotation,post_job_actions:this.post_job_actions},n=this.app.workflow.create_node(this.type,this.name,this.content_id);s.default.request({type:"POST",url:Galaxy.root+"api/workflows/build_module",data:{type:this.type,tool_id:this.content_id,inputs:this.tool_state},success:function(i){var r=Object.assign({},i,t);n.init_field_data(r),n.update_field_data(r),e.app.workflow.activate_node(n)}})},destroy:function(){r.each(this.input_terminals,function(e,t){t.destroy()}),r.each(this.output_terminals,function(e,t){t.destroy()}),this.app.workflow.remove_node(this),r(this.element).remove()},make_active:function(){r(this.element).addClass("toolForm-active")},make_inactive:function(){var e=this.element.get(0);!function(t){t.removeChild(e),t.appendChild(e)}(e.parentNode),r(e).removeClass("toolForm-active")},init_field_data:function(e){e.type&&(this.type=e.type),this.name=e.name,this.config_form=e.config_form,this.tool_version=this.config_form&&this.config_form.version,this.tool_state=e.tool_state,this.errors=e.errors,this.tooltip=e.tooltip?e.tooltip:"",this.annotation=e.annotation,this.post_job_actions=e.post_job_actions?e.post_job_actions:{},this.label=e.label,this.uuid=e.uuid,this.workflow_outputs=e.workflow_outputs?e.workflow_outputs:[];var t=this,n=new c.default({el:this.element[0],node:t});t.nodeView=n,r.each(e.data_inputs,function(e,t){n.addDataInput(t)}),e.data_inputs.length>0&&e.data_outputs.length>0&&n.addRule(),r.each(e.data_outputs,function(e,t){n.addDataOutput(t)}),n.render(),this.app.workflow.node_changed(this,!0)},update_field_data:function(e){var t=this,n=t.nodeView,a=[];if(r.each(n.outputViews,function(t,n){var r=n.output.name,o=e.data_outputs,s=!1;i.each(o,function(e){e.name==r&&(s=!0)}),!1===s&&a.push(r)}),i.each(a,function(e){i.each(n.outputViews[e].terminalElement.terminal.connectors,function(e){e&&e.destroy()}),n.outputViews[e].remove(),delete n.outputViews[e],delete t.output_terminals[e]}),r.each(t.workflow_outputs,function(e,n){n&&!t.output_terminals[n.output_name]&&t.workflow_outputs.splice(e,1)}),r.each(e.data_outputs,function(e,i){n.outputViews[i.name]?(t.output_terminals[i.name].datatypes=i.extensions,t.output_terminals[i.name].destroyInvalidConnections()):n.addDataOutput(i)}),this.tool_state=e.tool_state,this.config_form=e.config_form,this.tool_version=this.config_form&&this.config_form.version,this.errors=e.errors,this.annotation=e.annotation,this.label=e.label,"post_job_actions"in e){var o=e.post_job_actions;this.post_job_actions=o||{}}t.nodeView.renderToolErrors();var s=n.$("div.inputs"),l=n.newInputsDiv(),c={};i.each(e.data_inputs,function(e){var n=t.nodeView.addDataInput(e,l);c[e.name]=n}),i.each(i.difference(i.values(n.terminalViews),i.values(c)),function(e){e.el.terminal.destroy()}),n.terminalViews=c,t.nodeView.render(),1==e.data_outputs.length&&"collection_type"in e.data_outputs[0]&&n.updateDataOutput(e.data_outputs[0]),s.replaceWith(l),"workflow_outputs"in e&&(this.workflow_outputs=e.workflow_outputs?e.workflow_outputs:[]),this.markChanged(),this.redraw()},error:function(e){var t=r(this.element).find(".toolFormBody");t.find("div").remove();var n="<div style='color: red; text-style: italic;'>"+e+"</div>";this.config_form=n,t.html(n),this.app.workflow.node_changed(this)},markChanged:function(){this.app.workflow.node_changed(this)}});t.default=d}).call(t,n(2),n(1),n(0))},304:function(e,t,n){"use strict";(function(e,i){function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var a=n(1),o=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(a),s=n(305),l=r(s),c=n(307),d=r(c);t.default=e.View.extend({initialize:function(e){this.node=e.node,this.output_width=Math.max(150,this.$el.width()),this.tool_body=this.$el.find(".toolFormBody"),this.tool_body.find("div").remove(),this.newInputsDiv().appendTo(this.tool_body),this.terminalViews={},this.outputViews={}},render:function(){this.renderToolLabel(),this.renderToolErrors(),this.$el.css("width",Math.min(250,Math.max(this.$el.width(),this.output_width)))},renderToolLabel:function(){this.$(".nodeTitle").text(this.node.label||this.node.name)},renderToolErrors:function(){this.node.errors?this.$el.addClass("tool-node-error"):this.$el.removeClass("tool-node-error")},newInputsDiv:function(){return i("<div/>").addClass("inputs")},updateMaxWidth:function(e){this.output_width=Math.max(this.output_width,e)},addRule:function(){this.tool_body.append(i("<div/>").addClass("rule"))},addDataInput:function(e,t){var n=!0;t||(t=this.$(".inputs"),n=!1);var i=this.terminalViews[e.name],r="dataset_collection"==e.input_type?l.default.InputCollectionTerminalView:l.default.InputTerminalView;if(!i||i instanceof r||(i.el.terminal.destroy(),i=null),i){var a=i.el.terminal;a.update(e),a.destroyInvalidConnections()}else i=new r({node:this.node,input:e});this.terminalViews[e.name]=i;var o=i.el,s=new d.default.DataInputView({terminalElement:o,input:e,nodeView:this,skipResize:n}),c=s.$el;return t.append(c.prepend(i.terminalElements())),i},addDataOutput:function(e){var t=e.collection?l.default.OutputCollectionTerminalView:l.default.OutputTerminalView,n=new t({node:this.node,output:e}),i=new d.default.DataOutputView({output:e,terminalElement:n.el,nodeView:this});this.outputViews[e.name]=i,this.tool_body.append(i.$el.append(n.terminalElements()))},redrawWorkflowOutputs:function(){o.each(this.outputViews,function(e){e.redrawWorkflowOutput()})},updateDataOutput:function(e){this.node.output_terminals[e.name].update(e)}})}).call(t,n(2),n(0))},305:function(e,t,n){"use strict";(function(e,i,r){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(306),s=a(o),l=n(125),c=a(l);window.workflow_globals=window.workflow_globals||{};var d=e.View.extend({tagName:"div",className:"fa-icon-button fa fa-folder-o",initialize:function(e){this.$el.tooltip({delay:500,title:"Run tool in parallel over collection"}),this.model.bind("change",i.bind(this.render,this))},render:function(){this.model.mapOver.isCollection?this.$el.show():this.$el.hide()}}),u=d.extend({events:{click:"onClick",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave"},onMouseEnter:function(e){var t=this.model;!t.terminal.connected()&&t.mapOver.isCollection&&this.$el.css("color","red")},onMouseLeave:function(e){this.$el.css("color","black")},onClick:function(e){var t=this.model;!t.terminal.connected()&&t.mapOver.isCollection&&t.terminal.resetMapping()}}),h=e.View.extend({setupMappingView:function(e){var t=new this.terminalMappingClass({terminal:e}),n=new this.terminalMappingViewClass({model:t});n.render(),e.terminalMappingView=n,this.terminalMappingView=n},terminalElements:function(){return this.terminalMappingView?[this.terminalMappingView.el,this.el]:[this.el]}}),f=h.extend({className:"terminal input-terminal",initialize:function(e){var t=e.node,n=e.input,i=n.name,r=this.terminalForInput(n);r.multiple||this.setupMappingView(r),this.el.terminal=r,r.node=t,r.name=i,t.input_terminals[i]=r},events:{dropinit:"onDropInit",dropstart:"onDropStart",dropend:"onDropEnd",drop:"onDrop",hover:"onHover"},onDropInit:function(e,t){var n=this.el.terminal;return r(t.drag).hasClass("output-terminal")&&n.canAccept(t.drag.terminal)},onDropStart:function(e,t){t.proxy.terminal&&(t.proxy.terminal.connectors[0].inner_color="#BBFFBB")},onDropEnd:function(e,t){t.proxy.terminal&&(t.proxy.terminal.connectors[0].inner_color="#FFFFFF")},onDrop:function(e,t){var n=this.el.terminal;new c.default(t.drag.terminal,n).redraw()},onHover:function(){var e=this.el,t=e.terminal;if(t.connectors.length>0){var n=r("<div class='callout'></div>").css({display:"none"}).appendTo("body").append(r("<div class='button'></div>").append(r("<div/>").addClass("fa-icon-button fa fa-times").click(function(){r.each(t.connectors,function(e,t){t&&t.destroy()}),n.remove()}))).bind("mouseleave",function(){r(this).remove()});n.css({top:r(e).offset().top-2,left:r(e).offset().left-n.width(),"padding-right":r(e).width()}).show()}}}),p=f.extend({terminalMappingClass:s.default.TerminalMapping,terminalMappingViewClass:u,terminalForInput:function(e){return new s.default.InputTerminal({element:this.el,input:e})}}),_=f.extend({terminalMappingClass:s.default.TerminalMapping,terminalMappingViewClass:u,terminalForInput:function(e){return new s.default.InputCollectionTerminal({element:this.el,input:e})}}),g=h.extend({className:"terminal output-terminal",initialize:function(e){var t=e.node,n=e.output,i=n.name,r=this.terminalForOutput(n);this.setupMappingView(r),this.el.terminal=r,r.node=t,r.name=i,t.output_terminals[i]=r},events:{drag:"onDrag",dragstart:"onDragStart",dragend:"onDragEnd"},onDrag:function(e,t){var n=function(){var e=r(t.proxy).offsetParent().offset(),n=t.offsetX-e.left,i=t.offsetY-e.top;r(t.proxy).css({left:n,top:i}),t.proxy.terminal.redraw(),window.workflow_globals.canvas_manager.update_viewport_overlay()};n(),r("#canvas-container").get(0).scroll_panel.test(e,n)},onDragStart:function(e,t){r(t.available).addClass("input-terminal-active"),window.workflow_globals.workflow.check_changes_in_active_form();var n=r('<div class="drag-terminal" style="position: absolute;"></div>').appendTo("#canvas-container").get(0);n.terminal=new s.default.OutputTerminal({element:n});var i=new c.default;return i.dragging=!0,i.connect(this.el.terminal,n.terminal),n},onDragEnd:function(e,t){var n=t.proxy.terminal.connectors[0];n&&n.destroy(),r(t.proxy).remove(),r(t.available).removeClass("input-terminal-active"),r("#canvas-container").get(0).scroll_panel.stop()}}),m=g.extend({terminalMappingClass:s.default.TerminalMapping,terminalMappingViewClass:d,terminalForOutput:function(e){var t=e.extensions;return new s.default.OutputTerminal({element:this.el,datatypes:t})}}),v=g.extend({terminalMappingClass:s.default.TerminalMapping,terminalMappingViewClass:d,terminalForOutput:function(e){var t=e.collection_type,n=e.collection_type_source;return new s.default.OutputCollectionTerminal({element:this.el,collection_type:t,collection_type_source:n,datatypes:e.extensions})}});t.default={InputTerminalView:p,OutputTerminalView:m,InputCollectionTerminalView:_,OutputCollectionTerminalView:v}}).call(t,n(2),n(1),n(0))},306:function(e,t,n){"use strict";(function(e,n,i){function r(e){this.collectionType=e,this.isCollection=!0,this.rank=e.split(":").length}Object.defineProperty(t,"__esModule",{value:!0}),window.workflow_globals=window.workflow_globals||{};var a={isCollection:!1,canMatch:function(){return!1},canMapOver:function(){return!1},toString:function(){return"NullCollectionType[]"},append:function(e){return e},equal:function(e){return e===this}},o={isCollection:!0,canMatch:function(e){return a!==e},canMapOver:function(){return!1},toString:function(){return"AnyCollectionType[]"},append:function(){throw"Cannot append to ANY_COLLECTION_TYPE_DESCRIPTION"},equal:function(e){return e===this}};e.extend(r.prototype,{append:function(e){return e===a?this:e===o?e:new r(this.collectionType+":"+e.collectionType)},canMatch:function(e){return e!==a&&(e===o||e.collectionType==this.collectionType)},canMapOver:function(e){if(e===a)return!1;if(e===o)return!1;if(this.rank<=e.rank)return!1;var t=e.collectionType;return this._endsWith(this.collectionType,t)},effectiveMapOver:function(e){var t=e.collectionType;return new r(this.collectionType.substring(0,this.collectionType.length-t.length-1))},equal:function(e){return e.collectionType==this.collectionType},toString:function(){return"CollectionType["+this.collectionType+"]"},_endsWith:function(e,t){return-1!==e.indexOf(t,e.length-t.length)}});var s=n.Model.extend({initialize:function(e){this.mapOver=e.mapOver||a,this.terminal=e.terminal,this.terminal.terminalMapping=this},disableMapOver:function(){this.setMapOver(a)},setMapOver:function(e){this.mapOver=e,this.trigger("change")}}),l=n.Model.extend({initialize:function(e){this.element=e.element,this.connectors=[]},connect:function(e){this.connectors.push(e),this.node&&this.node.markChanged()},disconnect:function(t){this.connectors.splice(e.inArray(t,this.connectors),1),this.node&&(this.node.markChanged(),this.resetMappingIfNeeded())},redraw:function(){e.each(this.connectors,function(e,t){t.redraw()})},destroy:function(){e.each(this.connectors.slice(),function(e,t){t.destroy()})},destroyInvalidConnections:function(){i.each(this.connectors,function(e){e&&e.destroyIfInvalid()})},setMapOver:function(e){this.multiple||this.mapOver().equal(e)||(this.terminalMapping.setMapOver(e),i.each(this.node.output_terminals,function(t){t.setMapOver(e)}))},mapOver:function(){return this.terminalMapping?this.terminalMapping.mapOver:a},isMappedOver:function(){return this.terminalMapping&&this.terminalMapping.mapOver.isCollection},resetMapping:function(){this.terminalMapping.disableMapOver()},resetMappingIfNeeded:function(){}}),c=l.extend({initialize:function(e){l.prototype.initialize.call(this,e),this.datatypes=e.datatypes},resetMappingIfNeeded:function(){this.node.hasConnectedOutputTerminals()||this.node.hasConnectedMappedInputTerminals()||i.each(this.node.mappedInputTerminals(),function(e){e.resetMappingIfNeeded()}),!this.node.hasMappedOverInputTerminals()&&this.resetMapping()},resetMapping:function(){this.terminalMapping.disableMapOver(),i.each(this.connectors,function(e){var t=e.handle2;t&&(t.resetMappingIfNeeded(),e.destroyIfInvalid())})}}),d=l.extend({initialize:function(e){l.prototype.initialize.call(this,e),this.update(e.input)},canAccept:function(e){return!this._inputFilled()&&this.attachable(e)},resetMappingIfNeeded:function(){this.mapOver().isCollection&&((this.node.hasConnectedMappedInputTerminals()||!this.node.hasConnectedOutputTerminals())&&this.resetMapping())},resetMapping:function(){this.terminalMapping.disableMapOver(),this.node.hasMappedOverInputTerminals()||i.each(this.node.output_terminals,function(e){e.resetMapping()})},connected:function(){return 0!==this.connectors.length},_inputFilled:function(){return!!this.connected()&&(!this.multiple||!!this._collectionAttached())},_collectionAttached:function(){if(this.connected()){var e=this.connectors[0].handle1;return!!e&&!!(e.isCollection||e.isMappedOver()||e.datatypes.indexOf("input_collection")>0)}return!1},_mappingConstraints:function(){if(!this.node)return[];var e=this.mapOver();if(e.isCollection)return[e];var t=[];return this.node.hasConnectedOutputTerminals()?t.push(i.first(i.values(this.node.output_terminals)).mapOver()):i.each(this.node.connectedMappedInputTerminals(),function(e){t.push(e.mapOver())}),t},_producesAcceptableDatatype:function(e){for(var t in this.datatypes){var n=this.datatypes[t];if("input"==n)return!0;var i=[];if(i=i.concat(e.datatypes),e.node.post_job_actions)for(var r in e.node.post_job_actions){var a=e.node.post_job_actions[r];"ChangeDatatypeAction"!=a.action_type||""!==a.output_name&&a.output_name!=e.name||!a.action_arguments||i.push(a.action_arguments.newtype)}for(var o in i){var s=i[o];if("input"==s||"_sniff_"==s||"input_collection"==s||window.workflow_globals.app.isSubType(i[o],n))return!0}}return!1},_otherCollectionType:function(e){var t=a;e.isCollection&&(t=e.collectionType);var n=e.mapOver();return n.isCollection&&(t=n.append(t)),t}}),u=d.extend({update:function(e){this.datatypes=e.extensions,this.multiple=e.multiple,this.collection=!1},connect:function(e){d.prototype.connect.call(this,e);var t=e.handle1;if(t){var n=this._otherCollectionType(t);n.isCollection&&this.setMapOver(n)}},attachable:function(e){var t=this._otherCollectionType(e),n=this.mapOver();if(t.isCollection){if(this.multiple)return!(this.connected()&&!this._collectionAttached())&&(1==t.rank&&this._producesAcceptableDatatype(e));if(n.isCollection&&n.canMatch(t))return this._producesAcceptableDatatype(e);return!!this._mappingConstraints().every(i.bind(t.canMatch,t))&&this._producesAcceptableDatatype(e)}return!n.isCollection&&this._producesAcceptableDatatype(e)}}),h=d.extend({update:function(e){this.multiple=!1,this.collection=!0,this.datatypes=e.extensions;var t=[];e.collection_types?i.each(e.collection_types,function(e){t.push(new r(e))}):t.push(o),this.collectionTypes=t},connect:function(e){d.prototype.connect.call(this,e);var t=e.handle1;if(t){var n=this._effectiveMapOver(t);this.setMapOver(n)}},_effectiveMapOver:function(e){var t=this.collectionTypes,n=this._otherCollectionType(e);if(!i.some(t,function(e){return e.canMatch(n)}))for(var r in t){var o=t[r];if(n.canMapOver(o)){var s=n.effectiveMapOver(o);if(s!=a)return s}}return a},_effectiveCollectionTypes:function(){var e=this.mapOver();return i.map(this.collectionTypes,function(t){return e.append(t)})},attachable:function(e){var t=this._otherCollectionType(e);if(t.isCollection){var n=this._effectiveCollectionTypes(),r=this.mapOver();if(i.some(n,function(e){return e.canMatch(t)}))return this._producesAcceptableDatatype(e);if(r.isCollection)return!1;if(i.some(this.collectionTypes,function(e){return t.canMapOver(e)})){var a=this._effectiveMapOver(e);if(!a.isCollection)return!1;if(this._mappingConstraints().every(a.canMatch))return this._producesAcceptableDatatype(e)}}return!1}}),f=l.extend({initialize:function(e){if(l.prototype.initialize.call(this,e),this.datatypes=e.datatypes,e.collection_type)this.collectionType=new r(e.collection_type);else{e.collection_type_source||console.log("Warning: No collection type or collection type source defined."),this.collectionType=o}this.isCollection=!0},update:function(e){var t;if(e.collection_type)t=new r(e.collection_type);else{e.collection_type_source||console.log("Warning: No collection type or collection type source defined."),t=o}t.collectionType!=this.collectionType.collectionType&&i.each(this.connectors,function(e){e.destroy()}),this.collectionType=t}});t.default={InputTerminal:u,OutputTerminal:c,InputCollectionTerminal:h,OutputCollectionTerminal:f,TerminalMapping:s,CollectionTypeDescription:r,NULL_COLLECTION_TYPE_DESCRIPTION:a,ANY_COLLECTION_TYPE_DESCRIPTION:o}}).call(t,n(0),n(2),n(1))},307:function(e,t,n){"use strict";(function(e,n){Object.defineProperty(t,"__esModule",{value:!0}),window.workflow_globals=window.workflow_globals||{};var i=e.View.extend({className:"form-row dataRow input-data-row",initialize:function(e){this.input=e.input,this.nodeView=e.nodeView,this.terminalElement=e.terminalElement,this.$el.attr("name",this.input.name).html(this.input.label),e.skipResize||(this.$el.css({position:"absolute",left:-1e3,top:-1e3,display:"none"}),n("body").append(this.el),this.nodeView.updateMaxWidth(this.$el.outerWidth()),this.$el.css({position:"",left:"",top:"",display:""}),this.$el.remove())}}),r=e.View.extend({className:"form-row dataRow",initialize:function(e){this.output=e.output,this.terminalElement=e.terminalElement,this.nodeView=e.nodeView;var t=this.output,i=t.name,r=this.nodeView.node;if(t.extensions.indexOf("input")>=0||t.extensions.indexOf("input_collection")>=0||(i=i+" ("+t.extensions.join(", ")+")"),this.$el.html(i),this.calloutView=null,["tool","subworkflow"].indexOf(r.type)>=0){var o=new a({label:i,output:t,node:r});this.calloutView=o,this.$el.append(o.el),this.$el.hover(function(){o.hoverImage()},function(){o.resetImage()})}this.$el.css({position:"absolute",left:-1e3,top:-1e3,display:"none"}),n("body").append(this.el),this.nodeView.updateMaxWidth(this.$el.outerWidth()+17),this.$el.css({position:"",left:"",top:"",display:""}).detach()},redrawWorkflowOutput:function(){this.calloutView&&this.calloutView.resetImage()}}),a=e.View.extend({tagName:"div",initialize:function(e){this.label=e.label,this.node=e.node,this.output=e.output;var t=this,i=this.node;this.$el.attr("class","callout "+this.label).css({display:"none"}).append(n("<div class='buttons'></div>").append(n("<img/>").attr("src",Galaxy.root+"static/images/fugue/asterisk-small-outline.png").click(function(){var e=t.output.name;i.isWorkflowOutput(e)?(i.removeWorkflowOutput(e),t.$("img").attr("src",Galaxy.root+"static/images/fugue/asterisk-small-outline.png")):(i.addWorkflowOutput(e),t.$("img").attr("src",Galaxy.root+"static/images/fugue/asterisk-small.png")),window.workflow_globals.workflow.has_changes=!0,window.workflow_globals.canvas_manager.draw_overview()}))).tooltip({delay:500,title:"Mark dataset as a workflow output. All unmarked datasets will be hidden."}),this.$el.css({top:"50%",margin:"-8px 0px 0px 0px",right:8}),this.$el.show(),this.resetImage()},resetImage:function(){this.node.isWorkflowOutput(this.output.name)?this.$("img").attr("src",Galaxy.root+"static/images/fugue/asterisk-small.png"):this.$("img").attr("src",Galaxy.root+"static/images/fugue/asterisk-small-outline.png")},hoverImage:function(){this.$("img").attr("src",Galaxy.root+"static/images/fugue/asterisk-small-yellow.png")}});t.default={DataInputView:i,DataOutputView:r}}).call(t,n(2),n(0))},308:function(e,t,n){"use strict";(function(e,i){function r(e){return e&&e.__esModule?e:{default:e}}function a(e){var t=e.model.attributes,n=t.workflow,i=t.node;t.inputs.unshift({type:"text",name:"__annotation",label:"Annotation",fixed:!0,value:i.annotation,area:!0,help:"Add an annotation or notes to this step. Annotations are available when a workflow is viewed."}),t.inputs.unshift({type:"text",name:"__label",label:"Label",value:i.label,help:(0,d.default)("Add a step label."),fixed:!0,onchange:function(t){var r=!1;for(var a in n.nodes){var o=n.nodes[a];if(o.label&&o.label==t&&o.id!=i.id){r=!0;break}}var s=e.data.match("__label");e.element_list[s].model.set("error_text",r&&"Duplicate label. Please fix this before saving the workflow."),e.trigger("change")}})}function o(e,t,n,i){var r=i.node.post_job_actions;t=t||[],t.push(e);for(var a in e.inputs){var s=e.inputs[a];if(s.action){if(s.name="pja__"+n+"__"+s.action,s.pja_arg&&(s.name+="__"+s.pja_arg),s.payload)for(var l in s.payload)s.payload[s.name+"__"+l]=s.payload[l],delete s.payload[l];var c=r[s.action+n];if(c){for(var d in t)t[d].expanded=!0;s.pja_arg?s.value=c.action_arguments&&c.action_arguments[s.pja_arg]||s.value:s.value="true"}}s.inputs&&o(s,t.slice(0),n,i)}}function s(e,t){var n=[],i=[],r=t.datatypes,a=t.node,s=t.workflow;for(var l in r)n.push({0:r[l],1:r[l]});for(l in a.input_terminals)i.push(a.input_terminals[l].name);n.sort(function(e,t){return e.label>t.label?1:e.label<t.label?-1:0}),n.unshift({0:"Sequences",1:"Sequences"}),n.unshift({0:"Roadmaps",1:"Roadmaps"}),n.unshift({0:"Leave unchanged",1:"__empty__"});var c,u={title:"Configure Output: '"+e+"'",type:"section",flat:!0,inputs:[{label:"Label",type:"text",value:(c=a.getWorkflowOutput(e))&&c.label||"",help:"This will provide a short name to describe the output - this must be unique across workflows.",onchange:function(t){s.attemptUpdateOutputLabel(a,e,t)}},{action:"RenameDatasetAction",pja_arg:"newname",label:"Rename dataset",type:"text",value:"",ignore:"",help:'This action will rename the output dataset. Click <a href="https://galaxyproject.org/learn/advanced-workflow/variables/">here</a> for more information. Valid inputs are: <strong>'+i.join(", ")+"</strong>."},{action:"ChangeDatatypeAction",pja_arg:"newtype",label:"Change datatype",type:"select",ignore:"__empty__",value:"__empty__",options:n,help:"This action will change the datatype of the output to the indicated value."},{action:"TagDatasetAction",pja_arg:"tags",label:"Add Tags",type:"text",value:"",ignore:"",help:"This action will set tags for the dataset."},{action:"RemoveTagDatasetAction",pja_arg:"tags",label:"Remove Tags",type:"text",value:"",ignore:"",help:"This action will remove tags for the dataset."},{title:(0,d.default)("Assign columns"),type:"section",flat:!0,inputs:[{action:"ColumnSetAction",pja_arg:"chromCol",label:"Chrom column",type:"integer",value:"",ignore:""},{action:"ColumnSetAction",pja_arg:"startCol",label:"Start column",type:"integer",value:"",ignore:""},{action:"ColumnSetAction",pja_arg:"endCol",label:"End column",type:"integer",value:"",ignore:""},{action:"ColumnSetAction",pja_arg:"strandCol",label:"Strand column",type:"integer",value:"",ignore:""},{action:"ColumnSetAction",pja_arg:"nameCol",label:"Name column",type:"integer",value:"",ignore:""}],help:"This action will set column assignments in the output dataset. Blank fields are ignored."}]};return o(u,[],e,t),u}function l(e){var t=e.model.attributes,n=t.inputs,i=t.node,r=i.post_job_actions,a=i.output_terminals&&Object.keys(i.output_terminals)[0];if(a){n.push({name:"pja__"+a+"__EmailAction",label:"Email notification",type:"boolean",value:String(Boolean(r["EmailAction"+a])),ignore:"false",help:(0,d.default)("An email notification will be sent when the job has completed."),payload:{host:window.location.host}}),n.push({name:"pja__"+a+"__DeleteIntermediatesAction",label:"Output cleanup",type:"boolean",value:String(Boolean(r["DeleteIntermediatesAction"+a])),ignore:"false",help:"Upon completion of this step, delete non-starred outputs from completed workflow steps if they are no longer required as inputs."});for(var o in i.output_terminals)n.push(s(o,t))}}Object.defineProperty(t,"__esModule",{value:!0});var c=n(3),d=r(c),u=n(4),h=r(u),f=n(11),p=r(f),_=n(46),g=r(_),m=e.View.extend({initialize:function(e){var t=this,n=e.node;this.form=new p.default(h.default.merge(e,{onchange:function(){h.default.request({type:"POST",url:Galaxy.root+"api/workflows/build_module",data:{id:n.id,type:n.type,content_id:n.content_id,inputs:t.form.data.create()},success:function(e){n.update_field_data(e)}})}})),a(this.form),this.form.render()}}),v=e.View.extend({initialize:function(e){var t=this,n=e.node;this.form=new g.default(h.default.merge(e,{text_enable:"Set in Advance",text_disable:"Set at Runtime",narrow:!0,initial_errors:!0,cls:"ui-portlet-narrow",initialmodel:function(e,n){t._customize(n),e.resolve()},buildmodel:function(e,t){t.model.get("postchange")(e,t)},postchange:function(e,r){var a=r.model.attributes,o={tool_id:a.id,tool_version:a.version,type:"tool",inputs:i.extend(!0,{},r.data.create())};Galaxy.emit.debug("tool-form-workflow::postchange()","Sending current state.",o),h.default.request({type:"POST",url:Galaxy.root+"api/workflows/build_module",data:o,success:function(i){r.model.set(i.config_form),t._customize(r),r.update(i.config_form),r.errors(i.config_form),n.update_field_data(i),Galaxy.emit.debug("tool-form-workflow::postchange()","Received new model.",i),e.resolve()},error:function(t){Galaxy.emit.debug("tool-form-workflow::postchange()","Refresh request failed.",t),e.reject()}})}}))},_customize:function(e){var t=e.model.attributes;h.default.deepeach(t.inputs,function(e){e.type&&(-1!=["data","data_collection"].indexOf(e.type)?(e.type="hidden",e.info="Data input '"+e.name+"' ("+h.default.textify(e.extensions)+")",e.value={__class__:"RuntimeValue"}):e.fixed||(e.collapsible_value={__class__:"RuntimeValue"},e.is_workflow=e.options&&0===e.options.length||-1!=["integer","float"].indexOf(e.type)))}),h.default.deepeach(t.inputs,function(e){"conditional"===e.type&&(e.test_param.collapsible_value=void 0)}),l(e),a(e)}});t.default={Default:m,Tool:v}}).call(t,n(2),n(0))},309:function(e,t,n){"use strict";(function(e,i){function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(3),s=a(o),l=n(1),c=r(l),d=n(310),u=r(d),h=n(28),f=a(h),p=n(4),_=a(p),g=n(38),m=a(g),v=n(42),y=a(v);n(41);var b=e.Model.extend({is_visible:function(e,t){var n=e.getBoundingClientRect(),r=i("svg")[0].getBoundingClientRect();return!(n.right<0||n.left>r.right||n.bottom<0||n.top>r.bottom)}}),w={drawTicks:function(e,t,n,i,r){var a=e.append("g").selectAll("g").data(t).enter().append("g").selectAll("g").data(n).enter().append("g").attr("class","tick").attr("transform",function(e){return"rotate("+(180*e.angle/Math.PI-90)+")translate("+e.radius+",0)"}),o=[],s=[],l=function(e){return e.angle>Math.PI?"end":null};return r?(o=[0,0,0,-4],s=[4,0,"",".35em"],l=null):(o=[1,0,4,0],s=[0,4,".35em",""]),a.append("line").attr("x1",o[0]).attr("y1",o[1]).attr("x2",o[2]).attr("y1",o[3]).style("stroke","#000"),a.append("text").attr("x",s[0]).attr("y",s[1]).attr("dx",s[2]).attr("dy",s[3]).attr("text-anchor",l).attr("transform",i).text(function(e){return e.label})},formatNum:function(e,t){if(void 0===t&&(t=2),null===e)return null;var n=null;if(Math.abs(e)<1)n=e.toPrecision(t);else{var i=Math.round(e.toPrecision(t));e=Math.abs(e),e<1e3?n=i:e<1e6?n=Math.round((i/1e3).toPrecision(3)).toFixed(0)+"K":e<1e9&&(n=Math.round((i/1e6).toPrecision(3)).toFixed(0)+"M")}return n}},x=e.Model.extend({}),k=e.View.extend({className:"circster",initialize:function(e){this.genome=e.genome,this.label_arc_height=50,this.scale=1,this.circular_views=null,this.chords_views=null,this.model.get("drawables").on("add",this.add_track,this),this.model.get("drawables").on("remove",this.remove_track,this);var t=this.model.get("config");t.get("arc_dataset_height").on("change:value",this.update_track_bounds,this),t.get("track_gap").on("change:value",this.update_track_bounds,this)},get_circular_tracks:function(){return this.model.get("drawables").filter(function(e){return"DiagonalHeatmapTrack"!==e.get("track_type")})},get_chord_tracks:function(){return this.model.get("drawables").filter(function(e){return"DiagonalHeatmapTrack"===e.get("track_type")})},get_tracks_bounds:function(){var e=this.get_circular_tracks(),t=this.model.get("config").get_value("arc_dataset_height"),n=this.model.get("config").get_value("track_gap"),i=Math.min(this.$el.width(),this.$el.height())-20,r=i/2-e.length*(t+n)+n-this.label_arc_height,a=u.range(r,i/2,t+n);return c.map(a,function(e){return[e,e+t]})},render:function(){var e=this,t=e.$el.width(),n=e.$el.height(),i=this.get_circular_tracks(),r=this.get_chord_tracks(),a=e.model.get("config").get_value("total_gap"),o=this.get_tracks_bounds(),s=u.select(e.$el[0]).append("svg").attr("width",t).attr("height",n).attr("pointer-events","all").append("svg:g").call(u.behavior.zoom().on("zoom",function(){var t=u.event.scale;s.attr("transform","translate("+u.event.translate+") scale("+t+")"),e.scale!==t&&(e.zoom_drag_timeout&&clearTimeout(e.zoom_drag_timeout),e.zoom_drag_timeout=setTimeout(function(){},400))})).attr("transform","translate("+t/2+","+n/2+")").append("svg:g").attr("class","tracks");this.circular_views=i.map(function(t,n){var i=new S({el:s.append("g")[0],track:t,radius_bounds:o[n],genome:e.genome,total_gap:a});return i.render(),i}),this.chords_views=r.map(function(t){var n=new T({el:s.append("g")[0],track:t,radius_bounds:o[0],genome:e.genome,total_gap:a});return n.render(),n});var l=this.circular_views[this.circular_views.length-1].radius_bounds[1],c=[l,l+this.label_arc_height];this.label_track_view=new M({el:s.append("g")[0],track:new x,radius_bounds:c,genome:e.genome,total_gap:a}),this.label_track_view.render()},add_track:function(e){var t=this.model.get("config").get_value("total_gap");if("DiagonalHeatmapTrack"===e.get("track_type")){var n=this.circular_views[0].radius_bounds,i=new T({el:u.select("g.tracks").append("g")[0],track:e,radius_bounds:n,genome:this.genome,total_gap:t});i.render(),this.chords_views.push(i)}else{var r=this.get_tracks_bounds();c.each(this.circular_views,function(e,t){e.update_radius_bounds(r[t])}),c.each(this.chords_views,function(e){e.update_radius_bounds(r[0])});var a=this.circular_views.length,o=new S({el:u.select("g.tracks").append("g")[0],track:e,radius_bounds:r[a],genome:this.genome,total_gap:t});o.render(),this.circular_views.push(o)}},remove_track:function(e,t,n){var i=this.circular_views[n.index];this.circular_views.splice(n.index,1),i.$el.remove();var r=this.get_tracks_bounds();c.each(this.circular_views,function(e,t){e.update_radius_bounds(r[t])})},update_track_bounds:function(){var e=this.get_tracks_bounds();c.each(this.circular_views,function(t,n){t.update_radius_bounds(e[n])}),c.each(this.chords_views,function(t){t.update_radius_bounds(e[0])})}}),j=e.View.extend({tagName:"g",initialize:function(e){this.bg_stroke="#ddd",this.loading_bg_fill="#ffc",this.bg_fill="#ddd",this.total_gap=e.total_gap,this.track=e.track,this.radius_bounds=e.radius_bounds,this.genome=e.genome,this.chroms_layout=this._chroms_layout(),this.data_bounds=[],this.scale=1,this.parent_elt=u.select(this.$el[0])},get_fill_color:function(){var e=this.track.get("config").get_value("block_color");return e||(e=this.track.get("config").get_value("color")),e},render:function(){var e=this.parent_elt,t=this.chroms_layout,n=u.svg.arc().innerRadius(this.radius_bounds[0]).outerRadius(this.radius_bounds[1]),r=e.selectAll("g").data(t).enter().append("svg:g"),a=r.append("path").attr("d",n).attr("class","chrom-background").style("stroke",this.bg_stroke).style("fill",this.loading_bg_fill);a.append("title").text(function(e){return e.data.chrom});var o=this,s=o.track.get("data_manager"),l=!s||s.data_is_ready();i.when(l).then(function(){i.when(o._render_data(e)).then(function(){a.style("fill",o.bg_fill),o.render_labels()})})},render_labels:function(){},update_radius_bounds:function(e){this.radius_bounds=e;var t=u.svg.arc().innerRadius(this.radius_bounds[0]).outerRadius(this.radius_bounds[1]);this.parent_elt.selectAll("g>path.chrom-background").transition().duration(1e3).attr("d",t),this._transition_chrom_data(),this._transition_labels()},update_scale:function(e){var t=this.scale;if(this.scale=e,!(e<=t)){var n=this,r=new b;return this.parent_elt.selectAll("path.chrom-data").filter(function(e,t){return r.is_visible(this)}).each(function(t,r){var a,o=u.select(this),s=o.attr("chrom"),l=n.genome.get_chrom_region(s),d=n.track.get("data_manager");d.can_get_more_detailed_data(l)&&(a=n.track.get("data_manager").get_more_detailed_data(l,"Coverage",0,e),i.when(a).then(function(e){o.remove(),n._update_data_bounds();var t=c.find(n.chroms_layout,function(e){return e.data.chrom===s}),i=n.get_fill_color();n._render_chrom_data(n.parent_elt,t,e).style("stroke",i).style("fill",i)}))}),n}},_transition_chrom_data:function(){var e=this.track,t=this.chroms_layout,n=this.parent_elt.selectAll("g>path.chrom-data");if(n[0].length>0){var r=this;i.when(e.get("data_manager").get_genome_wide_data(this.genome)).then(function(i){var a=c.reject(c.map(i,function(e,n){var i=null,a=r._get_path_function(t[n],e);return a&&(i=a(e.data)),i}),function(e){return null===e}),o=e.get("config").get_value("color");n.each(function(e,t){u.select(this).transition().duration(1e3).style("stroke",o).style("fill",o).attr("d",a[t])})})}},_transition_labels:function(){},_update_data_bounds:function(e){this.data_bounds;this.data_bounds=e||this.get_data_bounds(this.track.get("data_manager").get_genome_wide_data(this.genome)),this._transition_chrom_data()},_render_data:function(e){var t=this,n=this.chroms_layout,r=this.track,a=i.Deferred();return i.when(r.get("data_manager").get_genome_wide_data(this.genome)).then(function(i){t.data_bounds=t.get_data_bounds(i),r.get("config").set_value("min_value",t.data_bounds[0],{silent:!0}),r.get("config").set_value("max_value",t.data_bounds[1],{silent:!0});var o=c.zip(n,i);c.each(o,function(n){var i=n[0],r=n[1];return t._render_chrom_data(e,i,r)});var s=t.get_fill_color();t.parent_elt.selectAll("path.chrom-data").style("stroke",s).style("fill",s),a.resolve(e)}),a},_render_chrom_data:function(e,t,n){},_get_path_function:function(e,t){},_chroms_layout:function(){var e=this.genome.get_chroms_info(),t=u.layout.pie().value(function(e){return e.len}).sort(null),n=t(e),i=2*Math.PI*this.total_gap/e.length;return c.map(n,function(e,t){var n=e.endAngle-i;return e.endAngle=n>e.startAngle?n:e.startAngle,e})}}),M=j.extend({initialize:function(e){j.prototype.initialize.call(this,e),this.innerRadius=this.radius_bounds[0],this.radius_bounds[0]=this.radius_bounds[1],this.bg_stroke="#fff",this.bg_fill="#fff",this.min_arc_len=.05},_render_data:function(e){var t=this,n=e.selectAll("g");n.selectAll("path").attr("id",function(e){return"label-"+e.data.chrom}),n.append("svg:text").filter(function(e){return e.endAngle-e.startAngle>t.min_arc_len}).attr("text-anchor","middle").append("svg:textPath").attr("class","chrom-label").attr("xlink:href",function(e){return"#label-"+e.data.chrom}).attr("startOffset","25%").text(function(e){return e.data.chrom});var i=function(e){var n=(e.endAngle-e.startAngle)/e.value,i=u.range(0,e.value,25e6).map(function(i,r){return{radius:t.innerRadius,angle:i*n+e.startAngle,label:0===r?0:r%3?null:t.formatNum(i)}});return i.length<4&&(i[i.length-1].label=t.formatNum(Math.round((i[i.length-1].angle-e.startAngle)/n))),i},r=function(e){return e.angle>Math.PI?"rotate(180)translate(-16)":null},a=c.filter(this.chroms_layout,function(e){return e.endAngle-e.startAngle>t.min_arc_len});this.drawTicks(this.parent_elt,a,i,r)}});c.extend(M.prototype,w);var C=j.extend({initialize:function(e){j.prototype.initialize.call(this,e);var t=this.track.get("config");t.get("min_value").on("change:value",this._update_min_max,this),t.get("max_value").on("change:value",this._update_min_max,this),t.get("color").on("change:value",this._transition_chrom_data,this)},_update_min_max:function(){var e=this.track.get("config"),t=[e.get_value("min_value"),e.get_value("max_value")];this._update_data_bounds(t),this.parent_elt.selectAll(".min_max").text(function(e,n){return t[n]})},_quantile:function(e,t){return e.sort(u.ascending),u.quantile(e,t)},_render_chrom_data:function(e,t,n){var i=this._get_path_function(t,n);return i?e.datum(n.data).append("path").attr("class","chrom-data").attr("chrom",t.data.chrom).attr("d",i):null},_get_path_function:function(e,t){if("string"==typeof t||!t.data||0===t.data.length)return null;var n=u.scale.linear().domain(this.data_bounds).range(this.radius_bounds).clamp(!0),i=u.scale.linear().domain([0,t.data.length]).range([e.startAngle,e.endAngle]),r=u.svg.line.radial().interpolate("linear").radius(function(e){return n(e[1])}).angle(function(e,t){return i(t)});return u.svg.area.radial().interpolate(r.interpolate()).innerRadius(n(0)).outerRadius(r.radius()).angle(r.angle())},render_labels:function(){var e=this,t=function(){return"rotate(90)"},n=this.drawTicks(this.parent_elt,[this.chroms_layout[0]],this._data_bounds_ticks_fn(),t,!0).classed("min_max",!0);c.each(n,function(t){i(t).click(function(){new m.default.ConfigSettingCollectionView({collection:e.track.get("config")}).render_in_modal("Configure Track")})})},_transition_labels:function(){if(0!==this.data_bounds.length){var e=this,t=c.filter(this.chroms_layout,function(e){return e.endAngle-e.startAngle>.08}),n=c.filter(t,function(e,t){return t%3==0}),i=c.flatten(c.map(n,function(t){return e._data_bounds_ticks_fn()(t)}));this.parent_elt.selectAll("g.tick").data(i).transition().attr("transform",function(e){return"rotate("+(180*e.angle/Math.PI-90)+")translate("+e.radius+",0)"})}},_data_bounds_ticks_fn:function(){var e=this;return visibleChroms=0,function(t){return[{radius:e.radius_bounds[0],angle:t.startAngle,label:e.formatNum(e.data_bounds[0])},{radius:e.radius_bounds[1],angle:t.startAngle,label:e.formatNum(e.data_bounds[1])}]}},get_data_bounds:function(e){}});c.extend(C.prototype,w);var S=C.extend({get_data_bounds:function(e){var t=c.flatten(c.map(e,function(e){return e?c.map(e.data,function(e){return parseInt(e[1],10)||0}):0}));return[c.min(t),this._quantile(t,.98)||c.max(t)]}}),T=j.extend({render:function(){var e=this;i.when(e.track.get("data_manager").data_is_ready()).then(function(){i.when(e.track.get("data_manager").get_genome_wide_data(e.genome)).then(function(t){var n=[],i=e.genome.get_chroms_info();c.each(t,function(t,r){var a=i[r].chrom,o=c.map(t.data,function(t){var n=e._get_region_angle(a,t[1]),i=e._get_region_angle(t[3],t[4]);return{source:{startAngle:n,endAngle:n+.01},target:{startAngle:i,endAngle:i+.01}}});n=n.concat(o)}),e.parent_elt.append("g").attr("class","chord").selectAll("path").data(n).enter().append("path").style("fill",e.get_fill_color()).attr("d",u.svg.chord().radius(e.radius_bounds[0])).style("opacity",1)})})},update_radius_bounds:function(e){this.radius_bounds=e,this.parent_elt.selectAll("path").transition().attr("d",u.svg.chord().radius(this.radius_bounds[0]))},_get_region_angle:function(e,t){var n=c.find(this.chroms_layout,function(t){return t.data.chrom===e});return n.endAngle-(n.endAngle-n.startAngle)*(n.data.len-t)/n.data.len}}),O=e.View.extend({initialize:function(){_.default.cssLoadFile("static/style/circster.css");var e=new f.default.Genome(galaxy_config.app.genome),t=new f.default.GenomeVisualization(galaxy_config.app.viz_config);t.get("config").add([{key:"arc_dataset_height",label:"Arc Dataset Height",type:"int",value:25,view:"circster"},{key:"track_gap",label:"Gap Between Tracks",type:"int",value:5,view:"circster"},{key:"total_gap",label:"Gap [0-1]",type:"float",value:.4,view:"circster",hidden:!0}]),new k({el:i("#center .unified-panel-body"),genome:e,model:t}).render(),i("#center .unified-panel-header-inner").append(galaxy_config.app.viz_config.title+" "+galaxy_config.app.viz_config.dbkey);var n=y.default.create_icon_buttons_menu([{icon_class:"plus-button",title:(0,s.default)("Add tracks"),on_click:function(){f.default.select_datasets({dbkey:t.get("dbkey")},function(e){t.add_tracks(e)})}},{icon_class:"gear",title:(0,s.default)("Settings"),on_click:function(){new m.default.ConfigSettingCollectionView({collection:t.get("config")}).render_in_modal("Configure Visualization")}},{icon_class:"disk--arrow",title:(0,s.default)("Save"),on_click:function(){Galaxy.modal.show({title:(0,s.default)("Saving..."),body:"progress"}),i.ajax({url:Galaxy.root+"visualization/save",type:"POST",dataType:"json",data:{id:t.get("vis_id"),title:t.get("title"),dbkey:t.get("dbkey"),type:"trackster",vis_json:JSON.stringify(t)}}).success(function(e){Galaxy.modal.hide(),t.set("vis_id",e.vis_id)}).error(function(){Galaxy.modal.show({title:(0,s.default)("Could Not Save"),body:"Could not save visualization. Please try again later.",buttons:{Cancel:function(){Galaxy.modal.hide()}}})})}},{icon_class:"cross-circle",title:(0,s.default)("Close"),on_click:function(){window.location=Galaxy.root+"visualizations/list"}}],{tooltip_config:{placement:"bottom"}});n.$el.attr("style","float: right"),i("#center .unified-panel-header-inner").append(n.$el),i(".menu-button").tooltip({placement:"bottom"})}});t.default={GalaxyApp:O}}).call(t,n(2),n(0))},310:function(e,t,n){var i,r;!function(){function a(e){return e&&(e.ownerDocument||e.document||e).documentElement}function o(e){return e&&(e.ownerDocument&&e.ownerDocument.defaultView||e.document&&e||e.defaultView)}function s(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function l(e){return null===e?NaN:+e}function c(e){return!isNaN(e)}function d(e){return{left:function(t,n,i,r){for(arguments.length<3&&(i=0),arguments.length<4&&(r=t.length);i<r;){var a=i+r>>>1;e(t[a],n)<0?i=a+1:r=a}return i},right:function(t,n,i,r){for(arguments.length<3&&(i=0),arguments.length<4&&(r=t.length);i<r;){var a=i+r>>>1;e(t[a],n)>0?r=a:i=a+1}return i}}}function u(e){return e.length}function h(e){for(var t=1;e*t%1;)t*=10;return t}function f(e,t){for(var n in t)Object.defineProperty(e.prototype,n,{value:t[n],enumerable:!1})}function p(){this._=Object.create(null)}function _(e){return(e+="")===jo||e[0]===Mo?Mo+e:e}function g(e){return(e+="")[0]===Mo?e.slice(1):e}function m(e){return _(e)in this._}function v(e){return(e=_(e))in this._&&delete this._[e]}function y(){var e=[];for(var t in this._)e.push(g(t));return e}function b(){var e=0;for(var t in this._)++e;return e}function w(){for(var e in this._)return!1;return!0}function x(){this._=Object.create(null)}function k(e){return e}function j(e,t,n){return function(){var i=n.apply(t,arguments);return i===t?e:i}}function M(e,t){if(t in e)return t;t=t.charAt(0).toUpperCase()+t.slice(1);for(var n=0,i=Co.length;n<i;++n){var r=Co[n]+t;if(r in e)return r}}function C(){}function S(){}function T(e){function t(){for(var t,i=n,r=-1,a=i.length;++r<a;)(t=i[r].on)&&t.apply(this,arguments);return e}var n=[],i=new p;return t.on=function(t,r){var a,o=i.get(t);return arguments.length<2?o&&o.on:(o&&(o.on=null,n=n.slice(0,a=n.indexOf(o)).concat(n.slice(a+1)),i.remove(t)),r&&n.push(i.set(t,{on:r})),e)},t}function O(){fo.event.preventDefault()}function A(){for(var e,t=fo.event;e=t.sourceEvent;)t=e;return t}function N(e){for(var t=new S,n=0,i=arguments.length;++n<i;)t[arguments[n]]=T(t);return t.of=function(n,i){return function(r){try{var a=r.sourceEvent=fo.event;r.target=e,fo.event=r,t[r.type].apply(n,i)}finally{fo.event=a}}},t}function G(e){return To(e,Go),e}function L(e){return"function"==typeof e?e:function(){return Oo(e,this)}}function D(e){return"function"==typeof e?e:function(){return Ao(e,this)}}function I(e,t){function n(){this.removeAttribute(e)}function i(){this.removeAttributeNS(e.space,e.local)}function r(){this.setAttribute(e,t)}function a(){this.setAttributeNS(e.space,e.local,t)}function o(){var n=t.apply(this,arguments);null==n?this.removeAttribute(e):this.setAttribute(e,n)}function s(){var n=t.apply(this,arguments);null==n?this.removeAttributeNS(e.space,e.local):this.setAttributeNS(e.space,e.local,n)}return e=fo.ns.qualify(e),null==t?e.local?i:n:"function"==typeof t?e.local?s:o:e.local?a:r}function P(e){return e.trim().replace(/\s+/g," ")}function R(e){return new RegExp("(?:^|\\s+)"+fo.requote(e)+"(?:\\s+|$)","g")}function V(e){return(e+"").trim().split(/^|\s+/)}function E(e,t){function n(){for(var n=-1;++n<r;)e[n](this,t)}function i(){for(var n=-1,i=t.apply(this,arguments);++n<r;)e[n](this,i)}e=V(e).map(z);var r=e.length;return"function"==typeof t?i:n}function z(e){var t=R(e);return function(n,i){if(r=n.classList)return i?r.add(e):r.remove(e);var r=n.getAttribute("class")||"";i?(t.lastIndex=0,t.test(r)||n.setAttribute("class",P(r+" "+e))):n.setAttribute("class",P(r.replace(t," ")))}}function q(e,t,n){function i(){this.style.removeProperty(e)}function r(){this.style.setProperty(e,t,n)}function a(){var i=t.apply(this,arguments);null==i?this.style.removeProperty(e):this.style.setProperty(e,i,n)}return null==t?i:"function"==typeof t?a:r}function F(e,t){function n(){delete this[e]}function i(){this[e]=t}function r(){var n=t.apply(this,arguments);null==n?delete this[e]:this[e]=n}return null==t?n:"function"==typeof t?r:i}function $(e){function t(){var t=this.ownerDocument,n=this.namespaceURI;return n===Lo&&t.documentElement.namespaceURI===Lo?t.createElement(e):t.createElementNS(n,e)}function n(){return this.ownerDocument.createElementNS(e.space,e.local)}return"function"==typeof e?e:(e=fo.ns.qualify(e)).local?n:t}function H(){var e=this.parentNode;e&&e.removeChild(this)}function U(e){return{__data__:e}}function J(e){return function(){return No(this,e)}}function B(e){return arguments.length||(e=s),function(t,n){return t&&n?e(t.__data__,n.__data__):!t-!n}}function W(e,t){for(var n=0,i=e.length;n<i;n++)for(var r,a=e[n],o=0,s=a.length;o<s;o++)(r=a[o])&&t(r,o,n);return e}function Y(e){return To(e,Io),e}function K(e){var t,n;return function(i,r,a){var o,s=e[a].update,l=s.length;for(a!=n&&(n=a,t=0),r>=t&&(t=r+1);!(o=s[t])&&++t<l;);return o}}function X(e,t,n){function i(){var t=this[o];t&&(this.removeEventListener(e,t,t.$),delete this[o])}function r(){var r=l(t,_o(arguments));i.call(this),this.addEventListener(e,this[o]=r,r.$=n),r._=t}function a(){var t,n=new RegExp("^__on([^.]+)"+fo.requote(e)+"$");for(var i in this)if(t=i.match(n)){var r=this[i];this.removeEventListener(t[1],r,r.$),delete this[i]}}var o="__on"+e,s=e.indexOf("."),l=Q;s>0&&(e=e.slice(0,s));var c=Po.get(e);return c&&(e=c,l=Z),s?t?r:i:t?C:a}function Q(e,t){return function(n){var i=fo.event;fo.event=n,t[0]=this.__data__;try{e.apply(this,t)}finally{fo.event=i}}}function Z(e,t){var n=Q(e,t);return function(e){var t=this,i=e.relatedTarget;i&&(i===t||8&i.compareDocumentPosition(t))||n.call(t,e)}}function ee(e){var t=".dragsuppress-"+ ++Vo,n="click"+t,i=fo.select(o(e)).on("touchmove"+t,O).on("dragstart"+t,O).on("selectstart"+t,O);if(null==Ro&&(Ro=!("onselectstart"in e)&&M(e.style,"userSelect")),Ro){var r=a(e).style,s=r[Ro];r[Ro]="none"}return function(e){if(i.on(t,null),Ro&&(r[Ro]=s),e){var a=function(){i.on(n,null)};i.on(n,function(){O(),a()},!0),setTimeout(a,0)}}}function te(e,t){t.changedTouches&&(t=t.changedTouches[0]);var n=e.ownerSVGElement||e;if(n.createSVGPoint){var i=n.createSVGPoint();if(Eo<0){var r=o(e);if(r.scrollX||r.scrollY){n=fo.select("body").append("svg").style({position:"absolute",top:0,left:0,margin:0,padding:0,border:"none"},"important");var a=n[0][0].getScreenCTM();Eo=!(a.f||a.e),n.remove()}}return Eo?(i.x=t.pageX,i.y=t.pageY):(i.x=t.clientX,i.y=t.clientY),i=i.matrixTransform(e.getScreenCTM().inverse()),[i.x,i.y]}var s=e.getBoundingClientRect();return[t.clientX-s.left-e.clientLeft,t.clientY-s.top-e.clientTop]}function ne(){return fo.event.changedTouches[0].identifier}function ie(e){return e>0?1:e<0?-1:0}function re(e,t,n){return(t[0]-e[0])*(n[1]-e[1])-(t[1]-e[1])*(n[0]-e[0])}function ae(e){return e>1?0:e<-1?Fo:Math.acos(e)}function oe(e){return e>1?Uo:e<-1?-Uo:Math.asin(e)}function se(e){return((e=Math.exp(e))-1/e)/2}function le(e){return((e=Math.exp(e))+1/e)/2}function ce(e){return((e=Math.exp(2*e))-1)/(e+1)}function de(e){return(e=Math.sin(e/2))*e}function ue(){}function he(e,t,n){return this instanceof he?(this.h=+e,this.s=+t,void(this.l=+n)):arguments.length<2?e instanceof he?new he(e.h,e.s,e.l):Ce(""+e,Se,he):new he(e,t,n)}function fe(e,t,n){function i(e){return e>360?e-=360:e<0&&(e+=360),e<60?a+(o-a)*e/60:e<180?o:e<240?a+(o-a)*(240-e)/60:a}function r(e){return Math.round(255*i(e))}var a,o;return e=isNaN(e)?0:(e%=360)<0?e+360:e,t=isNaN(t)?0:t<0?0:t>1?1:t,n=n<0?0:n>1?1:n,o=n<=.5?n*(1+t):n+t-n*t,a=2*n-o,new xe(r(e+120),r(e),r(e-120))}function pe(e,t,n){return this instanceof pe?(this.h=+e,this.c=+t,void(this.l=+n)):arguments.length<2?e instanceof pe?new pe(e.h,e.c,e.l):e instanceof ge?ve(e.l,e.a,e.b):ve((e=Te((e=fo.rgb(e)).r,e.g,e.b)).l,e.a,e.b):new pe(e,t,n)}function _e(e,t,n){return isNaN(e)&&(e=0),isNaN(t)&&(t=0),new ge(n,Math.cos(e*=Jo)*t,Math.sin(e)*t)}function ge(e,t,n){return this instanceof ge?(this.l=+e,this.a=+t,void(this.b=+n)):arguments.length<2?e instanceof ge?new ge(e.l,e.a,e.b):e instanceof pe?_e(e.h,e.c,e.l):Te((e=xe(e)).r,e.g,e.b):new ge(e,t,n)}function me(e,t,n){var i=(e+16)/116,r=i+t/500,a=i-n/200;return r=ye(r)*ts,i=ye(i)*ns,a=ye(a)*is,new xe(we(3.2404542*r-1.5371385*i-.4985314*a),we(-.969266*r+1.8760108*i+.041556*a),we(.0556434*r-.2040259*i+1.0572252*a))}function ve(e,t,n){return e>0?new pe(Math.atan2(n,t)*Bo,Math.sqrt(t*t+n*n),e):new pe(NaN,NaN,e)}function ye(e){return e>.206893034?e*e*e:(e-4/29)/7.787037}function be(e){return e>.008856?Math.pow(e,1/3):7.787037*e+4/29}function we(e){return Math.round(255*(e<=.00304?12.92*e:1.055*Math.pow(e,1/2.4)-.055))}function xe(e,t,n){return this instanceof xe?(this.r=~~e,this.g=~~t,void(this.b=~~n)):arguments.length<2?e instanceof xe?new xe(e.r,e.g,e.b):Ce(""+e,xe,fe):new xe(e,t,n)}function ke(e){return new xe(e>>16,e>>8&255,255&e)}function je(e){return ke(e)+""}function Me(e){return e<16?"0"+Math.max(0,e).toString(16):Math.min(255,e).toString(16)}function Ce(e,t,n){var i,r,a,o=0,s=0,l=0;if(i=/([a-z]+)\((.*)\)/.exec(e=e.toLowerCase()))switch(r=i[2].split(","),i[1]){case"hsl":return n(parseFloat(r[0]),parseFloat(r[1])/100,parseFloat(r[2])/100);case"rgb":return t(Ae(r[0]),Ae(r[1]),Ae(r[2]))}return(a=os.get(e))?t(a.r,a.g,a.b):(null==e||"#"!==e.charAt(0)||isNaN(a=parseInt(e.slice(1),16))||(4===e.length?(o=(3840&a)>>4,o|=o>>4,s=240&a,s|=s>>4,l=15&a,l|=l<<4):7===e.length&&(o=(16711680&a)>>16,s=(65280&a)>>8,l=255&a)),t(o,s,l))}function Se(e,t,n){var i,r,a=Math.min(e/=255,t/=255,n/=255),o=Math.max(e,t,n),s=o-a,l=(o+a)/2;return s?(r=l<.5?s/(o+a):s/(2-o-a),i=e==o?(t-n)/s+(t<n?6:0):t==o?(n-e)/s+2:(e-t)/s+4,i*=60):(i=NaN,r=l>0&&l<1?0:i),new he(i,r,l)}function Te(e,t,n){e=Oe(e),t=Oe(t),n=Oe(n);var i=be((.4124564*e+.3575761*t+.1804375*n)/ts),r=be((.2126729*e+.7151522*t+.072175*n)/ns);return ge(116*r-16,500*(i-r),200*(r-be((.0193339*e+.119192*t+.9503041*n)/is)))}function Oe(e){return(e/=255)<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function Ae(e){var t=parseFloat(e);return"%"===e.charAt(e.length-1)?Math.round(2.55*t):t}function Ne(e){return"function"==typeof e?e:function(){return e}}function Ge(e){return function(t,n,i){return 2===arguments.length&&"function"==typeof n&&(i=n,n=null),Le(t,n,e,i)}}function Le(e,t,n,i){function r(){var e,t=l.status;if(!t&&Ie(l)||t>=200&&t<300||304===t){try{e=n.call(a,l)}catch(e){return void o.error.call(a,e)}o.load.call(a,e)}else o.error.call(a,l)}var a={},o=fo.dispatch("beforesend","progress","load","error"),s={},l=new XMLHttpRequest,c=null;return!this.XDomainRequest||"withCredentials"in l||!/^(http(s)?:)?\/\//.test(e)||(l=new XDomainRequest),"onload"in l?l.onload=l.onerror=r:l.onreadystatechange=function(){l.readyState>3&&r()},l.onprogress=function(e){var t=fo.event;fo.event=e;try{o.progress.call(a,l)}finally{fo.event=t}},a.header=function(e,t){return e=(e+"").toLowerCase(),arguments.length<2?s[e]:(null==t?delete s[e]:s[e]=t+"",a)},a.mimeType=function(e){return arguments.length?(t=null==e?null:e+"",a):t},a.responseType=function(e){return arguments.length?(c=e,a):c},a.response=function(e){return n=e,a},["get","post"].forEach(function(e){a[e]=function(){return a.send.apply(a,[e].concat(_o(arguments)))}}),a.send=function(n,i,r){if(2===arguments.length&&"function"==typeof i&&(r=i,i=null),l.open(n,e,!0),null==t||"accept"in s||(s.accept=t+",*/*"),l.setRequestHeader)for(var d in s)l.setRequestHeader(d,s[d]);return null!=t&&l.overrideMimeType&&l.overrideMimeType(t),null!=c&&(l.responseType=c),null!=r&&a.on("error",r).on("load",function(e){r(null,e)}),o.beforesend.call(a,l),l.send(null==i?null:i),a},a.abort=function(){return l.abort(),a},fo.rebind(a,o,"on"),null==i?a:a.get(De(i))}function De(e){return 1===e.length?function(t,n){e(null==t?n:null)}:e}function Ie(e){var t=e.responseType;return t&&"text"!==t?e.response:e.responseText}function Pe(e,t,n){var i=arguments.length;i<2&&(t=0),i<3&&(n=Date.now());var r=n+t,a={c:e,t:r,n:null};return ls?ls.n=a:ss=a,ls=a,cs||(ds=clearTimeout(ds),cs=1,us(Re)),a}function Re(){var e=Ve(),t=Ee()-e;t>24?(isFinite(t)&&(clearTimeout(ds),ds=setTimeout(Re,t)),cs=0):(cs=1,us(Re))}function Ve(){for(var e=Date.now(),t=ss;t;)e>=t.t&&t.c(e-t.t)&&(t.c=null),t=t.n;return e}function Ee(){for(var e,t=ss,n=1/0;t;)t.c?(t.t<n&&(n=t.t),t=(e=t).n):t=e?e.n=t.n:ss=t.n;return ls=e,n}function ze(e,t){return t-(e?Math.ceil(Math.log(e)/Math.LN10):1)}function qe(e,t){var n=Math.pow(10,3*ko(8-t));return{scale:t>8?function(e){return e/n}:function(e){return e*n},symbol:e}}function Fe(e){var t=e.decimal,n=e.thousands,i=e.grouping,r=e.currency,a=i&&n?function(e,t){for(var r=e.length,a=[],o=0,s=i[0],l=0;r>0&&s>0&&(l+s+1>t&&(s=Math.max(1,t-l)),a.push(e.substring(r-=s,r+s)),!((l+=s+1)>t));)s=i[o=(o+1)%i.length];return a.reverse().join(n)}:k;return function(e){var n=fs.exec(e),i=n[1]||" ",o=n[2]||">",s=n[3]||"-",l=n[4]||"",c=n[5],d=+n[6],u=n[7],h=n[8],f=n[9],p=1,_="",g="",m=!1,v=!0;switch(h&&(h=+h.substring(1)),(c||"0"===i&&"="===o)&&(c=i="0",o="="),f){case"n":u=!0,f="g";break;case"%":p=100,g="%",f="f";break;case"p":p=100,g="%",f="r";break;case"b":case"o":case"x":case"X":"#"===l&&(_="0"+f.toLowerCase());case"c":v=!1;case"d":m=!0,h=0;break;case"s":p=-1,f="r"}"$"===l&&(_=r[0],g=r[1]),"r"!=f||h||(f="g"),null!=h&&("g"==f?h=Math.max(1,Math.min(21,h)):"e"!=f&&"f"!=f||(h=Math.max(0,Math.min(20,h)))),f=ps.get(f)||$e;var y=c&&u;return function(e){var n=g;if(m&&e%1)return"";var r=e<0||0===e&&1/e<0?(e=-e,"-"):"-"===s?"":s;if(p<0){var l=fo.formatPrefix(e,h);e=l.scale(e),n=l.symbol+g}else e*=p;e=f(e,h);var b,w,x=e.lastIndexOf(".");if(x<0){var k=v?e.lastIndexOf("e"):-1;k<0?(b=e,w=""):(b=e.substring(0,k),w=e.substring(k))}else b=e.substring(0,x),w=t+e.substring(x+1);!c&&u&&(b=a(b,1/0));var j=_.length+b.length+w.length+(y?0:r.length),M=j<d?new Array(j=d-j+1).join(i):"";return y&&(b=a(M+b,M.length?d-w.length:1/0)),r+=_,e=b+w,("<"===o?r+e+M:">"===o?M+r+e:"^"===o?M.substring(0,j>>=1)+r+e+M.substring(j):r+(y?e:M+e))+n}}}function $e(e){return e+""}function He(){this._=new Date(arguments.length>1?Date.UTC.apply(this,arguments):arguments[0])}function Ue(e,t,n){function i(t){var n=e(t),i=a(n,1);return t-n<i-t?n:i}function r(n){return t(n=e(new gs(n-1)),1),n}function a(e,n){return t(e=new gs(+e),n),e}function o(e,i,a){var o=r(e),s=[];if(a>1)for(;o<i;)n(o)%a||s.push(new Date(+o)),t(o,1);else for(;o<i;)s.push(new Date(+o)),t(o,1);return s}function s(e,t,n){try{gs=He;var i=new He;return i._=e,o(i,t,n)}finally{gs=Date}}e.floor=e,e.round=i,e.ceil=r,e.offset=a,e.range=o;var l=e.utc=Je(e);return l.floor=l,l.round=Je(i),l.ceil=Je(r),l.offset=Je(a),l.range=s,e}function Je(e){return function(t,n){try{gs=He;var i=new He;return i._=t,e(i,n)._}finally{gs=Date}}}function Be(e){function t(e){function t(t){for(var n,r,a,o=[],s=-1,l=0;++s<i;)37===e.charCodeAt(s)&&(o.push(e.slice(l,s)),null!=(r=vs[n=e.charAt(++s)])&&(n=e.charAt(++s)),(a=T[n])&&(n=a(t,null==r?"e"===n?" ":"0":r)),o.push(n),l=s+1);return o.push(e.slice(l,s)),o.join("")}var i=e.length;return t.parse=function(t){var i={y:1900,m:0,d:1,H:0,M:0,S:0,L:0,Z:null};if(n(i,e,t,0)!=t.length)return null;"p"in i&&(i.H=i.H%12+12*i.p);var r=null!=i.Z&&gs!==He,a=new(r?He:gs);return"j"in i?a.setFullYear(i.y,0,i.j):"W"in i||"U"in i?("w"in i||(i.w="W"in i?1:0),a.setFullYear(i.y,0,1),a.setFullYear(i.y,0,"W"in i?(i.w+6)%7+7*i.W-(a.getDay()+5)%7:i.w+7*i.U-(a.getDay()+6)%7)):a.setFullYear(i.y,i.m,i.d),a.setHours(i.H+(i.Z/100|0),i.M+i.Z%100,i.S,i.L),r?a._:a},t.toString=function(){return e},t}function n(e,t,n,i){for(var r,a,o,s=0,l=t.length,c=n.length;s<l;){if(i>=c)return-1;if(37===(r=t.charCodeAt(s++))){if(o=t.charAt(s++),!(a=O[o in vs?t.charAt(s++):o])||(i=a(e,n,i))<0)return-1}else if(r!=n.charCodeAt(i++))return-1}return i}function i(e,t,n){x.lastIndex=0;var i=x.exec(t.slice(n));return i?(e.w=k.get(i[0].toLowerCase()),n+i[0].length):-1}function r(e,t,n){b.lastIndex=0;var i=b.exec(t.slice(n));return i?(e.w=w.get(i[0].toLowerCase()),n+i[0].length):-1}function a(e,t,n){C.lastIndex=0;var i=C.exec(t.slice(n));return i?(e.m=S.get(i[0].toLowerCase()),n+i[0].length):-1}function o(e,t,n){j.lastIndex=0;var i=j.exec(t.slice(n));return i?(e.m=M.get(i[0].toLowerCase()),n+i[0].length):-1}function s(e,t,i){return n(e,T.c.toString(),t,i)}function l(e,t,i){return n(e,T.x.toString(),t,i)}function c(e,t,i){return n(e,T.X.toString(),t,i)}function d(e,t,n){var i=y.get(t.slice(n,n+=2).toLowerCase());return null==i?-1:(e.p=i,n)}var u=e.dateTime,h=e.date,f=e.time,p=e.periods,_=e.days,g=e.shortDays,m=e.months,v=e.shortMonths;t.utc=function(e){function n(e){try{gs=He;var t=new gs;return t._=e,i(t)}finally{gs=Date}}var i=t(e);return n.parse=function(e){try{gs=He;var t=i.parse(e);return t&&t._}finally{gs=Date}},n.toString=i.toString,n},t.multi=t.utc.multi=ft;var y=fo.map(),b=Ye(_),w=Ke(_),x=Ye(g),k=Ke(g),j=Ye(m),M=Ke(m),C=Ye(v),S=Ke(v);p.forEach(function(e,t){y.set(e.toLowerCase(),t)});var T={a:function(e){return g[e.getDay()]},A:function(e){return _[e.getDay()]},b:function(e){return v[e.getMonth()]},B:function(e){return m[e.getMonth()]},c:t(u),d:function(e,t){return We(e.getDate(),t,2)},e:function(e,t){return We(e.getDate(),t,2)},H:function(e,t){return We(e.getHours(),t,2)},I:function(e,t){return We(e.getHours()%12||12,t,2)},j:function(e,t){return We(1+_s.dayOfYear(e),t,3)},L:function(e,t){return We(e.getMilliseconds(),t,3)},m:function(e,t){return We(e.getMonth()+1,t,2)},M:function(e,t){return We(e.getMinutes(),t,2)},p:function(e){return p[+(e.getHours()>=12)]},S:function(e,t){return We(e.getSeconds(),t,2)},U:function(e,t){return We(_s.sundayOfYear(e),t,2)},w:function(e){return e.getDay()},W:function(e,t){return We(_s.mondayOfYear(e),t,2)},x:t(h),X:t(f),y:function(e,t){return We(e.getFullYear()%100,t,2)},Y:function(e,t){return We(e.getFullYear()%1e4,t,4)},Z:ut,"%":function(){return"%"}},O={a:i,A:r,b:a,B:o,c:s,d:at,e:at,H:st,I:st,j:ot,L:dt,m:rt,M:lt,p:d,S:ct,U:Qe,w:Xe,W:Ze,x:l,X:c,y:tt,Y:et,Z:nt,"%":ht};return t}function We(e,t,n){var i=e<0?"-":"",r=(i?-e:e)+"",a=r.length;return i+(a<n?new Array(n-a+1).join(t)+r:r)}function Ye(e){return new RegExp("^(?:"+e.map(fo.requote).join("|")+")","i")}function Ke(e){for(var t=new p,n=-1,i=e.length;++n<i;)t.set(e[n].toLowerCase(),n);return t}function Xe(e,t,n){ys.lastIndex=0;var i=ys.exec(t.slice(n,n+1));return i?(e.w=+i[0],n+i[0].length):-1}function Qe(e,t,n){ys.lastIndex=0;var i=ys.exec(t.slice(n));return i?(e.U=+i[0],n+i[0].length):-1}function Ze(e,t,n){ys.lastIndex=0;var i=ys.exec(t.slice(n));return i?(e.W=+i[0],n+i[0].length):-1}function et(e,t,n){ys.lastIndex=0;var i=ys.exec(t.slice(n,n+4));return i?(e.y=+i[0],n+i[0].length):-1}function tt(e,t,n){ys.lastIndex=0;var i=ys.exec(t.slice(n,n+2));return i?(e.y=it(+i[0]),n+i[0].length):-1}function nt(e,t,n){return/^[+-]\d{4}$/.test(t=t.slice(n,n+5))?(e.Z=-t,n+5):-1}function it(e){return e+(e>68?1900:2e3)}function rt(e,t,n){ys.lastIndex=0;var i=ys.exec(t.slice(n,n+2));return i?(e.m=i[0]-1,n+i[0].length):-1}function at(e,t,n){ys.lastIndex=0;var i=ys.exec(t.slice(n,n+2));return i?(e.d=+i[0],n+i[0].length):-1}function ot(e,t,n){ys.lastIndex=0;var i=ys.exec(t.slice(n,n+3));return i?(e.j=+i[0],n+i[0].length):-1}function st(e,t,n){ys.lastIndex=0;var i=ys.exec(t.slice(n,n+2));return i?(e.H=+i[0],n+i[0].length):-1}function lt(e,t,n){ys.lastIndex=0;var i=ys.exec(t.slice(n,n+2));return i?(e.M=+i[0],n+i[0].length):-1}function ct(e,t,n){ys.lastIndex=0;var i=ys.exec(t.slice(n,n+2));return i?(e.S=+i[0],n+i[0].length):-1}function dt(e,t,n){ys.lastIndex=0;var i=ys.exec(t.slice(n,n+3));return i?(e.L=+i[0],n+i[0].length):-1}function ut(e){var t=e.getTimezoneOffset(),n=t>0?"-":"+",i=ko(t)/60|0,r=ko(t)%60;return n+We(i,"0",2)+We(r,"0",2)}function ht(e,t,n){bs.lastIndex=0;var i=bs.exec(t.slice(n,n+1));return i?n+i[0].length:-1}function ft(e){for(var t=e.length,n=-1;++n<t;)e[n][0]=this(e[n][0]);return function(t){for(var n=0,i=e[n];!i[1](t);)i=e[++n];return i[0](t)}}function pt(){}function _t(e,t,n){var i=n.s=e+t,r=i-e,a=i-r;n.t=e-a+(t-r)}function gt(e,t){e&&js.hasOwnProperty(e.type)&&js[e.type](e,t)}function mt(e,t,n){var i,r=-1,a=e.length-n;for(t.lineStart();++r<a;)i=e[r],t.point(i[0],i[1],i[2]);t.lineEnd()}function vt(e,t){var n=-1,i=e.length;for(t.polygonStart();++n<i;)mt(e[n],t,1);t.polygonEnd()}function yt(){function e(e,t){e*=Jo,t=t*Jo/2+Fo/4;var n=e-i,o=n>=0?1:-1,s=o*n,l=Math.cos(t),c=Math.sin(t),d=a*c,u=r*l+d*Math.cos(s),h=d*o*Math.sin(s);Cs.add(Math.atan2(h,u)),i=e,r=l,a=c}var t,n,i,r,a;Ss.point=function(o,s){Ss.point=e,i=(t=o)*Jo,r=Math.cos(s=(n=s)*Jo/2+Fo/4),a=Math.sin(s)},Ss.lineEnd=function(){e(t,n)}}function bt(e){var t=e[0],n=e[1],i=Math.cos(n);return[i*Math.cos(t),i*Math.sin(t),Math.sin(n)]}function wt(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function xt(e,t){return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]}function kt(e,t){e[0]+=t[0],e[1]+=t[1],e[2]+=t[2]}function jt(e,t){return[e[0]*t,e[1]*t,e[2]*t]}function Mt(e){var t=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]/=t,e[1]/=t,e[2]/=t}function Ct(e){return[Math.atan2(e[1],e[0]),oe(e[2])]}function St(e,t){return ko(e[0]-t[0])<zo&&ko(e[1]-t[1])<zo}function Tt(e,t){e*=Jo;var n=Math.cos(t*=Jo);Ot(n*Math.cos(e),n*Math.sin(e),Math.sin(t))}function Ot(e,t,n){++Ts,As+=(e-As)/Ts,Ns+=(t-Ns)/Ts,Gs+=(n-Gs)/Ts}function At(){function e(e,r){e*=Jo;var a=Math.cos(r*=Jo),o=a*Math.cos(e),s=a*Math.sin(e),l=Math.sin(r),c=Math.atan2(Math.sqrt((c=n*l-i*s)*c+(c=i*o-t*l)*c+(c=t*s-n*o)*c),t*o+n*s+i*l);Os+=c,Ls+=c*(t+(t=o)),Ds+=c*(n+(n=s)),Is+=c*(i+(i=l)),Ot(t,n,i)}var t,n,i;Es.point=function(r,a){r*=Jo;var o=Math.cos(a*=Jo);t=o*Math.cos(r),n=o*Math.sin(r),i=Math.sin(a),Es.point=e,Ot(t,n,i)}}function Nt(){Es.point=Tt}function Gt(){function e(e,t){e*=Jo;var n=Math.cos(t*=Jo),o=n*Math.cos(e),s=n*Math.sin(e),l=Math.sin(t),c=r*l-a*s,d=a*o-i*l,u=i*s-r*o,h=Math.sqrt(c*c+d*d+u*u),f=i*o+r*s+a*l,p=h&&-ae(f)/h,_=Math.atan2(h,f);Ps+=p*c,Rs+=p*d,Vs+=p*u,Os+=_,Ls+=_*(i+(i=o)),Ds+=_*(r+(r=s)),Is+=_*(a+(a=l)),Ot(i,r,a)}var t,n,i,r,a;Es.point=function(o,s){t=o,n=s,Es.point=e,o*=Jo;var l=Math.cos(s*=Jo);i=l*Math.cos(o),r=l*Math.sin(o),a=Math.sin(s),Ot(i,r,a)},Es.lineEnd=function(){e(t,n),Es.lineEnd=Nt,Es.point=Tt}}function Lt(e,t){function n(n,i){return n=e(n,i),t(n[0],n[1])}return e.invert&&t.invert&&(n.invert=function(n,i){return(n=t.invert(n,i))&&e.invert(n[0],n[1])}),n}function Dt(){return!0}function It(e,t,n,i,r){var a=[],o=[];if(e.forEach(function(e){if(!((t=e.length-1)<=0)){var t,n=e[0],i=e[t];if(St(n,i)){r.lineStart();for(var s=0;s<t;++s)r.point((n=e[s])[0],n[1]);return void r.lineEnd()}var l=new Rt(n,e,null,!0),c=new Rt(n,null,l,!1);l.o=c,a.push(l),o.push(c),l=new Rt(i,e,null,!1),c=new Rt(i,null,l,!0),l.o=c,a.push(l),o.push(c)}}),o.sort(t),Pt(a),Pt(o),a.length){for(var s=0,l=n,c=o.length;s<c;++s)o[s].e=l=!l;for(var d,u,h=a[0];;){for(var f=h,p=!0;f.v;)if((f=f.n)===h)return;d=f.z,r.lineStart();do{if(f.v=f.o.v=!0,f.e){if(p)for(var s=0,c=d.length;s<c;++s)r.point((u=d[s])[0],u[1]);else i(f.x,f.n.x,1,r);f=f.n}else{if(p){d=f.p.z;for(var s=d.length-1;s>=0;--s)r.point((u=d[s])[0],u[1])}else i(f.x,f.p.x,-1,r);f=f.p}f=f.o,d=f.z,p=!p}while(!f.v);r.lineEnd()}}}function Pt(e){if(t=e.length){for(var t,n,i=0,r=e[0];++i<t;)r.n=n=e[i],n.p=r,r=n;r.n=n=e[0],n.p=r}}function Rt(e,t,n,i){this.x=e,this.z=t,this.o=n,this.e=i,this.v=!1,this.n=this.p=null}function Vt(e,t,n,i){return function(r,a){function o(t,n){var i=r(t,n);e(t=i[0],n=i[1])&&a.point(t,n)}function s(e,t){var n=r(e,t);g.point(n[0],n[1])}function l(){v.point=s,g.lineStart()}function c(){v.point=o,g.lineEnd()}function d(e,t){_.push([e,t]);var n=r(e,t);b.point(n[0],n[1])}function u(){b.lineStart(),_=[]}function h(){d(_[0][0],_[0][1]),b.lineEnd();var e,t=b.clean(),n=y.buffer(),i=n.length;if(_.pop(),p.push(_),_=null,i)if(1&t){e=n[0];var r,i=e.length-1,o=-1;if(i>0){for(w||(a.polygonStart(),w=!0),a.lineStart();++o<i;)a.point((r=e[o])[0],r[1]);a.lineEnd()}}else i>1&&2&t&&n.push(n.pop().concat(n.shift())),f.push(n.filter(Et))}var f,p,_,g=t(a),m=r.invert(i[0],i[1]),v={point:o,lineStart:l,lineEnd:c,polygonStart:function(){v.point=d,v.lineStart=u,v.lineEnd=h,f=[],p=[]},polygonEnd:function(){v.point=o,v.lineStart=l,v.lineEnd=c,f=fo.merge(f);var e=Ut(m,p);f.length?(w||(a.polygonStart(),w=!0),It(f,qt,e,n,a)):e&&(w||(a.polygonStart(),w=!0),a.lineStart(),n(null,null,1,a),a.lineEnd()),w&&(a.polygonEnd(),w=!1),f=p=null},sphere:function(){a.polygonStart(),a.lineStart(),n(null,null,1,a),a.lineEnd(),a.polygonEnd()}},y=zt(),b=t(y),w=!1;return v}}function Et(e){return e.length>1}function zt(){var e,t=[];return{lineStart:function(){t.push(e=[])},point:function(t,n){e.push([t,n])},lineEnd:C,buffer:function(){var n=t;return t=[],e=null,n},rejoin:function(){t.length>1&&t.push(t.pop().concat(t.shift()))}}}function qt(e,t){return((e=e.x)[0]<0?e[1]-Uo-zo:Uo-e[1])-((t=t.x)[0]<0?t[1]-Uo-zo:Uo-t[1])}function Ft(e){var t,n=NaN,i=NaN,r=NaN;return{lineStart:function(){e.lineStart(),t=1},point:function(a,o){var s=a>0?Fo:-Fo,l=ko(a-n);ko(l-Fo)<zo?(e.point(n,i=(i+o)/2>0?Uo:-Uo),e.point(r,i),e.lineEnd(),e.lineStart(),e.point(s,i),e.point(a,i),t=0):r!==s&&l>=Fo&&(ko(n-r)<zo&&(n-=r*zo),ko(a-s)<zo&&(a-=s*zo),i=$t(n,i,a,o),e.point(r,i),e.lineEnd(),e.lineStart(),e.point(s,i),t=0),e.point(n=a,i=o),r=s},lineEnd:function(){e.lineEnd(),n=i=NaN},clean:function(){return 2-t}}}function $t(e,t,n,i){var r,a,o=Math.sin(e-n);return ko(o)>zo?Math.atan((Math.sin(t)*(a=Math.cos(i))*Math.sin(n)-Math.sin(i)*(r=Math.cos(t))*Math.sin(e))/(r*a*o)):(t+i)/2}function Ht(e,t,n,i){var r;if(null==e)r=n*Uo,i.point(-Fo,r),i.point(0,r),i.point(Fo,r),i.point(Fo,0),i.point(Fo,-r),i.point(0,-r),i.point(-Fo,-r),i.point(-Fo,0),i.point(-Fo,r);else if(ko(e[0]-t[0])>zo){var a=e[0]<t[0]?Fo:-Fo;r=n*a/2,i.point(-a,r),i.point(0,r),i.point(a,r)}else i.point(t[0],t[1])}function Ut(e,t){var n=e[0],i=e[1],r=[Math.sin(n),-Math.cos(n),0],a=0,o=0;Cs.reset();for(var s=0,l=t.length;s<l;++s){var c=t[s],d=c.length;if(d)for(var u=c[0],h=u[0],f=u[1]/2+Fo/4,p=Math.sin(f),_=Math.cos(f),g=1;;){g===d&&(g=0),e=c[g];var m=e[0],v=e[1]/2+Fo/4,y=Math.sin(v),b=Math.cos(v),w=m-h,x=w>=0?1:-1,k=x*w,j=k>Fo,M=p*y;if(Cs.add(Math.atan2(M*x*Math.sin(k),_*b+M*Math.cos(k))),a+=j?w+x*$o:w,j^h>=n^m>=n){var C=xt(bt(u),bt(e));Mt(C);var S=xt(r,C);Mt(S);var T=(j^w>=0?-1:1)*oe(S[2]);(i>T||i===T&&(C[0]||C[1]))&&(o+=j^w>=0?1:-1)}if(!g++)break;h=m,p=y,_=b,u=e}}return(a<-zo||a<zo&&Cs<-zo)^1&o}function Jt(e){function t(e,t){return Math.cos(e)*Math.cos(t)>a}function n(e){var n,a,l,c,d;return{lineStart:function(){c=l=!1,d=1},point:function(u,h){var f,p=[u,h],_=t(u,h),g=o?_?0:r(u,h):_?r(u+(u<0?Fo:-Fo),h):0;if(!n&&(c=l=_)&&e.lineStart(),_!==l&&(f=i(n,p),(St(n,f)||St(p,f))&&(p[0]+=zo,p[1]+=zo,_=t(p[0],p[1]))),_!==l)d=0,_?(e.lineStart(),f=i(p,n),e.point(f[0],f[1])):(f=i(n,p),e.point(f[0],f[1]),e.lineEnd()),n=f;else if(s&&n&&o^_){var m;g&a||!(m=i(p,n,!0))||(d=0,o?(e.lineStart(),e.point(m[0][0],m[0][1]),e.point(m[1][0],m[1][1]),e.lineEnd()):(e.point(m[1][0],m[1][1]),e.lineEnd(),e.lineStart(),e.point(m[0][0],m[0][1])))}!_||n&&St(n,p)||e.point(p[0],p[1]),n=p,l=_,a=g},lineEnd:function(){l&&e.lineEnd(),n=null},clean:function(){return d|(c&&l)<<1}}}function i(e,t,n){var i=bt(e),r=bt(t),o=[1,0,0],s=xt(i,r),l=wt(s,s),c=s[0],d=l-c*c;if(!d)return!n&&e;var u=a*l/d,h=-a*c/d,f=xt(o,s),p=jt(o,u);kt(p,jt(s,h));var _=f,g=wt(p,_),m=wt(_,_),v=g*g-m*(wt(p,p)-1);if(!(v<0)){var y=Math.sqrt(v),b=jt(_,(-g-y)/m);if(kt(b,p),b=Ct(b),!n)return b;var w,x=e[0],k=t[0],j=e[1],M=t[1];k<x&&(w=x,x=k,k=w);var C=k-x,S=ko(C-Fo)<zo,T=S||C<zo;if(!S&&M<j&&(w=j,j=M,M=w),T?S?j+M>0^b[1]<(ko(b[0]-x)<zo?j:M):j<=b[1]&&b[1]<=M:C>Fo^(x<=b[0]&&b[0]<=k)){var O=jt(_,(-g+y)/m);return kt(O,p),[b,Ct(O)]}}}function r(t,n){var i=o?e:Fo-e,r=0;return t<-i?r|=1:t>i&&(r|=2),n<-i?r|=4:n>i&&(r|=8),r}var a=Math.cos(e),o=a>0,s=ko(a)>zo;return Vt(t,n,bn(e,6*Jo),o?[0,-e]:[-Fo,e-Fo])}function Bt(e,t,n,i){return function(r){var a,o=r.a,s=r.b,l=o.x,c=o.y,d=s.x,u=s.y,h=0,f=1,p=d-l,_=u-c;if(a=e-l,p||!(a>0)){if(a/=p,p<0){if(a<h)return;a<f&&(f=a)}else if(p>0){if(a>f)return;a>h&&(h=a)}if(a=n-l,p||!(a<0)){if(a/=p,p<0){if(a>f)return;a>h&&(h=a)}else if(p>0){if(a<h)return;a<f&&(f=a)}if(a=t-c,_||!(a>0)){if(a/=_,_<0){if(a<h)return;a<f&&(f=a)}else if(_>0){if(a>f)return;a>h&&(h=a)}if(a=i-c,_||!(a<0)){if(a/=_,_<0){if(a>f)return;a>h&&(h=a)}else if(_>0){if(a<h)return;a<f&&(f=a)}return h>0&&(r.a={x:l+h*p,y:c+h*_}),f<1&&(r.b={x:l+f*p,y:c+f*_}),r}}}}}}function Wt(e,t,n,i){function r(i,r){return ko(i[0]-e)<zo?r>0?0:3:ko(i[0]-n)<zo?r>0?2:1:ko(i[1]-t)<zo?r>0?1:0:r>0?3:2}function a(e,t){return o(e.x,t.x)}function o(e,t){var n=r(e,1),i=r(t,1);return n!==i?n-i:0===n?t[1]-e[1]:1===n?e[0]-t[0]:2===n?e[1]-t[1]:t[0]-e[0]}return function(s){function l(e){for(var t=0,n=g.length,i=e[1],r=0;r<n;++r)for(var a,o=1,s=g[r],l=s.length,c=s[0];o<l;++o)a=s[o],c[1]<=i?a[1]>i&&re(c,a,e)>0&&++t:a[1]<=i&&re(c,a,e)<0&&--t,c=a;return 0!==t}function c(a,s,l,c){var d=0,u=0;if(null==a||(d=r(a,l))!==(u=r(s,l))||o(a,s)<0^l>0)do{c.point(0===d||3===d?e:n,d>1?i:t)}while((d=(d+l+4)%4)!==u);else c.point(s[0],s[1])}function d(r,a){return e<=r&&r<=n&&t<=a&&a<=i}function u(e,t){d(e,t)&&s.point(e,t)}function h(){O.point=p,g&&g.push(m=[]),j=!0,k=!1,w=x=NaN}function f(){_&&(p(v,y),b&&k&&S.rejoin(),_.push(S.buffer())),O.point=u,k&&s.lineEnd()}function p(e,t){e=Math.max(-qs,Math.min(qs,e)),t=Math.max(-qs,Math.min(qs,t));var n=d(e,t);if(g&&m.push([e,t]),j)v=e,y=t,b=n,j=!1,n&&(s.lineStart(),s.point(e,t));else if(n&&k)s.point(e,t);else{var i={a:{x:w,y:x},b:{x:e,y:t}};T(i)?(k||(s.lineStart(),s.point(i.a.x,i.a.y)),s.point(i.b.x,i.b.y),n||s.lineEnd(),M=!1):n&&(s.lineStart(),s.point(e,t),M=!1)}w=e,x=t,k=n}var _,g,m,v,y,b,w,x,k,j,M,C=s,S=zt(),T=Bt(e,t,n,i),O={point:u,lineStart:h,lineEnd:f,polygonStart:function(){s=S,_=[],g=[],M=!0},polygonEnd:function(){s=C,_=fo.merge(_);var t=l([e,i]),n=M&&t,r=_.length;(n||r)&&(s.polygonStart(),n&&(s.lineStart(),c(null,null,1,s),s.lineEnd()),r&&It(_,a,t,c,s),s.polygonEnd()),_=g=m=null}};return O}}function Yt(e){var t=0,n=Fo/3,i=hn(e),r=i(t,n);return r.parallels=function(e){return arguments.length?i(t=e[0]*Fo/180,n=e[1]*Fo/180):[t/Fo*180,n/Fo*180]},r}function Kt(e,t){function n(e,t){var n=Math.sqrt(a-2*r*Math.sin(t))/r;return[n*Math.sin(e*=r),o-n*Math.cos(e)]}var i=Math.sin(e),r=(i+Math.sin(t))/2,a=1+i*(2*r-i),o=Math.sqrt(a)/r;return n.invert=function(e,t){var n=o-t;return[Math.atan2(e,n)/r,oe((a-(e*e+n*n)*r*r)/(2*r))]},n}function Xt(){function e(e,t){$s+=r*e-i*t,i=e,r=t}var t,n,i,r;Ws.point=function(a,o){Ws.point=e,t=i=a,n=r=o},Ws.lineEnd=function(){e(t,n)}}function Qt(e,t){e<Hs&&(Hs=e),e>Js&&(Js=e),t<Us&&(Us=t),t>Bs&&(Bs=t)}function Zt(){function e(e,t){o.push("M",e,",",t,a)}function t(e,t){o.push("M",e,",",t),s.point=n}function n(e,t){o.push("L",e,",",t)}function i(){s.point=e}function r(){o.push("Z")}var a=en(4.5),o=[],s={point:e,lineStart:function(){s.point=t},lineEnd:i,polygonStart:function(){s.lineEnd=r},polygonEnd:function(){s.lineEnd=i,s.point=e},pointRadius:function(e){return a=en(e),s},result:function(){if(o.length){var e=o.join("");return o=[],e}}};return s}function en(e){return"m0,"+e+"a"+e+","+e+" 0 1,1 0,"+-2*e+"a"+e+","+e+" 0 1,1 0,"+2*e+"z"}function tn(e,t){As+=e,Ns+=t,++Gs}function nn(){function e(e,i){var r=e-t,a=i-n,o=Math.sqrt(r*r+a*a);Ls+=o*(t+e)/2,Ds+=o*(n+i)/2,Is+=o,tn(t=e,n=i)}var t,n;Ks.point=function(i,r){Ks.point=e,tn(t=i,n=r)}}function rn(){Ks.point=tn}function an(){function e(e,t){var n=e-i,a=t-r,o=Math.sqrt(n*n+a*a);Ls+=o*(i+e)/2,Ds+=o*(r+t)/2,Is+=o,o=r*e-i*t,Ps+=o*(i+e),Rs+=o*(r+t),Vs+=3*o,tn(i=e,r=t)}var t,n,i,r;Ks.point=function(a,o){Ks.point=e,tn(t=i=a,n=r=o)},Ks.lineEnd=function(){e(t,n)}}function on(e){function t(t,n){e.moveTo(t+o,n),e.arc(t,n,o,0,$o)}function n(t,n){e.moveTo(t,n),s.point=i}function i(t,n){e.lineTo(t,n)}function r(){s.point=t}function a(){e.closePath()}var o=4.5,s={point:t,lineStart:function(){s.point=n},lineEnd:r,polygonStart:function(){s.lineEnd=a},polygonEnd:function(){s.lineEnd=r,s.point=t},pointRadius:function(e){return o=e,s},result:C};return s}function sn(e){function t(e){return(s?i:n)(e)}function n(t){return dn(t,function(n,i){n=e(n,i),t.point(n[0],n[1])})}function i(t){function n(n,i){n=e(n,i),t.point(n[0],n[1])}function i(){y=NaN,j.point=a,t.lineStart()}function a(n,i){var a=bt([n,i]),o=e(n,i);r(y,b,v,w,x,k,y=o[0],b=o[1],v=n,w=a[0],x=a[1],k=a[2],s,t),t.point(y,b)}function o(){j.point=n,t.lineEnd()}function l(){i(),j.point=c,j.lineEnd=d}function c(e,t){a(u=e,h=t),f=y,p=b,_=w,g=x,m=k,j.point=a}function d(){r(y,b,v,w,x,k,f,p,u,_,g,m,s,t),j.lineEnd=o,o()}var u,h,f,p,_,g,m,v,y,b,w,x,k,j={point:n,lineStart:i,lineEnd:o,polygonStart:function(){t.polygonStart(),j.lineStart=l},polygonEnd:function(){t.polygonEnd(),j.lineStart=i}};return j}function r(t,n,i,s,l,c,d,u,h,f,p,_,g,m){var v=d-t,y=u-n,b=v*v+y*y;if(b>4*a&&g--){var w=s+f,x=l+p,k=c+_,j=Math.sqrt(w*w+x*x+k*k),M=Math.asin(k/=j),C=ko(ko(k)-1)<zo||ko(i-h)<zo?(i+h)/2:Math.atan2(x,w),S=e(C,M),T=S[0],O=S[1],A=T-t,N=O-n,G=y*A-v*N;(G*G/b>a||ko((v*A+y*N)/b-.5)>.3||s*f+l*p+c*_<o)&&(r(t,n,i,s,l,c,T,O,C,w/=j,x/=j,k,g,m),m.point(T,O),r(T,O,C,w,x,k,d,u,h,f,p,_,g,m))}}var a=.5,o=Math.cos(30*Jo),s=16;return t.precision=function(e){return arguments.length?(s=(a=e*e)>0&&16,t):Math.sqrt(a)},t}function ln(e){var t=sn(function(t,n){return e([t*Bo,n*Bo])});return function(e){return fn(t(e))}}function cn(e){this.stream=e}function dn(e,t){return{point:t,sphere:function(){e.sphere()},lineStart:function(){e.lineStart()},lineEnd:function(){e.lineEnd()},polygonStart:function(){e.polygonStart()},polygonEnd:function(){e.polygonEnd()}}}function un(e){return hn(function(){return e})()}function hn(e){function t(e){return e=s(e[0]*Jo,e[1]*Jo),[e[0]*h+l,c-e[1]*h]}function n(e){return(e=s.invert((e[0]-l)/h,(c-e[1])/h))&&[e[0]*Bo,e[1]*Bo]}function i(){s=Lt(o=gn(m,v,y),a);var e=a(_,g);return l=f-e[0]*h,c=p+e[1]*h,r()}function r(){return d&&(d.valid=!1,d=null),t}var a,o,s,l,c,d,u=sn(function(e,t){return e=a(e,t),[e[0]*h+l,c-e[1]*h]}),h=150,f=480,p=250,_=0,g=0,m=0,v=0,y=0,b=zs,w=k,x=null,j=null;return t.stream=function(e){return d&&(d.valid=!1),d=fn(b(o,u(w(e)))),d.valid=!0,d},t.clipAngle=function(e){return arguments.length?(b=null==e?(x=e,zs):Jt((x=+e)*Jo),r()):x},t.clipExtent=function(e){return arguments.length?(j=e,w=e?Wt(e[0][0],e[0][1],e[1][0],e[1][1]):k,r()):j},t.scale=function(e){return arguments.length?(h=+e,i()):h},t.translate=function(e){return arguments.length?(f=+e[0],p=+e[1],i()):[f,p]},t.center=function(e){return arguments.length?(_=e[0]%360*Jo,g=e[1]%360*Jo,i()):[_*Bo,g*Bo]},t.rotate=function(e){return arguments.length?(m=e[0]%360*Jo,v=e[1]%360*Jo,y=e.length>2?e[2]%360*Jo:0,i()):[m*Bo,v*Bo,y*Bo]},fo.rebind(t,u,"precision"),function(){return a=e.apply(this,arguments),t.invert=a.invert&&n,i()}}function fn(e){return dn(e,function(t,n){e.point(t*Jo,n*Jo)})}function pn(e,t){return[e,t]}function _n(e,t){return[e>Fo?e-$o:e<-Fo?e+$o:e,t]}function gn(e,t,n){return e?t||n?Lt(vn(e),yn(t,n)):vn(e):t||n?yn(t,n):_n}function mn(e){return function(t,n){return t+=e,[t>Fo?t-$o:t<-Fo?t+$o:t,n]}}function vn(e){var t=mn(e);return t.invert=mn(-e),t}function yn(e,t){function n(e,t){var n=Math.cos(t),s=Math.cos(e)*n,l=Math.sin(e)*n,c=Math.sin(t),d=c*i+s*r;return[Math.atan2(l*a-d*o,s*i-c*r),oe(d*a+l*o)]}var i=Math.cos(e),r=Math.sin(e),a=Math.cos(t),o=Math.sin(t);return n.invert=function(e,t){var n=Math.cos(t),s=Math.cos(e)*n,l=Math.sin(e)*n,c=Math.sin(t),d=c*a-l*o;return[Math.atan2(l*a+c*o,s*i+d*r),oe(d*i-s*r)]},n}function bn(e,t){var n=Math.cos(e),i=Math.sin(e);return function(r,a,o,s){var l=o*t;null!=r?(r=wn(n,r),a=wn(n,a),(o>0?r<a:r>a)&&(r+=o*$o)):(r=e+o*$o,a=e-.5*l);for(var c,d=r;o>0?d>a:d<a;d-=l)s.point((c=Ct([n,-i*Math.cos(d),-i*Math.sin(d)]))[0],c[1])}}function wn(e,t){var n=bt(t);n[0]-=e,Mt(n);var i=ae(-n[1]);return((-n[2]<0?-i:i)+2*Math.PI-zo)%(2*Math.PI)}function xn(e,t,n){var i=fo.range(e,t-zo,n).concat(t);return function(e){return i.map(function(t){return[e,t]})}}function kn(e,t,n){var i=fo.range(e,t-zo,n).concat(t);return function(e){return i.map(function(t){return[t,e]})}}function jn(e){return e.source}function Mn(e){return e.target}function Cn(e,t,n,i){var r=Math.cos(t),a=Math.sin(t),o=Math.cos(i),s=Math.sin(i),l=r*Math.cos(e),c=r*Math.sin(e),d=o*Math.cos(n),u=o*Math.sin(n),h=2*Math.asin(Math.sqrt(de(i-t)+r*o*de(n-e))),f=1/Math.sin(h),p=h?function(e){var t=Math.sin(e*=h)*f,n=Math.sin(h-e)*f,i=n*l+t*d,r=n*c+t*u,o=n*a+t*s;return[Math.atan2(r,i)*Bo,Math.atan2(o,Math.sqrt(i*i+r*r))*Bo]}:function(){return[e*Bo,t*Bo]};return p.distance=h,p}function Sn(){function e(e,r){var a=Math.sin(r*=Jo),o=Math.cos(r),s=ko((e*=Jo)-t),l=Math.cos(s);Xs+=Math.atan2(Math.sqrt((s=o*Math.sin(s))*s+(s=i*a-n*o*l)*s),n*a+i*o*l),t=e,n=a,i=o}var t,n,i;Qs.point=function(r,a){t=r*Jo,n=Math.sin(a*=Jo),i=Math.cos(a),Qs.point=e},Qs.lineEnd=function(){Qs.point=Qs.lineEnd=C}}function Tn(e,t){function n(t,n){var i=Math.cos(t),r=Math.cos(n),a=e(i*r);return[a*r*Math.sin(t),a*Math.sin(n)]}return n.invert=function(e,n){var i=Math.sqrt(e*e+n*n),r=t(i),a=Math.sin(r),o=Math.cos(r);return[Math.atan2(e*a,i*o),Math.asin(i&&n*a/i)]},n}function On(e,t){function n(e,t){o>0?t<-Uo+zo&&(t=-Uo+zo):t>Uo-zo&&(t=Uo-zo);var n=o/Math.pow(r(t),a);return[n*Math.sin(a*e),o-n*Math.cos(a*e)]}var i=Math.cos(e),r=function(e){return Math.tan(Fo/4+e/2)},a=e===t?Math.sin(e):Math.log(i/Math.cos(t))/Math.log(r(t)/r(e)),o=i*Math.pow(r(e),a)/a;return a?(n.invert=function(e,t){var n=o-t,i=ie(a)*Math.sqrt(e*e+n*n);return[Math.atan2(e,n)/a,2*Math.atan(Math.pow(o/i,1/a))-Uo]},n):Nn}function An(e,t){function n(e,t){var n=a-t;return[n*Math.sin(r*e),a-n*Math.cos(r*e)]}var i=Math.cos(e),r=e===t?Math.sin(e):(i-Math.cos(t))/(t-e),a=i/r+e;return ko(r)<zo?pn:(n.invert=function(e,t){var n=a-t;return[Math.atan2(e,n)/r,a-ie(r)*Math.sqrt(e*e+n*n)]},n)}function Nn(e,t){return[e,Math.log(Math.tan(Fo/4+t/2))]}function Gn(e){var t,n=un(e),i=n.scale,r=n.translate,a=n.clipExtent;return n.scale=function(){var e=i.apply(n,arguments);return e===n?t?n.clipExtent(null):n:e},n.translate=function(){var e=r.apply(n,arguments);return e===n?t?n.clipExtent(null):n:e},n.clipExtent=function(e){var o=a.apply(n,arguments);if(o===n){if(t=null==e){var s=Fo*i(),l=r();a([[l[0]-s,l[1]-s],[l[0]+s,l[1]+s]])}}else t&&(o=null);return o},n.clipExtent(null)}function Ln(e,t){return[Math.log(Math.tan(Fo/4+t/2)),-e]}function Dn(e){return e[0]}function In(e){return e[1]}function Pn(e){for(var t=e.length,n=[0,1],i=2,r=2;r<t;r++){for(;i>1&&re(e[n[i-2]],e[n[i-1]],e[r])<=0;)--i;n[i++]=r}return n.slice(0,i)}function Rn(e,t){return e[0]-t[0]||e[1]-t[1]}function Vn(e,t,n){return(n[0]-t[0])*(e[1]-t[1])<(n[1]-t[1])*(e[0]-t[0])}function En(e,t,n,i){var r=e[0],a=n[0],o=t[0]-r,s=i[0]-a,l=e[1],c=n[1],d=t[1]-l,u=i[1]-c,h=(s*(l-c)-u*(r-a))/(u*o-s*d);return[r+h*o,l+h*d]}function zn(e){var t=e[0],n=e[e.length-1];return!(t[0]-n[0]||t[1]-n[1])}function qn(){li(this),this.edge=this.site=this.circle=null}function Fn(e){var t=dl.pop()||new qn;return t.site=e,t}function $n(e){Zn(e),sl.remove(e),dl.push(e),li(e)}function Hn(e){var t=e.circle,n=t.x,i=t.cy,r={x:n,y:i},a=e.P,o=e.N,s=[e];$n(e);for(var l=a;l.circle&&ko(n-l.circle.x)<zo&&ko(i-l.circle.cy)<zo;)a=l.P,s.unshift(l),$n(l),l=a;s.unshift(l),Zn(l);for(var c=o;c.circle&&ko(n-c.circle.x)<zo&&ko(i-c.circle.cy)<zo;)o=c.N,s.push(c),$n(c),c=o;s.push(c),Zn(c);var d,u=s.length;for(d=1;d<u;++d)c=s[d],l=s[d-1],ai(c.edge,l.site,c.site,r);l=s[0],c=s[u-1],c.edge=ii(l.site,c.site,null,r),Qn(l),Qn(c)}function Un(e){for(var t,n,i,r,a=e.x,o=e.y,s=sl._;s;)if((i=Jn(s,o)-a)>zo)s=s.L;else{if(!((r=a-Bn(s,o))>zo)){i>-zo?(t=s.P,n=s):r>-zo?(t=s,n=s.N):t=n=s;break}if(!s.R){t=s;break}s=s.R}var l=Fn(e);if(sl.insert(t,l),t||n){if(t===n)return Zn(t),n=Fn(t.site),sl.insert(l,n),l.edge=n.edge=ii(t.site,l.site),Qn(t),void Qn(n);if(!n)return void(l.edge=ii(t.site,l.site));Zn(t),Zn(n);var c=t.site,d=c.x,u=c.y,h=e.x-d,f=e.y-u,p=n.site,_=p.x-d,g=p.y-u,m=2*(h*g-f*_),v=h*h+f*f,y=_*_+g*g,b={x:(g*v-f*y)/m+d,y:(h*y-_*v)/m+u};ai(n.edge,c,p,b),l.edge=ii(c,e,null,b),n.edge=ii(e,p,null,b),Qn(t),Qn(n)}}function Jn(e,t){var n=e.site,i=n.x,r=n.y,a=r-t;if(!a)return i;var o=e.P;if(!o)return-1/0;n=o.site;var s=n.x,l=n.y,c=l-t;if(!c)return s;var d=s-i,u=1/a-1/c,h=d/c;return u?(-h+Math.sqrt(h*h-2*u*(d*d/(-2*c)-l+c/2+r-a/2)))/u+i:(i+s)/2}function Bn(e,t){var n=e.N;if(n)return Jn(n,t);var i=e.site;return i.y===t?i.x:1/0}function Wn(e){this.site=e,this.edges=[]}function Yn(e){for(var t,n,i,r,a,o,s,l,c,d,u=e[0][0],h=e[1][0],f=e[0][1],p=e[1][1],_=ol,g=_.length;g--;)if((a=_[g])&&a.prepare())for(s=a.edges,l=s.length,o=0;o<l;)d=s[o].end(),i=d.x,r=d.y,c=s[++o%l].start(),t=c.x,n=c.y,(ko(i-t)>zo||ko(r-n)>zo)&&(s.splice(o,0,new oi(ri(a.site,d,ko(i-u)<zo&&p-r>zo?{x:u,y:ko(t-u)<zo?n:p}:ko(r-p)<zo&&h-i>zo?{x:ko(n-p)<zo?t:h,y:p}:ko(i-h)<zo&&r-f>zo?{x:h,y:ko(t-h)<zo?n:f}:ko(r-f)<zo&&i-u>zo?{x:ko(n-f)<zo?t:u,y:f}:null),a.site,null)),++l)}function Kn(e,t){return t.angle-e.angle}function Xn(){li(this),this.x=this.y=this.arc=this.site=this.cy=null}function Qn(e){var t=e.P,n=e.N;if(t&&n){var i=t.site,r=e.site,a=n.site;if(i!==a){var o=r.x,s=r.y,l=i.x-o,c=i.y-s,d=a.x-o,u=a.y-s,h=2*(l*u-c*d);if(!(h>=-qo)){var f=l*l+c*c,p=d*d+u*u,_=(u*f-c*p)/h,g=(l*p-d*f)/h,u=g+s,m=ul.pop()||new Xn;m.arc=e,m.site=r,m.x=_+o,m.y=u+Math.sqrt(_*_+g*g),m.cy=u,e.circle=m;for(var v=null,y=cl._;y;)if(m.y<y.y||m.y===y.y&&m.x<=y.x){if(!y.L){v=y.P;break}y=y.L}else{if(!y.R){v=y;break}y=y.R}cl.insert(v,m),v||(ll=m)}}}}function Zn(e){var t=e.circle;t&&(t.P||(ll=t.N),cl.remove(t),ul.push(t),li(t),e.circle=null)}function ei(e){for(var t,n=al,i=Bt(e[0][0],e[0][1],e[1][0],e[1][1]),r=n.length;r--;)t=n[r],(!ti(t,e)||!i(t)||ko(t.a.x-t.b.x)<zo&&ko(t.a.y-t.b.y)<zo)&&(t.a=t.b=null,n.splice(r,1))}function ti(e,t){var n=e.b;if(n)return!0;var i,r,a=e.a,o=t[0][0],s=t[1][0],l=t[0][1],c=t[1][1],d=e.l,u=e.r,h=d.x,f=d.y,p=u.x,_=u.y,g=(h+p)/2,m=(f+_)/2;if(_===f){if(g<o||g>=s)return;if(h>p){if(a){if(a.y>=c)return}else a={x:g,y:l};n={x:g,y:c}}else{if(a){if(a.y<l)return}else a={x:g,y:c};n={x:g,y:l}}}else if(i=(h-p)/(_-f),r=m-i*g,i<-1||i>1)if(h>p){if(a){if(a.y>=c)return}else a={x:(l-r)/i,y:l};n={x:(c-r)/i,y:c}}else{if(a){if(a.y<l)return}else a={x:(c-r)/i,y:c};n={x:(l-r)/i,y:l}}else if(f<_){if(a){if(a.x>=s)return}else a={x:o,y:i*o+r};n={x:s,y:i*s+r}}else{if(a){if(a.x<o)return}else a={x:s,y:i*s+r};n={x:o,y:i*o+r}}return e.a=a,e.b=n,!0}function ni(e,t){this.l=e,this.r=t,this.a=this.b=null}function ii(e,t,n,i){var r=new ni(e,t);return al.push(r),n&&ai(r,e,t,n),i&&ai(r,t,e,i),ol[e.i].edges.push(new oi(r,e,t)),ol[t.i].edges.push(new oi(r,t,e)),r}function ri(e,t,n){var i=new ni(e,null);return i.a=t,i.b=n,al.push(i),i}function ai(e,t,n,i){e.a||e.b?e.l===n?e.b=i:e.a=i:(e.a=i,e.l=t,e.r=n)}function oi(e,t,n){var i=e.a,r=e.b;this.edge=e,this.site=t,this.angle=n?Math.atan2(n.y-t.y,n.x-t.x):e.l===t?Math.atan2(r.x-i.x,i.y-r.y):Math.atan2(i.x-r.x,r.y-i.y)}function si(){this._=null}function li(e){e.U=e.C=e.L=e.R=e.P=e.N=null}function ci(e,t){var n=t,i=t.R,r=n.U;r?r.L===n?r.L=i:r.R=i:e._=i,i.U=r,n.U=i,n.R=i.L,n.R&&(n.R.U=n),i.L=n}function di(e,t){var n=t,i=t.L,r=n.U;r?r.L===n?r.L=i:r.R=i:e._=i,i.U=r,n.U=i,n.L=i.R,n.L&&(n.L.U=n),i.R=n}function ui(e){for(;e.L;)e=e.L;return e}function hi(e,t){var n,i,r,a=e.sort(fi).pop();for(al=[],ol=new Array(e.length),sl=new si,cl=new si;;)if(r=ll,a&&(!r||a.y<r.y||a.y===r.y&&a.x<r.x))a.x===n&&a.y===i||(ol[a.i]=new Wn(a),Un(a),n=a.x,i=a.y),a=e.pop();else{if(!r)break;Hn(r.arc)}t&&(ei(t),Yn(t));var o={cells:ol,edges:al};return sl=cl=al=ol=null,o}function fi(e,t){return t.y-e.y||t.x-e.x}function pi(e,t,n){return(e.x-n.x)*(t.y-e.y)-(e.x-t.x)*(n.y-e.y)}function _i(e){return e.x}function gi(e){return e.y}function mi(){return{leaf:!0,nodes:[],point:null,x:null,y:null}}function vi(e,t,n,i,r,a){if(!e(t,n,i,r,a)){var o=.5*(n+r),s=.5*(i+a),l=t.nodes;l[0]&&vi(e,l[0],n,i,o,s),l[1]&&vi(e,l[1],o,i,r,s),l[2]&&vi(e,l[2],n,s,o,a),l[3]&&vi(e,l[3],o,s,r,a)}}function yi(e,t,n,i,r,a,o){var s,l=1/0;return function e(c,d,u,h,f){if(!(d>a||u>o||h<i||f<r)){if(p=c.point){var p,_=t-c.x,g=n-c.y,m=_*_+g*g;if(m<l){var v=Math.sqrt(l=m);i=t-v,r=n-v,a=t+v,o=n+v,s=p}}for(var y=c.nodes,b=.5*(d+h),w=.5*(u+f),x=t>=b,k=n>=w,j=k<<1|x,M=j+4;j<M;++j)if(c=y[3&j])switch(3&j){case 0:e(c,d,u,b,w);break;case 1:e(c,b,u,h,w);break;case 2:e(c,d,w,b,f);break;case 3:e(c,b,w,h,f)}}}(e,i,r,a,o),s}function bi(e,t){e=fo.rgb(e),t=fo.rgb(t);var n=e.r,i=e.g,r=e.b,a=t.r-n,o=t.g-i,s=t.b-r;return function(e){return"#"+Me(Math.round(n+a*e))+Me(Math.round(i+o*e))+Me(Math.round(r+s*e))}}function wi(e,t){var n,i={},r={};for(n in e)n in t?i[n]=ji(e[n],t[n]):r[n]=e[n];for(n in t)n in e||(r[n]=t[n]);return function(e){for(n in i)r[n]=i[n](e);return r}}function xi(e,t){return e=+e,t=+t,function(n){return e*(1-n)+t*n}}function ki(e,t){var n,i,r,a=fl.lastIndex=pl.lastIndex=0,o=-1,s=[],l=[];for(e+="",t+="";(n=fl.exec(e))&&(i=pl.exec(t));)(r=i.index)>a&&(r=t.slice(a,r),s[o]?s[o]+=r:s[++o]=r),(n=n[0])===(i=i[0])?s[o]?s[o]+=i:s[++o]=i:(s[++o]=null,l.push({i:o,x:xi(n,i)})),a=pl.lastIndex;return a<t.length&&(r=t.slice(a),s[o]?s[o]+=r:s[++o]=r),s.length<2?l[0]?(t=l[0].x,function(e){return t(e)+""}):function(){return t}:(t=l.length,function(e){for(var n,i=0;i<t;++i)s[(n=l[i]).i]=n.x(e);return s.join("")})}function ji(e,t){for(var n,i=fo.interpolators.length;--i>=0&&!(n=fo.interpolators[i](e,t)););return n}function Mi(e,t){var n,i=[],r=[],a=e.length,o=t.length,s=Math.min(e.length,t.length);for(n=0;n<s;++n)i.push(ji(e[n],t[n]));for(;n<a;++n)r[n]=e[n];for(;n<o;++n)r[n]=t[n];return function(e){for(n=0;n<s;++n)r[n]=i[n](e);return r}}function Ci(e){return function(t){return t<=0?0:t>=1?1:e(t)}}function Si(e){return function(t){return 1-e(1-t)}}function Ti(e){return function(t){return.5*(t<.5?e(2*t):2-e(2-2*t))}}function Oi(e){return e*e}function Ai(e){return e*e*e}function Ni(e){if(e<=0)return 0;if(e>=1)return 1;var t=e*e,n=t*e;return 4*(e<.5?n:3*(e-t)+n-.75)}function Gi(e){return function(t){return Math.pow(t,e)}}function Li(e){return 1-Math.cos(e*Uo)}function Di(e){return Math.pow(2,10*(e-1))}function Ii(e){return 1-Math.sqrt(1-e*e)}function Pi(e,t){var n;return arguments.length<2&&(t=.45),arguments.length?n=t/$o*Math.asin(1/e):(e=1,n=t/4),function(i){return 1+e*Math.pow(2,-10*i)*Math.sin((i-n)*$o/t)}}function Ri(e){return e||(e=1.70158),function(t){return t*t*((e+1)*t-e)}}function Vi(e){return e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375}function Ei(e,t){e=fo.hcl(e),t=fo.hcl(t);var n=e.h,i=e.c,r=e.l,a=t.h-n,o=t.c-i,s=t.l-r;return isNaN(o)&&(o=0,i=isNaN(i)?t.c:i),isNaN(a)?(a=0,n=isNaN(n)?t.h:n):a>180?a-=360:a<-180&&(a+=360),function(e){return _e(n+a*e,i+o*e,r+s*e)+""}}function zi(e,t){e=fo.hsl(e),t=fo.hsl(t);var n=e.h,i=e.s,r=e.l,a=t.h-n,o=t.s-i,s=t.l-r;return isNaN(o)&&(o=0,i=isNaN(i)?t.s:i),isNaN(a)?(a=0,n=isNaN(n)?t.h:n):a>180?a-=360:a<-180&&(a+=360),function(e){return fe(n+a*e,i+o*e,r+s*e)+""}}function qi(e,t){e=fo.lab(e),t=fo.lab(t);var n=e.l,i=e.a,r=e.b,a=t.l-n,o=t.a-i,s=t.b-r;return function(e){return me(n+a*e,i+o*e,r+s*e)+""}}function Fi(e,t){return t-=e,function(n){return Math.round(e+t*n)}}function $i(e){var t=[e.a,e.b],n=[e.c,e.d],i=Ui(t),r=Hi(t,n),a=Ui(Ji(n,t,-r))||0;t[0]*n[1]<n[0]*t[1]&&(t[0]*=-1,t[1]*=-1,i*=-1,r*=-1),this.rotate=(i?Math.atan2(t[1],t[0]):Math.atan2(-n[0],n[1]))*Bo,this.translate=[e.e,e.f],this.scale=[i,a],this.skew=a?Math.atan2(r,a)*Bo:0}function Hi(e,t){return e[0]*t[0]+e[1]*t[1]}function Ui(e){var t=Math.sqrt(Hi(e,e));return t&&(e[0]/=t,e[1]/=t),t}function Ji(e,t,n){return e[0]+=n*t[0],e[1]+=n*t[1],e}function Bi(e){return e.length?e.pop()+",":""}function Wi(e,t,n,i){if(e[0]!==t[0]||e[1]!==t[1]){var r=n.push("translate(",null,",",null,")");i.push({i:r-4,x:xi(e[0],t[0])},{i:r-2,x:xi(e[1],t[1])})}else(t[0]||t[1])&&n.push("translate("+t+")")}function Yi(e,t,n,i){e!==t?(e-t>180?t+=360:t-e>180&&(e+=360),i.push({i:n.push(Bi(n)+"rotate(",null,")")-2,x:xi(e,t)})):t&&n.push(Bi(n)+"rotate("+t+")")}function Ki(e,t,n,i){e!==t?i.push({i:n.push(Bi(n)+"skewX(",null,")")-2,x:xi(e,t)}):t&&n.push(Bi(n)+"skewX("+t+")")}function Xi(e,t,n,i){if(e[0]!==t[0]||e[1]!==t[1]){var r=n.push(Bi(n)+"scale(",null,",",null,")");i.push({i:r-4,x:xi(e[0],t[0])},{i:r-2,x:xi(e[1],t[1])})}else 1===t[0]&&1===t[1]||n.push(Bi(n)+"scale("+t+")")}function Qi(e,t){var n=[],i=[];return e=fo.transform(e),t=fo.transform(t),Wi(e.translate,t.translate,n,i),Yi(e.rotate,t.rotate,n,i),Ki(e.skew,t.skew,n,i),Xi(e.scale,t.scale,n,i),e=t=null,function(e){for(var t,r=-1,a=i.length;++r<a;)n[(t=i[r]).i]=t.x(e);return n.join("")}}function Zi(e,t){return t=(t-=e=+e)||1/t,function(n){return(n-e)/t}}function er(e,t){return t=(t-=e=+e)||1/t,function(n){return Math.max(0,Math.min(1,(n-e)/t))}}function tr(e){for(var t=e.source,n=e.target,i=ir(t,n),r=[t];t!==i;)t=t.parent,r.push(t);for(var a=r.length;n!==i;)r.splice(a,0,n),n=n.parent;return r}function nr(e){for(var t=[],n=e.parent;null!=n;)t.push(e),e=n,n=n.parent;return t.push(e),t}function ir(e,t){if(e===t)return e;for(var n=nr(e),i=nr(t),r=n.pop(),a=i.pop(),o=null;r===a;)o=r,r=n.pop(),a=i.pop();return o}function rr(e){e.fixed|=2}function ar(e){e.fixed&=-7}function or(e){e.fixed|=4,e.px=e.x,e.py=e.y}function sr(e){e.fixed&=-5}function lr(e,t,n){var i=0,r=0;if(e.charge=0,!e.leaf)for(var a,o=e.nodes,s=o.length,l=-1;++l<s;)null!=(a=o[l])&&(lr(a,t,n),e.charge+=a.charge,i+=a.charge*a.cx,r+=a.charge*a.cy);if(e.point){e.leaf||(e.point.x+=Math.random()-.5,e.point.y+=Math.random()-.5);var c=t*n[e.point.index];e.charge+=e.pointCharge=c,i+=c*e.point.x,r+=c*e.point.y}e.cx=i/e.charge,e.cy=r/e.charge}function cr(e,t){return fo.rebind(e,t,"sort","children","value"),e.nodes=e,e.links=_r,e}function dr(e,t){for(var n=[e];null!=(e=n.pop());)if(t(e),(r=e.children)&&(i=r.length))for(var i,r;--i>=0;)n.push(r[i])}function ur(e,t){for(var n=[e],i=[];null!=(e=n.pop());)if(i.push(e),(a=e.children)&&(r=a.length))for(var r,a,o=-1;++o<r;)n.push(a[o]);for(;null!=(e=i.pop());)t(e)}function hr(e){return e.children}function fr(e){return e.value}function pr(e,t){return t.value-e.value}function _r(e){return fo.merge(e.map(function(e){return(e.children||[]).map(function(t){return{source:e,target:t}})}))}function gr(e){return e.x}function mr(e){return e.y}function vr(e,t,n){e.y0=t,e.y=n}function yr(e){return fo.range(e.length)}function br(e){for(var t=-1,n=e[0].length,i=[];++t<n;)i[t]=0;return i}function wr(e){for(var t,n=1,i=0,r=e[0][1],a=e.length;n<a;++n)(t=e[n][1])>r&&(i=n,r=t);return i}function xr(e){return e.reduce(kr,0)}function kr(e,t){return e+t[1]}function jr(e,t){return Mr(e,Math.ceil(Math.log(t.length)/Math.LN2+1))}function Mr(e,t){for(var n=-1,i=+e[0],r=(e[1]-i)/t,a=[];++n<=t;)a[n]=r*n+i;return a}function Cr(e){return[fo.min(e),fo.max(e)]}function Sr(e,t){return e.value-t.value}function Tr(e,t){var n=e._pack_next;e._pack_next=t,t._pack_prev=e,t._pack_next=n,n._pack_prev=t}function Or(e,t){e._pack_next=t,t._pack_prev=e}function Ar(e,t){var n=t.x-e.x,i=t.y-e.y,r=e.r+t.r;return.999*r*r>n*n+i*i}function Nr(e){function t(e){d=Math.min(e.x-e.r,d),u=Math.max(e.x+e.r,u),h=Math.min(e.y-e.r,h),f=Math.max(e.y+e.r,f)}if((n=e.children)&&(c=n.length)){var n,i,r,a,o,s,l,c,d=1/0,u=-1/0,h=1/0,f=-1/0;if(n.forEach(Gr),i=n[0],i.x=-i.r,i.y=0,t(i),c>1&&(r=n[1],r.x=r.r,r.y=0,t(r),c>2))for(a=n[2],Ir(i,r,a),t(a),Tr(i,a),i._pack_prev=a,Tr(a,r),r=i._pack_next,o=3;o<c;o++){Ir(i,r,a=n[o]);var p=0,_=1,g=1;for(s=r._pack_next;s!==r;s=s._pack_next,_++)if(Ar(s,a)){p=1;break}if(1==p)for(l=i._pack_prev;l!==s._pack_prev&&!Ar(l,a);l=l._pack_prev,g++);p?(_<g||_==g&&r.r<i.r?Or(i,r=s):Or(i=l,r),o--):(Tr(i,a),r=a,t(a))}var m=(d+u)/2,v=(h+f)/2,y=0;for(o=0;o<c;o++)a=n[o],a.x-=m,a.y-=v,y=Math.max(y,a.r+Math.sqrt(a.x*a.x+a.y*a.y));e.r=y,n.forEach(Lr)}}function Gr(e){e._pack_next=e._pack_prev=e}function Lr(e){delete e._pack_next,delete e._pack_prev}function Dr(e,t,n,i){var r=e.children;if(e.x=t+=i*e.x,e.y=n+=i*e.y,e.r*=i,r)for(var a=-1,o=r.length;++a<o;)Dr(r[a],t,n,i)}function Ir(e,t,n){var i=e.r+n.r,r=t.x-e.x,a=t.y-e.y;if(i&&(r||a)){var o=t.r+n.r,s=r*r+a*a;o*=o,i*=i;var l=.5+(i-o)/(2*s),c=Math.sqrt(Math.max(0,2*o*(i+s)-(i-=s)*i-o*o))/(2*s);n.x=e.x+l*r+c*a,n.y=e.y+l*a-c*r}else n.x=e.x+i,n.y=e.y}function Pr(e,t){return e.parent==t.parent?1:2}function Rr(e){var t=e.children;return t.length?t[0]:e.t}function Vr(e){var t,n=e.children;return(t=n.length)?n[t-1]:e.t}function Er(e,t,n){var i=n/(t.i-e.i);t.c-=i,t.s+=n,e.c+=i,t.z+=n,t.m+=n}function zr(e){for(var t,n=0,i=0,r=e.children,a=r.length;--a>=0;)t=r[a],t.z+=n,t.m+=n,n+=t.s+(i+=t.c)}function qr(e,t,n){return e.a.parent===t.parent?e.a:n}function Fr(e){return 1+fo.max(e,function(e){return e.y})}function $r(e){return e.reduce(function(e,t){return e+t.x},0)/e.length}function Hr(e){var t=e.children;return t&&t.length?Hr(t[0]):e}function Ur(e){var t,n=e.children;return n&&(t=n.length)?Ur(n[t-1]):e}function Jr(e){return{x:e.x,y:e.y,dx:e.dx,dy:e.dy}}function Br(e,t){var n=e.x+t[3],i=e.y+t[0],r=e.dx-t[1]-t[3],a=e.dy-t[0]-t[2];return r<0&&(n+=r/2,r=0),a<0&&(i+=a/2,a=0),{x:n,y:i,dx:r,dy:a}}function Wr(e){var t=e[0],n=e[e.length-1];return t<n?[t,n]:[n,t]}function Yr(e){return e.rangeExtent?e.rangeExtent():Wr(e.range())}function Kr(e,t,n,i){var r=n(e[0],e[1]),a=i(t[0],t[1]);return function(e){return a(r(e))}}function Xr(e,t){var n,i=0,r=e.length-1,a=e[i],o=e[r];return o<a&&(n=i,i=r,r=n,n=a,a=o,o=n),e[i]=t.floor(a),e[r]=t.ceil(o),e}function Qr(e){return e?{floor:function(t){return Math.floor(t/e)*e},ceil:function(t){return Math.ceil(t/e)*e}}:Ml}function Zr(e,t,n,i){var r=[],a=[],o=0,s=Math.min(e.length,t.length)-1;for(e[s]<e[0]&&(e=e.slice().reverse(),t=t.slice().reverse());++o<=s;)r.push(n(e[o-1],e[o])),a.push(i(t[o-1],t[o]));return function(t){var n=fo.bisect(e,t,1,s)-1;return a[n](r[n](t))}}function ea(e,t,n,i){function r(){var r=Math.min(e.length,t.length)>2?Zr:Kr,l=i?er:Zi;return o=r(e,t,l,n),s=r(t,e,l,ji),a}function a(e){return o(e)}var o,s;return a.invert=function(e){return s(e)},a.domain=function(t){return arguments.length?(e=t.map(Number),r()):e},a.range=function(e){return arguments.length?(t=e,r()):t},a.rangeRound=function(e){return a.range(e).interpolate(Fi)},a.clamp=function(e){return arguments.length?(i=e,r()):i},a.interpolate=function(e){return arguments.length?(n=e,r()):n},a.ticks=function(t){return ra(e,t)},a.tickFormat=function(t,n){return aa(e,t,n)},a.nice=function(t){return na(e,t),r()},a.copy=function(){return ea(e,t,n,i)},r()}function ta(e,t){return fo.rebind(e,t,"range","rangeRound","interpolate","clamp")}function na(e,t){return Xr(e,Qr(ia(e,t)[2])),Xr(e,Qr(ia(e,t)[2])),e}function ia(e,t){null==t&&(t=10);var n=Wr(e),i=n[1]-n[0],r=Math.pow(10,Math.floor(Math.log(i/t)/Math.LN10)),a=t/i*r;return a<=.15?r*=10:a<=.35?r*=5:a<=.75&&(r*=2),n[0]=Math.ceil(n[0]/r)*r,n[1]=Math.floor(n[1]/r)*r+.5*r,n[2]=r,n}function ra(e,t){return fo.range.apply(fo,ia(e,t))}function aa(e,t,n){var i=ia(e,t);if(n){var r=fs.exec(n);if(r.shift(),"s"===r[8]){var a=fo.formatPrefix(Math.max(ko(i[0]),ko(i[1])));return r[7]||(r[7]="."+oa(a.scale(i[2]))),r[8]="f",n=fo.format(r.join("")),function(e){return n(a.scale(e))+a.symbol}}r[7]||(r[7]="."+sa(r[8],i)),n=r.join("")}else n=",."+oa(i[2])+"f";return fo.format(n)}function oa(e){return-Math.floor(Math.log(e)/Math.LN10+.01)}function sa(e,t){var n=oa(t[2]);return e in Cl?Math.abs(n-oa(Math.max(ko(t[0]),ko(t[1]))))+ +("e"!==e):n-2*("%"===e)}function la(e,t,n,i){function r(e){return(n?Math.log(e<0?0:e):-Math.log(e>0?0:-e))/Math.log(t)}function a(e){return n?Math.pow(t,e):-Math.pow(t,-e)}function o(t){return e(r(t))}return o.invert=function(t){return a(e.invert(t))},o.domain=function(t){return arguments.length?(n=t[0]>=0,e.domain((i=t.map(Number)).map(r)),o):i},o.base=function(n){return arguments.length?(t=+n,e.domain(i.map(r)),o):t},o.nice=function(){var t=Xr(i.map(r),n?Math:Tl);return e.domain(t),i=t.map(a),o},o.ticks=function(){var e=Wr(i),o=[],s=e[0],l=e[1],c=Math.floor(r(s)),d=Math.ceil(r(l)),u=t%1?2:t;if(isFinite(d-c)){if(n){for(;c<d;c++)for(var h=1;h<u;h++)o.push(a(c)*h);o.push(a(c))}else for(o.push(a(c));c++<d;)for(var h=u-1;h>0;h--)o.push(a(c)*h);for(c=0;o[c]<s;c++);for(d=o.length;o[d-1]>l;d--);o=o.slice(c,d)}return o},o.tickFormat=function(e,n){if(!arguments.length)return Sl;arguments.length<2?n=Sl:"function"!=typeof n&&(n=fo.format(n));var i=Math.max(1,t*e/o.ticks().length);return function(e){var o=e/a(Math.round(r(e)));return o*t<t-.5&&(o*=t),o<=i?n(e):""}},o.copy=function(){return la(e.copy(),t,n,i)},ta(o,e)}function ca(e,t,n){function i(t){return e(r(t))}var r=da(t),a=da(1/t);return i.invert=function(t){return a(e.invert(t))},i.domain=function(t){return arguments.length?(e.domain((n=t.map(Number)).map(r)),i):n},i.ticks=function(e){return ra(n,e)},i.tickFormat=function(e,t){return aa(n,e,t)},i.nice=function(e){return i.domain(na(n,e))},i.exponent=function(o){return arguments.length?(r=da(t=o),a=da(1/t),e.domain(n.map(r)),i):t},i.copy=function(){return ca(e.copy(),t,n)},ta(i,e)}function da(e){return function(t){return t<0?-Math.pow(-t,e):Math.pow(t,e)}}function ua(e,t){function n(n){return a[((r.get(n)||("range"===t.t?r.set(n,e.push(n)):NaN))-1)%a.length]}function i(t,n){return fo.range(e.length).map(function(e){return t+n*e})}var r,a,o;return n.domain=function(i){if(!arguments.length)return e;e=[],r=new p;for(var a,o=-1,s=i.length;++o<s;)r.has(a=i[o])||r.set(a,e.push(a));return n[t.t].apply(n,t.a)},n.range=function(e){return arguments.length?(a=e,o=0,t={t:"range",a:arguments},n):a},n.rangePoints=function(r,s){arguments.length<2&&(s=0);var l=r[0],c=r[1],d=e.length<2?(l=(l+c)/2,0):(c-l)/(e.length-1+s);return a=i(l+d*s/2,d),o=0,t={t:"rangePoints",a:arguments},n},n.rangeRoundPoints=function(r,s){arguments.length<2&&(s=0);var l=r[0],c=r[1],d=e.length<2?(l=c=Math.round((l+c)/2),0):(c-l)/(e.length-1+s)|0;return a=i(l+Math.round(d*s/2+(c-l-(e.length-1+s)*d)/2),d),o=0,t={t:"rangeRoundPoints",a:arguments},n},n.rangeBands=function(r,s,l){arguments.length<2&&(s=0),arguments.length<3&&(l=s);var c=r[1]<r[0],d=r[c-0],u=r[1-c],h=(u-d)/(e.length-s+2*l);return a=i(d+h*l,h),c&&a.reverse(),o=h*(1-s),t={t:"rangeBands",a:arguments},n},n.rangeRoundBands=function(r,s,l){arguments.length<2&&(s=0),arguments.length<3&&(l=s);var c=r[1]<r[0],d=r[c-0],u=r[1-c],h=Math.floor((u-d)/(e.length-s+2*l));return a=i(d+Math.round((u-d-(e.length-s)*h)/2),h),c&&a.reverse(),o=Math.round(h*(1-s)),t={t:"rangeRoundBands",a:arguments},n},n.rangeBand=function(){return o},n.rangeExtent=function(){return Wr(t.a[0])},n.copy=function(){return ua(e,t)},n.domain(e)}function ha(e,t){function n(){var n=0,a=t.length;for(r=[];++n<a;)r[n-1]=fo.quantile(e,n/a);return i}function i(e){if(!isNaN(e=+e))return t[fo.bisect(r,e)]}var r;return i.domain=function(t){return arguments.length?(e=t.map(l).filter(c).sort(s),n()):e},i.range=function(e){return arguments.length?(t=e,n()):t},i.quantiles=function(){return r},i.invertExtent=function(n){return n=t.indexOf(n),n<0?[NaN,NaN]:[n>0?r[n-1]:e[0],n<r.length?r[n]:e[e.length-1]]},i.copy=function(){return ha(e,t)},n()}function fa(e,t,n){function i(t){return n[Math.max(0,Math.min(o,Math.floor(a*(t-e))))]}function r(){return a=n.length/(t-e),o=n.length-1,i}var a,o;return i.domain=function(n){return arguments.length?(e=+n[0],t=+n[n.length-1],r()):[e,t]},i.range=function(e){return arguments.length?(n=e,r()):n},i.invertExtent=function(t){return t=n.indexOf(t),t=t<0?NaN:t/a+e,[t,t+1/a]},i.copy=function(){return fa(e,t,n)},r()}function pa(e,t){function n(n){if(n<=n)return t[fo.bisect(e,n)]}return n.domain=function(t){return arguments.length?(e=t,n):e},n.range=function(e){return arguments.length?(t=e,n):t},n.invertExtent=function(n){return n=t.indexOf(n),[e[n-1],e[n]]},n.copy=function(){return pa(e,t)},n}function _a(e){function t(e){return+e}return t.invert=t,t.domain=t.range=function(n){return arguments.length?(e=n.map(t),t):e},t.ticks=function(t){return ra(e,t)},t.tickFormat=function(t,n){return aa(e,t,n)},t.copy=function(){return _a(e)},t}function ga(){return 0}function ma(e){return e.innerRadius}function va(e){return e.outerRadius}function ya(e){return e.startAngle}function ba(e){return e.endAngle}function wa(e){return e&&e.padAngle}function xa(e,t,n,i){return(e-n)*t-(t-i)*e>0?0:1}function ka(e,t,n,i,r){var a=e[0]-t[0],o=e[1]-t[1],s=(r?i:-i)/Math.sqrt(a*a+o*o),l=s*o,c=-s*a,d=e[0]+l,u=e[1]+c,h=t[0]+l,f=t[1]+c,p=(d+h)/2,_=(u+f)/2,g=h-d,m=f-u,v=g*g+m*m,y=n-i,b=d*f-h*u,w=(m<0?-1:1)*Math.sqrt(Math.max(0,y*y*v-b*b)),x=(b*m-g*w)/v,k=(-b*g-m*w)/v,j=(b*m+g*w)/v,M=(-b*g+m*w)/v,C=x-p,S=k-_,T=j-p,O=M-_;return C*C+S*S>T*T+O*O&&(x=j,k=M),[[x-l,k-c],[x*n/y,k*n/y]]}function ja(e){function t(t){function o(){c.push("M",a(e(d),s))}for(var l,c=[],d=[],u=-1,h=t.length,f=Ne(n),p=Ne(i);++u<h;)r.call(this,l=t[u],u)?d.push([+f.call(this,l,u),+p.call(this,l,u)]):d.length&&(o(),d=[]);return d.length&&o(),c.length?c.join(""):null}var n=Dn,i=In,r=Dt,a=Ma,o=a.key,s=.7;return t.x=function(e){return arguments.length?(n=e,t):n},t.y=function(e){return arguments.length?(i=e,t):i},t.defined=function(e){return arguments.length?(r=e,t):r},t.interpolate=function(e){return arguments.length?(o="function"==typeof e?a=e:(a=Dl.get(e)||Ma).key,t):o},t.tension=function(e){return arguments.length?(s=e,t):s},t}function Ma(e){return e.length>1?e.join("L"):e+"Z"}function Ca(e){return e.join("L")+"Z"}function Sa(e){for(var t=0,n=e.length,i=e[0],r=[i[0],",",i[1]];++t<n;)r.push("H",(i[0]+(i=e[t])[0])/2,"V",i[1]);return n>1&&r.push("H",i[0]),r.join("")}function Ta(e){for(var t=0,n=e.length,i=e[0],r=[i[0],",",i[1]];++t<n;)r.push("V",(i=e[t])[1],"H",i[0]);return r.join("")}function Oa(e){for(var t=0,n=e.length,i=e[0],r=[i[0],",",i[1]];++t<n;)r.push("H",(i=e[t])[0],"V",i[1]);return r.join("")}function Aa(e,t){return e.length<4?Ma(e):e[1]+La(e.slice(1,-1),Da(e,t))}function Na(e,t){return e.length<3?Ca(e):e[0]+La((e.push(e[0]),e),Da([e[e.length-2]].concat(e,[e[1]]),t))}function Ga(e,t){return e.length<3?Ma(e):e[0]+La(e,Da(e,t))}function La(e,t){if(t.length<1||e.length!=t.length&&e.length!=t.length+2)return Ma(e);var n=e.length!=t.length,i="",r=e[0],a=e[1],o=t[0],s=o,l=1;if(n&&(i+="Q"+(a[0]-2*o[0]/3)+","+(a[1]-2*o[1]/3)+","+a[0]+","+a[1],r=e[1],l=2),t.length>1){s=t[1],a=e[l],l++,i+="C"+(r[0]+o[0])+","+(r[1]+o[1])+","+(a[0]-s[0])+","+(a[1]-s[1])+","+a[0]+","+a[1];for(var c=2;c<t.length;c++,l++)a=e[l],s=t[c],i+="S"+(a[0]-s[0])+","+(a[1]-s[1])+","+a[0]+","+a[1]}if(n){var d=e[l];i+="Q"+(a[0]+2*s[0]/3)+","+(a[1]+2*s[1]/3)+","+d[0]+","+d[1]}return i}function Da(e,t){for(var n,i=[],r=(1-t)/2,a=e[0],o=e[1],s=1,l=e.length;++s<l;)n=a,a=o,o=e[s],i.push([r*(o[0]-n[0]),r*(o[1]-n[1])]);return i}function Ia(e){if(e.length<3)return Ma(e);var t=1,n=e.length,i=e[0],r=i[0],a=i[1],o=[r,r,r,(i=e[1])[0]],s=[a,a,a,i[1]],l=[r,",",a,"L",Ea(Rl,o),",",Ea(Rl,s)];for(e.push(e[n-1]);++t<=n;)i=e[t],o.shift(),o.push(i[0]),s.shift(),s.push(i[1]),za(l,o,s);return e.pop(),l.push("L",i),l.join("")}function Pa(e){if(e.length<4)return Ma(e);for(var t,n=[],i=-1,r=e.length,a=[0],o=[0];++i<3;)t=e[i],a.push(t[0]),o.push(t[1]);for(n.push(Ea(Rl,a)+","+Ea(Rl,o)),--i;++i<r;)t=e[i],a.shift(),a.push(t[0]),o.shift(),o.push(t[1]),za(n,a,o);return n.join("")}function Ra(e){for(var t,n,i=-1,r=e.length,a=r+4,o=[],s=[];++i<4;)n=e[i%r],o.push(n[0]),s.push(n[1]);for(t=[Ea(Rl,o),",",Ea(Rl,s)],--i;++i<a;)n=e[i%r],o.shift(),o.push(n[0]),s.shift(),s.push(n[1]),za(t,o,s);return t.join("")}function Va(e,t){var n=e.length-1;if(n)for(var i,r,a=e[0][0],o=e[0][1],s=e[n][0]-a,l=e[n][1]-o,c=-1;++c<=n;)i=e[c],r=c/n,i[0]=t*i[0]+(1-t)*(a+r*s),i[1]=t*i[1]+(1-t)*(o+r*l);return Ia(e)}function Ea(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]}function za(e,t,n){e.push("C",Ea(Il,t),",",Ea(Il,n),",",Ea(Pl,t),",",Ea(Pl,n),",",Ea(Rl,t),",",Ea(Rl,n))}function qa(e,t){return(t[1]-e[1])/(t[0]-e[0])}function Fa(e){for(var t=0,n=e.length-1,i=[],r=e[0],a=e[1],o=i[0]=qa(r,a);++t<n;)i[t]=(o+(o=qa(r=a,a=e[t+1])))/2;return i[t]=o,i}function $a(e){for(var t,n,i,r,a=[],o=Fa(e),s=-1,l=e.length-1;++s<l;)t=qa(e[s],e[s+1]),ko(t)<zo?o[s]=o[s+1]=0:(n=o[s]/t,i=o[s+1]/t,(r=n*n+i*i)>9&&(r=3*t/Math.sqrt(r),o[s]=r*n,o[s+1]=r*i));for(s=-1;++s<=l;)r=(e[Math.min(l,s+1)][0]-e[Math.max(0,s-1)][0])/(6*(1+o[s]*o[s])),a.push([r||0,o[s]*r||0]);return a}function Ha(e){return e.length<3?Ma(e):e[0]+La(e,$a(e))}function Ua(e){for(var t,n,i,r=-1,a=e.length;++r<a;)t=e[r],n=t[0],i=t[1]-Uo,t[0]=n*Math.cos(i),t[1]=n*Math.sin(i);return e}function Ja(e){function t(t){function l(){_.push("M",s(e(m),u),d,c(e(g.reverse()),u),"Z")}for(var h,f,p,_=[],g=[],m=[],v=-1,y=t.length,b=Ne(n),w=Ne(r),x=n===i?function(){return f}:Ne(i),k=r===a?function(){return p}:Ne(a);++v<y;)o.call(this,h=t[v],v)?(g.push([f=+b.call(this,h,v),p=+w.call(this,h,v)]),m.push([+x.call(this,h,v),+k.call(this,h,v)])):g.length&&(l(),g=[],m=[]);return g.length&&l(),_.length?_.join(""):null}var n=Dn,i=Dn,r=0,a=In,o=Dt,s=Ma,l=s.key,c=s,d="L",u=.7;return t.x=function(e){return arguments.length?(n=i=e,t):i},t.x0=function(e){return arguments.length?(n=e,t):n},t.x1=function(e){return arguments.length?(i=e,t):i},t.y=function(e){return arguments.length?(r=a=e,t):a},t.y0=function(e){return arguments.length?(r=e,t):r},t.y1=function(e){return arguments.length?(a=e,t):a},t.defined=function(e){return arguments.length?(o=e,t):o},t.interpolate=function(e){return arguments.length?(l="function"==typeof e?s=e:(s=Dl.get(e)||Ma).key,c=s.reverse||s,d=s.closed?"M":"L",t):l},t.tension=function(e){return arguments.length?(u=e,t):u},t}function Ba(e){return e.radius}function Wa(e){return[e.x,e.y]}function Ya(e){return function(){var t=e.apply(this,arguments),n=t[0],i=t[1]-Uo;return[n*Math.cos(i),n*Math.sin(i)]}}function Ka(){return 64}function Xa(){return"circle"}function Qa(e){var t=Math.sqrt(e/Fo);return"M0,"+t+"A"+t+","+t+" 0 1,1 0,"+-t+"A"+t+","+t+" 0 1,1 0,"+t+"Z"}function Za(e){return function(){var t,n,i;(t=this[e])&&(i=t[n=t.active])&&(i.timer.c=null,i.timer.t=NaN,--t.count?delete t[n]:delete this[e],t.active+=.5,i.event&&i.event.interrupt.call(this,this.__data__,i.index))}}function eo(e,t,n){return To(e,Hl),e.namespace=t,e.id=n,e}function to(e,t,n,i){var r=e.id,a=e.namespace;return W(e,"function"==typeof n?function(e,o,s){e[a][r].tween.set(t,i(n.call(e,e.__data__,o,s)))}:(n=i(n),function(e){e[a][r].tween.set(t,n)}))}function no(e){return null==e&&(e=""),function(){this.textContent=e}}function io(e){return null==e?"__transition__":"__transition_"+e+"__"}function ro(e,t,n,i,r){function a(e){var t=_.delay;if(c.t=t+l,t<=e)return o(e-t);c.c=o}function o(n){var r=f.active,a=f[r];a&&(a.timer.c=null,a.timer.t=NaN,--f.count,delete f[r],a.event&&a.event.interrupt.call(e,e.__data__,a.index));for(var o in f)if(+o<i){var p=f[o];p.timer.c=null,p.timer.t=NaN,--f.count,delete f[o]}c.c=s,Pe(function(){return c.c&&s(n||1)&&(c.c=null,c.t=NaN),1},0,l),f.active=i,_.event&&_.event.start.call(e,e.__data__,t),h=[],_.tween.forEach(function(n,i){(i=i.call(e,e.__data__,t))&&h.push(i)}),u=_.ease,d=_.duration}function s(r){for(var a=r/d,o=u(a),s=h.length;s>0;)h[--s].call(e,o);if(a>=1)return _.event&&_.event.end.call(e,e.__data__,t),--f.count?delete f[i]:delete e[n],1}var l,c,d,u,h,f=e[n]||(e[n]={active:0,count:0}),_=f[i];_||(l=r.time,c=Pe(a,0,l),_=f[i]={tween:new p,time:l,timer:c,delay:r.delay,duration:r.duration,ease:r.ease,index:t},r=null,++f.count)}function ao(e,t,n){e.attr("transform",function(e){var i=t(e);return"translate("+(isFinite(i)?i:n(e))+",0)"})}function oo(e,t,n){e.attr("transform",function(e){var i=t(e);return"translate(0,"+(isFinite(i)?i:n(e))+")"})}function so(e){return e.toISOString()}function lo(e,t,n){function i(t){return e(t)}function r(e,n){var i=e[1]-e[0],r=i/n,a=fo.bisect(Zl,r);return a==Zl.length?[t.year,ia(e.map(function(e){return e/31536e6}),n)[2]]:a?t[r/Zl[a-1]<Zl[a]/r?a-1:a]:[nc,ia(e,n)[2]]}return i.invert=function(t){return co(e.invert(t))},i.domain=function(t){return arguments.length?(e.domain(t),i):e.domain().map(co)},i.nice=function(e,t){function n(n){return!isNaN(n)&&!e.range(n,co(+n+1),t).length}var a=i.domain(),o=Wr(a),s=null==e?r(o,10):"number"==typeof e&&r(o,e);return s&&(e=s[0],t=s[1]),i.domain(Xr(a,t>1?{floor:function(t){for(;n(t=e.floor(t));)t=co(t-1);return t},ceil:function(t){for(;n(t=e.ceil(t));)t=co(+t+1);return t}}:e))},i.ticks=function(e,t){var n=Wr(i.domain()),a=null==e?r(n,10):"number"==typeof e?r(n,e):!e.range&&[{range:e},t];return a&&(e=a[0],t=a[1]),e.range(n[0],co(+n[1]+1),t<1?1:t)},i.tickFormat=function(){return n},i.copy=function(){return lo(e.copy(),t,n)},ta(i,e)}function co(e){return new Date(e)}function uo(e){return JSON.parse(e.responseText)}function ho(e){var t=go.createRange();return t.selectNode(go.body),t.createContextualFragment(e.responseText)}var fo={version:"3.5.17"},po=[].slice,_o=function(e){return po.call(e)},go=this.document;if(go)try{_o(go.documentElement.childNodes)[0].nodeType}catch(e){_o=function(e){for(var t=e.length,n=new Array(t);t--;)n[t]=e[t];return n}}if(Date.now||(Date.now=function(){return+new Date}),go)try{go.createElement("DIV").style.setProperty("opacity",0,"")}catch(e){var mo=this.Element.prototype,vo=mo.setAttribute,yo=mo.setAttributeNS,bo=this.CSSStyleDeclaration.prototype,wo=bo.setProperty;mo.setAttribute=function(e,t){vo.call(this,e,t+"")},mo.setAttributeNS=function(e,t,n){yo.call(this,e,t,n+"")},bo.setProperty=function(e,t,n){wo.call(this,e,t+"",n)}}fo.ascending=s,fo.descending=function(e,t){return t<e?-1:t>e?1:t>=e?0:NaN},fo.min=function(e,t){var n,i,r=-1,a=e.length;if(1===arguments.length){for(;++r<a;)if(null!=(i=e[r])&&i>=i){n=i;break}for(;++r<a;)null!=(i=e[r])&&n>i&&(n=i)}else{for(;++r<a;)if(null!=(i=t.call(e,e[r],r))&&i>=i){n=i;break}for(;++r<a;)null!=(i=t.call(e,e[r],r))&&n>i&&(n=i)}return n},fo.max=function(e,t){var n,i,r=-1,a=e.length;if(1===arguments.length){for(;++r<a;)if(null!=(i=e[r])&&i>=i){n=i;break}for(;++r<a;)null!=(i=e[r])&&i>n&&(n=i)}else{for(;++r<a;)if(null!=(i=t.call(e,e[r],r))&&i>=i){n=i;break}for(;++r<a;)null!=(i=t.call(e,e[r],r))&&i>n&&(n=i)}return n},fo.extent=function(e,t){var n,i,r,a=-1,o=e.length;if(1===arguments.length){for(;++a<o;)if(null!=(i=e[a])&&i>=i){n=r=i;break}for(;++a<o;)null!=(i=e[a])&&(n>i&&(n=i),r<i&&(r=i))}else{for(;++a<o;)if(null!=(i=t.call(e,e[a],a))&&i>=i){n=r=i;break}for(;++a<o;)null!=(i=t.call(e,e[a],a))&&(n>i&&(n=i),r<i&&(r=i))}return[n,r]},fo.sum=function(e,t){var n,i=0,r=e.length,a=-1;if(1===arguments.length)for(;++a<r;)c(n=+e[a])&&(i+=n);else for(;++a<r;)c(n=+t.call(e,e[a],a))&&(i+=n);return i},fo.mean=function(e,t){var n,i=0,r=e.length,a=-1,o=r;if(1===arguments.length)for(;++a<r;)c(n=l(e[a]))?i+=n:--o;else for(;++a<r;)c(n=l(t.call(e,e[a],a)))?i+=n:--o;if(o)return i/o},fo.quantile=function(e,t){var n=(e.length-1)*t+1,i=Math.floor(n),r=+e[i-1],a=n-i;return a?r+a*(e[i]-r):r},fo.median=function(e,t){var n,i=[],r=e.length,a=-1;if(1===arguments.length)for(;++a<r;)c(n=l(e[a]))&&i.push(n);else for(;++a<r;)c(n=l(t.call(e,e[a],a)))&&i.push(n);if(i.length)return fo.quantile(i.sort(s),.5)},fo.variance=function(e,t){var n,i,r=e.length,a=0,o=0,s=-1,d=0;if(1===arguments.length)for(;++s<r;)c(n=l(e[s]))&&(i=n-a,a+=i/++d,o+=i*(n-a));else for(;++s<r;)c(n=l(t.call(e,e[s],s)))&&(i=n-a,a+=i/++d,o+=i*(n-a));if(d>1)return o/(d-1)},fo.deviation=function(){var e=fo.variance.apply(this,arguments);return e?Math.sqrt(e):e};var xo=d(s);fo.bisectLeft=xo.left,fo.bisect=fo.bisectRight=xo.right,fo.bisector=function(e){return d(1===e.length?function(t,n){return s(e(t),n)}:e)},fo.shuffle=function(e,t,n){(a=arguments.length)<3&&(n=e.length,a<2&&(t=0));for(var i,r,a=n-t;a;)r=Math.random()*a--|0,i=e[a+t],e[a+t]=e[r+t],e[r+t]=i;return e},fo.permute=function(e,t){for(var n=t.length,i=new Array(n);n--;)i[n]=e[t[n]];return i},fo.pairs=function(e){for(var t=0,n=e.length-1,i=e[0],r=new Array(n<0?0:n);t<n;)r[t]=[i,i=e[++t]];return r},fo.transpose=function(e){if(!(r=e.length))return[];for(var t=-1,n=fo.min(e,u),i=new Array(n);++t<n;)for(var r,a=-1,o=i[t]=new Array(r);++a<r;)o[a]=e[a][t];return i},fo.zip=function(){return fo.transpose(arguments)},fo.keys=function(e){var t=[];for(var n in e)t.push(n);return t},fo.values=function(e){var t=[];for(var n in e)t.push(e[n]);return t},fo.entries=function(e){var t=[];for(var n in e)t.push({key:n,value:e[n]});return t},fo.merge=function(e){for(var t,n,i,r=e.length,a=-1,o=0;++a<r;)o+=e[a].length;for(n=new Array(o);--r>=0;)for(i=e[r],t=i.length;--t>=0;)n[--o]=i[t];return n};var ko=Math.abs;fo.range=function(e,t,n){if(arguments.length<3&&(n=1,arguments.length<2&&(t=e,e=0)),(t-e)/n==1/0)throw new Error("infinite range");var i,r=[],a=h(ko(n)),o=-1;if(e*=a,t*=a,n*=a,n<0)for(;(i=e+n*++o)>t;)r.push(i/a);else for(;(i=e+n*++o)<t;)r.push(i/a);return r},fo.map=function(e,t){var n=new p;if(e instanceof p)e.forEach(function(e,t){n.set(e,t)});else if(Array.isArray(e)){var i,r=-1,a=e.length;if(1===arguments.length)for(;++r<a;)n.set(r,e[r]);else for(;++r<a;)n.set(t.call(e,i=e[r],r),i)}else for(var o in e)n.set(o,e[o]);return n};var jo="__proto__",Mo="\0";f(p,{has:m,get:function(e){return this._[_(e)]},set:function(e,t){return this._[_(e)]=t},remove:v,keys:y,values:function(){var e=[];for(var t in this._)e.push(this._[t]);return e},entries:function(){var e=[];for(var t in this._)e.push({key:g(t),value:this._[t]});return e},size:b,empty:w,forEach:function(e){for(var t in this._)e.call(this,g(t),this._[t])}}),fo.nest=function(){function e(t,o,s){if(s>=a.length)return i?i.call(r,o):n?o.sort(n):o;for(var l,c,d,u,h=-1,f=o.length,_=a[s++],g=new p;++h<f;)(u=g.get(l=_(c=o[h])))?u.push(c):g.set(l,[c]);return t?(c=t(),d=function(n,i){c.set(n,e(t,i,s))}):(c={},d=function(n,i){c[n]=e(t,i,s)}),g.forEach(d),c}function t(e,n){if(n>=a.length)return e;var i=[],r=o[n++];return e.forEach(function(e,r){i.push({key:e,values:t(r,n)})}),r?i.sort(function(e,t){return r(e.key,t.key)}):i}var n,i,r={},a=[],o=[];return r.map=function(t,n){return e(n,t,0)},r.entries=function(n){return t(e(fo.map,n,0),0)},r.key=function(e){return a.push(e),r},r.sortKeys=function(e){return o[a.length-1]=e,r},r.sortValues=function(e){return n=e,r},r.rollup=function(e){return i=e,r},r},fo.set=function(e){var t=new x;if(e)for(var n=0,i=e.length;n<i;++n)t.add(e[n]);return t},f(x,{has:m,add:function(e){return this._[_(e+="")]=!0,e},remove:v,values:y,size:b,empty:w,forEach:function(e){for(var t in this._)e.call(this,g(t))}}),fo.behavior={},fo.rebind=function(e,t){for(var n,i=1,r=arguments.length;++i<r;)e[n=arguments[i]]=j(e,t,t[n]);return e};var Co=["webkit","ms","moz","Moz","o","O"];fo.dispatch=function(){for(var e=new S,t=-1,n=arguments.length;++t<n;)e[arguments[t]]=T(e);return e},S.prototype.on=function(e,t){var n=e.indexOf("."),i="";if(n>=0&&(i=e.slice(n+1),e=e.slice(0,n)),e)return arguments.length<2?this[e].on(i):this[e].on(i,t);if(2===arguments.length){if(null==t)for(e in this)this.hasOwnProperty(e)&&this[e].on(i,null);return this}},fo.event=null,fo.requote=function(e){return e.replace(So,"\\$&")};var So=/[\\\^\$\*\+\?\|\[\]\(\)\.\{\}]/g,To={}.__proto__?function(e,t){e.__proto__=t}:function(e,t){for(var n in t)e[n]=t[n]},Oo=function(e,t){return t.querySelector(e)},Ao=function(e,t){return t.querySelectorAll(e)},No=function(e,t){var n=e.matches||e[M(e,"matchesSelector")];return(No=function(e,t){return n.call(e,t)})(e,t)};"function"==typeof Sizzle&&(Oo=function(e,t){return Sizzle(e,t)[0]||null},Ao=Sizzle,No=Sizzle.matchesSelector),fo.selection=function(){return fo.select(go.documentElement)};var Go=fo.selection.prototype=[];Go.select=function(e){var t,n,i,r,a=[];e=L(e);for(var o=-1,s=this.length;++o<s;){a.push(t=[]),t.parentNode=(i=this[o]).parentNode;for(var l=-1,c=i.length;++l<c;)(r=i[l])?(t.push(n=e.call(r,r.__data__,l,o)),n&&"__data__"in r&&(n.__data__=r.__data__)):t.push(null)}return G(a)},Go.selectAll=function(e){var t,n,i=[];e=D(e);for(var r=-1,a=this.length;++r<a;)for(var o=this[r],s=-1,l=o.length;++s<l;)(n=o[s])&&(i.push(t=_o(e.call(n,n.__data__,s,r))),t.parentNode=n);return G(i)};var Lo="http://www.w3.org/1999/xhtml",Do={svg:"http://www.w3.org/2000/svg",xhtml:Lo,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};fo.ns={prefix:Do,qualify:function(e){var t=e.indexOf(":"),n=e;return t>=0&&"xmlns"!==(n=e.slice(0,t))&&(e=e.slice(t+1)),Do.hasOwnProperty(n)?{space:Do[n],local:e}:e}},Go.attr=function(e,t){if(arguments.length<2){if("string"==typeof e){var n=this.node();return e=fo.ns.qualify(e),e.local?n.getAttributeNS(e.space,e.local):n.getAttribute(e)}for(t in e)this.each(I(t,e[t]));return this}return this.each(I(e,t))},Go.classed=function(e,t){if(arguments.length<2){if("string"==typeof e){var n=this.node(),i=(e=V(e)).length,r=-1;if(t=n.classList){for(;++r<i;)if(!t.contains(e[r]))return!1}else for(t=n.getAttribute("class");++r<i;)if(!R(e[r]).test(t))return!1;return!0}for(t in e)this.each(E(t,e[t]));return this}return this.each(E(e,t))},Go.style=function(e,t,n){var i=arguments.length;if(i<3){if("string"!=typeof e){i<2&&(t="");for(n in e)this.each(q(n,e[n],t));return this}if(i<2){var r=this.node();return o(r).getComputedStyle(r,null).getPropertyValue(e)}n=""}return this.each(q(e,t,n))},Go.property=function(e,t){if(arguments.length<2){if("string"==typeof e)return this.node()[e];for(t in e)this.each(F(t,e[t]));return this}return this.each(F(e,t))},Go.text=function(e){return arguments.length?this.each("function"==typeof e?function(){var t=e.apply(this,arguments);this.textContent=null==t?"":t}:null==e?function(){this.textContent=""}:function(){this.textContent=e}):this.node().textContent},Go.html=function(e){return arguments.length?this.each("function"==typeof e?function(){var t=e.apply(this,arguments);this.innerHTML=null==t?"":t}:null==e?function(){this.innerHTML=""}:function(){this.innerHTML=e}):this.node().innerHTML},Go.append=function(e){return e=$(e),this.select(function(){return this.appendChild(e.apply(this,arguments))})},Go.insert=function(e,t){return e=$(e),t=L(t),this.select(function(){return this.insertBefore(e.apply(this,arguments),t.apply(this,arguments)||null)})},Go.remove=function(){return this.each(H)},Go.data=function(e,t){function n(e,n){var i,r,a,o=e.length,d=n.length,u=Math.min(o,d),h=new Array(d),f=new Array(d),_=new Array(o);if(t){var g,m=new p,v=new Array(o);for(i=-1;++i<o;)(r=e[i])&&(m.has(g=t.call(r,r.__data__,i))?_[i]=r:m.set(g,r),v[i]=g);for(i=-1;++i<d;)(r=m.get(g=t.call(n,a=n[i],i)))?!0!==r&&(h[i]=r,r.__data__=a):f[i]=U(a),m.set(g,!0);for(i=-1;++i<o;)i in v&&!0!==m.get(v[i])&&(_[i]=e[i])}else{for(i=-1;++i<u;)r=e[i],a=n[i],r?(r.__data__=a,h[i]=r):f[i]=U(a);for(;i<d;++i)f[i]=U(n[i]);for(;i<o;++i)_[i]=e[i]}f.update=h,f.parentNode=h.parentNode=_.parentNode=e.parentNode,s.push(f),l.push(h),c.push(_)}var i,r,a=-1,o=this.length;if(!arguments.length){for(e=new Array(o=(i=this[0]).length);++a<o;)(r=i[a])&&(e[a]=r.__data__);return e}var s=Y([]),l=G([]),c=G([]);if("function"==typeof e)for(;++a<o;)n(i=this[a],e.call(i,i.parentNode.__data__,a));else for(;++a<o;)n(i=this[a],e);return l.enter=function(){return s},l.exit=function(){return c},l},Go.datum=function(e){return arguments.length?this.property("__data__",e):this.property("__data__")},Go.filter=function(e){var t,n,i,r=[];"function"!=typeof e&&(e=J(e));for(var a=0,o=this.length;a<o;a++){r.push(t=[]),t.parentNode=(n=this[a]).parentNode;for(var s=0,l=n.length;s<l;s++)(i=n[s])&&e.call(i,i.__data__,s,a)&&t.push(i)}return G(r)},Go.order=function(){for(var e=-1,t=this.length;++e<t;)for(var n,i=this[e],r=i.length-1,a=i[r];--r>=0;)(n=i[r])&&(a&&a!==n.nextSibling&&a.parentNode.insertBefore(n,a),a=n);return this},Go.sort=function(e){e=B.apply(this,arguments);for(var t=-1,n=this.length;++t<n;)this[t].sort(e);return this.order()},Go.each=function(e){return W(this,function(t,n,i){e.call(t,t.__data__,n,i)})},Go.call=function(e){var t=_o(arguments);return e.apply(t[0]=this,t),this},Go.empty=function(){return!this.node()},Go.node=function(){for(var e=0,t=this.length;e<t;e++)for(var n=this[e],i=0,r=n.length;i<r;i++){var a=n[i];if(a)return a}return null},Go.size=function(){var e=0;return W(this,function(){++e}),e};var Io=[];fo.selection.enter=Y,fo.selection.enter.prototype=Io,Io.append=Go.append,Io.empty=Go.empty,Io.node=Go.node,Io.call=Go.call,Io.size=Go.size,Io.select=function(e){for(var t,n,i,r,a,o=[],s=-1,l=this.length;++s<l;){i=(r=this[s]).update,o.push(t=[]),t.parentNode=r.parentNode;for(var c=-1,d=r.length;++c<d;)(a=r[c])?(t.push(i[c]=n=e.call(r.parentNode,a.__data__,c,s)),n.__data__=a.__data__):t.push(null)}return G(o)},Io.insert=function(e,t){return arguments.length<2&&(t=K(this)),Go.insert.call(this,e,t)},fo.select=function(e){var t;return"string"==typeof e?(t=[Oo(e,go)],t.parentNode=go.documentElement):(t=[e],t.parentNode=a(e)),G([t])},fo.selectAll=function(e){var t;return"string"==typeof e?(t=_o(Ao(e,go)),t.parentNode=go.documentElement):(t=_o(e),t.parentNode=null),G([t])},Go.on=function(e,t,n){var i=arguments.length;if(i<3){if("string"!=typeof e){i<2&&(t=!1);for(n in e)this.each(X(n,e[n],t));return this}if(i<2)return(i=this.node()["__on"+e])&&i._;n=!1}return this.each(X(e,t,n))};var Po=fo.map({mouseenter:"mouseover",mouseleave:"mouseout"});go&&Po.forEach(function(e){"on"+e in go&&Po.remove(e)});var Ro,Vo=0;fo.mouse=function(e){return te(e,A())};var Eo=this.navigator&&/WebKit/.test(this.navigator.userAgent)?-1:0;fo.touch=function(e,t,n){if(arguments.length<3&&(n=t,t=A().changedTouches),t)for(var i,r=0,a=t.length;r<a;++r)if((i=t[r]).identifier===n)return te(e,i)},fo.behavior.drag=function(){function e(){this.on("mousedown.drag",r).on("touchstart.drag",a)}function t(e,t,r,a,o){return function(){function s(){var e,n,i=t(h,_);i&&(e=i[0]-y[0],n=i[1]-y[1],p|=e|n,y=i,f({type:"drag",x:i[0]+c[0],y:i[1]+c[1],dx:e,dy:n}))}function l(){t(h,_)&&(m.on(a+g,null).on(o+g,null),v(p),f({type:"dragend"}))}var c,d=this,u=fo.event.target.correspondingElement||fo.event.target,h=d.parentNode,f=n.of(d,arguments),p=0,_=e(),g=".drag"+(null==_?"":"-"+_),m=fo.select(r(u)).on(a+g,s).on(o+g,l),v=ee(u),y=t(h,_);i?(c=i.apply(d,arguments),c=[c.x-y[0],c.y-y[1]]):c=[0,0],f({type:"dragstart"})}}var n=N(e,"drag","dragstart","dragend"),i=null,r=t(C,fo.mouse,o,"mousemove","mouseup"),a=t(ne,fo.touch,k,"touchmove","touchend");return e.origin=function(t){return arguments.length?(i=t,e):i},fo.rebind(e,n,"on")},fo.touches=function(e,t){return arguments.length<2&&(t=A().touches),t?_o(t).map(function(t){var n=te(e,t);return n.identifier=t.identifier,n}):[]};var zo=1e-6,qo=zo*zo,Fo=Math.PI,$o=2*Fo,Ho=$o-zo,Uo=Fo/2,Jo=Fo/180,Bo=180/Fo,Wo=Math.SQRT2;fo.interpolateZoom=function(e,t){var n,i,r=e[0],a=e[1],o=e[2],s=t[0],l=t[1],c=t[2],d=s-r,u=l-a,h=d*d+u*u;if(h<qo)i=Math.log(c/o)/Wo,n=function(e){return[r+e*d,a+e*u,o*Math.exp(Wo*e*i)]};else{var f=Math.sqrt(h),p=(c*c-o*o+4*h)/(2*o*2*f),_=(c*c-o*o-4*h)/(2*c*2*f),g=Math.log(Math.sqrt(p*p+1)-p),m=Math.log(Math.sqrt(_*_+1)-_);i=(m-g)/Wo,n=function(e){var t=e*i,n=le(g),s=o/(2*f)*(n*ce(Wo*t+g)-se(g));return[r+s*d,a+s*u,o*n/le(Wo*t+g)]}}return n.duration=1e3*i,n},fo.behavior.zoom=function(){function e(e){e.on(A,u).on(Ko+".zoom",f).on("dblclick.zoom",p).on(D,h)}function t(e){return[(e[0]-j.x)/j.k,(e[1]-j.y)/j.k]}function n(e){return[e[0]*j.k+j.x,e[1]*j.k+j.y]}function i(e){j.k=Math.max(C[0],Math.min(C[1],e))}function r(e,t){t=n(t),j.x+=e[0]-t[0],j.y+=e[1]-t[1]}function a(t,n,a,o){t.__chart__={x:j.x,y:j.y,k:j.k},i(Math.pow(2,o)),r(g=n,a),t=fo.select(t),S>0&&(t=t.transition().duration(S)),t.call(e.event)}function s(){w&&w.domain(b.range().map(function(e){return(e-j.x)/j.k}).map(b.invert)),k&&k.domain(x.range().map(function(e){return(e-j.y)/j.k}).map(x.invert))}function l(e){T++||e({type:"zoomstart"})}function c(e){s(),e({type:"zoom",scale:j.k,translate:[j.x,j.y]})}function d(e){--T||(e({type:"zoomend"}),g=null)}function u(){function e(){s=1,r(fo.mouse(i),h),c(a)}function n(){u.on(G,null).on(L,null),f(s),d(a)}var i=this,a=I.of(i,arguments),s=0,u=fo.select(o(i)).on(G,e).on(L,n),h=t(fo.mouse(i)),f=ee(i);$l.call(i),l(a)}function h(){function e(){var e=fo.touches(p);return f=j.k,e.forEach(function(e){e.identifier in g&&(g[e.identifier]=t(e))}),e}function n(){var t=fo.event.target;fo.select(t).on(b,o).on(w,s),x.push(t);for(var n=fo.event.changedTouches,i=0,r=n.length;i<r;++i)g[n[i].identifier]=null;var l=e(),c=Date.now();if(1===l.length){if(c-y<500){var d=l[0];a(p,d,g[d.identifier],Math.floor(Math.log(j.k)/Math.LN2)+1),O()}y=c}else if(l.length>1){var d=l[0],u=l[1],h=d[0]-u[0],f=d[1]-u[1];m=h*h+f*f}}function o(){var e,t,n,a,o=fo.touches(p);$l.call(p);for(var s=0,l=o.length;s<l;++s,a=null)if(n=o[s],a=g[n.identifier]){if(t)break;e=n,t=a}if(a){var d=(d=n[0]-e[0])*d+(d=n[1]-e[1])*d,u=m&&Math.sqrt(d/m);e=[(e[0]+n[0])/2,(e[1]+n[1])/2],t=[(t[0]+a[0])/2,(t[1]+a[1])/2],i(u*f)}y=null,r(e,t),c(_)}function s(){if(fo.event.touches.length){for(var t=fo.event.changedTouches,n=0,i=t.length;n<i;++n)delete g[t[n].identifier];for(var r in g)return void e()}fo.selectAll(x).on(v,null),k.on(A,u).on(D,h),M(),d(_)}var f,p=this,_=I.of(p,arguments),g={},m=0,v=".zoom-"+fo.event.changedTouches[0].identifier,b="touchmove"+v,w="touchend"+v,x=[],k=fo.select(p),M=ee(p);n(),l(_),k.on(A,null).on(D,n)}function f(){var e=I.of(this,arguments);v?clearTimeout(v):($l.call(this),_=t(g=m||fo.mouse(this)),l(e)),v=setTimeout(function(){v=null,d(e)},50),O(),i(Math.pow(2,.002*Yo())*j.k),r(g,_),c(e)}function p(){var e=fo.mouse(this),n=Math.log(j.k)/Math.LN2;a(this,e,t(e),fo.event.shiftKey?Math.ceil(n)-1:Math.floor(n)+1)}var _,g,m,v,y,b,w,x,k,j={x:0,y:0,k:1},M=[960,500],C=Xo,S=250,T=0,A="mousedown.zoom",G="mousemove.zoom",L="mouseup.zoom",D="touchstart.zoom",I=N(e,"zoomstart","zoom","zoomend");return Ko||(Ko="onwheel"in go?(Yo=function(){return-fo.event.deltaY*(fo.event.deltaMode?120:1)},"wheel"):"onmousewheel"in go?(Yo=function(){return fo.event.wheelDelta},"mousewheel"):(Yo=function(){return-fo.event.detail},"MozMousePixelScroll")),e.event=function(e){e.each(function(){var e=I.of(this,arguments),t=j;ql?fo.select(this).transition().each("start.zoom",function(){j=this.__chart__||{x:0,y:0,k:1},l(e)}).tween("zoom:zoom",function(){var n=M[0],i=M[1],r=g?g[0]:n/2,a=g?g[1]:i/2,o=fo.interpolateZoom([(r-j.x)/j.k,(a-j.y)/j.k,n/j.k],[(r-t.x)/t.k,(a-t.y)/t.k,n/t.k]);return function(t){var i=o(t),s=n/i[2];this.__chart__=j={x:r-i[0]*s,y:a-i[1]*s,k:s},c(e)}}).each("interrupt.zoom",function(){d(e)}).each("end.zoom",function(){d(e)}):(this.__chart__=j,l(e),c(e),d(e))})},e.translate=function(t){return arguments.length?(j={x:+t[0],y:+t[1],k:j.k},s(),e):[j.x,j.y]},e.scale=function(t){return arguments.length?(j={x:j.x,y:j.y,k:null},i(+t),s(),e):j.k},e.scaleExtent=function(t){return arguments.length?(C=null==t?Xo:[+t[0],+t[1]],e):C},e.center=function(t){return arguments.length?(m=t&&[+t[0],+t[1]],e):m},e.size=function(t){return arguments.length?(M=t&&[+t[0],+t[1]],e):M},e.duration=function(t){return arguments.length?(S=+t,e):S},e.x=function(t){return arguments.length?(w=t,b=t.copy(),j={x:0,y:0,k:1},e):w},e.y=function(t){return arguments.length?(k=t,x=t.copy(),j={x:0,y:0,k:1},e):k},fo.rebind(e,I,"on")};var Yo,Ko,Xo=[0,1/0];fo.color=ue,ue.prototype.toString=function(){return this.rgb()+""},fo.hsl=he;var Qo=he.prototype=new ue;Qo.brighter=function(e){return e=Math.pow(.7,arguments.length?e:1),new he(this.h,this.s,this.l/e)},Qo.darker=function(e){return e=Math.pow(.7,arguments.length?e:1),new he(this.h,this.s,e*this.l)},Qo.rgb=function(){return fe(this.h,this.s,this.l)},fo.hcl=pe;var Zo=pe.prototype=new ue;Zo.brighter=function(e){return new pe(this.h,this.c,Math.min(100,this.l+es*(arguments.length?e:1)))},Zo.darker=function(e){return new pe(this.h,this.c,Math.max(0,this.l-es*(arguments.length?e:1)))},Zo.rgb=function(){return _e(this.h,this.c,this.l).rgb()},fo.lab=ge;var es=18,ts=.95047,ns=1,is=1.08883,rs=ge.prototype=new ue;rs.brighter=function(e){return new ge(Math.min(100,this.l+es*(arguments.length?e:1)),this.a,this.b)},rs.darker=function(e){return new ge(Math.max(0,this.l-es*(arguments.length?e:1)),this.a,this.b)},rs.rgb=function(){return me(this.l,this.a,this.b)},fo.rgb=xe;var as=xe.prototype=new ue;as.brighter=function(e){e=Math.pow(.7,arguments.length?e:1);var t=this.r,n=this.g,i=this.b,r=30;return t||n||i?(t&&t<r&&(t=r),n&&n<r&&(n=r),i&&i<r&&(i=r),new xe(Math.min(255,t/e),Math.min(255,n/e),Math.min(255,i/e))):new xe(r,r,r)},as.darker=function(e){return e=Math.pow(.7,arguments.length?e:1),new xe(e*this.r,e*this.g,e*this.b)},as.hsl=function(){return Se(this.r,this.g,this.b)},as.toString=function(){return"#"+Me(this.r)+Me(this.g)+Me(this.b)};var os=fo.map({aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074});os.forEach(function(e,t){os.set(e,ke(t))}),fo.functor=Ne,fo.xhr=Ge(k),fo.dsv=function(e,t){function n(e,n,a){arguments.length<3&&(a=n,n=null);var o=Le(e,t,null==n?i:r(n),a);return o.row=function(e){return arguments.length?o.response(null==(n=e)?i:r(e)):n},o}function i(e){return n.parse(e.responseText)}function r(e){return function(t){return n.parse(t.responseText,e)}}function a(t){return t.map(o).join(e)}function o(e){return s.test(e)?'"'+e.replace(/\"/g,'""')+'"':e}var s=new RegExp('["'+e+"\n]"),l=e.charCodeAt(0);return n.parse=function(e,t){var i;return n.parseRows(e,function(e,n){if(i)return i(e,n-1);var r=new Function("d","return {"+e.map(function(e,t){return JSON.stringify(e)+": d["+t+"]"}).join(",")+"}");i=t?function(e,n){return t(r(e),n)}:r})},n.parseRows=function(e,t){function n(){if(d>=c)return o;if(r)return r=!1,a;var t=d;if(34===e.charCodeAt(t)){for(var n=t;n++<c;)if(34===e.charCodeAt(n)){if(34!==e.charCodeAt(n+1))break;++n}d=n+2;var i=e.charCodeAt(n+1);return 13===i?(r=!0,10===e.charCodeAt(n+2)&&++d):10===i&&(r=!0),e.slice(t+1,n).replace(/""/g,'"')}for(;d<c;){var i=e.charCodeAt(d++),s=1;if(10===i)r=!0;else if(13===i)r=!0,10===e.charCodeAt(d)&&(++d,++s);else if(i!==l)continue;return e.slice(t,d-s)}return e.slice(t)}for(var i,r,a={},o={},s=[],c=e.length,d=0,u=0;(i=n())!==o;){for(var h=[];i!==a&&i!==o;)h.push(i),i=n();t&&null==(h=t(h,u++))||s.push(h)}return s},n.format=function(t){if(Array.isArray(t[0]))return n.formatRows(t);var i=new x,r=[];return t.forEach(function(e){for(var t in e)i.has(t)||r.push(i.add(t))}),[r.map(o).join(e)].concat(t.map(function(t){return r.map(function(e){return o(t[e])}).join(e)})).join("\n")},n.formatRows=function(e){return e.map(a).join("\n")},n},fo.csv=fo.dsv(",","text/csv"),fo.tsv=fo.dsv("\t","text/tab-separated-values");var ss,ls,cs,ds,us=this[M(this,"requestAnimationFrame")]||function(e){setTimeout(e,17)};fo.timer=function(){Pe.apply(this,arguments)},fo.timer.flush=function(){Ve(),Ee()},fo.round=function(e,t){return t?Math.round(e*(t=Math.pow(10,t)))/t:Math.round(e)};var hs=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"].map(qe);fo.formatPrefix=function(e,t){var n=0;return(e=+e)&&(e<0&&(e*=-1),t&&(e=fo.round(e,ze(e,t))),n=1+Math.floor(1e-12+Math.log(e)/Math.LN10),n=Math.max(-24,Math.min(24,3*Math.floor((n-1)/3)))),hs[8+n/3]};var fs=/(?:([^{])?([<>=^]))?([+\- ])?([$#])?(0)?(\d+)?(,)?(\.-?\d+)?([a-z%])?/i,ps=fo.map({b:function(e){return e.toString(2)},c:function(e){return String.fromCharCode(e)},o:function(e){return e.toString(8)},x:function(e){return e.toString(16)},X:function(e){return e.toString(16).toUpperCase()},g:function(e,t){return e.toPrecision(t)},e:function(e,t){return e.toExponential(t)},f:function(e,t){return e.toFixed(t)},r:function(e,t){return(e=fo.round(e,ze(e,t))).toFixed(Math.max(0,Math.min(20,ze(e*(1+1e-15),t))))}}),_s=fo.time={},gs=Date;He.prototype={getDate:function(){return this._.getUTCDate()},getDay:function(){return this._.getUTCDay()},getFullYear:function(){return this._.getUTCFullYear()},getHours:function(){return this._.getUTCHours()},getMilliseconds:function(){return this._.getUTCMilliseconds()},getMinutes:function(){return this._.getUTCMinutes()},getMonth:function(){return this._.getUTCMonth()},getSeconds:function(){return this._.getUTCSeconds()},getTime:function(){return this._.getTime()},getTimezoneOffset:function(){return 0},valueOf:function(){return this._.valueOf()},setDate:function(){ms.setUTCDate.apply(this._,arguments)},setDay:function(){ms.setUTCDay.apply(this._,arguments)},setFullYear:function(){ms.setUTCFullYear.apply(this._,arguments)},setHours:function(){ms.setUTCHours.apply(this._,arguments)},setMilliseconds:function(){ms.setUTCMilliseconds.apply(this._,arguments)},setMinutes:function(){ms.setUTCMinutes.apply(this._,arguments)},setMonth:function(){ms.setUTCMonth.apply(this._,arguments)},setSeconds:function(){ms.setUTCSeconds.apply(this._,arguments)},setTime:function(){ms.setTime.apply(this._,arguments)}};var ms=Date.prototype;_s.year=Ue(function(e){return e=_s.day(e),e.setMonth(0,1),e},function(e,t){e.setFullYear(e.getFullYear()+t)},function(e){return e.getFullYear()}),_s.years=_s.year.range,_s.years.utc=_s.year.utc.range,_s.day=Ue(function(e){var t=new gs(2e3,0);return t.setFullYear(e.getFullYear(),e.getMonth(),e.getDate()),t},function(e,t){e.setDate(e.getDate()+t)},function(e){return e.getDate()-1}),_s.days=_s.day.range,_s.days.utc=_s.day.utc.range,_s.dayOfYear=function(e){var t=_s.year(e);return Math.floor((e-t-6e4*(e.getTimezoneOffset()-t.getTimezoneOffset()))/864e5)},["sunday","monday","tuesday","wednesday","thursday","friday","saturday"].forEach(function(e,t){t=7-t;var n=_s[e]=Ue(function(e){return(e=_s.day(e)).setDate(e.getDate()-(e.getDay()+t)%7),e},function(e,t){e.setDate(e.getDate()+7*Math.floor(t))},function(e){var n=_s.year(e).getDay();return Math.floor((_s.dayOfYear(e)+(n+t)%7)/7)-(n!==t)});_s[e+"s"]=n.range,_s[e+"s"].utc=n.utc.range,_s[e+"OfYear"]=function(e){var n=_s.year(e).getDay();return Math.floor((_s.dayOfYear(e)+(n+t)%7)/7)}}),_s.week=_s.sunday,_s.weeks=_s.sunday.range,_s.weeks.utc=_s.sunday.utc.range,_s.weekOfYear=_s.sundayOfYear;var vs={"-":"",_:" ",0:"0"},ys=/^\s*\d+/,bs=/^%/;fo.locale=function(e){return{numberFormat:Fe(e),timeFormat:Be(e)}};var ws=fo.locale({decimal:".",thousands:",",grouping:[3],currency:["$",""],dateTime:"%a %b %e %X %Y",date:"%m/%d/%Y",time:"%H:%M:%S",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});fo.format=ws.numberFormat,fo.geo={},pt.prototype={s:0,t:0,add:function(e){_t(e,this.t,xs),_t(xs.s,this.s,this),this.s?this.t+=xs.t:this.s=xs.t},reset:function(){this.s=this.t=0},valueOf:function(){return this.s}};var xs=new pt;fo.geo.stream=function(e,t){e&&ks.hasOwnProperty(e.type)?ks[e.type](e,t):gt(e,t)};var ks={Feature:function(e,t){gt(e.geometry,t)},FeatureCollection:function(e,t){for(var n=e.features,i=-1,r=n.length;++i<r;)gt(n[i].geometry,t)}},js={Sphere:function(e,t){t.sphere()},Point:function(e,t){e=e.coordinates,t.point(e[0],e[1],e[2])},MultiPoint:function(e,t){for(var n=e.coordinates,i=-1,r=n.length;++i<r;)e=n[i],t.point(e[0],e[1],e[2])},LineString:function(e,t){mt(e.coordinates,t,0)},MultiLineString:function(e,t){for(var n=e.coordinates,i=-1,r=n.length;++i<r;)mt(n[i],t,0)},Polygon:function(e,t){vt(e.coordinates,t)},MultiPolygon:function(e,t){for(var n=e.coordinates,i=-1,r=n.length;++i<r;)vt(n[i],t)},GeometryCollection:function(e,t){for(var n=e.geometries,i=-1,r=n.length;++i<r;)gt(n[i],t)}};fo.geo.area=function(e){return Ms=0,fo.geo.stream(e,Ss),Ms};var Ms,Cs=new pt,Ss={sphere:function(){Ms+=4*Fo},point:C,lineStart:C,lineEnd:C,polygonStart:function(){Cs.reset(),Ss.lineStart=yt},polygonEnd:function(){var e=2*Cs;Ms+=e<0?4*Fo+e:e,Ss.lineStart=Ss.lineEnd=Ss.point=C}};fo.geo.bounds=function(){function e(e,t){y.push(b=[d=e,h=e]),t<u&&(u=t),t>f&&(f=t)}function t(t,n){var i=bt([t*Jo,n*Jo]);if(m){var r=xt(m,i),a=[r[1],-r[0],0],o=xt(a,r);Mt(o),o=Ct(o);var l=t-p,c=l>0?1:-1,_=o[0]*Bo*c,g=ko(l)>180;if(g^(c*p<_&&_<c*t)){var v=o[1]*Bo;v>f&&(f=v)}else if(_=(_+360)%360-180,g^(c*p<_&&_<c*t)){var v=-o[1]*Bo;v<u&&(u=v)}else n<u&&(u=n),n>f&&(f=n);g?t<p?s(d,t)>s(d,h)&&(h=t):s(t,h)>s(d,h)&&(d=t):h>=d?(t<d&&(d=t),t>h&&(h=t)):t>p?s(d,t)>s(d,h)&&(h=t):s(t,h)>s(d,h)&&(d=t)}else e(t,n);m=i,p=t}function n(){w.point=t}function i(){b[0]=d,b[1]=h,w.point=e,m=null}function r(e,n){if(m){var i=e-p;v+=ko(i)>180?i+(i>0?360:-360):i}else _=e,g=n;Ss.point(e,n),t(e,n)}function a(){Ss.lineStart()}function o(){r(_,g),Ss.lineEnd(),ko(v)>zo&&(d=-(h=180)),b[0]=d,b[1]=h,m=null}function s(e,t){return(t-=e)<0?t+360:t}function l(e,t){return e[0]-t[0]}function c(e,t){return t[0]<=t[1]?t[0]<=e&&e<=t[1]:e<t[0]||t[1]<e}var d,u,h,f,p,_,g,m,v,y,b,w={point:e,lineStart:n,lineEnd:i,polygonStart:function(){w.point=r,w.lineStart=a,w.lineEnd=o,v=0,Ss.polygonStart()},polygonEnd:function(){Ss.polygonEnd(),w.point=e,w.lineStart=n,w.lineEnd=i,Cs<0?(d=-(h=180),u=-(f=90)):v>zo?f=90:v<-zo&&(u=-90),b[0]=d,b[1]=h}};return function(e){f=h=-(d=u=1/0),y=[],fo.geo.stream(e,w);var t=y.length;if(t){y.sort(l);for(var n,i=1,r=y[0],a=[r];i<t;++i)n=y[i],c(n[0],r)||c(n[1],r)?(s(r[0],n[1])>s(r[0],r[1])&&(r[1]=n[1]),s(n[0],r[1])>s(r[0],r[1])&&(r[0]=n[0])):a.push(r=n);for(var o,n,p=-1/0,t=a.length-1,i=0,r=a[t];i<=t;r=n,++i)n=a[i],(o=s(r[1],n[0]))>p&&(p=o,d=n[0],h=r[1])}return y=b=null,d===1/0||u===1/0?[[NaN,NaN],[NaN,NaN]]:[[d,u],[h,f]]}}(),fo.geo.centroid=function(e){Ts=Os=As=Ns=Gs=Ls=Ds=Is=Ps=Rs=Vs=0,fo.geo.stream(e,Es);var t=Ps,n=Rs,i=Vs,r=t*t+n*n+i*i;return r<qo&&(t=Ls,n=Ds,i=Is,Os<zo&&(t=As,n=Ns,i=Gs),(r=t*t+n*n+i*i)<qo)?[NaN,NaN]:[Math.atan2(n,t)*Bo,oe(i/Math.sqrt(r))*Bo]};var Ts,Os,As,Ns,Gs,Ls,Ds,Is,Ps,Rs,Vs,Es={sphere:C,point:Tt,lineStart:At,lineEnd:Nt,polygonStart:function(){Es.lineStart=Gt},polygonEnd:function(){Es.lineStart=At}},zs=Vt(Dt,Ft,Ht,[-Fo,-Fo/2]),qs=1e9;fo.geo.clipExtent=function(){var e,t,n,i,r,a,o={stream:function(e){return r&&(r.valid=!1),r=a(e),r.valid=!0,r},extent:function(s){return arguments.length?(a=Wt(e=+s[0][0],t=+s[0][1],n=+s[1][0],i=+s[1][1]),r&&(r.valid=!1,r=null),o):[[e,t],[n,i]]}};return o.extent([[0,0],[960,500]])},(fo.geo.conicEqualArea=function(){return Yt(Kt)}).raw=Kt,fo.geo.albers=function(){return fo.geo.conicEqualArea().rotate([96,0]).center([-.6,38.7]).parallels([29.5,45.5]).scale(1070)},fo.geo.albersUsa=function(){function e(e){var a=e[0],o=e[1];return t=null,n(a,o),t||(i(a,o),t)||r(a,o),t}var t,n,i,r,a=fo.geo.albers(),o=fo.geo.conicEqualArea().rotate([154,0]).center([-2,58.5]).parallels([55,65]),s=fo.geo.conicEqualArea().rotate([157,0]).center([-3,19.9]).parallels([8,18]),l={point:function(e,n){t=[e,n]}};return e.invert=function(e){var t=a.scale(),n=a.translate(),i=(e[0]-n[0])/t,r=(e[1]-n[1])/t;return(r>=.12&&r<.234&&i>=-.425&&i<-.214?o:r>=.166&&r<.234&&i>=-.214&&i<-.115?s:a).invert(e)},e.stream=function(e){var t=a.stream(e),n=o.stream(e),i=s.stream(e);return{point:function(e,r){t.point(e,r),n.point(e,r),i.point(e,r)},sphere:function(){t.sphere(),n.sphere(),i.sphere()},lineStart:function(){t.lineStart(),n.lineStart(),i.lineStart()},lineEnd:function(){t.lineEnd(),n.lineEnd(),i.lineEnd()},polygonStart:function(){t.polygonStart(),n.polygonStart(),i.polygonStart()},polygonEnd:function(){t.polygonEnd(),n.polygonEnd(),i.polygonEnd()}}},e.precision=function(t){return arguments.length?(a.precision(t),o.precision(t),s.precision(t),e):a.precision()},e.scale=function(t){return arguments.length?(a.scale(t),o.scale(.35*t),s.scale(t),e.translate(a.translate())):a.scale()},e.translate=function(t){if(!arguments.length)return a.translate();var c=a.scale(),d=+t[0],u=+t[1];return n=a.translate(t).clipExtent([[d-.455*c,u-.238*c],[d+.455*c,u+.238*c]]).stream(l).point,i=o.translate([d-.307*c,u+.201*c]).clipExtent([[d-.425*c+zo,u+.12*c+zo],[d-.214*c-zo,u+.234*c-zo]]).stream(l).point,r=s.translate([d-.205*c,u+.212*c]).clipExtent([[d-.214*c+zo,u+.166*c+zo],[d-.115*c-zo,u+.234*c-zo]]).stream(l).point,e},e.scale(1070)};var Fs,$s,Hs,Us,Js,Bs,Ws={point:C,lineStart:C,lineEnd:C,polygonStart:function(){$s=0,Ws.lineStart=Xt},polygonEnd:function(){Ws.lineStart=Ws.lineEnd=Ws.point=C,Fs+=ko($s/2)}},Ys={point:Qt,lineStart:C,lineEnd:C,polygonStart:C,polygonEnd:C},Ks={point:tn,lineStart:nn,lineEnd:rn,polygonStart:function(){Ks.lineStart=an},polygonEnd:function(){Ks.point=tn,Ks.lineStart=nn,Ks.lineEnd=rn}};fo.geo.path=function(){function e(e){return e&&("function"==typeof s&&a.pointRadius(+s.apply(this,arguments)),o&&o.valid||(o=r(a)),fo.geo.stream(e,o)),a.result()}function t(){return o=null,e}var n,i,r,a,o,s=4.5;return e.area=function(e){return Fs=0,fo.geo.stream(e,r(Ws)),Fs},e.centroid=function(e){return As=Ns=Gs=Ls=Ds=Is=Ps=Rs=Vs=0,fo.geo.stream(e,r(Ks)),Vs?[Ps/Vs,Rs/Vs]:Is?[Ls/Is,Ds/Is]:Gs?[As/Gs,Ns/Gs]:[NaN,NaN]},e.bounds=function(e){return Js=Bs=-(Hs=Us=1/0),fo.geo.stream(e,r(Ys)),[[Hs,Us],[Js,Bs]]},e.projection=function(e){return arguments.length?(r=(n=e)?e.stream||ln(e):k,t()):n},e.context=function(e){return arguments.length?(a=null==(i=e)?new Zt:new on(e),"function"!=typeof s&&a.pointRadius(s),t()):i},e.pointRadius=function(t){return arguments.length?(s="function"==typeof t?t:(a.pointRadius(+t),+t),e):s},e.projection(fo.geo.albersUsa()).context(null)},fo.geo.transform=function(e){return{stream:function(t){var n=new cn(t);for(var i in e)n[i]=e[i];return n}}},cn.prototype={point:function(e,t){this.stream.point(e,t)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}},fo.geo.projection=un,fo.geo.projectionMutator=hn,(fo.geo.equirectangular=function(){return un(pn)}).raw=pn.invert=pn,fo.geo.rotation=function(e){function t(t){return t=e(t[0]*Jo,t[1]*Jo),t[0]*=Bo,t[1]*=Bo,t}return e=gn(e[0]%360*Jo,e[1]*Jo,e.length>2?e[2]*Jo:0),t.invert=function(t){return t=e.invert(t[0]*Jo,t[1]*Jo),t[0]*=Bo,t[1]*=Bo,t},t},_n.invert=pn,fo.geo.circle=function(){function e(){var e="function"==typeof i?i.apply(this,arguments):i,t=gn(-e[0]*Jo,-e[1]*Jo,0).invert,r=[];return n(null,null,1,{point:function(e,n){r.push(e=t(e,n)),e[0]*=Bo,e[1]*=Bo}}),{type:"Polygon",coordinates:[r]}}var t,n,i=[0,0],r=6;return e.origin=function(t){return arguments.length?(i=t,e):i},e.angle=function(i){return arguments.length?(n=bn((t=+i)*Jo,r*Jo),e):t},e.precision=function(i){return arguments.length?(n=bn(t*Jo,(r=+i)*Jo),e):r},e.angle(90)},fo.geo.distance=function(e,t){var n,i=(t[0]-e[0])*Jo,r=e[1]*Jo,a=t[1]*Jo,o=Math.sin(i),s=Math.cos(i),l=Math.sin(r),c=Math.cos(r),d=Math.sin(a),u=Math.cos(a);return Math.atan2(Math.sqrt((n=u*o)*n+(n=c*d-l*u*s)*n),l*d+c*u*s)},fo.geo.graticule=function(){function e(){return{type:"MultiLineString",coordinates:t()}}function t(){return fo.range(Math.ceil(a/g)*g,r,g).map(h).concat(fo.range(Math.ceil(c/m)*m,l,m).map(f)).concat(fo.range(Math.ceil(i/p)*p,n,p).filter(function(e){return ko(e%g)>zo}).map(d)).concat(fo.range(Math.ceil(s/_)*_,o,_).filter(function(e){return ko(e%m)>zo}).map(u))}var n,i,r,a,o,s,l,c,d,u,h,f,p=10,_=p,g=90,m=360,v=2.5;return e.lines=function(){return t().map(function(e){return{type:"LineString",coordinates:e}})},e.outline=function(){return{type:"Polygon",coordinates:[h(a).concat(f(l).slice(1),h(r).reverse().slice(1),f(c).reverse().slice(1))]}},e.extent=function(t){return arguments.length?e.majorExtent(t).minorExtent(t):e.minorExtent()},e.majorExtent=function(t){return arguments.length?(a=+t[0][0],r=+t[1][0],c=+t[0][1],l=+t[1][1],a>r&&(t=a,a=r,r=t),c>l&&(t=c,c=l,l=t),e.precision(v)):[[a,c],[r,l]]},e.minorExtent=function(t){return arguments.length?(i=+t[0][0],n=+t[1][0],s=+t[0][1],o=+t[1][1],i>n&&(t=i,i=n,n=t),s>o&&(t=s,s=o,o=t),e.precision(v)):[[i,s],[n,o]]},e.step=function(t){return arguments.length?e.majorStep(t).minorStep(t):e.minorStep()},e.majorStep=function(t){return arguments.length?(g=+t[0],m=+t[1],e):[g,m]},e.minorStep=function(t){return arguments.length?(p=+t[0],_=+t[1],e):[p,_]},e.precision=function(t){return arguments.length?(v=+t,d=xn(s,o,90),u=kn(i,n,v),h=xn(c,l,90),f=kn(a,r,v),e):v},e.majorExtent([[-180,-90+zo],[180,90-zo]]).minorExtent([[-180,-80-zo],[180,80+zo]])},fo.geo.greatArc=function(){function e(){return{type:"LineString",coordinates:[t||i.apply(this,arguments),n||r.apply(this,arguments)]}}var t,n,i=jn,r=Mn;return e.distance=function(){return fo.geo.distance(t||i.apply(this,arguments),n||r.apply(this,arguments))},e.source=function(n){return arguments.length?(i=n,t="function"==typeof n?null:n,e):i},e.target=function(t){return arguments.length?(r=t,n="function"==typeof t?null:t,e):r},e.precision=function(){return arguments.length?e:0},e},fo.geo.interpolate=function(e,t){return Cn(e[0]*Jo,e[1]*Jo,t[0]*Jo,t[1]*Jo)},fo.geo.length=function(e){return Xs=0,fo.geo.stream(e,Qs),Xs};var Xs,Qs={sphere:C,point:C,lineStart:Sn,lineEnd:C,polygonStart:C,polygonEnd:C},Zs=Tn(function(e){return Math.sqrt(2/(1+e))},function(e){return 2*Math.asin(e/2)});(fo.geo.azimuthalEqualArea=function(){return un(Zs)}).raw=Zs;var el=Tn(function(e){var t=Math.acos(e);return t&&t/Math.sin(t)},k);(fo.geo.azimuthalEquidistant=function(){return un(el)}).raw=el,(fo.geo.conicConformal=function(){return Yt(On)}).raw=On,(fo.geo.conicEquidistant=function(){return Yt(An)}).raw=An;var tl=Tn(function(e){return 1/e},Math.atan);(fo.geo.gnomonic=function(){return un(tl)}).raw=tl,Nn.invert=function(e,t){return[e,2*Math.atan(Math.exp(t))-Uo]},(fo.geo.mercator=function(){return Gn(Nn)}).raw=Nn;var nl=Tn(function(){return 1},Math.asin);(fo.geo.orthographic=function(){return un(nl)}).raw=nl;var il=Tn(function(e){return 1/(1+e)},function(e){return 2*Math.atan(e)});(fo.geo.stereographic=function(){return un(il)}).raw=il,Ln.invert=function(e,t){return[-t,2*Math.atan(Math.exp(e))-Uo]},(fo.geo.transverseMercator=function(){var e=Gn(Ln),t=e.center,n=e.rotate;return e.center=function(e){return e?t([-e[1],e[0]]):(e=t(),[e[1],-e[0]])},e.rotate=function(e){return e?n([e[0],e[1],e.length>2?e[2]+90:90]):(e=n(),[e[0],e[1],e[2]-90])},n([0,0,90])}).raw=Ln,fo.geom={},fo.geom.hull=function(e){function t(e){if(e.length<3)return[];var t,r=Ne(n),a=Ne(i),o=e.length,s=[],l=[];for(t=0;t<o;t++)s.push([+r.call(this,e[t],t),+a.call(this,e[t],t),t]);for(s.sort(Rn),t=0;t<o;t++)l.push([s[t][0],-s[t][1]]);var c=Pn(s),d=Pn(l),u=d[0]===c[0],h=d[d.length-1]===c[c.length-1],f=[];for(t=c.length-1;t>=0;--t)f.push(e[s[c[t]][2]]);for(t=+u;t<d.length-h;++t)f.push(e[s[d[t]][2]]);return f}var n=Dn,i=In;return arguments.length?t(e):(t.x=function(e){return arguments.length?(n=e,t):n},t.y=function(e){return arguments.length?(i=e,t):i},t)},fo.geom.polygon=function(e){return To(e,rl),e};var rl=fo.geom.polygon.prototype=[];rl.area=function(){for(var e,t=-1,n=this.length,i=this[n-1],r=0;++t<n;)e=i,i=this[t],r+=e[1]*i[0]-e[0]*i[1];return.5*r},rl.centroid=function(e){var t,n,i=-1,r=this.length,a=0,o=0,s=this[r-1];for(arguments.length||(e=-1/(6*this.area()));++i<r;)t=s,s=this[i],n=t[0]*s[1]-s[0]*t[1],a+=(t[0]+s[0])*n,o+=(t[1]+s[1])*n;return[a*e,o*e]},rl.clip=function(e){for(var t,n,i,r,a,o,s=zn(e),l=-1,c=this.length-zn(this),d=this[c-1];++l<c;){for(t=e.slice(),e.length=0,r=this[l],a=t[(i=t.length-s)-1],n=-1;++n<i;)o=t[n],Vn(o,d,r)?(Vn(a,d,r)||e.push(En(a,o,d,r)),e.push(o)):Vn(a,d,r)&&e.push(En(a,o,d,r)),a=o;s&&e.push(e[0]),d=r}return e};var al,ol,sl,ll,cl,dl=[],ul=[];Wn.prototype.prepare=function(){for(var e,t=this.edges,n=t.length;n--;)e=t[n].edge,e.b&&e.a||t.splice(n,1);return t.sort(Kn),t.length},oi.prototype={start:function(){return this.edge.l===this.site?this.edge.a:this.edge.b},end:function(){return this.edge.l===this.site?this.edge.b:this.edge.a}},si.prototype={insert:function(e,t){var n,i,r;if(e){if(t.P=e,t.N=e.N,e.N&&(e.N.P=t),e.N=t,e.R){for(e=e.R;e.L;)e=e.L;e.L=t}else e.R=t;n=e}else this._?(e=ui(this._),t.P=null,t.N=e,e.P=e.L=t,n=e):(t.P=t.N=null,this._=t,n=null);for(t.L=t.R=null,t.U=n,t.C=!0,e=t;n&&n.C;)i=n.U,n===i.L?(r=i.R,r&&r.C?(n.C=r.C=!1,i.C=!0,e=i):(e===n.R&&(ci(this,n),e=n,n=e.U),n.C=!1,i.C=!0,di(this,i))):(r=i.L,r&&r.C?(n.C=r.C=!1,i.C=!0,e=i):(e===n.L&&(di(this,n),e=n,n=e.U),n.C=!1,i.C=!0,ci(this,i))),n=e.U;this._.C=!1},remove:function(e){e.N&&(e.N.P=e.P),e.P&&(e.P.N=e.N),e.N=e.P=null;var t,n,i,r=e.U,a=e.L,o=e.R;if(n=a?o?ui(o):a:o,r?r.L===e?r.L=n:r.R=n:this._=n,a&&o?(i=n.C,n.C=e.C,n.L=a,a.U=n,n!==o?(r=n.U,n.U=e.U,e=n.R,r.L=e,n.R=o,o.U=n):(n.U=r,r=n,e=n.R)):(i=e.C,e=n),e&&(e.U=r),!i){if(e&&e.C)return void(e.C=!1);do{if(e===this._)break;if(e===r.L){if(t=r.R,t.C&&(t.C=!1,r.C=!0,ci(this,r),t=r.R),t.L&&t.L.C||t.R&&t.R.C){t.R&&t.R.C||(t.L.C=!1,t.C=!0,di(this,t),t=r.R),t.C=r.C,r.C=t.R.C=!1,ci(this,r),e=this._;break}}else if(t=r.L,t.C&&(t.C=!1,r.C=!0,di(this,r),t=r.L),t.L&&t.L.C||t.R&&t.R.C){t.L&&t.L.C||(t.R.C=!1,t.C=!0,ci(this,t),t=r.L),t.C=r.C,r.C=t.L.C=!1,di(this,r),e=this._;break}t.C=!0,e=r,r=r.U}while(!e.C);e&&(e.C=!1)}}},fo.geom.voronoi=function(e){function t(e){var t=new Array(e.length),i=s[0][0],r=s[0][1],a=s[1][0],o=s[1][1];return hi(n(e),s).cells.forEach(function(n,s){var l=n.edges,c=n.site;(t[s]=l.length?l.map(function(e){var t=e.start();return[t.x,t.y]}):c.x>=i&&c.x<=a&&c.y>=r&&c.y<=o?[[i,o],[a,o],[a,r],[i,r]]:[]).point=e[s]}),t}function n(e){return e.map(function(e,t){return{x:Math.round(a(e,t)/zo)*zo,y:Math.round(o(e,t)/zo)*zo,i:t}})}var i=Dn,r=In,a=i,o=r,s=hl;return e?t(e):(t.links=function(e){return hi(n(e)).edges.filter(function(e){return e.l&&e.r}).map(function(t){return{source:e[t.l.i],target:e[t.r.i]}})},t.triangles=function(e){var t=[];return hi(n(e)).cells.forEach(function(n,i){for(var r,a=n.site,o=n.edges.sort(Kn),s=-1,l=o.length,c=o[l-1].edge,d=c.l===a?c.r:c.l;++s<l;)c,r=d,c=o[s].edge,d=c.l===a?c.r:c.l,i<r.i&&i<d.i&&pi(a,r,d)<0&&t.push([e[i],e[r.i],e[d.i]])}),t},t.x=function(e){return arguments.length?(a=Ne(i=e),t):i},t.y=function(e){return arguments.length?(o=Ne(r=e),t):r},t.clipExtent=function(e){return arguments.length?(s=null==e?hl:e,t):s===hl?null:s},t.size=function(e){return arguments.length?t.clipExtent(e&&[[0,0],e]):s===hl?null:s&&s[1]},t)};var hl=[[-1e6,-1e6],[1e6,1e6]];fo.geom.delaunay=function(e){return fo.geom.voronoi().triangles(e)},fo.geom.quadtree=function(e,t,n,i,r){function a(e){function a(e,t,n,i,r,a,o,s){if(!isNaN(n)&&!isNaN(i))if(e.leaf){var l=e.x,d=e.y;if(null!=l)if(ko(l-n)+ko(d-i)<.01)c(e,t,n,i,r,a,o,s);else{var u=e.point;e.x=e.y=e.point=null,c(e,u,l,d,r,a,o,s),c(e,t,n,i,r,a,o,s)}else e.x=n,e.y=i,e.point=t}else c(e,t,n,i,r,a,o,s)}function c(e,t,n,i,r,o,s,l){var c=.5*(r+s),d=.5*(o+l),u=n>=c,h=i>=d,f=h<<1|u;e.leaf=!1,e=e.nodes[f]||(e.nodes[f]=mi()),u?r=c:s=c,h?o=d:l=d,a(e,t,n,i,r,o,s,l)}var d,u,h,f,p,_,g,m,v,y=Ne(s),b=Ne(l);if(null!=t)_=t,g=n,m=i,v=r;else if(m=v=-(_=g=1/0),u=[],h=[],p=e.length,o)for(f=0;f<p;++f)d=e[f],d.x<_&&(_=d.x),d.y<g&&(g=d.y),d.x>m&&(m=d.x),d.y>v&&(v=d.y),u.push(d.x),h.push(d.y);else for(f=0;f<p;++f){var w=+y(d=e[f],f),x=+b(d,f);w<_&&(_=w),x<g&&(g=x),w>m&&(m=w),x>v&&(v=x),u.push(w),h.push(x)}var k=m-_,j=v-g;k>j?v=g+k:m=_+j;var M=mi();if(M.add=function(e){a(M,e,+y(e,++f),+b(e,f),_,g,m,v)},M.visit=function(e){vi(e,M,_,g,m,v)},M.find=function(e){return yi(M,e[0],e[1],_,g,m,v)},f=-1,null==t){for(;++f<p;)a(M,e[f],u[f],h[f],_,g,m,v);--f}else e.forEach(M.add);return u=h=e=d=null,M}var o,s=Dn,l=In;return(o=arguments.length)?(s=_i,l=gi,3===o&&(r=n,i=t,n=t=0),a(e)):(a.x=function(e){return arguments.length?(s=e,a):s},a.y=function(e){return arguments.length?(l=e,a):l},a.extent=function(e){return arguments.length?(null==e?t=n=i=r=null:(t=+e[0][0],n=+e[0][1],i=+e[1][0],r=+e[1][1]),a):null==t?null:[[t,n],[i,r]]},a.size=function(e){return arguments.length?(null==e?t=n=i=r=null:(t=n=0,i=+e[0],r=+e[1]),a):null==t?null:[i-t,r-n]},a)},fo.interpolateRgb=bi,fo.interpolateObject=wi,fo.interpolateNumber=xi,fo.interpolateString=ki;var fl=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,pl=new RegExp(fl.source,"g");fo.interpolate=ji,fo.interpolators=[function(e,t){var n=typeof t;return("string"===n?os.has(t.toLowerCase())||/^(#|rgb\(|hsl\()/i.test(t)?bi:ki:t instanceof ue?bi:Array.isArray(t)?Mi:"object"===n&&isNaN(t)?wi:xi)(e,t)}],fo.interpolateArray=Mi;var _l=function(){return k},gl=fo.map({linear:_l,poly:Gi,quad:function(){return Oi},cubic:function(){return Ai},sin:function(){return Li},exp:function(){return Di},circle:function(){return Ii},elastic:Pi,back:Ri,bounce:function(){return Vi}}),ml=fo.map({in:k,out:Si,"in-out":Ti,"out-in":function(e){return Ti(Si(e))}});fo.ease=function(e){var t=e.indexOf("-"),n=t>=0?e.slice(0,t):e,i=t>=0?e.slice(t+1):"in";return n=gl.get(n)||_l,i=ml.get(i)||k,Ci(i(n.apply(null,po.call(arguments,1))))},fo.interpolateHcl=Ei,fo.interpolateHsl=zi,fo.interpolateLab=qi,fo.interpolateRound=Fi,fo.transform=function(e){var t=go.createElementNS(fo.ns.prefix.svg,"g");return(fo.transform=function(e){if(null!=e){t.setAttribute("transform",e);var n=t.transform.baseVal.consolidate()}return new $i(n?n.matrix:vl)})(e)},$i.prototype.toString=function(){return"translate("+this.translate+")rotate("+this.rotate+")skewX("+this.skew+")scale("+this.scale+")"};var vl={a:1,b:0,c:0,d:1,e:0,f:0};fo.interpolateTransform=Qi,fo.layout={},fo.layout.bundle=function(){return function(e){for(var t=[],n=-1,i=e.length;++n<i;)t.push(tr(e[n]));return t}},fo.layout.chord=function(){function e(){var e,c,u,h,f,p={},_=[],g=fo.range(a),m=[];for(n=[],i=[],e=0,h=-1;++h<a;){for(c=0,f=-1;++f<a;)c+=r[h][f];_.push(c),m.push(fo.range(a)),e+=c}for(o&&g.sort(function(e,t){return o(_[e],_[t])}),s&&m.forEach(function(e,t){e.sort(function(e,n){return s(r[t][e],r[t][n])})}),e=($o-d*a)/e,c=0,h=-1;++h<a;){for(u=c,f=-1;++f<a;){var v=g[h],y=m[v][f],b=r[v][y],w=c,x=c+=b*e;p[v+"-"+y]={index:v,subindex:y,startAngle:w,endAngle:x,value:b}}i[v]={index:v,startAngle:u,endAngle:c,value:_[v]},c+=d}for(h=-1;++h<a;)for(f=h-1;++f<a;){var k=p[h+"-"+f],j=p[f+"-"+h];(k.value||j.value)&&n.push(k.value<j.value?{source:j,target:k}:{source:k,target:j})}l&&t()}function t(){n.sort(function(e,t){return l((e.source.value+e.target.value)/2,(t.source.value+t.target.value)/2)})}var n,i,r,a,o,s,l,c={},d=0;return c.matrix=function(e){return arguments.length?(a=(r=e)&&r.length,n=i=null,c):r},c.padding=function(e){return arguments.length?(d=e,n=i=null,c):d},c.sortGroups=function(e){return arguments.length?(o=e,n=i=null,c):o},c.sortSubgroups=function(e){return arguments.length?(s=e,n=null,c):s},c.sortChords=function(e){return arguments.length?(l=e,n&&t(),c):l},c.chords=function(){return n||e(),n},c.groups=function(){return i||e(),i},c},fo.layout.force=function(){function e(e){return function(t,n,i,r){if(t.point!==e){var a=t.cx-e.x,o=t.cy-e.y,s=r-n,l=a*a+o*o;if(s*s/m<l){if(l<_){var c=t.charge/l;e.px-=a*c,e.py-=o*c}return!0}if(t.point&&l&&l<_){var c=t.pointCharge/l;e.px-=a*c,e.py-=o*c}}return!t.charge}}function t(e){e.px=fo.event.x,e.py=fo.event.y,l.resume()}var n,i,r,a,o,s,l={},c=fo.dispatch("start","tick","end"),d=[1,1],u=.9,h=yl,f=bl,p=-30,_=wl,g=.1,m=.64,v=[],y=[];return l.tick=function(){if((r*=.99)<.005)return n=null,c.end({type:"end",alpha:r=0}),!0;var t,i,l,h,f,_,m,b,w,x=v.length,k=y.length;for(i=0;i<k;++i)l=y[i],h=l.source,f=l.target,b=f.x-h.x,w=f.y-h.y,(_=b*b+w*w)&&(_=r*o[i]*((_=Math.sqrt(_))-a[i])/_,b*=_,w*=_,f.x-=b*(m=h.weight+f.weight?h.weight/(h.weight+f.weight):.5),f.y-=w*m,h.x+=b*(m=1-m),h.y+=w*m);if((m=r*g)&&(b=d[0]/2,w=d[1]/2,i=-1,m))for(;++i<x;)l=v[i],l.x+=(b-l.x)*m,l.y+=(w-l.y)*m;if(p)for(lr(t=fo.geom.quadtree(v),r,s),i=-1;++i<x;)(l=v[i]).fixed||t.visit(e(l));for(i=-1;++i<x;)l=v[i],l.fixed?(l.x=l.px,l.y=l.py):(l.x-=(l.px-(l.px=l.x))*u,l.y-=(l.py-(l.py=l.y))*u);c.tick({type:"tick",alpha:r})},l.nodes=function(e){return arguments.length?(v=e,l):v},l.links=function(e){return arguments.length?(y=e,l):y},l.size=function(e){return arguments.length?(d=e,l):d},l.linkDistance=function(e){return arguments.length?(h="function"==typeof e?e:+e,l):h},l.distance=l.linkDistance,l.linkStrength=function(e){return arguments.length?(f="function"==typeof e?e:+e,l):f},l.friction=function(e){return arguments.length?(u=+e,l):u},l.charge=function(e){return arguments.length?(p="function"==typeof e?e:+e,l):p},l.chargeDistance=function(e){return arguments.length?(_=e*e,l):Math.sqrt(_)},l.gravity=function(e){return arguments.length?(g=+e,l):g},l.theta=function(e){return arguments.length?(m=e*e,l):Math.sqrt(m)},l.alpha=function(e){return arguments.length?(e=+e,r?e>0?r=e:(n.c=null,n.t=NaN,n=null,c.end({type:"end",alpha:r=0})):e>0&&(c.start({type:"start",alpha:r=e}),n=Pe(l.tick)),l):r},l.start=function(){function e(e,i){if(!n){for(n=new Array(r),l=0;l<r;++l)n[l]=[];for(l=0;l<c;++l){var a=y[l];n[a.source.index].push(a.target),n[a.target.index].push(a.source)}}for(var o,s=n[t],l=-1,d=s.length;++l<d;)if(!isNaN(o=s[l][e]))return o;return Math.random()*i}var t,n,i,r=v.length,c=y.length,u=d[0],_=d[1];for(t=0;t<r;++t)(i=v[t]).index=t,i.weight=0;for(t=0;t<c;++t)i=y[t],"number"==typeof i.source&&(i.source=v[i.source]),"number"==typeof i.target&&(i.target=v[i.target]),++i.source.weight,++i.target.weight;for(t=0;t<r;++t)i=v[t],isNaN(i.x)&&(i.x=e("x",u)),isNaN(i.y)&&(i.y=e("y",_)),isNaN(i.px)&&(i.px=i.x),isNaN(i.py)&&(i.py=i.y);if(a=[],"function"==typeof h)for(t=0;t<c;++t)a[t]=+h.call(this,y[t],t);else for(t=0;t<c;++t)a[t]=h;if(o=[],"function"==typeof f)for(t=0;t<c;++t)o[t]=+f.call(this,y[t],t);else for(t=0;t<c;++t)o[t]=f;if(s=[],"function"==typeof p)for(t=0;t<r;++t)s[t]=+p.call(this,v[t],t);else for(t=0;t<r;++t)s[t]=p;return l.resume()},l.resume=function(){return l.alpha(.1)},l.stop=function(){return l.alpha(0)},l.drag=function(){if(i||(i=fo.behavior.drag().origin(k).on("dragstart.force",rr).on("drag.force",t).on("dragend.force",ar)),!arguments.length)return i;this.on("mouseover.force",or).on("mouseout.force",sr).call(i)},fo.rebind(l,c,"on")};var yl=20,bl=1,wl=1/0;fo.layout.hierarchy=function(){function e(r){var a,o=[r],s=[];for(r.depth=0;null!=(a=o.pop());)if(s.push(a),(c=n.call(e,a,a.depth))&&(l=c.length)){for(var l,c,d;--l>=0;)o.push(d=c[l]),d.parent=a,d.depth=a.depth+1;i&&(a.value=0),a.children=c}else i&&(a.value=+i.call(e,a,a.depth)||0),delete a.children;return ur(r,function(e){var n,r;t&&(n=e.children)&&n.sort(t),i&&(r=e.parent)&&(r.value+=e.value)}),s}var t=pr,n=hr,i=fr;return e.sort=function(n){return arguments.length?(t=n,e):t},e.children=function(t){return arguments.length?(n=t,e):n},e.value=function(t){return arguments.length?(i=t,e):i},e.revalue=function(t){return i&&(dr(t,function(e){e.children&&(e.value=0)}),ur(t,function(t){var n;t.children||(t.value=+i.call(e,t,t.depth)||0),(n=t.parent)&&(n.value+=t.value)})),t},e},fo.layout.partition=function(){function e(t,n,i,r){var a=t.children;if(t.x=n,t.y=t.depth*r,t.dx=i,t.dy=r,a&&(o=a.length)){var o,s,l,c=-1;for(i=t.value?i/t.value:0;++c<o;)e(s=a[c],n,l=s.value*i,r),n+=l}}function t(e){var n=e.children,i=0;if(n&&(r=n.length))for(var r,a=-1;++a<r;)i=Math.max(i,t(n[a]));return 1+i}function n(n,a){var o=i.call(this,n,a);return e(o[0],0,r[0],r[1]/t(o[0])),o}var i=fo.layout.hierarchy(),r=[1,1];return n.size=function(e){return arguments.length?(r=e,n):r},cr(n,i)},fo.layout.pie=function(){function e(o){var s,l=o.length,c=o.map(function(n,i){return+t.call(e,n,i)}),d=+("function"==typeof i?i.apply(this,arguments):i),u=("function"==typeof r?r.apply(this,arguments):r)-d,h=Math.min(Math.abs(u)/l,+("function"==typeof a?a.apply(this,arguments):a)),f=h*(u<0?-1:1),p=fo.sum(c),_=p?(u-l*f)/p:0,g=fo.range(l),m=[];return null!=n&&g.sort(n===xl?function(e,t){return c[t]-c[e]}:function(e,t){return n(o[e],o[t])}),g.forEach(function(e){m[e]={data:o[e],value:s=c[e],startAngle:d,endAngle:d+=s*_+f,padAngle:h}}),m}var t=Number,n=xl,i=0,r=$o,a=0;return e.value=function(n){return arguments.length?(t=n,e):t},e.sort=function(t){return arguments.length?(n=t,e):n},e.startAngle=function(t){return arguments.length?(i=t,e):i},e.endAngle=function(t){return arguments.length?(r=t,e):r},e.padAngle=function(t){return arguments.length?(a=t,e):a},e};var xl={};fo.layout.stack=function(){function e(s,l){if(!(h=s.length))return s;var c=s.map(function(n,i){return t.call(e,n,i)}),d=c.map(function(t){return t.map(function(t,n){return[a.call(e,t,n),o.call(e,t,n)]})}),u=n.call(e,d,l);c=fo.permute(c,u),d=fo.permute(d,u);var h,f,p,_,g=i.call(e,d,l),m=c[0].length;for(p=0;p<m;++p)for(r.call(e,c[0][p],_=g[p],d[0][p][1]),f=1;f<h;++f)r.call(e,c[f][p],_+=d[f-1][p][1],d[f][p][1]);return s}var t=k,n=yr,i=br,r=vr,a=gr,o=mr;return e.values=function(n){return arguments.length?(t=n,e):t},e.order=function(t){return arguments.length?(n="function"==typeof t?t:kl.get(t)||yr,e):n},e.offset=function(t){return arguments.length?(i="function"==typeof t?t:jl.get(t)||br,e):i},e.x=function(t){return arguments.length?(a=t,e):a},e.y=function(t){return arguments.length?(o=t,e):o},e.out=function(t){return arguments.length?(r=t,e):r},e};var kl=fo.map({"inside-out":function(e){var t,n,i=e.length,r=e.map(wr),a=e.map(xr),o=fo.range(i).sort(function(e,t){return r[e]-r[t]}),s=0,l=0,c=[],d=[];for(t=0;t<i;++t)n=o[t],s<l?(s+=a[n],c.push(n)):(l+=a[n],d.push(n));return d.reverse().concat(c)},reverse:function(e){return fo.range(e.length).reverse()},default:yr}),jl=fo.map({silhouette:function(e){var t,n,i,r=e.length,a=e[0].length,o=[],s=0,l=[];for(n=0;n<a;++n){for(t=0,i=0;t<r;t++)i+=e[t][n][1];i>s&&(s=i),o.push(i)}for(n=0;n<a;++n)l[n]=(s-o[n])/2;return l},wiggle:function(e){var t,n,i,r,a,o,s,l,c,d=e.length,u=e[0],h=u.length,f=[];for(f[0]=l=c=0,n=1;n<h;++n){for(t=0,r=0;t<d;++t)r+=e[t][n][1];for(t=0,a=0,s=u[n][0]-u[n-1][0];t<d;++t){for(i=0,o=(e[t][n][1]-e[t][n-1][1])/(2*s);i<t;++i)o+=(e[i][n][1]-e[i][n-1][1])/s;a+=o*e[t][n][1]}f[n]=l-=r?a/r*s:0,l<c&&(c=l)}for(n=0;n<h;++n)f[n]-=c;return f},expand:function(e){var t,n,i,r=e.length,a=e[0].length,o=1/r,s=[];for(n=0;n<a;++n){for(t=0,i=0;t<r;t++)i+=e[t][n][1];if(i)for(t=0;t<r;t++)e[t][n][1]/=i;else for(t=0;t<r;t++)e[t][n][1]=o}for(n=0;n<a;++n)s[n]=0;return s},zero:br});fo.layout.histogram=function(){function e(e,a){for(var o,s,l=[],c=e.map(n,this),d=i.call(this,c,a),u=r.call(this,d,c,a),a=-1,h=c.length,f=u.length-1,p=t?1:1/h;++a<f;)o=l[a]=[],o.dx=u[a+1]-(o.x=u[a]),o.y=0;if(f>0)for(a=-1;++a<h;)(s=c[a])>=d[0]&&s<=d[1]&&(o=l[fo.bisect(u,s,1,f)-1],o.y+=p,o.push(e[a]));return l}var t=!0,n=Number,i=Cr,r=jr;return e.value=function(t){return arguments.length?(n=t,e):n},e.range=function(t){return arguments.length?(i=Ne(t),e):i},e.bins=function(t){return arguments.length?(r="number"==typeof t?function(e){return Mr(e,t)}:Ne(t),e):r},e.frequency=function(n){return arguments.length?(t=!!n,e):t},e},fo.layout.pack=function(){function e(e,a){var o=n.call(this,e,a),s=o[0],l=r[0],c=r[1],d=null==t?Math.sqrt:"function"==typeof t?t:function(){return t};if(s.x=s.y=0,ur(s,function(e){e.r=+d(e.value)}),ur(s,Nr),i){var u=i*(t?1:Math.max(2*s.r/l,2*s.r/c))/2;ur(s,function(e){e.r+=u}),ur(s,Nr),ur(s,function(e){e.r-=u})}return Dr(s,l/2,c/2,t?1:1/Math.max(2*s.r/l,2*s.r/c)),o}var t,n=fo.layout.hierarchy().sort(Sr),i=0,r=[1,1];return e.size=function(t){return arguments.length?(r=t,e):r},e.radius=function(n){return arguments.length?(t=null==n||"function"==typeof n?n:+n,e):t},e.padding=function(t){return arguments.length?(i=+t,e):i},cr(e,n)},fo.layout.tree=function(){function e(e,r){var d=o.call(this,e,r),u=d[0],h=t(u);if(ur(h,n),h.parent.m=-h.z,dr(h,i),c)dr(u,a);else{var f=u,p=u,_=u;dr(u,function(e){e.x<f.x&&(f=e),e.x>p.x&&(p=e),e.depth>_.depth&&(_=e)});var g=s(f,p)/2-f.x,m=l[0]/(p.x+s(p,f)/2+g),v=l[1]/(_.depth||1);dr(u,function(e){e.x=(e.x+g)*m,e.y=e.depth*v})}return d}function t(e){for(var t,n={A:null,children:[e]},i=[n];null!=(t=i.pop());)for(var r,a=t.children,o=0,s=a.length;o<s;++o)i.push((a[o]=r={_:a[o],parent:t,children:(r=a[o].children)&&r.slice()||[],A:null,a:null,z:0,m:0,c:0,s:0,t:null,i:o}).a=r);return n.children[0]}function n(e){var t=e.children,n=e.parent.children,i=e.i?n[e.i-1]:null;if(t.length){zr(e);var a=(t[0].z+t[t.length-1].z)/2;i?(e.z=i.z+s(e._,i._),e.m=e.z-a):e.z=a}else i&&(e.z=i.z+s(e._,i._));e.parent.A=r(e,i,e.parent.A||n[0])}function i(e){e._.x=e.z+e.parent.m,e.m+=e.parent.m}function r(e,t,n){if(t){for(var i,r=e,a=e,o=t,l=r.parent.children[0],c=r.m,d=a.m,u=o.m,h=l.m;o=Vr(o),r=Rr(r),o&&r;)l=Rr(l),a=Vr(a),a.a=e,i=o.z+u-r.z-c+s(o._,r._),i>0&&(Er(qr(o,e,n),e,i),c+=i,d+=i),u+=o.m,c+=r.m,h+=l.m,d+=a.m;o&&!Vr(a)&&(a.t=o,a.m+=u-d),r&&!Rr(l)&&(l.t=r,l.m+=c-h,n=e)}return n}function a(e){e.x*=l[0],e.y=e.depth*l[1]}var o=fo.layout.hierarchy().sort(null).value(null),s=Pr,l=[1,1],c=null;return e.separation=function(t){return arguments.length?(s=t,e):s},e.size=function(t){return arguments.length?(c=null==(l=t)?a:null,e):c?null:l},e.nodeSize=function(t){return arguments.length?(c=null==(l=t)?null:a,e):c?l:null},cr(e,o)},fo.layout.cluster=function(){function e(e,a){var o,s=t.call(this,e,a),l=s[0],c=0;ur(l,function(e){var t=e.children;t&&t.length?(e.x=$r(t),e.y=Fr(t)):(e.x=o?c+=n(e,o):0,e.y=0,o=e)});var d=Hr(l),u=Ur(l),h=d.x-n(d,u)/2,f=u.x+n(u,d)/2;return ur(l,r?function(e){e.x=(e.x-l.x)*i[0],e.y=(l.y-e.y)*i[1]}:function(e){e.x=(e.x-h)/(f-h)*i[0],e.y=(1-(l.y?e.y/l.y:1))*i[1]}),s}var t=fo.layout.hierarchy().sort(null).value(null),n=Pr,i=[1,1],r=!1;return e.separation=function(t){return arguments.length?(n=t,e):n},e.size=function(t){return arguments.length?(r=null==(i=t),e):r?null:i},e.nodeSize=function(t){return arguments.length?(r=null!=(i=t),e):r?i:null},cr(e,t)},fo.layout.treemap=function(){function e(e,t){for(var n,i,r=-1,a=e.length;++r<a;)i=(n=e[r]).value*(t<0?0:t),n.area=isNaN(i)||i<=0?0:i}function t(n){var a=n.children;if(a&&a.length){var o,s,l,c=u(n),d=[],h=a.slice(),p=1/0,_="slice"===f?c.dx:"dice"===f?c.dy:"slice-dice"===f?1&n.depth?c.dy:c.dx:Math.min(c.dx,c.dy);for(e(h,c.dx*c.dy/n.value),d.area=0;(l=h.length)>0;)d.push(o=h[l-1]),d.area+=o.area,"squarify"!==f||(s=i(d,_))<=p?(h.pop(),p=s):(d.area-=d.pop().area,r(d,_,c,!1),_=Math.min(c.dx,c.dy),d.length=d.area=0,p=1/0);d.length&&(r(d,_,c,!0),d.length=d.area=0),a.forEach(t)}}function n(t){var i=t.children;if(i&&i.length){var a,o=u(t),s=i.slice(),l=[];for(e(s,o.dx*o.dy/t.value),l.area=0;a=s.pop();)l.push(a),l.area+=a.area,null!=a.z&&(r(l,a.z?o.dx:o.dy,o,!s.length),l.length=l.area=0);i.forEach(n)}}function i(e,t){for(var n,i=e.area,r=0,a=1/0,o=-1,s=e.length;++o<s;)(n=e[o].area)&&(n<a&&(a=n),n>r&&(r=n));return i*=i,t*=t,i?Math.max(t*r*p/i,i/(t*a*p)):1/0}function r(e,t,n,i){var r,a=-1,o=e.length,s=n.x,c=n.y,d=t?l(e.area/t):0;if(t==n.dx){for((i||d>n.dy)&&(d=n.dy);++a<o;)r=e[a],r.x=s,r.y=c,r.dy=d,s+=r.dx=Math.min(n.x+n.dx-s,d?l(r.area/d):0);r.z=!0,r.dx+=n.x+n.dx-s,n.y+=d,n.dy-=d}else{for((i||d>n.dx)&&(d=n.dx);++a<o;)r=e[a],r.x=s,r.y=c,r.dx=d,c+=r.dy=Math.min(n.y+n.dy-c,d?l(r.area/d):0);r.z=!1,r.dy+=n.y+n.dy-c,n.x+=d,n.dx-=d}}function a(i){var r=o||s(i),a=r[0];return a.x=a.y=0,a.value?(a.dx=c[0],a.dy=c[1]):a.dx=a.dy=0,o&&s.revalue(a),e([a],a.dx*a.dy/a.value),(o?n:t)(a),h&&(o=r),r}var o,s=fo.layout.hierarchy(),l=Math.round,c=[1,1],d=null,u=Jr,h=!1,f="squarify",p=.5*(1+Math.sqrt(5));return a.size=function(e){return arguments.length?(c=e,a):c},a.padding=function(e){function t(t){var n=e.call(a,t,t.depth);return null==n?Jr(t):Br(t,"number"==typeof n?[n,n,n,n]:n)}function n(t){return Br(t,e)}if(!arguments.length)return d;var i;return u=null==(d=e)?Jr:"function"==(i=typeof e)?t:"number"===i?(e=[e,e,e,e],n):n,a},a.round=function(e){return arguments.length?(l=e?Math.round:Number,a):l!=Number},a.sticky=function(e){return arguments.length?(h=e,o=null,a):h},a.ratio=function(e){return arguments.length?(p=e,a):p},a.mode=function(e){return arguments.length?(f=e+"",a):f},cr(a,s)},fo.random={normal:function(e,t){var n=arguments.length;return n<2&&(t=1),n<1&&(e=0),function(){var n,i,r;do{n=2*Math.random()-1,i=2*Math.random()-1,r=n*n+i*i}while(!r||r>1);return e+t*n*Math.sqrt(-2*Math.log(r)/r)}},logNormal:function(){var e=fo.random.normal.apply(fo,arguments);return function(){return Math.exp(e())}},bates:function(e){var t=fo.random.irwinHall(e);return function(){return t()/e}},irwinHall:function(e){return function(){for(var t=0,n=0;n<e;n++)t+=Math.random();return t}}},fo.scale={};var Ml={floor:k,ceil:k};fo.scale.linear=function(){return ea([0,1],[0,1],ji,!1)};var Cl={s:1,g:1,p:1,r:1,e:1};fo.scale.log=function(){return la(fo.scale.linear().domain([0,1]),10,!0,[1,10])};var Sl=fo.format(".0e"),Tl={floor:function(e){return-Math.ceil(-e)},ceil:function(e){return-Math.floor(-e)}};fo.scale.pow=function(){return ca(fo.scale.linear(),1,[0,1])},fo.scale.sqrt=function(){return fo.scale.pow().exponent(.5)},fo.scale.ordinal=function(){return ua([],{t:"range",a:[[]]})},fo.scale.category10=function(){return fo.scale.ordinal().range(Ol)},fo.scale.category20=function(){return fo.scale.ordinal().range(Al)},fo.scale.category20b=function(){return fo.scale.ordinal().range(Nl)},fo.scale.category20c=function(){return fo.scale.ordinal().range(Gl)};var Ol=[2062260,16744206,2924588,14034728,9725885,9197131,14907330,8355711,12369186,1556175].map(je),Al=[2062260,11454440,16744206,16759672,2924588,10018698,14034728,16750742,9725885,12955861,9197131,12885140,14907330,16234194,8355711,13092807,12369186,14408589,1556175,10410725].map(je),Nl=[3750777,5395619,7040719,10264286,6519097,9216594,11915115,13556636,9202993,12426809,15186514,15190932,8666169,11356490,14049643,15177372,8077683,10834324,13528509,14589654].map(je),Gl=[3244733,7057110,10406625,13032431,15095053,16616764,16625259,16634018,3253076,7652470,10607003,13101504,7695281,10394312,12369372,14342891,6513507,9868950,12434877,14277081].map(je);fo.scale.quantile=function(){return ha([],[])},fo.scale.quantize=function(){return fa(0,1,[0,1])},fo.scale.threshold=function(){return pa([.5],[0,1])},fo.scale.identity=function(){return _a([0,1])},fo.svg={},fo.svg.arc=function(){function e(){var e=Math.max(0,+n.apply(this,arguments)),c=Math.max(0,+i.apply(this,arguments)),d=o.apply(this,arguments)-Uo,u=s.apply(this,arguments)-Uo,h=Math.abs(u-d),f=d>u?0:1;if(c<e&&(p=c,c=e,e=p),h>=Ho)return t(c,f)+(e?t(e,1-f):"")+"Z";var p,_,g,m,v,y,b,w,x,k,j,M,C=0,S=0,T=[];if((m=(+l.apply(this,arguments)||0)/2)&&(g=a===Ll?Math.sqrt(e*e+c*c):+a.apply(this,arguments),f||(S*=-1),c&&(S=oe(g/c*Math.sin(m))),e&&(C=oe(g/e*Math.sin(m)))),c){v=c*Math.cos(d+S),y=c*Math.sin(d+S),b=c*Math.cos(u-S),w=c*Math.sin(u-S);var O=Math.abs(u-d-2*S)<=Fo?0:1;if(S&&xa(v,y,b,w)===f^O){var A=(d+u)/2;v=c*Math.cos(A),y=c*Math.sin(A),b=w=null}}else v=y=0;if(e){x=e*Math.cos(u-C),k=e*Math.sin(u-C),j=e*Math.cos(d+C),M=e*Math.sin(d+C);var N=Math.abs(d-u+2*C)<=Fo?0:1;if(C&&xa(x,k,j,M)===1-f^N){var G=(d+u)/2;x=e*Math.cos(G),k=e*Math.sin(G),j=M=null}}else x=k=0;if(h>zo&&(p=Math.min(Math.abs(c-e)/2,+r.apply(this,arguments)))>.001){_=e<c^f?0:1;var L=p,D=p;if(h<Fo){var I=null==j?[x,k]:null==b?[v,y]:En([v,y],[j,M],[b,w],[x,k]),P=v-I[0],R=y-I[1],V=b-I[0],E=w-I[1],z=1/Math.sin(Math.acos((P*V+R*E)/(Math.sqrt(P*P+R*R)*Math.sqrt(V*V+E*E)))/2),q=Math.sqrt(I[0]*I[0]+I[1]*I[1]);D=Math.min(p,(e-q)/(z-1)),L=Math.min(p,(c-q)/(z+1))}if(null!=b){var F=ka(null==j?[x,k]:[j,M],[v,y],c,L,f),$=ka([b,w],[x,k],c,L,f);p===L?T.push("M",F[0],"A",L,",",L," 0 0,",_," ",F[1],"A",c,",",c," 0 ",1-f^xa(F[1][0],F[1][1],$[1][0],$[1][1]),",",f," ",$[1],"A",L,",",L," 0 0,",_," ",$[0]):T.push("M",F[0],"A",L,",",L," 0 1,",_," ",$[0])}else T.push("M",v,",",y);if(null!=j){var H=ka([v,y],[j,M],e,-D,f),U=ka([x,k],null==b?[v,y]:[b,w],e,-D,f);p===D?T.push("L",U[0],"A",D,",",D," 0 0,",_," ",U[1],"A",e,",",e," 0 ",f^xa(U[1][0],U[1][1],H[1][0],H[1][1]),",",1-f," ",H[1],"A",D,",",D," 0 0,",_," ",H[0]):T.push("L",U[0],"A",D,",",D," 0 0,",_," ",H[0])}else T.push("L",x,",",k)}else T.push("M",v,",",y),null!=b&&T.push("A",c,",",c," 0 ",O,",",f," ",b,",",w),T.push("L",x,",",k),null!=j&&T.push("A",e,",",e," 0 ",N,",",1-f," ",j,",",M);return T.push("Z"),T.join("")}function t(e,t){return"M0,"+e+"A"+e+","+e+" 0 1,"+t+" 0,"+-e+"A"+e+","+e+" 0 1,"+t+" 0,"+e}var n=ma,i=va,r=ga,a=Ll,o=ya,s=ba,l=wa;return e.innerRadius=function(t){return arguments.length?(n=Ne(t),e):n},e.outerRadius=function(t){return arguments.length?(i=Ne(t),e):i},e.cornerRadius=function(t){return arguments.length?(r=Ne(t),e):r},e.padRadius=function(t){return arguments.length?(a=t==Ll?Ll:Ne(t),e):a},e.startAngle=function(t){return arguments.length?(o=Ne(t),e):o},e.endAngle=function(t){return arguments.length?(s=Ne(t),e):s},e.padAngle=function(t){return arguments.length?(l=Ne(t),e):l},e.centroid=function(){var e=(+n.apply(this,arguments)+ +i.apply(this,arguments))/2,t=(+o.apply(this,arguments)+ +s.apply(this,arguments))/2-Uo;return[Math.cos(t)*e,Math.sin(t)*e]},e};var Ll="auto";fo.svg.line=function(){return ja(k)};var Dl=fo.map({linear:Ma,"linear-closed":Ca,step:Sa,"step-before":Ta,"step-after":Oa,basis:Ia,"basis-open":Pa,"basis-closed":Ra,bundle:Va,cardinal:Ga,"cardinal-open":Aa,"cardinal-closed":Na,monotone:Ha});Dl.forEach(function(e,t){t.key=e,t.closed=/-closed$/.test(e)});var Il=[0,2/3,1/3,0],Pl=[0,1/3,2/3,0],Rl=[0,1/6,2/3,1/6];fo.svg.line.radial=function(){var e=ja(Ua);return e.radius=e.x,delete e.x,e.angle=e.y,delete e.y,e},Ta.reverse=Oa,Oa.reverse=Ta,fo.svg.area=function(){return Ja(k)},fo.svg.area.radial=function(){var e=Ja(Ua);return e.radius=e.x,delete e.x,e.innerRadius=e.x0,delete e.x0,e.outerRadius=e.x1,delete e.x1,e.angle=e.y,delete e.y,e.startAngle=e.y0,delete e.y0,e.endAngle=e.y1,delete e.y1,e},fo.svg.chord=function(){function e(e,s){var l=t(this,a,e,s),c=t(this,o,e,s);return"M"+l.p0+i(l.r,l.p1,l.a1-l.a0)+(n(l,c)?r(l.r,l.p1,l.r,l.p0):r(l.r,l.p1,c.r,c.p0)+i(c.r,c.p1,c.a1-c.a0)+r(c.r,c.p1,l.r,l.p0))+"Z"}function t(e,t,n,i){var r=t.call(e,n,i),a=s.call(e,r,i),o=l.call(e,r,i)-Uo,d=c.call(e,r,i)-Uo;return{r:a,a0:o,a1:d,p0:[a*Math.cos(o),a*Math.sin(o)],p1:[a*Math.cos(d),a*Math.sin(d)]}}function n(e,t){return e.a0==t.a0&&e.a1==t.a1}function i(e,t,n){return"A"+e+","+e+" 0 "+ +(n>Fo)+",1 "+t}function r(e,t,n,i){return"Q 0,0 "+i}var a=jn,o=Mn,s=Ba,l=ya,c=ba;return e.radius=function(t){return arguments.length?(s=Ne(t),e):s},e.source=function(t){return arguments.length?(a=Ne(t),e):a},e.target=function(t){return arguments.length?(o=Ne(t),e):o},e.startAngle=function(t){return arguments.length?(l=Ne(t),e):l},e.endAngle=function(t){return arguments.length?(c=Ne(t),e):c},e},fo.svg.diagonal=function(){function e(e,r){var a=t.call(this,e,r),o=n.call(this,e,r),s=(a.y+o.y)/2,l=[a,{x:a.x,y:s},{x:o.x,y:s},o];return l=l.map(i),"M"+l[0]+"C"+l[1]+" "+l[2]+" "+l[3]}var t=jn,n=Mn,i=Wa;return e.source=function(n){return arguments.length?(t=Ne(n),e):t},e.target=function(t){return arguments.length?(n=Ne(t),e):n},e.projection=function(t){return arguments.length?(i=t,e):i},e},fo.svg.diagonal.radial=function(){var e=fo.svg.diagonal(),t=Wa,n=e.projection;return e.projection=function(e){return arguments.length?n(Ya(t=e)):t},e},fo.svg.symbol=function(){function e(e,i){return(Vl.get(t.call(this,e,i))||Qa)(n.call(this,e,i))}var t=Xa,n=Ka;return e.type=function(n){return arguments.length?(t=Ne(n),e):t},e.size=function(t){return arguments.length?(n=Ne(t),e):n},e};var Vl=fo.map({circle:Qa,cross:function(e){var t=Math.sqrt(e/5)/2;return"M"+-3*t+","+-t+"H"+-t+"V"+-3*t+"H"+t+"V"+-t+"H"+3*t+"V"+t+"H"+t+"V"+3*t+"H"+-t+"V"+t+"H"+-3*t+"Z"},diamond:function(e){var t=Math.sqrt(e/(2*zl)),n=t*zl;return"M0,"+-t+"L"+n+",0 0,"+t+" "+-n+",0Z"},square:function(e){var t=Math.sqrt(e)/2;return"M"+-t+","+-t+"L"+t+","+-t+" "+t+","+t+" "+-t+","+t+"Z"},"triangle-down":function(e){var t=Math.sqrt(e/El),n=t*El/2;return"M0,"+n+"L"+t+","+-n+" "+-t+","+-n+"Z"},"triangle-up":function(e){var t=Math.sqrt(e/El),n=t*El/2;return"M0,"+-n+"L"+t+","+n+" "+-t+","+n+"Z"}});fo.svg.symbolTypes=Vl.keys();var El=Math.sqrt(3),zl=Math.tan(30*Jo);Go.transition=function(e){for(var t,n,i=ql||++Ul,r=io(e),a=[],o=Fl||{time:Date.now(),ease:Ni,delay:0,duration:250},s=-1,l=this.length;++s<l;){a.push(t=[]);for(var c=this[s],d=-1,u=c.length;++d<u;)(n=c[d])&&ro(n,d,r,i,o),t.push(n)}return eo(a,r,i)},Go.interrupt=function(e){return this.each(null==e?$l:Za(io(e)))};var ql,Fl,$l=Za(io()),Hl=[],Ul=0;Hl.call=Go.call,Hl.empty=Go.empty,Hl.node=Go.node,Hl.size=Go.size,fo.transition=function(e,t){return e&&e.transition?ql?e.transition(t):e:fo.selection().transition(e)},fo.transition.prototype=Hl,Hl.select=function(e){var t,n,i,r=this.id,a=this.namespace,o=[];e=L(e);for(var s=-1,l=this.length;++s<l;){o.push(t=[]);for(var c=this[s],d=-1,u=c.length;++d<u;)(i=c[d])&&(n=e.call(i,i.__data__,d,s))?("__data__"in i&&(n.__data__=i.__data__),ro(n,d,a,r,i[a][r]),t.push(n)):t.push(null)}return eo(o,a,r)},Hl.selectAll=function(e){var t,n,i,r,a,o=this.id,s=this.namespace,l=[];e=D(e);for(var c=-1,d=this.length;++c<d;)for(var u=this[c],h=-1,f=u.length;++h<f;)if(i=u[h]){a=i[s][o],n=e.call(i,i.__data__,h,c),l.push(t=[]);for(var p=-1,_=n.length;++p<_;)(r=n[p])&&ro(r,p,s,o,a),t.push(r)}return eo(l,s,o)},Hl.filter=function(e){var t,n,i,r=[];"function"!=typeof e&&(e=J(e));for(var a=0,o=this.length;a<o;a++){r.push(t=[]);for(var n=this[a],s=0,l=n.length;s<l;s++)(i=n[s])&&e.call(i,i.__data__,s,a)&&t.push(i)}return eo(r,this.namespace,this.id)},Hl.tween=function(e,t){var n=this.id,i=this.namespace;return arguments.length<2?this.node()[i][n].tween.get(e):W(this,null==t?function(t){t[i][n].tween.remove(e)}:function(r){r[i][n].tween.set(e,t)})},Hl.attr=function(e,t){function n(){this.removeAttribute(s)}function i(){this.removeAttributeNS(s.space,s.local)}function r(e){return null==e?n:(e+="",function(){var t,n=this.getAttribute(s);return n!==e&&(t=o(n,e),function(e){this.setAttribute(s,t(e))})})}function a(e){return null==e?i:(e+="",function(){var t,n=this.getAttributeNS(s.space,s.local);return n!==e&&(t=o(n,e),function(e){this.setAttributeNS(s.space,s.local,t(e))})})}if(arguments.length<2){for(t in e)this.attr(t,e[t]);return this}var o="transform"==e?Qi:ji,s=fo.ns.qualify(e);return to(this,"attr."+e,t,s.local?a:r)},Hl.attrTween=function(e,t){function n(e,n){var i=t.call(this,e,n,this.getAttribute(r));return i&&function(e){this.setAttribute(r,i(e))}}function i(e,n){var i=t.call(this,e,n,this.getAttributeNS(r.space,r.local));return i&&function(e){this.setAttributeNS(r.space,r.local,i(e))}}var r=fo.ns.qualify(e);return this.tween("attr."+e,r.local?i:n)},Hl.style=function(e,t,n){function i(){this.style.removeProperty(e)}function r(t){return null==t?i:(t+="",function(){var i,r=o(this).getComputedStyle(this,null).getPropertyValue(e);return r!==t&&(i=ji(r,t),function(t){this.style.setProperty(e,i(t),n)})})}var a=arguments.length;if(a<3){if("string"!=typeof e){a<2&&(t="");for(n in e)this.style(n,e[n],t);return this}n=""}return to(this,"style."+e,t,r)},Hl.styleTween=function(e,t,n){function i(i,r){var a=t.call(this,i,r,o(this).getComputedStyle(this,null).getPropertyValue(e));return a&&function(t){this.style.setProperty(e,a(t),n)}}return arguments.length<3&&(n=""),this.tween("style."+e,i)},Hl.text=function(e){return to(this,"text",e,no)},Hl.remove=function(){var e=this.namespace;return this.each("end.transition",function(){var t;this[e].count<2&&(t=this.parentNode)&&t.removeChild(this)})},Hl.ease=function(e){var t=this.id,n=this.namespace;return arguments.length<1?this.node()[n][t].ease:("function"!=typeof e&&(e=fo.ease.apply(fo,arguments)),W(this,function(i){i[n][t].ease=e}))},Hl.delay=function(e){var t=this.id,n=this.namespace;return arguments.length<1?this.node()[n][t].delay:W(this,"function"==typeof e?function(i,r,a){i[n][t].delay=+e.call(i,i.__data__,r,a)}:(e=+e,function(i){i[n][t].delay=e}))},Hl.duration=function(e){var t=this.id,n=this.namespace;return arguments.length<1?this.node()[n][t].duration:W(this,"function"==typeof e?function(i,r,a){i[n][t].duration=Math.max(1,e.call(i,i.__data__,r,a))}:(e=Math.max(1,e),function(i){i[n][t].duration=e}))},Hl.each=function(e,t){var n=this.id,i=this.namespace;if(arguments.length<2){var r=Fl,a=ql;try{ql=n,W(this,function(t,r,a){Fl=t[i][n],e.call(t,t.__data__,r,a)})}finally{Fl=r,ql=a}}else W(this,function(r){var a=r[i][n];(a.event||(a.event=fo.dispatch("start","end","interrupt"))).on(e,t)});return this},Hl.transition=function(){for(var e,t,n,i,r=this.id,a=++Ul,o=this.namespace,s=[],l=0,c=this.length;l<c;l++){s.push(e=[]);for(var t=this[l],d=0,u=t.length;d<u;d++)(n=t[d])&&(i=n[o][r],ro(n,d,o,a,{time:i.time,ease:i.ease,delay:i.delay+i.duration,duration:i.duration})),e.push(n)}return eo(s,o,a)},fo.svg.axis=function(){function e(e){e.each(function(){var e,c=fo.select(this),d=this.__chart__||n,u=this.__chart__=n.copy(),h=null==l?u.ticks?u.ticks.apply(u,s):u.domain():l,f=null==t?u.tickFormat?u.tickFormat.apply(u,s):k:t,p=c.selectAll(".tick").data(h,u),_=p.enter().insert("g",".domain").attr("class","tick").style("opacity",zo),g=fo.transition(p.exit()).style("opacity",zo).remove(),m=fo.transition(p.order()).style("opacity",1),v=Math.max(r,0)+o,y=Yr(u),b=c.selectAll(".domain").data([0]),w=(b.enter().append("path").attr("class","domain"),fo.transition(b));_.append("line"),_.append("text");var x,j,M,C,S=_.select("line"),T=m.select("line"),O=p.select("text").text(f),A=_.select("text"),N=m.select("text"),G="top"===i||"left"===i?-1:1;if("bottom"===i||"top"===i?(e=ao,x="x",M="y",j="x2",C="y2",O.attr("dy",G<0?"0em":".71em").style("text-anchor","middle"),w.attr("d","M"+y[0]+","+G*a+"V0H"+y[1]+"V"+G*a)):(e=oo,x="y",M="x",j="y2",C="x2",O.attr("dy",".32em").style("text-anchor",G<0?"end":"start"),w.attr("d","M"+G*a+","+y[0]+"H0V"+y[1]+"H"+G*a)),S.attr(C,G*r),A.attr(M,G*v),T.attr(j,0).attr(C,G*r),N.attr(x,0).attr(M,G*v),u.rangeBand){var L=u,D=L.rangeBand()/2;d=u=function(e){return L(e)+D}}else d.rangeBand?d=u:g.call(e,u,d);_.call(e,d,u),m.call(e,u,u)})}var t,n=fo.scale.linear(),i=Jl,r=6,a=6,o=3,s=[10],l=null;return e.scale=function(t){return arguments.length?(n=t,e):n},e.orient=function(t){return arguments.length?(i=t in Bl?t+"":Jl,e):i},e.ticks=function(){return arguments.length?(s=_o(arguments),e):s},e.tickValues=function(t){return arguments.length?(l=t,e):l},e.tickFormat=function(n){return arguments.length?(t=n,e):t},e.tickSize=function(t){var n=arguments.length;return n?(r=+t,a=+arguments[n-1],e):r},e.innerTickSize=function(t){return arguments.length?(r=+t,e):r},e.outerTickSize=function(t){return arguments.length?(a=+t,e):a},e.tickPadding=function(t){return arguments.length?(o=+t,e):o},e.tickSubdivide=function(){return arguments.length&&e},e};var Jl="bottom",Bl={top:1,right:1,bottom:1,left:1};fo.svg.brush=function(){function e(a){a.each(function(){var a=fo.select(this).style("pointer-events","all").style("-webkit-tap-highlight-color","rgba(0,0,0,0)").on("mousedown.brush",r).on("touchstart.brush",r),o=a.selectAll(".background").data([0]);o.enter().append("rect").attr("class","background").style("visibility","hidden").style("cursor","crosshair"),a.selectAll(".extent").data([0]).enter().append("rect").attr("class","extent").style("cursor","move");var s=a.selectAll(".resize").data(_,k);s.exit().remove(),s.enter().append("g").attr("class",function(e){return"resize "+e}).style("cursor",function(e){return Wl[e]}).append("rect").attr("x",function(e){return/[ew]$/.test(e)?-3:null}).attr("y",function(e){return/^[ns]/.test(e)?-3:null}).attr("width",6).attr("height",6).style("visibility","hidden"),s.style("display",e.empty()?"none":null);var l,u=fo.transition(a),h=fo.transition(o);c&&(l=Yr(c),h.attr("x",l[0]).attr("width",l[1]-l[0]),n(u)),d&&(l=Yr(d),h.attr("y",l[0]).attr("height",l[1]-l[0]),i(u)),t(u)})}function t(e){e.selectAll(".resize").attr("transform",function(e){return"translate("+u[+/e$/.test(e)]+","+h[+/^s/.test(e)]+")"})}function n(e){e.select(".extent").attr("x",u[0]),e.selectAll(".extent,.n>rect,.s>rect").attr("width",u[1]-u[0])}function i(e){e.select(".extent").attr("y",h[0]),e.selectAll(".extent,.e>rect,.w>rect").attr("height",h[1]-h[0])}function r(){function r(){32==fo.event.keyCode&&(T||(y=null,N[0]-=u[1],N[1]-=h[1],T=2),O())}function _(){32==fo.event.keyCode&&2==T&&(N[0]+=u[1],N[1]+=h[1],T=0,O())}function g(){var e=fo.mouse(w),r=!1;b&&(e[0]+=b[0],e[1]+=b[1]),T||(fo.event.altKey?(y||(y=[(u[0]+u[1])/2,(h[0]+h[1])/2]),N[0]=u[+(e[0]<y[0])],N[1]=h[+(e[1]<y[1])]):y=null),C&&m(e,c,0)&&(n(j),r=!0),S&&m(e,d,1)&&(i(j),r=!0),r&&(t(j),k({type:"brush",mode:T?"move":"resize"}))}function m(e,t,n){var i,r,o=Yr(t),l=o[0],c=o[1],d=N[n],_=n?h:u,g=_[1]-_[0];if(T&&(l-=d,c-=g+d),i=(n?p:f)?Math.max(l,Math.min(c,e[n])):e[n],T?r=(i+=d)+g:(y&&(d=Math.max(l,Math.min(c,2*y[n]-i))),d<i?(r=i,i=d):r=d),_[0]!=i||_[1]!=r)return n?s=null:a=null,_[0]=i,_[1]=r,!0}function v(){g(),j.style("pointer-events","all").selectAll(".resize").style("display",e.empty()?"none":null),fo.select("body").style("cursor",null),G.on("mousemove.brush",null).on("mouseup.brush",null).on("touchmove.brush",null).on("touchend.brush",null).on("keydown.brush",null).on("keyup.brush",null),A(),k({type:"brushend"})}var y,b,w=this,x=fo.select(fo.event.target),k=l.of(w,arguments),j=fo.select(w),M=x.datum(),C=!/^(n|s)$/.test(M)&&c,S=!/^(e|w)$/.test(M)&&d,T=x.classed("extent"),A=ee(w),N=fo.mouse(w),G=fo.select(o(w)).on("keydown.brush",r).on("keyup.brush",_);if(fo.event.changedTouches?G.on("touchmove.brush",g).on("touchend.brush",v):G.on("mousemove.brush",g).on("mouseup.brush",v),j.interrupt().selectAll("*").interrupt(),T)N[0]=u[0]-N[0],N[1]=h[0]-N[1];else if(M){var L=+/w$/.test(M),D=+/^n/.test(M);b=[u[1-L]-N[0],h[1-D]-N[1]],N[0]=u[L],N[1]=h[D]}else fo.event.altKey&&(y=N.slice());j.style("pointer-events","none").selectAll(".resize").style("display",null),fo.select("body").style("cursor",x.style("cursor")),k({type:"brushstart"}),g()}var a,s,l=N(e,"brushstart","brush","brushend"),c=null,d=null,u=[0,0],h=[0,0],f=!0,p=!0,_=Yl[0];return e.event=function(e){e.each(function(){var e=l.of(this,arguments),t={x:u,y:h,i:a,j:s},n=this.__chart__||t;this.__chart__=t,ql?fo.select(this).transition().each("start.brush",function(){a=n.i,s=n.j,u=n.x,h=n.y,e({type:"brushstart"})}).tween("brush:brush",function(){var n=Mi(u,t.x),i=Mi(h,t.y);return a=s=null,function(r){u=t.x=n(r),h=t.y=i(r),e({type:"brush",mode:"resize"})}}).each("end.brush",function(){a=t.i,s=t.j,e({type:"brush",mode:"resize"}),e({type:"brushend"})}):(e({type:"brushstart"}),e({type:"brush",mode:"resize"}),e({type:"brushend"}))})},e.x=function(t){return arguments.length?(c=t,_=Yl[!c<<1|!d],e):c},e.y=function(t){return arguments.length?(d=t,_=Yl[!c<<1|!d],e):d},e.clamp=function(t){return arguments.length?(c&&d?(f=!!t[0],p=!!t[1]):c?f=!!t:d&&(p=!!t),e):c&&d?[f,p]:c?f:d?p:null},e.extent=function(t){var n,i,r,o,l;return arguments.length?(c&&(n=t[0],i=t[1],d&&(n=n[0],i=i[0]),a=[n,i],c.invert&&(n=c(n),i=c(i)),i<n&&(l=n,n=i,i=l),n==u[0]&&i==u[1]||(u=[n,i])),d&&(r=t[0],o=t[1],c&&(r=r[1],o=o[1]),s=[r,o],d.invert&&(r=d(r),o=d(o)),o<r&&(l=r,r=o,o=l),r==h[0]&&o==h[1]||(h=[r,o])),e):(c&&(a?(n=a[0],i=a[1]):(n=u[0],i=u[1],c.invert&&(n=c.invert(n),i=c.invert(i)),i<n&&(l=n,n=i,i=l))),d&&(s?(r=s[0],o=s[1]):(r=h[0],o=h[1],d.invert&&(r=d.invert(r),o=d.invert(o)),o<r&&(l=r,r=o,o=l))),c&&d?[[n,r],[i,o]]:c?[n,i]:d&&[r,o])},e.clear=function(){return e.empty()||(u=[0,0],h=[0,0],a=s=null),e},e.empty=function(){return!!c&&u[0]==u[1]||!!d&&h[0]==h[1]},fo.rebind(e,l,"on")};var Wl={n:"ns-resize",e:"ew-resize",s:"ns-resize",w:"ew-resize",nw:"nwse-resize",ne:"nesw-resize",se:"nwse-resize",sw:"nesw-resize"},Yl=[["n","e","s","w","nw","ne","se","sw"],["e","w"],["n","s"],[]],Kl=_s.format=ws.timeFormat,Xl=Kl.utc,Ql=Xl("%Y-%m-%dT%H:%M:%S.%LZ");Kl.iso=Date.prototype.toISOString&&+new Date("2000-01-01T00:00:00.000Z")?so:Ql,so.parse=function(e){var t=new Date(e);return isNaN(t)?null:t},so.toString=Ql.toString,_s.second=Ue(function(e){return new gs(1e3*Math.floor(e/1e3))},function(e,t){e.setTime(e.getTime()+1e3*Math.floor(t))},function(e){return e.getSeconds()}),_s.seconds=_s.second.range,_s.seconds.utc=_s.second.utc.range,_s.minute=Ue(function(e){return new gs(6e4*Math.floor(e/6e4))},function(e,t){e.setTime(e.getTime()+6e4*Math.floor(t))},function(e){return e.getMinutes()}),_s.minutes=_s.minute.range,_s.minutes.utc=_s.minute.utc.range,_s.hour=Ue(function(e){var t=e.getTimezoneOffset()/60;return new gs(36e5*(Math.floor(e/36e5-t)+t))},function(e,t){e.setTime(e.getTime()+36e5*Math.floor(t))},function(e){return e.getHours()}),_s.hours=_s.hour.range,_s.hours.utc=_s.hour.utc.range,_s.month=Ue(function(e){return e=_s.day(e),e.setDate(1),e},function(e,t){e.setMonth(e.getMonth()+t)},function(e){return e.getMonth()}),_s.months=_s.month.range,_s.months.utc=_s.month.utc.range;var Zl=[1e3,5e3,15e3,3e4,6e4,3e5,9e5,18e5,36e5,108e5,216e5,432e5,864e5,1728e5,6048e5,2592e6,7776e6,31536e6],ec=[[_s.second,1],[_s.second,5],[_s.second,15],[_s.second,30],[_s.minute,1],[_s.minute,5],[_s.minute,15],[_s.minute,30],[_s.hour,1],[_s.hour,3],[_s.hour,6],[_s.hour,12],[_s.day,1],[_s.day,2],[_s.week,1],[_s.month,1],[_s.month,3],[_s.year,1]],tc=Kl.multi([[".%L",function(e){return e.getMilliseconds()}],[":%S",function(e){return e.getSeconds()}],["%I:%M",function(e){return e.getMinutes()}],["%I %p",function(e){return e.getHours()}],["%a %d",function(e){return e.getDay()&&1!=e.getDate()}],["%b %d",function(e){return 1!=e.getDate()}],["%B",function(e){return e.getMonth()}],["%Y",Dt]]),nc={range:function(e,t,n){return fo.range(Math.ceil(e/n)*n,+t,n).map(co)},floor:k,ceil:k};ec.year=_s.year,_s.scale=function(){return lo(fo.scale.linear(),ec,tc)};var ic=ec.map(function(e){return[e[0].utc,e[1]]}),rc=Xl.multi([[".%L",function(e){return e.getUTCMilliseconds()}],[":%S",function(e){return e.getUTCSeconds()}],["%I:%M",function(e){return e.getUTCMinutes()}],["%I %p",function(e){return e.getUTCHours()}],["%a %d",function(e){return e.getUTCDay()&&1!=e.getUTCDate()}],["%b %d",function(e){return 1!=e.getUTCDate()}],["%B",function(e){return e.getUTCMonth()}],["%Y",Dt]]);ic.year=_s.year.utc,_s.scale.utc=function(){return lo(fo.scale.linear(),ic,rc)},fo.text=Ge(function(e){return e.responseText}),fo.json=function(e,t){return Le(e,"application/json",uo,t)},fo.html=function(e,t){return Le(e,"text/html",ho,t)},fo.xml=Ge(function(e){return e.responseXML}),this.d3=fo,i=fo,void 0!==(r="function"==typeof i?i.call(t,n,t,e):i)&&(e.exports=r)}()},311:function(e,t,n){"use strict";(function(e,i){function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var a=n(4),o=(r(a),n(7)),s=r(o),l=n(5),c=r(l),d=n(13),u=(r(d),n(313)),h=r(u),f=n(315),p=r(f),_=n(317),g=r(_),m=n(318),v=r(m),y=n(126),b=r(y),w=n(319),x=r(w),k=n(320),j=r(k),M=e.Router.extend({initialize:function(){this.routesHit=0,e.history.on("route",function(){this.routesHit++},this),this.bind("route",this.trackPageview)},routes:{"":"libraries","page/:show_page":"libraries_page","library/:library_id/permissions":"library_permissions","folders/:folder_id/permissions":"folder_permissions","folders/:id":"folder_content","folders/:id/page/:show_page":"folder_page","folders/:folder_id/datasets/:dataset_id":"dataset_detail","folders/:folder_id/datasets/:dataset_id/permissions":"dataset_permissions","folders/:folder_id/datasets/:dataset_id/versions/:ldda_id":"dataset_version","folders/:folder_id/download/:format":"download","folders/:folder_id/import/:source":"import_datasets"},back:function(){this.routesHit>1?window.history.back():this.navigate("#",{trigger:!0,replace:!0})},trackPageview:function(){var t=e.history.getFragment();/^\//.test(t)||""==t||(t="/"+t),"undefined"!=typeof ga&&ga("send","pageview",Galaxy.root+"library/list"+t)}}),C=c.default.SessionStorageModel.extend({defaults:{with_deleted:!1,without_restricted:!1,sort_order:"asc",sort_by:"name",library_page_size:20,folder_page_size:15}}),S=e.View.extend({libraryToolbarView:null,libraryListView:null,library_router:null,libraryView:null,folderToolbarView:null,folderListView:null,datasetView:null,initialize:function(){window.Galaxy.config.ga_code&&(!function(e,t,n,i,r,a,o){e.GoogleAnalyticsObject=r,e[r]=e[r]||function(){(e[r].q=e[r].q||[]).push(arguments)},e[r].l=1*new Date,a=t.createElement(n),o=t.getElementsByTagName(n)[0],a.async=1,a.src="//www.google-analytics.com/analytics.js",o.parentNode.insertBefore(a,o)}(window,document,"script",0,"ga"),ga("create",window.Galaxy.config.ga_code,"auto"),ga("send","pageview")),Galaxy.libraries=this,this.preferences=new C({id:"global-lib-prefs"}),this.library_router=new M,this.library_router.on("route:libraries",function(){Galaxy.libraries.libraryToolbarView&&Galaxy.libraries.libraryToolbarView.$el.unbind("click"),Galaxy.libraries.libraryToolbarView=new g.default.LibraryToolbarView,Galaxy.libraries.libraryListView=new p.default.LibraryListView}),this.library_router.on("route:libraries_page",function(e){null===Galaxy.libraries.libraryToolbarView?(Galaxy.libraries.libraryToolbarView=new g.default.LibraryToolbarView,Galaxy.libraries.libraryListView=new p.default.LibraryListView({show_page:e})):Galaxy.libraries.libraryListView.render({show_page:e})}),this.library_router.on("route:folder_content",function(e){Galaxy.libraries.folderToolbarView&&Galaxy.libraries.folderToolbarView.$el.unbind("click"),Galaxy.libraries.folderToolbarView=new v.default.FolderToolbarView({id:e}),Galaxy.libraries.folderListView=new h.default.FolderListView({id:e})}),this.library_router.on("route:folder_page",function(e,t){null===Galaxy.libraries.folderToolbarView?(Galaxy.libraries.folderToolbarView=new v.default.FolderToolbarView({id:e}),Galaxy.libraries.folderListView=new h.default.FolderListView({id:e,show_page:t})):Galaxy.libraries.folderListView.render({id:e,show_page:parseInt(t)})}),this.library_router.on("route:download",function(e,t){0===i("#folder_list_body").find(":checked").length?(s.default.info("You must select at least one dataset to download"),Galaxy.libraries.library_router.navigate("folders/"+e,{trigger:!0,replace:!0})):(Galaxy.libraries.folderToolbarView.download(e,t),Galaxy.libraries.library_router.navigate("folders/"+e,{trigger:!1,replace:!0}))}),this.library_router.on("route:dataset_detail",function(e,t){Galaxy.libraries.datasetView&&Galaxy.libraries.datasetView.$el.unbind("click"),Galaxy.libraries.datasetView=new b.default.LibraryDatasetView({id:t,show_version:!1,show_permissions:!1})}),this.library_router.on("route:dataset_version",function(e,t,n){Galaxy.libraries.datasetView&&Galaxy.libraries.datasetView.$el.unbind("click"),Galaxy.libraries.datasetView=new b.default.LibraryDatasetView({id:t,ldda_id:n,show_version:!0})}),this.library_router.on("route:dataset_permissions",function(e,t){Galaxy.libraries.datasetView&&Galaxy.libraries.datasetView.$el.unbind("click"),Galaxy.libraries.datasetView=new b.default.LibraryDatasetView({id:t,show_permissions:!0})}),this.library_router.on("route:library_permissions",function(e){Galaxy.libraries.libraryView&&Galaxy.libraries.libraryView.$el.unbind("click"),Galaxy.libraries.libraryView=new x.default.LibraryView({id:e,show_permissions:!0})}),this.library_router.on("route:folder_permissions",function(e){Galaxy.libraries.folderView&&Galaxy.libraries.folderView.$el.unbind("click"),Galaxy.libraries.folderView=new j.default.FolderView({id:e,show_permissions:!0})}),this.library_router.on("route:import_datasets",function(e,t){Galaxy.libraries.folderToolbarView&&Galaxy.libraries.folderListView?Galaxy.libraries.folderToolbarView.showImportModal({source:t}):(Galaxy.libraries.folderToolbarView=new v.default.FolderToolbarView({id:e}),Galaxy.libraries.folderListView=new h.default.FolderListView({id:e}),Galaxy.libraries.folderToolbarView.showImportModal({source:t}))}),e.history.start({pushState:!1})}});t.default={GalaxyApp:S}}).call(t,n(2),n(0))},312:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(e,t){return function(n,i){return n.get("type")===i.get("type")?n.has(e)||i.has(e)?n.has(e)?i.has(e)?n.get(e).toLowerCase()>i.get(e).toLowerCase()?"asc"===t?1:-1:i.get(e).toLowerCase()>n.get(e).toLowerCase()?"asc"===t?-1:1:0:-1:1:0:"folder"===n.get("type")?-1:1}},r=function(e,t){return function(n,i){return n.get(e).toLowerCase()>i.get(e).toLowerCase()?"asc"===t?1:-1:i.get(e).toLowerCase()>n.get(e).toLowerCase()?"asc"===t?-1:1:0}};t.default={generateFolderComparator:i,generateLibraryComparator:r}},313:function(e,t,n){"use strict";(function(e,i,r){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(7),s=a(o),l=n(13),c=a(l),d=n(314),u=a(d),h=e.View.extend({el:"#folder_items_element",progress:0,progressStep:1,folderContainer:null,current_sort_order:"asc",current_sort_key:"name",events:{"click #select-all-checkboxes":"selectAll","click .dataset_row":"selectClickedRow","click .folder_row":"selectClickedRow","click .sort-folder-name":"sortColumnClicked","click .sort-folder-file_ext":"sortColumnClicked","click .sort-folder-description":"sortColumnClicked","click .sort-folder-state":"sortColumnClicked"},collection:null,defaults:{include_deleted:!1,page_count:null,show_page:null},initialize:function(e){this.options=i.defaults(this.options||{},this.defaults,e),this.modal=null,this.rowViews={},this.collection=new c.default.Folder,this.listenTo(this.collection,"add",this.renderOne),this.listenTo(this.collection,"remove",this.removeOne),this.listenTo(this.collection,"sort",this.rePaint),this.listenTo(this.collection,"reset",this.rePaint),this.fetchFolder()},fetchFolder:function(e){var e=e||{};this.options.include_deleted=e.include_deleted;var t=this;this.folderContainer=new c.default.FolderContainer({id:this.options.id}),this.folderContainer.url=this.folderContainer.attributes.urlRoot+this.options.id+"/contents",this.options.include_deleted&&(this.folderContainer.url=this.folderContainer.url+"?include_deleted=true"),this.folderContainer.fetch({success:function(e){t.folder_container=e,t.render()},error:function(e,t){void 0!==t.responseJSON?s.default.error(t.responseJSON.err_msg+" Click this to go back.","",{onclick:function(){Galaxy.libraries.library_router.back()}}):s.default.error("An error occurred. Click this to go back.","",{onclick:function(){Galaxy.libraries.library_router.back()}})}})},render:function(e){this.options=i.extend(this.options,e);var t=this.templateFolder();r(".tooltip").hide();var n,a=this.folderContainer.attributes.metadata.full_path;if(n=1===a.length?0:a[a.length-2][0],this.$el.html(t({path:this.folderContainer.attributes.metadata.full_path,parent_library_id:this.folderContainer.attributes.metadata.parent_library_id,id:this.options.id,upper_folder_id:n,order:this.current_sort_order})),this.options.dataset_id){var o=i.findWhere(self.rowViews,{id:this.options.dataset_id});o?o.showDatasetDetails():s.default.error("Requested dataset not found. Showing folder instead.")}else(null===this.options.show_page||this.options.show_page<1)&&(this.options.show_page=1),this.paginate();r("#center [data-toggle]").tooltip(),r("#center").css("overflow","auto")},paginate:function(e){this.options=i.extend(this.options,e),(null===this.options.show_page||this.options.show_page<1)&&(this.options.show_page=1),this.options.total_items_count=this.folder_container.get("folder").models.length,this.options.page_count=Math.ceil(this.options.total_items_count/Galaxy.libraries.preferences.get("folder_page_size"));var t=Galaxy.libraries.preferences.get("folder_page_size")*(this.options.show_page-1),n=null;n=this.folder_container.get("folder").models.slice(t,t+Galaxy.libraries.preferences.get("folder_page_size")),this.options.items_shown=n.length,Galaxy.libraries.preferences.get("folder_page_size")*this.options.show_page>this.options.total_items_count+Galaxy.libraries.preferences.get("folder_page_size")&&(n=[]),Galaxy.libraries.folderToolbarView.renderPaginator(this.options),this.collection.reset(n)},rePaint:function(e){this.options=i.extend(this.options,e),this.removeAllRows(),this.renderAll(),this.checkEmptiness()},addAll:function(e){i.each(e,function(e){Galaxy.libraries.folderListView.collection.add(e,{current_sort_order:!1})}),r("#center [data-toggle]").tooltip(),this.checkEmptiness(),this.postRender()},postRender:function(){var e=this.folderContainer.attributes.metadata;e.contains_file_or_folder=void 0!==this.collection.findWhere({type:"file"})||void 0!==this.collection.findWhere({type:"folder"}),Galaxy.libraries.folderToolbarView.configureElements(e)},renderAll:function(){var e=this;i.each(this.collection.models.reverse(),function(t){e.renderOne(t)}),this.postRender()},renderOne:function(e){this.options.contains_file_or_folder=!0,e.set("folder_id",this.id);var t=new u.default.FolderRowView({model:e});this.rowViews[e.get("id")]=t,this.$el.find("#first_folder_item").after(t.el)},removeOne:function(e){this.$el.find("tr").filter(function(){return r(this).data("id")&&r(this).data("id")===e.id}).remove()},removeAllRows:function(){r(".library-row").remove()},checkEmptiness:function(){0===this.$el.find(".dataset_row").length&&0===this.$el.find(".folder_row").length?this.$el.find(".empty-folder-message").show():this.$el.find(".empty-folder-message").hide()},sortColumnClicked:function(e){e.preventDefault(),this.current_sort_order="asc"===this.current_sort_order?"desc":"asc",this.current_sort_key=e.currentTarget.className.replace("sort-folder-",""),this.collection.sortFolder(this.current_sort_key,this.current_sort_order),this.renderSortIcon()},selectAll:function(e){var t=e.target.checked,n=this;r(":checkbox","#folder_list_body").each(function(){this.checked=t;var e=r(this).closest("tr");t?n.makeDarkRow(e):n.makeWhiteRow(e)})},selectClickedRow:function(e){var t,n,i="";t=r(e.target).closest("tr"),"input"===e.target.localName?(i=e.target,n="input"):"td"===e.target.localName&&(i=t.find(":checkbox")[0],n="td"),i.checked?"td"===n?(i.checked="",this.makeWhiteRow(t)):"input"===n&&this.makeDarkRow(t):"td"===n?(i.checked="selected",this.makeDarkRow(t)):"input"===n&&this.makeWhiteRow(t)},makeDarkRow:function(e){e.removeClass("light").addClass("dark"),e.find("a").removeClass("light").addClass("dark"),e.find(".fa-file-o").removeClass("fa-file-o").addClass("fa-file"),e.find(".fa-folder-o").removeClass("fa-folder-o").addClass("fa-folder")},makeWhiteRow:function(e){e.removeClass("dark").addClass("light"),e.find("a").removeClass("dark").addClass("light"),e.find(".fa-file").removeClass("fa-file").addClass("fa-file-o"),e.find(".fa-folder").removeClass("fa-folder").addClass("fa-folder-o")},renderSortIcon:function(){"asc"===this.current_sort_order?(r('[class*="sort-icon"]').removeClass("fa-sort-alpha-desc").removeClass("fa-sort-alpha-asc"),r(".sort-icon-"+this.current_sort_key).addClass("fa-sort-alpha-asc")):r(".sort-icon-"+this.current_sort_key).addClass("fa-sort-alpha-desc")},templateFolder:function(){return i.template(['<ol class="breadcrumb">','<li><a title="Return to the list of libraries" href="#">Libraries</a></li>',"<% _.each(path, function(path_item) { %>","<% if (path_item[0] != id) { %>",'<li><a title="Return to this folder" href="#/folders/<%- path_item[0] %>"><%- path_item[1] %></a> </li> ',"<% } else { %>",'<li class="active"><span title="You are in this folder"><%- path_item[1] %></span></li>',"<% } %>","<% }); %>","</ol>",'<table data-library-id="<%- parent_library_id  %>" class="grid table table-condensed">',"<thead>",'<th class="button_heading"></th>','<th style="text-align: center; width: 20px; " title="Check to select all datasets"><input id="select-all-checkboxes" style="margin: 0;" type="checkbox"></th>','<th><a class="sort-folder-name" title="Click to reverse order" href="#">name</a> <span title="Sorted alphabetically" class="sort-icon-name fa fa-sort-alpha-<%- order %>"></span></th>','<th style="width:20%;"><a class="sort-folder-description" title="Click to reverse order" href="#">description</a> <span title="Sorted alphabetically" class="sort-icon-description fa"></span></th>','<th style="width:5%;"><a class="sort-folder-file_ext" title="Click to reverse order" href="#">data type</a> <span title="Sorted alphabetically" class="sort-icon-file_ext fa"></span></th>','<th style="width:10%;">size</th>','<th style="width:160px;">time updated (UTC)</th>','<th style="width:5%;"><a class="sort-folder-state" title="Click to reverse order" href="#">state</a> <span title="Sorted alphabetically" class="sort-icon-state fa"></span></th>','<th style="width:150px;"></th> ',"</thead>",'<tbody id="folder_list_body">','<tr id="first_folder_item">',"<td>",'<a href="#<% if (upper_folder_id !== 0){ print("folders/" + upper_folder_id)} %>" title="Go to parent folder" class="btn_open_folder btn btn-default btn-xs">..<a>',"</td>","<td></td>","<td></td>","<td></td>","<td></td>","<td></td>","<td></td>","<td></td>","<td></td>","</tr>","</tbody>","</table>",'<div class="empty-folder-message" style="display:none;">',"This folder is either empty or you do not have proper access permissions to see the contents. If you expected something to show up",' please consult the <a href="https://galaxyproject.org/data-libraries/#permissions" target="_blank">library security wikipage</a>',' or visit the <a href="https://biostar.usegalaxy.org/" target="_blank">Galaxy support site</a>.',"</div>"].join(""))}});t.default={FolderListView:h}}).call(t,n(2),n(1),n(0))},314:function(e,t,n){"use strict";(function(e,i,r){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(7),s=a(o),l=n(13),c=a(l),d=n(126),u=a(d),h=e.View.extend({events:{"click .undelete_dataset_btn":"undeleteDataset","click .undelete_folder_btn":"undeleteFolder","click .edit_folder_btn":"startModifications","click .cancel_folder_btn":"cancelModifications","click .save_folder_btn":"saveModifications"},defaults:{type:null,visibility_config:{edit_folder_btn:!1,save_folder_btn:!1,cancel_folder_btn:!1,permission_folder_btn:!1},edit_mode:!1},initialize:function(e){this.options=i.defaults(e||{},this.defaults),this.render(this.options)},render:function(e){this.options=i.extend(this.options,e);var t=this.options.model,n=null;return"folder"===t.get("type")||"LibraryFolder"===t.get("model_class")?(this.options.type="folder",this.prepareButtons(t),n=t.get("deleted")?this.templateRowDeletedFolder():this.templateRowFolder()):"file"===t.get("type")||"LibraryDatasetDatasetAssociation"===t.get("model_class")||"LibraryDataset"===t.get("model_class")?(this.options.type="file",n=t.get("deleted")?this.templateRowDeletedFile():this.templateRowFile()):(Galaxy.emit.error("Unknown library item type found."),Galaxy.emit.error(t.get("type")||t.get("model_class"))),this.setElement(n({content_item:t,edit_mode:this.options.edit_mode,button_config:this.options.visibility_config})),this.$el.show(),this},prepareButtons:function(e){var t=this.options.visibility_config;!1===this.options.edit_mode?(t.save_folder_btn=!1,t.cancel_folder_btn=!1,!0===e.get("deleted")?(t.edit_folder_btn=!1,t.permission_folder_btn=!1):!1===e.get("deleted")&&(t.save_folder_btn=!1,t.cancel_folder_btn=!1,!0===e.get("can_modify")&&(t.edit_folder_btn=!0),!0===e.get("can_manage")&&(t.permission_folder_btn=!0))):!0===this.options.edit_mode&&(t.edit_folder_btn=!1,t.permission_folder_btn=!1,t.save_folder_btn=!0,t.cancel_folder_btn=!0),this.options.visibility_config=t},showDatasetDetails:function(){Galaxy.libraries.datasetView=new u.default.LibraryDatasetView({id:this.id})},undeleteDataset:function(e){r(".tooltip").hide();var t=this,n=r(e.target).closest("tr").data("id"),i=Galaxy.libraries.folderListView.collection.get(n);i.url=i.urlRoot+i.id+"?undelete=true",i.destroy({success:function(e,i){Galaxy.libraries.folderListView.collection.remove(n);var r=new c.default.Item(i);Galaxy.libraries.folderListView.collection.add(r),Galaxy.libraries.folderListView.collection.sortFolder("name","asc"),s.default.success("Dataset undeleted. Click this to see it.","",{onclick:function(){var e=t.model.get("folder_id");window.location=Galaxy.root+"library/list#folders/"+e+"/datasets/"+t.id}})},error:function(e,t){void 0!==t.responseJSON?s.default.error("Dataset was not undeleted. "+t.responseJSON.err_msg):s.default.error("An error occured! Dataset was not undeleted. Please try again.")}})},undeleteFolder:function(e){r(".tooltip").hide();var t=r(e.target).closest("tr").data("id"),n=Galaxy.libraries.folderListView.collection.get(t);n.url=n.urlRoot+n.id+"?undelete=true",n.destroy({success:function(e,n){Galaxy.libraries.folderListView.collection.remove(t);var i=new c.default.FolderAsModel(n);Galaxy.libraries.folderListView.collection.add(i),Galaxy.libraries.folderListView.collection.sortFolder("name","asc"),s.default.success("Folder undeleted.")},error:function(e,t){void 0!==t.responseJSON?s.default.error("Folder was not undeleted. "+t.responseJSON.err_msg):s.default.error("An error occured! Folder was not undeleted. Please try again.")}})},startModifications:function(){this.options.edit_mode=!0,this.repaint()},cancelModifications:function(){this.options.edit_mode=!1,this.repaint()},saveModifications:function(){var e=Galaxy.libraries.folderListView.collection.get(this.$el.data("id")),t=!1,n=this.$el.find(".input_folder_name").val();if(void 0!==n&&n!==e.get("name")){if(!(n.length>2))return void s.default.warning("Folder name has to be at least 3 characters long.");e.set("name",n),t=!0}var i=this.$el.find(".input_folder_description").val();if(void 0!==i&&i!==e.get("description")&&(e.set("description",i),t=!0),t){var r=this;e.save(null,{patch:!0,success:function(e){r.options.edit_mode=!1,r.repaint(e),s.default.success("Changes to folder saved.")},error:function(e,t){void 0!==t.responseJSON?s.default.error(t.responseJSON.err_msg):s.default.error("An error occured while attempting to update the folder.")}})}else this.options.edit_mode=!1,this.repaint(e),s.default.info("Nothing has changed.")},repaint:function(){r(".tooltip").hide();var e=this.$el;this.render(),e.replaceWith(this.$el),this.$el.find("[data-toggle]").tooltip()},templateRowFolder:function(){return i.template(['<tr class="folder_row light library-row" data-id="<%- content_item.id %>">',"<td>",'<span title="Folder" class="fa fa-folder-o"/>',"</td>",'<td style="text-align: center; "><input style="margin: 0;" type="checkbox"></td>',"<% if(!edit_mode) { %>","<td>",'<a href="#folders/<%- content_item.id %>"><%- content_item.get("name") %></a>',"</td>","<td>",'<%- content_item.get("description") %>',"</td>","<% } else if(edit_mode){ %>",'<td><textarea rows="4" class="form-control input_folder_name" placeholder="name" ><%- content_item.get("name") %></textarea></td>','<td><textarea rows="4" class="form-control input_folder_description" placeholder="description" ><%- content_item.get("description") %></textarea></td>',"<% } %>","<td>folder</td>","<td></td>","<td>",'<%= _.escape(content_item.get("update_time")) %>',"</td>","<td></td>","<td>","<% if(edit_mode) { %>",'<button data-toggle="tooltip" data-placement="top" title="Save changes" class="primary-button btn-xs save_folder_btn" type="button" style="<% if(button_config.save_folder_btn === false) { print("display:none;") } %>">','<span class="fa fa-floppy-o"/> Save',"</button>",'<button data-toggle="tooltip" data-placement="top" title="Discard changes" class="primary-button btn-xs cancel_folder_btn" type="button" style="<% if(button_config.cancel_folder_btn === false) { print("display:none;") } %>">','<span class="fa fa-times"/> Cancel',"</button>","<% } else if (!edit_mode){%>",'<button data-toggle="tooltip" data-placement="top" title="Modify \'<%- content_item.get("name") %>\'" class="primary-button btn-xs edit_folder_btn" type="button" style="<% if(button_config.edit_folder_btn === false) { print("display:none;") } %>">','<span class="fa fa-pencil"/> Edit',"</button>",'<a href="#/folders/<%- content_item.id %>/permissions">','<button data-toggle="tooltip" data-placement="top" class="primary-button btn-xs permission_folder_btn" title="Permissions of \'<%- content_item.get("name") %>\'" style="<% if(button_config.permission_folder_btn === false) { print("display:none;") } %>">','<span class="fa fa-group"/> Manage',"</button>","</a>","<% } %>","</td>","</tr>"].join(""))},templateRowFile:function(){return i.template(['<tr class="dataset_row light library-row" data-id="<%- content_item.id %>">',"<td>",'<span title="Dataset" class="fa fa-file-o"/>',"</td>",'<td style="text-align: center; ">','<input style="margin: 0;" type="checkbox">',"</td>","<td>",'<a href="#folders/<%- content_item.get("folder_id") %>/datasets/<%- content_item.id %>" class="library-dataset">','<%- content_item.get("name") %>',"<a>","</td>",'<td><%- content_item.get("message") %></td>','<td><%= _.escape(content_item.get("file_ext")) %></td>','<td><%= _.escape(content_item.get("file_size")) %></td>','<td><%= _.escape(content_item.get("update_time")) %></td>',"<td>",'<% if ( content_item.get("state") !== "ok" ) { %>','<%= _.escape(content_item.get("state")) %>',"<% } %>","</td>","<td>",'<% if (content_item.get("is_unrestricted")) { %>','<span data-toggle="tooltip" data-placement="top" title="Unrestricted dataset" style="color:grey;" class="fa fa-globe fa-lg"/>',"<% } %>",'<% if (content_item.get("is_private")) { %>','<span data-toggle="tooltip" data-placement="top" title="Private dataset" style="color:grey;" class="fa fa-key fa-lg"/>',"<% } %>",'<% if ((content_item.get("is_unrestricted") === false) && (content_item.get("is_private") === false)) { %>','<span data-toggle="tooltip" data-placement="top" title="Restricted dataset" style="color:grey;" class="fa fa-shield fa-lg"/>',"<% } %>",'<% if (content_item.get("can_manage")) { %>','<a href="#folders/<%- content_item.get("folder_id") %>/datasets/<%- content_item.id %>/permissions">','<button data-toggle="tooltip" data-placement="top" class="primary-button btn-xs permissions-dataset-btn" title="Permissions of \'<%- content_item.get("name") %>\'">','<span class="fa fa-group"/> Manage',"</button>","</a>","<% } %>","</td>","</tr>"].join(""))},templateRowDeletedFile:function(){return i.template(['<tr class="active deleted_dataset library-row" data-id="<%- content_item.id %>">',"<td>",'<span title="Dataset" class="fa fa-file-o"/>',"</td>","<td></td>",'<td style="color:grey;">','<%- content_item.get("name") %>',"</td>","<td>",'<%- content_item.get("message") %>',"</td>","<td>",'<%= _.escape(content_item.get("file_ext")) %>',"</td>","<td>",'<%= _.escape(content_item.get("file_size")) %>',"</td>","<td>",'<%= _.escape(content_item.get("update_time")) %>',"</td>","<td>",'<% if ( content_item.get("state") !== "ok" ) { %>','<%= _.escape(content_item.get("state")) %>',"<% } %>","</td>","<td>",'<span data-toggle="tooltip" data-placement="top" title="Marked deleted" style="color:grey;" class="fa fa-ban fa-lg"/>','<button data-toggle="tooltip" data-placement="top" title="Undelete \'<%- content_item.get("name") %>\'" class="primary-button btn-xs undelete_dataset_btn" type="button" style="margin-left:1em;">','<span class="fa fa-unlock"/> Undelete',"</button>","</td>","</tr>"].join(""))},templateRowDeletedFolder:function(){return i.template(['<tr class="active deleted_folder light library-row" data-id="<%- content_item.id %>">',"<td>",'<span title="Folder" class="fa fa-folder-o"/>',"</td>","<td></td>",'<td style="color:grey;">','<%- content_item.get("name") %>',"</td>","<td>",'<%- content_item.get("description") %>',"</td>","<td>","folder","</td>","<td></td>","<td>",'<%= _.escape(content_item.get("update_time")) %>',"</td>","<td></td>","<td>",'<span data-toggle="tooltip" data-placement="top" title="Marked deleted" style="color:grey;" class="fa fa-ban fa-lg"/>','<button data-toggle="tooltip" data-placement="top" title="Undelete \'<%- content_item.get("name") %>\'" class="primary-button btn-xs undelete_folder_btn" type="button" style="margin-left:1em;">','<span class="fa fa-unlock"/> Undelete',"</button>","</td>","</tr>"].join(""))}});t.default={FolderRowView:h}}).call(t,n(2),n(1),n(0))},315:function(e,t,n){"use strict";(function(e,i){function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var a=n(7),o=r(a),s=n(13),l=r(s),c=n(316),d=r(c),u=n(1),h=r(u),f=e.View.extend({el:"#libraries_element",events:{"click .sort-libraries-link":"sort_clicked"},defaults:{page_count:null,show_page:null,all_fetched:!1},initialize:function(e){this.options=h.default.defaults(this.options||{},e,this.defaults);var t=this;this.modal=null,this.collection=new l.default.Libraries,this.collection.url=this.collection.urlRoot+"?deleted=false",this.collection.fetch({success:function(){t.render()},error:function(e,t){void 0!==t.responseJSON?o.default.error(t.responseJSON.err_msg):o.default.error("An error occurred.")}})},render:function(e){this.options=h.default.extend(this.options,e),this.setElement("#libraries_element");var t=this.templateLibraryList(),n=null,r=null,a=function(e){return!0===e.get("public")};if(i(".tooltip").hide(),void 0!==e&&(r=void 0!==e.models?e.models:null),null!==this.collection&&null===r)this.sortLibraries(),n=Galaxy.libraries.preferences.get("with_deleted")?this.collection.models:this.collection.where({deleted:!1}),Galaxy.libraries.preferences.get("without_restricted")&&(n=h.default.filter(n,a));else if(null!==r){if(Galaxy.libraries.preferences.get("with_deleted"))n=r;else{var o=function(e){return!1===e.get("deleted")};n=h.default.filter(r,o)}Galaxy.libraries.preferences.get("without_restricted")&&(n=h.default.filter(n,a))}else n=[];(null===this.options.show_page||this.options.show_page<1)&&(this.options.show_page=1),this.options.total_libraries_count=n.length;var s=Galaxy.libraries.preferences.get("library_page_size")*(this.options.show_page-1);this.options.page_count=Math.ceil(this.options.total_libraries_count/Galaxy.libraries.preferences.get("library_page_size")),this.options.total_libraries_count>0&&s<this.options.total_libraries_count?(n=n.slice(s,s+Galaxy.libraries.preferences.get("library_page_size")),this.options.libraries_shown=n.length,Galaxy.libraries.preferences.get("library_page_size")*this.options.show_page>this.options.total_libraries_count+Galaxy.libraries.preferences.get("library_page_size")&&(n=[]),this.$el.html(t({length:1,order:Galaxy.libraries.preferences.get("sort_order"),search_term:Galaxy.libraries.libraryToolbarView.options.search_term})),Galaxy.libraries.libraryToolbarView.renderPaginator(this.options),this.renderRows(n)):(this.$el.html(t({length:0,order:Galaxy.libraries.preferences.get("sort_order"),search_term:Galaxy.libraries.libraryToolbarView.options.search_term})),Galaxy.libraries.libraryToolbarView.renderPaginator(this.options)),i("#center [data-toggle]").tooltip(),i("#center").css("overflow","auto")},fetchDeleted:function(){if(this.options.all_fetched)this.render();else{var e=this;this.collection.url=this.collection.urlRoot+"?deleted=true",this.collection.fetch({remove:!1,success:function(){e.options.all_fetched=!0,e.render()},error:function(e,t){void 0!==t.responseJSON?o.default.error(t.responseJSON.err_msg):o.default.error("An error occurred.")}})}},renderRows:function(e){for(var t=0;t<e.length;t++){var n=e[t];this.renderOne({library:n})}},renderOne:function(e){var t=e.library,n=new d.default.LibraryRowView(t);this.$el.find("#library_list_body").append(n.el)},sort_clicked:function(){"asc"===Galaxy.libraries.preferences.get("sort_order")?Galaxy.libraries.preferences.set({sort_order:"desc"}):Galaxy.libraries.preferences.set({sort_order:"asc"}),this.render()},sortLibraries:function(){"name"===Galaxy.libraries.preferences.get("sort_by")&&("asc"===Galaxy.libraries.preferences.get("sort_order")?this.collection.sortLibraries("name","asc"):"desc"===Galaxy.libraries.preferences.get("sort_order")&&this.collection.sortLibraries("name","desc"))},searchLibraries:function(e){if(""!==i.trim(e)){var t=null;t=this.collection.search(e),this.options.searching=!0,this.render({models:t,show_page:1})}else this.options.searching=!1,this.render()},templateLibraryList:function(){return h.default.template(['<div class="library_container table-responsive">',"<% if(length === 0) { %>","<% if(search_term.length > 0) { %>","<div>","There are no libraries matching your search. Try different keyword.","</div>","<% } else{ %>","<div>","There are no libraries visible to you here. If you expected some to show up please consult the",' <a href="https://galaxyproject.org/data-libraries/#permissions" target="_blank">library security wikipage</a>',' or visit the <a href="https://biostar.usegalaxy.org/" target="_blank">Galaxy support site</a>.',"</div>","<% }%>","<% } else{ %>",'<table class="grid table table-condensed">',"<thead>",'<th style="width:30%;">','<a class="sort-libraries-link" title="Click to reverse order" href="#">',"name","</a>",'<span title="Sorted alphabetically" class="fa fa-sort-alpha-<%- order %>"/>',"</th>",'<th style="width:22%;">description</th>','<th style="width:22%;">synopsis</th> ','<th style="width:26%;"></th>',"</thead>",'<tbody id="library_list_body">',"</tbody>","</table>","<% }%>","</div>"].join(""))}});t.default={LibraryListView:f}}).call(t,n(2),n(0))},316:function(e,t,n){"use strict";(function(e,i,r){Object.defineProperty(t,"__esModule",{value:!0});var a=n(7),o=function(e){return e&&e.__esModule?e:{default:e}}(a),s=e.View.extend({events:{"click .edit_library_btn":"edit_button_clicked","click .cancel_library_btn":"cancel_library_modification","click .save_library_btn":"save_library_modification","click .delete_library_btn":"delete_library","click .undelete_library_btn":"undelete_library"},edit_mode:!1,element_visibility_config:{upload_library_btn:!1,edit_library_btn:!1,permission_library_btn:!1,save_library_btn:!1,cancel_library_btn:!1,delete_library_btn:!1,undelete_library_btn:!1},initialize:function(e){this.render(e)},render:function(e){void 0===e&&(e=Galaxy.libraries.libraryListView.collection.get(this.$el.data("id"))),this.prepareButtons(e);var t=this.templateRow();return this.setElement(t({library:e,button_config:this.element_visibility_config,edit_mode:this.edit_mode})),this.$el.show(),this},repaint:function(e){i(".tooltip").hide();var t=this.$el;this.render(),t.replaceWith(this.$el),this.$el.find("[data-toggle]").tooltip()},prepareButtons:function(e){var t=this.element_visibility_config;!1===this.edit_mode?(t.save_library_btn=!1,t.cancel_library_btn=!1,t.delete_library_btn=!1,!0===e.get("deleted")?(t.undelete_library_btn=!0,t.upload_library_btn=!1,t.edit_library_btn=!1,t.permission_library_btn=!1):!1===e.get("deleted")&&(t.save_library_btn=!1,t.cancel_library_btn=!1,t.undelete_library_btn=!1,!0===e.get("can_user_add")&&(t.upload_library_btn=!0),!0===e.get("can_user_modify")&&(t.edit_library_btn=!0),!0===e.get("can_user_manage")&&(t.permission_library_btn=!0))):!0===this.edit_mode&&(t.upload_library_btn=!1,t.edit_library_btn=!1,t.permission_library_btn=!1,t.save_library_btn=!0,t.cancel_library_btn=!0,t.delete_library_btn=!0,t.undelete_library_btn=!1),this.element_visibility_config=t},edit_button_clicked:function(){this.edit_mode=!0,this.repaint()},cancel_library_modification:function(){this.edit_mode=!1,this.repaint()},save_library_modification:function(){var e=Galaxy.libraries.libraryListView.collection.get(this.$el.data("id")),t=!1,n=this.$el.find(".input_library_name").val();if(void 0!==n&&n!==e.get("name")){if(!(n.length>2))return void o.default.warning("Library name has to be at least 3 characters long.");e.set("name",n),t=!0}var i=this.$el.find(".input_library_description").val();void 0!==i&&i!==e.get("description")&&(e.set("description",i),t=!0);var r=this.$el.find(".input_library_synopsis").val();if(void 0!==r&&r!==e.get("synopsis")&&(e.set("synopsis",r),t=!0),t){var a=this;e.save(null,{patch:!0,success:function(e){a.edit_mode=!1,a.repaint(e),o.default.success("Changes to library saved.")},error:function(e,t){void 0!==t.responseJSON?o.default.error(t.responseJSON.err_msg):o.default.error("An error occured while attempting to update the library.")}})}else this.edit_mode=!1,this.repaint(e),o.default.info("Nothing has changed.")},delete_library:function(){var e=Galaxy.libraries.libraryListView.collection.get(this.$el.data("id")),t=this;e.destroy({success:function(e){e.set("deleted",!0),Galaxy.libraries.libraryListView.collection.add(e),t.edit_mode=!1,!1===Galaxy.libraries.preferences.get("with_deleted")?(i(".tooltip").hide(),t.repaint(e),t.$el.remove()):!0===Galaxy.libraries.preferences.get("with_deleted")&&t.repaint(e),o.default.success("Library has been marked deleted.")},error:function(e,t){void 0!==t.responseJSON?o.default.error(t.responseJSON.err_msg):o.default.error("An error occured during deleting the library.")}})},undelete_library:function(){var e=Galaxy.libraries.libraryListView.collection.get(this.$el.data("id")),t=this;e.url=e.urlRoot+e.id+"?undelete=true",e.destroy({success:function(e){e.set("deleted",!1),Galaxy.libraries.libraryListView.collection.add(e),t.edit_mode=!1,t.repaint(e),o.default.success("Library has been undeleted.")},error:function(e,t){void 0!==t.responseJSON?o.default.error(t.responseJSON.err_msg):o.default.error("An error occured while undeleting the library.")}})},templateRow:function(){return r.template(['<tr class="<% if(library.get("deleted") === true) { print("active") } %>" style="display:none;" data-id="<%- library.get("id") %>">',"<% if(!edit_mode) { %>",'<% if(library.get("deleted")) { %>','<td style="color:grey;"><%- library.get("name") %></td>',"<% } else { %>",'<td><a href="#folders/<%- library.get("root_folder_id") %>"><%- library.get("name") %></a></td>',"<% } %>",'<% if(library.get("description")) { %>','<% if( (library.get("description")).length> 80 ) { %>','<td data-toggle="tooltip" data-placement="bottom" title="<%= _.escape(library.get("description")) %>"><%= _.escape(library.get("description")).substring(0, 80) + "..." %></td>',"<% } else { %>",'<td><%= _.escape(library.get("description"))%></td>',"<% } %>","<% } else { %>","<td></td>","<% } %>",'<% if(library.get("synopsis")) { %>','<% if( (library.get("synopsis")).length> 120 ) { %>','<td data-toggle="tooltip" data-placement="bottom" title="<%= _.escape(library.get("synopsis")) %>"><%= _.escape(library.get("synopsis")).substring(0, 120) + "..." %></td>',"<% } else { %>",'<td><%= _.escape(library.get("synopsis"))%></td>',"<% } %>","<% } else { %>","<td></td>","<% } %>","<% } else if(edit_mode){ %>",'<td><textarea rows="4" class="form-control input_library_name" placeholder="name" ><%- library.get("name") %></textarea></td>','<td><textarea rows="4" class="form-control input_library_description" placeholder="description" ><%- library.get("description") %></textarea></td>','<td><textarea rows="4" class="form-control input_library_synopsis" placeholder="synopsis" ><%- library.get("synopsis") %></textarea></td>',"<% } %>",'<td class="right-center">','<% if( (library.get("public")) && (library.get("deleted") === false) ) { %>','<span data-toggle="tooltip" data-placement="top" title="Unrestricted library" style="color:grey;" class="fa fa-globe fa-lg"> </span>',"<% }%>",'<button data-toggle="tooltip" data-placement="top" title="Modify \'<%- library.get("name") %>\'" class="primary-button btn-xs edit_library_btn" type="button" style="<% if(button_config.edit_library_btn === false) { print("display:none;") } %>"><span class="fa fa-pencil"></span> Edit</button>','<a href="#library/<%- library.get("id") %>/permissions"><button data-toggle="tooltip" data-placement="top" title="Permissions of \'<%- library.get("name") %>\'" class="primary-button btn-xs permission_library_btn" type="button" style="<% if(button_config.permission_library_btn === false) { print("display:none;") } %>"><span class="fa fa-group"></span> Manage</button></a>','<button data-toggle="tooltip" data-placement="top" title="Save changes" class="primary-button btn-xs save_library_btn" type="button" style="<% if(button_config.save_library_btn === false) { print("display:none;") } %>"><span class="fa fa-floppy-o"></span> Save</button>','<button data-toggle="tooltip" data-placement="top" title="Discard changes" class="primary-button btn-xs cancel_library_btn" type="button" style="<% if(button_config.cancel_library_btn === false) { print("display:none;") } %>"><span class="fa fa-times"></span> Cancel</button>','<button data-toggle="tooltip" data-placement="top" title="Delete \'<%- library.get("name") %>\'" class="primary-button btn-xs delete_library_btn" type="button" style="<% if(button_config.delete_library_btn === false) { print("display:none;") } %>"><span class="fa fa-trash-o"></span> Delete</button>','<span data-toggle="tooltip" data-placement="top" title="Marked deleted" style="color:grey; <% if(button_config.undelete_library_btn === false) { print("display:none;") } %>" class="fa fa-ban fa-lg"></span>','<button data-toggle="tooltip" data-placement="top" title="Undelete \'<%- library.get("name") %>\' " class="primary-button btn-xs undelete_library_btn" type="button" style="<% if(button_config.undelete_library_btn === false) { print("display:none;") } %>"><span class="fa fa-unlock"></span> Undelete</button>',"</td>","</tr>"].join(""))}});t.default={LibraryRowView:s}}).call(t,n(2),n(0),n(1))},317:function(e,t,n){"use strict";(function(e,i,r){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(3),s=a(o),l=n(7),c=a(l),d=n(13),u=a(d),h=e.View.extend({el:"#center",defaults:{search_term:""},events:{"click #create_new_library_btn":"createLibraryFromModal","click #include_deleted_chk":"includeDeletedChecked","click #exclude_restricted_chk":"excludeRestrictedChecked","click .page_size_prompt":"showPageSizePrompt","keyup .library-search-input":"searchLibraries"},initialize:function(e){this.options=i.defaults(this.options||{},e,this.defaults),this.render()},render:function(){var e=this.templateToolBar(),t=!1,n=!0;Galaxy.user&&(t=Galaxy.user.isAdmin(),n=Galaxy.user.isAnonymous()),this.$el.html(e({admin_user:t,anon_user:n})),t&&(this.$el.find("#include_deleted_chk")[0].checked=Galaxy.libraries.preferences.get("with_deleted"),this.$el.find("#exclude_restricted_chk")[0].checked=Galaxy.libraries.preferences.get("without_restricted"))},renderPaginator:function(e){this.options=i.extend(this.options,e);var t=this.templatePaginator();this.$el.find("#library_paginator").html(t({show_page:parseInt(this.options.show_page),page_count:parseInt(this.options.page_count),total_libraries_count:this.options.total_libraries_count,libraries_shown:this.options.libraries_shown,library_page_size:Galaxy.libraries.preferences.get("library_page_size")}))},createLibraryFromModal:function(e){e.preventDefault(),e.stopPropagation();var t=this;this.modal=Galaxy.modal,this.modal.show({closing_events:!0,title:(0,s.default)("Create New Library"),body:this.templateNewLibraryInModal(),buttons:{Create:function(){t.createNewLibrary()},Close:function(){t.modal.hide()}}})},createNewLibrary:function(){var e=this.serializeNewLibrary();if(this.validateNewLibrary(e)){var t=new u.default.Library,n=this;t.save(e,{success:function(e){Galaxy.libraries.libraryListView.collection.add(e),n.modal.hide(),n.clearLibraryModal(),Galaxy.libraries.libraryListView.render(),c.default.success("Library created.")},error:function(e,t){void 0!==t.responseJSON?c.default.error(t.responseJSON.err_msg):c.default.error("An error occured.")}})}else c.default.error("Library's name is missing.");return!1},showPageSizePrompt:function(e){e.preventDefault();var t=prompt("How many libraries per page do you want to see?",Galaxy.libraries.preferences.get("library_page_size"));null!=t&&t==parseInt(t)&&(Galaxy.libraries.preferences.set({library_page_size:parseInt(t)}),Galaxy.libraries.libraryListView.render({show_page:1}))},clearLibraryModal:function(){r("input[name='Name']").val(""),r("input[name='Description']").val(""),r("input[name='Synopsis']").val("")},serializeNewLibrary:function(){return{name:r("input[name='Name']").val(),description:r("input[name='Description']").val(),synopsis:r("input[name='Synopsis']").val()}},validateNewLibrary:function(e){return""!==e.name},includeDeletedChecked:function(e){e.target.checked?(Galaxy.libraries.preferences.set({with_deleted:!0}),Galaxy.libraries.libraryListView.fetchDeleted()):(Galaxy.libraries.preferences.set({with_deleted:!1}),Galaxy.libraries.libraryListView.render())},excludeRestrictedChecked:function(e){e.target.checked?Galaxy.libraries.preferences.set({without_restricted:!0}):Galaxy.libraries.preferences.set({without_restricted:!1}),Galaxy.libraries.libraryListView.render()},searchLibraries:function(e){var t=r(".library-search-input").val();this.options.search_term=t,Galaxy.libraries.libraryListView.searchLibraries(t)},templateToolBar:function(){return i.template(['<div class="library_style_container">','<div id="toolbar_form">','<div id="library_toolbar">','<form class="form-inline" role="form">','<span><strong><a href="#" title="Go to first page">DATA LIBRARIES</a></strong></span>','<span id="library_paginator" class="library-paginator">',"</span>",'<div class="form-group toolbar-item">','<input type="text" class="form-control library-search-input" placeholder="Search" size="30">',"</div>","<% if(admin_user === true) { %>",'<div class="checkbox toolbar-item" style="height: 20px;">',"<label>",'<input id="include_deleted_chk" type="checkbox">',"include deleted ","</input>","</label>","<label>",'<input id="exclude_restricted_chk" type="checkbox">',"exclude restricted","</input>","</label>","</div>",'<span class="toolbar-item" data-toggle="tooltip" data-placement="top" title="Create New Library">','<button id="create_new_library_btn" class="primary-button btn-xs" type="button"><span class="fa fa-plus"></span> New Library</button>',"</span>","<% } %>",'<span class="help-button" data-toggle="tooltip" data-placement="top" title="See this screen annotated">','<a href="https://galaxyproject.org/data-libraries/screen/list-of-libraries/" target="_blank">','<button class="primary-button" type="button"><span class="fa fa-question-circle"></span> Help</button>',"</a>","</span>","</form>","</div>","</div>",'<div id="libraries_element">',"</div>","</div>"].join(""))},templatePaginator:function(){return i.template(['<ul class="pagination pagination-sm">',"<% if ( ( show_page - 1 ) > 0 ) { %>","<% if ( ( show_page - 1 ) > page_count ) { %>",'<li><a href="#page/1"><span class="fa fa-angle-double-left"></span></a></li>','<li class="disabled"><a href="#page/<% print( show_page ) %>"><% print( show_page - 1 ) %></a></li>',"<% } else { %>",'<li><a href="#page/1"><span class="fa fa-angle-double-left"></span></a></li>','<li><a href="#page/<% print( show_page - 1 ) %>"><% print( show_page - 1 ) %></a></li>',"<% } %>","<% } else { %>",'<li class="disabled"><a href="#page/1"><span class="fa fa-angle-double-left"></span></a></li>','<li class="disabled"><a href="#page/<% print( show_page ) %>"><% print( show_page - 1 ) %></a></li>',"<% } %>",'<li class="active">','<a href="#page/<% print( show_page ) %>"><% print( show_page ) %></a>',"</li>","<% if ( ( show_page ) < page_count ) { %>",'<li><a href="#page/<% print( show_page + 1 ) %>"><% print( show_page + 1 ) %></a></li>','<li><a href="#page/<% print( page_count ) %>"><span class="fa fa-angle-double-right"></span></a></li>',"<% } else { %>",'<li class="disabled"><a href="#page/<% print( show_page  ) %>"><% print( show_page + 1 ) %></a></li>','<li class="disabled"><a href="#page/<% print( page_count ) %>"><span class="fa fa-angle-double-right"></span></a></li>',"<% } %>","</ul>","<span>",' <%- libraries_shown %> libraries shown <a href="" data-toggle="tooltip" data-placement="top" title="currently <%- library_page_size %> per page" class="page_size_prompt">(change)</a>',"</span>","<span>"," <%- total_libraries_count %> total","</span>"].join(""))},templateNewLibraryInModal:function(){return i.template(['<div id="new_library_modal">',"<form>",'<input type="text" name="Name" value="" placeholder="Name" autofocus>','<input type="text" name="Description" value="" placeholder="Description">','<input type="text" name="Synopsis" value="" placeholder="Synopsis">',"</form>","</div>"].join(""))}});t.default={LibraryToolbarView:h}}).call(t,n(2),n(1),n(0))},318:function(e,t,n){"use strict";(function(e,i,r,a){function o(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var s=n(3),l=o(s),c=n(4),d=o(c),u=n(7),h=o(u),f=n(13),p=o(f),_=n(10),g=o(_);n(127);var m=e.View.extend({el:"#center",events:{"click #toolbtn_create_folder":"createFolderFromModal","click #toolbtn_bulk_import":"modalBulkImport","click #include_deleted_datasets_chk":"checkIncludeDeleted","click #toolbtn_bulk_delete":"deleteSelectedItems","click .toolbtn-show-locinfo":"showLocInfo","click .page_size_prompt":"showPageSizePrompt"},defaults:{can_add_library_item:!1,contains_file_or_folder:!1,chain_call_control:{total_number:0,failed_number:0},disabled_jstree_element:"folders"},modal:null,jstree:null,histories:null,select_genome:null,select_extension:null,list_extensions:[],auto:{id:"auto",text:"Auto-detect",description:"This system will try to detect the file type automatically. If your file is not detected properly as one of the known formats, it most likely means that it has some format problems (e.g., different number of columns on different rows). You can still coerce the system to set your data to the format you think it should be. You can also upload compressed files, which will automatically be decompressed."},list_genomes:[],initialize:function(e){this.options=i.defaults(e||{},this.defaults),this.fetchExtAndGenomes(),this.render()},render:function(e){this.options=i.extend(this.options,e);var t=this.templateToolBar(),n={id:this.options.id,is_admin:!1,is_anonym:!0,mutiple_add_dataset_options:!1};Galaxy.user&&(n.is_admin=Galaxy.user.isAdmin(),n.is_anonym=Galaxy.user.isAnonymous(),null===Galaxy.config.user_library_import_dir&&!1===Galaxy.config.allow_library_path_paste&&null===Galaxy.config.library_import_dir||(n.mutiple_add_dataset_options=!0)),this.$el.html(t(n))},renderPaginator:function(e){this.options=i.extend(this.options,e);var t=this.templatePaginator();r("body").find(".folder-paginator").html(t({id:this.options.id,show_page:parseInt(this.options.show_page),page_count:parseInt(this.options.page_count),total_items_count:this.options.total_items_count,items_shown:this.options.items_shown,folder_page_size:Galaxy.libraries.preferences.get("folder_page_size")}))},configureElements:function(e){this.options=i.extend(this.options,e),!0===this.options.can_add_library_item?r(".add-library-items").show():r(".add-library-items").hide(),!0===this.options.contains_file_or_folder&&Galaxy.user?Galaxy.user.isAnonymous()?(r(".dataset-manipulation").show(),r(".logged-dataset-manipulation").hide()):(r(".logged-dataset-manipulation").show(),r(".dataset-manipulation").show()):(r(".logged-dataset-manipulation").hide(),r(".dataset-manipulation").hide()),this.$el.find("[data-toggle]").tooltip()},createFolderFromModal:function(e){e.preventDefault(),e.stopPropagation();var t=this,n=this.templateNewFolderInModal();this.modal=Galaxy.modal,this.modal.show({closing_events:!0,title:(0,l.default)("Create New Folder"),body:n(),buttons:{Create:function(){t.create_new_folder_event()},Close:function(){Galaxy.modal.hide()}}})},create_new_folder_event:function(){var t=this.serialize_new_folder();if(this.validate_new_folder(t)){var n,i=new p.default.FolderAsModel,r=e.history.fragment.split("/");n=r.indexOf("page")>-1?r[r.length-3]:r[r.length-1],i.url=i.urlRoot+n,i.save(t,{success:function(e){Galaxy.modal.hide(),h.default.success("Folder created."),e.set({type:"folder"}),Galaxy.libraries.folderListView.collection.add(e)},error:function(e,t){Galaxy.modal.hide(),void 0!==t.responseJSON?h.default.error(t.responseJSON.err_msg):h.default.error("An error occurred.")}})}else h.default.error("Folder's name is missing.");return!1},serialize_new_folder:function(){return{name:r("input[name='Name']").val(),description:r("input[name='Description']").val()}},validate_new_folder:function(e){return""!==e.name},modalBulkImport:function(){if(0===this.findCheckedRows().length)h.default.info("You must select some datasets first.");else{var e=this;this.histories=new p.default.GalaxyHistories,this.histories.fetch().done(function(){var t=e.templateBulkImportInModal();e.modal=Galaxy.modal,e.modal.show({closing_events:!0,title:(0,l.default)("Import into History"),body:t({histories:e.histories.models}),buttons:{Import:function(){e.importAllIntoHistory()},Close:function(){Galaxy.modal.hide()}}})}).fail(function(e,t){void 0!==t.responseJSON?h.default.error(t.responseJSON.err_msg):h.default.error("An error occurred.")})}},importAllIntoHistory:function(){this.modal.disableButton("Import");var e=this.modal.$("input[name=history_name]").val(),t=this;if(""!==e)r.post(Galaxy.root+"api/histories",{name:e}).done(function(e){t.options.last_used_history_id=e.id,t.processImportToHistory(e.id,e.name)}).fail(function(e,t,n){h.default.error("An error occurred.")}).always(function(){t.modal.enableButton("Import")});else{var n=r("select[name=dataset_import_bulk] option:selected").val();this.options.last_used_history_id=n;var i=r("select[name=dataset_import_bulk] option:selected").text();this.processImportToHistory(n,i),this.modal.enableButton("Import")}},processImportToHistory:function(e,t){var n=[],i=[];this.findCheckedRows().each(function(){var e=r(this).closest("tr").data("id");"F"==e.substring(0,1)?i.push(e):n.push(e)});for(var o=[],s=n.length-1;s>=0;s--){var l=n[s],c=new p.default.HistoryItem;c.url=c.urlRoot+e+"/contents",c.content=l,c.source="library",o.push(c)}for(var s=i.length-1;s>=0;s--){var d=i[s],c=new p.default.HistoryItem;c.url=c.urlRoot+e+"/contents",c.content=d,c.source="library_folder",o.push(c)}this.initChainCallControl({length:o.length,action:"to_history",history_name:t}),a.getJSON(Galaxy.root+"history/set_as_current?id="+e),this.chainCallImportingIntoHistory(o,t)},updateProgress:function(){this.progress+=this.progressStep,r(".progress-bar-import").width(Math.round(this.progress)+"%");var e=Math.round(this.progress)+"% Complete";r(".completion_span").text(e)},download:function(e,t){var n=[],i=[];this.findCheckedRows().each(function(){var e=r(this).closest("tr").data("id");"F"==e.substring(0,1)?i.push(e):n.push(e)});var a=Galaxy.root+"api/libraries/datasets/download/"+t,o={ld_ids:n,folder_ids:i};this.processDownload(a,o,"get")},processDownload:function(e,t,n){if(e&&t){t="string"==typeof t?t:r.param(t);var i="";r.each(t.split("&"),function(){var e=this.split("=");i+='<input type="hidden" name="'+e[0]+'" value="'+e[1]+'" />'}),r('<form action="'+e+'" method="'+(n||"post")+'">'+i+"</form>").appendTo("body").submit().remove(),h.default.info("Your download will begin soon.")}else h.default.error("An error occurred.")},addFilesFromHistoryModal:function(){this.histories=new p.default.GalaxyHistories;var e=this;this.histories.fetch().done(function(){e.modal=Galaxy.modal;var t=e.templateAddFilesFromHistory();e.modal.show({closing_events:!0,title:(0,l.default)("Adding datasets from your history"),body:t({histories:e.histories.models}),buttons:{Add:function(){e.addAllDatasetsFromHistory()},Close:function(){Galaxy.modal.hide()}},closing_callback:function(){Galaxy.libraries.library_router.navigate("folders/"+e.id,{trigger:!0})}}),e.fetchAndDisplayHistoryContents(e.histories.models[0].id),r("#dataset_add_bulk").change(function(t){e.fetchAndDisplayHistoryContents(t.target.value)})}).fail(function(e,t){void 0!==t.responseJSON?h.default.error(t.responseJSON.err_msg):h.default.error("An error occurred.")})},importFilesFromPathModal:function(){var e=this;this.modal=Galaxy.modal;var t=this.templateImportPathModal();this.modal.show({closing_events:!0,title:(0,l.default)("Please enter paths to import"),body:t({}),buttons:{Import:function(){e.importFromPathsClicked(e)},Close:function(){Galaxy.modal.hide()}},closing_callback:function(){Galaxy.libraries.library_router.navigate("folders/"+e.id,{trigger:!0})}}),this.renderSelectBoxes()},fetchExtAndGenomes:function(){var e=this;d.default.get({url:Galaxy.root+"api/datatypes?extension_only=False",success:function(t){e.list_extensions=[];for(var n in t)e.list_extensions.push({id:t[n].extension,text:t[n].extension,description:t[n].description,description_url:t[n].description_url});e.list_extensions.sort(function(e,t){return e.id>t.id?1:e.id<t.id?-1:0}),e.list_extensions.unshift(e.auto)},cache:!0}),d.default.get({url:Galaxy.root+"api/genomes",success:function(t){e.list_genomes=[];for(var n in t)e.list_genomes.push({id:t[n][1],text:t[n][0]});e.list_genomes.sort(function(e,t){return e.id>t.id?1:e.id<t.id?-1:0})},cache:!0})},renderSelectBoxes:function(){var e=this;this.select_genome=new g.default.View({css:"library-genome-select",data:e.list_genomes,container:Galaxy.modal.$el.find("#library_genome_select"),value:"?"}),this.select_extension=new g.default.View({css:"library-extension-select",data:e.list_extensions,container:Galaxy.modal.$el.find("#library_extension_select"),value:"auto"})},importFilesFromGalaxyFolderModal:function(e){var t=this,n=this.templateBrowserModal();this.modal=Galaxy.modal,this.modal.show({closing_events:!0,title:(0,l.default)("Please select folders or files"),body:n({}),buttons:{Import:function(){t.importFromJstreePath(t,e)},Close:function(){Galaxy.modal.hide()}},closing_callback:function(){Galaxy.libraries.library_router.navigate("folders/"+t.id,{trigger:!0})}}),r(".libimport-select-all").bind("click",function(){r("#jstree_browser").jstree("check_all")}),r(".libimport-select-none").bind("click",function(){r("#jstree_browser").jstree("uncheck_all")}),this.renderSelectBoxes(),e.disabled_jstree_element="folders",this.renderJstree(e),r("input[type=radio]").change(function(n){"jstree-disable-folders"===n.target.value?(e.disabled_jstree_element="folders",t.renderJstree(e),r(".jstree-folders-message").hide(),r(".jstree-preserve-structure").hide(),r(".jstree-files-message").show()):"jstree-disable-files"===n.target.value&&(r(".jstree-files-message").hide(),r(".jstree-folders-message").show(),r(".jstree-preserve-structure").show(),e.disabled_jstree_element="files",t.renderJstree(e))})},renderJstree:function(e){this.options=i.extend(this.options,e);var t=e.source||"userdir",n=this.options.disabled_jstree_element;this.jstree=new p.default.Jstree,this.jstree.url=this.jstree.urlRoot+"?target="+t+"&format=jstree&disable="+n,this.jstree.fetch({success:function(e,t){r("#jstree_browser").jstree("destroy"),r("#jstree_browser").jstree({core:{data:e},plugins:["types","checkbox"],types:{folder:{icon:"jstree-folder"},file:{icon:"jstree-file"}},checkbox:{three_state:!1}})},error:function(e,t){void 0!==t.responseJSON?404001===t.responseJSON.err_code?h.default.warning(t.responseJSON.err_msg):h.default.error(t.responseJSON.err_msg):h.default.error("An error occurred.")}})},importFromPathsClicked:function(){var e=this.modal.$el.find(".preserve-checkbox").is(":checked"),t=this.modal.$el.find(".link-checkbox").is(":checked"),n=this.modal.$el.find(".spacetab-checkbox").is(":checked"),i=this.modal.$el.find(".posix-checkbox").is(":checked"),a=this.modal.$el.find(".tag-files").is(":checked"),o=this.select_extension.value(),s=this.select_genome.value(),l=r("textarea#import_paths").val(),c=[];if(l){this.modal.disableButton("Import"),l=l.split("\n");for(var d=l.length-1;d>=0;d--){var u=l[d].trim();0!==u.length&&c.push(u)}this.initChainCallControl({length:c.length,action:"adding_datasets"}),this.chainCallImportingFolders({paths:c,preserve_dirs:e,link_data:t,space_to_tab:n,to_posix_lines:i,source:"admin_path",file_type:o,tag_using_filenames:a,dbkey:s})}else h.default.info("Please enter a path relative to Galaxy root.")},initChainCallControl:function(e){var t;switch(e.action){case"adding_datasets":t=this.templateAddingDatasetsProgressBar(),this.modal.$el.find(".modal-body").html(t({folder_name:this.options.folder_name}));break;case"deleting_datasets":t=this.templateDeletingItemsProgressBar(),this.modal.$el.find(".modal-body").html(t());break;case"to_history":t=this.templateImportIntoHistoryProgressBar(),this.modal.$el.find(".modal-body").html(t({history_name:e.history_name}));break;default:Galaxy.emit.error("Wrong action specified.","datalibs")}this.progress=0,this.progressStep=100/e.length,this.options.chain_call_control.total_number=e.length,this.options.chain_call_control.failed_number=0},importFromJstreePath:function(e,t){var n=r("#jstree_browser").jstree().get_selected(!0),a=i.filter(n,function(e){return 0==e.state.disabled}),o=this.modal.$el.find(".preserve-checkbox").is(":checked"),s=this.modal.$el.find(".link-checkbox").is(":checked"),l=this.modal.$el.find(".spacetab-checkbox").is(":checked"),c=this.modal.$el.find(".posix-checkbox").is(":checked"),d=this.select_extension.value(),u=this.select_genome.value(),f=this.modal.$el.find(".tag-files").is(":checked"),p=a[0].type,_=[];if(a.length<1)h.default.info("Please select some items first.");else{this.modal.disableButton("Import");for(var g=a.length-1;g>=0;g--)void 0!==a[g].li_attr.full_path&&_.push(a[g].li_attr.full_path);if(this.initChainCallControl({length:_.length,action:"adding_datasets"}),"folder"===p){var m=t.source+"_folder";this.chainCallImportingFolders({paths:_,preserve_dirs:o,link_data:s,space_to_tab:l,to_posix_lines:c,source:m,file_type:d,dbkey:u,tag_using_filenames:f})}else if("file"===p){var m=t.source+"_file";this.chainCallImportingUserdirFiles({paths:_,file_type:d,dbkey:u,link_data:s,space_to_tab:l,to_posix_lines:c,source:m,tag_using_filenames:f})}}},fetchAndDisplayHistoryContents:function(e){var t=new p.default.HistoryContents({id:e}),n=this;t.fetch({success:function(t){var i=n.templateHistoryContents();n.histories.get(e).set({contents:t}),n.modal.$el.find("#selected_history_content").html(i({history_contents:t.models.reverse()})),n.modal.$el.find(".history-import-select-all").bind("click",function(){r("#selected_history_content [type=checkbox]").prop("checked",!0)}),n.modal.$el.find(".history-import-unselect-all").bind("click",function(){r("#selected_history_content [type=checkbox]").prop("checked",!1)})},error:function(e,t){void 0!==t.responseJSON?h.default.error(t.responseJSON.err_msg):h.default.error("An error occurred.")}})},addAllDatasetsFromHistory:function(){var e=this.modal.$el.find("#selected_history_content").find(":checked"),t=[],n=[],i=[];if(e.length<1)h.default.info("You must select some datasets first.");else{this.modal.disableButton("Add"),e.each(function(){var e=r(this).closest("li").data("id");if(e){var i=r(this).closest("li").data("name");t.push(e),n.push(i)}});for(var a=t.length-1;a>=0;a--){var o=t[a],s=new p.default.Item;s.url=Galaxy.root+"api/folders/"+this.options.id+"/contents","collection"===n[a]?s.set({from_hdca_id:o}):s.set({from_hda_id:o}),i.push(s)}this.initChainCallControl({length:i.length,action:"adding_datasets"}),this.chainCallAddingHdas(i)}},chainCallImportingIntoHistory:function(e,t){var n=this,i=e.pop();if(void 0===i)return 0===this.options.chain_call_control.failed_number?h.default.success("Selected datasets imported into history. Click this to start analyzing it.","",{onclick:function(){window.location=Galaxy.root}}):this.options.chain_call_control.failed_number===this.options.chain_call_control.total_number?h.default.error("There was an error and no datasets were imported into history."):this.options.chain_call_control.failed_number<this.options.chain_call_control.total_number&&h.default.warning("Some of the datasets could not be imported into history. Click this to see what was imported.","",{onclick:function(){window.location=Galaxy.root}}),Galaxy.modal.hide(),!0;r.when(i.save({content:i.content,source:i.source})).done(function(){n.updateProgress(),n.chainCallImportingIntoHistory(e,t)}).fail(function(){n.options.chain_call_control.failed_number+=1,n.updateProgress(),n.chainCallImportingIntoHistory(e,t)})},chainCallImportingUserdirFiles:function(e){var t=this,n=e.paths.pop();if(void 0===n)return 0===this.options.chain_call_control.failed_number?(h.default.success("Selected files imported into the current folder"),Galaxy.modal.hide()):h.default.error("An error occured."),!0;r.when(r.post(Galaxy.root+"api/libraries/datasets?encoded_folder_id="+t.id+"&source="+e.source+"&path="+n+"&file_type="+e.file_type+"&link_data="+e.link_data+"&space_to_tab="+e.space_to_tab+"&to_posix_lines="+e.to_posix_lines+"&dbkey="+e.dbkey+"&tag_using_filenames="+e.tag_using_filenames)).done(function(n){t.updateProgress(),t.chainCallImportingUserdirFiles(e)}).fail(function(){t.options.chain_call_control.failed_number+=1,t.updateProgress(),t.chainCallImportingUserdirFiles(e)})},chainCallImportingFolders:function(e){var t=this,n=e.paths.pop();if(void 0===n)return 0===this.options.chain_call_control.failed_number?(h.default.success("Selected folders and their contents imported into the current folder."),Galaxy.modal.hide()):h.default.error("An error occured."),!0;r.when(r.post(Galaxy.root+"api/libraries/datasets?encoded_folder_id="+t.id+"&source="+e.source+"&path="+n+"&preserve_dirs="+e.preserve_dirs+"&link_data="+e.link_data+"&to_posix_lines="+e.to_posix_lines+"&space_to_tab="+e.space_to_tab+"&file_type="+e.file_type+"&dbkey="+e.dbkey+"&tag_using_filenames="+e.tag_using_filenames)).done(function(n){t.updateProgress(),t.chainCallImportingFolders(e)}).fail(function(){t.options.chain_call_control.failed_number+=1,t.updateProgress(),t.chainCallImportingFolders(e)})},chainCallAddingHdas:function(e){var t=this;this.added_hdas=new p.default.Folder;var n=e.pop();if(void 0===n)return 0===this.options.chain_call_control.failed_number?h.default.success("Selected datasets from history added to the folder"):this.options.chain_call_control.failed_number===this.options.chain_call_control.total_number?h.default.error("There was an error and no datasets were added to the folder."):this.options.chain_call_control.failed_number<this.options.chain_call_control.total_number&&h.default.warning("Some of the datasets could not be added to the folder"),Galaxy.modal.hide(),this.added_hdas;r.when(n.save({from_hda_id:n.get("from_hda_id")})).done(function(n){Galaxy.libraries.folderListView.collection.add(n),t.updateProgress(),t.chainCallAddingHdas(e)}).fail(function(){t.options.chain_call_control.failed_number+=1,t.updateProgress(),t.chainCallAddingHdas(e)})},chainCallDeletingItems:function(e){var t=this;this.deleted_items=new p.default.Folder;var n=e.pop();if(void 0===n)return 0===this.options.chain_call_control.failed_number?h.default.success("Selected items were deleted."):this.options.chain_call_control.failed_number===this.options.chain_call_control.total_number?h.default.error("There was an error and no items were deleted. Please make sure you have sufficient permissions."):this.options.chain_call_control.failed_number<this.options.chain_call_control.total_number&&h.default.warning("Some of the items could not be deleted. Please make sure you have sufficient permissions."),Galaxy.modal.hide(),this.deleted_items;n.destroy().done(function(i){if(Galaxy.libraries.folderListView.collection.remove(n.id),t.updateProgress(),Galaxy.libraries.folderListView.options.include_deleted){var r=null;"folder"===i.type||"LibraryFolder"===i.model_class?r=new p.default.FolderAsModel(i):"file"===i.type||"LibraryDataset"===i.model_class?r=new p.default.Item(i):(Galaxy.emit.error("Unknown library item type found.","datalibs"),Galaxy.emit.error(i.type||i.model_class,"datalibs")),Galaxy.libraries.folderListView.collection.add(r)}t.chainCallDeletingItems(e)}).fail(function(){t.options.chain_call_control.failed_number+=1,t.updateProgress(),t.chainCallDeletingItems(e)})},checkIncludeDeleted:function(e){e.target.checked?Galaxy.libraries.folderListView.fetchFolder({include_deleted:!0}):Galaxy.libraries.folderListView.fetchFolder({include_deleted:!1})},deleteSelectedItems:function(){var e=[],t=[],n=this.findCheckedRows();if(0===n.length)h.default.info("You must select at least one item for deletion.");else{var i=this.templateDeletingItemsProgressBar();this.modal=Galaxy.modal,this.modal.show({closing_events:!0,title:(0,l.default)("Deleting selected items"),body:i({}),buttons:{Close:function(){Galaxy.modal.hide()}}}),this.options.chain_call_control.total_number=0,this.options.chain_call_control.failed_number=0,n.each(function(){var n=r(this).closest("tr").data("id");void 0!==n&&("F"==n.substring(0,1)?t.push(n):e.push(n))});var a=e.length+t.length;this.progressStep=100/a,this.progress=0;for(var o=[],s=e.length-1;s>=0;s--){var c=new p.default.Item({id:e[s]});o.push(c)}for(var s=t.length-1;s>=0;s--){var d=new p.default.FolderAsModel({id:t[s]});o.push(d)}this.options.chain_call_control.total_number=a,this.chainCallDeletingItems(o)}},showLocInfo:function(){var e=null,t=this;null!==Galaxy.libraries.libraryListView?(e=Galaxy.libraries.libraryListView.collection.get(this.options.parent_library_id),this.showLocInfoModal(e)):(e=new p.default.Library({id:this.options.parent_library_id}),e.fetch({success:function(){t.showLocInfoModal(e)},error:function(e,t){void 0!==t.responseJSON?h.default.error(t.responseJSON.err_msg):h.default.error("An error occurred.")}}))},showLocInfoModal:function(e){var t=this,n=this.templateLocInfoInModal();this.modal=Galaxy.modal,this.modal.show({closing_events:!0,title:(0,l.default)("Location Details"),body:n({library:e,options:t.options}),buttons:{Close:function(){Galaxy.modal.hide()}}})},showImportModal:function(e){switch(e.source){case"history":this.addFilesFromHistoryModal();break;case"importdir":this.importFilesFromGalaxyFolderModal({source:"importdir"});break;case"path":this.importFilesFromPathModal();break;case"userdir":this.importFilesFromGalaxyFolderModal({source:"userdir"});break;default:Galaxy.libraries.library_router.back(),h.default.error("Invalid import source.")}},showPageSizePrompt:function(e){e.preventDefault();var t=prompt("How many items per page do you want to see?",Galaxy.libraries.preferences.get("folder_page_size"));null!=t&&t==parseInt(t)&&(Galaxy.libraries.preferences.set({folder_page_size:parseInt(t)}),Galaxy.libraries.folderListView.render({id:this.options.id,show_page:1}))},findCheckedRows:function(){return r("#folder_list_body").find(":checked")},templateToolBar:function(){return i.template(['<div class="library_style_container">','<div id="library_toolbar">','<form class="form-inline" role="form">',"<span><strong>DATA LIBRARIES</strong></span>",'<span class="library-paginator folder-paginator"></span>','<div class="checkbox toolbar-item logged-dataset-manipulation" style="height: 20px; display:none;">',"<label>",'<input id="include_deleted_datasets_chk" type="checkbox">include deleted</input>',"</label>","</div>",'<button style="display:none;" data-toggle="tooltip" data-placement="top" title="Create New Folder" id="toolbtn_create_folder" class="btn btn-default primary-button add-library-items toolbar-item" type="button">','<span class="fa fa-plus"></span><span class="fa fa-folder"></span>',"</button>","<% if(mutiple_add_dataset_options) { %>",'<div class="btn-group add-library-items" style="display:none;">','<button title="Add Datasets to Current Folder" id="" type="button" class="primary-button dropdown-toggle" data-toggle="dropdown">','<span class="fa fa-plus"></span><span class="fa fa-file"></span><span class="caret"></span>',"</button>",'<ul class="dropdown-menu" role="menu">','<li><a href="#folders/<%= id %>/import/history"> from History</a></li>',"<% if(Galaxy.config.user_library_import_dir !== null) { %>",'<li><a href="#folders/<%= id %>/import/userdir"> from User Directory</a></li>',"<% } %>","<% if(Galaxy.config.allow_library_path_paste) { %>",'<li class="divider"></li>','<li class="dropdown-header">Admins only</li>',"<% if(Galaxy.config.library_import_dir !== null) { %>",'<li><a href="#folders/<%= id %>/import/importdir">from Import Directory</a></li>',"<% } %>","<% if(Galaxy.config.allow_library_path_paste) { %>",'<li><a href="#folders/<%= id %>/import/path">from Path</a></li>',"<% } %>","<% } %>","</ul>","</div>","<% } else { %>",'<a  data-placement="top" title="Add Datasets to Current Folder" style="display:none;" class="btn btn-default add-library-items" href="#folders/<%= id %>/import/history" role="button">','<span class="fa fa-plus"></span><span class="fa fa-file"></span>',"</a>","<% } %>",'<button data-toggle="tooltip" data-placement="top" title="Import selected datasets into history" id="toolbtn_bulk_import" class="primary-button dataset-manipulation" style="margin-left: 0.5em; display:none;" type="button">','<span class="fa fa-book"></span>',"&nbsp;to History","</button>",'<div class="btn-group dataset-manipulation" style="margin-left: 0.5em; display:none; ">','<button title="Download selected items as archive" type="button" class="primary-button dropdown-toggle" data-toggle="dropdown">','<span class="fa fa-download"></span> Download <span class="caret"></span>',"</button>",'<ul class="dropdown-menu" role="menu">','<li><a href="#/folders/<%= id %>/download/tgz">.tar.gz</a></li>','<li><a href="#/folders/<%= id %>/download/tbz">.tar.bz</a></li>','<li><a href="#/folders/<%= id %>/download/zip">.zip</a></li>',"</ul>","</div>",'<button data-toggle="tooltip" data-placement="top" title="Mark selected items deleted" id="toolbtn_bulk_delete" class="primary-button logged-dataset-manipulation" style="margin-left: 0.5em; display:none; " type="button">','<span class="fa fa-times"></span> Delete</button>','<button data-id="<%- id %>" data-toggle="tooltip" data-placement="top" title="Show location details" class="primary-button toolbtn-show-locinfo" style="margin-left: 0.5em;" type="button">','<span class="fa fa-info-circle"></span>',"&nbsp;Details","</button>",'<span class="help-button" data-toggle="tooltip" data-placement="top" title="See this screen annotated">','<a href="https://galaxyproject.org/data-libraries/screen/folder-contents/" target="_blank">','<button class="primary-button" type="button">','<span class="fa fa-question-circle"></span>',"&nbsp;Help","</button>","</a>","</span>","</div>","</form>",'<div id="folder_items_element">',"</div>",'<div class="folder-paginator paginator-bottom"></div>',"</div>"].join(""))},templateLocInfoInModal:function(){return i.template(["<div>",'<table class="grid table table-condensed">',"<thead>",'<th style="width: 25%;">library</th>',"<th></th>","</thead>","<tbody>","<tr>","<td>name</td>",'<td><%- library.get("name") %></td>',"</tr>",'<% if(library.get("description") !== "") { %>',"<tr>","<td>description</td>",'<td><%- library.get("description") %></td>',"</tr>","<% } %>",'<% if(library.get("synopsis") !== "") { %>',"<tr>","<td>synopsis</td>",'<td><%- library.get("synopsis") %></td>',"</tr>","<% } %>",'<% if(library.get("create_time_pretty") !== "") { %>',"<tr>","<td>created</td>",'<td><span title="<%- library.get("create_time") %>"><%- library.get("create_time_pretty") %></span></td>',"</tr>","<% } %>","<tr>","<td>id</td>",'<td><%- library.get("id") %></td>',"</tr>","</tbody>","</table>",'<table class="grid table table-condensed">',"<thead>",'<th style="width: 25%;">folder</th>',"<th></th>","</thead>","<tbody>","<tr>","<td>name</td>","<td><%- options.folder_name %></td>","</tr>",'<% if(options.folder_description !== "") { %>',"<tr>","<td>description</td>","<td><%- options.folder_description %></td>","</tr>","<% } %>","<tr>","<td>id</td>","<td><%- options.id %></td>","</tr>","</tbody>","</table>","</div>"].join(""))},templateNewFolderInModal:function(){return i.template(['<div id="new_folder_modal">',"<form>",'<input type="text" name="Name" value="" placeholder="Name" autofocus>','<input type="text" name="Description" value="" placeholder="Description">',"</form>","</div>"].join(""))},templateBulkImportInModal:function(){return i.template(["<div>",'<div class="library-modal-item">',"Select history: ",'<select id="dataset_import_bulk" name="dataset_import_bulk" style="width:50%; margin-bottom: 1em; " autofocus>',"<% _.each(histories, function(history) { %>",'<option value="<%= _.escape(history.get("id")) %>"><%= _.escape(history.get("name")) %></option>',"<% }); %>","</select>","</div>",'<div class="library-modal-item">',"or create new: ",'<input type="text" name="history_name" value="" placeholder="name of the new history" style="width:50%;">',"</input>","</div>","</div>"].join(""))},templateImportIntoHistoryProgressBar:function(){return i.template(['<div class="import_text">',"Importing selected items to history <b><%= _.escape(history_name) %></b>","</div>",'<div class="progress">','<div class="progress-bar progress-bar-import" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 00%;">','<span class="completion_span">0% Complete</span>',"</div>","</div>"].join(""))},templateAddingDatasetsProgressBar:function(){return i.template(['<div class="import_text">',"Adding selected datasets to library folder <b><%= _.escape(folder_name) %></b>","</div>",'<div class="progress">','<div class="progress-bar progress-bar-import" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 00%;">','<span class="completion_span">0% Complete</span>',"</div>","</div>"].join(""))},templateDeletingItemsProgressBar:function(){return i.template(['<div class="import_text">',"</div>",'<div class="progress">','<div class="progress-bar progress-bar-import" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 00%;">','<span class="completion_span">0% Complete</span>',"</div>","</div>"].join(""))},templateBrowserModal:function(){return i.template(['<div id="file_browser_modal">','<div class="alert alert-info jstree-files-message">All files you select will be imported into the current folder ignoring their folder structure.</div>','<div class="alert alert-info jstree-folders-message" style="display:none;">All files within the selected folders and their subfolders will be imported into the current folder.</div>','<div style="margin-bottom:1em;">','<label title="Switch to selecting files" class="radio-inline import-type-switch">','<input type="radio" name="jstree-radio" value="jstree-disable-folders" checked="checked"> Choose Files',"</label>",'<label title="Switch to selecting folders" class="radio-inline import-type-switch">','<input type="radio" name="jstree-radio" value="jstree-disable-files"> Choose Folders',"</label>","</div>",'<div style="margin-bottom:1em;">','<label class="checkbox-inline jstree-preserve-structure" style="display:none;">','<input class="preserve-checkbox" type="checkbox" value="preserve_directory_structure">',"Preserve directory structure","</label>",'<label class="checkbox-inline">','<input class="link-checkbox" type="checkbox" value="link_files">',"Link files instead of copying","</label>",'<label class="checkbox-inline">','<input class="posix-checkbox" type="checkbox" value="to_posix_lines" checked="checked">',"Convert line endings to POSIX","</label>",'<label class="checkbox-inline">','<input class="spacetab-checkbox" type="checkbox" value="space_to_tab">',"Convert spaces to tabs","</label>","</div>",'<button title="Select all files" type="button" class="button primary-button libimport-select-all">',"Select all","</button>",'<button title="Select no files" type="button" class="button primary-button libimport-select-none">',"Unselect all","</button>","<hr />",'<div id="jstree_browser">',"</div>","<hr />","<p>You can set extension type and genome for all imported datasets at once:</p>","<div>",'Type: <span id="library_extension_select" class="library-extension-select" />','Genome: <span id="library_genome_select" class="library-genome-select" />',"</div>","<br>","<div>",'<label class="checkbox-inline tag-files">',"Tag datasets based on file names",'<input class="tag-files" type="checkbox" value="tag_using_filenames">',"</label>","</div>","</div>"].join(""))},templateImportPathModal:function(){return i.template(['<div id="file_browser_modal">','<div class="alert alert-info jstree-folders-message">All files within the given folders and their subfolders will be imported into the current folder.</div>','<div style="margin-bottom: 0.5em;">','<label class="checkbox-inline">','<input class="preserve-checkbox" type="checkbox" value="preserve_directory_structure">',"Preserve directory structure","</label>",'<label class="checkbox-inline">','<input class="link-checkbox" type="checkbox" value="link_files">',"Link files instead of copying","</label>","<br>",'<label class="checkbox-inline">','<input class="posix-checkbox" type="checkbox" value="to_posix_lines" checked="checked">',"Convert line endings to POSIX","</label>",'<label class="checkbox-inline">','<input class="spacetab-checkbox" type="checkbox" value="space_to_tab">',"Convert spaces to tabs","</label>","</div>",'<textarea id="import_paths" class="form-control" rows="5" placeholder="Absolute paths (or paths relative to Galaxy root) separated by newline" autofocus></textarea>',"<hr />","<p>You can set extension type and genome for all imported datasets at once:</p>","<div>",'Type: <span id="library_extension_select" class="library-extension-select" />','Genome: <span id="library_genome_select" class="library-genome-select" />',"</div>","<div>",'<label class="checkbox-inline tag-files">',"Tag datasets based on file names",'<input class="tag-files" type="checkbox" value="tag_using_filenames">',"</label>","</div>","</div>"].join(""))},templateAddFilesFromHistory:function(){return i.template(['<div id="add_files_modal">',"<div>","1.&nbsp;Select history:&nbsp;",'<select id="dataset_add_bulk" name="dataset_add_bulk" style="width:66%; "> ',"<% _.each(histories, function(history) { %>",'<option value="<%= _.escape(history.get("id")) %>"><%= _.escape(history.get("name")) %></option>',"<% }); %>","</select>","</div>","<br/>",'<div id="selected_history_content">',"</div>","</div>"].join(""))},templateHistoryContents:function(){return i.template(["<p>2.&nbsp;Choose the datasets to import:</p>","<div>",'<button title="Select all datasets" type="button" class="button primary-button history-import-select-all">',"Select all","</button>",'<button title="Select all datasets" type="button" class="button primary-button history-import-unselect-all">',"Unselect all","</button>","</div>","<br>","<ul>","<% _.each(history_contents, function(history_item) { %>",'<% if (history_item.get("deleted") != true ) { %>','<% var item_name = history_item.get("name") %>','<% if (history_item.get("type") === "collection") { %>','<% var collection_type = history_item.get("collection_type") %>','<% if (collection_type === "list") { %>','<li data-id="<%= _.escape(history_item.get("id")) %>" data-name="<%= _.escape(history_item.get("type")) %>">',"<label>",'<label title="<%= _.escape(item_name) %>">','<input style="margin: 0;" type="checkbox"> <%= _.escape(history_item.get("hid")) %>: ','<%= item_name.length > 75 ? _.escape("...".concat(item_name.substr(-75))) : _.escape(item_name) %> (Dataset Collection)',"</label>","</li>","<% } else { %>",'<li><input style="margin: 0;" type="checkbox" onclick="return false;" disabled="disabled">','<span title="You can convert this collection into a collection of type list using the Collection Tools">','<%= _.escape(history_item.get("hid")) %>: ','<%= item_name.length > 75 ? _.escape("...".concat(item_name.substr(-75))) : _.escape(item_name) %> (Dataset Collection of type <%= _.escape(collection_type) %> not supported.)',"</span>","</li>","<% } %>",'<% } else if (history_item.get("visible") === true && history_item.get("state") === "ok") { %>','<li data-id="<%= _.escape(history_item.get("id")) %>" data-name="<%= _.escape(history_item.get("type")) %>">','<label title="<%= _.escape(item_name) %>">','<input style="margin: 0;" type="checkbox"> <%= _.escape(history_item.get("hid")) %>: ','<%= item_name.length > 75 ? _.escape("...".concat(item_name.substr(-75))) : _.escape(item_name) %>',"</label>","</li>","<% } %>","<% } %>","<% }); %>","</ul>"].join(""))},templatePaginator:function(){return i.template(['<ul class="pagination pagination-sm">',"<% if ( ( show_page - 1 ) > 0 ) { %>","<% if ( ( show_page - 1 ) > page_count ) { %>",'<li><a href="#folders/<%= id %>/page/1"><span class="fa fa-angle-double-left"></span></a></li>','<li class="disabled"><a href="#folders/<%= id %>/page/<% print( show_page ) %>"><% print( show_page - 1 ) %></a></li>',"<% } else { %>",'<li><a href="#folders/<%= id %>/page/1"><span class="fa fa-angle-double-left"></span></a></li>','<li><a href="#folders/<%= id %>/page/<% print( show_page - 1 ) %>"><% print( show_page - 1 ) %></a></li>',"<% } %>","<% } else { %>",'<li class="disabled"><a href="#folders/<%= id %>/page/1"><span class="fa fa-angle-double-left"></span></a></li>','<li class="disabled"><a href="#folders/<%= id %>/page/<% print( show_page ) %>"><% print( show_page - 1 ) %></a></li>',"<% } %>",'<li class="active">','<a href="#folders/<%= id %>/page/<% print( show_page ) %>"><% print( show_page ) %></a>',"</li>","<% if ( ( show_page ) < page_count ) { %>",'<li><a href="#folders/<%= id %>/page/<% print( show_page + 1 ) %>"><% print( show_page + 1 ) %></a></li>','<li><a href="#folders/<%= id %>/page/<% print( page_count ) %>"><span class="fa fa-angle-double-right"></span></a></li>',"<% } else { %>",'<li class="disabled"><a href="#folders/<%= id %>/page/<% print( show_page  ) %>"><% print( show_page + 1 ) %></a></li>','<li class="disabled"><a href="#folders/<%= id %>/page/<% print( page_count ) %>"><span class="fa fa-angle-double-right"></span></a></li>',"<% } %>","</ul>","<span>",' <%- items_shown %> items shown <a href="" data-toggle="tooltip" data-placement="top" title="currently <%- folder_page_size %> per page" class="page_size_prompt">(change)</a>',"</span>","<span>"," <%- total_items_count %> total","</span>"].join(""))}});t.default={FolderToolbarView:m}}).call(t,n(2),n(1),n(0),n(0))},319:function(e,t,n){"use strict";(function(e,i,r){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(7),s=a(o),l=n(13),c=a(l),d=n(10),u=a(d),h=e.View.extend({el:"#center",model:null,options:{},events:{"click .toolbtn_save_permissions":"savePermissions"},initialize:function(e){this.options=i.extend(this.options,e),this.options.id&&this.fetchLibrary()},fetchLibrary:function(e){this.options=i.extend(this.options,e),this.model=new c.default.Library({id:this.options.id});var t=this;this.model.fetch({success:function(){t.options.show_permissions&&t.showPermissions()},error:function(e,t){void 0!==t.responseJSON?s.default.error(t.responseJSON.err_msg+" Click this to go back.","",{onclick:function(){Galaxy.libraries.library_router.back()}}):s.default.error("An error occurred. Click this to go back.","",{onclick:function(){Galaxy.libraries.library_router.back()}})}})},showPermissions:function(e){this.options=i.extend(this.options,e),r(".tooltip").remove(),void 0!==this.options.fetched_permissions&&(0===this.options.fetched_permissions.access_library_role_list.length?this.model.set({is_unrestricted:!0}):this.model.set({is_unrestricted:!1}));var t=!1;Galaxy.user&&(t=Galaxy.user.isAdmin());var n=this.templateLibraryPermissions();this.$el.html(n({library:this.model,is_admin:t}));var a=this;r.get(Galaxy.root+"api/libraries/"+a.id+"/permissions?scope=current").done(function(e){a.prepareSelectBoxes({fetched_permissions:e})}).fail(function(){s.default.error("An error occurred while attempting to fetch library permissions.")}),r("#center [data-toggle]").tooltip(),r("#center").css("overflow","auto")},_serializeRoles:function(e){for(var t=[],n=0;n<e.length;n++)t.push(e[n][1]+":"+e[n][0]);return t},prepareSelectBoxes:function(e){this.options=i.extend(this.options,e);var t=this.options.fetched_permissions,n=this,r=this._serializeRoles(t.access_library_role_list),a=this._serializeRoles(t.add_library_item_role_list),o=this._serializeRoles(t.manage_library_role_list),s=this._serializeRoles(t.modify_library_role_list);n.accessSelectObject=new u.default.View(this._createSelectOptions(this,"access_perm",r,!0)),n.addSelectObject=new u.default.View(this._createSelectOptions(this,"add_perm",a,!1)),n.manageSelectObject=new u.default.View(this._createSelectOptions(this,"manage_perm",o,!1)),n.modifySelectObject=new u.default.View(this._createSelectOptions(this,"modify_perm",s,!1))},_createSelectOptions:function(e,t,n,i){return i=!0===i&&i,{minimumInputLength:0,css:t,multiple:!0,placeholder:"Click to select a role",container:e.$el.find("#"+t),ajax:{url:Galaxy.root+"api/libraries/"+e.id+"/permissions?scope=available&is_library_access="+i,dataType:"json",quietMillis:100,data:function(e,t){return{q:e,page_limit:10,page:t}},results:function(e,t){var n=10*t<e.total;return{results:e.roles,more:n}}},formatResult:function(e){return e.name+" type: "+e.type},formatSelection:function(e){return e.name},initSelection:function(e,t){var n=[];r(e.val().split(",")).each(function(){var e=this.split(":");n.push({id:e[0],name:e[1]})}),t(n)},initialData:n,dropdownCssClass:"bigdrop"}},makeDatasetPrivate:function(){var e=this;r.post(Galaxy.root+"api/libraries/datasets/"+e.id+"/permissions?action=make_private").done(function(t){e.model.set({is_unrestricted:!1}),e.showPermissions({fetched_permissions:t}),s.default.success("The dataset is now private to you.")}).fail(function(){s.default.error("An error occurred while attempting to make dataset private.")})},removeDatasetRestrictions:function(){var e=this;r.post(Galaxy.root+"api/libraries/datasets/"+e.id+"/permissions?action=remove_restrictions").done(function(t){e.model.set({is_unrestricted:!0}),e.showPermissions({fetched_permissions:t}),s.default.success("Access to this dataset is now unrestricted.")}).fail(function(){s.default.error("An error occurred while attempting to make dataset unrestricted.")})},_extractIds:function(e){for(var t=[],n=e.length-1;n>=0;n--)t.push(e[n].id);return t},savePermissions:function(e){var t=this,n=this._extractIds(this.accessSelectObject.$el.select2("data")),i=this._extractIds(this.addSelectObject.$el.select2("data")),a=this._extractIds(this.manageSelectObject.$el.select2("data")),o=this._extractIds(this.modifySelectObject.$el.select2("data"));r.post(Galaxy.root+"api/libraries/"+t.id+"/permissions?action=set_permissions",{"access_ids[]":n,"add_ids[]":i,"manage_ids[]":a,"modify_ids[]":o}).done(function(e){t.showPermissions({fetched_permissions:e}),s.default.success("Permissions saved.")}).fail(function(){s.default.error("An error occurred while attempting to set library permissions.")})},templateLibraryPermissions:function(){return i.template(['<div class="library_style_container">','<div id="library_toolbar">','<a href="#">','<button data-toggle="tooltip" data-placement="top" title="Go back to the list of Libraries" class="btn btn-default primary-button" type="button">','<span class="fa fa-list"/>',"&nbsp;Libraries","</button>","</a>","</div>","<h1>",'Library: <%= _.escape(library.get("name")) %>',"</h1>",'<div class="alert alert-warning">',"<% if (is_admin) { %>","You are logged in as an <strong>administrator</strong> therefore you can manage any library on this Galaxy instance. Please make sure you understand the consequences.","<% } else { %>","You can assign any number of roles to any of the following permission types. However please read carefully the implications of such actions.","<% }%>","</div>",'<div class="dataset_table">',"<h2>Library permissions</h2>","<h4>Roles that can access the library</h4>",'<div id="access_perm" class="access_perm roles-selection"/>','<div class="alert alert-info roles-selection">',"User with <strong>any</strong> of these roles can access this library. If there are no access roles set on the library it is considered <strong>unrestricted</strong>.","</div>","<h4>Roles that can manage permissions on this library</h4>",'<div id="manage_perm" class="manage_perm roles-selection"/>','<div class="alert alert-info roles-selection">',"User with <strong>any</strong> of these roles can manage permissions on this library (includes giving access).","</div>","<h4>Roles that can add items to this library</h4>",'<div id="add_perm" class="add_perm roles-selection"/>','<div class="alert alert-info roles-selection">',"User with <strong>any</strong> of these roles can add items to this library (folders and datasets).","</div>","<h4>Roles that can modify this library</h4>",'<div id="modify_perm" class="modify_perm roles-selection"/>','<div class="alert alert-info roles-selection">',"User with <strong>any</strong> of these roles can modify this library (name, synopsis, etc.).","</div>",'<button data-toggle="tooltip" data-placement="top" title="Save modifications made on this page" class="btn btn-default toolbtn_save_permissions primary-button" type="button">','<span class="fa fa-floppy-o"/>',"&nbsp;Save","</button>","</div>","</div>"].join(""))}});t.default={LibraryView:h}}).call(t,n(2),n(1),n(0))},320:function(e,t,n){"use strict";(function(e,i,r){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(7),s=a(o),l=n(13),c=a(l),d=n(10),u=a(d),h=e.View.extend({el:"#center",model:null,options:{},events:{"click .toolbtn_save_permissions":"savePermissions"},initialize:function(e){this.options=i.extend(this.options,e),this.options.id&&this.fetchFolder()},fetchFolder:function(e){this.options=i.extend(this.options,e),this.model=new c.default.FolderAsModel({id:this.options.id});var t=this;this.model.fetch({success:function(){t.options.show_permissions&&t.showPermissions()},error:function(e,t){void 0!==t.responseJSON?s.default.error(t.responseJSON.err_msg+" Click this to go back.","",{onclick:function(){Galaxy.libraries.library_router.back()}}):s.default.error("An error occurred. Click this to go back.","",{onclick:function(){Galaxy.libraries.library_router.back()}})}})},showPermissions:function(e){this.options=i.extend(this.options,e),r(".tooltip").remove();var t=!1;Galaxy.user&&(t=Galaxy.user.isAdmin());var n=this.templateFolderPermissions();this.$el.html(n({folder:this.model,is_admin:t}));var a=this;r.get(Galaxy.root+"api/folders/"+a.id+"/permissions?scope=current").done(function(e){a.prepareSelectBoxes({fetched_permissions:e})}).fail(function(){s.default.error("An error occurred while attempting to fetch folder permissions.")}),r("#center [data-toggle]").tooltip(),r("#center").css("overflow","auto")},_serializeRoles:function(e){for(var t=[],n=0;n<e.length;n++)t.push(e[n][1]+":"+e[n][0]);return t},prepareSelectBoxes:function(e){this.options=i.extend(this.options,e);var t=this.options.fetched_permissions,n=this,r=this._serializeRoles(t.add_library_item_role_list),a=this._serializeRoles(t.manage_folder_role_list),o=this._serializeRoles(t.modify_folder_role_list);n.addSelectObject=new u.default.View(this._createSelectOptions(this,"add_perm",r,!1)),n.manageSelectObject=new u.default.View(this._createSelectOptions(this,"manage_perm",a,!1)),n.modifySelectObject=new u.default.View(this._createSelectOptions(this,"modify_perm",o,!1))},_createSelectOptions:function(e,t,n){return{minimumInputLength:0,css:t,multiple:!0,placeholder:"Click to select a role",container:e.$el.find("#"+t),ajax:{url:Galaxy.root+"api/folders/"+e.id+"/permissions?scope=available",dataType:"json",quietMillis:100,data:function(e,t){return{q:e,page_limit:10,page:t}},results:function(e,t){var n=10*t<e.total;return{results:e.roles,more:n}}},formatResult:function(e){return e.name+" type: "+e.type},formatSelection:function(e){return e.name},initSelection:function(e,t){var n=[];r(e.val().split(",")).each(function(){var e=this.split(":");n.push({id:e[0],name:e[1]})}),t(n)},initialData:n.join(","),dropdownCssClass:"bigdrop"}},_extractIds:function(e){for(var t=[],n=e.length-1;n>=0;n--)t.push(e[n].id);return t},savePermissions:function(e){var t=this,n=this._extractIds(this.addSelectObject.$el.select2("data")),i=this._extractIds(this.manageSelectObject.$el.select2("data")),a=this._extractIds(this.modifySelectObject.$el.select2("data"));r.post(Galaxy.root+"api/folders/"+t.id+"/permissions?action=set_permissions",{"add_ids[]":n,"manage_ids[]":i,"modify_ids[]":a}).done(function(e){t.showPermissions({fetched_permissions:e}),s.default.success("Permissions saved.")}).fail(function(){s.default.error("An error occurred while attempting to set folder permissions.")})},templateFolderPermissions:function(){return i.template(['<div class="library_style_container">','<div id="library_toolbar">','<a href="#/folders/<%= folder.get("parent_id") %>">','<button data-toggle="tooltip" data-placement="top" title="Go back to the parent folder" class="btn btn-default primary-button" type="button">','<span class="fa fa-caret-left fa-lg"/>',"&nbsp;Parent folder","</button>","</a>","</div>","<h1>",'Folder: <%= _.escape(folder.get("name")) %>',"</h1>",'<div class="alert alert-warning">',"<% if (is_admin) { %>","You are logged in as an <strong>administrator</strong> therefore you can manage any folder on this Galaxy instance. Please make sure you understand the consequences.","<% } else { %>","You can assign any number of roles to any of the following permission types. However please read carefully the implications of such actions.","<% }%>","</div>",'<div class="dataset_table">',"<h2>Folder permissions</h2>","<h4>","Roles that can manage permissions on this folder","</h4>",'<div id="manage_perm" class="manage_perm roles-selection"/>','<div class="alert alert-info roles-selection">',"User with <strong>any</strong> of these roles can manage permissions on this folder.","</div>","<h4>","Roles that can add items to this folder","</h4>",'<div id="add_perm" class="add_perm roles-selection"/>','<div class="alert alert-info roles-selection">',"User with <strong>any</strong> of these roles can add items to this folder (folders and datasets).","</div>","<h4>","Roles that can modify this folder","</h4>",'<div id="modify_perm" class="modify_perm roles-selection"/>','<div class="alert alert-info roles-selection">',"User with <strong>any</strong> of these roles can modify this folder (name, etc.).","</div>",'<button data-toggle="tooltip" data-placement="top" title="Save modifications" class="btn btn-default toolbtn_save_permissions primary-button" type="button">','<span class="fa fa-floppy-o"/>',"&nbsp;Save","</button>","</div>","</div>"].join(""))}});t.default={FolderView:h}}).call(t,n(2),n(1),n(0))},321:function(e,t,n){"use strict";(function(e){function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var r=n(322),a=i(r),o=n(323),s=i(o),l=n(324),c=i(l),d=n(325),u=i(d),h=n(326),f=i(h),p=n(327),_=i(p),g=n(328),m=i(g),v=e.Router.extend({initialize:function(){this.routesHit=0,e.history.on("route",function(){this.routesHit++},this),this.bind("route",this.trackPageview)},routes:{"":"toolsheds",sheds:"toolsheds",queue:"queue",workflows:"workflows","status/r/:repositories":"status",status:"status","categories/s/:tool_shed":"categories","category/s/:tool_shed/c/:cateory_id":"repositories","repository/s/:tool_shed/r/:repository_id":"repository"},back:function(){this.routesHit>1?window.history.back():this.navigate("#",{trigger:!0,replace:!0})}}),y=e.View.extend({app_config:{known_views:["toolsheds","queue","status","categories","repositories","repoository"]},initialize:function(){Galaxy.admintoolshedapp=this,this.admin_toolshed_router=new v,this.admin_toolshed_router.on("route:queue",function(){Galaxy.admintoolshedapp.adminRepoQueueView?Galaxy.admintoolshedapp.adminRepoQueueView.reDraw():Galaxy.admintoolshedapp.adminRepoQueueView=new f.default.RepoQueueView}),this.admin_toolshed_router.on("route:toolsheds",function(){Galaxy.admintoolshedapp.adminShedListView?Galaxy.admintoolshedapp.adminShedListView.reDraw():Galaxy.admintoolshedapp.adminShedListView=new a.default.ShedListView}),this.admin_toolshed_router.on("route:categories",function(e){Galaxy.admintoolshedapp.adminShedCategoriesView?Galaxy.admintoolshedapp.adminShedCategoriesView.reDraw({tool_shed:e.replace(/\//g,"%2f")}):Galaxy.admintoolshedapp.adminShedCategoriesView=new s.default.CategoryView({tool_shed:e.replace(/\//g,"%2f")})}),this.admin_toolshed_router.on("route:repositories",function(e,t){Galaxy.admintoolshedapp.adminShedCategoryView?Galaxy.admintoolshedapp.adminShedCategoryView.reDraw({tool_shed:e.replace(/\//g,"%2f"),category_id:t}):Galaxy.admintoolshedapp.adminShedCategoryView=new c.default.Category({tool_shed:e.replace(/\//g,"%2f"),category_id:t})}),this.admin_toolshed_router.on("route:repository",function(e,t){Galaxy.admintoolshedapp.adminRepositoryView?Galaxy.admintoolshedapp.adminRepositoryView.reDraw({tool_shed:e.replace(/\//g,"%2f"),repository_id:t}):Galaxy.admintoolshedapp.adminRepositoryView=new u.default.RepoDetails({tool_shed:e.replace(/\//g,"%2f"),repository_id:t})}),this.admin_toolshed_router.on("route:status",function(e){Galaxy.admintoolshedapp.adminRepoStatusView?Galaxy.admintoolshedapp.adminRepoStatusView.reDraw({repositories:e.split("|")}):Galaxy.admintoolshedapp.adminRepoStatusView=new _.default.RepoStatus({repositories:e.split("|")})}),this.admin_toolshed_router.on("route:workflows",function(){Galaxy.admintoolshedapp.adminWorkflowsView?Galaxy.admintoolshedapp.adminWorkflowsView.reDraw():Galaxy.admintoolshedapp.adminWorkflowsView=new m.default.Workflows}),e.history.start({pushState:!1})}});t.default={GalaxyApp:y}}).call(t,n(2))},322:function(e,t,n){"use strict";(function(e,i){function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var a=n(3),o=r(a),s=n(18),l=r(s),c=n(19),d=r(c),u=e.View.extend({defaults:{tool_sheds:[{url:"https://toolshed.g2.bx.psu.edu/",name:"Galaxy Main Tool Shed"}]},initialize:function(e){this.options=i.defaults(this.options||{},this.defaults),this.model=new l.default.ShedsCollection,this.listenTo(this.model,"sync",this.render),this.model.fetch()},el:"#center",render:function(e){this.options=i.defaults(this.options||{},e,this.defaults);var t=this.templateToolshedList;this.$el.html(t({title:(0,o.default)("Configured Galaxy Tool Sheds"),tool_sheds:this.model.models,queue:d.default.queueLength()}))},reDraw:function(e){this.$el.empty(),this.render(e)},templateToolshedList:i.template(['<div class="unified-panel-header" id="panel_header" unselectable="on">','<div class="unified-panel-header-inner"><%= title %></div>','<div class="unified-panel-header-inner" style="position: absolute; right: 5px; top: 0px;"><a href="#/queue">Repository Queue (<%= queue %>)</a></div>',"</div>",'<div class="unified-panel-body" id="list_toolsheds">','<div class="form-row">','<table class="grid">',"<% _.each(tool_sheds, function(shed) { %>",'<tr class="libraryTitle">',"<td>",'<div style="float: left; margin-left: 1px;" class="menubutton split">','<a class="view-info shed-selector" href="#/categories/s/<%= shed.get("url") %>"><%= shed.get("name") %></a>',"</div>","</td>","</tr>","<% }); %>","</table>","</div>",'<div style="clear: both"></div>',"</div>"].join(""))});t.default={ShedListView:u}}).call(t,n(2),n(1))},323:function(e,t,n){"use strict";(function(e,i,r){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(18),s=a(o),l=n(19),c=a(l);n(31);var d=e.View.extend({el:"#center",defaults:{tool_shed:"https://toolshed.g2.bx.psu.edu/"},initialize:function(e){var t=e.tool_shed.replace(/\//g,"%2f");this.options=i.defaults(this.options||e,this.defaults),this.model=new s.default.Categories,this.listenTo(this.model,"sync",this.render),this.model.url=this.model.url+"?tool_shed_url="+this.options.tool_shed,this.model.tool_shed=t,this.model.fetch()},render:function(e){this.options=i.extend(this.options,e),this.options.categories=this.model.models,this.options.queue=c.default.queueLength();var t=this.templateCategoryList;this.$el.html(t(this.options)),r("#center").css("overflow","auto"),this.bindEvents()},bindEvents:function(){var t=this;r("#search_box").autocomplete({source:function(e,n){var i=t.model.tool_shed.replace(/%2f/g,"/"),a=Galaxy.root+"api/tool_shed/search",o={term:e.term,tool_shed_url:i};r.post(a,o,function(e){console.log(e);var t=c.default.shedParser(e);n(t)})},minLength:3,select:function(n,i){var r=i.item.value,a=(Galaxy.root,t.model.tool_shed,"repository/s/"+t.model.tool_shed+"/r/"+r);e.history.navigate(a,{trigger:!0,replace:!0})}})},reDraw:function(e){this.$el.empty(),this.model.url=this.model.url+"?tool_shed_url="+this.options.tool_shed,this.initialize(e)},templateCategoryList:i.template(['<style type="text/css">',".ui-autocomplete { background-color: #fff; }","li.ui-menu-item { list-style-type: none; }","</style>",'<div class="unified-panel-header" id="panel_header" unselectable="on">','<div class="unified-panel-header-inner" style="layout: inline;">Categories in <%= tool_shed.replace(/%2f/g, "/") %></div>','<div class="unified-panel-header-inner" style="position: absolute; right: 5px; top: 0px;"><a href="#/queue">Repository Queue (<%= queue %>)</a></div>',"</div>",'<div class="unified-panel-body" id="list_categories">','<div id="standard-search" style="height: 2em; margin: 1em;">','<span class="ui-widget" >','<input class="search-box-input" id="search_box" data-shedurl="<%= tool_shed.replace(/%2f/g, "/") %>" name="search" placeholder="Search repositories by name or id" size="60" type="text" />',"</span>","</div>",'<div style="clear: both; margin-top: 1em;">','<table class="grid">','<thead id="grid-table-header">',"<tr>","<th>Name</th>","<th>Description</th>","<th>Repositories</th>","</tr>","</thead>","<% _.each(categories, function(category) { %>","<tr>","<td>",'<a href="#/category/s/<%= tool_shed %>/c/<%= category.get("id") %>"><%= category.get("name") %></a>',"</td>",'<td><%= category.get("description") %></td>','<td><%= category.get("repositories") %></td>',"</tr>","<% }); %>","</table>","</div>","</div>"].join(""))});t.default={CategoryView:d}}).call(t,n(2),n(1),n(0))},324:function(e,t,n){"use strict";(function(e,i,r){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(18),s=a(o),l=n(19),c=a(l);n(31);var d=e.View.extend({el:"#center",initialize:function(e){this.model=new s.default.CategoryCollection,this.listenTo(this.model,"sync",this.render);var t=e.tool_shed.replace(/\//g,"%2f");this.model.url+="?tool_shed_url="+t+"&category_id="+e.category_id,this.model.tool_shed=t,this.model.category=e.category_id,this.model.fetch()},render:function(e){this.options=i.extend(this.options,e);var t=this.templateCategoryContents;this.$el.html(t({category:this.model.models[0],tool_shed:this.model.tool_shed,queue:c.default.queueLength()})),r("#center").css("overflow","auto"),this.bindEvents()},bindEvents:function(){var t=this;r("#search_box").autocomplete({source:function(e,n){var i=t.model.tool_shed.replace(/%2f/g,"/"),a=Galaxy.root+"api/tool_shed/search",o={term:e.term,tool_shed_url:i};r.post(a,o,function(e){var t=c.default.shedParser(e);n(t)})},minLength:3,select:function(n,i){var r=i.item.value,a="repository/s/"+t.model.tool_shed+"/r/"+r;e.history.navigate(a,{trigger:!0,replace:!0})}})},reDraw:function(e){this.$el.empty(),this.initialize(e)},templateCategoryContents:i.template(['<style type="text/css">',".ui-autocomplete { background-color: #fff; }","li.ui-menu-item { list-style-type: none; }","</style>",'<div class="unified-panel-header" id="panel_header" unselectable="on">','<div class="unified-panel-header-inner">Repositories in <%= category.get("name") %></div>','<div class="unified-panel-header-inner" style="position: absolute; right: 5px; top: 0px;"><a href="#/queue">Repository Queue (<%= queue %>)</a></div>',"</div>",'<div class="unified-panel-body" id="list_repositories">','<div id="standard-search" style="height: 2em; margin: 1em;">','<span class="ui-widget" >','<input class="search-box-input" id="search_box" name="search" data-shedurl="<%= tool_shed.replace(/%2f/g, "/") %>" placeholder="Search repositories by name or id" size="60" type="text" />',"</span>","</div>",'<div style="clear: both; margin-top: 1em;">','<table class="grid">','<thead id="grid-table-header">',"<tr>",'<th style="width: 10%;">Owner</th>','<th style="width: 15%;">Name</th>',"<th>Synopsis</th>",'<th style="width: 10%;">Type</th>',"</tr>","</thead>",'<% _.each(category.get("repositories"), function(repository) { %>',"<tr>","<td><%= repository.owner %></td>","<td>",'<div style="float: left; margin-left: 1px;" class="menubutton split">','<a href="#/repository/s/<%= tool_shed %>/r/<%= repository.id %>"><%= repository.name %></a>',"</div>","</td>","<td><%= repository.description %></td>","<td><%= repository.type %></td>","</tr>","<% }); %>","</table>","</div>","</div>"].join(""))});t.default={Category:d}}).call(t,n(2),n(1),n(0))},325:function(e,t,n){"use strict";(function(e,i,r){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(18),s=a(o),l=n(127),c=(a(l),n(4)),d=a(c),u=n(8),h=a(u),f=n(11),p=a(f),_=n(19),g=a(_),m=e.View.extend({el:"#center",initialize:function(e){this.options=i.defaults(this.options||{},this.defaults),this.model=new s.default.RepositoryCollection,this.listenTo(this.model,"sync",this.render);var t=e.tool_shed.replace(/\//g,"%2f");this.model.url+="?tool_shed_url="+t+"&repository_id="+e.repository_id,this.model.tool_shed_url=e.tool_shed.replace(/%2f/g,"/"),this.model.tool_shed=t,this.model.category=e.repository_id,this.model.fetch()},render:function(e){var t=this.templateRepoDetails,n=this.model.models[0];this.options={repository:n.get("repository"),tool_shed:this.model.tool_shed,queue:g.default.queueLength()};var a=Object.keys(this.options.repository.metadata).sort(function(e,t){return parseInt(e.split(":")[0]-t.split(":")[0])}),o={},s=this.options.repository.metadata;a.forEach(function(e){o[e]=s[e]}),this.options.repository.metadata=o,this.options.current_changeset=this.options.current_changeset||a[a.length-1],this.options.current_metadata=this.options.repository.metadata[this.options.current_changeset],this.options.current_metadata.tool_shed_url=this.model.tool_shed_url,this.options.tools=this.options.current_metadata.tools,this.options.repository_dependencies_template=this.templateRepoDependencies,this.options.repository_dependency_template=this.templateRepoDependency,this.options.tps_template_global_select=this.templateGlobalSectionSelect,this.options.tps_template_tool_select=this.templateToolSectionSelect,this.options.tps_select_options=this.templatePanelSelectOptions,this.options.tool_dependencies=n.get("tool_dependencies"),this.options.shed_tool_conf=this.templateShedToolConf({shed_tool_confs:n.get("shed_conf")}),this.options.panel_section_dict=n.get("panel_section_dict"),this.options.api_url=Galaxy.root+"api/tool_shed_repositories/install?async=True",this.options=i.extend(this.options,e),this.$el.html(t(this.options)),this.checkInstalled(this.options.current_metadata),this.bindEvents(),r("#center").css("overflow","auto")},bindEvents:function(){var e=this;r("#changeset").on("change",function(){e.options.current_changeset=r("#changeset").find("option:selected").text(),e.options.current_metadata=e.options.repository.metadata[e.options.current_changeset],e.checkInstalled(e.options.current_metadata),e.reDraw(e.options)}),r("#tool_panel_section_select").on("change",function(){e.tpsSelection()}),r("#install_repository").on("click",function(t){r("#repository_installation");t.preventDefault();var n={};n.repositories=JSON.stringify([[r("#install_repository").attr("data-tsrid"),r("#changeset").find("option:selected").val()]]),n.tool_shed_repository_ids=JSON.stringify([r("#install_repository").attr("data-tsrid")]),n.tool_shed_url=e.model.tool_shed_url,n.install_tool_dependencies=r("#install_tool_dependencies").val(),n.install_repository_dependencies=r("#install_repository_dependencies").val(),n.install_resolver_dependencies=r("#install_resolver_dependencies").val();e.panelSelect(n);n.tool_panel_section=JSON.stringify(e.panelSelect(n)),n.shed_tool_conf=r("select[name='shed_tool_conf']").find("option:selected").val(),n.changeset=r("#changeset").find("option:selected").val();var i=r("#repository_installation").attr("action");e.prepareInstall(n,i)}),r("#queue_install").on("click",function(t){e.options.current_changeset=r("#changeset").find("option:selected").text(),e.options.current_metadata=e.options.repository.metadata[e.options.current_changeset];var n=(e.options.current_changeset,{});i.each(Object.keys(e.options.current_metadata),function(t){n[t]||(n[t]=e.options.current_metadata[t])}),n.install_tool_dependencies=r("#install_tool_dependencies").val(),n.install_repository_dependencies=r("#install_repository_dependencies").val(),n.install_resolver_dependencies=r("#install_resolver_dependencies").val(),n.tool_panel_section=JSON.stringify(e.panelSelect({})),n.shed_tool_conf=r("select[name='shed_tool_conf']").find("option:selected").val(),n.tool_shed_url=e.model.tool_shed_url,"/"==n.tool_shed_url.substr(-1)&&(n.tool_shed_url=n.tool_shed_url.substr(0,n.tool_shed_url.length-1)),g.default.addToQueue(n),e.checkInstalled(n)}),r(".tool_panel_section_picker").on("change",function(){r(this).find("option:selected").val()==r("#tool_panel_section_select").find("option:selected").val()?r(this).attr("default","active"):r(this).removeAttr("default")}),r(function(){r("#repository_dependencies").jstree()}),r(".tool_form").on("click",function(){var t=r(this).attr("data-guid"),n=(r(this).attr("data-clean"),r(this).attr("data-name")),i=r(this).attr("data-desc"),a=e.model.tool_shed_url,o=r("#repository_details").attr("data-tsrid"),s=r("#changeset").find("option:selected").val(),l=Galaxy.root+"api/tool_shed/tool_json",c={guid:t,tool_shed_url:a,tsr_id:o,changeset:s};r.get(l,c,function(e){e.cls="ui-portlet-plain";var t=new p.default(e);d.default.deepeach(e.inputs,function(e){e.type&&-1!=["data","data_collection"].indexOf(e.type)&&(e.type="hidden",e.info="Data input '"+e.name+"' ("+d.default.textify(e.extensions)+")")});var r=new h.default.View,a="<u>"+n+"</u> "+i;r.show({closing_events:!0,title:a,body:t.$el,buttons:{Close:function(){r.hide()}}})})})},checkInstalled:function(e){var t=this,n={name:e.name,owner:e.owner},i=!1;t.repoQueued(e);r.get(Galaxy.root+"api/tool_shed_repositories",n,function(n){for(var a=0;a<n.length;a++){var o=n[a],s=!o.deleted&&!o.uninstalled,l=o.changeset_revision==e.changeset_revision||o.installed_changeset_revision==e.changeset_revision;o.name==e.repository.name&&o.owner==e.repository.owner&&s&&l&&(i=!0),i?(r("#install_repository").prop("disabled",!0),r("#install_repository").val("This revision is already installed")):(r("#install_repository").prop("disabled",!1),r("#install_repository").val("Install this revision"))}t.repoQueued(e)||i?(r("#queue_install").hide(),r("#queue_install").val("This revision is already in the queue")):(r("#queue_install").show(),r("#queue_install").val("Install this revision later"))})},panelSelect:function(e){var t={};return r("#tool_panel_section_select").length?e.tool_panel_section_id=r("#tool_panel_section_select").find("option:selected").val():e.new_tool_panel_section=r("#new_tool_panel_section").val(),r(".tool_panel_section_picker").each(function(){var e=r(this).attr("name"),n=r(this).attr("data-toolguid");t[n]="tool_panel_section_id"===e?{tool_panel_section:r(this).find("option:selected").val(),action:"append"}:{tool_panel_section:r(this).val(),action:"create"}}),t},reDraw:function(e){this.$el.empty(),this.render(e)},repoQueued:function(e){var t=this;if(localStorage.repositories){var n,i=t.queueKey(e);return localStorage.repositories&&(n=JSON.parse(localStorage.repositories)),!(!n||!n.hasOwnProperty(i))}},queueKey:function(e){var t=this.model.tool_shed_url;return"/"==t.substr(-1)&&(t=t.substr(0,t.length-1)),t+"|"+e.repository_id+"|"+e.changeset_revision},tpsSelection:function(){new_tps=r("#tool_panel_section_select").find("option:selected").val(),r('.tool_panel_section_picker[default="active"]').each(function(){r(this).val(new_tps)})},prepareInstall:function(e,t){var n=this;r.post(t,e,function(e){var t=JSON.parse(e);n.doInstall(t)})},doInstall:function(t){var n=Galaxy.root+"admin_toolshed/install_repositories",i=t.repositories,a="status/r/"+i.join("|");r.post(n,t,function(e){console.log("Initializing repository installation succeeded")}),e.history.navigate(a,{trigger:!0,replace:!0})},templateRepoDetails:i.template(['<div class="unified-panel-header" id="panel_header" unselectable="on">','<div class="unified-panel-header-inner">Repository information for <strong><%= repository.name %></strong> from <strong><%= repository.owner %></strong></div>','<div class="unified-panel-header-inner" style="position: absolute; right: 5px; top: 0px;"><a href="#/queue">Repository Queue (<%= queue %>)</a></div>',"</div>",'<div class="unified-panel-body" id="repository_details" data-tsrid="<%= repository.id %>">','<form id="repository_installation" name="install_repository" method="post" action="<%= api_url %>">','<input type="hidden" id="repositories" name="<%= repository.id %>" value="ID" />','<input type="hidden" id="tool_shed_url" name="tool_shed_url" value="<%= tool_shed %>" />','<div class="toolForm">','<div class="toolFormTitle">Changeset</div>','<div class="toolFormBody changeset">','<select id="changeset" name="changeset" style="margin: 5px;">',"<% _.each(Object.keys(repository.metadata), function(changeset) { %>",'<% if (changeset == current_changeset) { var selected = "selected "; } else { var selected = ""; } %>','<option <%= selected %>value="<%= changeset.split(":")[1] %>"><%= changeset %></option>',"<% }); %>","</select>",'<input class="btn btn-primary preview-button" data-tsrid="<%= current_metadata.repository.id %>" type="submit" id="install_repository" name="install_repository" value="Install this revision now" />','<input class="btn btn-primary preview-button" type="button" id="queue_install" name="queue_install" value="Install this revision later" />','<div class="toolParamHelp" style="clear: both;">Please select a revision and review the settings below before installing.</div>',"</div>","</div>","<%= shed_tool_conf %>","<% if (current_metadata.has_repository_dependencies) { %>",'<div class="toolFormTitle">Repository dependencies for <strong id="current_changeset"><%= current_changeset %></strong></div>','<div class="toolFormBody">','<p id="install_repository_dependencies_checkbox">','<input type="checkbox" checked id="install_repository_dependencies" />','<label for="install_repository_dependencies">Install repository dependencies</label>',"</p>","<% current_metadata.repository_dependency_template = repository_dependency_template; %>",'<div class="tables container-table" id="repository_dependencies">','<div class="expandLink">','<a class="toggle_folder" data_target="repository_dependencies_table">',"Repository dependencies &ndash; <em>installation of these additional repositories is required</em>","</a>","</div>","<%= repository_dependencies_template(current_metadata) %>","</div>","</div>","<% } %>","<% if (current_metadata.includes_tool_dependencies) { %>",'<div class="toolFormTitle">Tool dependencies</div>','<div class="toolFormBody">','<p id="install_resolver_dependencies_checkbox">','<input type="checkbox" checked id="install_resolver_dependencies" />','<label for="install_resolver_dependencies">Install resolver dependencies</label>',"</p>",'<p id="install_tool_dependencies_checkbox">','<input type="checkbox" checked id="install_tool_dependencies" />','<label for="install_tool_dependencies">Install tool dependencies</label>',"</p>",'<div class="tables container-table" id="tool_dependencies">','<div class="expandLink">','<a class="toggle_folder" data_target="tool_dependencies_table">',"Tool dependencies &ndash; <em>repository tools require handling of these dependencies</em>","</a>","</div>",'<table class="tables container-table" id="tool_dependencies_table" border="0" cellpadding="2" cellspacing="2" width="100%">',"<thead>",'<tr style="display: table-row;" class="datasetRow" parent="0" id="libraryItem-rt-f9cad7b01a472135">','<th style="padding-left: 40px;">Name</th>',"<th>Version</th>","<th>Type</th>","</tr>","</thead>",'<tbody id="tool_deps">',"<% _.each(tool_dependencies[current_changeset], function(dependency) { %>",'<tr class="datasetRow tool_dependency_row" style="display: table-row;">','<td style="padding-left: 40px;">',"<%= dependency.name %></td>","<td><%= dependency.version %></td>","<td><%= dependency.type %></td>","</tr>","<% }); %>","</tbody>","</table>","</div>","</div>","<% } %>","<% if (current_metadata.includes_tools_for_display_in_tool_panel) { %>",'<div class="toolFormTitle">Tools &ndash; <em>click the name to preview the tool and use the pop-up menu to inspect all metadata</em></div>','<div class="toolFormBody">','<div class="tables container-table" id="tools_toggle">','<table class="tables container-table" id="valid_tools" border="0" cellpadding="2" cellspacing="2" width="100%">',"<thead>",'<tr style="display: table-row;" class="datasetRow" parent="0" id="libraryItem-rt-f9cad7b01a472135">','<th style="padding-left: 40px;">Name</th>',"<th>Description</th>","<th>Version</th>","<th><%= tps_template_global_select({tps: panel_section_dict, tps_select_options: tps_select_options}) %></tr>","</thead>",'<tbody id="tools_in_repo">',"<% _.each(current_metadata.tools, function(tool) { %>",'<tr id="libraryItem-<%= tool.clean %>" class="tool_row" style="display: table-row;" style="width: 15%">','<td style="padding-left: 40px;">','<div id="tool-<%= tool.clean %>" class="menubutton split popup" style="float: left;">','<a class="tool_form view-info" data-toggle="modal" data-target="toolform_<%= tool.clean %>" data-clean="<%= tool.clean %>" data-guid="<%= tool.guid %>" data-name="<%= tool.name %>" data-desc="<%= tool.description %>"><%= tool.name %></a>',"</div>","</td>","<td><%= tool.description %></td>",'<td style="width: 15%"><%= tool.version %></td>','<td style="width: 35%" id="tool_tps_<%= tool.clean %>">',"<%= tps_template_tool_select({tool: tool, tps: panel_section_dict, tps_select_options: tps_select_options}) %>","</td>","</tr>","<% }); %>","</tbody>","</table>","</div>","</div>","<% } %>","</form>","</div>"].join("")),templateRepoDependencies:i.template(['<div class="toolFormTitle">Repository Dependencies</div>','<div class="toolFormBody tables container-table" id="repository_dependencies">',"<ul>","<li>Repository installation requires the following","<% if (has_repository_dependencies) { %>","<% _.each(repository_dependencies, function(dependency) { %>","<% dependency.repository_dependency_template = repository_dependency_template; %>","<%= repository_dependency_template(dependency) %>","<% }); %>","<% } %>","</li>","</ul>","</div>"].join("")),templateRepoDependency:i.template(['<li id="metadata_<%= id %>" class="datasetRow repository_dependency_row">',"Repository <b><%= repository.name %></b> revision <b><%= changeset_revision %></b> owned by <b><%= repository.owner %></b>","<% if (has_repository_dependencies) { %>",'<ul class="child_dependencies">',"<% _.each(repository_dependencies, function(dependency) { %>","<% dependency.repository_dependency_template = repository_dependency_template; %>","<%= repository_dependency_template(dependency) %>","<% }); %>","</ul>","<% } %>","</li>"].join("")),templateShedToolConf:i.template(['<div class="toolFormTitle">Shed tool configuration file:</div>','<div class="toolFormBody">','<div class="form-row">','<select name="shed_tool_conf">',"<% _.each(shed_tool_confs.options, function(conf) { %>",'<option value="<%= conf.value %>"><%= conf.label %></option>',"<% }); %>","</select>",'<div class="toolParamHelp" style="clear: both;">Select the file whose <b>tool_path</b> setting you want used for installing repositories.</div>',"</div>","</div>"].join("")),templateToolDependency:i.template(["<% if (has_repository_dependencies) { %>","<% _.each(repository_dependencies, function(dependency) { %>","<% if (dependency.includes_tool_dependencies) { %>","<% dependency.tool_dependency_template = tool_dependency_template %>","<%= tool_dependency_template(dependency) %>","<% } %>","<% }); %>","<% } %>"].join("")),templateGlobalSectionCreate:i.template(['<div id="tool_panel_section">','<div class="form-row" id="new_tps">','<input id="new_tool_panel_section" name="new_tool_panel_section" type="textfield" value="" size="40"/>','<input class="btn btn-primary" type="button" id="select_existing" value="Select existing" />','<div class="toolParamHelp" style="clear: both;">',"Add a new tool panel section to contain the installed tools (optional).","</div>","</div>","</div>"].join("")),templateGlobalSectionSelect:i.template(['<div id="tool_panel_section">','<div class="toolFormTitle">Tool Panel Section</div>','<div class="toolFormBody">','<div class="tab-pane" id="select_tps">','<select name="<%= name %>" id="<%= tps.id %>">',"<%= tps_select_options({sections: tps.sections}) %>","</select>",'<input class="btn btn-primary" type="button" id="create_new" value="Create new" />','<div class="toolParamHelp" style="clear: both;">',"Select an existing tool panel section to contain the installed tools (optional).","</div>","</div>","</div>","</div>"].join("")),templateToolSectionCreate:i.template(['<div id="new_tps_<%= tool.clean %>" data-clean="<%= tool.clean %>" class="form-row">','<input data-toolguid="<%= tool.guid %>" class="tool_panel_section_picker" size="40" name="new_tool_panel_section" id="new_tool_panel_section_<%= tool.clean %>" type="text">','<input id="per_tool_select_<%= tool.clean %>" class="btn btn-primary" data-toolguid="<%= tool.guid %>" value="Select existing" id="select_existing_<%= tool.clean %>" type="button">',"</div>"].join("")),templateToolSectionSelect:i.template(['<div id="select_tps_<%= tool.clean %>" data-clean="<%= tool.clean %>" class="tps_creator">','<select default="active" style="width: 30em;" data-toolguid="<%= tool.guid %>" class="tool_panel_section_picker" name="tool_panel_section_id" id="tool_panel_section_select_<%= tool.clean %>">',"<%= tps_select_options({sections: tps.sections}) %>","</select>",'<input id="per_tool_create_<%= tool.clean %>" data-clean="<%= tool.clean %>" class="btn btn-primary create-tps-button" data-toolguid="<%= tool.guid %>" value="Create new" id="create_new_<%= tool.clean %>" type="button">','<div style="clear: both;" class="toolParamHelp"></div>',"</div>"].join("")),templatePanelSelectOptions:i.template(["<% _.each(sections, function(section) { %>",'<option value="<%= section.id %>"><%= section.name %></option>',"<% }); %>"].join(""))});t.default={RepoDetails:m}}).call(t,n(2),n(1),n(0))},326:function(e,t,n){"use strict";(function(e,i,r){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(3),s=a(o),l=n(18),c=a(l),d=n(19),u=a(d),h=e.View.extend({el:"#center",defaults:[{}],initialize:function(e){var t=this;this.model=new c.default.RepoQueue,this.listenTo(this.model,"sync",this.render),this.model.fetch(),t.render()},render:function(e){var t=this,n=t.templateRepoQueue,r=t.model.models;t.$el.html(n({title:(0,s.default)("Repository Installation Queue"),repositories:r,queue:u.default.queueLength()})),i("#center").css("overflow","auto"),t.bindEvents()},bindEvents:function(){var t=this;i(".install_one").on("click",function(){var e=t.loadFromQueue(i(this).attr("data-repokey"));t.installFromQueue(e,i(this).attr("data-repokey"))}),i(".remove_one").on("click",function(){var e=i(this).attr("data-repokey"),t=JSON.parse(localStorage.repositories);if(t.hasOwnProperty(e)){var n=t[e].repository.id;delete t[e],i("#queued_repository_"+n).remove()}localStorage.repositories=JSON.stringify(t)}),i("#clear_queue").on("click",function(){localStorage.repositories="{}"}),i("#from_workflow").on("click",function(){e.history.navigate("workflows",{trigger:!0,replace:!0})})},installFromQueue:function(t,n){var r=Object();r.install_tool_dependencies=t.install_tool_dependencies,r.install_repository_dependencies=t.install_repository_dependencies,r.install_resolver_dependencies=t.install_resolver_dependencies,r.tool_panel_section=t.tool_panel_section,r.shed_tool_conf=t.shed_tool_conf,r.repositories=JSON.stringify([[t.repository.id,t.changeset_revision]]),r.tool_shed_repository_ids=JSON.stringify([t.repository.id]),r.tool_shed_url=n.split("|")[0],r.changeset=t.changeset_revision;var a=Galaxy.root+"api/tool_shed_repositories/install?async=True";if(i("#queued_repository_"+t.repository.id).remove(),localStorage.repositories){void 0===n&&(n=u.default.queueKey(t));var o=JSON.parse(localStorage.repositories);o.hasOwnProperty(n)&&(delete o[n],localStorage.repositories=JSON.stringify(o))}i.post(a,r,function(t){var n=JSON.parse(t),r=n.repositories,a="status/r/"+r.join("|");i.post(Galaxy.root+"admin_toolshed/install_repositories",n,function(e){console.log("Initializing repository installation succeeded")}),e.history.navigate(a,{trigger:!0,replace:!0})})},loadFromQueue:function(e){var t=JSON.parse(localStorage.repositories);if(t.hasOwnProperty(e))return t[e]},reDraw:function(e){this.$el.empty(),this.initialize(e),this.model.fetch(),this.render(e)},templateRepoQueue:r.template(['<div class="unified-panel-header" id="panel_header" unselectable="on">','<div class="unified-panel-header-inner"><%= title %></div>','<div class="unified-panel-header-inner" style="position: absolute; right: 5px; top: 0px;"><a href="#/queue">Repository Queue (<%= queue %>)</a></div>',"</div>",'<div class="tab-pane" id="panel_header" id="repository_queue">','<table id="queued_repositories" class="grid" border="0" cellpadding="2" cellspacing="2" width="100%">','<thead id="grid-table-header">',"<tr>",'<th class="datasetRow">Name</th>','<th class="datasetRow">Owner</th>','<th class="datasetRow">Revision</th>','<th class="datasetRow">ToolShed</th>','<th class="datasetRow">Install</th>','<th class="datasetRow"><input class="btn btn-primary" type="submit" id="clear_queue" name="clear_queue" value="Clear queue" /></th>',"</tr>","</thead>","<tbody>","<% _.each(repositories, function(repository) { %>",'<tr id="queued_repository_<%= repository.get("id") %>">','<td class="datasetRow"><%= repository.get("repository").name %></td>','<td class="datasetRow"><%= repository.get("repository").owner %></td>','<td class="datasetRow"><%= repository.get("changeset_revision") %></td>','<td class="datasetRow"><%= repository.get("tool_shed_url") %></td>','<td class="datasetRow">','<input class="btn btn-primary install_one" data-repokey="<%= repository.get("queue_key") %>" type="submit" id="install_repository_<%= repository.get("id") %>" name="install_repository" value="Install now" />',"</td>",'<td class="datasetRow">','<input class="btn btn-primary remove_one" data-repokey="<%= repository.get("queue_key") %>" type="submit" id="unqueue_repository_<%= repository.get("id") %>" name="unqueue_repository" value="Remove from queue" />',"</td>","</tr>","<% }); %>","</tbody>","</table>",'<input type="button" class="btn btn-primary" id="from_workflow" value="Add from workflow" />',"</div>"].join(""))});t.default={RepoQueueView:h}}).call(t,n(2),n(0),n(1))},327:function(e,t,n){"use strict";(function(e,i,r){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(3),s=a(o),l=n(18),c=a(l),d=n(19),u=a(d),h=e.View.extend({el:"#center",initialize:function(e){this.options=i.defaults(this.options||[{}],e,this.defaults),this.model=new c.default.RepoStatus,this.listenTo(this.model,"sync",this.render),this.model.url+="?repositories="+this.options.repositories.join("|"),this.model.fetch(),this.timer=setInterval(function(e){var t=["installed","error"],n=!0;i.some(e.model.models,function(e){repo_id=e.get("id");var i=e.get("status").toLowerCase();if(-1===t.indexOf(i))return n=!1,!0}),n?clearInterval(e.timer):e.model.fetch()},2e3,this)},close:function(){clearInterval(this.timer)},render:function(e){this.options=i.extend(this.options,e);var t=this.templateRepoStatus;this.$el.html(t({title:(0,s.default)("Repository Status"),repositories:this.model.models,queue:u.default.queueLength()})),r("#center").css("overflow","auto"),this.bindEvents()},bindEvents:function(){},reDraw:function(e){this.$el.empty(),this.initialize(e)},templateRepoStatus:i.template(['<div class="unified-panel-header" id="panel_header" unselectable="on">','<div class="unified-panel-header-inner"><%= title %></div>','<div class="unified-panel-header-inner" style="position: absolute; right: 5px; top: 0px;"><a href="#/queue">Repository Queue (<%= queue %>)</a></div>',"</div>",'<style type="text/css">',".state-color-new,",".state-color-deactivated,",".state-color-uninstalled { border-color:#bfbfbf; background:#eee }",".state-color-cloning,",".state-color-setting-tool-versions,",".state-color-installing-repository-dependencies,",".state-color-installing-tool-dependencies,",".state-color-loading-proprietary-datatypes { border-color:#AAAA66; background:#FFFFCC }",".state-color-installed { border-color:#20b520; background:#b0f1b0 }",".state-color-error { border-color:#dd1b15; background:#f9c7c5 }","</style>",'<table id="grid-table" class="grid">','<thead id="grid-table-header">',"<tr>",'<th id="null-header">Name<span class="sort-arrow"></span></th>','<th id="null-header">Description<span class="sort-arrow"></span></th>','<th id="null-header">Owner<span class="sort-arrow"></span></th>','<th id="null-header">Revision<span class="sort-arrow"></span></th>','<th id="null-header">Installation Status<span class="sort-arrow"></span></th>',"</tr>","</thead>",'<tbody id="grid-table-body">',"<% _.each(repositories, function(repository) { %>","<tr>","<td>",'<div id="" class="">','<label id="repo-name-<%= repository.get("id") %>" for="<%= repository.get("id") %>">','<%= repository.get("name") %>',"</label>","</div>","</td>","<td>",'<div id="" class="">','<label id="repo-desc-<%= repository.get("id") %>" for="<%= repository.get("id") %>">','<%= repository.get("description") %>',"</label>","</div>","</td>","<td>",'<div id="" class="">','<label id="repo-user-<%= repository.get("id") %>" for="<%= repository.get("id") %>">','<%= repository.get("owner") %>',"</label>","</div>","</td>","<td>",'<div id="" class="">','<label id="repo-changeset-<%= repository.get("id") %>" for="<%= repository.get("id") %>">','<%= repository.get("changeset_revision") %>',"</label>","</div>","</td>","<td>",'<div id="" class="">','<label id="RepositoryStatus-<%= repository.get("id") %>" for="<%= repository.get("id") %>">','<div class="repo-status count-box state-color-<%= repository.get("status").toLowerCase().replace(/ /g, "-") %>" id="RepositoryStatus-<%= repository.get("id") %>">','<%= repository.get("status") %>',"</div>","</label>","</div>","</td>","</tr>","<% }); %>","</tbody>",'<tfoot id="grid-table-footer"></tfoot>',"</table>"].join(""))});t.default={RepoStatus:h}}).call(t,n(2),n(1),n(0))},328:function(e,t,n){"use strict";(function(e,i,r){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(3),s=a(o),l=n(18),c=a(l),d=n(19),u=a(d),h=e.View.extend({el:"#center",defaults:[{}],initialize:function(e){var t=this;this.model=new c.default.WorkflowTools,this.listenTo(this.model,"sync",this.render),this.model.fetch(),t.render()},render:function(e){var t=this,n=t.templateWorkflows,r=t.model.models;t.$el.html(n({title:(0,s.default)("Workflows Missing Tools"),workflows:r,queue:u.default.queueLength()})),i("#center").css("overflow","auto"),t.bindEvents()},bindEvents:function(){var t,n=this;i(".show_wf_repo").on("click",function(){var n=i(this).attr("data-toolids"),r=i(this).attr("data-shed"),a=Galaxy.root+"api/tool_shed/repository",o={tool_ids:n};i.get(a,o,function(n){t=n.repository.id;var i="repository/s/"+r.replace(/:/g,"%3a").replace(/\//g,"%2f")+"/r/"+n.repository.id;e.history.navigate(i,{trigger:!0,replace:!0})})}),i(".queue_wf_repo").on("click",function(){var e=i(this),n=e.attr("data-toolids"),r=e.attr("data-shed"),a=Galaxy.root+"api/tool_shed/repository",o={tool_ids:n};i.get(a,o,function(n){t=n.repository.id,o={tool_shed_url:r,repository_id:t},i.get(a,o,function(t){var n=Object.keys(t.repository.metadata),i=n[0],a=t.repository.metadata[i];a.tool_shed_url=r,u.default.addToQueue(a),e.remove()})})}),i("#from_workflow").on("click",n.loadWorkflows)},reDraw:function(e){this.$el.empty(),this.initialize(e)},templateWorkflows:r.template(['<div class="unified-panel-header" id="panel_header" unselectable="on">','<div class="unified-panel-header-inner"><%= title %></div>','<div class="unified-panel-header-inner" style="position: absolute; right: 5px; top: 0px;"><a href="#/queue">Repository Queue (<%= queue %>)</a></div>',"</div>",'<style type="text/css">',".workflow_names, .workflow_tools { list-style-type: none; } ul.workflow_tools, ul.workflow_names {  padding-left: 0px; }","</style>",'<table id="workflows_missing_tools" class="grid" border="0" cellpadding="2" cellspacing="2" width="100%">','<thead id="grid-table-header">',"<tr>",'<th class="datasetRow">Workflows</th>','<th class="datasetRow">Tool IDs</th>','<th class="datasetRow">Shed</th>','<th class="datasetRow">Name</th>','<th class="datasetRow">Owner</th>','<th class="datasetRow">Actions</th>',"</tr>","</thead>","<tbody>","<% _.each(workflows, function(workflow) { %>","<tr>",'<td class="datasetRow">','<ul class="workflow_names">','<% _.each(workflow.get("workflows"), function(name) { %>','<li class="workflow_names"><%= name %></li>',"<% }); %>","</ul>","</td>",'<td class="datasetRow">','<ul class="workflow_tools">','<% _.each(workflow.get("tools"), function(tool) { %>','<li class="workflow_tools"><%= tool %></li>',"<% }); %>","</ul>","</td>",'<td class="datasetRow"><%= workflow.get("shed") %></td>','<td class="datasetRow"><%= workflow.get("repository") %></td>','<td class="datasetRow"><%= workflow.get("owner") %></td>','<td class="datasetRow">','<ul class="workflow_tools">','<li class="workflow_tools">','<input type="button" class="show_wf_repo btn btn-primary" data-shed="<%= workflow.get("shed") %>" data-owner="<%= workflow.get("owner") %>" data-repo="<%= workflow.get("repository") %>" data-toolids="<%= workflow.get("tools").join(",") %>" value="Show Repository" /></li>',"</ul>","</td>","</tr>","<% }); %>","</ul>","</div>"].join(""))});t.default={Workflows:h}}).call(t,n(2),n(0),n(1))},62:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={tool:"fa-wrench",data_input:"fa-file-o",data_collection_input:"fa-folder-o",subworkflow:"fa-sitemap fa-rotate-270",pause:"fa-pause"}}},[299]);