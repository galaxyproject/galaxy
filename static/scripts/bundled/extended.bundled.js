webpackJsonp([0],[,,,,,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i={UPLOAD:"upload",QUEUED:"queued",RUNNING:"running",SETTING_METADATA:"setting_metadata",NEW:"new",EMPTY:"empty",OK:"ok",PAUSED:"paused",FAILED_METADATA:"failed_metadata",NOT_VIEWABLE:"noPermission",DISCARDED:"discarded",ERROR:"error"};i.READY_STATES=[i.OK,i.EMPTY,i.PAUSED,i.FAILED_METADATA,i.NOT_VIEWABLE,i.DISCARDED,i.ERROR],i.NOT_READY_STATES=[i.UPLOAD,i.QUEUED,i.RUNNING,i.SETTING_METADATA,i.NEW],t.default=i},,function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),r=function(e){return e&&e.__esModule?e:{default:e}}(i),a=r.default,o=function(t){t=t||{},t.tooltipConfig=t.tooltipConfig||{placement:"bottom"},t.classes=["icon-btn"].concat(t.classes||[]),t.disabled&&t.classes.push("disabled");var n=['<a class="',t.classes.join(" "),'"',t.title?' title="'+t.title+'"':"",!t.disabled&&t.target?' target="'+t.target+'"':"",' href="',!t.disabled&&t.href?t.href:"javascript:void(0);",'">','<span class="fa ',t.faIcon,'"></span>',"</a>"].join(""),i=a(n).tooltip(t.tooltipConfig);return e.isFunction(t.onclick)&&i.click(t.onclick),i};t.default=o}).call(t,n(1))},,function(e,t,n){"use strict";(function(e,i){Object.defineProperty(t,"__esModule",{value:!0});var r=n(5),a=function(e){return e&&e.__esModule?e:{default:e}}(r),o=e.View.extend({optionsDefault:{css:"",placeholder:"No data available",data:[],value:null,multiple:!1,minimumInputLength:0,initialData:""},initialize:function(e){if(this.options=a.default.merge(e,this.optionsDefault),this.setElement(this._template(this.options)),!this.options.container)return void console.log("ui-select::initialize() : container not specified.");if(this.options.container.append(this.$el),this.select_data=this.options.data,this._refresh(),!this.options.multiple){this.options.value&&this._setValue(this.options.value);var t=this;this.options.onchange&&this.$el.on("change",function(){t.options.onchange(t.value())})}},value:function(e){var t=this._getValue();void 0!==e&&this._setValue(e);var n=this._getValue();return n!=t&&this.options.onchange&&this.options.onchange(n),n},text:function(){return this.$el.select2("data").text},disabled:function(){return!this.$el.select2("enable")},enable:function(){this.$el.select2("enable",!0)},disable:function(){this.$el.select2("enable",!1)},add:function(e){this.select_data.push({id:e.id,text:e.text}),this._refresh()},del:function(e){var t=this._getIndex(e);-1!=t&&(this.select_data.splice(t,1),this._refresh())},remove:function(){this.$el.select2("destroy")},update:function(e){this.select_data=[];for(var t in e.data)this.select_data.push(e.data[t]);this._refresh()},_refresh:function(){if(this.options.multiple){var e={multiple:this.options.multiple,containerCssClass:this.options.css,placeholder:this.options.placeholder,minimumInputLength:this.options.minimumInputLength,ajax:this.options.ajax,dropdownCssClass:this.options.dropdownCssClass,escapeMarkup:this.options.escapeMarkup,formatResult:this.options.formatResult,formatSelection:this.options.formatSelection,initSelection:this.options.initSelection,initialData:this.options.initialData};this.$el.select2(e)}else{var t=this._getValue(),e={data:this.select_data,containerCssClass:this.options.css,placeholder:this.options.placeholder,dropdownAutoWidth:!0};this.$el.select2(e),this._setValue(t)}},_getIndex:function(e){i.findIndex(this.select_data,{id:e})},_getValue:function(){return this.$el.select2("val")},_setValue:function(e){-1==this._getIndex(e)&&this.select_data.length>0&&(e=this.select_data[0].id),this.$el.select2("val",e)},_template:function(e){return'<input type="hidden" value="'+this.options.initialData+'"/>'}});t.default={View:o}}).call(t,n(2),n(1))},,,,function(e,t,n){"use strict";(function(e,i,r){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(56),s=a(o),l=n(38),c=a(l),d=n(20),u=a(d),h=n(57),f=a(h),p=n(71),g=a(p),m=n(4),_=a(m),v=n(21),y=a(v),b=500;try{b=localStorage.getItem("historyContentsLimitPerPageDefault")||b}catch(e){}var w=s.default.PaginatedCollection,x=w.extend(_.default.LoggableMixin).extend({_logNamespace:"history",limitPerPage:b,limitPerProgressiveFetch:b,order:"hid",url:function(){return this.urlRoot+"/"+this.historyId+"/contents"},initialize:function(e,t){this.on({"sync add":this.trackJobStates}),t=t||{},this.urlRoot=Galaxy.root+"api/histories",w.prototype.initialize.call(this,e,t),this.history=t.history||null,this.setHistoryId(t.historyId||null),this.includeDeleted=t.includeDeleted||this.includeDeleted,this.includeHidden=t.includeHidden||this.includeHidden,this.model.prototype.idAttribute="type_id"},trackJobStates:function(){var e=this;this.each(function(t){if(!t.has("job_states_summary")&&"dataset_collection"===t.attributes.history_content_type){var n=t.attributes.job_source_type,i=t.attributes.job_source_id;if(n&&e.jobStateSummariesCollection){e.jobStateSummariesCollection.add({id:i,model:n,history_id:e.history_id,collection_id:t.attributes.id});var r=e.jobStateSummariesCollection.get(i);t.jobStatesSummary=r}}})},model:function(e,t){return"dataset"===e.history_content_type?new c.default.HistoryDatasetAssociation(e,t):"dataset_collection"===e.history_content_type?new u.default.HistoryDatasetCollection(e,t):{validationError:"Unknown history_content_type: "+e.history_content_type}},stopPolling:function(){this.jobStateSummariesCollection&&(this.jobStateSummariesCollection.active=!1,this.jobStateSummariesCollection.clearUpdateTimeout())},setHistoryId:function(e){this.stopPolling(),this.historyId=e,e&&(this._setUpWebStorage(),this.jobStateSummariesCollection=new g.default.JobStatesSummaryCollection,this.jobStateSummariesCollection.historyId=e,this.jobStateSummariesCollection.monitor())},_setUpWebStorage:function(e){return this.storage=new f.default.HistoryPrefs({id:f.default.HistoryPrefs.historyStorageKey(this.historyId)}),this.trigger("new-storage",this.storage,this),this.on({"include-deleted":function(e){this.storage.includeDeleted(e)},"include-hidden":function(e){this.storage.includeHidden(e)}}),this.includeDeleted=this.storage.includeDeleted()||!1,this.includeHidden=this.storage.includeHidden()||!1,this},comparators:e.extend(e.clone(w.prototype.comparators),{name:_.default.buildComparator("name",{ascending:!0}),"name-dsc":_.default.buildComparator("name",{ascending:!1}),hid:_.default.buildComparator("hid",{ascending:!1}),"hid-asc":_.default.buildComparator("hid",{ascending:!0})}),running:function(){return this.filter(function(e){return!e.inReadyState()})},runningAndActive:function(){return this.filter(function(e){return!e.inReadyState()&&e.get("visible")&&!e.get("deleted")})},getByHid:function(e){return this.findWhere({hid:e})},haveDetails:function(){return this.all(function(e){return e.hasDetails()})},hidden:function(){return this.filter(function(e){return e.hidden()})},deleted:function(){return this.filter(function(e){return e.get("deleted")})},visibleAndUndeleted:function(){return this.filter(function(e){return e.get("visible")&&!e.get("deleted")})},setIncludeDeleted:function(t,n){if(e.isBoolean(t)&&t!==this.includeDeleted){if(this.includeDeleted=t,e.result(n,"silent"))return;this.trigger("include-deleted",t,this)}},setIncludeHidden:function(t,n){if(e.isBoolean(t)&&t!==this.includeHidden){if(this.includeHidden=t,n=n||{},e.result(n,"silent"))return;this.trigger("include-hidden",t,this)}},fetch:function(t){if(t=t||{},this.historyId&&!t.details){var n=f.default.HistoryPrefs.get(this.historyId).toJSON();e.isEmpty(n.expandedIds)||(t.details=e.values(n.expandedIds).join(","))}return w.prototype.fetch.call(this,t)},_buildFetchData:function(t){return e.extend(w.prototype._buildFetchData.call(this,t),{v:"dev"})},_fetchParams:w.prototype._fetchParams.concat(["v","details"]),_buildFetchFilters:function(t){var n=w.prototype._buildFetchFilters.call(this,t)||{},i={};return this.includeDeleted||(i.deleted=!1,i.purged=!1),this.includeHidden||(i.visible=!0),e.defaults(n,i)},getTotalItemCount:function(){return this.history.contentsShown()},fetchUpdated:function(e,t){return e&&(t=t||{filters:{}},t.remove=!1,t.filters={"update_time-ge":e.toISOString(),visible:""}),this.fetch(t)},fetchDeleted:function(t){var n=this;return t=t||{},t.filters=e.extend(t.filters,{deleted:!0,purged:void 0}),t.remove=!1,this.trigger("fetching-deleted",this),this.fetch(t).always(function(){n.trigger("fetching-deleted-done",n)})},fetchHidden:function(t){t=t||{};var n=this;return t.filters=e.extend(t.filters,{visible:!1}),t.remove=!1,n.trigger("fetching-hidden",n),n.fetch(t).always(function(){n.trigger("fetching-hidden-done",n)})},fetchAllDetails:function(t){t=t||{};var n={details:"all"};return t.data=e.extend(t.data||{},n),this.fetch(t)},_filterAndUpdate:function(e,t){var n=this,i=n.model.prototype.idAttribute,r=[t];return n.fetch({filters:e,remove:!1}).then(function(e){return e=e.reduce(function(e,t,r){var a=n.get(t[i]);return a?e.concat(a):e},[]),n.ajaxQueue("save",r,e)})},ajaxQueue:function(t,n,i){return i=i||this.models,new y.default.AjaxQueue(i.slice().reverse().map(function(i,r){var a=e.isString(t)?i[t]:t;return function(){return a.apply(i,n)}})).deferred},progressivelyFetchDetails:function(t){function n(i){i=i||0;var s=e.extend(e.clone(t),{view:"summary",keys:l,limit:o,offset:i,reset:0===i,remove:!1});e.defer(function(){a.fetch.call(a,s).fail(r.reject).done(function(e){r.notify(e,o,i),e.length!==o?(a.allFetched=!0,r.resolve(e,o,i)):n(i+o)})})}t=t||{};var r=i.Deferred(),a=this,o=t.limitPerCall||a.limitPerProgressiveFetch,s=c.default.HistoryDatasetAssociation.prototype.searchAttributes,l=s.join(",");return n(),r},isCopyable:function(t){var n=["HistoryDatasetAssociation","HistoryDatasetCollectionAssociation"];return e.isObject(t)&&t.id&&e.contains(n,t.model_class)},copy:function(t){var n,r,a;e.isString(t)?(n=t,a="hda",r="dataset"):(n=t.id,a={HistoryDatasetAssociation:"hda",LibraryDatasetDatasetAssociation:"ldda",HistoryDatasetCollectionAssociation:"hdca"}[t.model_class]||"hda",r="hdca"===a?"dataset_collection":"dataset");var o=this,s=i.ajax(this.url(),{method:"POST",contentType:"application/json",data:JSON.stringify({content:n,source:a,type:r})}).done(function(e){o.add([e],{parse:!0})}).fail(function(e,t,i){o.trigger("error",o,s,{},"Error copying contents",{type:r,id:n,source:a})});return s},createHDCA:function(e,t,n,i,r){return this.model({history_content_type:"dataset_collection",collection_type:t,history_id:this.historyId,name:n,hide_source_items:i||!1,element_identifiers:e}).save(r)},haveSearchDetails:function(){return this.allFetched&&this.all(function(t){return e.has(t.attributes,"annotation")})},matches:function(e){return this.filter(function(t){return t.matches(e)})},clone:function(){var e=r.Collection.prototype.clone.call(this);return e.historyId=this.historyId,e},toString:function(){return["HistoryContents(",[this.historyId,this.length].join(),")"].join("")}});t.default={HistoryContents:x}}).call(t,n(1),n(0),n(2))},function(e,t,n){"use strict";(function(e,i,r,a){function o(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var s=n(22),l=o(s),c=n(8),d=o(c),u=n(10),h=o(u),f=n(4),p=o(f),g=n(3),m=o(g),_=l.default.ListItemView,v=_.extend({_logNamespace:"dataset",className:_.prototype.className+" dataset",id:function(){return["dataset",this.model.get("id")].join("-")},initialize:function(e){e.logger&&(this.logger=this.model.logger=e.logger),this.log(this+".initialize:",e),_.prototype.initialize.call(this,e),this.linkTarget=e.linkTarget||"_blank"},_setUpListeners:function(){_.prototype._setUpListeners.call(this);var t=this;return t.listenTo(t.model,{change:function(n){t.model.changedAttributes().state&&t.model.inReadyState()&&t.expanded&&!t.model.hasDetails()?t.model.fetch({silent:!0}).done(function(){t.render()}):e.has(n.changed,"tags")&&1===e.keys(n.changed).length?t.$(".nametags").html(t._renderNametags()):t.render()}})},_fetchModelDetails:function(){var e=this;return e.model.inReadyState()&&!e.model.hasDetails()?e.model.fetch({silent:!0}):i.when()},remove:function(e,t){var n=this;e=e||this.fxSpeed,this.$el.fadeOut(e,function(){r.View.prototype.remove.call(n),t&&t.call(n)})},_swapNewRender:function(e){return _.prototype._swapNewRender.call(this,e),this.model.has("state")&&this.$el.addClass("state-"+this.model.get("state")),this.$el},_renderPrimaryActions:function(){return[this._renderDisplayButton()]},_renderDisplayButton:function(){var e=this.model.get("state");if(e===d.default.NOT_VIEWABLE||e===d.default.DISCARDED||!this.model.get("accessible"))return null;var t={target:this.linkTarget,classes:"display-btn"};if(this.model.get("purged"))t.disabled=!0,t.title=(0,m.default)("Cannot display datasets removed from disk");else if(e===d.default.UPLOAD)t.disabled=!0,t.title=(0,m.default)("This dataset must finish uploading before it can be viewed");else if(e===d.default.NEW)t.disabled=!0,t.title=(0,m.default)("This dataset is not yet viewable");else{t.title=(0,m.default)("View data"),t.href=this.model.urls.display;var n=this;t.onclick=function(e){Galaxy.frame&&Galaxy.frame.active&&(Galaxy.frame.addDataset(n.model.get("id")),e.preventDefault())}}return t.faIcon="fa-eye",(0,h.default)(t)},_renderDetails:function(){if(this.model.get("state")===d.default.NOT_VIEWABLE)return a(this.templates.noAccess(this.model.toJSON(),this));var e=_.prototype._renderDetails.call(this);return e.find(".actions .left").empty().append(this._renderSecondaryActions()),e.find(".summary").html(this._renderSummary()).prepend(this._renderDetailMessages()),e.find(".display-applications").html(this._renderDisplayApplications()),this._setUpBehaviors(e),e},_renderSummary:function(){var e=this.model.toJSON(),t=this.templates.summaries[e.state];return(t=t||this.templates.summaries.unknown)(e,this)},_renderDetailMessages:function(){var t=this,n=a('<div class="detail-messages"></div>'),i=t.model.toJSON();return e.each(t.templates.detailMessages,function(e){n.append(a(e(i,t)))}),n},_renderDisplayApplications:function(){return this.model.isDeletedOrPurged()?"":[this.templates.displayApplications(this.model.get("display_apps"),this),this.templates.displayApplications(this.model.get("display_types"),this)].join("")},_renderSecondaryActions:function(){switch(this.debug("_renderSecondaryActions"),this.model.get("state")){case d.default.NOT_VIEWABLE:return[];case d.default.OK:case d.default.FAILED_METADATA:case d.default.ERROR:return[this._renderDownloadButton(),this._renderShowParamsButton()]}return[this._renderShowParamsButton()]},_renderShowParamsButton:function(){return(0,h.default)({title:(0,m.default)("View details"),classes:"params-btn",href:this.model.urls.show_params,target:this.linkTarget,faIcon:"fa-info-circle",onclick:function(e){Galaxy.frame&&Galaxy.frame.active&&(Galaxy.frame.add({title:(0,m.default)("Dataset details"),url:this.href}),e.preventDefault(),e.stopPropagation())}})},_renderDownloadButton:function(){return this.model.get("purged")||!this.model.hasData()?null:e.isEmpty(this.model.get("meta_files"))?a('\n                <a class="download-btn icon-btn" href="'+this.model.urls.download+'" title="'+(0,m.default)("Download")+'">\n                    <span class="fa fa-floppy-o"></span>\n                </a>'):this._renderMetaFileDownloadButton()},_renderMetaFileDownloadButton:function(){var t=this.model.urls;return a('\n                <div class="metafile-dropdown dropdown">\n                    <a class="download-btn icon-btn" href="'+t.download+'" data-toggle="dropdown" title="'+(0,m.default)("Download")+'">\n                        <span class="fa fa-floppy-o"></span>\n                    </a>\n                    <ul class="dropdown-menu" role="menu">\n                        <li>\n                            <a href="'+t.download+'">\n                                '+(0,m.default)("Download dataset")+"\n                            </a>\n                        </li>\n                        "+e.map(this.model.get("meta_files"),function(e){return'<li>\n                                    <a href="'+(t.meta_download+e.file_type)+'">\n                                        '+(0,m.default)("Download")+" "+e.file_type+"\n                                    </a>\n                                </li>"})+"\n                    </ul>\n                </div>")},_renderNametags:function(){return e.template(["<% _.each(_.sortBy(_.uniq(tags), function(x) { return x }), function(tag){ %>",'<% if (tag.indexOf("name:") == 0){ %>','<span class="label label-info"><%- tag.slice(5) %></span>',"<% } %>","<% }); %>"].join(""))({tags:this.model.get("tags")})},events:e.extend(e.clone(_.prototype.events),{"click .display-btn":function(e){this.trigger("display",this,e)},"click .params-btn":function(e){this.trigger("params",this,e)},"click .download-btn":function(e){this.trigger("download",this,e)}}),toString:function(){return"DatasetListItemView("+(this.model?""+this.model:"(no model)")+")"}});v.prototype.templates=function(){var t=e.extend({},_.prototype.templates.warnings,{failed_metadata:p.default.wrapTemplate(['<% if( model.state === "failed_metadata" ){ %>','<div class="warningmessagesmall">',(0,m.default)("An error occurred setting the metadata for this dataset"),"</div>","<% } %>"]),error:p.default.wrapTemplate(["<% if( model.error ){ %>",'<div class="errormessagesmall">',(0,m.default)("There was an error getting the data for this dataset"),": <%- model.error %>","</div>","<% } %>"]),purged:p.default.wrapTemplate(["<% if( model.purged ){ %>",'<div class="purged-msg warningmessagesmall">',(0,m.default)("This dataset has been deleted and removed from disk"),"</div>","<% } %>"]),deleted:p.default.wrapTemplate(["<% if( model.deleted && !model.purged ){ %>",'<div class="deleted-msg warningmessagesmall">',(0,m.default)("This dataset has been deleted"),"</div>","<% } %>"])}),n=p.default.wrapTemplate(['<div class="details">','<div class="summary"></div>','<div class="actions clear">','<div class="left"></div>','<div class="right"></div>',"</div>","<% if( !dataset.deleted && !dataset.purged ){ %>",'<div class="tags-display"></div>','<div class="annotation-display"></div>','<div class="display-applications"></div>',"<% if( dataset.peek ){ %>",'<pre class="dataset-peek"><%= dataset.peek %></pre>',"<% } %>","<% } %>","</div>"],"dataset"),i=p.default.wrapTemplate(['<div class="details">','<div class="summary">',(0,m.default)("You do not have permission to view this dataset"),"</div>","</div>"],"dataset"),r={};r[d.default.OK]=r[d.default.FAILED_METADATA]=p.default.wrapTemplate(["<% if( dataset.misc_blurb ){ %>",'<div class="blurb">','<span class="value"><%- dataset.misc_blurb %></span>',"</div>","<% } %>","<% if( dataset.file_ext ){ %>",'<div class="datatype">','<label class="prompt">',(0,m.default)("format"),"</label>",'<span class="value"><%- dataset.file_ext %></span>',"</div>","<% } %>","<% if( dataset.metadata_dbkey ){ %>",'<div class="dbkey">','<label class="prompt">',(0,m.default)("database"),"</label>",'<span class="value">',"<%- dataset.metadata_dbkey %>","</span>","</div>","<% } %>","<% if( dataset.misc_info ){ %>",'<div class="info">','<span class="value"><%- dataset.misc_info %></span>',"</div>","<% } %>"],"dataset"),r[d.default.NEW]=p.default.wrapTemplate(["<div>",(0,m.default)("This is a new dataset and not all of its data are available yet"),"</div>"],"dataset"),r[d.default.NOT_VIEWABLE]=p.default.wrapTemplate(["<div>",(0,m.default)("You do not have permission to view this dataset"),"</div>"],"dataset"),r[d.default.DISCARDED]=p.default.wrapTemplate(["<div>",(0,m.default)("The job creating this dataset was cancelled before completion"),"</div>"],"dataset"),r[d.default.QUEUED]=p.default.wrapTemplate(["<div>",(0,m.default)("This job is waiting to run"),"</div>"],"dataset"),r[d.default.RUNNING]=p.default.wrapTemplate(["<div>",(0,m.default)("This job is currently running"),"</div>"],"dataset"),r[d.default.UPLOAD]=p.default.wrapTemplate(["<div>",(0,m.default)("This dataset is currently uploading"),"</div>"],"dataset"),r[d.default.SETTING_METADATA]=p.default.wrapTemplate(["<div>",(0,m.default)("Metadata is being auto-detected"),"</div>"],"dataset"),r[d.default.PAUSED]=p.default.wrapTemplate(["<div>",(0,m.default)('This job is paused. Use the "Resume Paused Jobs" in the history menu to resume'),"</div>"],"dataset"),r[d.default.ERROR]=p.default.wrapTemplate(["<% if( !dataset.purged ){ %>","<div><%- dataset.misc_blurb %></div>","<% } %>",'<span class="help-text">',(0,m.default)("An error occurred with this dataset"),":</span>",'<div class="job-error-text"><%- dataset.misc_info %></div>'],"dataset"),r[d.default.EMPTY]=p.default.wrapTemplate(["<div>",(0,m.default)("No data"),": <i><%- dataset.misc_blurb %></i></div>"],"dataset"),r.unknown=p.default.wrapTemplate(['<div>Error: unknown dataset state: "<%- dataset.state %>"</div>'],"dataset");var a={resubmitted:p.default.wrapTemplate(["<% if( model.resubmitted ){ %>",'<div class="resubmitted-msg infomessagesmall">',(0,m.default)("The job creating this dataset has been resubmitted"),"</div>","<% } %>"])},o=p.default.wrapTemplate(["<% _.each( apps, function( app ){ %>",'<div class="display-application">','<span class="display-application-location"><%- app.label %></span> ','<span class="display-application-links">',"<% _.each( app.links, function( link ){ %>",'<a target="<%- link.target %>" href="<%- link.href %>">',"<% print( _l( link.text ) ); %>","</a> ","<% }); %>","</span>","</div>","<% }); %>"],"apps");return e.extend({},_.prototype.templates,{warnings:t,details:n,noAccess:i,summaries:r,detailMessages:a,displayApplications:o})}(),t.default={DatasetListItemView:v}}).call(t,n(1),n(0),n(2),n(0))},function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0});var i=n(316),r=function(e){return e&&e.__esModule?e:{default:e}}(i),a=e.Model.extend({urlRoot:Galaxy.root+"api/libraries/",isVisible:function(e){var t=!0;return!e&&this.get("deleted")&&(t=!1),t}}),o=e.Collection.extend({urlRoot:Galaxy.root+"api/libraries",model:a,initialize:function(e){e=e||{}},search:function(e){if(""==e)return this;var t=e.toLowerCase();return this.filter(function(e){return-1!==e.get("name").toLowerCase().indexOf(t)})},getVisible:function(e,t){return t=t||[],new o(this.filter(function(t){return t.isVisible(e)}))},sortLibraries:function(e,t){this.comparator=r.default.generateLibraryComparator(e,t),this.sort()}}),s=e.Model.extend({}),l=s.extend({urlRoot:Galaxy.root+"api/libraries/datasets/"}),c=s.extend({urlRoot:Galaxy.root+"api/folders/"}),d=e.Collection.extend({model:s,sortFolder:function(e,t){this.comparator=r.default.generateFolderComparator(e,t),this.sort()}}),u=e.Model.extend({defaults:{folder:new d,urlRoot:Galaxy.root+"api/folders/",id:"unknown"},parse:function(e){this.get("folder").reset();for(var t=0;t<e.folder_contents.length;t++)if("folder"===e.folder_contents[t].type){var n=new c(e.folder_contents[t]);this.get("folder").add(n)}else if("file"===e.folder_contents[t].type){var i=new l(e.folder_contents[t]);this.get("folder").add(i)}else Galaxy.emit.error("Unknown folder item type encountered while parsing response.");return e}}),h=e.Model.extend({urlRoot:Galaxy.root+"api/histories/"}),f=e.Collection.extend({urlRoot:Galaxy.root+"api/histories/",initialize:function(e){this.id=e.id},url:function(){return this.urlRoot+this.id+"/contents"},model:h}),p=e.Model.extend({urlRoot:Galaxy.root+"api/histories/"}),g=e.Collection.extend({url:Galaxy.root+"api/histories",model:p}),m=e.Model.extend({urlRoot:Galaxy.root+"api/remote_files"});t.default={Library:a,Libraries:o,Item:l,Ldda:l,FolderAsModel:c,Folder:d,FolderContainer:u,HistoryItem:h,HistoryContents:f,GalaxyHistory:p,GalaxyHistories:g,Jstree:m}}).call(t,n(2))},,function(e,t,n){"use strict";(function(e){function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var r=n(30),a=i(r),o=n(51),s=i(o),l=n(3),c=(i(l),s.default.HistoryContentMixin),d=a.default.DatasetCollection,u=d.extend(c).extend({defaults:e.extend(e.clone(d.prototype.defaults),{history_content_type:"dataset_collection",model_class:"HistoryDatasetCollectionAssociation"}),save:function(e,t){return this.isNew()&&(t=t||{},t.url=this.urlRoot+this.get("history_id")+"/contents",e=e||{},e.type="dataset_collection"),d.prototype.save.call(this,e,t)},toString:function(){return"History"+d.prototype.toString.call(this)}});t.default={HistoryDatasetCollection:u}}).call(t,n(1))},function(e,t,n){"use strict";(function(e){function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function e(t,n,i){null===t&&(t=Function.prototype);var r=Object.getOwnPropertyDescriptor(t,n);if(void 0===r){var a=Object.getPrototypeOf(t);return null===a?void 0:e(a,n,i)}if("value"in r)return r.value;var o=r.get;if(void 0!==o)return o.call(i)},o=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),s=function(){function t(n){r(this,t),this.deferred=e.Deferred(),this.queue=[],this.responses=[],this.numToProcess=0,this.running=!1,this.init(n||[]),this.start()}return o(t,[{key:"init",value:function(e){var t=this;e.forEach(function(e){t.add(e)})}},{key:"add",value:function(e){var t=this,n=this.queue.length;return this.numToProcess+=1,this.queue.push(function(){var i=n,r=e();r.done(function(e){t.deferred.notify({curr:i,total:t.numToProcess,response:e})}),r.always(function(e){t.responses.push(e),t.queue.length?t.queue.shift()():t.stop()})}),this}},{key:"start",value:function(){return this.queue.length&&(this.running=!0,this.queue.shift()()),this}},{key:"stop",value:function(t,n){return this.running=!1,this.queue=[],t?this.deferred.reject(n):this.deferred.resolve(this.responses),this.numToProcess=0,this.deferred=e.Deferred(),this}},{key:"done",value:function(e){return this.deferred.done(e)}},{key:"fail",value:function(e){return this.deferred.fail(e)}},{key:"always",value:function(e){return this.deferred.always(e)}},{key:"progress",value:function(e){return this.deferred.progress(e)}}],[{key:"create",value:function(e){return new t(e).deferred}}]),t}(),l=function(e){function t(e){r(this,t);var i=n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.names={},i}return i(t,e),o(t,[{key:"add",value:function(e){if(!e.hasOwnProperty("name")||!e.hasOwnProperty("fn"))throw new Error('NamedAjaxQueue.add requires an object with both "name" and "fn": '+JSON.stringify(e));if(!this.names.hasOwnProperty(e.name))return this.names[e.name]=!0,a(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"add",this).call(this,e.fn)}},{key:"clear",value:function(){return this.names={},this}}],[{key:"create",value:function(e){return new t(e).deferred}}]),t}(s);t.default={AjaxQueue:s,NamedAjaxQueue:l}}).call(t,n(0))},function(e,t,n){"use strict";(function(e,i,r,a){function o(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var s=n(4),l=o(s),c=n(3),d=(o(c),e.View.extend(l.default.LoggableMixin).extend({_logNamespace:"list",initialize:function(e){this.expanded=e.expanded||!1,this.log("\t expanded:",this.expanded),this.fxSpeed=void 0!==e.fxSpeed?e.fxSpeed:this.fxSpeed},fxSpeed:"fast",render:function(e){var t=this._buildNewRender();return this._setUpBehaviors(t),this._queueNewRender(t,e),this},_buildNewRender:function(){var e=i(this.templates.el(this.model.toJSON(),this));return this.expanded&&this.$details(e).replaceWith(this._renderDetails().show()),e},_queueNewRender:function(e,t){t=void 0===t?this.fxSpeed:t;var n=this;0===t?(n._swapNewRender(e),n.trigger("rendered",n)):i(n).queue("fx",[function(e){n.$el.fadeOut(t,e)},function(t){n._swapNewRender(e),t()},function(e){n.$el.fadeIn(t,e)},function(e){n.trigger("rendered",n),e()}])},_swapNewRender:function(e){return this.$el.empty().attr("class",r.isFunction(this.className)?this.className():this.className).append(e.children())},_setUpBehaviors:function(e){e=e||this.$el,e.find("[title]").tooltip({placement:"bottom"})},$details:function(e){return e=e||this.$el,e.find("> .details")},_renderDetails:function(){var e=i(this.templates.details(this.model.toJSON(),this));return this._setUpBehaviors(e),e},toggleExpanded:function(e){return e=void 0===e?!this.expanded:e,e?this.expand():this.collapse(),this},expand:function(){var e=this;return e._fetchModelDetails().always(function(){e._expand()})},_fetchModelDetails:function(){return this.model.hasDetails()?a.when():this.model.fetch()},_expand:function(){var e=this,t=e._renderDetails();e.$details().replaceWith(t),e.expanded=!0,e.$details().slideDown(e.fxSpeed,function(){e.trigger("expanded",e)})},collapse:function(){this.debug(this+"(ExpandableView).collapse");var e=this;e.expanded=!1,this.$details().slideUp(e.fxSpeed,function(){e.trigger("collapsed",e)})}})),u=d.extend(l.default.mixin(l.default.SelectableViewMixin,l.default.DraggableViewMixin,{tagName:"div",className:"list-item",initialize:function(e){d.prototype.initialize.call(this,e),l.default.SelectableViewMixin.initialize.call(this,e),l.default.DraggableViewMixin.initialize.call(this,e),this._setUpListeners()},_setUpListeners:function(){return this.on("selectable",function(e){e?this.$(".primary-actions").hide():this.$(".primary-actions").show()},this),this},_buildNewRender:function(){var e=d.prototype._buildNewRender.call(this);return e.children(".warnings").replaceWith(this._renderWarnings()),e.children(".title-bar").replaceWith(this._renderTitleBar()),e.children(".primary-actions").append(this._renderPrimaryActions()),e.find("> .title-bar .subtitle").replaceWith(this._renderSubtitle()),e},_swapNewRender:function(e){return d.prototype._swapNewRender.call(this,e),this.selectable&&this.showSelector(0),this.draggable&&this.draggableOn(),this.$el},_renderWarnings:function(){var e=this,t=i('<div class="warnings"></div>'),n=e.model.toJSON();return r.each(e.templates.warnings,function(r){t.append(i(r(n,e)))}),t},_renderTitleBar:function(){return i(this.templates.titleBar(this.model.toJSON(),this))},_renderPrimaryActions:function(){return[]},_renderSubtitle:function(){return i(this.templates.subtitle(this.model.toJSON(),this))},events:{"click .title-bar":"_clickTitleBar","keydown .title-bar":"_keyDownTitleBar","click .selector":"toggleSelect"},_clickTitleBar:function(e){e.stopPropagation(),e.altKey?(this.toggleSelect(e),this.selectable||this.showSelector()):this.toggleExpanded()},_keyDownTitleBar:function(e){return!e||"keydown"!==e.type||32!==e.keyCode&&13!==e.keyCode||(this.toggleExpanded(),e.stopPropagation(),!1)},toString:function(){return"ListItemView("+(this.model?""+this.model:"(no model)")+")"}}));u.prototype.templates=function(){return{el:l.default.wrapTemplate(['<div class="list-element">','<div class="warnings"></div>','<div class="selector">','<span class="fa fa-2x fa-square-o"></span>',"</div>",'<div class="primary-actions"></div>','<div class="title-bar"></div>','<div class="details"></div>',"</div>"]),warnings:{},titleBar:l.default.wrapTemplate(['<div class="title-bar clear" tabindex="0">','<span class="state-icon"></span>','<div class="title">','<span class="name"><%- element.name %></span>',"</div>",'<div class="subtitle"></div>',"</div>"],"element"),subtitle:l.default.wrapTemplate(['<div class="subtitle"></div>']),details:l.default.wrapTemplate(['<div class="details"></div>'])}}();var h=u.extend({foldoutStyle:"foldout",foldoutPanelClass:null,initialize:function(e){"drilldown"===this.foldoutStyle&&(this.expanded=!1),this.foldoutStyle=e.foldoutStyle||this.foldoutStyle,this.foldoutPanelClass=e.foldoutPanelClass||this.foldoutPanelClass,u.prototype.initialize.call(this,e),this.foldout=this._createFoldoutPanel()},_renderDetails:function(){if("drilldown"===this.foldoutStyle)return i();var e=u.prototype._renderDetails.call(this);return this._attachFoldout(this.foldout,e)},_createFoldoutPanel:function(){var e=this.model,t=this._getFoldoutPanelClass(e),n=this._getFoldoutPanelOptions(e);return new t(r.extend(n,{model:e}))},_getFoldoutPanelClass:function(){return this.foldoutPanelClass},_getFoldoutPanelOptions:function(){return{foldoutStyle:this.foldoutStyle,fxSpeed:this.fxSpeed}},_attachFoldout:function(e,t){return t=t||this.$("> .details"),this.foldout=e.render(0),e.$("> .controls").hide(),t.append(e.$el)},expand:function(){var e=this;return e._fetchModelDetails().always(function(){"foldout"===e.foldoutStyle?e._expand():"drilldown"===e.foldoutStyle&&e._expandByDrilldown()})},_expandByDrilldown:function(){var e=this;e.listenTo(e.foldout,"close",function(){e.trigger("collapsed:drilldown",e,e.foldout)}),e.trigger("expanded:drilldown",e,e.foldout)}});h.prototype.templates=function(){var e=l.default.wrapTemplate(['<div class="details">',"</div>"],"collection");return r.extend({},u.prototype.templates,{details:e})}(),t.default={ExpandableView:d,ListItemView:u,FoldoutListItemView:h}}).call(t,n(2),n(0),n(1),n(0))},function(e,t,n){"use strict";(function(e,i){function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var a=n(4),o=r(a),s=n(3),l=r(s),c=e.View.extend(o.default.LoggableMixin).extend(o.default.HiddenUntilActivatedViewMixin).extend({tagName:"div",className:"tags-display",select_width:"100%",events:{},initialize:function(e){this.show_editor=!1,!1===e.usePrompt?this.label="":this.label='<label class="prompt">'+(0,l.default)("Tags")+"</label>",this.workflow_mode=e.workflow_mode||!1,this.workflow_mode&&(this.events.click="showEditor",this.events.keydown="keydownHandler"),this.hiddenUntilActivated(e.$activator,e)},render:function(){var e=this;return this.workflow_mode?this.$el.html(this._workflowTemplate()):this.$el.html(this._defaultTemplate()),this.$input().select2({placeholder:"Add tags",width:this.workflow_mode?this.width:this.select_width,tags:function(){return e._getTagsUsed()}}),this._setUpBehaviors(),this},_hashToName:function(e){return e.startsWith("#")?"name:"+e.slice(1):e},_nameToHash:function(e){return e.startsWith("name:")&&(e="#"+e.slice(5)),e},_defaultTemplate:function(){return[this.label,this._renderEditor()].join("")},_workflowTemplate:function(){return[this.show_editor?this._renderEditor():this._renderTags()].join(" ")},keydownHandler:function(e){switch(e.which){case 27:this.hideEditor()}},showEditor:function(){this.show_editor=!0,this.render()},hideEditor:function(){this.show_editor=!1,this.render()},_renderEditor:function(){return'<input class="tags-input" value="'+this.tagsToCSV()+'"/>'},_renderTags:function(){var e=this.model.get("tags"),t=Galaxy.root+"static/images/fugue/tag--plus.png",n=[];return i.each(e,function(e){e=0==e.indexOf("name:")?e.slice(5):e;var t='<span class="label label-info">'+e+"</span>";n.push(t)}),0===n.length&&n.push("<img src="+t+' class="add-tag-button" title="Add tags"/>'),n.join(" ")},tagsToCSV:function(){var e=this,t=this.model.get("tags");return!i.isArray(t)||i.isEmpty(t)?"":t.map(function(t){return i.escape(e._nameToHash(t))}).sort().join(",")},$input:function(){return this.$el.find("input.tags-input")},_getTagsUsed:function(){var e=this;return i.map(Galaxy.user.get("tags_used"),e._nameToHash)},_setUpBehaviors:function(){var e=this;this.$input().on("change",function(t){t.val=i.map(t.val,e._hashToName),e.model.save({tags:t.val}),t.added&&e._addNewTagToTagsUsed(""+t.added.text)})},_addNewTagToTagsUsed:function(e){var t=Galaxy.user.get("tags_used");i.contains(t,e)||(t.push(e),t.sort(),Galaxy.user.set("tags_used",t))},remove:function(){this.$input.off(),this.stopListening(this.model),e.View.prototype.remove.call(this)},toString:function(){return["TagsEditor(",""+this.model,")"].join("")}});t.default={TagsEditor:c}}).call(t,n(2),n(1))},,,,,,function(e,t,n){"use strict";(function(e,i,r,a){function o(e){return e&&e.__esModule?e:{default:e}}function s(e,t){var n=e.toJSON();return M(n,{defaultHideSourceItems:t,creationFn:function(t,n,i){return t=t.map(function(e){return{id:e.id,name:e.name,src:"dataset"===e.history_content_type?"hda":"hdca"}}),e.createHDCA(t,"list",n,i)}})}Object.defineProperty(t,"__esModule",{value:!0});var l=n(20),c=o(l),d=n(8),u=o(d),h=n(4),f=o(h),p=n(52),g=o(p),m=n(9),_=o(m),v=n(53),y=(o(v),n(3)),b=o(y);n(54);var w=e.View.extend(f.default.LoggableMixin).extend({_logNamespace:"collections",tagName:"li",className:"collection-element",initialize:function(e){this.element=e.element||{},this.selected=e.selected||!1},render:function(){this.dragStartHandler=i.bind(this._dragstart,this),this.dragEndHandler=i.bind(this._dragend,this);var e=this.$el.attr("data-element-id",this.element.id).attr("draggable",!0).html(this.template({element:this.element})).get(0);return e.addEventListener("dragstart",this.dragStartHandler,!1),e.addEventListener("dragend",this.dragEndHandler,!1),this.selected&&this.$el.addClass("selected"),this},template:i.template(['<a class="name" title="',(0,b.default)("Click to rename"),'" href="javascript:void(0)">',"<%- element.name %>","</a>",'<button class="discard btn btn-sm" title="',(0,b.default)("Remove this dataset from the list"),'">',(0,b.default)("Discard"),"</button>"].join("")),select:function(e){this.$el.toggleClass("selected",e),this.trigger("select",{source:this,selected:this.$el.hasClass("selected")})},discard:function(){var e=this,t=this.$el.parent().width();this.$el.animate({"margin-right":t},"fast",function(){e.trigger("discard",{source:e}),e.destroy()})},destroy:function(){this.off(),this.$el.remove()},events:{click:"_click","click .name":"_clickName","click .discard":"_clickDiscard",dragover:"_sendToParent",drop:"_sendToParent"},_click:function(e){e.stopPropagation(),this.select(e)},_clickName:function(e){e.stopPropagation(),e.preventDefault();var t=([(0,b.default)("Enter a new name for the element"),":\n(",(0,b.default)("Note that changing the name here will not rename the dataset"),")"].join(""),prompt((0,b.default)("Enter a new name for the element")+":",this.element.name));t&&(this.element.name=t,this.render())},_clickDiscard:function(e){e.stopPropagation(),this.discard()},_dragstart:function(e){e.originalEvent&&(e=e.originalEvent),e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/plain",JSON.stringify(this.element)),this.$el.addClass("dragging"),this.$el.parent().trigger("collection-element.dragstart",[this])},_dragend:function(e){this.$el.removeClass("dragging"),this.$el.parent().trigger("collection-element.dragend",[this])},_sendToParent:function(e){this.$el.parent().trigger(e)},toString:function(){return"DatasetCollectionElementView()"}}),x=e.View.extend(f.default.LoggableMixin).extend(g.default.CollectionCreatorMixin).extend({_logNamespace:"collections",elementViewClass:w,collectionClass:c.default.HistoryDatasetCollection,className:"list-collection-creator collection-creator flex-row-container",minElements:1,defaultAttributes:{creationFn:function(){throw new TypeError("no creation fn for creator")},oncreate:function(){},oncancel:function(){},autoscrollDist:24,highlightClr:"rgba( 64, 255, 255, 1.0 )"},footerSettings:{".hide-originals":"hideOriginals"},initialize:function(e){this.metric("ListCollectionCreator.initialize",e);var t=this;i.each(this.defaultAttributes,function(n,i){n=e[i]||n,t[i]=n}),t.initialElements=e.elements||[],this._setUpCommonSettings(e),this._instanceSetUp(),this._elementsSetUp(),this._setUpBehaviors()},_instanceSetUp:function(){this.selectedIds={},this.$dragging=null,this.blocking=!1},_elementsSetUp:function(){this.invalidElements=[],this.workingElements=[],this.elementViews=[],this.workingElements=this.initialElements.slice(0),this._ensureElementIds(),this._validateElements(),this._mangleDuplicateNames(),this._sortElements()},_ensureElementIds:function(){return this.workingElements.forEach(function(e){e.hasOwnProperty("id")||(e.id=i.uniqueId())}),this.workingElements},_validateElements:function(){var e=this;return e.invalidElements=[],this.workingElements=this.workingElements.filter(function(t){var n=e._isElementInvalid(t);return n&&e.invalidElements.push({element:t,text:n}),!n}),this.workingElements},_isElementInvalid:function(e){return"dataset_collection"===e.history_content_type?(0,b.default)("is a collection, this is not allowed"):e.state===u.default.OK||i.contains(u.default.NOT_READY_STATES,e.state)?e.deleted||e.purged?(0,b.default)("has been deleted or purged"):null:(0,b.default)("has errored, is paused, or is not accessible")},_mangleDuplicateNames:function(){var e=1,t={};this.workingElements.forEach(function(n){for(var i=n.name;t.hasOwnProperty(i);)if(i=n.name+" ("+e+")",(e+=1)>=900)throw new Error("Safety hit in while loop - thats impressive");n.name=i,t[n.name]=!0})},_sortElements:function(e){},render:function(e,t){return this.workingElements.length<this.minElements?this._renderInvalid(e,t):(this.$el.empty().html(this.templates.main()),this._renderHeader(e),this._renderMiddle(e),this._renderFooter(e),this._addPluginComponents(),this.$(".collection-name").focus(),this.trigger("rendered",this),this)},_renderInvalid:function(e,t){return this.$el.empty().html(this.templates.invalidInitial({problems:this.invalidElements,elements:this.workingElements})),"function"==typeof this.oncancel&&this.$(".cancel-create.btn").show(),this.trigger("rendered",this),this},_renderHeader:function(e,t){var n=this.$(".header").empty().html(this.templates.header()).find(".help-content").prepend(r(this.templates.helpContent()));return this.invalidElements.length&&this._invalidElementsAlert(),n},_renderMiddle:function(e,t){var n=this.$(".middle").empty().html(this.templates.middle());return this._renderList(e),n},_addPluginComponents:function(){this.$(".help-content i").hoverhighlight(".collection-creator",this.highlightClr)},_invalidElementsAlert:function(){this._showAlert(this.templates.invalidElements({problems:this.invalidElements}),"alert-warning")},_disableNameAndCreate:function(e){(e=!!i.isUndefined(e)||e)&&(this.$(".collection-name").prop("disabled",!0),this.$(".create-collection").toggleClass("disabled",!0))},$list:function(){return this.$(".collection-elements")},_renderClearSelected:function(){i.size(this.selectedIds)?this.$(".collection-elements-controls > .clear-selected").show():this.$(".collection-elements-controls > .clear-selected").hide()},_renderList:function(e,t){var n=this,r=a("<div/>"),o=n.$list();i.each(this.elementViews,function(e){e.destroy(),n.removeElementView(e)}),n.workingElements.forEach(function(e){var t=n._createElementView(e);r.append(t.$el)}),n._renderClearSelected(),o.empty().append(r.children()),i.invoke(n.elementViews,"render"),o.height()>o.css("max-height")?o.css("border-width","1px 0px 1px 0px"):o.css("border-width","0px")},_createElementView:function(e){var t=new this.elementViewClass({element:e,selected:i.has(this.selectedIds,e.id)});return this.elementViews.push(t),this._listenToElementView(t),t},_listenToElementView:function(e){var t=this;t.listenTo(e,{select:function(e){var n=e.source.element;e.selected?t.selectedIds[n.id]=!0:delete t.selectedIds[n.id],t.trigger("elements:select",e)},discard:function(e){t.trigger("elements:discard",e)}})},addElementView:function(e){},removeElementView:function(e){delete this.selectedIds[e.element.id],this._renderClearSelected(),this.elementViews=i.without(this.elementViews,e),this.stopListening(e)},_renderNoElementsLeft:function(){this._disableNameAndCreate(!0),this.$(".collection-elements").append(this.templates.noElementsLeft())},_elementToJSON:function(e){return e},createList:function(e){if(!this.workingElements.length){var t=(0,b.default)("No valid elements for final list")+". ";return t+='<a class="cancel-create" href="javascript:void(0);">'+(0,b.default)("Cancel")+"</a> ",t+=(0,b.default)("or"),t+=' <a class="reset" href="javascript:void(0);">'+(0,b.default)("start over")+"</a>.",void this._showAlert(t)}var n=this,i=this.workingElements.map(function(e){return n._elementToJSON(e)});return n.blocking=!0,n.creationFn(i,e,n.hideOriginals).always(function(){n.blocking=!1}).fail(function(e,t,i){n.trigger("error",{xhr:e,status:t,message:(0,b.default)("An error occurred while creating this collection")})}).done(function(e,t,i){n.trigger("collection:created",e,t,i),n.metric("collection:created",e),"function"==typeof n.oncreate&&n.oncreate.call(this,e,t,i)})},_setUpBehaviors:function(){return this.on("error",this._errorHandler),this.once("rendered",function(){this.trigger("rendered:initial",this)}),this.on("elements:select",function(e){this._renderClearSelected()}),this.on("elements:discard",function(e){var t=e.source.element;this.removeElementView(e.source),this.workingElements=i.without(this.workingElements,t),this.workingElements.length||this._renderNoElementsLeft()}),this},_errorHandler:function(e){this.error(e);var t=this,n=e.message||(0,b.default)("An error occurred");if(e.xhr){var i=e.xhr,r=e.message;0===i.readyState&&0===i.status?n+=": "+(0,b.default)("Galaxy could not be reached and may be updating.")+(0,b.default)(" Try again in a few minutes."):i.responseJSON?n+=":<br /><pre>"+JSON.stringify(i.responseJSON)+"</pre>":n+=": "+r}t._showAlert(n,"alert-danger")},events:{"click .more-help":"_clickMoreHelp","click .less-help":"_clickLessHelp","click .main-help":"_toggleHelp","click .header .alert button":"_hideAlert","click .reset":"reset","click .clear-selected":"clearSelectedElements","click .collection-elements":"clearSelectedElements","dragover .collection-elements":"_dragoverElements","drop .collection-elements":"_dropElements","collection-element.dragstart .collection-elements":"_elementDragstart","collection-element.dragend   .collection-elements":"_elementDragend","change .collection-name":"_changeName","keydown .collection-name":"_nameCheckForEnter","change .hide-originals":"_changeHideOriginals","click .cancel-create":"_cancelCreate","click .create-collection":"_clickCreate"},reset:function(){this._instanceSetUp(),this._elementsSetUp(),this.render()},clearSelectedElements:function(e){this.$(".collection-elements .collection-element").removeClass("selected"),this.$(".collection-elements-controls > .clear-selected").hide()},_dragoverElements:function(e){e.preventDefault();var t=this.$list();this._checkForAutoscroll(t,e.originalEvent.clientY);var n=this._getNearestElement(e.originalEvent.clientY);this.$(".element-drop-placeholder").remove();var i=r('<div class="element-drop-placeholder"></div>');n.length?n.before(i):t.append(i)},_checkForAutoscroll:function(e,t){var n=e.offset(),i=e.scrollTop(),r=t-n.top,a=n.top+e.outerHeight()-t;r>=0&&r<this.autoscrollDist?e.scrollTop(i-2):a>=0&&a<this.autoscrollDist&&e.scrollTop(i+2)},_getNearestElement:function(e){for(var t=this.$(".collection-elements li.collection-element").toArray(),n=0;n<t.length;n++){var i=r(t[n]),a=i.offset().top,o=Math.floor(i.outerHeight()/2)+4;if(a+o>e&&a-o<e)return i}return r()},_dropElements:function(e){e.originalEvent&&(e=e.originalEvent),e.preventDefault(),e.dataTransfer.dropEffect="move";var t=this._getNearestElement(e.clientY);return t.length?this.$dragging.insertBefore(t):this.$dragging.insertAfter(this.$(".collection-elements .collection-element").last()),this._syncOrderToDom(),!1},_syncOrderToDom:function(){var e=this,t=[];this.$(".collection-elements .collection-element").each(function(){var n=r(this).attr("data-element-id"),a=i.findWhere(e.workingElements,{id:n});a?t.push(a):console.error("missing element: ",n)}),this.workingElements=t,this._renderList()},_elementDragstart:function(e,t){t.select(!0),this.$dragging=this.$(".collection-elements .collection-element.selected")},_elementDragend:function(e,t){r(".element-drop-placeholder").remove(),this.$dragging=null},templates:i.extend({},g.default.CollectionCreatorMixin._creatorTemplates,{header:i.template(['<div class="main-help well clear">','<a class="more-help" href="javascript:void(0);">',(0,b.default)("More help"),"</a>",'<div class="help-content">','<a class="less-help" href="javascript:void(0);">',(0,b.default)("Less"),"</a>","</div>","</div>",'<div class="alert alert-dismissable">','<button type="button" class="close" data-dismiss="alert" ','title="',(0,b.default)("Close and show more help"),'" aria-hidden="true">&times;</button>','<span class="alert-message"></span>',"</div>"].join("")),middle:i.template(['<div class="collection-elements-controls">','<a class="reset" href="javascript:void(0);" ','title="',(0,b.default)("Undo all reordering and discards"),'">',(0,b.default)("Start over"),"</a>",'<a class="clear-selected" href="javascript:void(0);" ','title="',(0,b.default)("De-select all selected datasets"),'">',(0,b.default)("Clear selected"),"</a>","</div>",'<div class="collection-elements scroll-container flex-row">',"</div>"].join("")),footer:i.template(['<div class="attributes clear">','<div class="clear">','<label class="setting-prompt pull-right">',(0,b.default)("Hide original elements"),"?",'<input class="hide-originals pull-right" type="checkbox" />',"</label>","</div>",'<div class="clear">','<input class="collection-name form-control pull-right" ','placeholder="',(0,b.default)("Enter a name for your new collection"),'" />','<div class="collection-name-prompt pull-right">',(0,b.default)("Name"),":</div>","</div>","</div>",'<div class="actions clear vertically-spaced">','<div class="other-options pull-left">','<button class="cancel-create btn" tabindex="-1">',(0,b.default)("Cancel"),"</button>",'<div class="create-other btn-group dropup">','<button class="btn btn-default dropdown-toggle" data-toggle="dropdown">',(0,b.default)("Create a different kind of collection"),' <span class="caret"></span>',"</button>",'<ul class="dropdown-menu" role="menu">','<li><a href="#">',(0,b.default)("Create a <i>single</i> pair"),"</a></li>",'<li><a href="#">',(0,b.default)("Create a list of <i>unpaired</i> datasets"),"</a></li>","</ul>","</div>","</div>",'<div class="main-options pull-right">','<button class="create-collection btn btn-primary">',(0,b.default)("Create list"),"</button>","</div>","</div>"].join("")),helpContent:i.template(["<p>",(0,b.default)(["Collections of datasets are permanent, ordered lists of datasets that can be passed to tools and ","workflows in order to have analyses done on each member of the entire group. This interface allows ","you to create a collection and re-order the final collection."].join("")),"</p>","<ul>","<li>",(0,b.default)(["Rename elements in the list by clicking on ",'<i data-target=".collection-element .name">the existing name</i>.'].join("")),"</li>","<li>",(0,b.default)(["Discard elements from the final created list by clicking on the ",'<i data-target=".collection-element .discard">"Discard"</i> button.'].join("")),"</li>","<li>",(0,b.default)(["Reorder the list by clicking and dragging elements. Select multiple elements by clicking on ",'<i data-target=".collection-element">them</i> and you can then move those selected by dragging the ',"entire group. Deselect them by clicking them again or by clicking the ",'the <i data-target=".clear-selected">"Clear selected"</i> link.'].join("")),"</li>","<li>",(0,b.default)(['Click the <i data-target=".reset">"Start over"</i> link to begin again as if you had just opened ',"the interface."].join("")),"</li>","<li>",(0,b.default)(['Click the <i data-target=".cancel-create">"Cancel"</i> button to exit the interface.'].join("")),"</li>","</ul><br />","<p>",(0,b.default)(['Once your collection is complete, enter a <i data-target=".collection-name">name</i> and ','click <i data-target=".create-collection">"Create list"</i>.'].join("")),"</p>"].join("")),invalidElements:i.template([(0,b.default)("The following selections could not be included due to problems:"),"<ul><% _.each( problems, function( problem ){ %>","<li><b><%- problem.element.name %></b>: <%- problem.text %></li>","<% }); %></ul>"].join("")),noElementsLeft:i.template(['<li class="no-elements-left-message">',(0,b.default)("No elements left! "),(0,b.default)("Would you like to "),'<a class="reset" href="javascript:void(0)">',(0,b.default)("start over"),"</a>?","</li>"].join("")),invalidInitial:i.template(['<div class="header flex-row no-flex">','<div class="alert alert-warning" style="display: block">','<span class="alert-message">',"<% if( _.size( problems ) ){ %>",(0,b.default)("The following selections could not be included due to problems"),":","<ul><% _.each( problems, function( problem ){ %>","<li><b><%- problem.element.name %></b>: <%- problem.text %></li>","<% }); %></ul>","<% } else if( _.size( elements ) < 1 ){ %>",(0,b.default)("No datasets were selected"),".","<% } %>","<br />",(0,b.default)("At least one element is needed for the collection"),". ",(0,b.default)("You may need to "),'<a class="cancel-create" href="javascript:void(0)">',(0,b.default)("cancel"),"</a> ",(0,b.default)("and reselect new elements"),".","</span>","</div>","</div>",'<div class="footer flex-row no-flex">','<div class="actions clear vertically-spaced">','<div class="other-options pull-left">','<button class="cancel-create btn" tabindex="-1">',(0,b.default)("Cancel"),"</button>","</div>","</div>","</div>"].join(""))}),toString:function(){return"ListCollectionCreator"}}),k=function(e,t,n){var r,o=a.Deferred(),s=Galaxy.modal||new _.default.View;return t=i.defaults(t||{},{elements:e,oncancel:function(){s.hide(),o.reject("cancelled")},oncreate:function(e,t){s.hide(),o.resolve(t)}}),r=new n(t),s.show({title:t.title||(0,b.default)("Create a collection"),body:r.$el,width:"80%",height:"100%",closing_events:!0}),r.render(),window._collectionCreator=r,o},M=function(e,t){return t=t||{},t.title=(0,b.default)("Create a collection from a list of datasets"),k(e,t,x)};t.default={DatasetCollectionElementView:w,ListCollectionCreator:x,collectionCreatorModal:k,listCollectionCreatorModal:M,createListCollection:s}}).call(t,n(2),n(1),n(0),n(0))},function(e,t,n){"use strict";(function(e,i,r){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(50),s=a(o),l=n(4),c=a(l),d=n(5),u=a(d),h=n(3),f=(a(h),{defaults:{model_class:"DatasetCollectionElement",element_identifier:null,element_index:null,element_type:null},_mergeObject:function(t){var n=t.object,i=this.elementId;return n&&(i=t.object.id,delete t.object.id),e.extend(t,t.object,{element_id:i}),delete t.object,t},constructor:function(e,t){e=this._mergeObject(e),this.idAttribute="element_id",i.Model.apply(this,arguments)},parse:function(e,t){var n=e;return n=this._mergeObject(n)}}),p=i.Model.extend(c.default.LoggableMixin).extend(f).extend({_logNamespace:"collections"}),g=i.Collection.extend(c.default.LoggableMixin).extend({_logNamespace:"collections",model:p,toString:function(){return["DatasetCollectionElementCollection(",this.length,")"].join("")}}),m=s.default.DatasetAssociation.extend(c.default.mixin(f,{url:function(){if(!this.has("history_id"))return console.warn("no endpoint for non-hdas within a collection yet"),Galaxy.root+"api/datasets";var e=this._getDatasetId();return Galaxy.root+"api/histories/"+this.get("history_id")+"/contents/"+e},_getDatasetId:function(){return this.get("element_id")},defaults:e.extend({},s.default.DatasetAssociation.prototype.defaults,f.defaults),_downloadQueryParameters:function(){var e=this.get("file_ext"),t=this.get("element_identifier");return"?to_ext="+e+"&hdca_id="+this.get("parent_hdca_id")+"&element_identifier="+t},constructor:function(e,t){this.debug("\t DatasetDCE.constructor:",e,t),f.constructor.call(this,e,t)},hasDetails:function(){return this.elements&&this.elements.length},toString:function(){this.get("element_identifier");return"DatasetDCE({objStr})"}})),_=g.extend({model:m,toString:function(){return["DatasetDCECollection(",this.length,")"].join("")}}),v=i.Model.extend(c.default.LoggableMixin).extend(c.default.SearchableModelMixin).extend({_logNamespace:"collections",defaults:{collection_type:null,deleted:!1},collectionClass:function(){return this.attributes.collection_type.indexOf(":")>0?b:_},initialize:function(e,t){this.debug(this+"(DatasetCollection).initialize:",e,t,this),this.elements=this._createElementsModel(),this.on("change:elements",function(){this.log("change:elements"),this.elements=this._createElementsModel()})},_createElementsModel:function(){var t=this.collectionClass();this.debug(this+"._createElementsModel",t,this.get("elements"),this.elements);var n=this.get("elements")||[];this.unset("elements",{silent:!0});var i=this;return e.each(n,function(t,n){e.extend(t,{parent_hdca_id:i.get("id")})}),this.elements=new t(n),this.elements},toJSON:function(){var e=i.Model.prototype.toJSON.call(this);return this.elements&&(e.elements=this.elements.toJSON()),e},inReadyState:function(){var e=this.get("populated");return this.isDeletedOrPurged()||e},hasDetails:function(){return 0!==this.elements.length},getVisibleContents:function(e){return this.elements},parse:function(e,t){var n=i.Model.prototype.parse.call(this,e,t);return n.create_time&&(n.create_time=new Date(n.create_time)),n.update_time&&(n.update_time=new Date(n.update_time)),n},delete:function(e,t,n){return e=e||!1,t=t||!1,this.get("deleted")?r.when():(n=u.default.merge(n,{method:"delete"}),this.save({deleted:!0,recursive:e,purge:t},n))},undelete:function(e){return this.get("deleted")?this.save({deleted:!1},e):r.when()},isDeletedOrPurged:function(){return this.get("deleted")||this.get("purged")},searchAttributes:["name","tags"],toString:function(){return"DatasetCollection("+[this.get("id"),this.get("name")||this.get("element_identifier")].join(",")+")"}}),y=v.extend(c.default.mixin(f,{constructor:function(e,t){this.debug("\t NestedDCDCE.constructor:",e,t),f.constructor.call(this,e,t)},toString:function(){return["NestedDCDCE(",this.object?""+this.object:this.get("element_identifier"),")"].join("")}})),b=g.extend({model:y,toString:function(){return["NestedDCDCECollection(",this.length,")"].join("")}});t.default={DatasetCollection:v}}).call(t,n(1),n(2),n(0))},function(e,t,n){"use strict";(function(e){function i(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var a=n(16),o=r(a),s=n(56),l=r(s),c=n(5),d=r(c),u=n(4),h=r(u),f=n(3),p=r(f),g=n(1),m=i(g),_=n(2),v=i(_),y=v.Model.extend(h.default.LoggableMixin).extend(h.default.mixin(h.default.SearchableModelMixin,{_logNamespace:"history",UPDATE_DELAY:4e3,defaults:{model_class:"History",id:null,name:"Unnamed History",state:"new",deleted:!1,contents_active:{},contents_states:{}},contentsClass:o.default.HistoryContents,searchAttributes:["name","annotation","tags"],searchAliases:{title:"name",tag:"tags"},initialize:function(e,t){t=t||{},this.logger=t.logger||null,this.log(this+".initialize:",e,t),this.urlRoot=Galaxy.root+"api/histories",this.contents=new this.contentsClass([],{history:this,historyId:this.get("id"),order:t.order}),this._setUpListeners(),this._setUpCollectionListeners(),this.updateTimeoutId=null},_setUpListeners:function(){return this.on({error:function(e,t,n,i,r){this.clearUpdateTimeout()},"change:id":function(e,t){this.contents&&(this.contents.historyId=t)}})},_setUpCollectionListeners:function(){return this.contents?this.listenTo(this.contents,{error:function(){this.trigger.apply(this,e.makeArray(arguments))}}):this},contentsShown:function(){var e=this.get("contents_active"),t=e.active||0;return t+=this.contents.includeDeleted?e.deleted:0,t+=this.contents.includeHidden?e.hidden:0},nice_size:function(){var e=this.get("size");return e?d.default.bytesToString(e,!0,2):(0,p.default)("(empty)")},toJSON:function(){return m.extend(v.Model.prototype.toJSON.call(this),{nice_size:this.nice_size()})},get:function(e){return"nice_size"===e?this.nice_size():v.Model.prototype.get.apply(this,arguments)},ownedByCurrUser:function(){return!(!Galaxy||!Galaxy.user)&&(!Galaxy.user.isAnonymous()&&Galaxy.user.id===this.get("user_id"))},numOfUnfinishedJobs:function(){var e=this.get("non_ready_jobs");return e?e.length:0},numOfUnfinishedShownContents:function(){return this.contents.runningAndActive().length||0},_fetchContentRelatedAttributes:function(){var t=["size","non_ready_jobs","contents_active","hid_counter"];return this.fetch({data:e.param({keys:t.join(",")})})},refresh:function(e){var t=this;e=e||{};var n=this.lastUpdateTime;return this.contents.allFetched=!1,(0!==this.contents.currentPage?function(){return t.contents.fetchPage(t.contents.currentPage)}:function(){return t.contents.fetchUpdated(n)})().done(function(n,i,r){var a;try{a=new Date(r.getResponseHeader("Date"))}catch(e){console.error(e)}t.lastUpdateTime=a||new Date,t.checkForUpdates(e)})},checkForUpdates:function(e){var t=this;e=e||{};var n=this.UPDATE_DELAY;if(this.id){var i=function(){t.clearUpdateTimeout(),t.updateTimeoutId=setTimeout(function(){t.refresh(e)},n)};this.numOfUnfinishedShownContents()>0?i():this._fetchContentRelatedAttributes().done(function(e){t.numOfUnfinishedJobs()>0?i():t.trigger("ready")})}},clearUpdateTimeout:function(){this.updateTimeoutId&&(clearTimeout(this.updateTimeoutId),this.updateTimeoutId=null)},stopPolling:function(){this.clearUpdateTimeout(),this.contents&&this.contents.stopPolling()},parse:function(e,t){var n=v.Model.prototype.parse.call(this,e,t);return n.create_time&&(n.create_time=new Date(n.create_time)),n.update_time&&(n.update_time=new Date(n.update_time)),n},fetchWithContents:function(e,t){e=e||{};var n=this;return e.view="dev-detailed",this.fetch(e).then(function(e){return n.contents.history=n,n.contents.setHistoryId(e.id),n.fetchContents(t)})},fetchContents:function(e){return e=e||{},this.lastUpdateTime=new Date,this.contents.fetchCurrentPage(e)},_delete:function(t){return this.get("deleted")?e.when():this.save({deleted:!0},t)},purge:function(t){return this.get("purged")?e.when():this.save({deleted:!0,purged:!0},t)},undelete:function(t){return this.get("deleted")?this.save({deleted:!1},t):e.when()},copy:function(t,n,i){if(t=void 0===t||t,!this.id)throw new Error("You must set the history ID before copying it.");var r={history_id:this.id};t&&(r.current=!0),n&&(r.name=n),i||(r.all_datasets=!1),r.view="dev-detailed";var a=this,o=e.post(this.urlRoot,r);return t?o.then(function(e){return new y(e).setAsCurrent().done(function(){a.trigger("copied",a,e)})}):o.done(function(e){a.trigger("copied",a,e)})},setAsCurrent:function(){var t=this,n=e.getJSON(Galaxy.root+"history/set_as_current?id="+this.id);return n.done(function(){t.trigger("set-as-current",t)}),n},toString:function(){return"History("+this.get("id")+","+this.get("name")+")"}})),b=l.default.InfinitelyScrollingCollection,w=b.extend(h.default.LoggableMixin).extend({_logNamespace:"history",model:y,order:"update_time",limitOnFirstFetch:10,limitPerFetch:10,initialize:function(e,t){t=t||{},this.log("HistoryCollection.initialize",e,t),this.urlRoot=Galaxy.root+"api/histories",b.prototype.initialize.call(this,e,t),this.includeDeleted=t.includeDeleted||!1,this.currentHistoryId=t.currentHistoryId,this.setUpListeners()},url:function(){return this.urlRoot},setUpListeners:function(){return this.on({"change:deleted":function(e){this.debug("change:deleted",this.includeDeleted,e.get("deleted")),!this.includeDeleted&&e.get("deleted")&&this.remove(e)},copied:function(e,t){this.setCurrent(new y(t,[]))},"set-as-current":function(e){var t=this.currentHistoryId;this.trigger("no-longer-current",t),this.currentHistoryId=e.id}})},_buildFetchData:function(e){return m.extend(b.prototype._buildFetchData.call(this,e),{view:"dev-detailed"})},_buildFetchFilters:function(e){var t=b.prototype._buildFetchFilters.call(this,e)||{},n={};return!0!==this.includeDeleted?(n.deleted=!1,n.purged=!1):n.deleted=null,m.defaults(t,n)},fetchFirst:function(t){var n=this,i=e.when();return this.currentHistoryId&&(i=b.prototype.fetchFirst.call(this,{silent:!0,limit:1,filters:{"encoded_id-in":this.currentHistoryId,deleted:null,purged:""}})),i.then(function(){return t=t||{},t.offset=0,n.fetchMore(t)})},comparators:m.extend(m.clone(b.prototype.comparators),{name:h.default.buildComparator("name",{ascending:!0}),"name-dsc":h.default.buildComparator("name",{ascending:!1}),size:h.default.buildComparator("size",{ascending:!1}),"size-asc":h.default.buildComparator("size",{ascending:!0})}),sort:function(e){e=e||{};var t=e.silent,n=this.remove(this.get(this.currentHistoryId));return b.prototype.sort.call(this,m.defaults({silent:!0},e)),this.unshift(n,{silent:!0}),t||this.trigger("sort",this,e),this},create:function(t,n,i,r){var a=this;return e.getJSON(Galaxy.root+"history/create_new_current").done(function(e){a.setCurrent(new y(e,[],i||{}))})},setCurrent:function(e,t){return t=t||{},this.unshift(e,t),this.currentHistoryId=e.get("id"),t.silent||this.trigger("new-current",e,this),this},toString:function(){return"HistoryCollection("+this.length+",current:"+this.currentHistoryId+")"}});t.default={History:y,HistoryCollection:w}}).call(t,n(0))},function(e,t,n){"use strict";(function(e,i,r){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(22),s=a(o),l=n(17),c=a(l),d=n(4),u=a(d),h=n(3),f=a(h),p=s.default.FoldoutListItemView,g=s.default.ListItemView,m=p.extend({className:p.prototype.className+" dataset-collection",id:function(){return["dataset_collection",this.model.get("id")].join("-")},initialize:function(e){this.linkTarget=e.linkTarget||"_blank",this.hasUser=e.hasUser,p.prototype.initialize.call(this,e)},_setUpListeners:function(){p.prototype._setUpListeners.call(this),this.listenTo(this.model,"change",function(t,n){e.has(t.changed,"deleted")?this.render():e.has(t.changed,"element_count")&&this.$("> .title-bar .subtitle").replaceWith(this._renderSubtitle())})},_renderSubtitle:function(){return i(this.templates.subtitle(this.model.toJSON(),this))},_getFoldoutPanelOptions:function(){var t=p.prototype._getFoldoutPanelOptions.call(this);return e.extend(t,{linkTarget:this.linkTarget,hasUser:this.hasUser})},$selector:function(){return this.$("> .selector")},toString:function(){return"DCListItemView("+(this.model?""+this.model:"(no model)")+")"}});m.prototype.templates=function(){var t=e.extend({},p.prototype.templates.warnings,{error:u.default.wrapTemplate(["<% if( model.error ){ %>",'<div class="errormessagesmall">',(0,f.default)("There was an error getting the data for this collection"),": <%- model.error %>","</div>","<% } %>"]),purged:u.default.wrapTemplate(["<% if( model.purged ){ %>",'<div class="purged-msg warningmessagesmall">',(0,f.default)("This collection has been deleted and removed from disk"),"</div>","<% } %>"]),deleted:u.default.wrapTemplate(["<% if( model.deleted && !model.purged ){ %>",'<div class="deleted-msg warningmessagesmall">',(0,f.default)("This collection has been deleted"),"</div>","<% } %>"])}),n=u.default.wrapTemplate(['<div class="title-bar clear" tabindex="0">','<div class="title">','<span class="name"><%- collection.element_identifier || collection.name %></span>',"</div>",'<div class="subtitle"></div>',"</div>"],"collection"),i=u.default.wrapTemplate(['<div class="subtitle">','<% var countText = collection.element_count? ( collection.element_count + " " ) : ""; %>','<%        if( collection.collection_type === "list" ){ %>',(0,f.default)("a list of <%- countText %>datasets"),'<% } else if( collection.collection_type === "paired" ){ %>',(0,f.default)("a pair of datasets"),'<% } else if( collection.collection_type === "list:paired" ){ %>',(0,f.default)("a list of <%- countText %>dataset pairs"),'<% } else if( collection.collection_type === "list:list" ){ %>',(0,f.default)("a list of <%- countText %>dataset lists"),"<% } %>","</div>"],"collection");return e.extend({},p.prototype.templates,{warnings:t,titleBar:n,subtitle:i})}();var _=g.extend({className:g.prototype.className+" dataset-collection-element",initialize:function(e){e.logger&&(this.logger=this.model.logger=e.logger),this.log("DCEListItemView.initialize:",e),g.prototype.initialize.call(this,e)},toString:function(){return"DCEListItemView("+(this.model?""+this.model:"(no model)")+")"}});_.prototype.templates=function(){var t=u.default.wrapTemplate(['<div class="title-bar clear" tabindex="0">','<div class="title">','<span class="name"><%- element.element_identifier %></span>',"</div>",'<div class="subtitle"></div>',"</div>"],"element");return e.extend({},g.prototype.templates,{titleBar:t})}();var v=c.default.DatasetListItemView.extend({className:c.default.DatasetListItemView.prototype.className+" dataset-collection-element",initialize:function(e){e.logger&&(this.logger=this.model.logger=e.logger),this.log("DatasetDCEListItemView.initialize:",e),c.default.DatasetListItemView.prototype.initialize.call(this,e)},_fetchModelDetails:function(){var e=this;return e.model.inReadyState()&&!e.model.hasDetails()?e.model.fetch({silent:!0}):r.when()},toString:function(){return"DatasetDCEListItemView("+(this.model?""+this.model:"(no model)")+")"}});v.prototype.templates=function(){var t=u.default.wrapTemplate(['<div class="title-bar clear" tabindex="0">','<span class="state-icon"></span>','<div class="title">','<span class="name"><%- element.element_identifier %></span>',"</div>","</div>"],"element");return e.extend({},c.default.DatasetListItemView.prototype.templates,{titleBar:t})}();var y=m.extend({className:m.prototype.className+" dataset-collection-element",_swapNewRender:function(e){m.prototype._swapNewRender.call(this,e);var t=this.model.get("state")||"ok";return this.$el.addClass("state-"+t),this.$el},toString:function(){return"NestedDCDCEListItemView("+(this.model?""+this.model:"(no model)")+")"}});t.default={DCListItemView:m,DCEListItemView:_,DatasetDCEListItemView:v,NestedDCDCEListItemView:y}}).call(t,n(1),n(0),n(0))},function(e,t,n){"use strict";(function(e,n){Object.defineProperty(t,"__esModule",{value:!0});var i=e.Model.extend({defaults:{url:"https://toolshed.g2.bx.psu.edu/",name:"Galaxy Main Tool Shed"},urlRoot:Galaxy.root+"api/tool_shed"}),r=e.Collection.extend({url:Galaxy.root+"api/tool_shed",model:i}),a=e.Model.extend({defaults:[{}],urlRoot:Galaxy.root+"api/tool_shed/contents"}),o=e.Collection.extend({url:Galaxy.root+"api/tool_shed/contents",model:a}),s=e.Model.extend({defaults:[{}],urlRoot:Galaxy.root+"api/tool_shed/category"}),l=e.Collection.extend({url:Galaxy.root+"api/tool_shed/category",model:s}),c=e.Model.extend({defaults:[{}],urlRoot:Galaxy.root+"api/tool_shed/repository"}),d=e.Collection.extend({url:Galaxy.root+"api/tool_shed/repository",model:c}),u=e.Model.extend({url:"#"}),h=e.Collection.extend({url:"#",model:u,fetch:function(){var t=this,i=Array(),r=JSON.parse(localStorage.repositories),a=Object.keys(r);return n.each(a,function(e){var t=r[e];t.queue_key=e,i.push(t)}),t.reset(i),e.Collection.prototype.fetch.call(this)}}),f=e.Model.extend({defaults:[{}],urlRoot:Galaxy.root+"api/tool_shed/status"}),p=e.Collection.extend({url:Galaxy.root+"api/tool_shed/status",model:f}),g=e.Model.extend({defaults:[{}],urlRoot:Galaxy.root+"api/workflows?missing_tools=True"}),m=e.Collection.extend({url:Galaxy.root+"api/workflows?missing_tools=True",model:g});t.default={ShedModel:i,ShedsCollection:r,Category:a,Categories:o,CategoryModel:s,CategoryCollection:l,RepositoryModel:c,RepositoryCollection:d,RepoQueue:h,RepoStatus:p,WorkflowTools:m}}).call(t,n(2),n(1))},function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0});var n=function(t,n){var i=this,r=this.shed_url,a=Galaxy.root+"api/tool_shed/search";e.get(a,{term:t.term,tool_shed_url:r},function(e){var t=i.shedParser(e);n(t)})},i=function(t){var n=[],i=t.hits;return e.each(i,function(e){var t=i[e],r=t.repository.name+" by "+t.repository.repo_owner_username+": "+t.repository.description,a={value:t.repository.id,label:r};n.push(a)}),n},r=function(e){"/"==e.tool_shed_url.substr(-1)&&(e.tool_shed_url=e.tool_shed_url.substr(0,e.tool_shed_url.length-1));var t=e.tool_shed_url+"|"+e.repository_id+"|"+e.changeset_revision,n=new Object;localStorage.repositories&&(n=JSON.parse(localStorage.repositories)),n[t]=e,localStorage.repositories=JSON.stringify(n)},a=function(){if(localStorage.hasOwnProperty("repositories")){var e=JSON.parse(localStorage.repositories);return Object.keys(e).length}return 0};t.default={searchShed:n,shedParser:i,addToQueue:r,queueLength:a}}).call(t,n(0))},,,function(e,t,n){"use strict";(function(e,i){function r(t,n,i){return Galaxy.modal.show({title:n,body:t,closing_events:!0,buttons:{Ok:function(){Galaxy.modal.hide()}}}),Galaxy.modal.$el.addClass("error-modal"),i&&(Galaxy.modal.$(".error-details").add(Galaxy.modal.$('button:contains("Details")')).remove(),e("<div/>").addClass("error-details").hide().appendTo(Galaxy.modal.$(".modal-content")).append([e("<p/>").text(p),e("<pre/>").text(JSON.stringify(i,null,"  "))]),e('<button id="button-1" class="pull-left">'+(0,u.default)("Details")+"</button>").appendTo(Galaxy.modal.$(".buttons")).click(function(){Galaxy.modal.$(".error-details").toggle()})),Galaxy.modal}function a(e,t,n){if(e){if(e=(0,u.default)(e),t=(0,u.default)(t)||(0,u.default)("Error:"),window.Galaxy&&Galaxy.modal)return r(e,t,n);alert(t+"\n\n"+e),console.log("error details:",JSON.stringify(n))}}function o(){return a((0,u.default)("You appear to be offline. Please check your connection and try again."),(0,u.default)("Offline?"))}function s(){return a((0,u.default)("Galaxy is currently unreachable. Please try again in a few minutes.")+" "+h,(0,u.default)("Cannot connect to Galaxy"))}function l(e,t,n,i,r){return i=i||f,i+=" "+h,r=r||(0,u.default)("An error occurred"),a(i,r,c(e,t,n))}function c(e,t,n){return{raven:i.result(window.Raven,"lastEventId"),userAgent:navigator.userAgent,onLine:navigator.onLine,version:i.result(Galaxy.config,"version_major"),xhr:i.omit(t,i.functions(t)),options:i.omit(n,"xhr"),url:i.result(Galaxy.lastAjax,"url"),data:i.result(Galaxy.lastAjax,"data"),model:i.result(e,"toJSON",""+e),user:i.omit(i.result(Galaxy.user,"toJSON"),"email")}}Object.defineProperty(t,"__esModule",{value:!0});var d=n(3),u=function(e){return e&&e.__esModule?e:{default:e}}(d),h=(0,u.default)("Please contact a Galaxy administrator if the problem persists."),f=(0,u.default)("An error occurred while updating information with the server."),p=(0,u.default)("The following information can assist the developers in finding the source of the error:");t.default={errorModal:a,offlineErrorModal:o,badGatewayErrorModal:s,ajaxErrorModal:l}}).call(t,n(0),n(1))},function(e,t,n){"use strict";(function(e){function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var r=n(50),a=i(r),o=n(51),s=i(o),l=n(4),c=i(l),d=n(3),u=(i(d),a.default.DatasetAssociation),h=s.default.HistoryContentMixin,f=u.extend(c.default.mixin(h,{defaults:e.extend({},u.prototype.defaults,h.defaults,{history_content_type:"dataset",model_class:"HistoryDatasetAssociation"})}));t.default={HistoryDatasetAssociation:f}}).call(t,n(1))},function(e,t,n){"use strict";(function(e,i,r){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(22),s=a(o),l=n(36),c=a(l),d=n(4),u=a(d),h=n(3),f=a(h);n(40);var p=e.View.extend(u.default.LoggableMixin).extend({_logNamespace:"list",viewClass:s.default.ListItemView,collectionClass:e.Collection,tagName:"div",className:"list-panel",fxSpeed:"fast",emptyMsg:(0,f.default)("This list is empty"),noneFoundMsg:(0,f.default)("No matching items found"),searchPlaceholder:(0,f.default)("search"),initialize:function(e,t){e=e||{},e.logger&&(this.logger=e.logger),this.log(this+".initialize:",e),this.fxSpeed=i.has(e,"fxSpeed")?e.fxSpeed:this.fxSpeed,this.filters=[],this.searchFor=e.searchFor||"",this.selecting=void 0===e.selecting||e.selecting,this.selected=e.selected||[],this.lastSelected=null,this.dragItems=e.dragItems||!1,this.viewClass=e.viewClass||this.viewClass,this.views=[],this.collection=e.collection||this._createDefaultCollection(),this.filters=e.filters||[],this.$scrollContainer=e.$scrollContainer||this.$scrollContainer,this.title=e.title||"",this.subtitle=e.subtitle||"",this._setUpListeners()},_setUpListeners:function(){return this.off(),this.on({error:function(e,t,n,i,r){console.error(e,t,n,i,r)},loading:function(){this._showLoadingIndicator("loading...",40)},"loading-done":function(){this._hideLoadingIndicator(40)}}),this.once("rendered",function(){this.trigger("rendered:initial",this)}),this._setUpCollectionListeners(),this._setUpViewListeners(),this},_createDefaultCollection:function(){return new this.collectionClass([])},_setUpCollectionListeners:function(){return this.log(this+"._setUpCollectionListeners",this.collection),this.stopListening(this.collection),this.listenTo(this.collection,{error:function(e,t,n,i,r){this.trigger("error",e,t,n,i,r)},update:function(e,t){var n=t.changes;return t.renderAll||n.added.length+n.removed.length>1?this.renderItems():1===n.added.length?this.addItemView(i.first(n.added),e,t):1===n.removed.length?this.removeItemView(i.first(n.removed),e,t):void 0}}),this},_setUpViewListeners:function(){this.log(this+"._setUpViewListeners"),this.on({"view:selected":function(e,t){if(t&&t.shiftKey&&this.lastSelected){var n=this.viewFromModelId(this.lastSelected);n&&this.selectRange(e,n)}else t&&t.altKey&&!this.selecting&&this.showSelectors();this.selected.push(e.model.id),this.lastSelected=e.model.id},"view:de-selected":function(e,t){this.selected=i.without(this.selected,e.model.id)}})},render:function(e){this.log(this+".render",e);var t=this._buildNewRender();return this._setUpBehaviors(t),this._queueNewRender(t,e),this},_buildNewRender:function(){this.debug(this+"(ListPanel)._buildNewRender");var e=r(this.templates.el({},this));return this._renderControls(e),this._renderTitle(e),this._renderSubtitle(e),this._renderSearch(e),this.renderItems(e),e},_renderControls:function(e){this.debug(this+"(ListPanel)._renderControls");var t=r(this.templates.controls({},this));return e.find(".controls").replaceWith(t),t},_renderTitle:function(e){},_renderSubtitle:function(e){},_queueNewRender:function(e,t){t=void 0===t?this.fxSpeed:t;var n=this;n.log("_queueNewRender:",e,t),r(n).queue("fx",[function(e){n.$el.fadeOut(t,e)},function(t){n._swapNewRender(e),t()},function(e){n.$el.fadeIn(t,e)},function(e){n.trigger("rendered",n),e()}])},_swapNewRender:function(e){return this.$el.empty().attr("class",this.className).append(e.children()),this.selecting&&this.showSelectors(0),this},_setUpBehaviors:function(e){return e=e||this.$el,this.$controls(e).find("[title]").tooltip(),this._renderMultiselectActionMenu(e),this},_renderMultiselectActionMenu:function(e){e=e||this.$el;var t=e.find(".list-action-menu"),n=this.multiselectActions();if(!n.length)return t.empty();var i=r(['<div class="list-action-menu btn-group">','<button class="list-action-menu-btn btn btn-default dropdown-toggle" data-toggle="dropdown">',(0,f.default)("For all selected"),"...","</button>",'<ul class="dropdown-menu pull-right" role="menu">',"</ul>","</div>"].join("")),a=n.map(function(e){var t=['<li><a href="javascript:void(0);">',e.html,"</a></li>"].join("");return r(t).click(function(t){return t.preventDefault(),e.func(t)})});return i.find("ul").append(a),t.replaceWith(i),i},multiselectActions:function(){return[]},$scrollContainer:function(e){return(e||this.$el).parent().parent()},$controls:function(e){return(e||this.$el).find("> .controls")},$list:function(e){return(e||this.$el).find("> .list-items")},$messages:function(e){return(e||this.$el).find("> .controls .messages")},$emptyMessage:function(e){return(e||this.$el).find("> .empty-message")},renderItems:function(e){e=e||this.$el;var t=this;t.log(this+".renderItems",e);var n=t.$list(e);t.freeViews();var i=t._filterCollection();return t.views=i.map(function(e){return t._createItemView(e)}),n.empty(),t.views.length&&t._attachItems(e),t._renderEmptyMessage(e).toggle(!t.views.length),t.trigger("views:ready",t.views),t.views},_filterCollection:function(){var e=this;return e.collection.filter(i.bind(e._filterItem,e))},_filterItem:function(e){var t=this;return i.every(t.filters.map(function(t){return t.call(e)}))&&(!t.searchFor||e.matchesAll(t.searchFor))},_createItemView:function(e){var t=this._getItemViewClass(e),n=i.extend(this._getItemViewOptions(e),{model:e}),r=new t(n);return this._setUpItemViewListeners(r),r},_destroyItemView:function(e){this.stopListening(e),this.views=i.without(this.views,e)},_destroyItemViews:function(e){var t=this;return t.views.forEach(function(e){t.stopListening(e)}),t.views=[],t},freeViews:function(){return this._destroyItemViews()},_getItemViewClass:function(e){return this.viewClass},_getItemViewOptions:function(e){return{fxSpeed:this.fxSpeed,expanded:!1,selectable:this.selecting,selected:i.contains(this.selected,e.id),draggable:this.dragItems}},_setUpItemViewListeners:function(e){var t=this;return this.listenTo(e,"all",function(){var e=Array.prototype.slice.call(arguments,0);e[0]="view:"+e[0],t.trigger.apply(t,e)}),this.listenTo(e,"draggable:dragstart",function(e,t){var n={},i=this.getSelectedModels();n=i.length?i.toJSON():[t.model.toJSON()],e.dataTransfer.setData("text",JSON.stringify(n))},this),t},_attachItems:function(e){var t=this;return this.$list(e).append(this.views.map(function(e){return t._renderItemView$el(e)})),this},_renderItemView$el:function(e){return e.render(0).$el},_renderEmptyMessage:function(e){this.debug("_renderEmptyMessage",e,this.searchFor);var t=this.searchFor?this.noneFoundMsg:this.emptyMsg;return this.$emptyMessage(e).text(t)},expandAll:function(){i.each(this.views,function(e){e.expand()})},collapseAll:function(){i.each(this.views,function(e){e.collapse()})},addItemView:function(e,t,n){var i=this,a=i._filterCollection().indexOf(e);if(-1!==a){var o=i._createItemView(e);return r(o).queue("fx",[function(e){i.$emptyMessage().is(":visible")?i.$emptyMessage().fadeOut(i.fxSpeed,e):e()},function(e){i._attachView(o,a),e()}]),o}},_attachView:function(e,t,n){n=!!i.isUndefined(n)||n,t=t||0;var r=this;return r.views.splice(t,0,e),r._insertIntoListAt(t,r._renderItemView$el(e).hide()),r.trigger("view:attached",e),n?e.$el.slideDown(r.fxSpeed,function(){r.trigger("view:attached:rendered")}):(e.$el.show(),r.trigger("view:attached:rendered")),e},_insertIntoListAt:function(e,t){var n=this.$list();return 0===e?n.prepend(t):n.children().eq(e-1).after(t),t},removeItemView:function(e,t,n){var a=this,o=i.find(a.views,function(t){return t.model===e});if(o)return a.views=i.without(a.views,o),a.trigger("view:removed",o),r({}).queue("fx",[function(e){o.$el.fadeOut(a.fxSpeed,e)},function(e){o.remove(),a.trigger("view:removed:rendered"),a.views.length?e():a._renderEmptyMessage().fadeIn(a.fxSpeed,e)}]),o},viewFromModelId:function(e){return i.find(this.views,function(t){return t.model.id===e})},viewFromModel:function(e){return e?this.viewFromModelId(e.id):void 0},viewsWhereModel:function(e){return this.views.filter(function(t){return i.isMatch(t.model.attributes,e)})},viewRange:function(e,t){if(e===t)return e?[e]:[];var n=this.views.indexOf(e),i=this.views.indexOf(t);return-1===n||-1===i?n===i?[]:-1===n?[t]:[e]:n<i?this.views.slice(n,i+1):this.views.slice(i,n+1)},_renderSearch:function(e){return e.find(".controls .search-input").searchInput({placeholder:this.searchPlaceholder,initialVal:this.searchFor,onfirstsearch:i.bind(this._firstSearch,this),onsearch:i.bind(this.searchItems,this),onclear:i.bind(this.clearSearch,this)}),e},_firstSearch:function(e){return this.log("onFirstSearch",e),this.searchItems(e)},searchItems:function(e,t){if(this.log("searchItems",e,this.searchFor,t),!t&&this.searchFor===e)return this;this.searchFor=e,this.renderItems(),this.trigger("search:searching",e,this);var n=this.$("> .controls .search-query");return n.val()!==e&&n.val(e),this},clearSearch:function(e){return this.searchFor="",this.trigger("search:clear",this),this.$("> .controls .search-query").val(""),this.renderItems(),this},THROTTLE_SELECTOR_FX_AT:20,showSelectors:function(e){e=void 0!==e?e:this.fxSpeed,this.selecting=!0,this.$(".list-actions").slideDown(e),e=this.views.length>=this.THROTTLE_SELECTOR_FX_AT?0:e,i.each(this.views,function(t){t.showSelector(e)})},hideSelectors:function(e){e=void 0!==e?e:this.fxSpeed,this.selecting=!1,this.$(".list-actions").slideUp(e),e=this.views.length>=this.THROTTLE_SELECTOR_FX_AT?0:e,i.each(this.views,function(t){t.hideSelector(e)}),this.selected=[],this.lastSelected=null},toggleSelectors:function(){this.selecting?this.hideSelectors():this.showSelectors()},selectAll:function(e){i.each(this.views,function(t){t.select(e)})},deselectAll:function(e){this.lastSelected=null,i.each(this.views,function(t){t.deselect(e)})},selectRange:function(e,t){var n=this.viewRange(e,t);return i.each(n,function(e){e.select()}),n},getSelectedViews:function(){return i.filter(this.views,function(e){return e.selected})},getSelectedModels:function(){return new this.collection.constructor(i.map(this.getSelectedViews(),function(e){return e.model}))},_showLoadingIndicator:function(e,t,n){this.debug("_showLoadingIndicator",this.indicator,e,t,n),t=void 0!==t?t:this.fxSpeed,this.indicator||(this.indicator=new c.default.LoadingIndicator(this.$el),this.debug("\t created",this.indicator)),this.$el.is(":visible")?(this.$el.fadeOut(t),this.indicator.show(e,t,n)):this.indicator.show(0,n)},_hideLoadingIndicator:function(e,t){this.debug("_hideLoadingIndicator",this.indicator,e,t),e=void 0!==e?e:this.fxSpeed,this.indicator&&this.indicator.hide(e,t)},scrollPosition:function(){return this.$scrollContainer().scrollTop()},scrollTo:function(e,t){return t=t||0,this.$scrollContainer().animate({scrollTop:e},t),this},scrollToTop:function(e){return this.scrollTo(0,e)},scrollToItem:function(e,t){return this},scrollToId:function(e,t){return this.scrollToItem(this.viewFromModelId(e),t)},events:{"click .select-all":"selectAll","click .deselect-all":"deselectAll"},toString:function(){return"ListPanel("+this.collection+")"}});p.prototype.templates=function(){return{el:u.default.wrapTemplate(["<div>",'<div class="controls"></div>','<div class="list-items"></div>','<div class="empty-message infomessagesmall"></div>',"</div>"]),controls:u.default.wrapTemplate(['<div class="controls">','<div class="title">','<div class="name"><%- view.title %></div>',"</div>",'<div class="subtitle"><%- view.subtitle %></div>','<div class="actions"></div>','<div class="messages"></div>','<div class="search">','<div class="search-input"></div>',"</div>",'<div class="list-actions">','<div class="btn-group">','<button class="select-all btn btn-default"','data-mode="select">',(0,f.default)("All"),"</button>",'<button class="deselect-all btn btn-default"','data-mode="select">',(0,f.default)("None"),"</button>","</div>",'<div class="list-action-menu btn-group">',"</div>","</div>","</div>"])}}();var g=p.extend({modelCollectionKey:"contents",initialize:function(e){p.prototype.initialize.call(this,e),this.selecting=void 0!==e.selecting&&e.selecting,this.setModel(this.model,e)},setModel:function(e,t){if(t=t||{},this.debug(this+".setModel:",e,t),this.freeModel(),this.freeViews(),e){var n=this.model?this.model.get("id"):null;this.model=e,this.logger&&(this.model.logger=this.logger),this._setUpModelListeners(),this.stopListening(this.collection),this.collection=this.model[this.modelCollectionKey]||t.collection||this._createDefaultCollection(),this._setUpCollectionListeners(),n&&e.get("id")!==n&&this.trigger("new-model",this)}return this},freeModel:function(){return this.model&&this.stopListening(this.model),this},_setUpModelListeners:function(){return this.log(this+"._setUpModelListeners",this.model),this.listenTo(this.model,"error",function(){var e=Array.prototype.slice.call(arguments,0);e.unshift("error"),this.trigger.apply(this,e)},this),this.logger&&this.listenTo(this.model,"all",function(e){this.info(this+"(model)",e,arguments)}),this},_renderControls:function(e){this.debug(this+"(ModelListPanel)._renderControls");var t=this.model?this.model.toJSON():{},n=r(this.templates.controls(t,this));return e.find(".controls").replaceWith(n),n},toString:function(){return"ModelListPanel("+this.model+")"}});g.prototype.templates=function(){var e=u.default.wrapTemplate(['<div class="controls">','<div class="title">','<div class="name"><%- model.name %></div>',"</div>",'<div class="subtitle"><%- view.subtitle %></div>','<div class="actions"></div>','<div class="messages"></div>','<div class="search">','<div class="search-input"></div>',"</div>",'<div class="list-actions">','<div class="btn-group">','<button class="select-all btn btn-default"','data-mode="select">',(0,f.default)("All"),"</button>",'<button class="deselect-all btn btn-default"','data-mode="select">',(0,f.default)("None"),"</button>","</div>",'<div class="list-action-menu btn-group">',"</div>","</div>","</div>"]);return i.extend(i.clone(p.prototype.templates),{controls:e})}(),t.default={ListPanel:p,ModelListPanel:g}}).call(t,n(2),n(1),n(0))},function(e,t,n){"use strict";function i(e,t){function n(e){o(this).parent().children("input").val("").trigger("searchInput.clear").blur(),t.onclear()}function i(e,i){if(!i)return n();o(this).trigger("search.search",i),"function"==typeof t.onfirstsearch&&u?(u=!1,t.onfirstsearch(i)):t.onsearch(i)}function r(){return['<input type="text" name="',t.name,'" placeholder="',t.placeholder,'" ','class="search-query ',t.classes,'" ',"/>"].join("")}var l=27,c=13,d=o(e),u=!0,h={initialVal:"",name:"search",placeholder:"search",classes:"",onclear:function(){},onfirstsearch:null,onsearch:function(e){},minSearchLen:0,escWillClear:!0,oninit:function(){}};return"string"===a.default.type(t)?("toggle-loading"===t&&function(){d.find(".search-loading").toggle(),d.find(".search-clear").toggle()}(),d):("object"===a.default.type(t)&&(t=a.default.extend(!0,{},h,t)),d.addClass("search-input").prepend([function(){return o(r()).focus(function(e){o(this).select()}).keyup(function(e){if(e.preventDefault(),e.stopPropagation(),e.which===l&&t.escWillClear)n.call(this,e);else{var r=o(this).val();(e.which===c||t.minSearchLen&&r.length>=t.minSearchLen)&&i.call(this,e,r)}}).val(t.initialVal)}(),function(){return o(['<span class="search-clear fa fa-times-circle" ','title="',s("clear search (esc)"),'"></span>'].join("")).tooltip({placement:"bottom"}).click(function(e){n.call(this,e)})}(),function(){return o(['<span class="search-loading fa fa-spinner fa-spin" ','title="',s("loading..."),'"></span>'].join("")).hide().tooltip({placement:"bottom"})}()]))}var r=n(0),a=function(e){return e&&e.__esModule?e:{default:e}}(r),o=a.default,s=window._l||function(e){return e};a.default.fn.extend({searchInput:function(e){return this.each(function(){return i(this,e)})}})},function(e,t,n){"use strict";(function(e){function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var r=n(17),a=i(r),o=n(4),s=i(o),l=n(59),c=i(l),d=n(3),u=i(d),h=a.default.DatasetListItemView,f=h.extend({className:h.prototype.className+" history-content",initialize:function(e,t){h.prototype.initialize.call(this,e,t)},toString:function(){return"HDAListItemView("+(this.model?""+this.model:"(no model)")+")"}});f.prototype.templates=function(){var t=function(t){return'\n        <div class="title-bar clear" tabindex="0">\n            <span class="state-icon"></span>\n            <div class="title">\n                <span class="hid">'+t.hid+'</span>\n                <span class="name">'+e.escape(t.name)+"</span>\n            </div>\n            </br>\n            "+c.default.nametagTemplate(t)+"\n        </div>\n    "},n=e.extend({},h.prototype.templates.warnings,{hidden:s.default.wrapTemplate(["<% if( !dataset.visible ){ %>",'<div class="hidden-msg warningmessagesmall">',(0,u.default)("This dataset has been hidden"),"</div>","<% } %>"],"dataset")});return e.extend({},h.prototype.templates,{titleBar:t,warnings:n})}(),t.default={HDAListItemView:f}}).call(t,n(1))},function(e,t,n){"use strict";(function(e){function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var r=n(8),a=i(r),o=n(32),s=i(o),l=n(60),c=i(l),d=n(4),u=(i(d),n(59)),h=i(u),f=n(3),p=i(f),g=s.default.DCListItemView,m=g.extend({className:g.prototype.className+" history-content",_setUpListeners:function(){var e=this;g.prototype._setUpListeners.call(this);var t=function(t,n){e.render()};this.model.jobStatesSummary&&this.listenTo(this.model.jobStatesSummary,"change",t),this.listenTo(this.model,{"change:tags change:visible change:state":t})},_getFoldoutPanelClass:function(){return c.default.CollectionView},_swapNewRender:function(e){g.prototype._swapNewRender.call(this,e);var t,n=this.model.jobStatesSummary;t=n?n.new()?"loading":n.errored()?"error":n.terminal()?"ok":n.running()?"running":"queued":this.model.get("job_source_id")?"loading":this.model.get("populated_state")?a.default.OK:a.default.RUNNING,this.$el.addClass("state-"+t);var i=this.stateDescription();return this.$(".state-description").html(i),this.$el},stateDescription:function(){var e=this.model,t=(e.get("element_count"),e.get("job_source_type")),n=(this.model.get("collection_type"),c.default.collectionTypeDescription(e)),i=c.default.collectionDescription(e),r=e.jobStatesSummary;if(t&&"Job"!=t){if(r&&r.hasDetails()){var a=r.new(),o=a?null:r.jobCount();if(a)return'\n                        <div class="progress state-progress">\n                            <span class="note">Creating jobs.<span class="blinking">..</span></span>\n                            <div class="progress-bar info" style="width:100%">\n                        </div>';if(r.errored()){return"a "+n+" with "+r.numInError()+" / "+o+" jobs in error"}if(r.terminal())return i;var s=r.states().running||0,l=r.states().ok||0,d=l/(1*o),u=s/(1*o),h=1-d-u;return'\n                        <div class="progress state-progress">\n                            <span class="note">'+(o&&o>1?o+" jobs":"a job")+" generating a "+n+'</span>\n                            <div class="progress-bar ok" style="width:'+100*d+'%"></div>\n                            <div class="progress-bar running" style="width:'+100*u+'%"></div>\n                            <div class="progress-bar new" style="width:'+100*h+'%">\n                        </div>'}return'\n                    <div class="progress state-progress">\n                        <span class="note">Loading job data for '+n+'.<span class="blinking">..</span></span>\n                        <div class="progress-bar info" style="width:100%">\n                    </div>'}return i},toString:function(){return"HDCAListItemView("+(this.model?""+this.model:"(no model)")+")"}});m.prototype.templates=function(){var t=e.extend({},g.prototype.templates.warnings,{hidden:function(e){e.visible||(0,p.default)("This collection has been hidden")}}),n=function(t){return'\n        <div class="title-bar clear" tabindex="0">\n            <span class="state-icon"></span>\n            <div class="title">\n                <span class="hid">'+t.hid+'</span>\n                <span class="name">'+e.escape(t.name)+'</span>\n            </div>\n            <div class="state-description">\n            </div>\n            '+h.default.nametagTemplate(t)+"\n        </div>\n    "};return e.extend({},g.prototype.templates,{warnings:t,titleBar:n})}(),t.default={HDCAListItemView:m}}).call(t,n(1))},,,,,,,,function(e,t,n){"use strict";(function(e,i,r){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(8),s=a(o),l=n(4),c=a(l),d=n(3),u=a(d),h=c.default.SearchableModelMixin,f=e.Model.extend(c.default.LoggableMixin).extend(c.default.mixin(h,{_logNamespace:"dataset",defaults:{state:s.default.NEW,deleted:!1,purged:!1,name:"(unnamed dataset)",accessible:!0,data_type:"",file_ext:"",file_size:0,meta_files:[],misc_blurb:"",misc_info:"",tags:[]},initialize:function(e,t){this.debug(this+"(Dataset).initialize",e,t),
//!! this state is not in trans.app.model.Dataset.states - set it here -
this.get("accessible")||this.set("state",s.default.NOT_VIEWABLE),this.urls=this._generateUrls(),this._setUpListeners()},_getDatasetId:function(){return this.get("id")},_generateUrls:function(){var e=this._getDatasetId();if(!e)return{};var t={purge:"datasets/"+e+"/purge_async",display:"datasets/"+e+"/display/?preview=True",edit:"datasets/edit?dataset_id="+e,download:"datasets/"+e+"/display"+this._downloadQueryParameters(),report_error:"dataset/errors?id="+e,rerun:"tool_runner/rerun?id="+e,show_params:"datasets/"+e+"/show_params",visualization:"visualization",meta_download:"dataset/get_metadata_file?hda_id="+e+"&metadata_name="};return i.each(t,function(e,n){t[n]=Galaxy.root+e}),this.urls=t,t},_downloadQueryParameters:function(){return"?to_ext="+this.get("file_ext")},_setUpListeners:function(){this.on("change:state",function(e,t){this.log(this+" has changed state:",e,t),this.inReadyState()&&this.trigger("state:ready",e,t,this.previous("state"))}),this.on("change:id change:file_ext",function(e){this._generateUrls()})},toJSON:function(){var t=e.Model.prototype.toJSON.call(this);return i.extend(t,{urls:this.urls})},isDeletedOrPurged:function(){return this.get("deleted")||this.get("purged")},inReadyState:function(){var e=i.contains(s.default.READY_STATES,this.get("state"));return this.isDeletedOrPurged()||e},hasDetails:function(){return!this.get("accessible")||this.has("annotation")},hasData:function(){return this.get("file_size")>0},fetch:function(t){var n=this;return e.Model.prototype.fetch.call(this,t).always(function(){n._generateUrls()})},parse:function(t,n){var i=e.Model.prototype.parse.call(this,t,n);return i.create_time&&(i.create_time=new Date(i.create_time)),i.update_time&&(i.update_time=new Date(i.update_time)),i},save:function(t,n){return n=n||{},n.wait=!!i.isUndefined(n.wait)||n.wait,e.Model.prototype.save.call(this,t,n)},delete:function(e){return this.get("deleted")?r.when():this.save({deleted:!0},e)},undelete:function(e){return!this.get("deleted")||this.get("purged")?r.when():this.save({deleted:!1},e)},purge:function(e){if(this.get("purged"))return r.when();e=e||{},e.url=this.urls.purge;var t=this,n=r.ajax(e);return n.done(function(e,n,i){t.set({deleted:!0,purged:!0})}),n.fail(function(n,i,r){var a=(0,u.default)("Unable to purge dataset");n.responseJSON&&n.responseJSON.error?a=n.responseJSON.error:-1!==n.responseText.indexOf("Removal of datasets by users is not allowed in this Galaxy instance")&&(a="Removal of datasets by users is not allowed in this Galaxy instance"),n.responseText=a,t.trigger("error",t,n,e,(0,u.default)(a),{error:a})}),n},searchAttributes:["name","file_ext","genome_build","misc_blurb","misc_info","annotation","tags"],searchAliases:{title:"name",format:"file_ext",database:"genome_build",blurb:"misc_blurb",description:"misc_blurb",info:"misc_info",tag:"tags"},toString:function(){var e=this.get("id")||"";return this.get("name")&&(e='"'+this.get("name")+'",'+e),"Dataset("+e+")"}})),p=e.Collection.extend(c.default.LoggableMixin).extend({_logNamespace:"dataset",model:f,urlRoot:Galaxy.root+"api/datasets",url:function(){return this.urlRoot},ids:function(){return this.map(function(e){return e.get("id")})},notReady:function(){return this.filter(function(e){return!e.inReadyState()})},haveDetails:function(){return this.all(function(e){return e.hasDetails()})},ajaxQueue:function(e,t){var n=r.Deferred(),i=this.length,a=[];if(!i)return n.resolve([]),n;var o=this.chain().reverse().map(function(r,s){return function(){var l=e.call(r,t);l.done(function(e){n.notify({curr:s,total:i,response:e,model:r})}),l.always(function(e){a.push(e),o.length?o.shift()():n.resolve(a)})}}).value();return o.shift()(),n},matches:function(e){return this.filter(function(t){return t.matches(e)})},toString:function(){return["DatasetAssociationCollection(",this.length,")"].join("")}});t.default={DatasetAssociation:f,DatasetAssociationCollection:p}}).call(t,n(2),n(1),n(0))},function(e,t,n){"use strict";(function(e){function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var r=n(8),a=(i(r),n(4)),o=(i(a),n(3)),s=(i(o),1e3);try{s=localStorage.getItem("collectionFuzzyCountDefault")||s}catch(e){}var l={defaults:{history_id:null,history_content_type:null,hid:null,visible:!0},idAttribute:"type_id",hidden:function(){return!this.get("visible")},isVisible:function(e,t){var n=!0;return e||!this.get("deleted")&&!this.get("purged")||(n=!1),t||this.get("visible")||(n=!1),n},urlRoot:Galaxy.root+"api/histories/",url:function(){var e=this.get("history_content_type"),t=this.get("history_id"),n=this.get("id"),i=""+this.urlRoot+t+"/contents/"+e+"s/"+n;return"dataset_collection"==e&&(i=i+"?view=element-reference&fuzzy_count="+s),i},hide:function(t){return this.get("visible")?this.save({visible:!1},t):e.when()},unhide:function(t){return this.get("visible")?e.when():this.save({visible:!0},t)},toString:function(){return[this.get("type_id"),this.get("hid"),this.get("name")].join(":")}};t.default={HistoryContentMixin:l}}).call(t,n(0))},function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0});var n={_validationWarning:function(e,t){"name"===e&&(e=this.$(".collection-name").add(this.$(".collection-name-prompt")),this.$(".collection-name").focus().select()),t?(e=e||this.$(".validation-warning"),e.removeClass("validation-warning")):e.addClass("validation-warning")},_changeHideOriginals:function(e){this.hideOriginals=this.$(".hide-originals").prop("checked")},_changeName:function(e){this._validationWarning("name",!!this._getName())},_nameCheckForEnter:function(e){13!==e.keyCode||this.blocking||this._clickCreate()},_getName:function(){return e.escape(this.$(".collection-name").val())},_clickMoreHelp:function(e){e.stopPropagation(),this.$(".main-help").addClass("expanded"),this.$(".more-help").hide()},_clickLessHelp:function(e){e.stopPropagation(),this.$(".main-help").removeClass("expanded"),this.$(".more-help").show()},_toggleHelp:function(e){e.stopPropagation(),this.$(".main-help").toggleClass("expanded"),this.$(".more-help").toggle()},_showAlert:function(e,t){t=t||"alert-danger",this.$(".main-help").hide(),this.$(".header .alert").attr("class","alert alert-dismissable").addClass(t).show().find(".alert-message").html(e)},_hideAlert:function(e){this.$(".main-help").show(),this.$(".header .alert").hide()},_cancelCreate:function(e){"function"==typeof this.oncancel&&this.oncancel.call(this)},_clickCreate:function(e){var t=this._getName();t?this.blocking||this.createList(t):this._validationWarning("name")},_setUpCommonSettings:function(e){this.hideOriginals=e.defaultHideSourceItems||!1},_renderFooter:function(t,n){var i=this,r=this.$(".footer").empty().html(this.templates.footer());return e.each(this.footerSettings,function(e,t){i.$(t).prop("checked",i[e])}),"function"==typeof this.oncancel&&this.$(".cancel-create.btn").show(),r},_creatorTemplates:{main:e.template(['<div class="header flex-row no-flex"></div>','<div class="middle flex-row flex-row-container"></div>','<div class="footer flex-row no-flex"></div>'].join(""))}};t.default={CollectionCreatorMixin:n}}).call(t,n(1))},function(e,t,n){"use strict";function i(e,t){var n=/(-?[0-9\.]+)/g,i=e.toString().toLowerCase()||"",r=t.toString().toLowerCase()||"",a=String.fromCharCode(0),o=i.replace(n,a+"$1"+a).split(a),s=r.replace(n,a+"$1"+a).split(a),l=new Date(i).getTime(),c=l?new Date(r).getTime():null;if(c){if(l<c)return-1;if(l>c)return 1}for(var d,u,h=0,f=Math.max(o.length,s.length);h<f;h++){if(d=parseFloat(o[h])||o[h],u=parseFloat(s[h])||s[h],d<u)return-1;if(d>u)return 1}return 0}Object.defineProperty(t,"__esModule",{value:!0}),t.default=i},function(e,t,n){"use strict";var i=n(0),r=function(e){return e&&e.__esModule?e:{default:e}}(i),a=r.default;r.default.fn.extend({hoverhighlight:function(e,t){return e=e||"body",this.length?(a(this).each(function(){var n=a(this),i=n.data("target");i&&n.mouseover(function(n){a(i,e).css({background:t})}).mouseout(function(e){a(i).css({background:""})})}),this):this}})},function(e,t,n){"use strict";(function(e,i,r){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(9),s=a(o),l=n(37),c=a(l),d=n(3),u=a(d),h={defaultName:e.template("Copy of '<%- name %>'"),title:e.template((0,u.default)("Copying history")+' "<%- name %>"'),submitLabel:(0,u.default)("Copy"),errorMessage:(0,u.default)("History could not be copied."),progressive:(0,u.default)("Copying history"),activeLabel:(0,u.default)("Copy only the active, non-deleted datasets"),allLabel:(0,u.default)("Copy all datasets including deleted ones"),anonWarning:(0,u.default)("As an anonymous user, unless you login or register, you will lose your current history ")+(0,u.default)("after copying this history. "),_template:e.template(["<% if( isAnon ){ %>",'<div class="warningmessage">',"<%- anonWarning %>",(0,u.default)("You can"),' <a href="/user/login">',(0,u.default)("login here"),"</a> ",(0,u.default)("or")," ",' <a href="/user/create">',(0,u.default)("register here"),"</a>.","</div>","<% } %>","<form>",'<label for="copy-modal-title">',(0,u.default)("Enter a title for the new history"),":","</label><br />",'<input id="copy-modal-title" class="form-control" style="width: 100%" value="<%= name %>" />','<p class="invalid-title bg-danger" style="color: red; margin: 8px 0px 8px 0px; display: none">',(0,u.default)("Please enter a valid history title"),"</p>","<% if( allowAll ){ %>","<br />","<p>",(0,u.default)("Choose which datasets from the original history to include:"),"</p>",'<input name="copy-what" type="radio" id="copy-non-deleted" value="copy-non-deleted" ','<% if( copyWhat === "copy-non-deleted" ){ print( "checked" ); } %>/>','<label for="copy-non-deleted"> <%- activeLabel %></label>',"<br />",'<input name="copy-what" type="radio" id="copy-all" value="copy-all" ','<% if( copyWhat === "copy-all" ){ print( "checked" ); } %>/>','<label for="copy-all"> <%- allLabel %></label>',"<% } %>","</form>"].join("")),_showAjaxIndicator:function(){var e='<p><span class="fa fa-spinner fa-spin"></span> '+this.progressive+"...</p>";this.modal.$(".modal-body").empty().append(e).css({"margin-top":"8px"})},dialog:function(t,n,a){function o(){var e=t.$("#copy-modal-title").val();if(!e)return void t.$(".invalid-title").show();var i="copy-all"===t.$('input[name="copy-what"]:checked').val();t.$("button").prop("disabled",!0),s._showAjaxIndicator(),n.copy(!0,e,i).done(function(e){l.resolve(e)}).fail(function(t,r,a){var o={name:e,copyAllDatasets:i};c.default.ajaxErrorModal(n,t,o,s.errorMessage),l.rejectWith(l,arguments)}).done(function(){g&&t.hide()})}a=a||{};var s=this,l=i.Deferred(),d=a.nameFn||this.defaultName,h=d({name:n.get("name")}),f=a.allDatasets?"copy-all":"copy-non-deleted",p=!!e.isUndefined(a.allowAll)||a.allowAll,g=!!e.isUndefined(a.autoClose)||a.autoClose;this.modal=t;var m=a.closing_callback;return t.show(e.extend(a,{title:this.title({name:n.get("name")}),body:r(s._template({name:h,isAnon:Galaxy.user.isAnonymous(),allowAll:p,copyWhat:f,activeLabel:this.activeLabel,allLabel:this.allLabel,anonWarning:this.anonWarning})),buttons:e.object([[(0,u.default)("Cancel"),function(){t.hide()}],[this.submitLabel,o]]),height:"auto",closing_events:!0,closing_callback:function(e){e&&l.reject({cancelled:!0}),m&&m(e)}})),t.$("#copy-modal-title").focus().select(),t.$("#copy-modal-title").on("keydown",function(e){13===e.keyCode&&(e.preventDefault(),o())}),l}},f=e.extend({},h,{defaultName:e.template("imported: <%- name %>"),title:e.template((0,u.default)("Importing history")+' "<%- name %>"'),submitLabel:(0,u.default)("Import"),errorMessage:(0,u.default)("History could not be imported."),progressive:(0,u.default)("Importing history"),activeLabel:(0,u.default)("Import only the active, non-deleted datasets"),allLabel:(0,u.default)("Import all datasets including deleted ones"),anonWarning:(0,u.default)("As an anonymous user, unless you login or register, you will lose your current history ")+(0,u.default)("after importing this history. ")}),p=function(e,t){t=t||{};var n=window.parent.Galaxy.modal||new s.default.View({});return t.useImport?f.dialog(n,e,t):h.dialog(n,e,t)};t.default=p}).call(t,n(1),n(0),n(0))},function(e,t,n){"use strict";(function(e){function i(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}Object.defineProperty(t,"__esModule",{value:!0});var r=n(1),a=i(r),o=n(2),s=i(o),l=n(4),c=function(e){return e&&e.__esModule?e:{default:e}}(l),d=s.Collection.extend({initialize:function(e,t){s.Collection.prototype.initialize.call(this,e,t),this.setOrder(t.order||this.order,{silent:!0})},_setUpListeners:function(){return this.on({"changed-order":this.sort})},fetch:function(e){return e=this._buildFetchOptions(e),Galaxy.debug("fetch options:",e),s.Collection.prototype.fetch.call(this,e)},_buildFetchOptions:function(e){e=a.clone(e)||{},e.traditional=!0,e.data=e.data||this._buildFetchData(e),Galaxy.debug("data:",e.data);var t=this._buildFetchFilters(e);return Galaxy.debug("filters:",t),a.isEmpty(t)||a.extend(e.data,this._fetchFiltersToAjaxData(t)),Galaxy.debug("data:",e.data),e},_buildFetchData:function(e){var t={};return this.order&&(t.order=this.order),a.defaults(a.pick(e,this._fetchParams),t)},_fetchParams:["order","limit","offset","view","keys"],_buildFetchFilters:function(e){return a.clone(e.filters||{})},_fetchFiltersToAjaxData:function(e){var t={q:[],qv:[]};return a.each(e,function(e,n){void 0!==e&&""!==e&&(!0===e&&(e="True"),!1===e&&(e="False"),null===e&&(e="None"),t.q.push(n),t.qv.push(e))}),t},reset:function(e,t){return this.allFetched=!1,s.Collection.prototype.reset.call(this,e,t)},order:null,comparators:{update_time:c.default.buildComparator("update_time",{ascending:!1}),"update_time-asc":c.default.buildComparator("update_time",{ascending:!0}),create_time:c.default.buildComparator("create_time",{ascending:!1}),"create_time-asc":c.default.buildComparator("create_time",{ascending:!0})},setOrder:function(e,t){t=t||{};var n=this,i=n.comparators[e];if(a.isUndefined(i))throw new Error("unknown order: "+e);if(i!==n.comparator)return n.order=e,n.comparator=i,t.silent||n.trigger("changed-order",t),n}}),u=d.extend({limitPerPage:500,initialize:function(e,t){d.prototype.initialize.call(this,e,t),this.currentPage=t.currentPage||0},getTotalItemCount:function(){return this.length},shouldPaginate:function(){return this.getTotalItemCount()>=this.limitPerPage},getLastPage:function(){return Math.floor(this.getTotalItemCount()/this.limitPerPage)},getPageCount:function(){return this.getLastPage()+1},getPageLimitOffset:function(e){return e=this.constrainPageNum(e),{limit:this.limitPerPage,offset:e*this.limitPerPage}},constrainPageNum:function(e){return Math.max(0,Math.min(e,this.getLastPage()))},fetchPage:function(e,t){var n=this;return e=n.constrainPageNum(e),n.currentPage=e,t=a.defaults(t||{},n.getPageLimitOffset(e)),n.trigger("fetching-more"),n.fetch(t).always(function(){n.trigger("fetching-more-done")})},fetchCurrentPage:function(e){return this.fetchPage(this.currentPage,e)},fetchPrevPage:function(e){return this.fetchPage(this.currentPage-1,e)},fetchNextPage:function(e){return this.fetchPage(this.currentPage+1,e)}}),h=d.extend({limitOnFirstFetch:null,limitPerFetch:100,initialize:function(e,t){d.prototype.initialize.call(this,e,t),this.limitOnFirstFetch=t.limitOnFirstFetch||this.limitOnFirstFetch,this.limitPerFetch=t.limitPerFetch||this.limitPerFetch,this.allFetched=!1,this.lastFetched=t.lastFetched||0},_buildFetchOptions:function(e){return e.remove=e.remove||!1,d.prototype._buildFetchOptions.call(this,e)},fetchFirst:function(e){return Galaxy.debug("ControlledFetchCollection.fetchFirst:",e),e=e?a.clone(e):{},this.allFetched=!1,this.lastFetched=0,this.fetchMore(a.defaults(e,{reset:!0,limit:this.limitOnFirstFetch}))},fetchMore:function(t){Galaxy.debug("ControlledFetchCollection.fetchMore:",t),t=a.clone(t||{});var n=this;if(Galaxy.debug("fetchMore, options.reset:",t.reset),!t.reset&&n.allFetched)return e.when();t.reset?t.offset=0:void 0===t.offset&&(t.offset=n.lastFetched);var i=t.limit=t.limit||n.limitPerFetch||null;return Galaxy.debug("fetchMore, limit:",i,"offset:",t.offset),n.trigger("fetching-more"),n.fetch(t).always(function(){n.trigger("fetching-more-done")}).done(function(e){var t=a.isArray(e)?e.length:0;n.lastFetched+=t,Galaxy.debug("fetchMore, lastFetched:",n.lastFetched),(!i||t<i)&&(n.allFetched=!0,n.trigger("all-fetched",this))})},fetchAll:function(e){e=e||{};var t=this;return e=a.pick(e,"silent"),e.filters={},t.fetch(e).done(function(){t.allFetched=!0,t.trigger("all-fetched",t)})}});t.default={ControlledFetchCollection:d,PaginatedCollection:u,InfinitelyScrollingCollection:h}}).call(t,n(0))},function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0});var i=n(4),r=function(e){return e&&e.__esModule?e:{default:e}}(i),a=r.default.SessionStorageModel.extend({defaults:{expandedIds:{},show_deleted:!1,show_hidden:!1},addExpanded:function(e){var t=this.get("expandedIds");t[e.id]=e.get("id"),this.save("expandedIds",t)},removeExpanded:function(e){var t=this.get("expandedIds");delete t[e.id],this.save("expandedIds",t)},isExpanded:function(t){return e.result(this.get("expandedIds"),t,!1)},allExpanded:function(){return e.values(this.get("expandedIds"))},clearExpanded:function(){this.set("expandedIds",{})},includeDeleted:function(t){return e.isUndefined(t)||this.set("show_deleted",t),this.get("show_deleted")},includeHidden:function(t){return e.isUndefined(t)||this.set("show_hidden",t),this.get("show_hidden")},toString:function(){return"HistoryPrefs("+this.id+")"}},{storageKeyPrefix:"history:",historyStorageKey:function(e){if(!e)throw new Error("HistoryPrefs.historyStorageKey needs valid id: "+e);return a.storageKeyPrefix+e},get:function(e){return new a({id:a.historyStorageKey(e)})},clearAll:function(e){for(var t in sessionStorage)0===t.indexOf(a.storageKeyPrefix)&&sessionStorage.removeItem(t)}});t.default={HistoryPrefs:a}}).call(t,n(1))},function(e,t,n){"use strict";(function(e,i){function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var a=n(39),o=r(a),s=n(31),l=r(s),c=n(16),d=r(c),u=n(57),h=(r(u),n(41)),f=r(h),p=n(42),g=r(p),m=n(67),_=(r(m),n(37)),v=r(_),y=n(10),b=r(y),w=n(4),x=r(w),k=n(3),M=r(k);n(40);var C=o.default.ModelListPanel,S=C.extend({_logNamespace:"history",HDAViewClass:f.default.HDAListItemView,HDCAViewClass:g.default.HDCAListItemView,collectionClass:d.default.HistoryContents,modelCollectionKey:"contents",tagName:"div",className:C.prototype.className+" history-panel",emptyMsg:(0,M.default)("This history is empty"),noneFoundMsg:(0,M.default)("No matching datasets found"),searchPlaceholder:(0,M.default)("search datasets"),initialize:function(e){C.prototype.initialize.call(this,e),this.linkTarget=e.linkTarget||"_blank"},_createDefaultCollection:function(){return new this.collectionClass([],{history:this.model})},freeModel:function(){return C.prototype.freeModel.call(this),this.model&&this.model.stopPolling(),this},_setUpListeners:function(){C.prototype._setUpListeners.call(this),this.on({error:function(e,t,n,i,r){this.errorHandler(e,t,n,i,r)},"views:ready view:attached view:removed":function(e){this._renderSelectButton()},"view:attached":function(e){this.scrollTo(0)}})},loadHistory:function(t,n,i){var r=this;return i=e.extend(i||{silent:!0}),this.info("loadHistory:",t,n,i),this.setModel(new l.default.History({id:t})),i.silent=!0,this.trigger("loading"),this.model.fetchWithContents(n,i).always(function(){r.render(),r.trigger("loading-done")})},refreshContents:function(e){return this.model?this.model.refresh(e):i.when()},_setUpCollectionListeners:function(){return C.prototype._setUpCollectionListeners.call(this),this.listenTo(this.collection,{"fetching-more":function(){this._toggleContentsLoadingIndicator(!0),this.$emptyMessage().hide()},"fetching-more-done":function(){this._toggleContentsLoadingIndicator(!1)}})},_showLoadingIndicator:function(t,n,r){var a=i('<div class="loading-indicator"/>');this.$el.html(a.text(t).slideDown(e.isUndefined(n)?this.fxSpeed:n))},_hideLoadingIndicator:function(t){this.$(".loading-indicator").slideUp(e.isUndefined(t)?this.fxSpeed+200:t,function(){i(this).remove()})},_buildNewRender:function(){var e=C.prototype._buildNewRender.call(this);return this._renderSelectButton(e),e},_renderSelectButton:function(e){if(e=e||this.$el,!this.multiselectActions().length)return null;if(!this.views.length)return this.hideSelectors(),e.find(".controls .actions .show-selectors-btn").remove(),null;var t=e.find(".controls .actions .show-selectors-btn");return t.length?t:(0,b.default)({title:(0,M.default)("Operations on multiple datasets"),classes:"show-selectors-btn",faIcon:"fa-check-square-o"}).prependTo(e.find(".controls .actions"))},_renderEmptyMessage:function(e){var t=this.$emptyMessage(e);return this.model.get("contents_active").active<=0?t.empty().append(this.emptyMsg).show():this.searchFor&&this.model.contents.haveSearchDetails()&&!this.views.length?t.empty().append(this.noneFoundMsg).show():(t.hide(),i())},$scrollContainer:function(e){return this.$list(e)},_toggleContentsLoadingIndicator:function(e){e?this.$list().html('<div class="contents-loading-indicator"><span class="fa fa-2x fa-spinner fa-spin"/></div>'):this.$list().find(".contents-loading-indicator").remove()},renderItems:function(e){e=e||this.$el;var t=this.$list(e);i(".tooltip").remove(),t.empty(),this.views=[];var n=this._filterCollection();return n.length?(this._renderPagination(e),this.views=this._renderSomeItems(n,t)):e.find("> .controls .list-pagination").empty(),this._renderEmptyMessage(e).toggle(!n.length),this.trigger("views:ready",this.views),this.views},_renderPagination:function(e){var t=e.find("> .controls .list-pagination");return this.searchFor||!this.model.contents.shouldPaginate()?t.empty():(t.html(this.templates.pagination({current:this.model.contents.currentPage+1,last:this.model.contents.getLastPage()+1},this)),t.find("select.pages").tooltip(),t)},_renderSomeItems:function(e,t){var n=this,i=[];return t.append(e.map(function(e){var t=n._createItemView(e);return i.push(t),n._renderItemView$el(t)})),i},_filterItem:function(e){var t=this.model.contents;return(t.includeHidden||!e.hidden())&&(t.includeDeleted||!e.isDeletedOrPurged())&&C.prototype._filterItem.call(this,e)},_getItemViewClass:function(e){var t=e.get("history_content_type");switch(t){case"dataset":return this.HDAViewClass;case"dataset_collection":return this.HDCAViewClass}throw new TypeError("Unknown history_content_type: "+t)},_getItemViewOptions:function(t){var n=C.prototype._getItemViewOptions.call(this,t);return e.extend(n,{linkTarget:this.linkTarget,expanded:this.model.contents.storage.isExpanded(t.id),hasUser:this.model.ownedByCurrUser()})},_setUpItemViewListeners:function(e){var t=this;return C.prototype._setUpItemViewListeners.call(t,e),t.listenTo(e,{expanded:function(e){t.model.contents.storage.addExpanded(e.model)},collapsed:function(e){t.model.contents.storage.removeExpanded(e.model)}})},collapseAll:function(){this.model.contents.storage.clearExpanded(),C.prototype.collapseAll.call(this)},getSelectedModels:function(){var e=C.prototype.getSelectedModels.call(this);return e.historyId=this.collection.historyId,e},events:e.extend(e.clone(C.prototype.events),{"click .show-selectors-btn":"toggleSelectors","click > .controls .prev":"_clickPrevPage","click > .controls .next":"_clickNextPage","change > .controls .pages":"_changePageSelect","click .messages [class$=message]":"clearMessages"}),_clickPrevPage:function(e){this.model.stopPolling(),this.model.contents.fetchPrevPage()},_clickNextPage:function(e){this.model.stopPolling(),this.model.contents.fetchNextPage()},_changePageSelect:function(e){this.model.stopPolling();var t=i(e.currentTarget).val();this.model.contents.fetchPage(t)},toggleShowDeleted:function(e,t){e=void 0!==e?e:!this.model.contents.includeDeleted;var n=this.model.contents;return n.setIncludeDeleted(e,t),this.trigger("show-deleted",e),n.fetchCurrentPage({renderAll:!0}),e},toggleShowHidden:function(e,t,n){e=void 0!==e?e:!this.model.contents.includeHidden;var i=this.model.contents;return i.setIncludeHidden(e,n),this.trigger("show-hidden",e),i.fetchCurrentPage({renderAll:!0}),e},_firstSearch:function(e){var t=this;if(this.log("onFirstSearch",e),this.model.contents.haveSearchDetails())return void this.searchItems(e);this.$("> .controls .search-input").searchInput("toggle-loading"),this.searchFor=e;this.model.contents.progressivelyFetchDetails({silent:!0}).progress(function(e,n,i){t.renderItems(),t.trigger("search:loading-progress",n,i)}).always(function(){t.$el.find("> .controls .search-input").searchInput("toggle-loading")}).done(function(){t.searchItems(e,"force")})},clearSearch:function(e){var t=this;return this.searchFor?(this.searchFor="",this.trigger("search:clear",this),this.$("> .controls .search-query").val(""),this.model.contents.fetchCurrentPage({silent:!0}).done(function(){t.renderItems()}),this):this},errorHandler:function(t,n,i){if(!n||0!==n.status||0!==n.readyState){if(this.error(t,n,i),e.isString(t)&&e.isString(n)){var r=t,a=n;return v.default.errorModal(r,a,i)}return n&&502===n.status?v.default.badGatewayErrorModal():v.default.ajaxErrorModal(t,n,i)}},clearMessages:function(t){return(e.isUndefined(t)?this.$messages().children('[class$="message"]'):i(t.currentTarget)).fadeOut(this.fxSpeed,function(){i(this).remove()}),this},scrollToHid:function(t){return this.scrollToItem(e.first(this.viewsWhereModel({hid:t})))},ordinalIndicator:function(e){var t=""+e;switch(t.charAt(t.length-1)){case"1":return t+"st";case"2":return t+"nd";case"3":return t+"rd";default:return t+"th"}},toString:function(){return"HistoryView("+(this.model?this.model.get("name"):"")+")"}});S.prototype.templates=function(){var t=function(){return'<div>\n            <div class="controls"></div>\n            <ul class="list-items"></ul>\n            <div class="empty-message infomessagesmall"></div>\',\n        </div>'},n=x.default.wrapTemplate(['<div class="controls">','<div class="title">','<div class="name"><%- history.name %></div>',"</div>",'<div class="subtitle"></div>','<div class="history-size"><%- history.nice_size %></div>','<div class="actions"></div>','<div class="messages">',"<% if( history.deleted && history.purged ){ %>",'<div class="deleted-msg warningmessagesmall">',(0,M.default)("This history has been purged and deleted"),"</div>","<% } else if( history.deleted ){ %>",'<div class="deleted-msg warningmessagesmall">',(0,M.default)("This history has been deleted"),"</div>","<% } else if( history.purged ){ %>",'<div class="deleted-msg warningmessagesmall">',(0,M.default)("This history has been purged"),"</div>","<% } %>","<% if( history.message ){ %>",'<div class="<%= history.message.level || "info" %>messagesmall">',"<%= history.message.text %>","</div>","<% } %>","</div>",'<div class="tags-display"></div>','<div class="annotation-display"></div>','<div class="search">','<div class="search-input"></div>',"</div>",'<div class="list-actions">','<div class="btn-group">','<button class="select-all btn btn-default"','data-mode="select">',(0,M.default)("All"),"</button>",'<button class="deselect-all btn btn-default"','data-mode="select">',(0,M.default)("None"),"</button>","</div>",'<div class="list-action-menu btn-group">',"</div>","</div>",'<div class="list-pagination form-inline"></div>',"</div>"],"history"),i=x.default.wrapTemplate(['<button class="prev" <%- pages.current === 1 ? "disabled" : "" %>>previous</button>','<select class="pages form-control" ','title="',(0,M.default)("Click to open and select a page. Begin typing a page number to select it"),'">',"<% _.range( 1, pages.last + 1 ).forEach( function( i ){ %>",'<option value="<%- i - 1 %>" <%- i === pages.current ? "selected" : "" %>>',"<%- view.ordinalIndicator( i ) %> of <%- pages.last %> pages","</option>","<% }); %>","</select>",'<button class="next" <%- pages.current === pages.last ? "disabled" : "" %>>next</button>'],"pages");return e.extend(e.clone(C.prototype.templates),{el:t,controls:n,pagination:i})}(),t.default={HistoryView:S}}).call(t,n(1),n(0))},function(e,t,n){"use strict";(function(e){function n(t){return'<span class="label label-info">'+e.escape(t.slice(5))+"</span>"}function i(t){var i=e.filter(e.uniq(t.tags),function(e){return 0===e.indexOf("name:")}),r=e.sortBy(i).map(n);return'\n        <div class="nametags" title="'+i.length+' nametags">\n            '+r.join("")+"\n        </div>"}Object.defineProperty(t,"__esModule",{value:!0}),t.default={nametagTemplate:i}}).call(t,n(1))},function(e,t,n){"use strict";(function(e){function i(e){return e&&e.__esModule?e:{default:e}}function r(e){var t=e.get("collection_type");return"list"==t?(0,f.default)("list"):"paired"==t?(0,f.default)("dataset pair"):"list:paired"==t?(0,f.default)("list of pairs"):(0,f.default)("nested list")}function a(e){var t=e.get("element_count"),n="a "+r(e);if(t){var i;1==t?i="with 1 item":t&&(i="with "+t+" items"),n=n+" "+(0,f.default)(i)}return n}Object.defineProperty(t,"__esModule",{value:!0});var o=n(39),s=i(o),l=n(30),c=(i(l),n(32)),d=i(c),u=n(4),h=(i(u),n(3)),f=i(h),p=s.default.ModelListPanel,g=p.extend({_logNamespace:"collections",className:p.prototype.className+" dataset-collection-panel",DatasetDCEViewClass:d.default.DatasetDCEListItemView,modelCollectionKey:"elements",initialize:function(e){p.prototype.initialize.call(this,e),this.linkTarget=e.linkTarget||"_blank",this.dragItems=!0,this.hasUser=e.hasUser,this.panelStack=[],this.parentName=e.parentName,this.foldoutStyle=e.foldoutStyle||"foldout",this.downloadUrl=Galaxy.root+"api/dataset_collections/"+this.model.attributes.id+"/download"},getNestedDCDCEViewClass:function(){return d.default.NestedDCDCEListItemView.extend({foldoutPanelClass:g})},_queueNewRender:function(e,t){t=void 0===t?this.fxSpeed:t;var n=this;this.handleWarning(e),n.log("_queueNewRender:",e,t),n._swapNewRender(e),n.trigger("rendered",n)},handleWarning:function(e){var t=this.views.length,n=this.model.get("element_count");if(n&&n!==t){var i=(0,f.default)("displaying only "+t+" of "+n+" items");e.find(".elements-warning").html('<div class="warningmessagesmall">'+i+"</div>")}},_filterCollection:function(){return this.model.getVisibleContents()},_getItemViewClass:function(e){switch(e.get("element_type")){case"hda":return this.DatasetDCEViewClass;case"dataset_collection":return this.getNestedDCDCEViewClass()}throw new TypeError("Unknown element type:",e.get("element_type"))},_getItemViewOptions:function(t){var n=p.prototype._getItemViewOptions.call(this,t);return e.extend(n,{linkTarget:this.linkTarget,hasUser:this.hasUser,foldoutStyle:this.foldoutStyle})},_setUpItemViewListeners:function(e){var t=this;return p.prototype._setUpItemViewListeners.call(t,e),t.listenTo(e,{"expanded:drilldown":function(e,t){this._expandDrilldownPanel(t)},"collapsed:drilldown":function(e,t){this._collapseDrilldownPanel(t)}}),this},_expandDrilldownPanel:function(e){this.panelStack.push(e),this.$("> .controls").add(this.$list()).hide(),e.parentName=this.model.get("name"),this.$el.append(e.render().$el)},_collapseDrilldownPanel:function(e){this.panelStack.pop(),this.render()},events:{"click .navigation .back":"close"},close:function(e){this.remove(),this.trigger("close")},toString:function(){return"CollectionView("+(this.model?this.model.get("name"):"")+")"}});g.prototype.templates=function(){var t=function(t,n){var i=a(n.model);return'\n        <div class="controls">\n            <div class="navigation">\n            <a class="back" href="javascript:void(0)">\n                <span class="fa fa-icon fa-angle-left"></span>\n                '+(0,f.default)("Back to ")+"\n                "+e.escape(n.parentName)+'\n            </a>\n            </div>\n            <div class="title">\n                <div class="name">'+(e.escape(t.name)||e.escape(t.element_identifier))+'</div>\n                <div class="subtitle">\n                    '+i+'\n                </div>\n            </div>\n            <div class="elements-warning">\n            </div>\n            <div class="tags-display"></div>\n            <div class="actions">\n                <a class="download-btn icon-btn" href="'+n.downloadUrl+'"\n                   title="" download="" data-original-title="Download Collection">\n                   <span class="fa fa-floppy-o"></span>\n                </a>\n            </div>\n        </div>'};return e.extend(e.clone(p.prototype.templates),{controls:t})}(),t.default={collectionTypeDescription:r,collectionDescription:a,CollectionView:g}}).call(t,n(1))},function(e,t,n){"use strict";(function(e,i){function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var a=n(8),o=r(a),s=n(17),l=r(s),c=n(23),d=r(c),u=n(62),h=r(u),f=n(10),p=r(f),g=n(4),m=r(g),_=n(3),v=r(_),y=l.default.DatasetListItemView,b=y.extend({initialize:function(e){y.prototype.initialize.call(this,e),this.hasUser=e.hasUser,this.purgeAllowed=e.purgeAllowed||!1,this.tagsEditorShown=e.tagsEditorShown||!1,this.annotationEditorShown=e.annotationEditorShown||!1},_renderPrimaryActions:function(){var e=y.prototype._renderPrimaryActions.call(this);return this.model.get("state")===o.default.NOT_VIEWABLE?e:y.prototype._renderPrimaryActions.call(this).concat([this._renderEditButton(),this._renderDeleteButton()])},_renderEditButton:function(){var t=this;if(this.model.get("state")===o.default.DISCARDED||!this.model.get("accessible"))return null;var n=this.model.get("purged"),i=this.model.get("deleted"),r={title:(0,v.default)("Edit attributes"),href:Galaxy.root+"datasets/edit?dataset_id="+this.model.attributes.id,faIcon:"fa-pencil",classes:"edit-btn",onclick:function(e){Galaxy.router&&(e.preventDefault(),Galaxy.router.push("datasets/edit",{dataset_id:t.model.attributes.id}))}};return i||n?(r.disabled=!0,n?r.title=(0,v.default)("Cannot edit attributes of datasets removed from disk"):i&&(r.title=(0,v.default)("Undelete dataset to edit attributes"))):e.contains([o.default.UPLOAD,o.default.NEW],this.model.get("state"))&&(r.disabled=!0,r.title=(0,v.default)("This dataset is not yet editable")),(0,p.default)(r)},_renderDeleteButton:function(){if(!this.model.get("accessible"))return null;var e=this,t=this.model.isDeletedOrPurged();return(0,p.default)({title:t?(0,v.default)("Dataset is already deleted"):(0,v.default)("Delete"),disabled:t,faIcon:"fa-times",classes:"delete-btn",onclick:function(){e.$el.find(".icon-btn.delete-btn").trigger("mouseout"),e.model.delete()}})},_renderDetails:function(){var t=y.prototype._renderDetails.call(this),n=this.model.get("state");return!this.model.isDeletedOrPurged()&&e.contains([o.default.OK,o.default.FAILED_METADATA],n)&&(this._renderTags(t),this._renderAnnotation(t),this._makeDbkeyEditLink(t)),this._setUpBehaviors(t),t},_renderToolHelpButton:function(){var e=this.model.attributes.dataset_id,t=this.model.attributes.creating_job,n=this,r=function(t){var r='<div id="thdiv-'+e+'" class="toolhelp">';t.name&&t.help?(r+="<strong>Tool help for "+t.name+"</strong><hr/>",r+=t.help):r+="<strong>Tool help is unavailable for this dataset.</strong><hr/>",r+="</div>",n.$el.find(".details").append(i.parseHTML(r))},a=function(e){i.ajax({url:Galaxy.root+"api/tools/"+e.tool_id+"/build"}).done(function(e){r(e)}).fail(function(){r({})})};return null===Galaxy.user.id?null:(0,p.default)({title:(0,v.default)("Tool Help"),classes:"icon-btn",href:"#",faIcon:"fa-question",onclick:function(){n.$el.find(".toolhelp").length>0?n.$el.find(".toolhelp").toggle():i.ajax({url:Galaxy.root+"api/jobs/"+t}).done(function(e){a(e)}).fail(function(){console.log('Failed at recovering job information from the  Galaxy API for job id "'+t+'".')})}})},_renderSecondaryActions:function(){var e=y.prototype._renderSecondaryActions.call(this);switch(this.model.get("state")){case o.default.UPLOAD:case o.default.NOT_VIEWABLE:return e;case o.default.ERROR:return e.unshift(this._renderErrButton()),e.concat([this._renderRerunButton(),this._renderToolHelpButton()]);case o.default.OK:case o.default.FAILED_METADATA:return e.concat([this._renderRerunButton(),this._renderVisualizationsButton(),this._renderToolHelpButton()])}return e.concat([this._renderRerunButton(),this._renderToolHelpButton()])},_renderErrButton:function(){var e=this;return(0,p.default)({title:(0,v.default)("View or report this error"),href:Galaxy.root+"datasets/error?dataset_id="+this.model.attributes.id,classes:"report-error-btn",faIcon:"fa-bug",onclick:function(t){Galaxy.router&&(t.preventDefault(),Galaxy.router.push("datasets/error",{dataset_id:e.model.attributes.id}))}})},_renderRerunButton:function(){var e=this.model.get("creating_job");if(this.model.get("rerunnable"))return(0,p.default)({title:(0,v.default)("Run this job again"),href:this.model.urls.rerun,classes:"rerun-btn",target:this.linkTarget,faIcon:"fa-refresh",onclick:function(t){Galaxy.router&&(t.preventDefault(),Galaxy.router.push("/",{job_id:e}))}})},_renderVisualizationsButton:function(){var t=this.model.get("visualizations");if(this.model.isDeletedOrPurged()||!this.hasUser||!this.model.hasData()||e.isEmpty(t))return null;if(!e.isObject(t[0]))return this.warn("Visualizations have been switched off"),null;var n=i(this.templates.visualizations(t,this));return n.find('[target="galaxy_main"]').attr("target",this.linkTarget),this._addScratchBookFn(n.find(".visualization-link").addBack(".visualization-link")),n},_addScratchBookFn:function(e){e.click(function(e){Galaxy.frame&&Galaxy.frame.active&&(Galaxy.frame.add({title:(0,v.default)("Visualization"),url:i(this).attr("href")}),e.preventDefault(),e.stopPropagation())})},_renderTags:function(e){if(this.hasUser){var t=this;this.tagsEditor=new d.default.TagsEditor({model:this.model,el:e.find(".tags-display"),onshowFirstTime:function(){this.render()},onshow:function(){t.tagsEditorShown=!0},onhide:function(){t.tagsEditorShown=!1},$activator:(0,p.default)({title:(0,v.default)("Edit dataset tags"),classes:"tag-btn",faIcon:"fa-tags"}).appendTo(e.find(".actions .right"))}),this.tagsEditorShown&&this.tagsEditor.toggle(!0)}},_renderAnnotation:function(e){if(this.hasUser){var t=this;this.annotationEditor=new h.default.AnnotationEditor({model:this.model,el:e.find(".annotation-display"),onshowFirstTime:function(){this.render()},onshow:function(){t.annotationEditorShown=!0},onhide:function(){t.annotationEditorShown=!1},$activator:(0,p.default)({title:(0,v.default)("Edit dataset annotation"),classes:"annotate-btn",faIcon:"fa-comment"}).appendTo(e.find(".actions .right"))}),this.annotationEditorShown&&this.annotationEditor.toggle(!0)}},_makeDbkeyEditLink:function(e){if("?"===this.model.get("metadata_dbkey")&&!this.model.isDeletedOrPurged()){var t=i('<a class="value">?</a>').attr("href",this.model.urls.edit).attr("target","_top");e.find(".dbkey .value").replaceWith(t)}},events:e.extend(e.clone(y.prototype.events),{"click .undelete-link":"_clickUndeleteLink","click .purge-link":"_clickPurgeLink","click .edit-btn":function(e){this.trigger("edit",this,e)},"click .delete-btn":function(e){this.trigger("delete",this,e)},"click .rerun-btn":function(e){this.trigger("rerun",this,e)},"click .report-err-btn":function(e){this.trigger("report-err",this,e)},"click .visualization-btn":function(e){this.trigger("visualize",this,e)},"click .dbkey a":function(e){this.trigger("edit",this,e)}}),_clickUndeleteLink:function(e){return this.model.undelete(),!1},_clickPurgeLink:function(e){return confirm((0,v.default)("This will permanently remove the data in your dataset. Are you sure?"))&&this.model.purge(),!1},toString:function(){return"HDAEditView("+(this.model?""+this.model:"(no model)")+")"}});b.prototype.templates=function(){var t=e.extend({},y.prototype.templates.warnings,{failed_metadata:m.default.wrapTemplate(['<% if( dataset.state === "failed_metadata" ){ %>','<div class="failed_metadata-warning warningmessagesmall">',(0,v.default)("An error occurred setting the metadata for this dataset"),'<br /><a href="<%- dataset.urls.edit %>" target="_top">',(0,v.default)("Set it manually or retry auto-detection"),"</a>","</div>","<% } %>"],"dataset"),deleted:m.default.wrapTemplate(["<% if( dataset.deleted && !dataset.purged ){ %>",'<div class="deleted-msg warningmessagesmall">',(0,v.default)("This dataset has been deleted"),'<br /><a class="undelete-link" href="javascript:void(0);">',(0,v.default)("Undelete it"),"</a>","<% if( view.purgeAllowed ){ %>",'<br /><a class="purge-link" href="javascript:void(0);">',(0,v.default)("Permanently remove it from disk"),"</a>","<% } %>","</div>","<% } %>"],"dataset")}),n=m.default.wrapTemplate(["<% if( visualizations.length === 1 ){ %>",'<a class="visualization-link icon-btn" href="<%- visualizations[0].href %>"',' target="<%- visualizations[0].target %>" title="',(0,v.default)("Visualize in"),' <%- visualizations[0].html %>">','<span class="fa fa-bar-chart-o"></span>',"</a>","<% } else { %>",'<div class="visualizations-dropdown dropdown icon-btn">','<a data-toggle="dropdown" title="',(0,v.default)("Visualize"),'">','<span class="fa fa-bar-chart-o"></span>',"</a>",'<ul class="dropdown-menu" role="menu">',"<% _.each( visualizations, function( visualization ){ %>",'<li><a class="visualization-link" href="<%- visualization.href %>"',' target="<%- visualization.target %>">',"<%- visualization.html %>","</a></li>","<% }); %>","</ul>","</div>","<% } %>"],"visualizations");return e.extend({},y.prototype.templates,{warnings:t,visualizations:n})}(),t.default={DatasetListItemEdit:b}}).call(t,n(1),n(0))},function(e,t,n){"use strict";(function(e,i){function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var a=n(4),o=r(a),s=n(3),l=r(s);n(15);var c=e.View.extend(o.default.LoggableMixin).extend(o.default.HiddenUntilActivatedViewMixin).extend({tagName:"div",className:"annotation-display",initialize:function(e){e=e||{},this.tooltipConfig=e.tooltipConfig||{placement:"bottom"},this.listenTo(this.model,"change:annotation",function(){this.render()}),this.hiddenUntilActivated(e.$activator,e)},render:function(){var e=this;return this.$el.html(this._template()),this.$annotation().make_text_editable({use_textarea:!0,on_finish:function(t){e.$annotation().text(t),e.model.save({annotation:t},{silent:!0}).fail(function(){e.$annotation().text(e.model.previous("annotation"))})}}),this},_template:function(){var e=this.model.get("annotation");return['<label class="prompt">',(0,l.default)("Annotation"),"</label>",'<div class="annotation">',i.escape(e),"</div>"].join("")},$annotation:function(){return this.$el.find(".annotation")},remove:function(){this.$annotation.off(),this.stopListening(this.model),e.View.prototype.remove.call(this)},toString:function(){return["AnnotationEditor(",""+this.model,")"].join("")}});t.default={AnnotationEditor:c}}).call(t,n(2),n(1))},,,,,,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(2),r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(i),a=n(21),o=function(e){return e&&e.__esModule?e:{default:e}}(a),s=["new","queued","running"],l=["error","deleted"],c=r.Model.extend({url:function(){return Galaxy.root+"api/histories/"+this.attributes.history_id+"/contents/dataset_collections/"+this.attributes.collection_id+"/jobs_summary"},hasDetails:function(){return this.has("populated_state")},new:function(){return!this.hasDetails()||"new"==this.get("populated_state")},errored:function(){return"error"===this.get("populated_state")||this.anyWithStates(l)},states:function(){return this.get("states")||{}},anyWithState:function(e){return(this.states()[e]||0)>0},anyWithStates:function(e){var t=this.states();for(var n in e)if((t[e[n]]||0)>0)return!0;return!1},numWithStates:function(e){var t=this.states(),n=0;for(var i in e)n+=t[e[i]]||0;return n},numInError:function(){return this.numWithStates(l)},running:function(){return this.anyWithState("running")},terminal:function(){return!this.new()&&!this.anyWithStates(s)},jobCount:function(){var e=this.states(),t=0;for(var n in e)t+=e[n];return t},toString:function(){return"JobStatesSummary(id="+this.get("id")+")"}}),d=r.Collection.extend({model:c,initialize:function(){this.updateTimeoutId=null,this.active=!0},url:function(){var e=this.models.filter(function(e){return!e.terminal()}),t=e.map(function(e){return e.get("id")}).join(","),n=e.map(function(e){return e.get("model")}).join(",");return Galaxy.root+"api/histories/"+this.historyId+"/jobs_summary?ids="+t+"&types="+n},monitor:function(){var e=this;if(this.clearUpdateTimeout(),this.active){var t=function(){e.updateTimeoutId=setTimeout(function(){e.monitor()},2e3)},n=this.models.filter(function(e){return!e.terminal()});if(n.length,!1){var i=n.map(function(e){return function(){return e.fetch()}});return new o.default.AjaxQueue(i).done(t)}n.length>0?this.fetch({remove:!1}).done(t):t()}},clearUpdateTimeout:function(){this.updateTimeoutId&&(clearTimeout(this.updateTimeoutId),this.updateTimeoutId=null)},toString:function(){return"JobStatesSummaryCollection()"}});t.default={JobStatesSummary:c,JobStatesSummaryCollection:d,FETCH_STATE_ON_ADD:!1}},function(e,t,n){"use strict";(function(e,i,r){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(58),s=a(o),l=n(16),c=(a(l),n(8)),d=(a(c),n(38)),u=a(d),h=n(73),f=a(h),p=n(96),g=a(p),m=n(23),_=a(m),v=n(62),y=a(v),b=n(29),w=a(b),x=n(74),k=a(x),M=n(75),C=a(M),S=n(10),T=a(S),E=n(47),j=(a(E),n(4)),A=a(j),N=n(3),L=a(N);n(15);var I=s.default.HistoryView,D=I.extend({HDAViewClass:f.default.HDAListItemEdit,HDCAViewClass:g.default.HDCAListItemEdit,initialize:function(e){e=e||{},I.prototype.initialize.call(this,e),this.tagsEditor=null,this.dragItems=!0,this.annotationEditor=null,this.purgeAllowed=e.purgeAllowed||!1,this.annotationEditorShown=e.annotationEditorShown||!1,this.tagsEditorShown=e.tagsEditorShown||!1},_setUpListeners:function(){return I.prototype._setUpListeners.call(this),this.on({"droptarget:drop":function(e,t){this.dataDropped(t),this.dropTargetOff()},"view:attached view:removed":function(){this._renderCounts()},"search:loading-progress":this._renderSearchProgress,"search:searching":this._renderSearchFindings})},_setUpModelListeners:function(){return I.prototype._setUpModelListeners.call(this),this.listenTo(this.model,"change:size",this.updateHistoryDiskSize),this},_setUpCollectionListeners:function(){return I.prototype._setUpCollectionListeners.call(this),this.listenTo(this.collection,{"change:deleted":this._handleItemDeletedChange,"change:visible":this._handleItemVisibleChange,"change:purged":function(e){this.model.fetch()},"fetching-deleted":function(e){this.$("> .controls .deleted-count").html("<i>"+(0,L.default)("loading...")+"</i>")},"fetching-hidden":function(e){this.$("> .controls .hidden-count").html("<i>"+(0,L.default)("loading...")+"</i>")},"fetching-deleted-done fetching-hidden-done":this._renderCounts}),this},_buildNewRender:function(){var e=I.prototype._buildNewRender.call(this);return this.model?(Galaxy&&Galaxy.user&&Galaxy.user.id&&Galaxy.user.id===this.model.get("user_id")&&(this._renderTags(e),this._renderAnnotation(e)),e):e},updateHistoryDiskSize:function(){this.$(".history-size").text(this.model.get("nice_size"))},renderItems:function(e){var t=I.prototype.renderItems.call(this,e);return this.searchFor?this._renderSearchFindings(e):this._renderCounts(e),t},_renderCounts:function(t){t=t instanceof e?t:this.$el;var n=this.templates.counts(this.model.toJSON(),this);return t.find("> .controls .subtitle").html(n)},_renderTags:function(e){var t=this;this.tagsEditor=new _.default.TagsEditor({model:this.model,el:e.find(".controls .tags-display"),onshowFirstTime:function(){this.render()},onshow:function(){t.toggleHDATagEditors(!0,t.fxSpeed)},onhide:function(){t.toggleHDATagEditors(!1,t.fxSpeed)},$activator:(0,T.default)({title:(0,L.default)("Edit history tags"),classes:"history-tag-btn",faIcon:"fa-tags"}).appendTo(e.find(".controls .actions"))})},_renderAnnotation:function(e){var t=this;this.annotationEditor=new y.default.AnnotationEditor({model:this.model,el:e.find(".controls .annotation-display"),onshowFirstTime:function(){this.render()},onshow:function(){t.toggleHDAAnnotationEditors(!0,t.fxSpeed)},onhide:function(){t.toggleHDAAnnotationEditors(!1,t.fxSpeed)},$activator:(0,T.default)({title:(0,L.default)("Edit history annotation"),classes:"history-annotate-btn",faIcon:"fa-comment"}).appendTo(e.find(".controls .actions"))})},_setUpBehaviors:function(e){if(e=e||this.$el,I.prototype._setUpBehaviors.call(this,e),this.model&&Galaxy.user&&!Galaxy.user.isAnonymous()&&Galaxy.user.id===this.model.get("user_id")){var t=this;e.find("> .controls .name").attr("title",(0,L.default)("Click to rename history")).tooltip({placement:"bottom"}).make_text_editable({on_finish:function(e){var n=t.model.get("name");e&&e!==n?(t.$el.find("> .controls .name").text(e),t.model.save({name:e}).fail(function(){t.$el.find("> .controls .name").text(t.model.previous("name"))})):t.$el.find("> .controls .name").text(n)}})}},multiselectActions:function(){var e=this,t=[{html:(0,L.default)("Hide datasets"),func:function(){var t=u.default.HistoryDatasetAssociation.prototype.hide;e.getSelectedModels().ajaxQueue(t)}},{html:(0,L.default)("Unhide datasets"),func:function(){var t=u.default.HistoryDatasetAssociation.prototype.unhide;e.getSelectedModels().ajaxQueue(t)}},{html:(0,L.default)("Delete datasets"),func:function(){var t=u.default.HistoryDatasetAssociation.prototype.delete;e.getSelectedModels().ajaxQueue(t)}},{html:(0,L.default)("Undelete datasets"),func:function(){var t=u.default.HistoryDatasetAssociation.prototype.undelete;e.getSelectedModels().ajaxQueue(t)}}];return e.purgeAllowed&&t.push({html:(0,L.default)("Permanently delete datasets"),func:function(){if(confirm((0,L.default)("This will permanently remove the data in your datasets. Are you sure?"))){var t=u.default.HistoryDatasetAssociation.prototype.purge,n=e.getSelectedModels(),i=n.filter(function(e){return"dataset"==e.get("history_content_type")});n.ajaxQueue(t,{},i)}}}),t=t.concat(e._collectionActions())},_collectionActions:function(){var e=this;return[{html:(0,L.default)("Build Dataset List"),func:function(){e.buildCollection("list")}},{html:(0,L.default)("Build Dataset Pair"),func:function(){e.buildCollection("paired")}},{html:(0,L.default)("Build List of Dataset Pairs"),func:function(){e.buildCollection("list:paired")}}]},buildCollection:function(e,t,n){var i,r=this,t=t||r.getSelectedModels(),n=n||!1;"list"==e?i=w.default.createListCollection:"paired"==e?i=k.default.createPairCollection:"list:paired"==e?i=C.default.createListOfPairsCollection:console.warn("Unknown collectionType encountered "+e),i(t,n).done(function(){r.model.refresh()})},_getItemViewOptions:function(e){var t=I.prototype._getItemViewOptions.call(this,e);return i.extend(t,{purgeAllowed:this.purgeAllowed,tagsEditorShown:this.tagsEditor&&!this.tagsEditor.hidden,annotationEditorShown:this.annotationEditor&&!this.annotationEditor.hidden}),t},_handleItemDeletedChange:function(e){e.get("deleted")?this._handleItemDeletion(e):this._handleItemUndeletion(e),this._renderCounts()},_handleItemDeletion:function(e){var t=this.model.get("contents_active");t.deleted+=1,t.active-=1,this.model.contents.includeDeleted||this.removeItemView(e),this.model.set("contents_active",t)},_handleItemUndeletion:function(e){var t=this.model.get("contents_active");t.deleted-=1,this.model.contents.includeDeleted||(t.active-=1),this.model.set("contents_active",t)},_handleItemVisibleChange:function(e){e.hidden()?this._handleItemHidden(e):this._handleItemUnhidden(e),this._renderCounts()},_handleItemHidden:function(e){var t=this.model.get("contents_active");t.hidden+=1,t.active-=1,this.model.contents.includeHidden||this.removeItemView(e),this.model.set("contents_active",t)},_handleItemUnhidden:function(e){var t=this.model.get("contents_active");t.hidden-=1,this.model.contents.includeHidden||(t.active-=1),this.model.set("contents_active",t)},toggleHDATagEditors:function(e,t){i.each(this.views,function(n){n.tagsEditor&&n.tagsEditor.toggle(e,t)})},toggleHDAAnnotationEditors:function(e,t){i.each(this.views,function(n){n.annotationEditor&&n.annotationEditor.toggle(e,t)})},events:i.extend(i.clone(I.prototype.events),{"click .show-selectors-btn":"toggleSelectors","click .toggle-deleted-link":function(e){this.toggleShowDeleted()},"click .toggle-hidden-link":function(e){this.toggleShowHidden()}}),_renderSearchProgress:function(e,t){var n=e+t;return this.$("> .controls .subtitle").html(["<i>",(0,L.default)("Searching "),n,"/",this.model.contentsShown(),"</i>"].join(""))},_renderSearchFindings:function(t){t=t instanceof e?t:this.$el;var n=this.templates.found(this.model.toJSON(),this);return t.find("> .controls .subtitle").html(n),this},dropTargetOn:function(){if(this.dropTarget)return this;this.dropTarget=!0;var e={dragenter:i.bind(this.dragenter,this),dragover:i.bind(this.dragover,this),dragleave:i.bind(this.dragleave,this),drop:i.bind(this.drop,this)},t=this._renderDropTarget();this.$list().before([this._renderDropTargetHelp(),t]);for(var n in e)e.hasOwnProperty(n)&&t.on(n,e[n]);return this},_renderDropTarget:function(){return this.$(".history-drop-target").remove(),r("<div/>").addClass("history-drop-target")},_renderDropTargetHelp:function(){return this.$(".history-drop-target-help").remove(),r("<div/>").addClass("history-drop-target-help").text((0,L.default)("Drag datasets here to copy them to the current history"))},dropTargetOff:function(){if(!this.dropTarget)return this;this.dropTarget=!1;var e=this.$(".history-drop-target").get(0);for(var t in this._dropHandlers)this._dropHandlers.hasOwnProperty(t)&&e.off(t,this._dropHandlers[t]);return this.$(".history-drop-target").remove(),this.$(".history-drop-target-help").remove(),this},dropTargetToggle:function(){return this.dropTarget?this.dropTargetOff():this.dropTargetOn(),this},dragenter:function(e){e.preventDefault(),e.stopPropagation(),this.$(".history-drop-target").css("border","2px solid black")},dragover:function(e){e.preventDefault(),e.stopPropagation()},dragleave:function(e){e.preventDefault(),e.stopPropagation(),this.$(".history-drop-target").css("border","1px dashed black")},drop:function(e){e.preventDefault();var t=this,n=e.originalEvent.dataTransfer,i=n.getData("text");n.dropEffect="move";try{i=JSON.parse(i)}catch(e){t.warn("error parsing JSON from drop:",i)}return t.trigger("droptarget:drop",e,i,t),!1},dataDropped:function(t){var n=this;return i.isObject(t)&&"HistoryDatasetAssociation"===t.model_class&&t.id?0!==n.contents.currentPage?n.contents.fetchPage(0).then(function(){return n.model.contents.copy(t.id)}):n.model.contents.copy(t.id):e.when()},toString:function(){return"HistoryViewEdit("+(this.model?this.model.get("name"):"")+")"}});D.prototype.templates=function(){var e=A.default.wrapTemplate(["<% var shown = Math.max( view.views.length, history.contents_active.active ) %>","<% if( shown ){ %>",'<span class="shown-count">',"<%- shown %> ",(0,L.default)("shown"),"</span>","<% } %>","<% if( history.contents_active.deleted ){ %>",'<span class="deleted-count">',"<% if( view.model.contents.includeDeleted ){ %>",'<a class="toggle-deleted-link" href="javascript:void(0);">',(0,L.default)("hide deleted"),"</a>","<% } else { %>","<%- history.contents_active.deleted %> ",'<a class="toggle-deleted-link" href="javascript:void(0);">',(0,L.default)("deleted"),"</a>","<% } %>","</span>","<% } %>","<% if( history.contents_active.hidden ){ %>",'<span class="hidden-count">',"<% if( view.model.contents.includeHidden ){ %>",'<a class="toggle-hidden-link" href="javascript:void(0);">',(0,L.default)("hide hidden"),"</a>","<% } else { %>","<%- history.contents_active.hidden %> ",'<a class="toggle-hidden-link" href="javascript:void(0);">',(0,L.default)("hidden"),"</a>","<% } %>","</span>","<% } %>"],"history"),t=A.default.wrapTemplate([(0,L.default)("Found")," <%- view.views.length %>, ","<% if( history.contents_active.deleted ){ %>","<% if( view.model.contents.includeDeleted ){ %>",'<a class="toggle-deleted-link" href="javascript:void(0);">',(0,L.default)("hide deleted"),"</a>, ","<% } else { %>",'<a class="toggle-deleted-link" href="javascript:void(0);">',(0,L.default)("show deleted"),"</a>, ","<% } %>","<% } %>","<% if( history.contents_active.hidden ){ %>","<% if( view.model.contents.includeHidden ){ %>",'<a class="toggle-hidden-link" href="javascript:void(0);">',(0,L.default)("hide hidden"),"</a>","<% } else { %>",'<a class="toggle-hidden-link" href="javascript:void(0);">',(0,L.default)("show hidden"),"</a>","<% } %>","<% } %>"],"history");return i.extend(i.clone(I.prototype.templates),{counts:e,found:t})}(),t.default={HistoryViewEdit:D}}).call(t,n(0),n(1),n(0))},function(e,t,n){"use strict";(function(e,i){function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var a=n(61),o=r(a),s=n(41),l=r(s),c=n(4),d=r(c),u=n(3),h=r(u),f=o.default.DatasetListItemEdit,p=f.extend({className:f.prototype.className+" history-content",_fetchModelDetails:function(){var t=this;return t.model.inReadyState()&&!t.model.hasDetails()?t.model.fetch({silent:!0}):t.model.has("rerunnable")?e.when():t.model.fetch({silent:!0,data:{keys:["rerunnable","creating_job"].join(",")}})},events:i.extend(i.clone(f.prototype.events),{"click .unhide-link":function(e){return this.model.unhide(),!1}}),toString:function(){return"HDAListItemEdit("+(this.model?""+this.model:"(no model)")+")"}});p.prototype.templates=function(){var e=i.extend({},f.prototype.templates.warnings,{hidden:d.default.wrapTemplate(["<% if( !dataset.visible ){ %>",'<div class="hidden-msg warningmessagesmall">',(0,h.default)("This dataset has been hidden"),'<br /><a class="unhide-link" a href="javascript:void(0);">',(0,h.default)("Unhide it"),"</a>","</div>","<% } %>"],"dataset")});return i.extend({},f.prototype.templates,{titleBar:l.default.HDAListItemView.prototype.templates.titleBar,warnings:e})}(),t.default={HDAListItemEdit:p}}).call(t,n(0),n(1))},function(e,t,n){"use strict";(function(e,i,r){function a(e){return e&&e.__esModule?e:{default:e}}function o(e,t){var n=e.toJSON();return v(n,{defaultHideSourceItems:t,creationFn:function(t,n,i){return t=[{name:"forward",src:"hda",id:t[0].id},{name:"reverse",src:"hda",id:t[1].id}],e.createHDCA(t,"paired",n,i)}})}Object.defineProperty(t,"__esModule",{value:!0});var s=n(29),l=a(s),c=n(20),d=a(c),u=n(4),h=a(u),f=n(3),p=a(f),g=e.View.extend(h.default.LoggableMixin).extend({_logNamespace:"collections",tagName:"li",className:"collection-element",initialize:function(e){this.element=e.element||{},this.identifier=e.identifier},render:function(){return this.$el.attr("data-element-id",this.element.id).html(this.template({identifier:this.identifier,element:this.element})),this},template:i.template(['<span class="identifier"><%- identifier %></span>','<span class="name"><%- element.name %></span>'].join("")),destroy:function(){this.off(),this.$el.remove()},toString:function(){return"DatasetCollectionElementView()"}}),m=l.default.ListCollectionCreator,_=m.extend({elementViewClass:g,collectionClass:d.default.HistoryDatasetCollection,className:"pair-collection-creator collection-creator flex-row-container",_mangleDuplicateNames:function(){},render:function(e,t){return 2===this.workingElements.length?m.prototype.render.call(this,e,t):this._renderInvalid(e,t)},_renderList:function(e,t){var n=this,a=r("<div/>"),o=n.$list();i.each(this.elementViews,function(e){e.destroy(),n.removeElementView(e)}),a.append(n._createForwardElementView().$el),a.append(n._createReverseElementView().$el),o.empty().append(a.children()),i.invoke(n.elementViews,"render")},_createForwardElementView:function(){return this._createElementView(this.workingElements[0],{identifier:"forward"})},_createReverseElementView:function(){return this._createElementView(this.workingElements[1],{identifier:"reverse"})},_createElementView:function(e,t){var n=new this.elementViewClass(i.extend(t,{element:e}));return this.elementViews.push(n),n},swap:function(){this.workingElements=[this.workingElements[1],this.workingElements[0]],this._renderList()},events:i.extend(i.clone(m.prototype.events),{"click .swap":"swap"}),templates:i.extend(i.clone(m.prototype.templates),{middle:i.template(['<div class="collection-elements-controls">','<a class="swap" href="javascript:void(0);" title="',(0,p.default)("Swap forward and reverse datasets"),'">',(0,p.default)("Swap"),"</a>","</div>",'<div class="collection-elements scroll-container flex-row">',"</div>"].join("")),helpContent:i.template(["<p>",(0,p.default)(["Pair collections are permanent collections containing two datasets: one forward and one reverse. ","Often these are forward and reverse reads. The pair collections can be passed to tools and ","workflows in order to have analyses done on both datasets. This interface allows ","you to create a pair, name it, and swap which is forward and which reverse."].join("")),"</p>","<ul>","<li>",(0,p.default)(['Click the <i data-target=".swap">"Swap"</i> link to make your forward dataset the reverse ',"and the reverse dataset forward."].join("")),"</li>","<li>",(0,p.default)(['Click the <i data-target=".cancel-create">"Cancel"</i> button to exit the interface.'].join("")),"</li>","</ul><br />","<p>",(0,p.default)(['Once your collection is complete, enter a <i data-target=".collection-name">name</i> and ','click <i data-target=".create-collection">"Create list"</i>.'].join("")),"</p>"].join("")),invalidInitial:i.template(['<div class="header flex-row no-flex">','<div class="alert alert-warning" style="display: block">','<span class="alert-message">',"<% if( _.size( problems ) ){ %>",(0,p.default)("The following selections could not be included due to problems"),"<ul><% _.each( problems, function( problem ){ %>","<li><b><%- problem.element.name %></b>: <%- problem.text %></li>","<% }); %></ul>","<% } else if( _.size( elements ) === 0 ){ %>",(0,p.default)("No datasets were selected"),".","<% } else if( _.size( elements ) === 1 ){ %>",(0,p.default)("Only one dataset was selected"),": <%- elements[0].name %>","<% } else if( _.size( elements ) > 2 ){ %>",(0,p.default)("Too many datasets were selected"),': <%- _.pluck( elements, "name" ).join( ", ") %>',"<% } %>","<br />",(0,p.default)("Two (and only two) elements are needed for the pair"),". ",(0,p.default)("You may need to "),'<a class="cancel-create" href="javascript:void(0)">',(0,p.default)("cancel"),"</a> ",(0,p.default)("and reselect new elements"),".","</span>","</div>","</div>",'<div class="footer flex-row no-flex">','<div class="actions clear vertically-spaced">','<div class="other-options pull-left">','<button class="cancel-create btn" tabindex="-1">',(0,p.default)("Cancel"),"</button>","</div>","</div>","</div>"].join(""))}),toString:function(){return"PairCollectionCreator"}}),v=function(e,t){return t=t||{},t.title=(0,p.default)("Create a collection from a pair of datasets"),l.default.collectionCreatorModal(e,t,_)};t.default={PairCollectionCreator:_,pairCollectionCreatorModal:v,createPairCollection:o}}).call(t,n(2),n(1),n(0))},function(e,t,n){"use strict";(function(e,i,r,a){function o(e){return e&&e.__esModule?e:{default:e}}function s(e){function t(){return n.length||(n=[new RegExp(this.filters[0]),new RegExp(this.filters[1])]),n}e=e||{},e.createPair=e.createPair||function(e){e=e||{};var t=e.listA.splice(e.indexA,1)[0],n=e.listB.splice(e.indexB,1)[0],i=e.listB.indexOf(t),r=e.listA.indexOf(n);return-1!==i&&e.listB.splice(i,1),-1!==r&&e.listA.splice(r,1),this._pair(t,n,{silent:!0})};var n=[];return e.preprocessMatch=e.preprocessMatch||function(e){var n=t.call(this);return i.extend(e,{matchTo:e.matchTo.name.replace(n[0],""),possible:e.possible.name.replace(n[1],"")})},function(t){this.debug("autopair _strategy ---------------------------"),t=t||{};var n,i=t.listA,r=t.listB,a=0,o={score:0,index:null},s=[];for(this.debug("starting list lens:",i.length,r.length),this.debug("bestMatch (starting):",JSON.stringify(o,null,"  "));a<i.length;){var l=i[a];for(o.score=0,n=0;n<r.length;n++){var c=r[n];if(this.debug(a+":"+l.name),this.debug(n+":"+c.name),i[a]!==r[n]&&(o=e.match.call(this,e.preprocessMatch.call(this,{matchTo:l,possible:c,index:n,bestMatch:o})),this.debug("bestMatch:",JSON.stringify(o,null,"  ")),1===o.score)){this.debug("breaking early due to perfect match");break}}var d=e.scoreThreshold.call(this);if(this.debug("scoreThreshold:",d),this.debug("bestMatch.score:",o.score),o.score>=d?s.push(e.createPair.call(this,{listA:i,indexA:a,listB:r,indexB:o.index})):a+=1,!i.length||!r.length)return s}return this.debug("paired:",JSON.stringify(s,null,"  ")),this.debug("autopair _strategy ---------------------------"),s}}function l(e,t){var n=e.toJSON();return w(n,{historyId:e.historyId,defaultHideSourceItems:t})}Object.defineProperty(t,"__esModule",{value:!0});var c=n(99),d=o(c),u=n(53),h=o(u),f=n(52),p=o(f),g=n(4),m=o(g),_=n(3),v=o(_);n(54);var y=e.View.extend(m.default.LoggableMixin).extend({_logNamespace:"collections",tagName:"li",className:"dataset paired",initialize:function(e){this.pair=e.pair||{}},template:i.template(['<span class="forward-dataset-name flex-column"><%- pair.forward.name %></span>','<span class="pair-name-column flex-column">','<span class="pair-name"><%- pair.name %></span>',"</span>",'<span class="reverse-dataset-name flex-column"><%- pair.reverse.name %></span>'].join("")),render:function(){this.dragStartHandler=i.bind(this._dragstart,this),this.dragEndHandler=i.bind(this._dragend,this);var e=this.$el.attr("draggable",!0).data("pair",this.pair).html(this.template({pair:this.pair})).addClass("flex-column-container").get(0);return e.addEventListener("dragstart",this.dragStartHandler,!1),e.addEventListener("dragend",this.dragEndHandler,!1),this},events:{dragover:"_sendToParent",drop:"_sendToParent"},_dragstart:function(e){e.currentTarget.style.opacity="0.4",e.originalEvent&&(e=e.originalEvent),e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/plain",JSON.stringify(this.pair)),this.$el.parent().trigger("pair.dragstart",[this])},_dragend:function(e){e.currentTarget.style.opacity="1.0",this.$el.parent().trigger("pair.dragend",[this])},_sendToParent:function(e){this.$el.parent().trigger(e)},toString:function(){return"PairView("+this.pair.name+")"}}),b=e.View.extend(m.default.LoggableMixin).extend(p.default.CollectionCreatorMixin).extend({_logNamespace:"collections",className:"list-of-pairs-collection-creator collection-creator flex-row-container",initialize:function(e){this.metric("PairedCollectionCreator.initialize",e),e=i.defaults(e,{datasets:[],filters:this.DEFAULT_FILTERS,automaticallyPair:!0,strategy:"lcs",matchPercentage:.9,twoPassAutopairing:!0}),this.initialList=e.datasets,this.historyId=e.historyId,this.filters=this.commonFilters[e.filters]||this.commonFilters[this.DEFAULT_FILTERS],i.isArray(e.filters)&&(this.filters=e.filters),this.automaticallyPair=e.automaticallyPair,this.strategy=this.strategies[e.strategy]||this.strategies[this.DEFAULT_STRATEGY],i.isFunction(e.strategy)&&(this.strategy=e.strategy),this.matchPercentage=e.matchPercentage,this.twoPassAutopairing=e.twoPassAutopairing,this.removeExtensions=!0,this.oncancel=e.oncancel,this.oncreate=e.oncreate,this.autoscrollDist=e.autoscrollDist||24,this.unpairedPanelHidden=!1,this.pairedPanelHidden=!1,this.$dragging=null,this.blocking=!1,this._setUpCommonSettings(e),this._setUpBehaviors(),this._dataSetUp()},commonFilters:{illumina:["_1","_2"],Rs:["_R1","_R2"]},DEFAULT_FILTERS:"illumina",strategies:{simple:"autopairSimple",lcs:"autopairLCS",levenshtein:"autopairLevenshtein"},DEFAULT_STRATEGY:"lcs",_dataSetUp:function(){this.paired=[],this.unpaired=[],this.selectedIds=[],this._sortInitialList(),this._ensureIds(),this.unpaired=this.initialList.slice(0),this.automaticallyPair&&(this.autoPair(),this.once("rendered:initial",function(){this.trigger("autopair")}))},_sortInitialList:function(){this._sortDatasetList(this.initialList)},_sortDatasetList:function(e){return e.sort(function(e,t){return(0,h.default)(e.name,t.name)}),e},_ensureIds:function(){return this.initialList.forEach(function(e){e.hasOwnProperty("id")||(e.id=i.uniqueId())}),this.initialList},_splitByFilters:function(){function e(e,t){return t.test(e.name)}var t=this.filters.map(function(e){return new RegExp(e)}),n=[[],[]];return this.unpaired.forEach(function(i){t.forEach(function(t,r){e(i,t)&&n[r].push(i)})}),n},_addToUnpaired:function(e){var t=this;this.unpaired.splice(function n(i,r){if(i===r)return i;var a=Math.floor((r-i)/2)+i,o=(0,h.default)(e.name,t.unpaired[a].name);if(o<0)return n(i,a);if(o>0)return n(a+1,r);for(;t.unpaired[a]&&t.unpaired[a].name===e.name;)a++;return a}(0,this.unpaired.length),0,e)},autoPair:function(e){var t=this._splitByFilters(),n=[];return this.twoPassAutopairing&&(n=this.autopairSimple({listA:t[0],listB:t[1]}),t=this._splitByFilters()),e=e||this.strategy,t=this._splitByFilters(),n=n.concat(this[e].call(this,{listA:t[0],listB:t[1]}))},autopairSimple:s({scoreThreshold:function(){return.6},match:function(e){return e=e||{},e.matchTo===e.possible?{index:e.index,score:1}:e.bestMatch}}),autopairLevenshtein:s({scoreThreshold:function(){return this.matchPercentage},match:function(e){e=e||{};var t=(0,d.default)(e.matchTo,e.possible),n=1-t/Math.max(e.matchTo.length,e.possible.length);return n>e.bestMatch.score?{index:e.index,score:n}:e.bestMatch}}),autopairLCS:s({scoreThreshold:function(){return this.matchPercentage},match:function(e){e=e||{};var t=this._naiveStartingAndEndingLCS(e.matchTo,e.possible).length,n=t/Math.max(e.matchTo.length,e.possible.length);return n>e.bestMatch.score?{index:e.index,score:n}:e.bestMatch}}),_naiveStartingAndEndingLCS:function(e,t){for(var n="",i="",r=0,a=0;r<e.length&&r<t.length&&e[r]===t[r];)n+=e[r],r+=1;if(r===e.length)return e;if(r===t.length)return t;for(r=e.length-1,a=t.length-1;r>=0&&a>=0&&e[r]===t[a];)i=[e[r],i].join(""),r-=1,a-=1;return n+i},_pair:function(e,t,n){n=n||{},this.debug("_pair:",e,t);var r=this._createPair(e,t,n.name);return this.paired.push(r),this.unpaired=i.without(this.unpaired,e,t),n.silent||this.trigger("pair:new",r),r},_createPair:function(e,t,n){if(!e||!t||e===t)throw new Error("Bad pairing: "+[JSON.stringify(e),JSON.stringify(t)]);return n=n||this._guessNameForPair(e,t),{forward:e,name:n,reverse:t}},_guessNameForPair:function(e,t,n){n=void 0!==n?n:this.removeExtensions;var i=e.name,r=t.name,a=this._naiveStartingAndEndingLCS(i.replace(new RegExp(this.filters[0]),""),r.replace(new RegExp(this.filters[1]),""));if(n){var o=a.lastIndexOf(".");if(o>0){var s=a.slice(o,a.length);a=a.replace(s,""),i=i.replace(s,""),r=r.replace(s,"")}}return a||i+" & "+r},_unpair:function(e,t){if(t=t||{},!e)throw new Error("Bad pair: "+JSON.stringify(e));return this.paired=i.without(this.paired,e),this._addToUnpaired(e.forward),this._addToUnpaired(e.reverse),t.silent||this.trigger("pair:unpair",[e]),e},unpairAll:function(){for(var e=[];this.paired.length;)e.push(this._unpair(this.paired[0],{silent:!0}));this.trigger("pair:unpair",e)},_pairToJSON:function(e){return{collection_type:"paired",src:"new_collection",name:e.name,element_identifiers:[{name:"forward",id:e.forward.id,src:e.forward.src||"hda"},{name:"reverse",id:e.reverse.id,src:e.reverse.src||"hda"}]}},createList:function(e){var t=this,n=Galaxy.root+"api/histories/"+this.historyId+"/contents/dataset_collections",a={type:"dataset_collection",collection_type:"list:paired",hide_source_items:t.hideOriginals||!1,name:i.escape(e||t.$(".collection-name").val()),element_identifiers:t.paired.map(function(e){return t._pairToJSON(e)})};return t.blocking=!0,r.ajax(n,{type:"POST",contentType:"application/json",dataType:"json",data:JSON.stringify(a)}).always(function(){t.blocking=!1}).fail(function(e,n,i){t._ajaxErrHandler(e,n,i)}).done(function(e,n,i){t.trigger("collection:created",e,n,i),t.metric("collection:created",e),"function"==typeof t.oncreate&&t.oncreate.call(this,e,n,i)})},_ajaxErrHandler:function(e,t,n){this.error(e,t,n);var i=this,r=(0,v.default)("An error occurred while creating this collection");e&&(0===e.readyState&&0===e.status?r+=": "+(0,v.default)("Galaxy could not be reached and may be updating.")+(0,v.default)(" Try again in a few minutes."):e.responseJSON?r+="<br /><pre>"+JSON.stringify(e.responseJSON)+"</pre>":r+=": "+n),i._showAlert(r,"alert-danger")},render:function(e,t){return this.$el.empty().html(this.templates.main()),this._renderHeader(e),this._renderMiddle(e),this._renderFooter(e),this._addPluginComponents(),this.trigger("rendered",this),this},_renderHeader:function(e,t){var n=this.$(".header").empty().html(this.templates.header()).find(".help-content").prepend(a(this.templates.helpContent()));return this._renderFilters(),n},_renderFilters:function(){return this.$(".forward-column .column-header input").val(this.filters[0]).add(this.$(".reverse-column .column-header input").val(this.filters[1]))},_renderMiddle:function(e,t){var n=this.$(".middle").empty().html(this.templates.middle());return this.unpairedPanelHidden?this.$(".unpaired-columns").hide():this.pairedPanelHidden&&this.$(".paired-columns").hide(),this._renderUnpaired(),this._renderPaired(),n},_renderUnpaired:function(e,t){var n,i,r=this,a=[],o=this._splitByFilters();return this.$(".forward-column .title").text([o[0].length,(0,v.default)("unpaired forward")].join(" ")),this.$(".forward-column .unpaired-info").text(this._renderUnpairedDisplayStr(this.unpaired.length-o[0].length)),this.$(".reverse-column .title").text([o[1].length,(0,v.default)("unpaired reverse")].join(" ")),this.$(".reverse-column .unpaired-info").text(this._renderUnpairedDisplayStr(this.unpaired.length-o[1].length)),this.$(".unpaired-columns .column-datasets").empty(),this.$(".autopair-link").toggle(0!==this.unpaired.length),0===this.unpaired.length?void this._renderUnpairedEmpty():(i=o[1].map(function(e,t){return void 0!==o[0][t]&&o[0][t]!==e&&a.push(r._renderPairButton()),r._renderUnpairedDataset(e)}),n=o[0].map(function(e){return r._renderUnpairedDataset(e)}),n.length||i.length?(this.$(".unpaired-columns .forward-column .column-datasets").append(n).add(this.$(".unpaired-columns .paired-column .column-datasets").append(a)).add(this.$(".unpaired-columns .reverse-column .column-datasets").append(i)),void this._adjUnpairedOnScrollbar()):void this._renderUnpairedNotShown())},_renderUnpairedDisplayStr:function(e){return["(",e," ",(0,v.default)("filtered out"),")"].join("")},_renderUnpairedDataset:function(e){return a("<li/>").attr("id","dataset-"+e.id).addClass("dataset unpaired").attr("draggable",!0).addClass(e.selected?"selected":"").append(a("<span/>").addClass("dataset-name").text(e.name)).data("dataset",e)},_renderPairButton:function(){return a("<li/>").addClass("dataset unpaired").append(a("<span/>").addClass("dataset-name").text((0,v.default)("Pair these datasets")))},_renderUnpairedEmpty:function(){var e=a('<div class="empty-message"></div>').text("("+(0,v.default)("no remaining unpaired datasets")+")");return this.$(".unpaired-columns .paired-column .column-datasets").empty().prepend(e),e},_renderUnpairedNotShown:function(){var e=a('<div class="empty-message"></div>').text("("+(0,v.default)("no datasets were found matching the current filters")+")");return this.$(".unpaired-columns .paired-column .column-datasets").empty().prepend(e),e},_adjUnpairedOnScrollbar:function(){var e=this.$(".unpaired-columns").last(),t=this.$(".unpaired-columns .reverse-column .dataset").first();if(t.length){var n=e.offset().left+e.outerWidth(),i=t.offset().left+t.outerWidth(),r=Math.floor(n)-Math.floor(i);this.$(".unpaired-columns .forward-column").css("margin-left",r>0?r:0)}},_renderPaired:function(e,t){if(this.$(".paired-column-title .title").text([this.paired.length,(0,v.default)("paired")].join(" ")),this.$(".unpair-all-link").toggle(0!==this.paired.length),0===this.paired.length)return void this._renderPairedEmpty();this.$(".remove-extensions-link").show(),this.$(".paired-columns .column-datasets").empty();var n=this;this.paired.forEach(function(e,t){var i=new y({pair:e});n.$(".paired-columns .column-datasets").append(i.render().$el).append(['<button class="unpair-btn">','<span class="fa fa-unlink" title="',(0,v.default)("Unpair"),'"></span>',"</button>"].join(""))})},_renderPairedEmpty:function(){var e=a('<div class="empty-message"></div>').text("("+(0,v.default)("no paired datasets yet")+")");return this.$(".paired-columns .column-datasets").empty().prepend(e),e},footerSettings:{".hide-originals":"hideOriginals",".remove-extensions":"removeExtensions"},_addPluginComponents:function(){this._chooseFiltersPopover(".choose-filters-link"),this.$(".help-content i").hoverhighlight(".collection-creator","rgba( 64, 255, 255, 1.0 )")},_chooseFiltersPopover:function(e){function t(e,t){return['<button class="filter-choice btn" ','data-forward="',e,'" data-reverse="',t,'">',(0,v.default)("Forward"),": ",e,", ",(0,v.default)("Reverse"),": ",t,"</button>"].join("")}var n=a(i.template(['<div class="choose-filters">','<div class="help">',(0,v.default)("Choose from the following filters to change which unpaired reads are shown in the display"),":</div>",i.values(this.commonFilters).map(function(e){return t(e[0],e[1])}).join(""),"</div>"].join(""))({}));return this.$(e).popover({container:".collection-creator",placement:"bottom",html:!0,content:n})},_validationWarning:function(e,t){"name"===e&&(e=this.$(".collection-name").add(this.$(".collection-name-prompt")),this.$(".collection-name").focus().select()),t?(e=e||this.$(".validation-warning"),e.removeClass("validation-warning")):e.addClass("validation-warning")},_setUpBehaviors:function(){return this.once("rendered",function(){this.trigger("rendered:initial",this)}),this.on("pair:new",function(){this._renderUnpaired(),this._renderPaired(),this.$(".paired-columns").scrollTop(8e6)}),this.on("pair:unpair",function(e){this._renderUnpaired(),this._renderPaired(),this.splitView()}),this.on("filter-change",function(){this.filters=[this.$(".forward-unpaired-filter input").val(),this.$(".reverse-unpaired-filter input").val()],this.metric("filter-change",this.filters),this._renderFilters(),this._renderUnpaired()}),this.on("autopair",function(){this._renderUnpaired(),this._renderPaired();var e,t=null;this.paired.length?(t="alert-success",e=this.paired.length+" "+(0,v.default)("pairs created"),this.unpaired.length||(e+=": "+(0,v.default)("all datasets have been successfully paired"),this.hideUnpaired(),this.$(".collection-name").focus())):e=(0,v.default)(["Could not automatically create any pairs from the given dataset names.","You may want to choose or enter different filters and try auto-pairing again.","Close this message using the X on the right to view more help."].join(" ")),this._showAlert(e,t)}),this},events:{"click .more-help":"_clickMoreHelp","click .less-help":"_clickLessHelp","click .main-help":"_toggleHelp","click .header .alert button":"_hideAlert","click .forward-column .column-title":"_clickShowOnlyUnpaired","click .reverse-column .column-title":"_clickShowOnlyUnpaired","click .unpair-all-link":"_clickUnpairAll","change .forward-unpaired-filter input":function(e){this.trigger("filter-change")},"focus .forward-unpaired-filter input":function(e){a(e.currentTarget).select()},"click .autopair-link":"_clickAutopair","click .choose-filters .filter-choice":"_clickFilterChoice","click .clear-filters-link":"_clearFilters","change .reverse-unpaired-filter input":function(e){this.trigger("filter-change")},"focus .reverse-unpaired-filter input":function(e){a(e.currentTarget).select()},"click .forward-column .dataset.unpaired":"_clickUnpairedDataset","click .reverse-column .dataset.unpaired":"_clickUnpairedDataset","click .paired-column .dataset.unpaired":"_clickPairRow","click .unpaired-columns":"clearSelectedUnpaired","mousedown .unpaired-columns .dataset":"_mousedownUnpaired","click .paired-column-title":"_clickShowOnlyPaired","mousedown .flexible-partition-drag":"_startPartitionDrag","click .paired-columns .dataset.paired":"selectPair","click .paired-columns":"clearSelectedPaired","click .paired-columns .pair-name":"_clickPairName","click .unpair-btn":"_clickUnpair","dragover .paired-columns .column-datasets":"_dragoverPairedColumns","drop .paired-columns .column-datasets":"_dropPairedColumns","pair.dragstart .paired-columns .column-datasets":"_pairDragstart","pair.dragend   .paired-columns .column-datasets":"_pairDragend","change .remove-extensions":function(e){this.toggleExtensions()},"change .collection-name":"_changeName","keydown .collection-name":"_nameCheckForEnter","change .hide-originals":"_changeHideOriginals","click .cancel-create":"_cancelCreate","click .create-collection":"_clickCreate"},_clickShowOnlyUnpaired:function(e){this.$(".paired-columns").is(":visible")?this.hidePaired():this.splitView()},_clickShowOnlyPaired:function(e){this.$(".unpaired-columns").is(":visible")?this.hideUnpaired():this.splitView()},hideUnpaired:function(e,t){this.unpairedPanelHidden=!0,this.pairedPanelHidden=!1,this._renderMiddle(e,t)},hidePaired:function(e,t){this.unpairedPanelHidden=!1,this.pairedPanelHidden=!0,this._renderMiddle(e,t)},splitView:function(e,t){return this.unpairedPanelHidden=this.pairedPanelHidden=!1,this._renderMiddle(e,t),this},_clickUnpairAll:function(e){this.metric("unpairAll"),this.unpairAll()},_clickAutopair:function(e){var t=this.autoPair();this.metric("autopair",t.length,this.unpaired.length),this.trigger("autopair")},_clickFilterChoice:function(e){var t=a(e.currentTarget);this.$(".forward-unpaired-filter input").val(t.data("forward")),this.$(".reverse-unpaired-filter input").val(t.data("reverse")),this._hideChooseFilters(),this.trigger("filter-change")},_hideChooseFilters:function(){this.$(".choose-filters-link").popover("hide"),this.$(".popover").css("display","none")},_clearFilters:function(e){this.$(".forward-unpaired-filter input").val(""),this.$(".reverse-unpaired-filter input").val(""),this.trigger("filter-change")},_clickUnpairedDataset:function(e){return e.stopPropagation(),this.toggleSelectUnpaired(a(e.currentTarget))},toggleSelectUnpaired:function(e,t){t=t||{};var n=e.data("dataset"),i=void 0!==t.force?t.force:!e.hasClass("selected");return e.length&&void 0!==n?(i?(e.addClass("selected"),t.waitToPair||this.pairAllSelected()):e.removeClass("selected"),e):e},pairAllSelected:function(e){e=e||{};var t=this,n=[],i=[],r=[];return t.$(".unpaired-columns .forward-column .dataset.selected").each(function(){n.push(a(this).data("dataset"))}),t.$(".unpaired-columns .reverse-column .dataset.selected").each(function(){i.push(a(this).data("dataset"))}),n.length=i.length=Math.min(n.length,i.length),n.forEach(function(e,n){try{r.push(t._pair(e,i[n],{silent:!0}))}catch(e){t.error(e)}}),r.length&&!e.silent&&this.trigger("pair:new",r),r},clearSelectedUnpaired:function(){this.$(".unpaired-columns .dataset.selected").removeClass("selected")},_mousedownUnpaired:function(e){if(e.shiftKey){var t=this,n=a(e.target).addClass("selected"),i=function(e){t.$(e.target).filter(".dataset").addClass("selected")};n.parent().on("mousemove",i),a(document).one("mouseup",function(e){n.parent().off("mousemove",i),t.pairAllSelected()})}},_clickPairRow:function(e){var t=a(e.currentTarget).index(),n=a(".unpaired-columns .forward-column .dataset").eq(t).data("dataset"),i=a(".unpaired-columns .reverse-column .dataset").eq(t).data("dataset");this._pair(n,i)},_startPartitionDrag:function(e){function t(e){i.$(".flexible-partition-drag").css("color",""),a("body").css("cursor","").unbind("mousemove",n)}function n(e){var t=e.pageY-r;i.adjPartition(t)||a("body").trigger("mouseup"),i._adjUnpairedOnScrollbar(),r+=t}var i=this,r=e.pageY;a("body").css("cursor","ns-resize"),i.$(".flexible-partition-drag").css("color","black"),a("body").mousemove(n),a("body").one("mouseup",t)},adjPartition:function(e){var t=this.$(".unpaired-columns"),n=this.$(".paired-columns"),i=parseInt(t.css("height"),10),r=parseInt(n.css("height"),10);i=Math.max(10,i+e),r-=e;var a=e<0;if(a){if(this.unpairedPanelHidden)return!1;if(i<=10)return this.hideUnpaired(),!1}else this.unpairedPanelHidden&&(t.show(),this.unpairedPanelHidden=!1);if(a)this.pairedPanelHidden&&(n.show(),this.pairedPanelHidden=!1);else{if(this.pairedPanelHidden)return!1;if(r<=15)return this.hidePaired(),!1}return t.css({height:i+"px",flex:"0 0 auto"}),!0},selectPair:function(e){e.stopPropagation(),a(e.currentTarget).toggleClass("selected")},clearSelectedPaired:function(e){this.$(".paired-columns .dataset.selected").removeClass("selected")},_clickPairName:function(e){e.stopPropagation();var t=a(e.currentTarget),n=t.parent().parent(),i=n.index(".dataset.paired"),r=this.paired[i],o=prompt("Enter a new name for the pair:",r.name);o&&(r.name=o,r.customizedName=!0,t.text(r.name))},_clickUnpair:function(e){var t=Math.floor(a(e.currentTarget).index(".unpair-btn"));this._unpair(this.paired[t])},_dragoverPairedColumns:function(e){e.preventDefault();var t=this.$(".paired-columns .column-datasets");this._checkForAutoscroll(t,e.originalEvent.clientY);var n=this._getNearestPairedDatasetLi(e.originalEvent.clientY);a(".element-drop-placeholder").remove();var i=a('<div class="element-drop-placeholder"></div>');n.length?n.before(i):t.append(i)},_checkForAutoscroll:function(e,t){var n=e.offset(),i=e.scrollTop(),r=t-n.top,a=n.top+e.outerHeight()-t;r>=0&&r<this.autoscrollDist?e.scrollTop(i-2):a>=0&&a<this.autoscrollDist&&e.scrollTop(i+2)},_getNearestPairedDatasetLi:function(e){for(var t=this.$(".paired-columns .column-datasets li").toArray(),n=0;n<t.length;n++){var i=a(t[n]),r=i.offset().top,o=Math.floor(i.outerHeight()/2)+4;if(r+o>e&&r-o<e)return i}return a()},_dropPairedColumns:function(e){e.preventDefault(),e.dataTransfer.dropEffect="move";var t=this._getNearestPairedDatasetLi(e.originalEvent.clientY);return t.length?this.$dragging.insertBefore(t):this.$dragging.insertAfter(this.$(".paired-columns .unpair-btn").last()),this._syncPairsToDom(),!1},_syncPairsToDom:function(){var e=[];this.$(".paired-columns .dataset.paired").each(function(){e.push(a(this).data("pair"))}),this.paired=e,this._renderPaired()},_pairDragstart:function(e,t){t.$el.addClass("selected");var n=this.$(".paired-columns .dataset.selected");this.$dragging=n},_pairDragend:function(e,t){a(".element-drop-placeholder").remove(),this.$dragging=null},toggleExtensions:function(e){var t=this;t.removeExtensions=void 0!==e?e:!t.removeExtensions,i.each(t.paired,function(e){e.customizedName||(e.name=t._guessNameForPair(e.forward,e.reverse))}),t._renderPaired(),t._renderFooter()},_printList:function(e){var t=this;i.each(e,function(n){e===t.paired?t._printPair(n):t.debug(n)})},_printPair:function(e){this.debug(e.forward.name,e.reverse.name,": ->",e.name)},toString:function(){return"PairedCollectionCreator"},templates:i.extend({},p.default.CollectionCreatorMixin._creatorTemplates,{header:i.template(['<div class="main-help well clear">','<a class="more-help" href="javascript:void(0);">',(0,v.default)("More help"),"</a>",'<div class="help-content">','<a class="less-help" href="javascript:void(0);">',(0,v.default)("Less"),"</a>","</div>","</div>",'<div class="alert alert-dismissable">','<button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>','<span class="alert-message"></span>',"</div>",'<div class="column-headers vertically-spaced flex-column-container">','<div class="forward-column flex-column column">','<div class="column-header">','<div class="column-title">','<span class="title">',(0,v.default)("Unpaired forward"),"</span>",'<span class="title-info unpaired-info"></span>',"</div>",'<div class="unpaired-filter forward-unpaired-filter pull-left">','<input class="search-query" placeholder="',(0,v.default)("Filter this list"),'" />',"</div>","</div>","</div>",'<div class="paired-column flex-column no-flex column">','<div class="column-header">','<a class="choose-filters-link" href="javascript:void(0)">',(0,v.default)("Choose filters"),"</a>",'<a class="clear-filters-link" href="javascript:void(0);">',(0,v.default)("Clear filters"),"</a><br />",'<a class="autopair-link" href="javascript:void(0);">',(0,v.default)("Auto-pair"),"</a>","</div>","</div>",'<div class="reverse-column flex-column column">','<div class="column-header">','<div class="column-title">','<span class="title">',(0,v.default)("Unpaired reverse"),"</span>",'<span class="title-info unpaired-info"></span>',"</div>",'<div class="unpaired-filter reverse-unpaired-filter pull-left">','<input class="search-query" placeholder="',(0,v.default)("Filter this list"),'" />',"</div>","</div>","</div>","</div>"].join("")),middle:i.template(['<div class="unpaired-columns flex-column-container scroll-container flex-row">','<div class="forward-column flex-column column">','<ol class="column-datasets"></ol>',"</div>",'<div class="paired-column flex-column no-flex column">','<ol class="column-datasets"></ol>',"</div>",'<div class="reverse-column flex-column column">','<ol class="column-datasets"></ol>',"</div>","</div>",'<div class="flexible-partition">','<div class="flexible-partition-drag" title="',(0,v.default)("Drag to change"),'"></div>','<div class="column-header">','<div class="column-title paired-column-title">','<span class="title"></span>',"</div>",'<a class="unpair-all-link" href="javascript:void(0);">',(0,v.default)("Unpair all"),"</a>","</div>","</div>",'<div class="paired-columns flex-column-container scroll-container flex-row">','<ol class="column-datasets"></ol>',"</div>"].join("")),footer:i.template(['<div class="attributes clear">','<div class="clear">','<label class="setting-prompt pull-right">',(0,v.default)("Hide original elements"),"?",'<input class="hide-originals pull-right" type="checkbox" />',"</label>",'<label class="setting-prompt pull-right">',(0,v.default)("Remove file extensions from pair names"),"?",'<input class="remove-extensions pull-right" type="checkbox" />',"</label>","</div>",'<div class="clear">','<input class="collection-name form-control pull-right" ','placeholder="',(0,v.default)("Enter a name for your new list"),'" />','<div class="collection-name-prompt pull-right">',(0,v.default)("Name"),":</div>","</div>","</div>",'<div class="actions clear vertically-spaced">','<div class="other-options pull-left">','<button class="cancel-create btn" tabindex="-1">',(0,v.default)("Cancel"),"</button>",'<div class="create-other btn-group dropup">','<button class="btn btn-default dropdown-toggle" data-toggle="dropdown">',(0,v.default)("Create a different kind of collection"),' <span class="caret"></span>',"</button>",'<ul class="dropdown-menu" role="menu">','<li><a href="#">',(0,v.default)("Create a <i>single</i> pair"),"</a></li>",'<li><a href="#">',(0,v.default)("Create a list of <i>unpaired</i> datasets"),"</a></li>","</ul>","</div>","</div>",'<div class="main-options pull-right">','<button class="create-collection btn btn-primary">',(0,v.default)("Create list"),"</button>","</div>","</div>"].join("")),helpContent:i.template(["<p>",(0,v.default)(["Collections of paired datasets are ordered lists of dataset pairs (often forward and reverse reads). ","These collections can be passed to tools and workflows in order to have analyses done on each member of ","the entire group. This interface allows you to create a collection, choose which datasets are paired, ","and re-order the final collection."].join("")),"</p>","<p>",(0,v.default)(['Unpaired datasets are shown in the <i data-target=".unpaired-columns">unpaired section</i> ',"(hover over the underlined words to highlight below). ",'Paired datasets are shown in the <i data-target=".paired-columns">paired section</i>.',"<ul>To pair datasets, you can:","<li>Click a dataset in the ",'<i data-target=".unpaired-columns .forward-column .column-datasets,','.unpaired-columns .forward-column">forward column</i> ',"to select it then click a dataset in the ",'<i data-target=".unpaired-columns .reverse-column .column-datasets,','.unpaired-columns .reverse-column">reverse column</i>.',"</li>",'<li>Click one of the "Pair these datasets" buttons in the ','<i data-target=".unpaired-columns .paired-column .column-datasets,','.unpaired-columns .paired-column">middle column</i> ',"to pair the datasets in a particular row.","</li>",'<li>Click <i data-target=".autopair-link">"Auto-pair"</i> ',"to have your datasets automatically paired based on name.","</li>","</ul>"].join("")),"</p>","<p>",(0,v.default)(["<ul>You can filter what is shown in the unpaired sections by:","<li>Entering partial dataset names in either the ",'<i data-target=".forward-unpaired-filter input">forward filter</i> or ','<i data-target=".reverse-unpaired-filter input">reverse filter</i>.',"</li>","<li>Choosing from a list of preset filters by clicking the ",'<i data-target=".choose-filters-link">"Choose filters" link</i>.',"</li>","<li>Entering regular expressions to match dataset names. See: ",'<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Regular_Expressions"',' target="_blank">MDN\'s JavaScript Regular Expression Tutorial</a>. ',"Note: forward slashes (\\) are not needed.","</li>","<li>Clearing the filters by clicking the ",'<i data-target=".clear-filters-link">"Clear filters" link</i>.',"</li>","</ul>"].join("")),"</p>","<p>",(0,v.default)(["To unpair individual dataset pairs, click the ",'<i data-target=".unpair-btn">unpair buttons ( <span class="fa fa-unlink"></span> )</i>. ','Click the <i data-target=".unpair-all-link">"Unpair all" link</i> to unpair all pairs.'].join("")),"</p>","<p>",(0,v.default)(['You can include or remove the file extensions (e.g. ".fastq") from your pair names by toggling the ','<i data-target=".remove-extensions-prompt">"Remove file extensions from pair names?"</i> control.'].join("")),"</p>","<p>",(0,v.default)(['Once your collection is complete, enter a <i data-target=".collection-name">name</i> and ','click <i data-target=".create-collection">"Create list"</i>. ',"(Note: you do not have to pair all unpaired datasets to finish.)"].join("")),"</p>"].join(""))})}),w=function(e,t){var n,a=r.Deferred();if(t=i.defaults(t||{},{datasets:e,oncancel:function(){Galaxy.modal.hide(),a.reject("cancelled")},oncreate:function(e,t){Galaxy.modal.hide(),a.resolve(t)},title:(0,v.default)("Create a collection of paired datasets")}),!window.Galaxy||!Galaxy.modal)throw new Error("Galaxy or Galaxy.modal not found");return n=new b(t),Galaxy.modal.show({title:t.title,body:n.$el,width:"80%",height:"800px",closing_events:!0}),n.render(),window.creator=n,a};t.default={PairedCollectionCreator:b,pairedCollectionCreatorModal:w,createListOfPairsCollection:l}}).call(t,n(2),n(1),n(0),n(0))},function(e,t,n){var i,r;!function(){function a(e){return e&&(e.ownerDocument||e.document||e).documentElement}function o(e){return e&&(e.ownerDocument&&e.ownerDocument.defaultView||e.document&&e||e.defaultView)}function s(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function l(e){return null===e?NaN:+e}function c(e){return!isNaN(e)}function d(e){return{left:function(t,n,i,r){for(arguments.length<3&&(i=0),arguments.length<4&&(r=t.length);i<r;){var a=i+r>>>1;e(t[a],n)<0?i=a+1:r=a}return i},right:function(t,n,i,r){for(arguments.length<3&&(i=0),arguments.length<4&&(r=t.length);i<r;){var a=i+r>>>1;e(t[a],n)>0?r=a:i=a+1}return i}}}function u(e){return e.length}function h(e){for(var t=1;e*t%1;)t*=10;return t}function f(e,t){for(var n in t)Object.defineProperty(e.prototype,n,{value:t[n],enumerable:!1})}function p(){this._=Object.create(null)}function g(e){return(e+="")===Mo||e[0]===Co?Co+e:e}function m(e){return(e+="")[0]===Co?e.slice(1):e}function _(e){return g(e)in this._}function v(e){return(e=g(e))in this._&&delete this._[e]}function y(){var e=[];for(var t in this._)e.push(m(t));return e}function b(){var e=0;for(var t in this._)++e;return e}function w(){for(var e in this._)return!1;return!0}function x(){this._=Object.create(null)}function k(e){return e}function M(e,t,n){return function(){var i=n.apply(t,arguments);return i===t?e:i}}function C(e,t){if(t in e)return t;t=t.charAt(0).toUpperCase()+t.slice(1);for(var n=0,i=So.length;n<i;++n){var r=So[n]+t;if(r in e)return r}}function S(){}function T(){}function E(e){function t(){for(var t,i=n,r=-1,a=i.length;++r<a;)(t=i[r].on)&&t.apply(this,arguments);return e}var n=[],i=new p;return t.on=function(t,r){var a,o=i.get(t);return arguments.length<2?o&&o.on:(o&&(o.on=null,n=n.slice(0,a=n.indexOf(o)).concat(n.slice(a+1)),i.remove(t)),r&&n.push(i.set(t,{on:r})),e)},t}function j(){fo.event.preventDefault()}function A(){for(var e,t=fo.event;e=t.sourceEvent;)t=e;return t}function N(e){for(var t=new T,n=0,i=arguments.length;++n<i;)t[arguments[n]]=E(t);return t.of=function(n,i){return function(r){try{var a=r.sourceEvent=fo.event;r.target=e,fo.event=r,t[r.type].apply(n,i)}finally{fo.event=a}}},t}function L(e){return Eo(e,Lo),e}function I(e){return"function"==typeof e?e:function(){return jo(e,this)}}function D(e){return"function"==typeof e?e:function(){return Ao(e,this)}}function O(e,t){function n(){this.removeAttribute(e)}function i(){this.removeAttributeNS(e.space,e.local)}function r(){this.setAttribute(e,t)}function a(){this.setAttributeNS(e.space,e.local,t)}function o(){var n=t.apply(this,arguments);null==n?this.removeAttribute(e):this.setAttribute(e,n)}function s(){var n=t.apply(this,arguments);null==n?this.removeAttributeNS(e.space,e.local):this.setAttributeNS(e.space,e.local,n)}return e=fo.ns.qualify(e),null==t?e.local?i:n:"function"==typeof t?e.local?s:o:e.local?a:r}function P(e){return e.trim().replace(/\s+/g," ")}function W(e){return new RegExp("(?:^|\\s+)"+fo.requote(e)+"(?:\\s+|$)","g")}function R(e){return(e+"").trim().split(/^|\s+/)}function $(e,t){function n(){for(var n=-1;++n<r;)e[n](this,t)}function i(){for(var n=-1,i=t.apply(this,arguments);++n<r;)e[n](this,i)}e=R(e).map(z);var r=e.length;return"function"==typeof t?i:n}function z(e){var t=W(e);return function(n,i){if(r=n.classList)return i?r.add(e):r.remove(e);var r=n.getAttribute("class")||"";i?(t.lastIndex=0,t.test(r)||n.setAttribute("class",P(r+" "+e))):n.setAttribute("class",P(r.replace(t," ")))}}function H(e,t,n){function i(){this.style.removeProperty(e)}function r(){this.style.setProperty(e,t,n)}function a(){var i=t.apply(this,arguments);null==i?this.style.removeProperty(e):this.style.setProperty(e,i,n)}return null==t?i:"function"==typeof t?a:r}function V(e,t){function n(){delete this[e]}function i(){this[e]=t}function r(){var n=t.apply(this,arguments);null==n?delete this[e]:this[e]=n}return null==t?n:"function"==typeof t?r:i}function Y(e){function t(){var t=this.ownerDocument,n=this.namespaceURI;return n===Io&&t.documentElement.namespaceURI===Io?t.createElement(e):t.createElementNS(n,e)}function n(){return this.ownerDocument.createElementNS(e.space,e.local)}return"function"==typeof e?e:(e=fo.ns.qualify(e)).local?n:t}function F(){var e=this.parentNode;e&&e.removeChild(this)}function G(e){return{__data__:e}}function U(e){return function(){return No(this,e)}}function q(e){return arguments.length||(e=s),function(t,n){return t&&n?e(t.__data__,n.__data__):!t-!n}}function B(e,t){for(var n=0,i=e.length;n<i;n++)for(var r,a=e[n],o=0,s=a.length;o<s;o++)(r=a[o])&&t(r,o,n);return e}function J(e){return Eo(e,Oo),e}function Q(e){var t,n;return function(i,r,a){var o,s=e[a].update,l=s.length;for(a!=n&&(n=a,t=0),r>=t&&(t=r+1);!(o=s[t])&&++t<l;);return o}}function X(e,t,n){function i(){var t=this[o];t&&(this.removeEventListener(e,t,t.$),delete this[o])}function r(){var r=l(t,go(arguments));i.call(this),this.addEventListener(e,this[o]=r,r.$=n),r._=t}function a(){var t,n=new RegExp("^__on([^.]+)"+fo.requote(e)+"$");for(var i in this)if(t=i.match(n)){var r=this[i];this.removeEventListener(t[1],r,r.$),delete this[i]}}var o="__on"+e,s=e.indexOf("."),l=K;s>0&&(e=e.slice(0,s));var c=Po.get(e);return c&&(e=c,l=Z),s?t?r:i:t?S:a}function K(e,t){return function(n){var i=fo.event;fo.event=n,t[0]=this.__data__;try{e.apply(this,t)}finally{fo.event=i}}}function Z(e,t){var n=K(e,t);return function(e){var t=this,i=e.relatedTarget;i&&(i===t||8&i.compareDocumentPosition(t))||n.call(t,e)}}function ee(e){var t=".dragsuppress-"+ ++Ro,n="click"+t,i=fo.select(o(e)).on("touchmove"+t,j).on("dragstart"+t,j).on("selectstart"+t,j);if(null==Wo&&(Wo=!("onselectstart"in e)&&C(e.style,"userSelect")),Wo){var r=a(e).style,s=r[Wo];r[Wo]="none"}return function(e){if(i.on(t,null),Wo&&(r[Wo]=s),e){var a=function(){i.on(n,null)};i.on(n,function(){j(),a()},!0),setTimeout(a,0)}}}function te(e,t){t.changedTouches&&(t=t.changedTouches[0]);var n=e.ownerSVGElement||e;if(n.createSVGPoint){var i=n.createSVGPoint();if($o<0){var r=o(e);if(r.scrollX||r.scrollY){n=fo.select("body").append("svg").style({position:"absolute",top:0,left:0,margin:0,padding:0,border:"none"},"important");var a=n[0][0].getScreenCTM();$o=!(a.f||a.e),n.remove()}}return $o?(i.x=t.pageX,i.y=t.pageY):(i.x=t.clientX,i.y=t.clientY),i=i.matrixTransform(e.getScreenCTM().inverse()),[i.x,i.y]}var s=e.getBoundingClientRect();return[t.clientX-s.left-e.clientLeft,t.clientY-s.top-e.clientTop]}function ne(){return fo.event.changedTouches[0].identifier}function ie(e){return e>0?1:e<0?-1:0}function re(e,t,n){return(t[0]-e[0])*(n[1]-e[1])-(t[1]-e[1])*(n[0]-e[0])}function ae(e){return e>1?0:e<-1?Vo:Math.acos(e)}function oe(e){return e>1?Go:e<-1?-Go:Math.asin(e)}function se(e){return((e=Math.exp(e))-1/e)/2}function le(e){return((e=Math.exp(e))+1/e)/2}function ce(e){return((e=Math.exp(2*e))-1)/(e+1)}function de(e){return(e=Math.sin(e/2))*e}function ue(){}function he(e,t,n){return this instanceof he?(this.h=+e,this.s=+t,void(this.l=+n)):arguments.length<2?e instanceof he?new he(e.h,e.s,e.l):Se(""+e,Te,he):new he(e,t,n)}function fe(e,t,n){function i(e){return e>360?e-=360:e<0&&(e+=360),e<60?a+(o-a)*e/60:e<180?o:e<240?a+(o-a)*(240-e)/60:a}function r(e){return Math.round(255*i(e))}var a,o;return e=isNaN(e)?0:(e%=360)<0?e+360:e,t=isNaN(t)?0:t<0?0:t>1?1:t,n=n<0?0:n>1?1:n,o=n<=.5?n*(1+t):n+t-n*t,a=2*n-o,new xe(r(e+120),r(e),r(e-120))}function pe(e,t,n){return this instanceof pe?(this.h=+e,this.c=+t,void(this.l=+n)):arguments.length<2?e instanceof pe?new pe(e.h,e.c,e.l):e instanceof me?ve(e.l,e.a,e.b):ve((e=Ee((e=fo.rgb(e)).r,e.g,e.b)).l,e.a,e.b):new pe(e,t,n)}function ge(e,t,n){return isNaN(e)&&(e=0),isNaN(t)&&(t=0),new me(n,Math.cos(e*=Uo)*t,Math.sin(e)*t)}function me(e,t,n){return this instanceof me?(this.l=+e,this.a=+t,void(this.b=+n)):arguments.length<2?e instanceof me?new me(e.l,e.a,e.b):e instanceof pe?ge(e.h,e.c,e.l):Ee((e=xe(e)).r,e.g,e.b):new me(e,t,n)}function _e(e,t,n){var i=(e+16)/116,r=i+t/500,a=i-n/200;return r=ye(r)*ts,i=ye(i)*ns,a=ye(a)*is,new xe(we(3.2404542*r-1.5371385*i-.4985314*a),we(-.969266*r+1.8760108*i+.041556*a),we(.0556434*r-.2040259*i+1.0572252*a))}function ve(e,t,n){return e>0?new pe(Math.atan2(n,t)*qo,Math.sqrt(t*t+n*n),e):new pe(NaN,NaN,e)}function ye(e){return e>.206893034?e*e*e:(e-4/29)/7.787037}function be(e){return e>.008856?Math.pow(e,1/3):7.787037*e+4/29}function we(e){return Math.round(255*(e<=.00304?12.92*e:1.055*Math.pow(e,1/2.4)-.055))}function xe(e,t,n){return this instanceof xe?(this.r=~~e,this.g=~~t,void(this.b=~~n)):arguments.length<2?e instanceof xe?new xe(e.r,e.g,e.b):Se(""+e,xe,fe):new xe(e,t,n)}function ke(e){return new xe(e>>16,e>>8&255,255&e)}function Me(e){return ke(e)+""}function Ce(e){return e<16?"0"+Math.max(0,e).toString(16):Math.min(255,e).toString(16)}function Se(e,t,n){var i,r,a,o=0,s=0,l=0;if(i=/([a-z]+)\((.*)\)/.exec(e=e.toLowerCase()))switch(r=i[2].split(","),i[1]){case"hsl":return n(parseFloat(r[0]),parseFloat(r[1])/100,parseFloat(r[2])/100);case"rgb":return t(Ae(r[0]),Ae(r[1]),Ae(r[2]))}return(a=os.get(e))?t(a.r,a.g,a.b):(null==e||"#"!==e.charAt(0)||isNaN(a=parseInt(e.slice(1),16))||(4===e.length?(o=(3840&a)>>4,o|=o>>4,s=240&a,s|=s>>4,l=15&a,l|=l<<4):7===e.length&&(o=(16711680&a)>>16,s=(65280&a)>>8,l=255&a)),t(o,s,l))}function Te(e,t,n){var i,r,a=Math.min(e/=255,t/=255,n/=255),o=Math.max(e,t,n),s=o-a,l=(o+a)/2;return s?(r=l<.5?s/(o+a):s/(2-o-a),i=e==o?(t-n)/s+(t<n?6:0):t==o?(n-e)/s+2:(e-t)/s+4,i*=60):(i=NaN,r=l>0&&l<1?0:i),new he(i,r,l)}function Ee(e,t,n){e=je(e),t=je(t),n=je(n);var i=be((.4124564*e+.3575761*t+.1804375*n)/ts),r=be((.2126729*e+.7151522*t+.072175*n)/ns);return me(116*r-16,500*(i-r),200*(r-be((.0193339*e+.119192*t+.9503041*n)/is)))}function je(e){return(e/=255)<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function Ae(e){var t=parseFloat(e);return"%"===e.charAt(e.length-1)?Math.round(2.55*t):t}function Ne(e){return"function"==typeof e?e:function(){return e}}function Le(e){return function(t,n,i){return 2===arguments.length&&"function"==typeof n&&(i=n,n=null),Ie(t,n,e,i)}}function Ie(e,t,n,i){function r(){var e,t=l.status;if(!t&&Oe(l)||t>=200&&t<300||304===t){try{e=n.call(a,l)}catch(e){return void o.error.call(a,e)}o.load.call(a,e)}else o.error.call(a,l)}var a={},o=fo.dispatch("beforesend","progress","load","error"),s={},l=new XMLHttpRequest,c=null;return!this.XDomainRequest||"withCredentials"in l||!/^(http(s)?:)?\/\//.test(e)||(l=new XDomainRequest),"onload"in l?l.onload=l.onerror=r:l.onreadystatechange=function(){l.readyState>3&&r()},l.onprogress=function(e){var t=fo.event;fo.event=e;try{o.progress.call(a,l)}finally{fo.event=t}},a.header=function(e,t){return e=(e+"").toLowerCase(),arguments.length<2?s[e]:(null==t?delete s[e]:s[e]=t+"",a)},a.mimeType=function(e){return arguments.length?(t=null==e?null:e+"",a):t},a.responseType=function(e){return arguments.length?(c=e,a):c},a.response=function(e){return n=e,a},["get","post"].forEach(function(e){a[e]=function(){return a.send.apply(a,[e].concat(go(arguments)))}}),a.send=function(n,i,r){if(2===arguments.length&&"function"==typeof i&&(r=i,i=null),l.open(n,e,!0),null==t||"accept"in s||(s.accept=t+",*/*"),l.setRequestHeader)for(var d in s)l.setRequestHeader(d,s[d]);return null!=t&&l.overrideMimeType&&l.overrideMimeType(t),null!=c&&(l.responseType=c),null!=r&&a.on("error",r).on("load",function(e){r(null,e)}),o.beforesend.call(a,l),l.send(null==i?null:i),a},a.abort=function(){return l.abort(),a},fo.rebind(a,o,"on"),null==i?a:a.get(De(i))}function De(e){return 1===e.length?function(t,n){e(null==t?n:null)}:e}function Oe(e){var t=e.responseType;return t&&"text"!==t?e.response:e.responseText}function Pe(e,t,n){var i=arguments.length;i<2&&(t=0),i<3&&(n=Date.now());var r=n+t,a={c:e,t:r,n:null};return ls?ls.n=a:ss=a,ls=a,cs||(ds=clearTimeout(ds),cs=1,us(We)),a}function We(){var e=Re(),t=$e()-e;t>24?(isFinite(t)&&(clearTimeout(ds),ds=setTimeout(We,t)),cs=0):(cs=1,us(We))}function Re(){for(var e=Date.now(),t=ss;t;)e>=t.t&&t.c(e-t.t)&&(t.c=null),t=t.n;return e}function $e(){for(var e,t=ss,n=1/0;t;)t.c?(t.t<n&&(n=t.t),t=(e=t).n):t=e?e.n=t.n:ss=t.n;return ls=e,n}function ze(e,t){return t-(e?Math.ceil(Math.log(e)/Math.LN10):1)}function He(e,t){var n=Math.pow(10,3*ko(8-t));return{scale:t>8?function(e){return e/n}:function(e){return e*n},symbol:e}}function Ve(e){var t=e.decimal,n=e.thousands,i=e.grouping,r=e.currency,a=i&&n?function(e,t){for(var r=e.length,a=[],o=0,s=i[0],l=0;r>0&&s>0&&(l+s+1>t&&(s=Math.max(1,t-l)),a.push(e.substring(r-=s,r+s)),!((l+=s+1)>t));)s=i[o=(o+1)%i.length];return a.reverse().join(n)}:k;return function(e){var n=fs.exec(e),i=n[1]||" ",o=n[2]||">",s=n[3]||"-",l=n[4]||"",c=n[5],d=+n[6],u=n[7],h=n[8],f=n[9],p=1,g="",m="",_=!1,v=!0;switch(h&&(h=+h.substring(1)),(c||"0"===i&&"="===o)&&(c=i="0",o="="),f){case"n":u=!0,f="g";break;case"%":p=100,m="%",f="f";break;case"p":p=100,m="%",f="r";break;case"b":case"o":case"x":case"X":"#"===l&&(g="0"+f.toLowerCase());case"c":v=!1;case"d":_=!0,h=0;break;case"s":p=-1,f="r"}"$"===l&&(g=r[0],m=r[1]),"r"!=f||h||(f="g"),null!=h&&("g"==f?h=Math.max(1,Math.min(21,h)):"e"!=f&&"f"!=f||(h=Math.max(0,Math.min(20,h)))),f=ps.get(f)||Ye;var y=c&&u;return function(e){var n=m;if(_&&e%1)return"";var r=e<0||0===e&&1/e<0?(e=-e,"-"):"-"===s?"":s;if(p<0){var l=fo.formatPrefix(e,h);e=l.scale(e),n=l.symbol+m}else e*=p;e=f(e,h);var b,w,x=e.lastIndexOf(".");if(x<0){var k=v?e.lastIndexOf("e"):-1;k<0?(b=e,w=""):(b=e.substring(0,k),w=e.substring(k))}else b=e.substring(0,x),w=t+e.substring(x+1);!c&&u&&(b=a(b,1/0));var M=g.length+b.length+w.length+(y?0:r.length),C=M<d?new Array(M=d-M+1).join(i):"";return y&&(b=a(C+b,C.length?d-w.length:1/0)),r+=g,e=b+w,("<"===o?r+e+C:">"===o?C+r+e:"^"===o?C.substring(0,M>>=1)+r+e+C.substring(M):r+(y?e:C+e))+n}}}function Ye(e){return e+""}function Fe(){this._=new Date(arguments.length>1?Date.UTC.apply(this,arguments):arguments[0])}function Ge(e,t,n){function i(t){var n=e(t),i=a(n,1);return t-n<i-t?n:i}function r(n){return t(n=e(new ms(n-1)),1),n}function a(e,n){return t(e=new ms(+e),n),e}function o(e,i,a){var o=r(e),s=[];if(a>1)for(;o<i;)n(o)%a||s.push(new Date(+o)),t(o,1);else for(;o<i;)s.push(new Date(+o)),t(o,1);return s}function s(e,t,n){try{ms=Fe;var i=new Fe;return i._=e,o(i,t,n)}finally{ms=Date}}e.floor=e,e.round=i,e.ceil=r,e.offset=a,e.range=o;var l=e.utc=Ue(e);return l.floor=l,l.round=Ue(i),l.ceil=Ue(r),l.offset=Ue(a),l.range=s,e}function Ue(e){return function(t,n){try{ms=Fe;var i=new Fe;return i._=t,e(i,n)._}finally{ms=Date}}}function qe(e){function t(e){function t(t){for(var n,r,a,o=[],s=-1,l=0;++s<i;)37===e.charCodeAt(s)&&(o.push(e.slice(l,s)),null!=(r=vs[n=e.charAt(++s)])&&(n=e.charAt(++s)),(a=E[n])&&(n=a(t,null==r?"e"===n?" ":"0":r)),o.push(n),l=s+1);return o.push(e.slice(l,s)),o.join("")}var i=e.length;return t.parse=function(t){var i={y:1900,m:0,d:1,H:0,M:0,S:0,L:0,Z:null};if(n(i,e,t,0)!=t.length)return null;"p"in i&&(i.H=i.H%12+12*i.p);var r=null!=i.Z&&ms!==Fe,a=new(r?Fe:ms);return"j"in i?a.setFullYear(i.y,0,i.j):"W"in i||"U"in i?("w"in i||(i.w="W"in i?1:0),a.setFullYear(i.y,0,1),a.setFullYear(i.y,0,"W"in i?(i.w+6)%7+7*i.W-(a.getDay()+5)%7:i.w+7*i.U-(a.getDay()+6)%7)):a.setFullYear(i.y,i.m,i.d),a.setHours(i.H+(i.Z/100|0),i.M+i.Z%100,i.S,i.L),r?a._:a},t.toString=function(){return e},t}function n(e,t,n,i){for(var r,a,o,s=0,l=t.length,c=n.length;s<l;){if(i>=c)return-1;if(37===(r=t.charCodeAt(s++))){if(o=t.charAt(s++),!(a=j[o in vs?t.charAt(s++):o])||(i=a(e,n,i))<0)return-1}else if(r!=n.charCodeAt(i++))return-1}return i}function i(e,t,n){x.lastIndex=0;var i=x.exec(t.slice(n));return i?(e.w=k.get(i[0].toLowerCase()),n+i[0].length):-1}function r(e,t,n){b.lastIndex=0;var i=b.exec(t.slice(n));return i?(e.w=w.get(i[0].toLowerCase()),n+i[0].length):-1}function a(e,t,n){S.lastIndex=0;var i=S.exec(t.slice(n));return i?(e.m=T.get(i[0].toLowerCase()),n+i[0].length):-1}function o(e,t,n){M.lastIndex=0;var i=M.exec(t.slice(n));return i?(e.m=C.get(i[0].toLowerCase()),n+i[0].length):-1}function s(e,t,i){return n(e,E.c.toString(),t,i)}function l(e,t,i){return n(e,E.x.toString(),t,i)}function c(e,t,i){return n(e,E.X.toString(),t,i)}function d(e,t,n){var i=y.get(t.slice(n,n+=2).toLowerCase());return null==i?-1:(e.p=i,n)}var u=e.dateTime,h=e.date,f=e.time,p=e.periods,g=e.days,m=e.shortDays,_=e.months,v=e.shortMonths;t.utc=function(e){function n(e){try{ms=Fe;var t=new ms;return t._=e,i(t)}finally{ms=Date}}var i=t(e);return n.parse=function(e){try{ms=Fe;var t=i.parse(e);return t&&t._}finally{ms=Date}},n.toString=i.toString,n},t.multi=t.utc.multi=ft;var y=fo.map(),b=Je(g),w=Qe(g),x=Je(m),k=Qe(m),M=Je(_),C=Qe(_),S=Je(v),T=Qe(v);p.forEach(function(e,t){y.set(e.toLowerCase(),t)});var E={a:function(e){return m[e.getDay()]},A:function(e){return g[e.getDay()]},b:function(e){return v[e.getMonth()]},B:function(e){return _[e.getMonth()]},c:t(u),d:function(e,t){return Be(e.getDate(),t,2)},e:function(e,t){return Be(e.getDate(),t,2)},H:function(e,t){return Be(e.getHours(),t,2)},I:function(e,t){return Be(e.getHours()%12||12,t,2)},j:function(e,t){return Be(1+gs.dayOfYear(e),t,3)},L:function(e,t){return Be(e.getMilliseconds(),t,3)},m:function(e,t){return Be(e.getMonth()+1,t,2)},M:function(e,t){return Be(e.getMinutes(),t,2)},p:function(e){return p[+(e.getHours()>=12)]},S:function(e,t){return Be(e.getSeconds(),t,2)},U:function(e,t){return Be(gs.sundayOfYear(e),t,2)},w:function(e){return e.getDay()},W:function(e,t){return Be(gs.mondayOfYear(e),t,2)},x:t(h),X:t(f),y:function(e,t){return Be(e.getFullYear()%100,t,2)},Y:function(e,t){return Be(e.getFullYear()%1e4,t,4)},Z:ut,"%":function(){return"%"}},j={a:i,A:r,b:a,B:o,c:s,d:at,e:at,H:st,I:st,j:ot,L:dt,m:rt,M:lt,p:d,S:ct,U:Ke,w:Xe,W:Ze,x:l,X:c,y:tt,Y:et,Z:nt,"%":ht};return t}function Be(e,t,n){var i=e<0?"-":"",r=(i?-e:e)+"",a=r.length;return i+(a<n?new Array(n-a+1).join(t)+r:r)}function Je(e){return new RegExp("^(?:"+e.map(fo.requote).join("|")+")","i")}function Qe(e){for(var t=new p,n=-1,i=e.length;++n<i;)t.set(e[n].toLowerCase(),n);return t}function Xe(e,t,n){ys.lastIndex=0;var i=ys.exec(t.slice(n,n+1));return i?(e.w=+i[0],n+i[0].length):-1}function Ke(e,t,n){ys.lastIndex=0;var i=ys.exec(t.slice(n));return i?(e.U=+i[0],n+i[0].length):-1}function Ze(e,t,n){ys.lastIndex=0;var i=ys.exec(t.slice(n));return i?(e.W=+i[0],n+i[0].length):-1}function et(e,t,n){ys.lastIndex=0;var i=ys.exec(t.slice(n,n+4));return i?(e.y=+i[0],n+i[0].length):-1}function tt(e,t,n){ys.lastIndex=0;var i=ys.exec(t.slice(n,n+2));return i?(e.y=it(+i[0]),n+i[0].length):-1}function nt(e,t,n){return/^[+-]\d{4}$/.test(t=t.slice(n,n+5))?(e.Z=-t,n+5):-1}function it(e){return e+(e>68?1900:2e3)}function rt(e,t,n){ys.lastIndex=0;var i=ys.exec(t.slice(n,n+2));return i?(e.m=i[0]-1,n+i[0].length):-1}function at(e,t,n){ys.lastIndex=0;var i=ys.exec(t.slice(n,n+2));return i?(e.d=+i[0],n+i[0].length):-1}function ot(e,t,n){ys.lastIndex=0;var i=ys.exec(t.slice(n,n+3));return i?(e.j=+i[0],n+i[0].length):-1}function st(e,t,n){ys.lastIndex=0;var i=ys.exec(t.slice(n,n+2));return i?(e.H=+i[0],n+i[0].length):-1}function lt(e,t,n){ys.lastIndex=0;var i=ys.exec(t.slice(n,n+2));return i?(e.M=+i[0],n+i[0].length):-1}function ct(e,t,n){ys.lastIndex=0;var i=ys.exec(t.slice(n,n+2));return i?(e.S=+i[0],n+i[0].length):-1}function dt(e,t,n){ys.lastIndex=0;var i=ys.exec(t.slice(n,n+3));return i?(e.L=+i[0],n+i[0].length):-1}function ut(e){var t=e.getTimezoneOffset(),n=t>0?"-":"+",i=ko(t)/60|0,r=ko(t)%60;return n+Be(i,"0",2)+Be(r,"0",2)}function ht(e,t,n){bs.lastIndex=0;var i=bs.exec(t.slice(n,n+1));return i?n+i[0].length:-1}function ft(e){for(var t=e.length,n=-1;++n<t;)e[n][0]=this(e[n][0]);return function(t){for(var n=0,i=e[n];!i[1](t);)i=e[++n];return i[0](t)}}function pt(){}function gt(e,t,n){var i=n.s=e+t,r=i-e,a=i-r;n.t=e-a+(t-r)}function mt(e,t){e&&Ms.hasOwnProperty(e.type)&&Ms[e.type](e,t)}function _t(e,t,n){var i,r=-1,a=e.length-n;for(t.lineStart();++r<a;)i=e[r],t.point(i[0],i[1],i[2]);t.lineEnd()}function vt(e,t){var n=-1,i=e.length;for(t.polygonStart();++n<i;)_t(e[n],t,1);t.polygonEnd()}function yt(){function e(e,t){e*=Uo,t=t*Uo/2+Vo/4;var n=e-i,o=n>=0?1:-1,s=o*n,l=Math.cos(t),c=Math.sin(t),d=a*c,u=r*l+d*Math.cos(s),h=d*o*Math.sin(s);Ss.add(Math.atan2(h,u)),i=e,r=l,a=c}var t,n,i,r,a;Ts.point=function(o,s){Ts.point=e,i=(t=o)*Uo,r=Math.cos(s=(n=s)*Uo/2+Vo/4),a=Math.sin(s)},Ts.lineEnd=function(){e(t,n)}}function bt(e){var t=e[0],n=e[1],i=Math.cos(n);return[i*Math.cos(t),i*Math.sin(t),Math.sin(n)]}function wt(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function xt(e,t){return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]}function kt(e,t){e[0]+=t[0],e[1]+=t[1],e[2]+=t[2]}function Mt(e,t){return[e[0]*t,e[1]*t,e[2]*t]}function Ct(e){var t=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]/=t,e[1]/=t,e[2]/=t}function St(e){return[Math.atan2(e[1],e[0]),oe(e[2])]}function Tt(e,t){return ko(e[0]-t[0])<zo&&ko(e[1]-t[1])<zo}function Et(e,t){e*=Uo;var n=Math.cos(t*=Uo);jt(n*Math.cos(e),n*Math.sin(e),Math.sin(t))}function jt(e,t,n){++Es,As+=(e-As)/Es,Ns+=(t-Ns)/Es,Ls+=(n-Ls)/Es}function At(){function e(e,r){e*=Uo;var a=Math.cos(r*=Uo),o=a*Math.cos(e),s=a*Math.sin(e),l=Math.sin(r),c=Math.atan2(Math.sqrt((c=n*l-i*s)*c+(c=i*o-t*l)*c+(c=t*s-n*o)*c),t*o+n*s+i*l);js+=c,Is+=c*(t+(t=o)),Ds+=c*(n+(n=s)),Os+=c*(i+(i=l)),jt(t,n,i)}var t,n,i;$s.point=function(r,a){r*=Uo;var o=Math.cos(a*=Uo);t=o*Math.cos(r),n=o*Math.sin(r),i=Math.sin(a),$s.point=e,jt(t,n,i)}}function Nt(){$s.point=Et}function Lt(){function e(e,t){e*=Uo;var n=Math.cos(t*=Uo),o=n*Math.cos(e),s=n*Math.sin(e),l=Math.sin(t),c=r*l-a*s,d=a*o-i*l,u=i*s-r*o,h=Math.sqrt(c*c+d*d+u*u),f=i*o+r*s+a*l,p=h&&-ae(f)/h,g=Math.atan2(h,f);Ps+=p*c,Ws+=p*d,Rs+=p*u,js+=g,Is+=g*(i+(i=o)),Ds+=g*(r+(r=s)),Os+=g*(a+(a=l)),jt(i,r,a)}var t,n,i,r,a;$s.point=function(o,s){t=o,n=s,$s.point=e,o*=Uo;var l=Math.cos(s*=Uo);i=l*Math.cos(o),r=l*Math.sin(o),a=Math.sin(s),jt(i,r,a)},$s.lineEnd=function(){e(t,n),$s.lineEnd=Nt,$s.point=Et}}function It(e,t){function n(n,i){return n=e(n,i),t(n[0],n[1])}return e.invert&&t.invert&&(n.invert=function(n,i){return(n=t.invert(n,i))&&e.invert(n[0],n[1])}),n}function Dt(){return!0}function Ot(e,t,n,i,r){var a=[],o=[];if(e.forEach(function(e){if(!((t=e.length-1)<=0)){var t,n=e[0],i=e[t];if(Tt(n,i)){r.lineStart();for(var s=0;s<t;++s)r.point((n=e[s])[0],n[1]);return void r.lineEnd()}var l=new Wt(n,e,null,!0),c=new Wt(n,null,l,!1);l.o=c,a.push(l),o.push(c),l=new Wt(i,e,null,!1),c=new Wt(i,null,l,!0),l.o=c,a.push(l),o.push(c)}}),o.sort(t),Pt(a),Pt(o),a.length){for(var s=0,l=n,c=o.length;s<c;++s)o[s].e=l=!l;for(var d,u,h=a[0];;){for(var f=h,p=!0;f.v;)if((f=f.n)===h)return;d=f.z,r.lineStart();do{if(f.v=f.o.v=!0,f.e){if(p)for(var s=0,c=d.length;s<c;++s)r.point((u=d[s])[0],u[1]);else i(f.x,f.n.x,1,r);f=f.n}else{if(p){d=f.p.z;for(var s=d.length-1;s>=0;--s)r.point((u=d[s])[0],u[1])}else i(f.x,f.p.x,-1,r);f=f.p}f=f.o,d=f.z,p=!p}while(!f.v);r.lineEnd()}}}function Pt(e){if(t=e.length){for(var t,n,i=0,r=e[0];++i<t;)r.n=n=e[i],n.p=r,r=n;r.n=n=e[0],n.p=r}}function Wt(e,t,n,i){this.x=e,this.z=t,this.o=n,this.e=i,this.v=!1,this.n=this.p=null}function Rt(e,t,n,i){return function(r,a){function o(t,n){var i=r(t,n);e(t=i[0],n=i[1])&&a.point(t,n)}function s(e,t){var n=r(e,t);m.point(n[0],n[1])}function l(){v.point=s,m.lineStart()}function c(){v.point=o,m.lineEnd()}function d(e,t){g.push([e,t]);var n=r(e,t);b.point(n[0],n[1])}function u(){b.lineStart(),g=[]}function h(){d(g[0][0],g[0][1]),b.lineEnd();var e,t=b.clean(),n=y.buffer(),i=n.length;if(g.pop(),p.push(g),g=null,i)if(1&t){e=n[0];var r,i=e.length-1,o=-1;if(i>0){for(w||(a.polygonStart(),w=!0),a.lineStart();++o<i;)a.point((r=e[o])[0],r[1]);a.lineEnd()}}else i>1&&2&t&&n.push(n.pop().concat(n.shift())),f.push(n.filter($t))}var f,p,g,m=t(a),_=r.invert(i[0],i[1]),v={point:o,lineStart:l,lineEnd:c,polygonStart:function(){v.point=d,v.lineStart=u,v.lineEnd=h,f=[],p=[]},polygonEnd:function(){v.point=o,v.lineStart=l,v.lineEnd=c,f=fo.merge(f);var e=Gt(_,p);f.length?(w||(a.polygonStart(),w=!0),Ot(f,Ht,e,n,a)):e&&(w||(a.polygonStart(),w=!0),a.lineStart(),n(null,null,1,a),a.lineEnd()),w&&(a.polygonEnd(),w=!1),f=p=null},sphere:function(){a.polygonStart(),a.lineStart(),n(null,null,1,a),a.lineEnd(),a.polygonEnd()}},y=zt(),b=t(y),w=!1;return v}}function $t(e){return e.length>1}function zt(){var e,t=[];return{lineStart:function(){t.push(e=[])},point:function(t,n){e.push([t,n])},lineEnd:S,buffer:function(){var n=t;return t=[],e=null,n},rejoin:function(){t.length>1&&t.push(t.pop().concat(t.shift()))}}}function Ht(e,t){return((e=e.x)[0]<0?e[1]-Go-zo:Go-e[1])-((t=t.x)[0]<0?t[1]-Go-zo:Go-t[1])}function Vt(e){var t,n=NaN,i=NaN,r=NaN;return{lineStart:function(){e.lineStart(),t=1},point:function(a,o){var s=a>0?Vo:-Vo,l=ko(a-n);ko(l-Vo)<zo?(e.point(n,i=(i+o)/2>0?Go:-Go),e.point(r,i),e.lineEnd(),e.lineStart(),e.point(s,i),e.point(a,i),t=0):r!==s&&l>=Vo&&(ko(n-r)<zo&&(n-=r*zo),ko(a-s)<zo&&(a-=s*zo),i=Yt(n,i,a,o),e.point(r,i),e.lineEnd(),e.lineStart(),e.point(s,i),t=0),e.point(n=a,i=o),r=s},lineEnd:function(){e.lineEnd(),n=i=NaN},clean:function(){return 2-t}}}function Yt(e,t,n,i){var r,a,o=Math.sin(e-n);return ko(o)>zo?Math.atan((Math.sin(t)*(a=Math.cos(i))*Math.sin(n)-Math.sin(i)*(r=Math.cos(t))*Math.sin(e))/(r*a*o)):(t+i)/2}function Ft(e,t,n,i){var r;if(null==e)r=n*Go,i.point(-Vo,r),i.point(0,r),i.point(Vo,r),i.point(Vo,0),i.point(Vo,-r),i.point(0,-r),i.point(-Vo,-r),i.point(-Vo,0),i.point(-Vo,r);else if(ko(e[0]-t[0])>zo){var a=e[0]<t[0]?Vo:-Vo;r=n*a/2,i.point(-a,r),i.point(0,r),i.point(a,r)}else i.point(t[0],t[1])}function Gt(e,t){var n=e[0],i=e[1],r=[Math.sin(n),-Math.cos(n),0],a=0,o=0;Ss.reset();for(var s=0,l=t.length;s<l;++s){var c=t[s],d=c.length;if(d)for(var u=c[0],h=u[0],f=u[1]/2+Vo/4,p=Math.sin(f),g=Math.cos(f),m=1;;){m===d&&(m=0),e=c[m];var _=e[0],v=e[1]/2+Vo/4,y=Math.sin(v),b=Math.cos(v),w=_-h,x=w>=0?1:-1,k=x*w,M=k>Vo,C=p*y;if(Ss.add(Math.atan2(C*x*Math.sin(k),g*b+C*Math.cos(k))),a+=M?w+x*Yo:w,M^h>=n^_>=n){var S=xt(bt(u),bt(e));Ct(S);var T=xt(r,S);Ct(T);var E=(M^w>=0?-1:1)*oe(T[2]);(i>E||i===E&&(S[0]||S[1]))&&(o+=M^w>=0?1:-1)}if(!m++)break;h=_,p=y,g=b,u=e}}return(a<-zo||a<zo&&Ss<-zo)^1&o}function Ut(e){function t(e,t){return Math.cos(e)*Math.cos(t)>a}function n(e){var n,a,l,c,d;return{lineStart:function(){c=l=!1,d=1},point:function(u,h){var f,p=[u,h],g=t(u,h),m=o?g?0:r(u,h):g?r(u+(u<0?Vo:-Vo),h):0;if(!n&&(c=l=g)&&e.lineStart(),g!==l&&(f=i(n,p),(Tt(n,f)||Tt(p,f))&&(p[0]+=zo,p[1]+=zo,g=t(p[0],p[1]))),g!==l)d=0,g?(e.lineStart(),f=i(p,n),e.point(f[0],f[1])):(f=i(n,p),e.point(f[0],f[1]),e.lineEnd()),n=f;else if(s&&n&&o^g){var _;m&a||!(_=i(p,n,!0))||(d=0,o?(e.lineStart(),e.point(_[0][0],_[0][1]),e.point(_[1][0],_[1][1]),e.lineEnd()):(e.point(_[1][0],_[1][1]),e.lineEnd(),e.lineStart(),e.point(_[0][0],_[0][1])))}!g||n&&Tt(n,p)||e.point(p[0],p[1]),n=p,l=g,a=m},lineEnd:function(){l&&e.lineEnd(),n=null},clean:function(){return d|(c&&l)<<1}}}function i(e,t,n){var i=bt(e),r=bt(t),o=[1,0,0],s=xt(i,r),l=wt(s,s),c=s[0],d=l-c*c;if(!d)return!n&&e;var u=a*l/d,h=-a*c/d,f=xt(o,s),p=Mt(o,u);kt(p,Mt(s,h));var g=f,m=wt(p,g),_=wt(g,g),v=m*m-_*(wt(p,p)-1);if(!(v<0)){var y=Math.sqrt(v),b=Mt(g,(-m-y)/_);if(kt(b,p),b=St(b),!n)return b;var w,x=e[0],k=t[0],M=e[1],C=t[1];k<x&&(w=x,x=k,k=w);var S=k-x,T=ko(S-Vo)<zo,E=T||S<zo;if(!T&&C<M&&(w=M,M=C,C=w),E?T?M+C>0^b[1]<(ko(b[0]-x)<zo?M:C):M<=b[1]&&b[1]<=C:S>Vo^(x<=b[0]&&b[0]<=k)){var j=Mt(g,(-m+y)/_);return kt(j,p),[b,St(j)]}}}function r(t,n){var i=o?e:Vo-e,r=0;return t<-i?r|=1:t>i&&(r|=2),n<-i?r|=4:n>i&&(r|=8),r}var a=Math.cos(e),o=a>0,s=ko(a)>zo;return Rt(t,n,bn(e,6*Uo),o?[0,-e]:[-Vo,e-Vo])}function qt(e,t,n,i){return function(r){var a,o=r.a,s=r.b,l=o.x,c=o.y,d=s.x,u=s.y,h=0,f=1,p=d-l,g=u-c;if(a=e-l,p||!(a>0)){if(a/=p,p<0){if(a<h)return;a<f&&(f=a)}else if(p>0){if(a>f)return;a>h&&(h=a)}if(a=n-l,p||!(a<0)){if(a/=p,p<0){if(a>f)return;a>h&&(h=a)}else if(p>0){if(a<h)return;a<f&&(f=a)}if(a=t-c,g||!(a>0)){if(a/=g,g<0){if(a<h)return;a<f&&(f=a)}else if(g>0){if(a>f)return;a>h&&(h=a)}if(a=i-c,g||!(a<0)){if(a/=g,g<0){if(a>f)return;a>h&&(h=a)}else if(g>0){if(a<h)return;a<f&&(f=a)}return h>0&&(r.a={x:l+h*p,y:c+h*g}),f<1&&(r.b={x:l+f*p,y:c+f*g}),r}}}}}}function Bt(e,t,n,i){function r(i,r){return ko(i[0]-e)<zo?r>0?0:3:ko(i[0]-n)<zo?r>0?2:1:ko(i[1]-t)<zo?r>0?1:0:r>0?3:2}function a(e,t){return o(e.x,t.x)}function o(e,t){var n=r(e,1),i=r(t,1);return n!==i?n-i:0===n?t[1]-e[1]:1===n?e[0]-t[0]:2===n?e[1]-t[1]:t[0]-e[0]}return function(s){function l(e){for(var t=0,n=m.length,i=e[1],r=0;r<n;++r)for(var a,o=1,s=m[r],l=s.length,c=s[0];o<l;++o)a=s[o],c[1]<=i?a[1]>i&&re(c,a,e)>0&&++t:a[1]<=i&&re(c,a,e)<0&&--t,c=a;return 0!==t}function c(a,s,l,c){var d=0,u=0;if(null==a||(d=r(a,l))!==(u=r(s,l))||o(a,s)<0^l>0)do{c.point(0===d||3===d?e:n,d>1?i:t)}while((d=(d+l+4)%4)!==u);else c.point(s[0],s[1])}function d(r,a){return e<=r&&r<=n&&t<=a&&a<=i}function u(e,t){d(e,t)&&s.point(e,t)}function h(){j.point=p,m&&m.push(_=[]),M=!0,k=!1,w=x=NaN}function f(){g&&(p(v,y),b&&k&&T.rejoin(),g.push(T.buffer())),j.point=u,k&&s.lineEnd()}function p(e,t){e=Math.max(-Hs,Math.min(Hs,e)),t=Math.max(-Hs,Math.min(Hs,t));var n=d(e,t);if(m&&_.push([e,t]),M)v=e,y=t,b=n,M=!1,n&&(s.lineStart(),s.point(e,t));else if(n&&k)s.point(e,t);else{var i={a:{x:w,y:x},b:{x:e,y:t}};E(i)?(k||(s.lineStart(),s.point(i.a.x,i.a.y)),s.point(i.b.x,i.b.y),n||s.lineEnd(),C=!1):n&&(s.lineStart(),s.point(e,t),C=!1)}w=e,x=t,k=n}var g,m,_,v,y,b,w,x,k,M,C,S=s,T=zt(),E=qt(e,t,n,i),j={point:u,lineStart:h,lineEnd:f,polygonStart:function(){s=T,g=[],m=[],C=!0},polygonEnd:function(){s=S,g=fo.merge(g);var t=l([e,i]),n=C&&t,r=g.length;(n||r)&&(s.polygonStart(),n&&(s.lineStart(),c(null,null,1,s),s.lineEnd()),r&&Ot(g,a,t,c,s),s.polygonEnd()),g=m=_=null}};return j}}function Jt(e){var t=0,n=Vo/3,i=hn(e),r=i(t,n);return r.parallels=function(e){return arguments.length?i(t=e[0]*Vo/180,n=e[1]*Vo/180):[t/Vo*180,n/Vo*180]},r}function Qt(e,t){function n(e,t){var n=Math.sqrt(a-2*r*Math.sin(t))/r;return[n*Math.sin(e*=r),o-n*Math.cos(e)]}var i=Math.sin(e),r=(i+Math.sin(t))/2,a=1+i*(2*r-i),o=Math.sqrt(a)/r;return n.invert=function(e,t){var n=o-t;return[Math.atan2(e,n)/r,oe((a-(e*e+n*n)*r*r)/(2*r))]},n}function Xt(){function e(e,t){Ys+=r*e-i*t,i=e,r=t}var t,n,i,r;Bs.point=function(a,o){Bs.point=e,t=i=a,n=r=o},Bs.lineEnd=function(){e(t,n)}}function Kt(e,t){e<Fs&&(Fs=e),e>Us&&(Us=e),t<Gs&&(Gs=t),t>qs&&(qs=t)}function Zt(){function e(e,t){o.push("M",e,",",t,a)}function t(e,t){o.push("M",e,",",t),s.point=n}function n(e,t){o.push("L",e,",",t)}function i(){s.point=e}function r(){o.push("Z")}var a=en(4.5),o=[],s={point:e,lineStart:function(){s.point=t},lineEnd:i,polygonStart:function(){s.lineEnd=r},polygonEnd:function(){s.lineEnd=i,s.point=e},pointRadius:function(e){return a=en(e),s},result:function(){if(o.length){var e=o.join("");return o=[],e}}};return s}function en(e){return"m0,"+e+"a"+e+","+e+" 0 1,1 0,"+-2*e+"a"+e+","+e+" 0 1,1 0,"+2*e+"z"}function tn(e,t){As+=e,Ns+=t,++Ls}function nn(){function e(e,i){var r=e-t,a=i-n,o=Math.sqrt(r*r+a*a);Is+=o*(t+e)/2,Ds+=o*(n+i)/2,Os+=o,tn(t=e,n=i)}var t,n;Qs.point=function(i,r){Qs.point=e,tn(t=i,n=r)}}function rn(){Qs.point=tn}function an(){function e(e,t){var n=e-i,a=t-r,o=Math.sqrt(n*n+a*a);Is+=o*(i+e)/2,Ds+=o*(r+t)/2,Os+=o,o=r*e-i*t,Ps+=o*(i+e),Ws+=o*(r+t),Rs+=3*o,tn(i=e,r=t)}var t,n,i,r;Qs.point=function(a,o){Qs.point=e,tn(t=i=a,n=r=o)},Qs.lineEnd=function(){e(t,n)}}function on(e){function t(t,n){e.moveTo(t+o,n),e.arc(t,n,o,0,Yo)}function n(t,n){e.moveTo(t,n),s.point=i}function i(t,n){e.lineTo(t,n)}function r(){s.point=t}function a(){e.closePath()}var o=4.5,s={point:t,lineStart:function(){s.point=n},lineEnd:r,polygonStart:function(){s.lineEnd=a},polygonEnd:function(){s.lineEnd=r,s.point=t},pointRadius:function(e){return o=e,s},result:S};return s}function sn(e){function t(e){return(s?i:n)(e)}function n(t){return dn(t,function(n,i){n=e(n,i),t.point(n[0],n[1])})}function i(t){function n(n,i){n=e(n,i),t.point(n[0],n[1])}function i(){y=NaN,M.point=a,t.lineStart()}function a(n,i){var a=bt([n,i]),o=e(n,i);r(y,b,v,w,x,k,y=o[0],b=o[1],v=n,w=a[0],x=a[1],k=a[2],s,t),t.point(y,b)}function o(){M.point=n,t.lineEnd()}function l(){i(),M.point=c,M.lineEnd=d}function c(e,t){a(u=e,h=t),f=y,p=b,g=w,m=x,_=k,M.point=a}function d(){r(y,b,v,w,x,k,f,p,u,g,m,_,s,t),M.lineEnd=o,o()}var u,h,f,p,g,m,_,v,y,b,w,x,k,M={point:n,lineStart:i,lineEnd:o,polygonStart:function(){t.polygonStart(),M.lineStart=l},polygonEnd:function(){t.polygonEnd(),M.lineStart=i}};return M}function r(t,n,i,s,l,c,d,u,h,f,p,g,m,_){var v=d-t,y=u-n,b=v*v+y*y;if(b>4*a&&m--){var w=s+f,x=l+p,k=c+g,M=Math.sqrt(w*w+x*x+k*k),C=Math.asin(k/=M),S=ko(ko(k)-1)<zo||ko(i-h)<zo?(i+h)/2:Math.atan2(x,w),T=e(S,C),E=T[0],j=T[1],A=E-t,N=j-n,L=y*A-v*N;(L*L/b>a||ko((v*A+y*N)/b-.5)>.3||s*f+l*p+c*g<o)&&(r(t,n,i,s,l,c,E,j,S,w/=M,x/=M,k,m,_),_.point(E,j),r(E,j,S,w,x,k,d,u,h,f,p,g,m,_))}}var a=.5,o=Math.cos(30*Uo),s=16;return t.precision=function(e){return arguments.length?(s=(a=e*e)>0&&16,t):Math.sqrt(a)},t}function ln(e){var t=sn(function(t,n){return e([t*qo,n*qo])});return function(e){return fn(t(e))}}function cn(e){this.stream=e}function dn(e,t){return{point:t,sphere:function(){e.sphere()},lineStart:function(){e.lineStart()},lineEnd:function(){e.lineEnd()},polygonStart:function(){e.polygonStart()},polygonEnd:function(){e.polygonEnd()}}}function un(e){return hn(function(){return e})()}function hn(e){function t(e){return e=s(e[0]*Uo,e[1]*Uo),[e[0]*h+l,c-e[1]*h]}function n(e){return(e=s.invert((e[0]-l)/h,(c-e[1])/h))&&[e[0]*qo,e[1]*qo]}function i(){s=It(o=mn(_,v,y),a);var e=a(g,m);return l=f-e[0]*h,c=p+e[1]*h,r()}function r(){return d&&(d.valid=!1,d=null),t}var a,o,s,l,c,d,u=sn(function(e,t){return e=a(e,t),[e[0]*h+l,c-e[1]*h]}),h=150,f=480,p=250,g=0,m=0,_=0,v=0,y=0,b=zs,w=k,x=null,M=null;return t.stream=function(e){return d&&(d.valid=!1),d=fn(b(o,u(w(e)))),d.valid=!0,d},t.clipAngle=function(e){return arguments.length?(b=null==e?(x=e,zs):Ut((x=+e)*Uo),r()):x},t.clipExtent=function(e){return arguments.length?(M=e,w=e?Bt(e[0][0],e[0][1],e[1][0],e[1][1]):k,r()):M},t.scale=function(e){return arguments.length?(h=+e,i()):h},t.translate=function(e){return arguments.length?(f=+e[0],p=+e[1],i()):[f,p]},t.center=function(e){return arguments.length?(g=e[0]%360*Uo,m=e[1]%360*Uo,i()):[g*qo,m*qo]},t.rotate=function(e){return arguments.length?(_=e[0]%360*Uo,v=e[1]%360*Uo,y=e.length>2?e[2]%360*Uo:0,i()):[_*qo,v*qo,y*qo]},fo.rebind(t,u,"precision"),function(){return a=e.apply(this,arguments),t.invert=a.invert&&n,i()}}function fn(e){return dn(e,function(t,n){e.point(t*Uo,n*Uo)})}function pn(e,t){return[e,t]}function gn(e,t){return[e>Vo?e-Yo:e<-Vo?e+Yo:e,t]}function mn(e,t,n){return e?t||n?It(vn(e),yn(t,n)):vn(e):t||n?yn(t,n):gn}function _n(e){return function(t,n){return t+=e,[t>Vo?t-Yo:t<-Vo?t+Yo:t,n]}}function vn(e){var t=_n(e);return t.invert=_n(-e),t}function yn(e,t){function n(e,t){var n=Math.cos(t),s=Math.cos(e)*n,l=Math.sin(e)*n,c=Math.sin(t),d=c*i+s*r;return[Math.atan2(l*a-d*o,s*i-c*r),oe(d*a+l*o)]}var i=Math.cos(e),r=Math.sin(e),a=Math.cos(t),o=Math.sin(t);return n.invert=function(e,t){var n=Math.cos(t),s=Math.cos(e)*n,l=Math.sin(e)*n,c=Math.sin(t),d=c*a-l*o;return[Math.atan2(l*a+c*o,s*i+d*r),oe(d*i-s*r)]},n}function bn(e,t){var n=Math.cos(e),i=Math.sin(e);return function(r,a,o,s){var l=o*t;null!=r?(r=wn(n,r),a=wn(n,a),(o>0?r<a:r>a)&&(r+=o*Yo)):(r=e+o*Yo,a=e-.5*l);for(var c,d=r;o>0?d>a:d<a;d-=l)s.point((c=St([n,-i*Math.cos(d),-i*Math.sin(d)]))[0],c[1])}}function wn(e,t){var n=bt(t);n[0]-=e,Ct(n);var i=ae(-n[1]);return((-n[2]<0?-i:i)+2*Math.PI-zo)%(2*Math.PI)}function xn(e,t,n){var i=fo.range(e,t-zo,n).concat(t);return function(e){return i.map(function(t){return[e,t]})}}function kn(e,t,n){var i=fo.range(e,t-zo,n).concat(t);return function(e){return i.map(function(t){return[t,e]})}}function Mn(e){return e.source}function Cn(e){return e.target}function Sn(e,t,n,i){var r=Math.cos(t),a=Math.sin(t),o=Math.cos(i),s=Math.sin(i),l=r*Math.cos(e),c=r*Math.sin(e),d=o*Math.cos(n),u=o*Math.sin(n),h=2*Math.asin(Math.sqrt(de(i-t)+r*o*de(n-e))),f=1/Math.sin(h),p=h?function(e){var t=Math.sin(e*=h)*f,n=Math.sin(h-e)*f,i=n*l+t*d,r=n*c+t*u,o=n*a+t*s;return[Math.atan2(r,i)*qo,Math.atan2(o,Math.sqrt(i*i+r*r))*qo]}:function(){return[e*qo,t*qo]};return p.distance=h,p}function Tn(){function e(e,r){var a=Math.sin(r*=Uo),o=Math.cos(r),s=ko((e*=Uo)-t),l=Math.cos(s);Xs+=Math.atan2(Math.sqrt((s=o*Math.sin(s))*s+(s=i*a-n*o*l)*s),n*a+i*o*l),t=e,n=a,i=o}var t,n,i;Ks.point=function(r,a){t=r*Uo,n=Math.sin(a*=Uo),i=Math.cos(a),Ks.point=e},Ks.lineEnd=function(){Ks.point=Ks.lineEnd=S}}function En(e,t){function n(t,n){var i=Math.cos(t),r=Math.cos(n),a=e(i*r);return[a*r*Math.sin(t),a*Math.sin(n)]}return n.invert=function(e,n){var i=Math.sqrt(e*e+n*n),r=t(i),a=Math.sin(r),o=Math.cos(r);return[Math.atan2(e*a,i*o),Math.asin(i&&n*a/i)]},n}function jn(e,t){function n(e,t){o>0?t<-Go+zo&&(t=-Go+zo):t>Go-zo&&(t=Go-zo);var n=o/Math.pow(r(t),a);return[n*Math.sin(a*e),o-n*Math.cos(a*e)]}var i=Math.cos(e),r=function(e){return Math.tan(Vo/4+e/2)},a=e===t?Math.sin(e):Math.log(i/Math.cos(t))/Math.log(r(t)/r(e)),o=i*Math.pow(r(e),a)/a;return a?(n.invert=function(e,t){var n=o-t,i=ie(a)*Math.sqrt(e*e+n*n);return[Math.atan2(e,n)/a,2*Math.atan(Math.pow(o/i,1/a))-Go]},n):Nn}function An(e,t){function n(e,t){var n=a-t;return[n*Math.sin(r*e),a-n*Math.cos(r*e)]}var i=Math.cos(e),r=e===t?Math.sin(e):(i-Math.cos(t))/(t-e),a=i/r+e;return ko(r)<zo?pn:(n.invert=function(e,t){var n=a-t;return[Math.atan2(e,n)/r,a-ie(r)*Math.sqrt(e*e+n*n)]},n)}function Nn(e,t){return[e,Math.log(Math.tan(Vo/4+t/2))]}function Ln(e){var t,n=un(e),i=n.scale,r=n.translate,a=n.clipExtent;return n.scale=function(){var e=i.apply(n,arguments);return e===n?t?n.clipExtent(null):n:e},n.translate=function(){var e=r.apply(n,arguments);return e===n?t?n.clipExtent(null):n:e},n.clipExtent=function(e){var o=a.apply(n,arguments);if(o===n){if(t=null==e){var s=Vo*i(),l=r();a([[l[0]-s,l[1]-s],[l[0]+s,l[1]+s]])}}else t&&(o=null);return o},n.clipExtent(null)}function In(e,t){return[Math.log(Math.tan(Vo/4+t/2)),-e]}function Dn(e){return e[0]}function On(e){return e[1]}function Pn(e){for(var t=e.length,n=[0,1],i=2,r=2;r<t;r++){for(;i>1&&re(e[n[i-2]],e[n[i-1]],e[r])<=0;)--i;n[i++]=r}return n.slice(0,i)}function Wn(e,t){return e[0]-t[0]||e[1]-t[1]}function Rn(e,t,n){return(n[0]-t[0])*(e[1]-t[1])<(n[1]-t[1])*(e[0]-t[0])}function $n(e,t,n,i){var r=e[0],a=n[0],o=t[0]-r,s=i[0]-a,l=e[1],c=n[1],d=t[1]-l,u=i[1]-c,h=(s*(l-c)-u*(r-a))/(u*o-s*d);return[r+h*o,l+h*d]}function zn(e){var t=e[0],n=e[e.length-1];return!(t[0]-n[0]||t[1]-n[1])}function Hn(){li(this),this.edge=this.site=this.circle=null}function Vn(e){var t=dl.pop()||new Hn;return t.site=e,t}function Yn(e){Zn(e),sl.remove(e),dl.push(e),li(e)}function Fn(e){var t=e.circle,n=t.x,i=t.cy,r={x:n,y:i},a=e.P,o=e.N,s=[e];Yn(e);for(var l=a;l.circle&&ko(n-l.circle.x)<zo&&ko(i-l.circle.cy)<zo;)a=l.P,s.unshift(l),Yn(l),l=a;s.unshift(l),Zn(l);for(var c=o;c.circle&&ko(n-c.circle.x)<zo&&ko(i-c.circle.cy)<zo;)o=c.N,s.push(c),Yn(c),c=o;s.push(c),Zn(c);var d,u=s.length;for(d=1;d<u;++d)c=s[d],l=s[d-1],ai(c.edge,l.site,c.site,r);l=s[0],c=s[u-1],c.edge=ii(l.site,c.site,null,r),Kn(l),Kn(c)}function Gn(e){for(var t,n,i,r,a=e.x,o=e.y,s=sl._;s;)if((i=Un(s,o)-a)>zo)s=s.L;else{if(!((r=a-qn(s,o))>zo)){i>-zo?(t=s.P,n=s):r>-zo?(t=s,n=s.N):t=n=s;break}if(!s.R){t=s;break}s=s.R}var l=Vn(e);if(sl.insert(t,l),t||n){if(t===n)return Zn(t),n=Vn(t.site),sl.insert(l,n),l.edge=n.edge=ii(t.site,l.site),Kn(t),void Kn(n);if(!n)return void(l.edge=ii(t.site,l.site));Zn(t),Zn(n);var c=t.site,d=c.x,u=c.y,h=e.x-d,f=e.y-u,p=n.site,g=p.x-d,m=p.y-u,_=2*(h*m-f*g),v=h*h+f*f,y=g*g+m*m,b={x:(m*v-f*y)/_+d,y:(h*y-g*v)/_+u};ai(n.edge,c,p,b),l.edge=ii(c,e,null,b),n.edge=ii(e,p,null,b),Kn(t),Kn(n)}}function Un(e,t){var n=e.site,i=n.x,r=n.y,a=r-t;if(!a)return i;var o=e.P;if(!o)return-1/0;n=o.site;var s=n.x,l=n.y,c=l-t;if(!c)return s;var d=s-i,u=1/a-1/c,h=d/c;return u?(-h+Math.sqrt(h*h-2*u*(d*d/(-2*c)-l+c/2+r-a/2)))/u+i:(i+s)/2}function qn(e,t){var n=e.N;if(n)return Un(n,t);var i=e.site;return i.y===t?i.x:1/0}function Bn(e){this.site=e,this.edges=[]}function Jn(e){for(var t,n,i,r,a,o,s,l,c,d,u=e[0][0],h=e[1][0],f=e[0][1],p=e[1][1],g=ol,m=g.length;m--;)if((a=g[m])&&a.prepare())for(s=a.edges,l=s.length,o=0;o<l;)d=s[o].end(),i=d.x,r=d.y,c=s[++o%l].start(),t=c.x,n=c.y,(ko(i-t)>zo||ko(r-n)>zo)&&(s.splice(o,0,new oi(ri(a.site,d,ko(i-u)<zo&&p-r>zo?{x:u,y:ko(t-u)<zo?n:p}:ko(r-p)<zo&&h-i>zo?{x:ko(n-p)<zo?t:h,y:p}:ko(i-h)<zo&&r-f>zo?{x:h,y:ko(t-h)<zo?n:f}:ko(r-f)<zo&&i-u>zo?{x:ko(n-f)<zo?t:u,y:f}:null),a.site,null)),++l)}function Qn(e,t){return t.angle-e.angle}function Xn(){li(this),this.x=this.y=this.arc=this.site=this.cy=null}function Kn(e){var t=e.P,n=e.N;if(t&&n){var i=t.site,r=e.site,a=n.site;if(i!==a){var o=r.x,s=r.y,l=i.x-o,c=i.y-s,d=a.x-o,u=a.y-s,h=2*(l*u-c*d);if(!(h>=-Ho)){var f=l*l+c*c,p=d*d+u*u,g=(u*f-c*p)/h,m=(l*p-d*f)/h,u=m+s,_=ul.pop()||new Xn;_.arc=e,_.site=r,_.x=g+o,_.y=u+Math.sqrt(g*g+m*m),_.cy=u,e.circle=_;for(var v=null,y=cl._;y;)if(_.y<y.y||_.y===y.y&&_.x<=y.x){if(!y.L){v=y.P;break}y=y.L}else{if(!y.R){v=y;break}y=y.R}cl.insert(v,_),v||(ll=_)}}}}function Zn(e){var t=e.circle;t&&(t.P||(ll=t.N),cl.remove(t),ul.push(t),li(t),e.circle=null)}function ei(e){for(var t,n=al,i=qt(e[0][0],e[0][1],e[1][0],e[1][1]),r=n.length;r--;)t=n[r],(!ti(t,e)||!i(t)||ko(t.a.x-t.b.x)<zo&&ko(t.a.y-t.b.y)<zo)&&(t.a=t.b=null,n.splice(r,1))}function ti(e,t){var n=e.b;if(n)return!0;var i,r,a=e.a,o=t[0][0],s=t[1][0],l=t[0][1],c=t[1][1],d=e.l,u=e.r,h=d.x,f=d.y,p=u.x,g=u.y,m=(h+p)/2,_=(f+g)/2;if(g===f){if(m<o||m>=s)return;if(h>p){if(a){if(a.y>=c)return}else a={x:m,y:l};n={x:m,y:c}}else{if(a){if(a.y<l)return}else a={x:m,y:c};n={x:m,y:l}}}else if(i=(h-p)/(g-f),r=_-i*m,i<-1||i>1)if(h>p){if(a){if(a.y>=c)return}else a={x:(l-r)/i,y:l};n={x:(c-r)/i,y:c}}else{if(a){if(a.y<l)return}else a={x:(c-r)/i,y:c};n={x:(l-r)/i,y:l}}else if(f<g){if(a){if(a.x>=s)return}else a={x:o,y:i*o+r};n={x:s,y:i*s+r}}else{if(a){if(a.x<o)return}else a={x:s,y:i*s+r};n={x:o,y:i*o+r}}return e.a=a,e.b=n,!0}function ni(e,t){this.l=e,this.r=t,this.a=this.b=null}function ii(e,t,n,i){var r=new ni(e,t);return al.push(r),n&&ai(r,e,t,n),i&&ai(r,t,e,i),ol[e.i].edges.push(new oi(r,e,t)),ol[t.i].edges.push(new oi(r,t,e)),r}function ri(e,t,n){var i=new ni(e,null);return i.a=t,i.b=n,al.push(i),i}function ai(e,t,n,i){e.a||e.b?e.l===n?e.b=i:e.a=i:(e.a=i,e.l=t,e.r=n)}function oi(e,t,n){var i=e.a,r=e.b;this.edge=e,this.site=t,this.angle=n?Math.atan2(n.y-t.y,n.x-t.x):e.l===t?Math.atan2(r.x-i.x,i.y-r.y):Math.atan2(i.x-r.x,r.y-i.y)}function si(){this._=null}function li(e){e.U=e.C=e.L=e.R=e.P=e.N=null}function ci(e,t){var n=t,i=t.R,r=n.U;r?r.L===n?r.L=i:r.R=i:e._=i,i.U=r,n.U=i,n.R=i.L,n.R&&(n.R.U=n),i.L=n}function di(e,t){var n=t,i=t.L,r=n.U;r?r.L===n?r.L=i:r.R=i:e._=i,i.U=r,n.U=i,n.L=i.R,n.L&&(n.L.U=n),i.R=n}function ui(e){for(;e.L;)e=e.L;return e}function hi(e,t){var n,i,r,a=e.sort(fi).pop();for(al=[],ol=new Array(e.length),sl=new si,cl=new si;;)if(r=ll,a&&(!r||a.y<r.y||a.y===r.y&&a.x<r.x))a.x===n&&a.y===i||(ol[a.i]=new Bn(a),Gn(a),n=a.x,i=a.y),a=e.pop();else{if(!r)break;Fn(r.arc)}t&&(ei(t),Jn(t));var o={cells:ol,edges:al};return sl=cl=al=ol=null,o}function fi(e,t){return t.y-e.y||t.x-e.x}function pi(e,t,n){return(e.x-n.x)*(t.y-e.y)-(e.x-t.x)*(n.y-e.y)}function gi(e){return e.x}function mi(e){return e.y}function _i(){return{leaf:!0,nodes:[],point:null,x:null,y:null}}function vi(e,t,n,i,r,a){if(!e(t,n,i,r,a)){var o=.5*(n+r),s=.5*(i+a),l=t.nodes;l[0]&&vi(e,l[0],n,i,o,s),l[1]&&vi(e,l[1],o,i,r,s),l[2]&&vi(e,l[2],n,s,o,a),l[3]&&vi(e,l[3],o,s,r,a)}}function yi(e,t,n,i,r,a,o){var s,l=1/0;return function e(c,d,u,h,f){if(!(d>a||u>o||h<i||f<r)){if(p=c.point){var p,g=t-c.x,m=n-c.y,_=g*g+m*m;if(_<l){var v=Math.sqrt(l=_);i=t-v,r=n-v,a=t+v,o=n+v,s=p}}for(var y=c.nodes,b=.5*(d+h),w=.5*(u+f),x=t>=b,k=n>=w,M=k<<1|x,C=M+4;M<C;++M)if(c=y[3&M])switch(3&M){case 0:e(c,d,u,b,w);break;case 1:e(c,b,u,h,w);break;case 2:e(c,d,w,b,f);break;case 3:e(c,b,w,h,f)}}}(e,i,r,a,o),s}function bi(e,t){e=fo.rgb(e),t=fo.rgb(t);var n=e.r,i=e.g,r=e.b,a=t.r-n,o=t.g-i,s=t.b-r;return function(e){return"#"+Ce(Math.round(n+a*e))+Ce(Math.round(i+o*e))+Ce(Math.round(r+s*e))}}function wi(e,t){var n,i={},r={};for(n in e)n in t?i[n]=Mi(e[n],t[n]):r[n]=e[n];for(n in t)n in e||(r[n]=t[n]);return function(e){for(n in i)r[n]=i[n](e);return r}}function xi(e,t){return e=+e,t=+t,function(n){return e*(1-n)+t*n}}function ki(e,t){var n,i,r,a=fl.lastIndex=pl.lastIndex=0,o=-1,s=[],l=[];for(e+="",t+="";(n=fl.exec(e))&&(i=pl.exec(t));)(r=i.index)>a&&(r=t.slice(a,r),s[o]?s[o]+=r:s[++o]=r),(n=n[0])===(i=i[0])?s[o]?s[o]+=i:s[++o]=i:(s[++o]=null,l.push({i:o,x:xi(n,i)})),a=pl.lastIndex;return a<t.length&&(r=t.slice(a),s[o]?s[o]+=r:s[++o]=r),s.length<2?l[0]?(t=l[0].x,function(e){return t(e)+""}):function(){return t}:(t=l.length,function(e){for(var n,i=0;i<t;++i)s[(n=l[i]).i]=n.x(e);return s.join("")})}function Mi(e,t){for(var n,i=fo.interpolators.length;--i>=0&&!(n=fo.interpolators[i](e,t)););return n}function Ci(e,t){var n,i=[],r=[],a=e.length,o=t.length,s=Math.min(e.length,t.length);for(n=0;n<s;++n)i.push(Mi(e[n],t[n]));for(;n<a;++n)r[n]=e[n];for(;n<o;++n)r[n]=t[n];return function(e){for(n=0;n<s;++n)r[n]=i[n](e);return r}}function Si(e){return function(t){return t<=0?0:t>=1?1:e(t)}}function Ti(e){return function(t){return 1-e(1-t)}}function Ei(e){return function(t){return.5*(t<.5?e(2*t):2-e(2-2*t))}}function ji(e){return e*e}function Ai(e){return e*e*e}function Ni(e){if(e<=0)return 0;if(e>=1)return 1;var t=e*e,n=t*e;return 4*(e<.5?n:3*(e-t)+n-.75)}function Li(e){return function(t){return Math.pow(t,e)}}function Ii(e){return 1-Math.cos(e*Go)}function Di(e){return Math.pow(2,10*(e-1))}function Oi(e){return 1-Math.sqrt(1-e*e)}function Pi(e,t){var n;return arguments.length<2&&(t=.45),arguments.length?n=t/Yo*Math.asin(1/e):(e=1,n=t/4),function(i){return 1+e*Math.pow(2,-10*i)*Math.sin((i-n)*Yo/t)}}function Wi(e){return e||(e=1.70158),function(t){return t*t*((e+1)*t-e)}}function Ri(e){return e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375}function $i(e,t){e=fo.hcl(e),t=fo.hcl(t);var n=e.h,i=e.c,r=e.l,a=t.h-n,o=t.c-i,s=t.l-r;return isNaN(o)&&(o=0,i=isNaN(i)?t.c:i),isNaN(a)?(a=0,n=isNaN(n)?t.h:n):a>180?a-=360:a<-180&&(a+=360),function(e){return ge(n+a*e,i+o*e,r+s*e)+""}}function zi(e,t){e=fo.hsl(e),t=fo.hsl(t);var n=e.h,i=e.s,r=e.l,a=t.h-n,o=t.s-i,s=t.l-r;return isNaN(o)&&(o=0,i=isNaN(i)?t.s:i),isNaN(a)?(a=0,n=isNaN(n)?t.h:n):a>180?a-=360:a<-180&&(a+=360),function(e){return fe(n+a*e,i+o*e,r+s*e)+""}}function Hi(e,t){e=fo.lab(e),t=fo.lab(t);var n=e.l,i=e.a,r=e.b,a=t.l-n,o=t.a-i,s=t.b-r;return function(e){return _e(n+a*e,i+o*e,r+s*e)+""}}function Vi(e,t){return t-=e,function(n){return Math.round(e+t*n)}}function Yi(e){var t=[e.a,e.b],n=[e.c,e.d],i=Gi(t),r=Fi(t,n),a=Gi(Ui(n,t,-r))||0;t[0]*n[1]<n[0]*t[1]&&(t[0]*=-1,t[1]*=-1,i*=-1,r*=-1),this.rotate=(i?Math.atan2(t[1],t[0]):Math.atan2(-n[0],n[1]))*qo,this.translate=[e.e,e.f],this.scale=[i,a],this.skew=a?Math.atan2(r,a)*qo:0}function Fi(e,t){return e[0]*t[0]+e[1]*t[1]}function Gi(e){var t=Math.sqrt(Fi(e,e));return t&&(e[0]/=t,e[1]/=t),t}function Ui(e,t,n){return e[0]+=n*t[0],e[1]+=n*t[1],e}function qi(e){return e.length?e.pop()+",":""}function Bi(e,t,n,i){if(e[0]!==t[0]||e[1]!==t[1]){var r=n.push("translate(",null,",",null,")");i.push({i:r-4,x:xi(e[0],t[0])},{i:r-2,x:xi(e[1],t[1])})}else(t[0]||t[1])&&n.push("translate("+t+")")}function Ji(e,t,n,i){e!==t?(e-t>180?t+=360:t-e>180&&(e+=360),i.push({i:n.push(qi(n)+"rotate(",null,")")-2,x:xi(e,t)})):t&&n.push(qi(n)+"rotate("+t+")")}function Qi(e,t,n,i){e!==t?i.push({i:n.push(qi(n)+"skewX(",null,")")-2,x:xi(e,t)}):t&&n.push(qi(n)+"skewX("+t+")")}function Xi(e,t,n,i){if(e[0]!==t[0]||e[1]!==t[1]){var r=n.push(qi(n)+"scale(",null,",",null,")");i.push({i:r-4,x:xi(e[0],t[0])},{i:r-2,x:xi(e[1],t[1])})}else 1===t[0]&&1===t[1]||n.push(qi(n)+"scale("+t+")")}function Ki(e,t){var n=[],i=[];return e=fo.transform(e),t=fo.transform(t),Bi(e.translate,t.translate,n,i),Ji(e.rotate,t.rotate,n,i),Qi(e.skew,t.skew,n,i),Xi(e.scale,t.scale,n,i),e=t=null,function(e){for(var t,r=-1,a=i.length;++r<a;)n[(t=i[r]).i]=t.x(e);return n.join("")}}function Zi(e,t){return t=(t-=e=+e)||1/t,function(n){return(n-e)/t}}function er(e,t){return t=(t-=e=+e)||1/t,function(n){return Math.max(0,Math.min(1,(n-e)/t))}}function tr(e){for(var t=e.source,n=e.target,i=ir(t,n),r=[t];t!==i;)t=t.parent,r.push(t);for(var a=r.length;n!==i;)r.splice(a,0,n),n=n.parent;return r}function nr(e){for(var t=[],n=e.parent;null!=n;)t.push(e),e=n,n=n.parent;return t.push(e),t}function ir(e,t){if(e===t)return e;for(var n=nr(e),i=nr(t),r=n.pop(),a=i.pop(),o=null;r===a;)o=r,r=n.pop(),a=i.pop();return o}function rr(e){e.fixed|=2}function ar(e){e.fixed&=-7}function or(e){e.fixed|=4,e.px=e.x,e.py=e.y}function sr(e){e.fixed&=-5}function lr(e,t,n){var i=0,r=0;if(e.charge=0,!e.leaf)for(var a,o=e.nodes,s=o.length,l=-1;++l<s;)null!=(a=o[l])&&(lr(a,t,n),e.charge+=a.charge,i+=a.charge*a.cx,r+=a.charge*a.cy);if(e.point){e.leaf||(e.point.x+=Math.random()-.5,e.point.y+=Math.random()-.5);var c=t*n[e.point.index];e.charge+=e.pointCharge=c,i+=c*e.point.x,r+=c*e.point.y}e.cx=i/e.charge,e.cy=r/e.charge}function cr(e,t){return fo.rebind(e,t,"sort","children","value"),e.nodes=e,e.links=gr,e}function dr(e,t){for(var n=[e];null!=(e=n.pop());)if(t(e),(r=e.children)&&(i=r.length))for(var i,r;--i>=0;)n.push(r[i])}function ur(e,t){for(var n=[e],i=[];null!=(e=n.pop());)if(i.push(e),(a=e.children)&&(r=a.length))for(var r,a,o=-1;++o<r;)n.push(a[o]);for(;null!=(e=i.pop());)t(e)}function hr(e){return e.children}function fr(e){return e.value}function pr(e,t){return t.value-e.value}function gr(e){return fo.merge(e.map(function(e){return(e.children||[]).map(function(t){return{source:e,target:t}})}))}function mr(e){return e.x}function _r(e){return e.y}function vr(e,t,n){e.y0=t,e.y=n}function yr(e){return fo.range(e.length)}function br(e){for(var t=-1,n=e[0].length,i=[];++t<n;)i[t]=0;return i}function wr(e){for(var t,n=1,i=0,r=e[0][1],a=e.length;n<a;++n)(t=e[n][1])>r&&(i=n,r=t);return i}function xr(e){return e.reduce(kr,0)}function kr(e,t){return e+t[1]}function Mr(e,t){return Cr(e,Math.ceil(Math.log(t.length)/Math.LN2+1))}function Cr(e,t){for(var n=-1,i=+e[0],r=(e[1]-i)/t,a=[];++n<=t;)a[n]=r*n+i;return a}function Sr(e){return[fo.min(e),fo.max(e)]}function Tr(e,t){return e.value-t.value}function Er(e,t){var n=e._pack_next;e._pack_next=t,t._pack_prev=e,t._pack_next=n,n._pack_prev=t}function jr(e,t){e._pack_next=t,t._pack_prev=e}function Ar(e,t){var n=t.x-e.x,i=t.y-e.y,r=e.r+t.r;return.999*r*r>n*n+i*i}function Nr(e){function t(e){d=Math.min(e.x-e.r,d),u=Math.max(e.x+e.r,u),h=Math.min(e.y-e.r,h),f=Math.max(e.y+e.r,f)}if((n=e.children)&&(c=n.length)){var n,i,r,a,o,s,l,c,d=1/0,u=-1/0,h=1/0,f=-1/0;if(n.forEach(Lr),i=n[0],i.x=-i.r,i.y=0,t(i),c>1&&(r=n[1],r.x=r.r,r.y=0,t(r),c>2))for(a=n[2],Or(i,r,a),t(a),Er(i,a),i._pack_prev=a,Er(a,r),r=i._pack_next,o=3;o<c;o++){Or(i,r,a=n[o]);var p=0,g=1,m=1;for(s=r._pack_next;s!==r;s=s._pack_next,g++)if(Ar(s,a)){p=1;break}if(1==p)for(l=i._pack_prev;l!==s._pack_prev&&!Ar(l,a);l=l._pack_prev,m++);p?(g<m||g==m&&r.r<i.r?jr(i,r=s):jr(i=l,r),o--):(Er(i,a),r=a,t(a))}var _=(d+u)/2,v=(h+f)/2,y=0;for(o=0;o<c;o++)a=n[o],a.x-=_,a.y-=v,y=Math.max(y,a.r+Math.sqrt(a.x*a.x+a.y*a.y));e.r=y,n.forEach(Ir)}}function Lr(e){e._pack_next=e._pack_prev=e}function Ir(e){delete e._pack_next,delete e._pack_prev}function Dr(e,t,n,i){var r=e.children;if(e.x=t+=i*e.x,e.y=n+=i*e.y,e.r*=i,r)for(var a=-1,o=r.length;++a<o;)Dr(r[a],t,n,i)}function Or(e,t,n){var i=e.r+n.r,r=t.x-e.x,a=t.y-e.y;if(i&&(r||a)){var o=t.r+n.r,s=r*r+a*a;o*=o,i*=i;var l=.5+(i-o)/(2*s),c=Math.sqrt(Math.max(0,2*o*(i+s)-(i-=s)*i-o*o))/(2*s);n.x=e.x+l*r+c*a,n.y=e.y+l*a-c*r}else n.x=e.x+i,n.y=e.y}function Pr(e,t){return e.parent==t.parent?1:2}function Wr(e){var t=e.children;return t.length?t[0]:e.t}function Rr(e){var t,n=e.children;return(t=n.length)?n[t-1]:e.t}function $r(e,t,n){var i=n/(t.i-e.i);t.c-=i,t.s+=n,e.c+=i,t.z+=n,t.m+=n}function zr(e){for(var t,n=0,i=0,r=e.children,a=r.length;--a>=0;)t=r[a],t.z+=n,t.m+=n,n+=t.s+(i+=t.c)}function Hr(e,t,n){return e.a.parent===t.parent?e.a:n}function Vr(e){return 1+fo.max(e,function(e){return e.y})}function Yr(e){return e.reduce(function(e,t){return e+t.x},0)/e.length}function Fr(e){var t=e.children;return t&&t.length?Fr(t[0]):e}function Gr(e){var t,n=e.children;return n&&(t=n.length)?Gr(n[t-1]):e}function Ur(e){return{x:e.x,y:e.y,dx:e.dx,dy:e.dy}}function qr(e,t){var n=e.x+t[3],i=e.y+t[0],r=e.dx-t[1]-t[3],a=e.dy-t[0]-t[2];return r<0&&(n+=r/2,r=0),a<0&&(i+=a/2,a=0),{x:n,y:i,dx:r,dy:a}}function Br(e){var t=e[0],n=e[e.length-1];return t<n?[t,n]:[n,t]}function Jr(e){return e.rangeExtent?e.rangeExtent():Br(e.range())}function Qr(e,t,n,i){var r=n(e[0],e[1]),a=i(t[0],t[1]);return function(e){return a(r(e))}}function Xr(e,t){var n,i=0,r=e.length-1,a=e[i],o=e[r];return o<a&&(n=i,i=r,r=n,n=a,a=o,o=n),e[i]=t.floor(a),e[r]=t.ceil(o),e}function Kr(e){return e?{floor:function(t){return Math.floor(t/e)*e},ceil:function(t){return Math.ceil(t/e)*e}}:Cl}function Zr(e,t,n,i){var r=[],a=[],o=0,s=Math.min(e.length,t.length)-1;for(e[s]<e[0]&&(e=e.slice().reverse(),t=t.slice().reverse());++o<=s;)r.push(n(e[o-1],e[o])),a.push(i(t[o-1],t[o]));return function(t){var n=fo.bisect(e,t,1,s)-1;return a[n](r[n](t))}}function ea(e,t,n,i){function r(){var r=Math.min(e.length,t.length)>2?Zr:Qr,l=i?er:Zi;return o=r(e,t,l,n),s=r(t,e,l,Mi),a}function a(e){return o(e)}var o,s;return a.invert=function(e){return s(e)},a.domain=function(t){return arguments.length?(e=t.map(Number),r()):e},a.range=function(e){return arguments.length?(t=e,r()):t},a.rangeRound=function(e){return a.range(e).interpolate(Vi)},a.clamp=function(e){return arguments.length?(i=e,r()):i},a.interpolate=function(e){return arguments.length?(n=e,r()):n},a.ticks=function(t){return ra(e,t)},a.tickFormat=function(t,n){return aa(e,t,n)},a.nice=function(t){return na(e,t),r()},a.copy=function(){return ea(e,t,n,i)},r()}function ta(e,t){return fo.rebind(e,t,"range","rangeRound","interpolate","clamp")}function na(e,t){return Xr(e,Kr(ia(e,t)[2])),Xr(e,Kr(ia(e,t)[2])),e}function ia(e,t){null==t&&(t=10);var n=Br(e),i=n[1]-n[0],r=Math.pow(10,Math.floor(Math.log(i/t)/Math.LN10)),a=t/i*r;return a<=.15?r*=10:a<=.35?r*=5:a<=.75&&(r*=2),n[0]=Math.ceil(n[0]/r)*r,n[1]=Math.floor(n[1]/r)*r+.5*r,n[2]=r,n}function ra(e,t){return fo.range.apply(fo,ia(e,t))}function aa(e,t,n){var i=ia(e,t);if(n){var r=fs.exec(n);if(r.shift(),"s"===r[8]){var a=fo.formatPrefix(Math.max(ko(i[0]),ko(i[1])));return r[7]||(r[7]="."+oa(a.scale(i[2]))),r[8]="f",n=fo.format(r.join("")),function(e){return n(a.scale(e))+a.symbol}}r[7]||(r[7]="."+sa(r[8],i)),n=r.join("")}else n=",."+oa(i[2])+"f";return fo.format(n)}function oa(e){return-Math.floor(Math.log(e)/Math.LN10+.01)}function sa(e,t){var n=oa(t[2]);return e in Sl?Math.abs(n-oa(Math.max(ko(t[0]),ko(t[1]))))+ +("e"!==e):n-2*("%"===e)}function la(e,t,n,i){function r(e){return(n?Math.log(e<0?0:e):-Math.log(e>0?0:-e))/Math.log(t)}function a(e){return n?Math.pow(t,e):-Math.pow(t,-e)}function o(t){return e(r(t))}return o.invert=function(t){return a(e.invert(t))},o.domain=function(t){return arguments.length?(n=t[0]>=0,e.domain((i=t.map(Number)).map(r)),o):i},o.base=function(n){return arguments.length?(t=+n,e.domain(i.map(r)),o):t},o.nice=function(){var t=Xr(i.map(r),n?Math:El);return e.domain(t),i=t.map(a),o},o.ticks=function(){var e=Br(i),o=[],s=e[0],l=e[1],c=Math.floor(r(s)),d=Math.ceil(r(l)),u=t%1?2:t;if(isFinite(d-c)){if(n){for(;c<d;c++)for(var h=1;h<u;h++)o.push(a(c)*h);o.push(a(c))}else for(o.push(a(c));c++<d;)for(var h=u-1;h>0;h--)o.push(a(c)*h);for(c=0;o[c]<s;c++);for(d=o.length;o[d-1]>l;d--);o=o.slice(c,d)}return o},o.tickFormat=function(e,n){if(!arguments.length)return Tl;arguments.length<2?n=Tl:"function"!=typeof n&&(n=fo.format(n));var i=Math.max(1,t*e/o.ticks().length);return function(e){var o=e/a(Math.round(r(e)));return o*t<t-.5&&(o*=t),o<=i?n(e):""}},o.copy=function(){return la(e.copy(),t,n,i)},ta(o,e)}function ca(e,t,n){function i(t){return e(r(t))}var r=da(t),a=da(1/t);return i.invert=function(t){return a(e.invert(t))},i.domain=function(t){return arguments.length?(e.domain((n=t.map(Number)).map(r)),i):n},i.ticks=function(e){return ra(n,e)},i.tickFormat=function(e,t){return aa(n,e,t)},i.nice=function(e){return i.domain(na(n,e))},i.exponent=function(o){return arguments.length?(r=da(t=o),a=da(1/t),e.domain(n.map(r)),i):t},i.copy=function(){return ca(e.copy(),t,n)},ta(i,e)}function da(e){return function(t){return t<0?-Math.pow(-t,e):Math.pow(t,e)}}function ua(e,t){function n(n){return a[((r.get(n)||("range"===t.t?r.set(n,e.push(n)):NaN))-1)%a.length]}function i(t,n){return fo.range(e.length).map(function(e){return t+n*e})}var r,a,o;return n.domain=function(i){if(!arguments.length)return e;e=[],r=new p;for(var a,o=-1,s=i.length;++o<s;)r.has(a=i[o])||r.set(a,e.push(a));return n[t.t].apply(n,t.a)},n.range=function(e){return arguments.length?(a=e,o=0,t={t:"range",a:arguments},n):a},n.rangePoints=function(r,s){arguments.length<2&&(s=0);var l=r[0],c=r[1],d=e.length<2?(l=(l+c)/2,0):(c-l)/(e.length-1+s);return a=i(l+d*s/2,d),o=0,t={t:"rangePoints",a:arguments},n},n.rangeRoundPoints=function(r,s){arguments.length<2&&(s=0);var l=r[0],c=r[1],d=e.length<2?(l=c=Math.round((l+c)/2),0):(c-l)/(e.length-1+s)|0;return a=i(l+Math.round(d*s/2+(c-l-(e.length-1+s)*d)/2),d),o=0,t={t:"rangeRoundPoints",a:arguments},n},n.rangeBands=function(r,s,l){arguments.length<2&&(s=0),arguments.length<3&&(l=s);var c=r[1]<r[0],d=r[c-0],u=r[1-c],h=(u-d)/(e.length-s+2*l);return a=i(d+h*l,h),c&&a.reverse(),o=h*(1-s),t={t:"rangeBands",a:arguments},n},n.rangeRoundBands=function(r,s,l){arguments.length<2&&(s=0),arguments.length<3&&(l=s);var c=r[1]<r[0],d=r[c-0],u=r[1-c],h=Math.floor((u-d)/(e.length-s+2*l));return a=i(d+Math.round((u-d-(e.length-s)*h)/2),h),c&&a.reverse(),o=Math.round(h*(1-s)),t={t:"rangeRoundBands",a:arguments},n},n.rangeBand=function(){return o},n.rangeExtent=function(){return Br(t.a[0])},n.copy=function(){return ua(e,t)},n.domain(e)}function ha(e,t){function n(){var n=0,a=t.length;for(r=[];++n<a;)r[n-1]=fo.quantile(e,n/a);return i}function i(e){if(!isNaN(e=+e))return t[fo.bisect(r,e)]}var r;return i.domain=function(t){return arguments.length?(e=t.map(l).filter(c).sort(s),n()):e},i.range=function(e){return arguments.length?(t=e,n()):t},i.quantiles=function(){return r},i.invertExtent=function(n){return n=t.indexOf(n),n<0?[NaN,NaN]:[n>0?r[n-1]:e[0],n<r.length?r[n]:e[e.length-1]]},i.copy=function(){return ha(e,t)},n()}function fa(e,t,n){function i(t){return n[Math.max(0,Math.min(o,Math.floor(a*(t-e))))]}function r(){return a=n.length/(t-e),o=n.length-1,i}var a,o;return i.domain=function(n){return arguments.length?(e=+n[0],t=+n[n.length-1],r()):[e,t]},i.range=function(e){return arguments.length?(n=e,r()):n},i.invertExtent=function(t){return t=n.indexOf(t),t=t<0?NaN:t/a+e,[t,t+1/a]},i.copy=function(){return fa(e,t,n)},r()}function pa(e,t){function n(n){if(n<=n)return t[fo.bisect(e,n)]}return n.domain=function(t){return arguments.length?(e=t,n):e},n.range=function(e){return arguments.length?(t=e,n):t},n.invertExtent=function(n){return n=t.indexOf(n),[e[n-1],e[n]]},n.copy=function(){return pa(e,t)},n}function ga(e){function t(e){return+e}return t.invert=t,t.domain=t.range=function(n){return arguments.length?(e=n.map(t),t):e},t.ticks=function(t){return ra(e,t)},t.tickFormat=function(t,n){return aa(e,t,n)},t.copy=function(){return ga(e)},t}function ma(){return 0}function _a(e){return e.innerRadius}function va(e){return e.outerRadius}function ya(e){return e.startAngle}function ba(e){return e.endAngle}function wa(e){return e&&e.padAngle}function xa(e,t,n,i){return(e-n)*t-(t-i)*e>0?0:1}function ka(e,t,n,i,r){var a=e[0]-t[0],o=e[1]-t[1],s=(r?i:-i)/Math.sqrt(a*a+o*o),l=s*o,c=-s*a,d=e[0]+l,u=e[1]+c,h=t[0]+l,f=t[1]+c,p=(d+h)/2,g=(u+f)/2,m=h-d,_=f-u,v=m*m+_*_,y=n-i,b=d*f-h*u,w=(_<0?-1:1)*Math.sqrt(Math.max(0,y*y*v-b*b)),x=(b*_-m*w)/v,k=(-b*m-_*w)/v,M=(b*_+m*w)/v,C=(-b*m+_*w)/v,S=x-p,T=k-g,E=M-p,j=C-g;return S*S+T*T>E*E+j*j&&(x=M,k=C),[[x-l,k-c],[x*n/y,k*n/y]]}function Ma(e){function t(t){function o(){c.push("M",a(e(d),s))}for(var l,c=[],d=[],u=-1,h=t.length,f=Ne(n),p=Ne(i);++u<h;)r.call(this,l=t[u],u)?d.push([+f.call(this,l,u),+p.call(this,l,u)]):d.length&&(o(),d=[]);return d.length&&o(),c.length?c.join(""):null}var n=Dn,i=On,r=Dt,a=Ca,o=a.key,s=.7;return t.x=function(e){return arguments.length?(n=e,t):n},t.y=function(e){return arguments.length?(i=e,t):i},t.defined=function(e){return arguments.length?(r=e,t):r},t.interpolate=function(e){return arguments.length?(o="function"==typeof e?a=e:(a=Dl.get(e)||Ca).key,t):o},t.tension=function(e){return arguments.length?(s=e,t):s},t}function Ca(e){return e.length>1?e.join("L"):e+"Z"}function Sa(e){return e.join("L")+"Z"}function Ta(e){for(var t=0,n=e.length,i=e[0],r=[i[0],",",i[1]];++t<n;)r.push("H",(i[0]+(i=e[t])[0])/2,"V",i[1]);return n>1&&r.push("H",i[0]),r.join("")}function Ea(e){for(var t=0,n=e.length,i=e[0],r=[i[0],",",i[1]];++t<n;)r.push("V",(i=e[t])[1],"H",i[0]);return r.join("")}function ja(e){for(var t=0,n=e.length,i=e[0],r=[i[0],",",i[1]];++t<n;)r.push("H",(i=e[t])[0],"V",i[1]);return r.join("")}function Aa(e,t){return e.length<4?Ca(e):e[1]+Ia(e.slice(1,-1),Da(e,t))}function Na(e,t){return e.length<3?Sa(e):e[0]+Ia((e.push(e[0]),e),Da([e[e.length-2]].concat(e,[e[1]]),t))}function La(e,t){return e.length<3?Ca(e):e[0]+Ia(e,Da(e,t))}function Ia(e,t){if(t.length<1||e.length!=t.length&&e.length!=t.length+2)return Ca(e);var n=e.length!=t.length,i="",r=e[0],a=e[1],o=t[0],s=o,l=1;if(n&&(i+="Q"+(a[0]-2*o[0]/3)+","+(a[1]-2*o[1]/3)+","+a[0]+","+a[1],r=e[1],l=2),t.length>1){s=t[1],a=e[l],l++,i+="C"+(r[0]+o[0])+","+(r[1]+o[1])+","+(a[0]-s[0])+","+(a[1]-s[1])+","+a[0]+","+a[1];for(var c=2;c<t.length;c++,l++)a=e[l],s=t[c],i+="S"+(a[0]-s[0])+","+(a[1]-s[1])+","+a[0]+","+a[1]}if(n){var d=e[l];i+="Q"+(a[0]+2*s[0]/3)+","+(a[1]+2*s[1]/3)+","+d[0]+","+d[1]}return i}function Da(e,t){for(var n,i=[],r=(1-t)/2,a=e[0],o=e[1],s=1,l=e.length;++s<l;)n=a,a=o,o=e[s],i.push([r*(o[0]-n[0]),r*(o[1]-n[1])]);return i}function Oa(e){if(e.length<3)return Ca(e);var t=1,n=e.length,i=e[0],r=i[0],a=i[1],o=[r,r,r,(i=e[1])[0]],s=[a,a,a,i[1]],l=[r,",",a,"L",$a(Wl,o),",",$a(Wl,s)];for(e.push(e[n-1]);++t<=n;)i=e[t],o.shift(),o.push(i[0]),s.shift(),s.push(i[1]),za(l,o,s);return e.pop(),l.push("L",i),l.join("")}function Pa(e){if(e.length<4)return Ca(e);for(var t,n=[],i=-1,r=e.length,a=[0],o=[0];++i<3;)t=e[i],a.push(t[0]),o.push(t[1]);for(n.push($a(Wl,a)+","+$a(Wl,o)),--i;++i<r;)t=e[i],a.shift(),a.push(t[0]),o.shift(),o.push(t[1]),za(n,a,o);return n.join("")}function Wa(e){for(var t,n,i=-1,r=e.length,a=r+4,o=[],s=[];++i<4;)n=e[i%r],o.push(n[0]),s.push(n[1]);for(t=[$a(Wl,o),",",$a(Wl,s)],--i;++i<a;)n=e[i%r],o.shift(),o.push(n[0]),s.shift(),s.push(n[1]),za(t,o,s);return t.join("")}function Ra(e,t){var n=e.length-1;if(n)for(var i,r,a=e[0][0],o=e[0][1],s=e[n][0]-a,l=e[n][1]-o,c=-1;++c<=n;)i=e[c],r=c/n,i[0]=t*i[0]+(1-t)*(a+r*s),i[1]=t*i[1]+(1-t)*(o+r*l);return Oa(e)}function $a(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]}function za(e,t,n){e.push("C",$a(Ol,t),",",$a(Ol,n),",",$a(Pl,t),",",$a(Pl,n),",",$a(Wl,t),",",$a(Wl,n))}function Ha(e,t){return(t[1]-e[1])/(t[0]-e[0])}function Va(e){for(var t=0,n=e.length-1,i=[],r=e[0],a=e[1],o=i[0]=Ha(r,a);++t<n;)i[t]=(o+(o=Ha(r=a,a=e[t+1])))/2;return i[t]=o,i}function Ya(e){for(var t,n,i,r,a=[],o=Va(e),s=-1,l=e.length-1;++s<l;)t=Ha(e[s],e[s+1]),ko(t)<zo?o[s]=o[s+1]=0:(n=o[s]/t,i=o[s+1]/t,(r=n*n+i*i)>9&&(r=3*t/Math.sqrt(r),o[s]=r*n,o[s+1]=r*i));for(s=-1;++s<=l;)r=(e[Math.min(l,s+1)][0]-e[Math.max(0,s-1)][0])/(6*(1+o[s]*o[s])),a.push([r||0,o[s]*r||0]);return a}function Fa(e){return e.length<3?Ca(e):e[0]+Ia(e,Ya(e))}function Ga(e){for(var t,n,i,r=-1,a=e.length;++r<a;)t=e[r],n=t[0],i=t[1]-Go,t[0]=n*Math.cos(i),t[1]=n*Math.sin(i);return e}function Ua(e){function t(t){function l(){g.push("M",s(e(_),u),d,c(e(m.reverse()),u),"Z")}for(var h,f,p,g=[],m=[],_=[],v=-1,y=t.length,b=Ne(n),w=Ne(r),x=n===i?function(){return f}:Ne(i),k=r===a?function(){return p}:Ne(a);++v<y;)o.call(this,h=t[v],v)?(m.push([f=+b.call(this,h,v),p=+w.call(this,h,v)]),_.push([+x.call(this,h,v),+k.call(this,h,v)])):m.length&&(l(),m=[],_=[]);return m.length&&l(),g.length?g.join(""):null}var n=Dn,i=Dn,r=0,a=On,o=Dt,s=Ca,l=s.key,c=s,d="L",u=.7;return t.x=function(e){return arguments.length?(n=i=e,t):i},t.x0=function(e){return arguments.length?(n=e,t):n},t.x1=function(e){return arguments.length?(i=e,t):i},t.y=function(e){return arguments.length?(r=a=e,t):a},t.y0=function(e){return arguments.length?(r=e,t):r},t.y1=function(e){return arguments.length?(a=e,t):a},t.defined=function(e){return arguments.length?(o=e,t):o},t.interpolate=function(e){return arguments.length?(l="function"==typeof e?s=e:(s=Dl.get(e)||Ca).key,c=s.reverse||s,d=s.closed?"M":"L",t):l},t.tension=function(e){return arguments.length?(u=e,t):u},t}function qa(e){return e.radius}function Ba(e){return[e.x,e.y]}function Ja(e){return function(){var t=e.apply(this,arguments),n=t[0],i=t[1]-Go;return[n*Math.cos(i),n*Math.sin(i)]}}function Qa(){return 64}function Xa(){return"circle"}function Ka(e){var t=Math.sqrt(e/Vo);return"M0,"+t+"A"+t+","+t+" 0 1,1 0,"+-t+"A"+t+","+t+" 0 1,1 0,"+t+"Z"}function Za(e){return function(){var t,n,i;(t=this[e])&&(i=t[n=t.active])&&(i.timer.c=null,i.timer.t=NaN,--t.count?delete t[n]:delete this[e],t.active+=.5,i.event&&i.event.interrupt.call(this,this.__data__,i.index))}}function eo(e,t,n){return Eo(e,Fl),e.namespace=t,e.id=n,e}function to(e,t,n,i){var r=e.id,a=e.namespace;return B(e,"function"==typeof n?function(e,o,s){e[a][r].tween.set(t,i(n.call(e,e.__data__,o,s)))}:(n=i(n),function(e){e[a][r].tween.set(t,n)}))}function no(e){return null==e&&(e=""),function(){this.textContent=e}}function io(e){return null==e?"__transition__":"__transition_"+e+"__"}function ro(e,t,n,i,r){function a(e){var t=g.delay;if(c.t=t+l,t<=e)return o(e-t);c.c=o}function o(n){var r=f.active,a=f[r];a&&(a.timer.c=null,a.timer.t=NaN,--f.count,delete f[r],a.event&&a.event.interrupt.call(e,e.__data__,a.index));for(var o in f)if(+o<i){var p=f[o];p.timer.c=null,p.timer.t=NaN,--f.count,delete f[o]}c.c=s,Pe(function(){return c.c&&s(n||1)&&(c.c=null,c.t=NaN),1},0,l),f.active=i,g.event&&g.event.start.call(e,e.__data__,t),h=[],g.tween.forEach(function(n,i){(i=i.call(e,e.__data__,t))&&h.push(i)}),u=g.ease,d=g.duration}function s(r){for(var a=r/d,o=u(a),s=h.length;s>0;)h[--s].call(e,o);if(a>=1)return g.event&&g.event.end.call(e,e.__data__,t),--f.count?delete f[i]:delete e[n],1}var l,c,d,u,h,f=e[n]||(e[n]={active:0,count:0}),g=f[i];g||(l=r.time,c=Pe(a,0,l),g=f[i]={tween:new p,time:l,timer:c,delay:r.delay,duration:r.duration,ease:r.ease,index:t},r=null,++f.count)}function ao(e,t,n){e.attr("transform",function(e){var i=t(e);return"translate("+(isFinite(i)?i:n(e))+",0)"})}function oo(e,t,n){e.attr("transform",function(e){var i=t(e);return"translate(0,"+(isFinite(i)?i:n(e))+")"})}function so(e){return e.toISOString()}function lo(e,t,n){function i(t){return e(t)}function r(e,n){var i=e[1]-e[0],r=i/n,a=fo.bisect(Zl,r);return a==Zl.length?[t.year,ia(e.map(function(e){return e/31536e6}),n)[2]]:a?t[r/Zl[a-1]<Zl[a]/r?a-1:a]:[nc,ia(e,n)[2]]}return i.invert=function(t){return co(e.invert(t))},i.domain=function(t){return arguments.length?(e.domain(t),i):e.domain().map(co)},i.nice=function(e,t){function n(n){return!isNaN(n)&&!e.range(n,co(+n+1),t).length}var a=i.domain(),o=Br(a),s=null==e?r(o,10):"number"==typeof e&&r(o,e);return s&&(e=s[0],t=s[1]),i.domain(Xr(a,t>1?{floor:function(t){for(;n(t=e.floor(t));)t=co(t-1);return t},ceil:function(t){for(;n(t=e.ceil(t));)t=co(+t+1);return t}}:e))},i.ticks=function(e,t){var n=Br(i.domain()),a=null==e?r(n,10):"number"==typeof e?r(n,e):!e.range&&[{range:e},t];return a&&(e=a[0],t=a[1]),e.range(n[0],co(+n[1]+1),t<1?1:t)},i.tickFormat=function(){return n},i.copy=function(){return lo(e.copy(),t,n)},ta(i,e)}function co(e){return new Date(e)}function uo(e){return JSON.parse(e.responseText)}function ho(e){var t=mo.createRange();return t.selectNode(mo.body),t.createContextualFragment(e.responseText)}var fo={version:"3.5.17"},po=[].slice,go=function(e){return po.call(e)},mo=this.document;if(mo)try{go(mo.documentElement.childNodes)[0].nodeType}catch(e){go=function(e){for(var t=e.length,n=new Array(t);t--;)n[t]=e[t];return n}}if(Date.now||(Date.now=function(){return+new Date}),mo)try{mo.createElement("DIV").style.setProperty("opacity",0,"")}catch(e){var _o=this.Element.prototype,vo=_o.setAttribute,yo=_o.setAttributeNS,bo=this.CSSStyleDeclaration.prototype,wo=bo.setProperty;_o.setAttribute=function(e,t){vo.call(this,e,t+"")},_o.setAttributeNS=function(e,t,n){yo.call(this,e,t,n+"")},bo.setProperty=function(e,t,n){wo.call(this,e,t+"",n)}}fo.ascending=s,fo.descending=function(e,t){return t<e?-1:t>e?1:t>=e?0:NaN},fo.min=function(e,t){var n,i,r=-1,a=e.length;if(1===arguments.length){for(;++r<a;)if(null!=(i=e[r])&&i>=i){n=i;break}for(;++r<a;)null!=(i=e[r])&&n>i&&(n=i)}else{for(;++r<a;)if(null!=(i=t.call(e,e[r],r))&&i>=i){n=i;break}for(;++r<a;)null!=(i=t.call(e,e[r],r))&&n>i&&(n=i)}return n},fo.max=function(e,t){var n,i,r=-1,a=e.length;if(1===arguments.length){for(;++r<a;)if(null!=(i=e[r])&&i>=i){n=i;break}for(;++r<a;)null!=(i=e[r])&&i>n&&(n=i)}else{for(;++r<a;)if(null!=(i=t.call(e,e[r],r))&&i>=i){n=i;break}for(;++r<a;)null!=(i=t.call(e,e[r],r))&&i>n&&(n=i)}return n},fo.extent=function(e,t){var n,i,r,a=-1,o=e.length;if(1===arguments.length){for(;++a<o;)if(null!=(i=e[a])&&i>=i){n=r=i;break}for(;++a<o;)null!=(i=e[a])&&(n>i&&(n=i),r<i&&(r=i))}else{for(;++a<o;)if(null!=(i=t.call(e,e[a],a))&&i>=i){n=r=i;break}for(;++a<o;)null!=(i=t.call(e,e[a],a))&&(n>i&&(n=i),r<i&&(r=i))}return[n,r]},fo.sum=function(e,t){var n,i=0,r=e.length,a=-1;if(1===arguments.length)for(;++a<r;)c(n=+e[a])&&(i+=n);else for(;++a<r;)c(n=+t.call(e,e[a],a))&&(i+=n);return i},fo.mean=function(e,t){var n,i=0,r=e.length,a=-1,o=r;if(1===arguments.length)for(;++a<r;)c(n=l(e[a]))?i+=n:--o;else for(;++a<r;)c(n=l(t.call(e,e[a],a)))?i+=n:--o;if(o)return i/o},fo.quantile=function(e,t){var n=(e.length-1)*t+1,i=Math.floor(n),r=+e[i-1],a=n-i;return a?r+a*(e[i]-r):r},fo.median=function(e,t){var n,i=[],r=e.length,a=-1;if(1===arguments.length)for(;++a<r;)c(n=l(e[a]))&&i.push(n);else for(;++a<r;)c(n=l(t.call(e,e[a],a)))&&i.push(n);if(i.length)return fo.quantile(i.sort(s),.5)},fo.variance=function(e,t){var n,i,r=e.length,a=0,o=0,s=-1,d=0;if(1===arguments.length)for(;++s<r;)c(n=l(e[s]))&&(i=n-a,a+=i/++d,o+=i*(n-a));else for(;++s<r;)c(n=l(t.call(e,e[s],s)))&&(i=n-a,a+=i/++d,o+=i*(n-a));if(d>1)return o/(d-1)},fo.deviation=function(){var e=fo.variance.apply(this,arguments);return e?Math.sqrt(e):e};var xo=d(s);fo.bisectLeft=xo.left,fo.bisect=fo.bisectRight=xo.right,fo.bisector=function(e){return d(1===e.length?function(t,n){return s(e(t),n)}:e)},fo.shuffle=function(e,t,n){(a=arguments.length)<3&&(n=e.length,a<2&&(t=0));for(var i,r,a=n-t;a;)r=Math.random()*a--|0,i=e[a+t],e[a+t]=e[r+t],e[r+t]=i;return e},fo.permute=function(e,t){for(var n=t.length,i=new Array(n);n--;)i[n]=e[t[n]];return i},fo.pairs=function(e){for(var t=0,n=e.length-1,i=e[0],r=new Array(n<0?0:n);t<n;)r[t]=[i,i=e[++t]];return r},fo.transpose=function(e){if(!(r=e.length))return[];for(var t=-1,n=fo.min(e,u),i=new Array(n);++t<n;)for(var r,a=-1,o=i[t]=new Array(r);++a<r;)o[a]=e[a][t];return i},fo.zip=function(){return fo.transpose(arguments)},fo.keys=function(e){var t=[];for(var n in e)t.push(n);return t},fo.values=function(e){var t=[];for(var n in e)t.push(e[n]);return t},fo.entries=function(e){var t=[];for(var n in e)t.push({key:n,value:e[n]});return t},fo.merge=function(e){for(var t,n,i,r=e.length,a=-1,o=0;++a<r;)o+=e[a].length;for(n=new Array(o);--r>=0;)for(i=e[r],t=i.length;--t>=0;)n[--o]=i[t];return n};var ko=Math.abs;fo.range=function(e,t,n){if(arguments.length<3&&(n=1,arguments.length<2&&(t=e,e=0)),(t-e)/n==1/0)throw new Error("infinite range");var i,r=[],a=h(ko(n)),o=-1;if(e*=a,t*=a,n*=a,n<0)for(;(i=e+n*++o)>t;)r.push(i/a);else for(;(i=e+n*++o)<t;)r.push(i/a);return r},fo.map=function(e,t){var n=new p;if(e instanceof p)e.forEach(function(e,t){n.set(e,t)});else if(Array.isArray(e)){var i,r=-1,a=e.length;if(1===arguments.length)for(;++r<a;)n.set(r,e[r]);else for(;++r<a;)n.set(t.call(e,i=e[r],r),i)}else for(var o in e)n.set(o,e[o]);return n};var Mo="__proto__",Co="\0";f(p,{has:_,get:function(e){return this._[g(e)]},set:function(e,t){return this._[g(e)]=t},remove:v,keys:y,values:function(){var e=[];for(var t in this._)e.push(this._[t]);return e},entries:function(){var e=[];for(var t in this._)e.push({key:m(t),value:this._[t]});return e},size:b,empty:w,forEach:function(e){for(var t in this._)e.call(this,m(t),this._[t])}}),fo.nest=function(){function e(t,o,s){if(s>=a.length)return i?i.call(r,o):n?o.sort(n):o;for(var l,c,d,u,h=-1,f=o.length,g=a[s++],m=new p;++h<f;)(u=m.get(l=g(c=o[h])))?u.push(c):m.set(l,[c]);return t?(c=t(),d=function(n,i){c.set(n,e(t,i,s))}):(c={},d=function(n,i){c[n]=e(t,i,s)}),m.forEach(d),c}function t(e,n){if(n>=a.length)return e;var i=[],r=o[n++];return e.forEach(function(e,r){i.push({key:e,values:t(r,n)})}),r?i.sort(function(e,t){return r(e.key,t.key)}):i}var n,i,r={},a=[],o=[];return r.map=function(t,n){return e(n,t,0)},r.entries=function(n){return t(e(fo.map,n,0),0)},r.key=function(e){return a.push(e),r},r.sortKeys=function(e){return o[a.length-1]=e,r},r.sortValues=function(e){return n=e,r},r.rollup=function(e){return i=e,r},r},fo.set=function(e){var t=new x;if(e)for(var n=0,i=e.length;n<i;++n)t.add(e[n]);return t},f(x,{has:_,add:function(e){return this._[g(e+="")]=!0,e},remove:v,values:y,size:b,empty:w,forEach:function(e){for(var t in this._)e.call(this,m(t))}}),fo.behavior={},fo.rebind=function(e,t){for(var n,i=1,r=arguments.length;++i<r;)e[n=arguments[i]]=M(e,t,t[n]);return e};var So=["webkit","ms","moz","Moz","o","O"];fo.dispatch=function(){for(var e=new T,t=-1,n=arguments.length;++t<n;)e[arguments[t]]=E(e);return e},T.prototype.on=function(e,t){var n=e.indexOf("."),i="";if(n>=0&&(i=e.slice(n+1),e=e.slice(0,n)),e)return arguments.length<2?this[e].on(i):this[e].on(i,t);if(2===arguments.length){if(null==t)for(e in this)this.hasOwnProperty(e)&&this[e].on(i,null);return this}},fo.event=null,fo.requote=function(e){return e.replace(To,"\\$&")};var To=/[\\\^\$\*\+\?\|\[\]\(\)\.\{\}]/g,Eo={}.__proto__?function(e,t){e.__proto__=t}:function(e,t){for(var n in t)e[n]=t[n]},jo=function(e,t){return t.querySelector(e)},Ao=function(e,t){return t.querySelectorAll(e)},No=function(e,t){var n=e.matches||e[C(e,"matchesSelector")];return(No=function(e,t){return n.call(e,t)})(e,t)};"function"==typeof Sizzle&&(jo=function(e,t){return Sizzle(e,t)[0]||null},Ao=Sizzle,No=Sizzle.matchesSelector),fo.selection=function(){return fo.select(mo.documentElement)};var Lo=fo.selection.prototype=[];Lo.select=function(e){var t,n,i,r,a=[];e=I(e);for(var o=-1,s=this.length;++o<s;){a.push(t=[]),t.parentNode=(i=this[o]).parentNode;for(var l=-1,c=i.length;++l<c;)(r=i[l])?(t.push(n=e.call(r,r.__data__,l,o)),n&&"__data__"in r&&(n.__data__=r.__data__)):t.push(null)}return L(a)},Lo.selectAll=function(e){var t,n,i=[];e=D(e);for(var r=-1,a=this.length;++r<a;)for(var o=this[r],s=-1,l=o.length;++s<l;)(n=o[s])&&(i.push(t=go(e.call(n,n.__data__,s,r))),t.parentNode=n);return L(i)};var Io="http://www.w3.org/1999/xhtml",Do={svg:"http://www.w3.org/2000/svg",xhtml:Io,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};fo.ns={prefix:Do,qualify:function(e){var t=e.indexOf(":"),n=e;return t>=0&&"xmlns"!==(n=e.slice(0,t))&&(e=e.slice(t+1)),Do.hasOwnProperty(n)?{space:Do[n],local:e}:e}},Lo.attr=function(e,t){if(arguments.length<2){if("string"==typeof e){var n=this.node();return e=fo.ns.qualify(e),e.local?n.getAttributeNS(e.space,e.local):n.getAttribute(e)}for(t in e)this.each(O(t,e[t]));return this}return this.each(O(e,t))},Lo.classed=function(e,t){if(arguments.length<2){if("string"==typeof e){var n=this.node(),i=(e=R(e)).length,r=-1;if(t=n.classList){for(;++r<i;)if(!t.contains(e[r]))return!1}else for(t=n.getAttribute("class");++r<i;)if(!W(e[r]).test(t))return!1;return!0}for(t in e)this.each($(t,e[t]));return this}return this.each($(e,t))},Lo.style=function(e,t,n){var i=arguments.length;if(i<3){if("string"!=typeof e){i<2&&(t="");for(n in e)this.each(H(n,e[n],t));return this}if(i<2){var r=this.node();return o(r).getComputedStyle(r,null).getPropertyValue(e)}n=""}return this.each(H(e,t,n))},Lo.property=function(e,t){if(arguments.length<2){if("string"==typeof e)return this.node()[e];for(t in e)this.each(V(t,e[t]));return this}return this.each(V(e,t))},Lo.text=function(e){return arguments.length?this.each("function"==typeof e?function(){var t=e.apply(this,arguments);this.textContent=null==t?"":t}:null==e?function(){this.textContent=""}:function(){this.textContent=e}):this.node().textContent},Lo.html=function(e){return arguments.length?this.each("function"==typeof e?function(){var t=e.apply(this,arguments);this.innerHTML=null==t?"":t}:null==e?function(){this.innerHTML=""}:function(){this.innerHTML=e}):this.node().innerHTML},Lo.append=function(e){return e=Y(e),this.select(function(){return this.appendChild(e.apply(this,arguments))})},Lo.insert=function(e,t){return e=Y(e),t=I(t),this.select(function(){return this.insertBefore(e.apply(this,arguments),t.apply(this,arguments)||null)})},Lo.remove=function(){return this.each(F)},Lo.data=function(e,t){function n(e,n){var i,r,a,o=e.length,d=n.length,u=Math.min(o,d),h=new Array(d),f=new Array(d),g=new Array(o);if(t){var m,_=new p,v=new Array(o);for(i=-1;++i<o;)(r=e[i])&&(_.has(m=t.call(r,r.__data__,i))?g[i]=r:_.set(m,r),v[i]=m);for(i=-1;++i<d;)(r=_.get(m=t.call(n,a=n[i],i)))?!0!==r&&(h[i]=r,r.__data__=a):f[i]=G(a),_.set(m,!0);for(i=-1;++i<o;)i in v&&!0!==_.get(v[i])&&(g[i]=e[i])}else{for(i=-1;++i<u;)r=e[i],a=n[i],r?(r.__data__=a,h[i]=r):f[i]=G(a);for(;i<d;++i)f[i]=G(n[i]);for(;i<o;++i)g[i]=e[i]}f.update=h,f.parentNode=h.parentNode=g.parentNode=e.parentNode,s.push(f),l.push(h),c.push(g)}var i,r,a=-1,o=this.length;if(!arguments.length){for(e=new Array(o=(i=this[0]).length);++a<o;)(r=i[a])&&(e[a]=r.__data__);return e}var s=J([]),l=L([]),c=L([]);if("function"==typeof e)for(;++a<o;)n(i=this[a],e.call(i,i.parentNode.__data__,a));else for(;++a<o;)n(i=this[a],e);return l.enter=function(){return s},l.exit=function(){return c},l},Lo.datum=function(e){return arguments.length?this.property("__data__",e):this.property("__data__")},Lo.filter=function(e){var t,n,i,r=[];"function"!=typeof e&&(e=U(e));for(var a=0,o=this.length;a<o;a++){r.push(t=[]),t.parentNode=(n=this[a]).parentNode;for(var s=0,l=n.length;s<l;s++)(i=n[s])&&e.call(i,i.__data__,s,a)&&t.push(i)}return L(r)},Lo.order=function(){for(var e=-1,t=this.length;++e<t;)for(var n,i=this[e],r=i.length-1,a=i[r];--r>=0;)(n=i[r])&&(a&&a!==n.nextSibling&&a.parentNode.insertBefore(n,a),a=n);return this},Lo.sort=function(e){e=q.apply(this,arguments);for(var t=-1,n=this.length;++t<n;)this[t].sort(e);return this.order()},Lo.each=function(e){return B(this,function(t,n,i){e.call(t,t.__data__,n,i)})},Lo.call=function(e){var t=go(arguments);return e.apply(t[0]=this,t),this},Lo.empty=function(){return!this.node()},Lo.node=function(){for(var e=0,t=this.length;e<t;e++)for(var n=this[e],i=0,r=n.length;i<r;i++){var a=n[i];if(a)return a}return null},Lo.size=function(){var e=0;return B(this,function(){++e}),e};var Oo=[];fo.selection.enter=J,fo.selection.enter.prototype=Oo,Oo.append=Lo.append,Oo.empty=Lo.empty,Oo.node=Lo.node,Oo.call=Lo.call,Oo.size=Lo.size,Oo.select=function(e){for(var t,n,i,r,a,o=[],s=-1,l=this.length;++s<l;){i=(r=this[s]).update,o.push(t=[]),t.parentNode=r.parentNode;for(var c=-1,d=r.length;++c<d;)(a=r[c])?(t.push(i[c]=n=e.call(r.parentNode,a.__data__,c,s)),n.__data__=a.__data__):t.push(null)}return L(o)},Oo.insert=function(e,t){return arguments.length<2&&(t=Q(this)),Lo.insert.call(this,e,t)},fo.select=function(e){var t;return"string"==typeof e?(t=[jo(e,mo)],t.parentNode=mo.documentElement):(t=[e],t.parentNode=a(e)),L([t])},fo.selectAll=function(e){var t;return"string"==typeof e?(t=go(Ao(e,mo)),t.parentNode=mo.documentElement):(t=go(e),t.parentNode=null),L([t])},Lo.on=function(e,t,n){var i=arguments.length;if(i<3){if("string"!=typeof e){i<2&&(t=!1);for(n in e)this.each(X(n,e[n],t));return this}if(i<2)return(i=this.node()["__on"+e])&&i._;n=!1}return this.each(X(e,t,n))};var Po=fo.map({mouseenter:"mouseover",mouseleave:"mouseout"});mo&&Po.forEach(function(e){"on"+e in mo&&Po.remove(e)});var Wo,Ro=0;fo.mouse=function(e){return te(e,A())};var $o=this.navigator&&/WebKit/.test(this.navigator.userAgent)?-1:0;fo.touch=function(e,t,n){if(arguments.length<3&&(n=t,t=A().changedTouches),t)for(var i,r=0,a=t.length;r<a;++r)if((i=t[r]).identifier===n)return te(e,i)},fo.behavior.drag=function(){function e(){this.on("mousedown.drag",r).on("touchstart.drag",a)}function t(e,t,r,a,o){return function(){function s(){var e,n,i=t(h,g);i&&(e=i[0]-y[0],n=i[1]-y[1],p|=e|n,y=i,f({type:"drag",x:i[0]+c[0],y:i[1]+c[1],dx:e,dy:n}))}function l(){t(h,g)&&(_.on(a+m,null).on(o+m,null),v(p),f({type:"dragend"}))}var c,d=this,u=fo.event.target.correspondingElement||fo.event.target,h=d.parentNode,f=n.of(d,arguments),p=0,g=e(),m=".drag"+(null==g?"":"-"+g),_=fo.select(r(u)).on(a+m,s).on(o+m,l),v=ee(u),y=t(h,g);i?(c=i.apply(d,arguments),c=[c.x-y[0],c.y-y[1]]):c=[0,0],f({type:"dragstart"})}}var n=N(e,"drag","dragstart","dragend"),i=null,r=t(S,fo.mouse,o,"mousemove","mouseup"),a=t(ne,fo.touch,k,"touchmove","touchend");return e.origin=function(t){return arguments.length?(i=t,e):i},fo.rebind(e,n,"on")},fo.touches=function(e,t){return arguments.length<2&&(t=A().touches),t?go(t).map(function(t){var n=te(e,t);return n.identifier=t.identifier,n}):[]};var zo=1e-6,Ho=zo*zo,Vo=Math.PI,Yo=2*Vo,Fo=Yo-zo,Go=Vo/2,Uo=Vo/180,qo=180/Vo,Bo=Math.SQRT2;fo.interpolateZoom=function(e,t){var n,i,r=e[0],a=e[1],o=e[2],s=t[0],l=t[1],c=t[2],d=s-r,u=l-a,h=d*d+u*u;if(h<Ho)i=Math.log(c/o)/Bo,n=function(e){return[r+e*d,a+e*u,o*Math.exp(Bo*e*i)]};else{var f=Math.sqrt(h),p=(c*c-o*o+4*h)/(2*o*2*f),g=(c*c-o*o-4*h)/(2*c*2*f),m=Math.log(Math.sqrt(p*p+1)-p),_=Math.log(Math.sqrt(g*g+1)-g);i=(_-m)/Bo,n=function(e){var t=e*i,n=le(m),s=o/(2*f)*(n*ce(Bo*t+m)-se(m));return[r+s*d,a+s*u,o*n/le(Bo*t+m)]}}return n.duration=1e3*i,n},fo.behavior.zoom=function(){function e(e){e.on(A,u).on(Qo+".zoom",f).on("dblclick.zoom",p).on(D,h)}function t(e){return[(e[0]-M.x)/M.k,(e[1]-M.y)/M.k]}function n(e){return[e[0]*M.k+M.x,e[1]*M.k+M.y]}function i(e){M.k=Math.max(S[0],Math.min(S[1],e))}function r(e,t){t=n(t),M.x+=e[0]-t[0],M.y+=e[1]-t[1]}function a(t,n,a,o){t.__chart__={x:M.x,y:M.y,k:M.k},i(Math.pow(2,o)),r(m=n,a),t=fo.select(t),T>0&&(t=t.transition().duration(T)),t.call(e.event)}function s(){w&&w.domain(b.range().map(function(e){return(e-M.x)/M.k}).map(b.invert)),k&&k.domain(x.range().map(function(e){return(e-M.y)/M.k}).map(x.invert))}function l(e){E++||e({type:"zoomstart"})}function c(e){s(),e({type:"zoom",scale:M.k,translate:[M.x,M.y]})}function d(e){--E||(e({type:"zoomend"}),m=null)}function u(){function e(){s=1,r(fo.mouse(i),h),c(a)}function n(){u.on(L,null).on(I,null),f(s),d(a)}var i=this,a=O.of(i,arguments),s=0,u=fo.select(o(i)).on(L,e).on(I,n),h=t(fo.mouse(i)),f=ee(i);Yl.call(i),l(a)}function h(){function e(){var e=fo.touches(p);return f=M.k,e.forEach(function(e){e.identifier in m&&(m[e.identifier]=t(e))}),e}function n(){var t=fo.event.target;fo.select(t).on(b,o).on(w,s),x.push(t);for(var n=fo.event.changedTouches,i=0,r=n.length;i<r;++i)m[n[i].identifier]=null;var l=e(),c=Date.now();if(1===l.length){if(c-y<500){var d=l[0];a(p,d,m[d.identifier],Math.floor(Math.log(M.k)/Math.LN2)+1),j()}y=c}else if(l.length>1){var d=l[0],u=l[1],h=d[0]-u[0],f=d[1]-u[1];_=h*h+f*f}}function o(){var e,t,n,a,o=fo.touches(p);Yl.call(p);for(var s=0,l=o.length;s<l;++s,a=null)if(n=o[s],a=m[n.identifier]){if(t)break;e=n,t=a}if(a){var d=(d=n[0]-e[0])*d+(d=n[1]-e[1])*d,u=_&&Math.sqrt(d/_);e=[(e[0]+n[0])/2,(e[1]+n[1])/2],t=[(t[0]+a[0])/2,(t[1]+a[1])/2],i(u*f)}y=null,r(e,t),c(g)}function s(){if(fo.event.touches.length){for(var t=fo.event.changedTouches,n=0,i=t.length;n<i;++n)delete m[t[n].identifier];for(var r in m)return void e()}fo.selectAll(x).on(v,null),k.on(A,u).on(D,h),C(),d(g)}var f,p=this,g=O.of(p,arguments),m={},_=0,v=".zoom-"+fo.event.changedTouches[0].identifier,b="touchmove"+v,w="touchend"+v,x=[],k=fo.select(p),C=ee(p);n(),l(g),k.on(A,null).on(D,n)}function f(){var e=O.of(this,arguments);v?clearTimeout(v):(Yl.call(this),g=t(m=_||fo.mouse(this)),l(e)),v=setTimeout(function(){v=null,d(e)},50),j(),i(Math.pow(2,.002*Jo())*M.k),r(m,g),c(e)}function p(){var e=fo.mouse(this),n=Math.log(M.k)/Math.LN2;a(this,e,t(e),fo.event.shiftKey?Math.ceil(n)-1:Math.floor(n)+1)}var g,m,_,v,y,b,w,x,k,M={x:0,y:0,k:1},C=[960,500],S=Xo,T=250,E=0,A="mousedown.zoom",L="mousemove.zoom",I="mouseup.zoom",D="touchstart.zoom",O=N(e,"zoomstart","zoom","zoomend");return Qo||(Qo="onwheel"in mo?(Jo=function(){return-fo.event.deltaY*(fo.event.deltaMode?120:1)},"wheel"):"onmousewheel"in mo?(Jo=function(){return fo.event.wheelDelta},"mousewheel"):(Jo=function(){return-fo.event.detail},"MozMousePixelScroll")),e.event=function(e){e.each(function(){var e=O.of(this,arguments),t=M;Hl?fo.select(this).transition().each("start.zoom",function(){M=this.__chart__||{x:0,y:0,k:1},l(e)}).tween("zoom:zoom",function(){var n=C[0],i=C[1],r=m?m[0]:n/2,a=m?m[1]:i/2,o=fo.interpolateZoom([(r-M.x)/M.k,(a-M.y)/M.k,n/M.k],[(r-t.x)/t.k,(a-t.y)/t.k,n/t.k]);return function(t){var i=o(t),s=n/i[2];this.__chart__=M={x:r-i[0]*s,y:a-i[1]*s,k:s},c(e)}}).each("interrupt.zoom",function(){d(e)}).each("end.zoom",function(){d(e)}):(this.__chart__=M,l(e),c(e),d(e))})},e.translate=function(t){return arguments.length?(M={x:+t[0],y:+t[1],k:M.k},s(),e):[M.x,M.y]},e.scale=function(t){return arguments.length?(M={x:M.x,y:M.y,k:null},i(+t),s(),e):M.k},e.scaleExtent=function(t){return arguments.length?(S=null==t?Xo:[+t[0],+t[1]],e):S},e.center=function(t){return arguments.length?(_=t&&[+t[0],+t[1]],e):_},e.size=function(t){return arguments.length?(C=t&&[+t[0],+t[1]],e):C},e.duration=function(t){return arguments.length?(T=+t,e):T},e.x=function(t){return arguments.length?(w=t,b=t.copy(),M={x:0,y:0,k:1},e):w},e.y=function(t){return arguments.length?(k=t,x=t.copy(),M={x:0,y:0,k:1},e):k},fo.rebind(e,O,"on")};var Jo,Qo,Xo=[0,1/0];fo.color=ue,ue.prototype.toString=function(){return this.rgb()+""},fo.hsl=he;var Ko=he.prototype=new ue;Ko.brighter=function(e){return e=Math.pow(.7,arguments.length?e:1),new he(this.h,this.s,this.l/e)},Ko.darker=function(e){return e=Math.pow(.7,arguments.length?e:1),new he(this.h,this.s,e*this.l)},Ko.rgb=function(){return fe(this.h,this.s,this.l)},fo.hcl=pe;var Zo=pe.prototype=new ue;Zo.brighter=function(e){return new pe(this.h,this.c,Math.min(100,this.l+es*(arguments.length?e:1)))},Zo.darker=function(e){return new pe(this.h,this.c,Math.max(0,this.l-es*(arguments.length?e:1)))},Zo.rgb=function(){return ge(this.h,this.c,this.l).rgb()},fo.lab=me;var es=18,ts=.95047,ns=1,is=1.08883,rs=me.prototype=new ue;rs.brighter=function(e){return new me(Math.min(100,this.l+es*(arguments.length?e:1)),this.a,this.b)},rs.darker=function(e){return new me(Math.max(0,this.l-es*(arguments.length?e:1)),this.a,this.b)},rs.rgb=function(){return _e(this.l,this.a,this.b)},fo.rgb=xe;var as=xe.prototype=new ue;as.brighter=function(e){e=Math.pow(.7,arguments.length?e:1);var t=this.r,n=this.g,i=this.b,r=30;return t||n||i?(t&&t<r&&(t=r),n&&n<r&&(n=r),i&&i<r&&(i=r),new xe(Math.min(255,t/e),Math.min(255,n/e),Math.min(255,i/e))):new xe(r,r,r)},as.darker=function(e){return e=Math.pow(.7,arguments.length?e:1),new xe(e*this.r,e*this.g,e*this.b)},as.hsl=function(){return Te(this.r,this.g,this.b)},as.toString=function(){return"#"+Ce(this.r)+Ce(this.g)+Ce(this.b)};var os=fo.map({aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074});os.forEach(function(e,t){os.set(e,ke(t))}),fo.functor=Ne,fo.xhr=Le(k),fo.dsv=function(e,t){function n(e,n,a){arguments.length<3&&(a=n,n=null);var o=Ie(e,t,null==n?i:r(n),a);return o.row=function(e){return arguments.length?o.response(null==(n=e)?i:r(e)):n},o}function i(e){return n.parse(e.responseText)}function r(e){return function(t){return n.parse(t.responseText,e)}}function a(t){return t.map(o).join(e)}function o(e){return s.test(e)?'"'+e.replace(/\"/g,'""')+'"':e}var s=new RegExp('["'+e+"\n]"),l=e.charCodeAt(0);return n.parse=function(e,t){var i;return n.parseRows(e,function(e,n){if(i)return i(e,n-1);var r=new Function("d","return {"+e.map(function(e,t){return JSON.stringify(e)+": d["+t+"]"}).join(",")+"}");i=t?function(e,n){return t(r(e),n)}:r})},n.parseRows=function(e,t){function n(){if(d>=c)return o;if(r)return r=!1,a;var t=d;if(34===e.charCodeAt(t)){for(var n=t;n++<c;)if(34===e.charCodeAt(n)){if(34!==e.charCodeAt(n+1))break;++n}d=n+2;var i=e.charCodeAt(n+1);return 13===i?(r=!0,10===e.charCodeAt(n+2)&&++d):10===i&&(r=!0),e.slice(t+1,n).replace(/""/g,'"')}for(;d<c;){var i=e.charCodeAt(d++),s=1;if(10===i)r=!0;else if(13===i)r=!0,10===e.charCodeAt(d)&&(++d,++s);else if(i!==l)continue;return e.slice(t,d-s)}return e.slice(t)}for(var i,r,a={},o={},s=[],c=e.length,d=0,u=0;(i=n())!==o;){for(var h=[];i!==a&&i!==o;)h.push(i),i=n();t&&null==(h=t(h,u++))||s.push(h)}return s},n.format=function(t){if(Array.isArray(t[0]))return n.formatRows(t);var i=new x,r=[];return t.forEach(function(e){for(var t in e)i.has(t)||r.push(i.add(t))}),[r.map(o).join(e)].concat(t.map(function(t){return r.map(function(e){return o(t[e])}).join(e)})).join("\n")},n.formatRows=function(e){return e.map(a).join("\n")},n},fo.csv=fo.dsv(",","text/csv"),fo.tsv=fo.dsv("\t","text/tab-separated-values");var ss,ls,cs,ds,us=this[C(this,"requestAnimationFrame")]||function(e){setTimeout(e,17)};fo.timer=function(){Pe.apply(this,arguments)},fo.timer.flush=function(){Re(),$e()},fo.round=function(e,t){return t?Math.round(e*(t=Math.pow(10,t)))/t:Math.round(e)};var hs=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"].map(He);fo.formatPrefix=function(e,t){var n=0;return(e=+e)&&(e<0&&(e*=-1),t&&(e=fo.round(e,ze(e,t))),n=1+Math.floor(1e-12+Math.log(e)/Math.LN10),n=Math.max(-24,Math.min(24,3*Math.floor((n-1)/3)))),hs[8+n/3]};var fs=/(?:([^{])?([<>=^]))?([+\- ])?([$#])?(0)?(\d+)?(,)?(\.-?\d+)?([a-z%])?/i,ps=fo.map({b:function(e){return e.toString(2)},c:function(e){return String.fromCharCode(e)},o:function(e){return e.toString(8)},x:function(e){return e.toString(16)},X:function(e){return e.toString(16).toUpperCase()},g:function(e,t){return e.toPrecision(t)},e:function(e,t){return e.toExponential(t)},f:function(e,t){return e.toFixed(t)},r:function(e,t){return(e=fo.round(e,ze(e,t))).toFixed(Math.max(0,Math.min(20,ze(e*(1+1e-15),t))))}}),gs=fo.time={},ms=Date;Fe.prototype={getDate:function(){return this._.getUTCDate()},getDay:function(){return this._.getUTCDay()},getFullYear:function(){return this._.getUTCFullYear()},getHours:function(){return this._.getUTCHours()},getMilliseconds:function(){return this._.getUTCMilliseconds()},getMinutes:function(){return this._.getUTCMinutes()},getMonth:function(){return this._.getUTCMonth()},getSeconds:function(){return this._.getUTCSeconds()},getTime:function(){return this._.getTime()},getTimezoneOffset:function(){return 0},valueOf:function(){return this._.valueOf()},setDate:function(){_s.setUTCDate.apply(this._,arguments)},setDay:function(){_s.setUTCDay.apply(this._,arguments)},setFullYear:function(){_s.setUTCFullYear.apply(this._,arguments)},setHours:function(){_s.setUTCHours.apply(this._,arguments)},setMilliseconds:function(){_s.setUTCMilliseconds.apply(this._,arguments)},setMinutes:function(){_s.setUTCMinutes.apply(this._,arguments)},setMonth:function(){_s.setUTCMonth.apply(this._,arguments)},setSeconds:function(){_s.setUTCSeconds.apply(this._,arguments)},setTime:function(){_s.setTime.apply(this._,arguments)}};var _s=Date.prototype;gs.year=Ge(function(e){return e=gs.day(e),e.setMonth(0,1),e},function(e,t){e.setFullYear(e.getFullYear()+t)},function(e){return e.getFullYear()}),gs.years=gs.year.range,gs.years.utc=gs.year.utc.range,gs.day=Ge(function(e){var t=new ms(2e3,0);return t.setFullYear(e.getFullYear(),e.getMonth(),e.getDate()),t},function(e,t){e.setDate(e.getDate()+t)},function(e){return e.getDate()-1}),gs.days=gs.day.range,gs.days.utc=gs.day.utc.range,gs.dayOfYear=function(e){var t=gs.year(e);return Math.floor((e-t-6e4*(e.getTimezoneOffset()-t.getTimezoneOffset()))/864e5)},["sunday","monday","tuesday","wednesday","thursday","friday","saturday"].forEach(function(e,t){t=7-t;var n=gs[e]=Ge(function(e){return(e=gs.day(e)).setDate(e.getDate()-(e.getDay()+t)%7),e},function(e,t){e.setDate(e.getDate()+7*Math.floor(t))},function(e){var n=gs.year(e).getDay();return Math.floor((gs.dayOfYear(e)+(n+t)%7)/7)-(n!==t)});gs[e+"s"]=n.range,gs[e+"s"].utc=n.utc.range,gs[e+"OfYear"]=function(e){var n=gs.year(e).getDay();return Math.floor((gs.dayOfYear(e)+(n+t)%7)/7)}}),gs.week=gs.sunday,gs.weeks=gs.sunday.range,gs.weeks.utc=gs.sunday.utc.range,gs.weekOfYear=gs.sundayOfYear;var vs={"-":"",_:" ",0:"0"},ys=/^\s*\d+/,bs=/^%/;fo.locale=function(e){return{numberFormat:Ve(e),timeFormat:qe(e)}};var ws=fo.locale({decimal:".",thousands:",",grouping:[3],currency:["$",""],dateTime:"%a %b %e %X %Y",date:"%m/%d/%Y",time:"%H:%M:%S",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});fo.format=ws.numberFormat,fo.geo={},pt.prototype={s:0,t:0,add:function(e){gt(e,this.t,xs),gt(xs.s,this.s,this),this.s?this.t+=xs.t:this.s=xs.t},reset:function(){this.s=this.t=0},valueOf:function(){return this.s}};var xs=new pt;fo.geo.stream=function(e,t){e&&ks.hasOwnProperty(e.type)?ks[e.type](e,t):mt(e,t)};var ks={Feature:function(e,t){mt(e.geometry,t)},FeatureCollection:function(e,t){for(var n=e.features,i=-1,r=n.length;++i<r;)mt(n[i].geometry,t)}},Ms={Sphere:function(e,t){t.sphere()},Point:function(e,t){e=e.coordinates,t.point(e[0],e[1],e[2])},MultiPoint:function(e,t){for(var n=e.coordinates,i=-1,r=n.length;++i<r;)e=n[i],t.point(e[0],e[1],e[2])},LineString:function(e,t){_t(e.coordinates,t,0)},MultiLineString:function(e,t){for(var n=e.coordinates,i=-1,r=n.length;++i<r;)_t(n[i],t,0)},Polygon:function(e,t){vt(e.coordinates,t)},MultiPolygon:function(e,t){for(var n=e.coordinates,i=-1,r=n.length;++i<r;)vt(n[i],t)},GeometryCollection:function(e,t){for(var n=e.geometries,i=-1,r=n.length;++i<r;)mt(n[i],t)}};fo.geo.area=function(e){return Cs=0,fo.geo.stream(e,Ts),Cs};var Cs,Ss=new pt,Ts={sphere:function(){Cs+=4*Vo},point:S,lineStart:S,lineEnd:S,polygonStart:function(){Ss.reset(),Ts.lineStart=yt},polygonEnd:function(){var e=2*Ss;Cs+=e<0?4*Vo+e:e,Ts.lineStart=Ts.lineEnd=Ts.point=S}};fo.geo.bounds=function(){function e(e,t){y.push(b=[d=e,h=e]),t<u&&(u=t),t>f&&(f=t)}function t(t,n){var i=bt([t*Uo,n*Uo]);if(_){var r=xt(_,i),a=[r[1],-r[0],0],o=xt(a,r);Ct(o),o=St(o);var l=t-p,c=l>0?1:-1,g=o[0]*qo*c,m=ko(l)>180;if(m^(c*p<g&&g<c*t)){var v=o[1]*qo;v>f&&(f=v)}else if(g=(g+360)%360-180,m^(c*p<g&&g<c*t)){var v=-o[1]*qo;v<u&&(u=v)}else n<u&&(u=n),n>f&&(f=n);m?t<p?s(d,t)>s(d,h)&&(h=t):s(t,h)>s(d,h)&&(d=t):h>=d?(t<d&&(d=t),t>h&&(h=t)):t>p?s(d,t)>s(d,h)&&(h=t):s(t,h)>s(d,h)&&(d=t)}else e(t,n);_=i,p=t}function n(){w.point=t}function i(){b[0]=d,b[1]=h,w.point=e,_=null}function r(e,n){if(_){var i=e-p;v+=ko(i)>180?i+(i>0?360:-360):i}else g=e,m=n;Ts.point(e,n),t(e,n)}function a(){Ts.lineStart()}function o(){r(g,m),Ts.lineEnd(),ko(v)>zo&&(d=-(h=180)),b[0]=d,b[1]=h,_=null}function s(e,t){return(t-=e)<0?t+360:t}function l(e,t){return e[0]-t[0]}function c(e,t){return t[0]<=t[1]?t[0]<=e&&e<=t[1]:e<t[0]||t[1]<e}var d,u,h,f,p,g,m,_,v,y,b,w={point:e,lineStart:n,lineEnd:i,polygonStart:function(){w.point=r,w.lineStart=a,w.lineEnd=o,v=0,Ts.polygonStart()},polygonEnd:function(){Ts.polygonEnd(),w.point=e,w.lineStart=n,w.lineEnd=i,Ss<0?(d=-(h=180),u=-(f=90)):v>zo?f=90:v<-zo&&(u=-90),b[0]=d,b[1]=h}};return function(e){f=h=-(d=u=1/0),y=[],fo.geo.stream(e,w);var t=y.length;if(t){y.sort(l);for(var n,i=1,r=y[0],a=[r];i<t;++i)n=y[i],c(n[0],r)||c(n[1],r)?(s(r[0],n[1])>s(r[0],r[1])&&(r[1]=n[1]),s(n[0],r[1])>s(r[0],r[1])&&(r[0]=n[0])):a.push(r=n);for(var o,n,p=-1/0,t=a.length-1,i=0,r=a[t];i<=t;r=n,++i)n=a[i],(o=s(r[1],n[0]))>p&&(p=o,d=n[0],h=r[1])}return y=b=null,d===1/0||u===1/0?[[NaN,NaN],[NaN,NaN]]:[[d,u],[h,f]]}}(),fo.geo.centroid=function(e){Es=js=As=Ns=Ls=Is=Ds=Os=Ps=Ws=Rs=0,fo.geo.stream(e,$s);var t=Ps,n=Ws,i=Rs,r=t*t+n*n+i*i;return r<Ho&&(t=Is,n=Ds,i=Os,js<zo&&(t=As,n=Ns,i=Ls),(r=t*t+n*n+i*i)<Ho)?[NaN,NaN]:[Math.atan2(n,t)*qo,oe(i/Math.sqrt(r))*qo]};var Es,js,As,Ns,Ls,Is,Ds,Os,Ps,Ws,Rs,$s={sphere:S,point:Et,lineStart:At,lineEnd:Nt,polygonStart:function(){$s.lineStart=Lt},polygonEnd:function(){$s.lineStart=At}},zs=Rt(Dt,Vt,Ft,[-Vo,-Vo/2]),Hs=1e9;fo.geo.clipExtent=function(){var e,t,n,i,r,a,o={stream:function(e){return r&&(r.valid=!1),r=a(e),r.valid=!0,r},extent:function(s){return arguments.length?(a=Bt(e=+s[0][0],t=+s[0][1],n=+s[1][0],i=+s[1][1]),r&&(r.valid=!1,r=null),o):[[e,t],[n,i]]}};return o.extent([[0,0],[960,500]])},(fo.geo.conicEqualArea=function(){return Jt(Qt)}).raw=Qt,fo.geo.albers=function(){return fo.geo.conicEqualArea().rotate([96,0]).center([-.6,38.7]).parallels([29.5,45.5]).scale(1070)},fo.geo.albersUsa=function(){function e(e){var a=e[0],o=e[1];return t=null,n(a,o),t||(i(a,o),t)||r(a,o),t}var t,n,i,r,a=fo.geo.albers(),o=fo.geo.conicEqualArea().rotate([154,0]).center([-2,58.5]).parallels([55,65]),s=fo.geo.conicEqualArea().rotate([157,0]).center([-3,19.9]).parallels([8,18]),l={point:function(e,n){t=[e,n]}};return e.invert=function(e){var t=a.scale(),n=a.translate(),i=(e[0]-n[0])/t,r=(e[1]-n[1])/t;return(r>=.12&&r<.234&&i>=-.425&&i<-.214?o:r>=.166&&r<.234&&i>=-.214&&i<-.115?s:a).invert(e)},e.stream=function(e){var t=a.stream(e),n=o.stream(e),i=s.stream(e);return{point:function(e,r){t.point(e,r),n.point(e,r),i.point(e,r)},sphere:function(){t.sphere(),n.sphere(),i.sphere()},lineStart:function(){t.lineStart(),n.lineStart(),i.lineStart()},lineEnd:function(){t.lineEnd(),n.lineEnd(),i.lineEnd()},polygonStart:function(){t.polygonStart(),n.polygonStart(),i.polygonStart()},polygonEnd:function(){t.polygonEnd(),n.polygonEnd(),i.polygonEnd()}}},e.precision=function(t){return arguments.length?(a.precision(t),o.precision(t),s.precision(t),e):a.precision()},e.scale=function(t){return arguments.length?(a.scale(t),o.scale(.35*t),s.scale(t),e.translate(a.translate())):a.scale()},e.translate=function(t){if(!arguments.length)return a.translate();var c=a.scale(),d=+t[0],u=+t[1];return n=a.translate(t).clipExtent([[d-.455*c,u-.238*c],[d+.455*c,u+.238*c]]).stream(l).point,i=o.translate([d-.307*c,u+.201*c]).clipExtent([[d-.425*c+zo,u+.12*c+zo],[d-.214*c-zo,u+.234*c-zo]]).stream(l).point,r=s.translate([d-.205*c,u+.212*c]).clipExtent([[d-.214*c+zo,u+.166*c+zo],[d-.115*c-zo,u+.234*c-zo]]).stream(l).point,e},e.scale(1070)};var Vs,Ys,Fs,Gs,Us,qs,Bs={point:S,lineStart:S,lineEnd:S,polygonStart:function(){Ys=0,Bs.lineStart=Xt},polygonEnd:function(){Bs.lineStart=Bs.lineEnd=Bs.point=S,Vs+=ko(Ys/2)}},Js={point:Kt,lineStart:S,lineEnd:S,polygonStart:S,polygonEnd:S},Qs={point:tn,lineStart:nn,lineEnd:rn,polygonStart:function(){Qs.lineStart=an},polygonEnd:function(){Qs.point=tn,Qs.lineStart=nn,Qs.lineEnd=rn}};fo.geo.path=function(){function e(e){return e&&("function"==typeof s&&a.pointRadius(+s.apply(this,arguments)),o&&o.valid||(o=r(a)),fo.geo.stream(e,o)),a.result()}function t(){return o=null,e}var n,i,r,a,o,s=4.5;return e.area=function(e){return Vs=0,fo.geo.stream(e,r(Bs)),Vs},e.centroid=function(e){return As=Ns=Ls=Is=Ds=Os=Ps=Ws=Rs=0,fo.geo.stream(e,r(Qs)),Rs?[Ps/Rs,Ws/Rs]:Os?[Is/Os,Ds/Os]:Ls?[As/Ls,Ns/Ls]:[NaN,NaN]},e.bounds=function(e){return Us=qs=-(Fs=Gs=1/0),fo.geo.stream(e,r(Js)),[[Fs,Gs],[Us,qs]]},e.projection=function(e){return arguments.length?(r=(n=e)?e.stream||ln(e):k,t()):n},e.context=function(e){return arguments.length?(a=null==(i=e)?new Zt:new on(e),"function"!=typeof s&&a.pointRadius(s),t()):i},e.pointRadius=function(t){return arguments.length?(s="function"==typeof t?t:(a.pointRadius(+t),+t),e):s},e.projection(fo.geo.albersUsa()).context(null)},fo.geo.transform=function(e){return{stream:function(t){var n=new cn(t);for(var i in e)n[i]=e[i];return n}}},cn.prototype={point:function(e,t){this.stream.point(e,t)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}},fo.geo.projection=un,fo.geo.projectionMutator=hn,(fo.geo.equirectangular=function(){return un(pn)}).raw=pn.invert=pn,fo.geo.rotation=function(e){function t(t){return t=e(t[0]*Uo,t[1]*Uo),t[0]*=qo,t[1]*=qo,t}return e=mn(e[0]%360*Uo,e[1]*Uo,e.length>2?e[2]*Uo:0),t.invert=function(t){return t=e.invert(t[0]*Uo,t[1]*Uo),t[0]*=qo,t[1]*=qo,t},t},gn.invert=pn,fo.geo.circle=function(){function e(){var e="function"==typeof i?i.apply(this,arguments):i,t=mn(-e[0]*Uo,-e[1]*Uo,0).invert,r=[];return n(null,null,1,{point:function(e,n){r.push(e=t(e,n)),e[0]*=qo,e[1]*=qo}}),{type:"Polygon",coordinates:[r]}}var t,n,i=[0,0],r=6;return e.origin=function(t){return arguments.length?(i=t,e):i},e.angle=function(i){return arguments.length?(n=bn((t=+i)*Uo,r*Uo),e):t},e.precision=function(i){return arguments.length?(n=bn(t*Uo,(r=+i)*Uo),e):r},e.angle(90)},fo.geo.distance=function(e,t){var n,i=(t[0]-e[0])*Uo,r=e[1]*Uo,a=t[1]*Uo,o=Math.sin(i),s=Math.cos(i),l=Math.sin(r),c=Math.cos(r),d=Math.sin(a),u=Math.cos(a);return Math.atan2(Math.sqrt((n=u*o)*n+(n=c*d-l*u*s)*n),l*d+c*u*s)},fo.geo.graticule=function(){function e(){return{type:"MultiLineString",coordinates:t()}}function t(){return fo.range(Math.ceil(a/m)*m,r,m).map(h).concat(fo.range(Math.ceil(c/_)*_,l,_).map(f)).concat(fo.range(Math.ceil(i/p)*p,n,p).filter(function(e){return ko(e%m)>zo}).map(d)).concat(fo.range(Math.ceil(s/g)*g,o,g).filter(function(e){return ko(e%_)>zo}).map(u))}var n,i,r,a,o,s,l,c,d,u,h,f,p=10,g=p,m=90,_=360,v=2.5;return e.lines=function(){return t().map(function(e){return{type:"LineString",coordinates:e}})},e.outline=function(){return{type:"Polygon",coordinates:[h(a).concat(f(l).slice(1),h(r).reverse().slice(1),f(c).reverse().slice(1))]}},e.extent=function(t){return arguments.length?e.majorExtent(t).minorExtent(t):e.minorExtent()},e.majorExtent=function(t){return arguments.length?(a=+t[0][0],r=+t[1][0],c=+t[0][1],l=+t[1][1],a>r&&(t=a,a=r,r=t),c>l&&(t=c,c=l,l=t),e.precision(v)):[[a,c],[r,l]]},e.minorExtent=function(t){return arguments.length?(i=+t[0][0],n=+t[1][0],s=+t[0][1],o=+t[1][1],i>n&&(t=i,i=n,n=t),s>o&&(t=s,s=o,o=t),e.precision(v)):[[i,s],[n,o]]},e.step=function(t){return arguments.length?e.majorStep(t).minorStep(t):e.minorStep()},e.majorStep=function(t){return arguments.length?(m=+t[0],_=+t[1],e):[m,_]},e.minorStep=function(t){return arguments.length?(p=+t[0],g=+t[1],e):[p,g]},e.precision=function(t){return arguments.length?(v=+t,d=xn(s,o,90),u=kn(i,n,v),h=xn(c,l,90),f=kn(a,r,v),e):v},e.majorExtent([[-180,-90+zo],[180,90-zo]]).minorExtent([[-180,-80-zo],[180,80+zo]])},fo.geo.greatArc=function(){function e(){return{type:"LineString",coordinates:[t||i.apply(this,arguments),n||r.apply(this,arguments)]}}var t,n,i=Mn,r=Cn;return e.distance=function(){return fo.geo.distance(t||i.apply(this,arguments),n||r.apply(this,arguments))},e.source=function(n){return arguments.length?(i=n,t="function"==typeof n?null:n,e):i},e.target=function(t){return arguments.length?(r=t,n="function"==typeof t?null:t,e):r},e.precision=function(){return arguments.length?e:0},e},fo.geo.interpolate=function(e,t){return Sn(e[0]*Uo,e[1]*Uo,t[0]*Uo,t[1]*Uo)},fo.geo.length=function(e){return Xs=0,fo.geo.stream(e,Ks),Xs};var Xs,Ks={sphere:S,point:S,lineStart:Tn,lineEnd:S,polygonStart:S,polygonEnd:S},Zs=En(function(e){return Math.sqrt(2/(1+e))},function(e){return 2*Math.asin(e/2)});(fo.geo.azimuthalEqualArea=function(){return un(Zs)}).raw=Zs;var el=En(function(e){var t=Math.acos(e);return t&&t/Math.sin(t)},k);(fo.geo.azimuthalEquidistant=function(){return un(el)}).raw=el,(fo.geo.conicConformal=function(){return Jt(jn)}).raw=jn,(fo.geo.conicEquidistant=function(){return Jt(An)}).raw=An;var tl=En(function(e){return 1/e},Math.atan);(fo.geo.gnomonic=function(){return un(tl)}).raw=tl,Nn.invert=function(e,t){return[e,2*Math.atan(Math.exp(t))-Go]},(fo.geo.mercator=function(){return Ln(Nn)}).raw=Nn;var nl=En(function(){return 1},Math.asin);(fo.geo.orthographic=function(){return un(nl)}).raw=nl;var il=En(function(e){return 1/(1+e)},function(e){return 2*Math.atan(e)});(fo.geo.stereographic=function(){return un(il)}).raw=il,In.invert=function(e,t){return[-t,2*Math.atan(Math.exp(e))-Go]},(fo.geo.transverseMercator=function(){var e=Ln(In),t=e.center,n=e.rotate;return e.center=function(e){return e?t([-e[1],e[0]]):(e=t(),[e[1],-e[0]])},e.rotate=function(e){return e?n([e[0],e[1],e.length>2?e[2]+90:90]):(e=n(),[e[0],e[1],e[2]-90])},n([0,0,90])}).raw=In,fo.geom={},fo.geom.hull=function(e){function t(e){if(e.length<3)return[];var t,r=Ne(n),a=Ne(i),o=e.length,s=[],l=[];for(t=0;t<o;t++)s.push([+r.call(this,e[t],t),+a.call(this,e[t],t),t]);for(s.sort(Wn),t=0;t<o;t++)l.push([s[t][0],-s[t][1]]);var c=Pn(s),d=Pn(l),u=d[0]===c[0],h=d[d.length-1]===c[c.length-1],f=[];for(t=c.length-1;t>=0;--t)f.push(e[s[c[t]][2]]);for(t=+u;t<d.length-h;++t)f.push(e[s[d[t]][2]]);return f}var n=Dn,i=On;return arguments.length?t(e):(t.x=function(e){return arguments.length?(n=e,t):n},t.y=function(e){return arguments.length?(i=e,t):i},t)},fo.geom.polygon=function(e){return Eo(e,rl),e};var rl=fo.geom.polygon.prototype=[];rl.area=function(){for(var e,t=-1,n=this.length,i=this[n-1],r=0;++t<n;)e=i,i=this[t],r+=e[1]*i[0]-e[0]*i[1];return.5*r},rl.centroid=function(e){var t,n,i=-1,r=this.length,a=0,o=0,s=this[r-1];for(arguments.length||(e=-1/(6*this.area()));++i<r;)t=s,s=this[i],n=t[0]*s[1]-s[0]*t[1],a+=(t[0]+s[0])*n,o+=(t[1]+s[1])*n;return[a*e,o*e]},rl.clip=function(e){for(var t,n,i,r,a,o,s=zn(e),l=-1,c=this.length-zn(this),d=this[c-1];++l<c;){for(t=e.slice(),e.length=0,r=this[l],a=t[(i=t.length-s)-1],n=-1;++n<i;)o=t[n],Rn(o,d,r)?(Rn(a,d,r)||e.push($n(a,o,d,r)),e.push(o)):Rn(a,d,r)&&e.push($n(a,o,d,r)),a=o;s&&e.push(e[0]),d=r}return e};var al,ol,sl,ll,cl,dl=[],ul=[];Bn.prototype.prepare=function(){for(var e,t=this.edges,n=t.length;n--;)e=t[n].edge,e.b&&e.a||t.splice(n,1);return t.sort(Qn),t.length},oi.prototype={start:function(){return this.edge.l===this.site?this.edge.a:this.edge.b},end:function(){return this.edge.l===this.site?this.edge.b:this.edge.a}},si.prototype={insert:function(e,t){var n,i,r;if(e){if(t.P=e,t.N=e.N,e.N&&(e.N.P=t),e.N=t,e.R){for(e=e.R;e.L;)e=e.L;e.L=t}else e.R=t;n=e}else this._?(e=ui(this._),t.P=null,t.N=e,e.P=e.L=t,n=e):(t.P=t.N=null,this._=t,n=null);for(t.L=t.R=null,t.U=n,t.C=!0,e=t;n&&n.C;)i=n.U,n===i.L?(r=i.R,r&&r.C?(n.C=r.C=!1,i.C=!0,e=i):(e===n.R&&(ci(this,n),e=n,n=e.U),n.C=!1,i.C=!0,di(this,i))):(r=i.L,r&&r.C?(n.C=r.C=!1,i.C=!0,e=i):(e===n.L&&(di(this,n),e=n,n=e.U),n.C=!1,i.C=!0,ci(this,i))),n=e.U;this._.C=!1},remove:function(e){e.N&&(e.N.P=e.P),e.P&&(e.P.N=e.N),e.N=e.P=null;var t,n,i,r=e.U,a=e.L,o=e.R;if(n=a?o?ui(o):a:o,r?r.L===e?r.L=n:r.R=n:this._=n,a&&o?(i=n.C,n.C=e.C,n.L=a,a.U=n,n!==o?(r=n.U,n.U=e.U,e=n.R,r.L=e,n.R=o,o.U=n):(n.U=r,r=n,e=n.R)):(i=e.C,e=n),e&&(e.U=r),!i){if(e&&e.C)return void(e.C=!1);do{if(e===this._)break;if(e===r.L){if(t=r.R,t.C&&(t.C=!1,r.C=!0,ci(this,r),t=r.R),t.L&&t.L.C||t.R&&t.R.C){t.R&&t.R.C||(t.L.C=!1,t.C=!0,di(this,t),t=r.R),t.C=r.C,r.C=t.R.C=!1,ci(this,r),e=this._;break}}else if(t=r.L,t.C&&(t.C=!1,r.C=!0,di(this,r),t=r.L),t.L&&t.L.C||t.R&&t.R.C){t.L&&t.L.C||(t.R.C=!1,t.C=!0,ci(this,t),t=r.L),t.C=r.C,r.C=t.L.C=!1,di(this,r),e=this._;break}t.C=!0,e=r,r=r.U}while(!e.C);e&&(e.C=!1)}}},fo.geom.voronoi=function(e){function t(e){var t=new Array(e.length),i=s[0][0],r=s[0][1],a=s[1][0],o=s[1][1];return hi(n(e),s).cells.forEach(function(n,s){var l=n.edges,c=n.site;(t[s]=l.length?l.map(function(e){var t=e.start();return[t.x,t.y]}):c.x>=i&&c.x<=a&&c.y>=r&&c.y<=o?[[i,o],[a,o],[a,r],[i,r]]:[]).point=e[s]}),t}function n(e){return e.map(function(e,t){return{x:Math.round(a(e,t)/zo)*zo,y:Math.round(o(e,t)/zo)*zo,i:t}})}var i=Dn,r=On,a=i,o=r,s=hl;return e?t(e):(t.links=function(e){return hi(n(e)).edges.filter(function(e){return e.l&&e.r}).map(function(t){return{source:e[t.l.i],target:e[t.r.i]}})},t.triangles=function(e){var t=[];return hi(n(e)).cells.forEach(function(n,i){for(var r,a=n.site,o=n.edges.sort(Qn),s=-1,l=o.length,c=o[l-1].edge,d=c.l===a?c.r:c.l;++s<l;)c,r=d,c=o[s].edge,d=c.l===a?c.r:c.l,i<r.i&&i<d.i&&pi(a,r,d)<0&&t.push([e[i],e[r.i],e[d.i]])}),t},t.x=function(e){return arguments.length?(a=Ne(i=e),t):i},t.y=function(e){return arguments.length?(o=Ne(r=e),t):r},t.clipExtent=function(e){return arguments.length?(s=null==e?hl:e,t):s===hl?null:s},t.size=function(e){return arguments.length?t.clipExtent(e&&[[0,0],e]):s===hl?null:s&&s[1]},t)};var hl=[[-1e6,-1e6],[1e6,1e6]];fo.geom.delaunay=function(e){return fo.geom.voronoi().triangles(e)},fo.geom.quadtree=function(e,t,n,i,r){function a(e){function a(e,t,n,i,r,a,o,s){if(!isNaN(n)&&!isNaN(i))if(e.leaf){var l=e.x,d=e.y;if(null!=l)if(ko(l-n)+ko(d-i)<.01)c(e,t,n,i,r,a,o,s);else{var u=e.point;e.x=e.y=e.point=null,c(e,u,l,d,r,a,o,s),c(e,t,n,i,r,a,o,s)}else e.x=n,e.y=i,e.point=t}else c(e,t,n,i,r,a,o,s)}function c(e,t,n,i,r,o,s,l){var c=.5*(r+s),d=.5*(o+l),u=n>=c,h=i>=d,f=h<<1|u;e.leaf=!1,e=e.nodes[f]||(e.nodes[f]=_i()),u?r=c:s=c,h?o=d:l=d,a(e,t,n,i,r,o,s,l)}var d,u,h,f,p,g,m,_,v,y=Ne(s),b=Ne(l);if(null!=t)g=t,m=n,_=i,v=r;else if(_=v=-(g=m=1/0),u=[],h=[],p=e.length,o)for(f=0;f<p;++f)d=e[f],d.x<g&&(g=d.x),d.y<m&&(m=d.y),d.x>_&&(_=d.x),d.y>v&&(v=d.y),u.push(d.x),h.push(d.y);else for(f=0;f<p;++f){var w=+y(d=e[f],f),x=+b(d,f);w<g&&(g=w),x<m&&(m=x),w>_&&(_=w),x>v&&(v=x),u.push(w),h.push(x)}var k=_-g,M=v-m;k>M?v=m+k:_=g+M;var C=_i();if(C.add=function(e){a(C,e,+y(e,++f),+b(e,f),g,m,_,v)},C.visit=function(e){vi(e,C,g,m,_,v)},C.find=function(e){return yi(C,e[0],e[1],g,m,_,v)},f=-1,null==t){for(;++f<p;)a(C,e[f],u[f],h[f],g,m,_,v);--f}else e.forEach(C.add);return u=h=e=d=null,C}var o,s=Dn,l=On;return(o=arguments.length)?(s=gi,l=mi,3===o&&(r=n,i=t,n=t=0),a(e)):(a.x=function(e){return arguments.length?(s=e,a):s},a.y=function(e){return arguments.length?(l=e,a):l},a.extent=function(e){return arguments.length?(null==e?t=n=i=r=null:(t=+e[0][0],n=+e[0][1],i=+e[1][0],r=+e[1][1]),a):null==t?null:[[t,n],[i,r]]},a.size=function(e){return arguments.length?(null==e?t=n=i=r=null:(t=n=0,i=+e[0],r=+e[1]),a):null==t?null:[i-t,r-n]},a)},fo.interpolateRgb=bi,fo.interpolateObject=wi,fo.interpolateNumber=xi,fo.interpolateString=ki;var fl=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,pl=new RegExp(fl.source,"g");fo.interpolate=Mi,fo.interpolators=[function(e,t){var n=typeof t;return("string"===n?os.has(t.toLowerCase())||/^(#|rgb\(|hsl\()/i.test(t)?bi:ki:t instanceof ue?bi:Array.isArray(t)?Ci:"object"===n&&isNaN(t)?wi:xi)(e,t)}],fo.interpolateArray=Ci;var gl=function(){return k},ml=fo.map({linear:gl,poly:Li,quad:function(){return ji},cubic:function(){return Ai},sin:function(){return Ii},exp:function(){return Di},circle:function(){return Oi},elastic:Pi,back:Wi,bounce:function(){return Ri}}),_l=fo.map({in:k,out:Ti,"in-out":Ei,"out-in":function(e){return Ei(Ti(e))}});fo.ease=function(e){var t=e.indexOf("-"),n=t>=0?e.slice(0,t):e,i=t>=0?e.slice(t+1):"in";return n=ml.get(n)||gl,i=_l.get(i)||k,Si(i(n.apply(null,po.call(arguments,1))))},fo.interpolateHcl=$i,fo.interpolateHsl=zi,fo.interpolateLab=Hi,fo.interpolateRound=Vi,fo.transform=function(e){var t=mo.createElementNS(fo.ns.prefix.svg,"g");return(fo.transform=function(e){if(null!=e){t.setAttribute("transform",e);var n=t.transform.baseVal.consolidate()}return new Yi(n?n.matrix:vl)})(e)},Yi.prototype.toString=function(){return"translate("+this.translate+")rotate("+this.rotate+")skewX("+this.skew+")scale("+this.scale+")"};var vl={a:1,b:0,c:0,d:1,e:0,f:0};fo.interpolateTransform=Ki,fo.layout={},fo.layout.bundle=function(){return function(e){for(var t=[],n=-1,i=e.length;++n<i;)t.push(tr(e[n]));return t}},fo.layout.chord=function(){function e(){var e,c,u,h,f,p={},g=[],m=fo.range(a),_=[];for(n=[],i=[],e=0,h=-1;++h<a;){for(c=0,f=-1;++f<a;)c+=r[h][f];g.push(c),_.push(fo.range(a)),e+=c}for(o&&m.sort(function(e,t){return o(g[e],g[t])}),s&&_.forEach(function(e,t){e.sort(function(e,n){return s(r[t][e],r[t][n])})}),e=(Yo-d*a)/e,c=0,h=-1;++h<a;){for(u=c,f=-1;++f<a;){var v=m[h],y=_[v][f],b=r[v][y],w=c,x=c+=b*e;p[v+"-"+y]={index:v,subindex:y,startAngle:w,endAngle:x,value:b}}i[v]={index:v,startAngle:u,endAngle:c,value:g[v]},c+=d}for(h=-1;++h<a;)for(f=h-1;++f<a;){var k=p[h+"-"+f],M=p[f+"-"+h];(k.value||M.value)&&n.push(k.value<M.value?{source:M,target:k}:{source:k,target:M})}l&&t()}function t(){n.sort(function(e,t){return l((e.source.value+e.target.value)/2,(t.source.value+t.target.value)/2)})}var n,i,r,a,o,s,l,c={},d=0;return c.matrix=function(e){return arguments.length?(a=(r=e)&&r.length,n=i=null,c):r},c.padding=function(e){return arguments.length?(d=e,n=i=null,c):d},c.sortGroups=function(e){return arguments.length?(o=e,n=i=null,c):o},c.sortSubgroups=function(e){return arguments.length?(s=e,n=null,c):s},c.sortChords=function(e){return arguments.length?(l=e,n&&t(),c):l},c.chords=function(){return n||e(),n},c.groups=function(){return i||e(),i},c},fo.layout.force=function(){function e(e){return function(t,n,i,r){if(t.point!==e){var a=t.cx-e.x,o=t.cy-e.y,s=r-n,l=a*a+o*o;if(s*s/_<l){if(l<g){var c=t.charge/l;e.px-=a*c,e.py-=o*c}return!0}if(t.point&&l&&l<g){var c=t.pointCharge/l;e.px-=a*c,e.py-=o*c}}return!t.charge}}function t(e){e.px=fo.event.x,e.py=fo.event.y,l.resume()}var n,i,r,a,o,s,l={},c=fo.dispatch("start","tick","end"),d=[1,1],u=.9,h=yl,f=bl,p=-30,g=wl,m=.1,_=.64,v=[],y=[];return l.tick=function(){if((r*=.99)<.005)return n=null,c.end({type:"end",alpha:r=0}),!0;var t,i,l,h,f,g,_,b,w,x=v.length,k=y.length;for(i=0;i<k;++i)l=y[i],h=l.source,f=l.target,b=f.x-h.x,w=f.y-h.y,(g=b*b+w*w)&&(g=r*o[i]*((g=Math.sqrt(g))-a[i])/g,b*=g,w*=g,f.x-=b*(_=h.weight+f.weight?h.weight/(h.weight+f.weight):.5),f.y-=w*_,h.x+=b*(_=1-_),h.y+=w*_);if((_=r*m)&&(b=d[0]/2,w=d[1]/2,i=-1,_))for(;++i<x;)l=v[i],l.x+=(b-l.x)*_,l.y+=(w-l.y)*_;if(p)for(lr(t=fo.geom.quadtree(v),r,s),i=-1;++i<x;)(l=v[i]).fixed||t.visit(e(l));for(i=-1;++i<x;)l=v[i],l.fixed?(l.x=l.px,l.y=l.py):(l.x-=(l.px-(l.px=l.x))*u,l.y-=(l.py-(l.py=l.y))*u);c.tick({type:"tick",alpha:r})},l.nodes=function(e){return arguments.length?(v=e,l):v},l.links=function(e){return arguments.length?(y=e,l):y},l.size=function(e){return arguments.length?(d=e,l):d},l.linkDistance=function(e){return arguments.length?(h="function"==typeof e?e:+e,l):h},l.distance=l.linkDistance,l.linkStrength=function(e){return arguments.length?(f="function"==typeof e?e:+e,l):f},l.friction=function(e){return arguments.length?(u=+e,l):u},l.charge=function(e){return arguments.length?(p="function"==typeof e?e:+e,l):p},l.chargeDistance=function(e){return arguments.length?(g=e*e,l):Math.sqrt(g)},l.gravity=function(e){return arguments.length?(m=+e,l):m},l.theta=function(e){return arguments.length?(_=e*e,l):Math.sqrt(_)},l.alpha=function(e){return arguments.length?(e=+e,r?e>0?r=e:(n.c=null,n.t=NaN,n=null,c.end({type:"end",alpha:r=0})):e>0&&(c.start({type:"start",alpha:r=e}),n=Pe(l.tick)),l):r},l.start=function(){function e(e,i){if(!n){for(n=new Array(r),l=0;l<r;++l)n[l]=[];for(l=0;l<c;++l){var a=y[l];n[a.source.index].push(a.target),n[a.target.index].push(a.source)}}for(var o,s=n[t],l=-1,d=s.length;++l<d;)if(!isNaN(o=s[l][e]))return o;return Math.random()*i}var t,n,i,r=v.length,c=y.length,u=d[0],g=d[1];for(t=0;t<r;++t)(i=v[t]).index=t,i.weight=0;for(t=0;t<c;++t)i=y[t],"number"==typeof i.source&&(i.source=v[i.source]),"number"==typeof i.target&&(i.target=v[i.target]),++i.source.weight,++i.target.weight;for(t=0;t<r;++t)i=v[t],isNaN(i.x)&&(i.x=e("x",u)),isNaN(i.y)&&(i.y=e("y",g)),isNaN(i.px)&&(i.px=i.x),isNaN(i.py)&&(i.py=i.y);if(a=[],"function"==typeof h)for(t=0;t<c;++t)a[t]=+h.call(this,y[t],t);else for(t=0;t<c;++t)a[t]=h;if(o=[],"function"==typeof f)for(t=0;t<c;++t)o[t]=+f.call(this,y[t],t);else for(t=0;t<c;++t)o[t]=f;if(s=[],"function"==typeof p)for(t=0;t<r;++t)s[t]=+p.call(this,v[t],t);else for(t=0;t<r;++t)s[t]=p;return l.resume()},l.resume=function(){return l.alpha(.1)},l.stop=function(){return l.alpha(0)},l.drag=function(){if(i||(i=fo.behavior.drag().origin(k).on("dragstart.force",rr).on("drag.force",t).on("dragend.force",ar)),!arguments.length)return i;this.on("mouseover.force",or).on("mouseout.force",sr).call(i)},fo.rebind(l,c,"on")};var yl=20,bl=1,wl=1/0;fo.layout.hierarchy=function(){function e(r){var a,o=[r],s=[];for(r.depth=0;null!=(a=o.pop());)if(s.push(a),(c=n.call(e,a,a.depth))&&(l=c.length)){for(var l,c,d;--l>=0;)o.push(d=c[l]),d.parent=a,d.depth=a.depth+1;i&&(a.value=0),a.children=c}else i&&(a.value=+i.call(e,a,a.depth)||0),delete a.children;return ur(r,function(e){var n,r;t&&(n=e.children)&&n.sort(t),i&&(r=e.parent)&&(r.value+=e.value)}),s}var t=pr,n=hr,i=fr;return e.sort=function(n){return arguments.length?(t=n,e):t},e.children=function(t){return arguments.length?(n=t,e):n},e.value=function(t){return arguments.length?(i=t,e):i},e.revalue=function(t){return i&&(dr(t,function(e){e.children&&(e.value=0)}),ur(t,function(t){var n;t.children||(t.value=+i.call(e,t,t.depth)||0),(n=t.parent)&&(n.value+=t.value)})),t},e},fo.layout.partition=function(){function e(t,n,i,r){var a=t.children;if(t.x=n,t.y=t.depth*r,t.dx=i,t.dy=r,a&&(o=a.length)){var o,s,l,c=-1;for(i=t.value?i/t.value:0;++c<o;)e(s=a[c],n,l=s.value*i,r),n+=l}}function t(e){var n=e.children,i=0;if(n&&(r=n.length))for(var r,a=-1;++a<r;)i=Math.max(i,t(n[a]));return 1+i}function n(n,a){var o=i.call(this,n,a);return e(o[0],0,r[0],r[1]/t(o[0])),o}var i=fo.layout.hierarchy(),r=[1,1];return n.size=function(e){return arguments.length?(r=e,n):r},cr(n,i)},fo.layout.pie=function(){function e(o){var s,l=o.length,c=o.map(function(n,i){return+t.call(e,n,i)}),d=+("function"==typeof i?i.apply(this,arguments):i),u=("function"==typeof r?r.apply(this,arguments):r)-d,h=Math.min(Math.abs(u)/l,+("function"==typeof a?a.apply(this,arguments):a)),f=h*(u<0?-1:1),p=fo.sum(c),g=p?(u-l*f)/p:0,m=fo.range(l),_=[];return null!=n&&m.sort(n===xl?function(e,t){return c[t]-c[e]}:function(e,t){return n(o[e],o[t])}),m.forEach(function(e){_[e]={data:o[e],value:s=c[e],startAngle:d,endAngle:d+=s*g+f,padAngle:h}}),_}var t=Number,n=xl,i=0,r=Yo,a=0;return e.value=function(n){return arguments.length?(t=n,e):t},e.sort=function(t){return arguments.length?(n=t,e):n},e.startAngle=function(t){return arguments.length?(i=t,e):i},e.endAngle=function(t){return arguments.length?(r=t,e):r},e.padAngle=function(t){return arguments.length?(a=t,e):a},e};var xl={};fo.layout.stack=function(){function e(s,l){if(!(h=s.length))return s;var c=s.map(function(n,i){return t.call(e,n,i)}),d=c.map(function(t){return t.map(function(t,n){return[a.call(e,t,n),o.call(e,t,n)]})}),u=n.call(e,d,l);c=fo.permute(c,u),d=fo.permute(d,u);var h,f,p,g,m=i.call(e,d,l),_=c[0].length;for(p=0;p<_;++p)for(r.call(e,c[0][p],g=m[p],d[0][p][1]),f=1;f<h;++f)r.call(e,c[f][p],g+=d[f-1][p][1],d[f][p][1]);return s}var t=k,n=yr,i=br,r=vr,a=mr,o=_r;return e.values=function(n){return arguments.length?(t=n,e):t},e.order=function(t){return arguments.length?(n="function"==typeof t?t:kl.get(t)||yr,e):n},e.offset=function(t){return arguments.length?(i="function"==typeof t?t:Ml.get(t)||br,e):i},e.x=function(t){return arguments.length?(a=t,e):a},e.y=function(t){return arguments.length?(o=t,e):o},e.out=function(t){return arguments.length?(r=t,e):r},e};var kl=fo.map({"inside-out":function(e){var t,n,i=e.length,r=e.map(wr),a=e.map(xr),o=fo.range(i).sort(function(e,t){return r[e]-r[t]}),s=0,l=0,c=[],d=[];for(t=0;t<i;++t)n=o[t],s<l?(s+=a[n],c.push(n)):(l+=a[n],d.push(n));return d.reverse().concat(c)},reverse:function(e){return fo.range(e.length).reverse()},default:yr}),Ml=fo.map({silhouette:function(e){var t,n,i,r=e.length,a=e[0].length,o=[],s=0,l=[];for(n=0;n<a;++n){for(t=0,i=0;t<r;t++)i+=e[t][n][1];i>s&&(s=i),o.push(i)}for(n=0;n<a;++n)l[n]=(s-o[n])/2;return l},wiggle:function(e){var t,n,i,r,a,o,s,l,c,d=e.length,u=e[0],h=u.length,f=[];for(f[0]=l=c=0,n=1;n<h;++n){for(t=0,r=0;t<d;++t)r+=e[t][n][1];for(t=0,a=0,s=u[n][0]-u[n-1][0];t<d;++t){for(i=0,o=(e[t][n][1]-e[t][n-1][1])/(2*s);i<t;++i)o+=(e[i][n][1]-e[i][n-1][1])/s;a+=o*e[t][n][1]}f[n]=l-=r?a/r*s:0,l<c&&(c=l)}for(n=0;n<h;++n)f[n]-=c;return f},expand:function(e){var t,n,i,r=e.length,a=e[0].length,o=1/r,s=[];for(n=0;n<a;++n){for(t=0,i=0;t<r;t++)i+=e[t][n][1];if(i)for(t=0;t<r;t++)e[t][n][1]/=i;else for(t=0;t<r;t++)e[t][n][1]=o}for(n=0;n<a;++n)s[n]=0;return s},zero:br});fo.layout.histogram=function(){function e(e,a){for(var o,s,l=[],c=e.map(n,this),d=i.call(this,c,a),u=r.call(this,d,c,a),a=-1,h=c.length,f=u.length-1,p=t?1:1/h;++a<f;)o=l[a]=[],o.dx=u[a+1]-(o.x=u[a]),o.y=0;if(f>0)for(a=-1;++a<h;)(s=c[a])>=d[0]&&s<=d[1]&&(o=l[fo.bisect(u,s,1,f)-1],o.y+=p,o.push(e[a]));return l}var t=!0,n=Number,i=Sr,r=Mr;return e.value=function(t){return arguments.length?(n=t,e):n},e.range=function(t){return arguments.length?(i=Ne(t),e):i},e.bins=function(t){return arguments.length?(r="number"==typeof t?function(e){return Cr(e,t)}:Ne(t),e):r},e.frequency=function(n){return arguments.length?(t=!!n,e):t},e},fo.layout.pack=function(){function e(e,a){var o=n.call(this,e,a),s=o[0],l=r[0],c=r[1],d=null==t?Math.sqrt:"function"==typeof t?t:function(){return t};if(s.x=s.y=0,ur(s,function(e){e.r=+d(e.value)}),ur(s,Nr),i){var u=i*(t?1:Math.max(2*s.r/l,2*s.r/c))/2;ur(s,function(e){e.r+=u}),ur(s,Nr),ur(s,function(e){e.r-=u})}return Dr(s,l/2,c/2,t?1:1/Math.max(2*s.r/l,2*s.r/c)),o}var t,n=fo.layout.hierarchy().sort(Tr),i=0,r=[1,1];return e.size=function(t){return arguments.length?(r=t,e):r},e.radius=function(n){return arguments.length?(t=null==n||"function"==typeof n?n:+n,e):t},e.padding=function(t){return arguments.length?(i=+t,e):i},cr(e,n)},fo.layout.tree=function(){function e(e,r){var d=o.call(this,e,r),u=d[0],h=t(u);if(ur(h,n),h.parent.m=-h.z,dr(h,i),c)dr(u,a);else{var f=u,p=u,g=u;dr(u,function(e){e.x<f.x&&(f=e),e.x>p.x&&(p=e),e.depth>g.depth&&(g=e)});var m=s(f,p)/2-f.x,_=l[0]/(p.x+s(p,f)/2+m),v=l[1]/(g.depth||1);dr(u,function(e){e.x=(e.x+m)*_,e.y=e.depth*v})}return d}function t(e){for(var t,n={A:null,children:[e]},i=[n];null!=(t=i.pop());)for(var r,a=t.children,o=0,s=a.length;o<s;++o)i.push((a[o]=r={_:a[o],parent:t,children:(r=a[o].children)&&r.slice()||[],A:null,a:null,z:0,m:0,c:0,s:0,t:null,i:o}).a=r);return n.children[0]}function n(e){var t=e.children,n=e.parent.children,i=e.i?n[e.i-1]:null;if(t.length){zr(e);var a=(t[0].z+t[t.length-1].z)/2;i?(e.z=i.z+s(e._,i._),e.m=e.z-a):e.z=a}else i&&(e.z=i.z+s(e._,i._));e.parent.A=r(e,i,e.parent.A||n[0])}function i(e){e._.x=e.z+e.parent.m,e.m+=e.parent.m}function r(e,t,n){if(t){for(var i,r=e,a=e,o=t,l=r.parent.children[0],c=r.m,d=a.m,u=o.m,h=l.m;o=Rr(o),r=Wr(r),o&&r;)l=Wr(l),a=Rr(a),a.a=e,i=o.z+u-r.z-c+s(o._,r._),i>0&&($r(Hr(o,e,n),e,i),c+=i,d+=i),u+=o.m,c+=r.m,h+=l.m,d+=a.m;o&&!Rr(a)&&(a.t=o,a.m+=u-d),r&&!Wr(l)&&(l.t=r,l.m+=c-h,n=e)}return n}function a(e){e.x*=l[0],e.y=e.depth*l[1]}var o=fo.layout.hierarchy().sort(null).value(null),s=Pr,l=[1,1],c=null;return e.separation=function(t){return arguments.length?(s=t,e):s},e.size=function(t){return arguments.length?(c=null==(l=t)?a:null,e):c?null:l},e.nodeSize=function(t){return arguments.length?(c=null==(l=t)?null:a,e):c?l:null},cr(e,o)},fo.layout.cluster=function(){function e(e,a){var o,s=t.call(this,e,a),l=s[0],c=0;ur(l,function(e){var t=e.children;t&&t.length?(e.x=Yr(t),e.y=Vr(t)):(e.x=o?c+=n(e,o):0,e.y=0,o=e)});var d=Fr(l),u=Gr(l),h=d.x-n(d,u)/2,f=u.x+n(u,d)/2;return ur(l,r?function(e){e.x=(e.x-l.x)*i[0],e.y=(l.y-e.y)*i[1]}:function(e){e.x=(e.x-h)/(f-h)*i[0],e.y=(1-(l.y?e.y/l.y:1))*i[1]}),s}var t=fo.layout.hierarchy().sort(null).value(null),n=Pr,i=[1,1],r=!1;return e.separation=function(t){return arguments.length?(n=t,e):n},e.size=function(t){return arguments.length?(r=null==(i=t),e):r?null:i},e.nodeSize=function(t){return arguments.length?(r=null!=(i=t),e):r?i:null},cr(e,t)},fo.layout.treemap=function(){function e(e,t){for(var n,i,r=-1,a=e.length;++r<a;)i=(n=e[r]).value*(t<0?0:t),n.area=isNaN(i)||i<=0?0:i}function t(n){var a=n.children;if(a&&a.length){var o,s,l,c=u(n),d=[],h=a.slice(),p=1/0,g="slice"===f?c.dx:"dice"===f?c.dy:"slice-dice"===f?1&n.depth?c.dy:c.dx:Math.min(c.dx,c.dy);for(e(h,c.dx*c.dy/n.value),d.area=0;(l=h.length)>0;)d.push(o=h[l-1]),d.area+=o.area,"squarify"!==f||(s=i(d,g))<=p?(h.pop(),p=s):(d.area-=d.pop().area,r(d,g,c,!1),g=Math.min(c.dx,c.dy),d.length=d.area=0,p=1/0);d.length&&(r(d,g,c,!0),d.length=d.area=0),a.forEach(t)}}function n(t){var i=t.children;if(i&&i.length){var a,o=u(t),s=i.slice(),l=[];for(e(s,o.dx*o.dy/t.value),l.area=0;a=s.pop();)l.push(a),l.area+=a.area,null!=a.z&&(r(l,a.z?o.dx:o.dy,o,!s.length),l.length=l.area=0);i.forEach(n)}}function i(e,t){for(var n,i=e.area,r=0,a=1/0,o=-1,s=e.length;++o<s;)(n=e[o].area)&&(n<a&&(a=n),n>r&&(r=n));return i*=i,t*=t,i?Math.max(t*r*p/i,i/(t*a*p)):1/0}function r(e,t,n,i){var r,a=-1,o=e.length,s=n.x,c=n.y,d=t?l(e.area/t):0;if(t==n.dx){for((i||d>n.dy)&&(d=n.dy);++a<o;)r=e[a],r.x=s,r.y=c,r.dy=d,s+=r.dx=Math.min(n.x+n.dx-s,d?l(r.area/d):0);r.z=!0,r.dx+=n.x+n.dx-s,n.y+=d,n.dy-=d}else{for((i||d>n.dx)&&(d=n.dx);++a<o;)r=e[a],r.x=s,r.y=c,r.dx=d,c+=r.dy=Math.min(n.y+n.dy-c,d?l(r.area/d):0);r.z=!1,r.dy+=n.y+n.dy-c,n.x+=d,n.dx-=d}}function a(i){var r=o||s(i),a=r[0];return a.x=a.y=0,a.value?(a.dx=c[0],a.dy=c[1]):a.dx=a.dy=0,o&&s.revalue(a),e([a],a.dx*a.dy/a.value),(o?n:t)(a),h&&(o=r),r}var o,s=fo.layout.hierarchy(),l=Math.round,c=[1,1],d=null,u=Ur,h=!1,f="squarify",p=.5*(1+Math.sqrt(5));return a.size=function(e){return arguments.length?(c=e,a):c},a.padding=function(e){function t(t){var n=e.call(a,t,t.depth);return null==n?Ur(t):qr(t,"number"==typeof n?[n,n,n,n]:n)}function n(t){return qr(t,e)}if(!arguments.length)return d;var i;return u=null==(d=e)?Ur:"function"==(i=typeof e)?t:"number"===i?(e=[e,e,e,e],n):n,a},a.round=function(e){return arguments.length?(l=e?Math.round:Number,a):l!=Number},a.sticky=function(e){return arguments.length?(h=e,o=null,a):h},a.ratio=function(e){return arguments.length?(p=e,a):p},a.mode=function(e){return arguments.length?(f=e+"",a):f},cr(a,s)},fo.random={normal:function(e,t){var n=arguments.length;return n<2&&(t=1),n<1&&(e=0),function(){var n,i,r;do{n=2*Math.random()-1,i=2*Math.random()-1,r=n*n+i*i}while(!r||r>1);return e+t*n*Math.sqrt(-2*Math.log(r)/r)}},logNormal:function(){var e=fo.random.normal.apply(fo,arguments);return function(){return Math.exp(e())}},bates:function(e){var t=fo.random.irwinHall(e);return function(){return t()/e}},irwinHall:function(e){return function(){for(var t=0,n=0;n<e;n++)t+=Math.random();return t}}},fo.scale={};var Cl={floor:k,ceil:k};fo.scale.linear=function(){return ea([0,1],[0,1],Mi,!1)};var Sl={s:1,g:1,p:1,r:1,e:1};fo.scale.log=function(){return la(fo.scale.linear().domain([0,1]),10,!0,[1,10])};var Tl=fo.format(".0e"),El={floor:function(e){return-Math.ceil(-e)},ceil:function(e){return-Math.floor(-e)}};fo.scale.pow=function(){return ca(fo.scale.linear(),1,[0,1])},fo.scale.sqrt=function(){return fo.scale.pow().exponent(.5)},fo.scale.ordinal=function(){return ua([],{t:"range",a:[[]]})},fo.scale.category10=function(){return fo.scale.ordinal().range(jl)},fo.scale.category20=function(){return fo.scale.ordinal().range(Al)},fo.scale.category20b=function(){return fo.scale.ordinal().range(Nl)},fo.scale.category20c=function(){return fo.scale.ordinal().range(Ll)};var jl=[2062260,16744206,2924588,14034728,9725885,9197131,14907330,8355711,12369186,1556175].map(Me),Al=[2062260,11454440,16744206,16759672,2924588,10018698,14034728,16750742,9725885,12955861,9197131,12885140,14907330,16234194,8355711,13092807,12369186,14408589,1556175,10410725].map(Me),Nl=[3750777,5395619,7040719,10264286,6519097,9216594,11915115,13556636,9202993,12426809,15186514,15190932,8666169,11356490,14049643,15177372,8077683,10834324,13528509,14589654].map(Me),Ll=[3244733,7057110,10406625,13032431,15095053,16616764,16625259,16634018,3253076,7652470,10607003,13101504,7695281,10394312,12369372,14342891,6513507,9868950,12434877,14277081].map(Me);fo.scale.quantile=function(){return ha([],[])},fo.scale.quantize=function(){return fa(0,1,[0,1])},fo.scale.threshold=function(){return pa([.5],[0,1])},fo.scale.identity=function(){return ga([0,1])},fo.svg={},fo.svg.arc=function(){function e(){var e=Math.max(0,+n.apply(this,arguments)),c=Math.max(0,+i.apply(this,arguments)),d=o.apply(this,arguments)-Go,u=s.apply(this,arguments)-Go,h=Math.abs(u-d),f=d>u?0:1;if(c<e&&(p=c,c=e,e=p),h>=Fo)return t(c,f)+(e?t(e,1-f):"")+"Z";var p,g,m,_,v,y,b,w,x,k,M,C,S=0,T=0,E=[];if((_=(+l.apply(this,arguments)||0)/2)&&(m=a===Il?Math.sqrt(e*e+c*c):+a.apply(this,arguments),f||(T*=-1),c&&(T=oe(m/c*Math.sin(_))),e&&(S=oe(m/e*Math.sin(_)))),c){v=c*Math.cos(d+T),y=c*Math.sin(d+T),b=c*Math.cos(u-T),w=c*Math.sin(u-T);var j=Math.abs(u-d-2*T)<=Vo?0:1;if(T&&xa(v,y,b,w)===f^j){var A=(d+u)/2;v=c*Math.cos(A),y=c*Math.sin(A),b=w=null}}else v=y=0;if(e){x=e*Math.cos(u-S),k=e*Math.sin(u-S),M=e*Math.cos(d+S),C=e*Math.sin(d+S);var N=Math.abs(d-u+2*S)<=Vo?0:1;if(S&&xa(x,k,M,C)===1-f^N){var L=(d+u)/2;x=e*Math.cos(L),k=e*Math.sin(L),M=C=null}}else x=k=0;if(h>zo&&(p=Math.min(Math.abs(c-e)/2,+r.apply(this,arguments)))>.001){g=e<c^f?0:1;var I=p,D=p;if(h<Vo){var O=null==M?[x,k]:null==b?[v,y]:$n([v,y],[M,C],[b,w],[x,k]),P=v-O[0],W=y-O[1],R=b-O[0],$=w-O[1],z=1/Math.sin(Math.acos((P*R+W*$)/(Math.sqrt(P*P+W*W)*Math.sqrt(R*R+$*$)))/2),H=Math.sqrt(O[0]*O[0]+O[1]*O[1]);D=Math.min(p,(e-H)/(z-1)),I=Math.min(p,(c-H)/(z+1))}if(null!=b){var V=ka(null==M?[x,k]:[M,C],[v,y],c,I,f),Y=ka([b,w],[x,k],c,I,f);p===I?E.push("M",V[0],"A",I,",",I," 0 0,",g," ",V[1],"A",c,",",c," 0 ",1-f^xa(V[1][0],V[1][1],Y[1][0],Y[1][1]),",",f," ",Y[1],"A",I,",",I," 0 0,",g," ",Y[0]):E.push("M",V[0],"A",I,",",I," 0 1,",g," ",Y[0])}else E.push("M",v,",",y);if(null!=M){var F=ka([v,y],[M,C],e,-D,f),G=ka([x,k],null==b?[v,y]:[b,w],e,-D,f);p===D?E.push("L",G[0],"A",D,",",D," 0 0,",g," ",G[1],"A",e,",",e," 0 ",f^xa(G[1][0],G[1][1],F[1][0],F[1][1]),",",1-f," ",F[1],"A",D,",",D," 0 0,",g," ",F[0]):E.push("L",G[0],"A",D,",",D," 0 0,",g," ",F[0])}else E.push("L",x,",",k)}else E.push("M",v,",",y),null!=b&&E.push("A",c,",",c," 0 ",j,",",f," ",b,",",w),E.push("L",x,",",k),null!=M&&E.push("A",e,",",e," 0 ",N,",",1-f," ",M,",",C);return E.push("Z"),E.join("")}function t(e,t){return"M0,"+e+"A"+e+","+e+" 0 1,"+t+" 0,"+-e+"A"+e+","+e+" 0 1,"+t+" 0,"+e}var n=_a,i=va,r=ma,a=Il,o=ya,s=ba,l=wa;return e.innerRadius=function(t){return arguments.length?(n=Ne(t),e):n},e.outerRadius=function(t){return arguments.length?(i=Ne(t),e):i},e.cornerRadius=function(t){return arguments.length?(r=Ne(t),e):r},e.padRadius=function(t){return arguments.length?(a=t==Il?Il:Ne(t),e):a},e.startAngle=function(t){return arguments.length?(o=Ne(t),e):o},e.endAngle=function(t){return arguments.length?(s=Ne(t),e):s},e.padAngle=function(t){return arguments.length?(l=Ne(t),e):l},e.centroid=function(){var e=(+n.apply(this,arguments)+ +i.apply(this,arguments))/2,t=(+o.apply(this,arguments)+ +s.apply(this,arguments))/2-Go;return[Math.cos(t)*e,Math.sin(t)*e]},e};var Il="auto";fo.svg.line=function(){return Ma(k)};var Dl=fo.map({linear:Ca,"linear-closed":Sa,step:Ta,"step-before":Ea,"step-after":ja,basis:Oa,"basis-open":Pa,"basis-closed":Wa,bundle:Ra,cardinal:La,"cardinal-open":Aa,"cardinal-closed":Na,monotone:Fa});Dl.forEach(function(e,t){t.key=e,t.closed=/-closed$/.test(e)});var Ol=[0,2/3,1/3,0],Pl=[0,1/3,2/3,0],Wl=[0,1/6,2/3,1/6];fo.svg.line.radial=function(){var e=Ma(Ga);return e.radius=e.x,delete e.x,e.angle=e.y,delete e.y,e},Ea.reverse=ja,ja.reverse=Ea,fo.svg.area=function(){return Ua(k)},fo.svg.area.radial=function(){var e=Ua(Ga);return e.radius=e.x,delete e.x,e.innerRadius=e.x0,delete e.x0,e.outerRadius=e.x1,delete e.x1,e.angle=e.y,delete e.y,e.startAngle=e.y0,delete e.y0,e.endAngle=e.y1,delete e.y1,e},fo.svg.chord=function(){function e(e,s){var l=t(this,a,e,s),c=t(this,o,e,s);return"M"+l.p0+i(l.r,l.p1,l.a1-l.a0)+(n(l,c)?r(l.r,l.p1,l.r,l.p0):r(l.r,l.p1,c.r,c.p0)+i(c.r,c.p1,c.a1-c.a0)+r(c.r,c.p1,l.r,l.p0))+"Z"}function t(e,t,n,i){var r=t.call(e,n,i),a=s.call(e,r,i),o=l.call(e,r,i)-Go,d=c.call(e,r,i)-Go;return{r:a,a0:o,a1:d,p0:[a*Math.cos(o),a*Math.sin(o)],p1:[a*Math.cos(d),a*Math.sin(d)]}}function n(e,t){return e.a0==t.a0&&e.a1==t.a1}function i(e,t,n){return"A"+e+","+e+" 0 "+ +(n>Vo)+",1 "+t}function r(e,t,n,i){return"Q 0,0 "+i}var a=Mn,o=Cn,s=qa,l=ya,c=ba;return e.radius=function(t){return arguments.length?(s=Ne(t),e):s},e.source=function(t){return arguments.length?(a=Ne(t),e):a},e.target=function(t){return arguments.length?(o=Ne(t),e):o},e.startAngle=function(t){return arguments.length?(l=Ne(t),e):l},e.endAngle=function(t){return arguments.length?(c=Ne(t),e):c},e},fo.svg.diagonal=function(){function e(e,r){var a=t.call(this,e,r),o=n.call(this,e,r),s=(a.y+o.y)/2,l=[a,{x:a.x,y:s},{x:o.x,y:s},o];return l=l.map(i),"M"+l[0]+"C"+l[1]+" "+l[2]+" "+l[3]}var t=Mn,n=Cn,i=Ba;return e.source=function(n){return arguments.length?(t=Ne(n),e):t},e.target=function(t){return arguments.length?(n=Ne(t),e):n},e.projection=function(t){return arguments.length?(i=t,e):i},e},fo.svg.diagonal.radial=function(){var e=fo.svg.diagonal(),t=Ba,n=e.projection;return e.projection=function(e){return arguments.length?n(Ja(t=e)):t},e},fo.svg.symbol=function(){function e(e,i){return(Rl.get(t.call(this,e,i))||Ka)(n.call(this,e,i))}var t=Xa,n=Qa;return e.type=function(n){return arguments.length?(t=Ne(n),e):t},e.size=function(t){return arguments.length?(n=Ne(t),e):n},e};var Rl=fo.map({circle:Ka,cross:function(e){var t=Math.sqrt(e/5)/2;return"M"+-3*t+","+-t+"H"+-t+"V"+-3*t+"H"+t+"V"+-t+"H"+3*t+"V"+t+"H"+t+"V"+3*t+"H"+-t+"V"+t+"H"+-3*t+"Z"},diamond:function(e){var t=Math.sqrt(e/(2*zl)),n=t*zl;return"M0,"+-t+"L"+n+",0 0,"+t+" "+-n+",0Z"},square:function(e){var t=Math.sqrt(e)/2;return"M"+-t+","+-t+"L"+t+","+-t+" "+t+","+t+" "+-t+","+t+"Z"},"triangle-down":function(e){var t=Math.sqrt(e/$l),n=t*$l/2;return"M0,"+n+"L"+t+","+-n+" "+-t+","+-n+"Z"},"triangle-up":function(e){var t=Math.sqrt(e/$l),n=t*$l/2;return"M0,"+-n+"L"+t+","+n+" "+-t+","+n+"Z"}});fo.svg.symbolTypes=Rl.keys();var $l=Math.sqrt(3),zl=Math.tan(30*Uo);Lo.transition=function(e){for(var t,n,i=Hl||++Gl,r=io(e),a=[],o=Vl||{time:Date.now(),ease:Ni,delay:0,duration:250},s=-1,l=this.length;++s<l;){a.push(t=[]);for(var c=this[s],d=-1,u=c.length;++d<u;)(n=c[d])&&ro(n,d,r,i,o),t.push(n)}return eo(a,r,i)},Lo.interrupt=function(e){return this.each(null==e?Yl:Za(io(e)))};var Hl,Vl,Yl=Za(io()),Fl=[],Gl=0;Fl.call=Lo.call,Fl.empty=Lo.empty,Fl.node=Lo.node,Fl.size=Lo.size,fo.transition=function(e,t){return e&&e.transition?Hl?e.transition(t):e:fo.selection().transition(e)},fo.transition.prototype=Fl,Fl.select=function(e){var t,n,i,r=this.id,a=this.namespace,o=[];e=I(e);for(var s=-1,l=this.length;++s<l;){o.push(t=[]);for(var c=this[s],d=-1,u=c.length;++d<u;)(i=c[d])&&(n=e.call(i,i.__data__,d,s))?("__data__"in i&&(n.__data__=i.__data__),ro(n,d,a,r,i[a][r]),t.push(n)):t.push(null)}return eo(o,a,r)},Fl.selectAll=function(e){var t,n,i,r,a,o=this.id,s=this.namespace,l=[];e=D(e);for(var c=-1,d=this.length;++c<d;)for(var u=this[c],h=-1,f=u.length;++h<f;)if(i=u[h]){a=i[s][o],n=e.call(i,i.__data__,h,c),l.push(t=[]);for(var p=-1,g=n.length;++p<g;)(r=n[p])&&ro(r,p,s,o,a),t.push(r)}return eo(l,s,o)},Fl.filter=function(e){var t,n,i,r=[];"function"!=typeof e&&(e=U(e));for(var a=0,o=this.length;a<o;a++){r.push(t=[]);for(var n=this[a],s=0,l=n.length;s<l;s++)(i=n[s])&&e.call(i,i.__data__,s,a)&&t.push(i)}return eo(r,this.namespace,this.id)},Fl.tween=function(e,t){var n=this.id,i=this.namespace;return arguments.length<2?this.node()[i][n].tween.get(e):B(this,null==t?function(t){t[i][n].tween.remove(e)}:function(r){r[i][n].tween.set(e,t)})},Fl.attr=function(e,t){function n(){this.removeAttribute(s)}function i(){this.removeAttributeNS(s.space,s.local)}function r(e){return null==e?n:(e+="",function(){var t,n=this.getAttribute(s);return n!==e&&(t=o(n,e),function(e){this.setAttribute(s,t(e))})})}function a(e){return null==e?i:(e+="",function(){var t,n=this.getAttributeNS(s.space,s.local);return n!==e&&(t=o(n,e),function(e){this.setAttributeNS(s.space,s.local,t(e))})})}if(arguments.length<2){for(t in e)this.attr(t,e[t]);return this}var o="transform"==e?Ki:Mi,s=fo.ns.qualify(e);return to(this,"attr."+e,t,s.local?a:r)},Fl.attrTween=function(e,t){function n(e,n){var i=t.call(this,e,n,this.getAttribute(r));return i&&function(e){this.setAttribute(r,i(e))}}function i(e,n){var i=t.call(this,e,n,this.getAttributeNS(r.space,r.local));return i&&function(e){this.setAttributeNS(r.space,r.local,i(e))}}var r=fo.ns.qualify(e);return this.tween("attr."+e,r.local?i:n)},Fl.style=function(e,t,n){function i(){this.style.removeProperty(e)}function r(t){return null==t?i:(t+="",function(){var i,r=o(this).getComputedStyle(this,null).getPropertyValue(e);return r!==t&&(i=Mi(r,t),function(t){this.style.setProperty(e,i(t),n)})})}var a=arguments.length;if(a<3){if("string"!=typeof e){a<2&&(t="");for(n in e)this.style(n,e[n],t);return this}n=""}return to(this,"style."+e,t,r)},Fl.styleTween=function(e,t,n){function i(i,r){var a=t.call(this,i,r,o(this).getComputedStyle(this,null).getPropertyValue(e));return a&&function(t){this.style.setProperty(e,a(t),n)}}return arguments.length<3&&(n=""),this.tween("style."+e,i)},Fl.text=function(e){return to(this,"text",e,no)},Fl.remove=function(){var e=this.namespace;return this.each("end.transition",function(){var t;this[e].count<2&&(t=this.parentNode)&&t.removeChild(this)})},Fl.ease=function(e){var t=this.id,n=this.namespace;return arguments.length<1?this.node()[n][t].ease:("function"!=typeof e&&(e=fo.ease.apply(fo,arguments)),B(this,function(i){i[n][t].ease=e}))},Fl.delay=function(e){var t=this.id,n=this.namespace;return arguments.length<1?this.node()[n][t].delay:B(this,"function"==typeof e?function(i,r,a){i[n][t].delay=+e.call(i,i.__data__,r,a)}:(e=+e,function(i){i[n][t].delay=e}))},Fl.duration=function(e){var t=this.id,n=this.namespace;return arguments.length<1?this.node()[n][t].duration:B(this,"function"==typeof e?function(i,r,a){i[n][t].duration=Math.max(1,e.call(i,i.__data__,r,a))}:(e=Math.max(1,e),function(i){i[n][t].duration=e}))},Fl.each=function(e,t){var n=this.id,i=this.namespace;if(arguments.length<2){var r=Vl,a=Hl;try{Hl=n,B(this,function(t,r,a){Vl=t[i][n],e.call(t,t.__data__,r,a)})}finally{Vl=r,Hl=a}}else B(this,function(r){var a=r[i][n];(a.event||(a.event=fo.dispatch("start","end","interrupt"))).on(e,t)});return this},Fl.transition=function(){for(var e,t,n,i,r=this.id,a=++Gl,o=this.namespace,s=[],l=0,c=this.length;l<c;l++){s.push(e=[]);for(var t=this[l],d=0,u=t.length;d<u;d++)(n=t[d])&&(i=n[o][r],ro(n,d,o,a,{time:i.time,ease:i.ease,delay:i.delay+i.duration,duration:i.duration})),e.push(n)}return eo(s,o,a)},fo.svg.axis=function(){function e(e){e.each(function(){var e,c=fo.select(this),d=this.__chart__||n,u=this.__chart__=n.copy(),h=null==l?u.ticks?u.ticks.apply(u,s):u.domain():l,f=null==t?u.tickFormat?u.tickFormat.apply(u,s):k:t,p=c.selectAll(".tick").data(h,u),g=p.enter().insert("g",".domain").attr("class","tick").style("opacity",zo),m=fo.transition(p.exit()).style("opacity",zo).remove(),_=fo.transition(p.order()).style("opacity",1),v=Math.max(r,0)+o,y=Jr(u),b=c.selectAll(".domain").data([0]),w=(b.enter().append("path").attr("class","domain"),fo.transition(b));g.append("line"),g.append("text");var x,M,C,S,T=g.select("line"),E=_.select("line"),j=p.select("text").text(f),A=g.select("text"),N=_.select("text"),L="top"===i||"left"===i?-1:1;if("bottom"===i||"top"===i?(e=ao,x="x",C="y",M="x2",S="y2",j.attr("dy",L<0?"0em":".71em").style("text-anchor","middle"),w.attr("d","M"+y[0]+","+L*a+"V0H"+y[1]+"V"+L*a)):(e=oo,x="y",C="x",M="y2",S="x2",j.attr("dy",".32em").style("text-anchor",L<0?"end":"start"),w.attr("d","M"+L*a+","+y[0]+"H0V"+y[1]+"H"+L*a)),T.attr(S,L*r),A.attr(C,L*v),E.attr(M,0).attr(S,L*r),N.attr(x,0).attr(C,L*v),u.rangeBand){var I=u,D=I.rangeBand()/2;d=u=function(e){return I(e)+D}}else d.rangeBand?d=u:m.call(e,u,d);g.call(e,d,u),_.call(e,u,u)})}var t,n=fo.scale.linear(),i=Ul,r=6,a=6,o=3,s=[10],l=null;return e.scale=function(t){return arguments.length?(n=t,e):n},e.orient=function(t){return arguments.length?(i=t in ql?t+"":Ul,e):i},e.ticks=function(){return arguments.length?(s=go(arguments),e):s},e.tickValues=function(t){return arguments.length?(l=t,e):l},e.tickFormat=function(n){return arguments.length?(t=n,e):t},e.tickSize=function(t){var n=arguments.length;return n?(r=+t,a=+arguments[n-1],e):r},e.innerTickSize=function(t){return arguments.length?(r=+t,e):r},e.outerTickSize=function(t){return arguments.length?(a=+t,e):a},e.tickPadding=function(t){return arguments.length?(o=+t,e):o},e.tickSubdivide=function(){return arguments.length&&e},e};var Ul="bottom",ql={top:1,right:1,bottom:1,left:1};fo.svg.brush=function(){function e(a){a.each(function(){var a=fo.select(this).style("pointer-events","all").style("-webkit-tap-highlight-color","rgba(0,0,0,0)").on("mousedown.brush",r).on("touchstart.brush",r),o=a.selectAll(".background").data([0]);o.enter().append("rect").attr("class","background").style("visibility","hidden").style("cursor","crosshair"),a.selectAll(".extent").data([0]).enter().append("rect").attr("class","extent").style("cursor","move");var s=a.selectAll(".resize").data(g,k);s.exit().remove(),s.enter().append("g").attr("class",function(e){return"resize "+e}).style("cursor",function(e){return Bl[e]}).append("rect").attr("x",function(e){return/[ew]$/.test(e)?-3:null}).attr("y",function(e){return/^[ns]/.test(e)?-3:null}).attr("width",6).attr("height",6).style("visibility","hidden"),s.style("display",e.empty()?"none":null);var l,u=fo.transition(a),h=fo.transition(o);c&&(l=Jr(c),h.attr("x",l[0]).attr("width",l[1]-l[0]),n(u)),d&&(l=Jr(d),h.attr("y",l[0]).attr("height",l[1]-l[0]),i(u)),t(u)})}function t(e){e.selectAll(".resize").attr("transform",function(e){return"translate("+u[+/e$/.test(e)]+","+h[+/^s/.test(e)]+")"})}function n(e){e.select(".extent").attr("x",u[0]),e.selectAll(".extent,.n>rect,.s>rect").attr("width",u[1]-u[0])}function i(e){e.select(".extent").attr("y",h[0]),e.selectAll(".extent,.e>rect,.w>rect").attr("height",h[1]-h[0])}function r(){function r(){32==fo.event.keyCode&&(E||(y=null,N[0]-=u[1],N[1]-=h[1],E=2),j())}function g(){32==fo.event.keyCode&&2==E&&(N[0]+=u[1],N[1]+=h[1],E=0,j())}function m(){var e=fo.mouse(w),r=!1;b&&(e[0]+=b[0],e[1]+=b[1]),E||(fo.event.altKey?(y||(y=[(u[0]+u[1])/2,(h[0]+h[1])/2]),N[0]=u[+(e[0]<y[0])],N[1]=h[+(e[1]<y[1])]):y=null),S&&_(e,c,0)&&(n(M),r=!0),T&&_(e,d,1)&&(i(M),r=!0),r&&(t(M),k({type:"brush",mode:E?"move":"resize"}))}function _(e,t,n){var i,r,o=Jr(t),l=o[0],c=o[1],d=N[n],g=n?h:u,m=g[1]-g[0];if(E&&(l-=d,c-=m+d),i=(n?p:f)?Math.max(l,Math.min(c,e[n])):e[n],E?r=(i+=d)+m:(y&&(d=Math.max(l,Math.min(c,2*y[n]-i))),d<i?(r=i,i=d):r=d),g[0]!=i||g[1]!=r)return n?s=null:a=null,g[0]=i,g[1]=r,!0}function v(){m(),M.style("pointer-events","all").selectAll(".resize").style("display",e.empty()?"none":null),fo.select("body").style("cursor",null),L.on("mousemove.brush",null).on("mouseup.brush",null).on("touchmove.brush",null).on("touchend.brush",null).on("keydown.brush",null).on("keyup.brush",null),A(),k({type:"brushend"})}var y,b,w=this,x=fo.select(fo.event.target),k=l.of(w,arguments),M=fo.select(w),C=x.datum(),S=!/^(n|s)$/.test(C)&&c,T=!/^(e|w)$/.test(C)&&d,E=x.classed("extent"),A=ee(w),N=fo.mouse(w),L=fo.select(o(w)).on("keydown.brush",r).on("keyup.brush",g);if(fo.event.changedTouches?L.on("touchmove.brush",m).on("touchend.brush",v):L.on("mousemove.brush",m).on("mouseup.brush",v),M.interrupt().selectAll("*").interrupt(),E)N[0]=u[0]-N[0],N[1]=h[0]-N[1];else if(C){var I=+/w$/.test(C),D=+/^n/.test(C);b=[u[1-I]-N[0],h[1-D]-N[1]],N[0]=u[I],N[1]=h[D]}else fo.event.altKey&&(y=N.slice());M.style("pointer-events","none").selectAll(".resize").style("display",null),fo.select("body").style("cursor",x.style("cursor")),k({type:"brushstart"}),m()}var a,s,l=N(e,"brushstart","brush","brushend"),c=null,d=null,u=[0,0],h=[0,0],f=!0,p=!0,g=Jl[0];return e.event=function(e){e.each(function(){var e=l.of(this,arguments),t={x:u,y:h,i:a,j:s},n=this.__chart__||t;this.__chart__=t,Hl?fo.select(this).transition().each("start.brush",function(){a=n.i,s=n.j,u=n.x,h=n.y,e({type:"brushstart"})}).tween("brush:brush",function(){var n=Ci(u,t.x),i=Ci(h,t.y);return a=s=null,function(r){u=t.x=n(r),h=t.y=i(r),e({type:"brush",mode:"resize"})}}).each("end.brush",function(){a=t.i,s=t.j,e({type:"brush",mode:"resize"}),e({type:"brushend"})}):(e({type:"brushstart"}),e({type:"brush",mode:"resize"}),e({type:"brushend"}))})},e.x=function(t){return arguments.length?(c=t,g=Jl[!c<<1|!d],e):c},e.y=function(t){return arguments.length?(d=t,g=Jl[!c<<1|!d],e):d},e.clamp=function(t){return arguments.length?(c&&d?(f=!!t[0],p=!!t[1]):c?f=!!t:d&&(p=!!t),e):c&&d?[f,p]:c?f:d?p:null},e.extent=function(t){var n,i,r,o,l;return arguments.length?(c&&(n=t[0],i=t[1],d&&(n=n[0],i=i[0]),a=[n,i],c.invert&&(n=c(n),i=c(i)),i<n&&(l=n,n=i,i=l),n==u[0]&&i==u[1]||(u=[n,i])),d&&(r=t[0],o=t[1],c&&(r=r[1],o=o[1]),s=[r,o],d.invert&&(r=d(r),o=d(o)),o<r&&(l=r,r=o,o=l),r==h[0]&&o==h[1]||(h=[r,o])),e):(c&&(a?(n=a[0],i=a[1]):(n=u[0],i=u[1],c.invert&&(n=c.invert(n),i=c.invert(i)),i<n&&(l=n,n=i,i=l))),d&&(s?(r=s[0],o=s[1]):(r=h[0],o=h[1],d.invert&&(r=d.invert(r),o=d.invert(o)),o<r&&(l=r,r=o,o=l))),c&&d?[[n,r],[i,o]]:c?[n,i]:d&&[r,o])},e.clear=function(){return e.empty()||(u=[0,0],h=[0,0],a=s=null),e},e.empty=function(){return!!c&&u[0]==u[1]||!!d&&h[0]==h[1]},fo.rebind(e,l,"on")};var Bl={n:"ns-resize",e:"ew-resize",s:"ns-resize",w:"ew-resize",nw:"nwse-resize",ne:"nesw-resize",se:"nwse-resize",sw:"nesw-resize"},Jl=[["n","e","s","w","nw","ne","se","sw"],["e","w"],["n","s"],[]],Ql=gs.format=ws.timeFormat,Xl=Ql.utc,Kl=Xl("%Y-%m-%dT%H:%M:%S.%LZ");Ql.iso=Date.prototype.toISOString&&+new Date("2000-01-01T00:00:00.000Z")?so:Kl,so.parse=function(e){var t=new Date(e);return isNaN(t)?null:t},so.toString=Kl.toString,gs.second=Ge(function(e){return new ms(1e3*Math.floor(e/1e3))},function(e,t){e.setTime(e.getTime()+1e3*Math.floor(t))},function(e){return e.getSeconds()}),gs.seconds=gs.second.range,gs.seconds.utc=gs.second.utc.range,gs.minute=Ge(function(e){return new ms(6e4*Math.floor(e/6e4))},function(e,t){e.setTime(e.getTime()+6e4*Math.floor(t))},function(e){return e.getMinutes()}),gs.minutes=gs.minute.range,gs.minutes.utc=gs.minute.utc.range,gs.hour=Ge(function(e){var t=e.getTimezoneOffset()/60;return new ms(36e5*(Math.floor(e/36e5-t)+t))},function(e,t){e.setTime(e.getTime()+36e5*Math.floor(t))},function(e){return e.getHours()}),gs.hours=gs.hour.range,gs.hours.utc=gs.hour.utc.range,gs.month=Ge(function(e){return e=gs.day(e),e.setDate(1),e},function(e,t){e.setMonth(e.getMonth()+t)},function(e){return e.getMonth()}),gs.months=gs.month.range,gs.months.utc=gs.month.utc.range;var Zl=[1e3,5e3,15e3,3e4,6e4,3e5,9e5,18e5,36e5,108e5,216e5,432e5,864e5,1728e5,6048e5,2592e6,7776e6,31536e6],ec=[[gs.second,1],[gs.second,5],[gs.second,15],[gs.second,30],[gs.minute,1],[gs.minute,5],[gs.minute,15],[gs.minute,30],[gs.hour,1],[gs.hour,3],[gs.hour,6],[gs.hour,12],[gs.day,1],[gs.day,2],[gs.week,1],[gs.month,1],[gs.month,3],[gs.year,1]],tc=Ql.multi([[".%L",function(e){return e.getMilliseconds()}],[":%S",function(e){return e.getSeconds()}],["%I:%M",function(e){return e.getMinutes()}],["%I %p",function(e){return e.getHours()}],["%a %d",function(e){return e.getDay()&&1!=e.getDate()}],["%b %d",function(e){return 1!=e.getDate()}],["%B",function(e){return e.getMonth()}],["%Y",Dt]]),nc={range:function(e,t,n){return fo.range(Math.ceil(e/n)*n,+t,n).map(co)},floor:k,ceil:k};ec.year=gs.year,gs.scale=function(){return lo(fo.scale.linear(),ec,tc)};var ic=ec.map(function(e){return[e[0].utc,e[1]]}),rc=Xl.multi([[".%L",function(e){return e.getUTCMilliseconds()}],[":%S",function(e){return e.getUTCSeconds()}],["%I:%M",function(e){return e.getUTCMinutes()}],["%I %p",function(e){return e.getUTCHours()}],["%a %d",function(e){return e.getUTCDay()&&1!=e.getUTCDate()}],["%b %d",function(e){return 1!=e.getUTCDate()}],["%B",function(e){return e.getUTCMonth()}],["%Y",Dt]]);ic.year=gs.year.utc,gs.scale.utc=function(){return lo(fo.scale.linear(),ic,rc)},fo.text=Le(function(e){return e.responseText}),fo.json=function(e,t){return Ie(e,"application/json",uo,t)},fo.html=function(e,t){return Ie(e,"text/html",ho,t)},fo.xml=Le(function(e){return e.responseXML}),this.d3=fo,i=fo,void 0!==(r="function"==typeof i?i.call(t,n,t,e):i)&&(e.exports=r)}()},,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={tool:"fa-wrench",data_input:"fa-file-o",data_collection_input:"fa-folder-o",subworkflow:"fa-sitemap fa-rotate-270",pause:"fa-pause"}},function(e,t,n){"use strict";(function(e,i){function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var a=n(42),o=r(a),s=n(97),l=r(s),c=n(10),d=(r(c),n(3)),u=r(d),h=o.default.HDCAListItemView,f=h.extend({initialize:function(e){h.prototype.initialize.call(this,e),this.purgeAllowed=e.purgeAllowed||!1},_getFoldoutPanelClass:function(){return l.default.CollectionViewEdit},_renderPrimaryActions:function(){return this.log(this+"._renderPrimaryActions"),h.prototype._renderPrimaryActions.call(this).concat([this._renderDeleteButton()])},_renderDeleteButton:function(){return e('\n                <div class="dropdown">\n                    <a class="delete-btn icon-btn" title="'+(0,u.default)("Delete")+'" data-toggle="dropdown">\n                        <span class="fa fa-times"></span>\n                    </a>\n                    <ul class="dropdown-menu pull-right" role="menu">\n                        <li>\n                            <a href="#" class="delete-collection">\n                                '+(0,u.default)("Collection Only")+'\n                            </a>\n                        </li>\n                        <li>\n                            <a href="#" class="delete-collection-and-datasets">\n                                '+(0,u.default)("Delete Datasets")+'\n                            </a>\n                        </li>\n                        <li style="display: '+(this.purgeAllowed?"inherit":"none")+'">\n                            <a href="#" class="delete-collection-and-purge-datasets">\n                                '+(0,u.default)("Permanently Delete Datasets")+"\n                            </a>\n                        </li>\n                    </ul>\n                </div>")},events:i.extend(i.clone(h.prototype.events),{"click .delete-collection":function(e){this.model.delete()},"click .delete-collection-and-datasets":function(e){this.model.delete(!0)},"click .delete-collection-and-purge-datasets":function(e){this.model.delete(!0,!0)}}),toString:function(){return"HDCAListItemEdit("+(this.model?""+this.model:"(no model)")+")"}});t.default={HDCAListItemEdit:f}}).call(t,n(0),n(1))},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var r=n(60),a=i(r),o=n(30),s=(i(o),n(98)),l=i(s),c=n(4),d=(i(c),n(23)),u=i(d),h=n(10),f=(i(h),n(3)),p=i(f);n(15);var g=a.default.CollectionView,m=g.extend({DatasetDCEViewClass:l.default.DatasetDCEListItemEdit,NestedDCDCEViewClass:l.default.NestedDCDCEListItemEdit,getNestedDCDCEViewClass:function(){return l.default.NestedDCDCEListItemEdit.extend({foldoutPanelClass:m})},initialize:function(e){g.prototype.initialize.call(this,e)},_setUpBehaviors:function(e){if(e=e||this.$el,g.prototype._setUpBehaviors.call(this,e),this.model&&Galaxy.user&&!Galaxy.user.isAnonymous()){this.tagsEditorShown=!0;var t=this;e.find("> .controls .name").attr("title",(0,p.default)("Click to rename collection")).tooltip({placement:"bottom"}).make_text_editable({on_finish:function(e){var n=t.model.get("name");e&&e!==n?(t.$el.find("> .controls .name").text(e),t.model.save({name:e}).fail(function(){t.$el.find("> .controls .name").text(t.model.previous("name"))})):t.$el.find("> .controls .name").text(n)}}),this.tagsEditor=new u.default.TagsEditor({model:this.model,el:e.find(".tags-display"),onshowFirstTime:function(){this.render()},usePrompt:!1}),this.tagsEditor.toggle(!0)}},toString:function(){return"CollectionViewEdit("+(this.model?this.model.get("name"):"")+")"}});t.default={CollectionViewEdit:m}},function(e,t,n){"use strict";(function(e,i){function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var a=n(32),o=r(a),s=n(61),l=r(s),c=n(4),d=(r(c),n(3)),u=(r(d),o.default.DCListItemView),h=u.extend({initialize:function(e){u.prototype.initialize.call(this,e)},toString:function(){return"DCListItemEdit("+(this.model?""+this.model:"(no model)")+")"}}),f=o.default.DCEListItemView,p=f.extend({initialize:function(e){f.prototype.initialize.call(this,e)},toString:function(){return"DCEListItemEdit("+(this.model?""+this.model:"(no model)")+")"}}),g=l.default.DatasetListItemEdit.extend({initialize:function(e){l.default.DatasetListItemEdit.prototype.initialize.call(this,e)},_fetchModelDetails:function(){var t=this;return t.model.inReadyState()&&!t.model.hasDetails()?t.model.fetch({silent:!0}):e.when()},_renderDeleteButton:function(){return null},toString:function(){return"DatasetDCEListItemEdit("+(this.model?""+this.model:"(no model)")+")"}});g.prototype.templates=function(){return i.extend({},l.default.DatasetListItemEdit.prototype.templates,{titleBar:o.default.DatasetDCEListItemView.prototype.templates.titleBar})}();var m=o.default.NestedDCDCEListItemView.extend({toString:function(){return"NestedDCDCEListItemEdit("+(this.model?""+this.model:"(no model)")+")"}});t.default={DCListItemEdit:h,DCEListItemEdit:p,DatasetDCEListItemEdit:g,NestedDCDCEListItemEdit:m}}).call(t,n(0),n(1))},function(e,t,n){"use strict";function i(e,t){if(0===e.length)return t.length;if(0===t.length)return e.length;var n,i=[];for(n=0;n<=t.length;n++)i[n]=[n];var r;for(r=0;r<=e.length;r++)i[0][r]=r;for(n=1;n<=t.length;n++)for(r=1;r<=e.length;r++)t.charAt(n-1)===e.charAt(r-1)?i[n][r]=i[n-1][r-1]:i[n][r]=Math.min(i[n-1][r-1]+1,Math.min(i[n][r-1]+1,i[n-1][r]+1));return i[t.length][e.length]}Object.defineProperty(t,"__esModule",{value:!0}),t.default=i},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";(function(e){function n(e,t){this.canvas=null,this.dragging=!1,this.inner_color="#FFFFFF",this.outer_color="#D8B365",e&&t&&this.connect(e,t)}Object.defineProperty(t,"__esModule",{value:!0}),e.extend(n.prototype,{connect:function(e,t){this.handle1=e,this.handle1&&this.handle1.connect(this),this.handle2=t,this.handle2&&this.handle2.connect(this)},destroy:function(){this.handle1&&this.handle1.disconnect(this),this.handle2&&this.handle2.disconnect(this),e(this.canvas).remove()},destroyIfInvalid:function(){this.handle1&&this.handle2&&!this.handle2.attachable(this.handle1)&&this.destroy()},redraw:function(){var t=e("#canvas-container");this.canvas||(this.canvas=document.createElement("canvas"),t.append(e(this.canvas)),this.dragging&&(this.canvas.style.zIndex="300"));var n=function(n){return e(n).offset().left-t.offset().left},i=function(n){return e(n).offset().top-t.offset().top};if(this.handle1&&this.handle2){var r=n(this.handle1.element)+5,a=i(this.handle1.element)+5,o=n(this.handle2.element)+5,s=i(this.handle2.element)+5,l=Math.min(r,o),c=Math.max(r,o),d=Math.min(a,s),u=Math.max(a,s),h=Math.min(Math.max(Math.abs(u-d)/2,100),300),f=l-100,p=d-100,g=c-l+200,m=u-d+200;this.canvas.style.left=f+"px",this.canvas.style.top=p+"px",this.canvas.setAttribute("width",g),this.canvas.setAttribute("height",m),r-=f,a-=p,o-=f,s-=p;var _=(this.canvas.getContext("2d"),null),v=null,y=1;if(this.handle1&&this.handle1.isMappedOver()){var _=[-6,-3,0,3,6];y=5}else var _=[0];if(this.handle2&&this.handle2.isMappedOver()){var v=[-6,-3,0,3,6];y=5}else var v=[0];for(var b=this,w=0;w<y;w++){var x=5,k=7;(_.length>1||v.length>1)&&(x=1,k=3),b.draw_outlined_curve(r,a,o,s,h,x,k,_[w%_.length],v[w%v.length])}}},draw_outlined_curve:function(e,t,n,i,r,a,o,s,l){var s=s||0,l=l||0,c=this.canvas.getContext("2d");c.lineCap="round",c.strokeStyle=this.outer_color,c.lineWidth=o,c.beginPath(),c.moveTo(e,t+s),c.bezierCurveTo(e+r,t+s,n-r,i+l,n,i+l),c.stroke(),c.strokeStyle=this.inner_color,c.lineWidth=a,c.beginPath(),c.moveTo(e,t+s),c.bezierCurveTo(e+r,t+s,n-r,i+l,n,i+l),c.stroke()}}),t.default=n}).call(t,n(0))},function(e,t,n){"use strict";(function(e,i,r,a){function o(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var s=n(3),l=o(s),c=n(7),d=o(c),u=n(18),h=o(u),f=n(5),p=o(f),g=n(12),m=o(g),_=e.View.extend({el:"#center",model:null,options:{},defaults:{edit_mode:!1},events:{"click .toolbtn_modify_dataset":"enableModification","click .toolbtn_cancel_modifications":"render","click .toolbtn-download-dataset":"downloadDataset","click .toolbtn-import-dataset":"importIntoHistory","click .copy-link-to-clipboard":"copyToClipboard","click .make-private":"makeDatasetPrivate","click .remove-restrictions":"removeDatasetRestrictions","click .toolbtn_save_permissions":"savePermissions","click .toolbtn_save_modifications":"saveModifications"},select_genome:null,select_extension:null,list_extensions:[],auto:{id:"auto",text:"Auto-detect",description:"This system will try to detect the file type automatically. If your file is not detected properly as one of the known formats, it most likely means that it has some format problems (e.g., different number of columns on different rows). You can still coerce the system to set your data to the format you think it should be. You can also upload compressed files, which will automatically be decompressed."},list_genomes:[],initialize:function(e){this.options=i.extend(this.options,e),this.fetchExtAndGenomes(),this.options.id&&this.fetchDataset()},fetchDataset:function(e){this.options=i.extend(this.options,e),this.model=new h.default.Item({id:this.options.id});var t=this;this.model.fetch({success:function(){t.options.show_permissions?t.showPermissions():t.options.show_version?t.fetchVersion():t.render()},error:function(e,t){void 0!==t.responseJSON?d.default.error(t.responseJSON.err_msg+" Click this to go back.","",{onclick:function(){Galaxy.libraries.library_router.back()}}):d.default.error("An error occurred. Click this to go back.","",{onclick:function(){Galaxy.libraries.library_router.back()}})}})},render:function(e){this.options=i.extend(this.options,e),r(".tooltip").remove();var t=this.templateDataset();this.$el.html(t({item:this.model})),r(".peek").html(this.model.get("peek")),r("#center [data-toggle]").tooltip()},fetchVersion:function(e){this.options=i.extend(this.options,e);var t=this;this.options.ldda_id?(this.ldda=new h.default.Ldda({id:this.options.ldda_id}),this.ldda.url=this.ldda.urlRoot+this.model.id+"/versions/"+this.ldda.id,this.ldda.fetch({success:function(){t.renderVersion()},error:function(e,t){void 0!==t.responseJSON?d.default.error(t.responseJSON.err_msg):d.default.error("An error occurred.")}})):(this.render(),d.default.error("Library dataset version requested but no id provided."))},renderVersion:function(){r(".tooltip").remove();var e=this.templateVersion();this.$el.html(e({item:this.model,ldda:this.ldda})),r(".peek").html(this.ldda.get("peek"))},enableModification:function(){r(".tooltip").remove();var e=this.templateModifyDataset();this.$el.html(e({item:this.model})),this.renderSelectBoxes({genome_build:this.model.get("genome_build"),file_ext:this.model.get("file_ext")}),r(".peek").html(this.model.get("peek")),r("#center [data-toggle]").tooltip()},downloadDataset:function(){var e=Galaxy.root+"api/libraries/datasets/download/uncompressed",t={ld_ids:this.id};this.processDownload(e,t)},processDownload:function(e,t,n){if(e&&t){t="string"==typeof t?t:r.param(t);var i="";r.each(t.split("&"),function(){var e=this.split("=");i+='<input type="hidden" name="'+e[0]+'" value="'+e[1]+'" />'}),r('<form action="'+e+'" method="'+(n||"post")+'">'+i+"</form>").appendTo("body").submit().remove(),d.default.info("Your download will begin soon.")}},importIntoHistory:function(){this.refreshUserHistoriesList(function(e){var t=e.templateBulkImportInModal();e.modal=Galaxy.modal,e.modal.show({closing_events:!0,title:(0,l.default)("Import into History"),body:t({histories:e.histories.models}),buttons:{Import:function(){e.importCurrentIntoHistory()},Close:function(){Galaxy.modal.hide()}}})})},refreshUserHistoriesList:function(e){var t=this;this.histories=new h.default.GalaxyHistories,this.histories.fetch({success:function(n){0===n.length?d.default.warning("You have to create history first. Click this to do so.","",{onclick:function(){window.location=Galaxy.root}}):e(t)},error:function(e,t){void 0!==t.responseJSON?d.default.error(t.responseJSON.err_msg):d.default.error("An error occurred.")}})},importCurrentIntoHistory:function(){this.modal.disableButton("Import");var e=this.modal.$("input[name=history_name]").val(),t=this;if(""!==e)r.post(Galaxy.root+"api/histories",{name:e}).done(function(e){t.processImportToHistory(e.id)}).fail(function(e,t,n){d.default.error("An error occurred.")}).always(function(){t.modal.enableButton("Import")});else{var n=r(this.modal.$el).find("select[name=dataset_import_single] option:selected").val();this.processImportToHistory(n),this.modal.enableButton("Import")}},processImportToHistory:function(e){var t=new h.default.HistoryItem;t.url=t.urlRoot+e+"/contents",a.getJSON(Galaxy.root+"history/set_as_current?id="+e),t.save({content:this.id,source:"library"},{success:function(){Galaxy.modal.hide(),d.default.success("Dataset imported. Click this to start analyzing it.","",{onclick:function(){window.location=Galaxy.root}})},error:function(e,t){void 0!==t.responseJSON?d.default.error("Dataset not imported. "+t.responseJSON.err_msg):d.default.error("An error occured. Dataset not imported. Please try again.")}})},showPermissions:function(e){var t=this.templateDatasetPermissions(),n=this;this.options=i.extend(this.options,e),r(".tooltip").remove(),void 0!==this.options.fetched_permissions&&(0===this.options.fetched_permissions.access_dataset_roles.length?this.model.set({is_unrestricted:!0}):this.model.set({is_unrestricted:!1})),this.$el.html(t({item:this.model,is_admin:Galaxy.config.is_admin_user})),r.get(Galaxy.root+"api/libraries/datasets/"+n.id+"/permissions?scope=current").done(function(e){n.prepareSelectBoxes({fetched_permissions:e,is_admin:Galaxy.config.is_admin_user})}).fail(function(){d.default.error("An error occurred while attempting to fetch dataset permissions.")}),r("#center [data-toggle]").tooltip(),r("#center").css("overflow","auto")},_serializeRoles:function(e){for(var t=[],n=0;n<e.length;n++)t.push(e[n][1]+":"+e[n][0].replace(":"," ").replace(","," &"));return t},prepareSelectBoxes:function(e){this.options=i.extend(this.options,e),this.accessSelectObject=new m.default.View(this._generate_select_options({selector:"access_perm",initialData:this._serializeRoles(this.options.fetched_permissions.access_dataset_roles)})),this.modifySelectObject=new m.default.View(this._generate_select_options({selector:"modify_perm",initialData:this._serializeRoles(this.options.fetched_permissions.modify_item_roles)})),this.manageSelectObject=new m.default.View(this._generate_select_options({selector:"manage_perm",initialData:this._serializeRoles(this.options.fetched_permissions.manage_dataset_roles)}))},_generate_select_options:function(e){var t={minimumInputLength:0,multiple:!0,placeholder:"Click to select a role",formatResult:function(e){return e.name+" type: "+e.type},formatSelection:function(e){return e.name},initSelection:function(e,t){var n=[];r(e.val().split(",")).each(function(){var e=this.split(":");n.push({id:e[0],name:e[1]})}),t(n)},dropdownCssClass:"bigdrop"};return t.container=this.$el.find("#"+e.selector),t.css=e.selector,t.initialData=e.initialData.join(","),t.ajax={url:Galaxy.root+"api/libraries/datasets/"+this.id+"/permissions?scope=available",dataType:"json",quietMillis:100,data:function(e,t){return{q:e,page_limit:10,page:t}},results:function(e,t){var n=10*t<e.total;return{results:e.roles,more:n}}},t},saveModifications:function(e){var t=!1,n=this.model,i=this.$el.find(".input_dataset_name").val();if(void 0!==i&&i!==n.get("name")){if(!(i.length>0))return void d.default.warning("Library dataset name has to be at least 1 character long.");n.set("name",i),t=!0}var r=this.$el.find(".input_dataset_misc_info").val();void 0!==r&&r!==n.get("misc_info")&&(n.set("misc_info",r),t=!0);var a=this.$el.find(".input_dataset_message").val();void 0!==a&&a!==n.get("message")&&(n.set("message",a),t=!0);var o=this.select_genome.$el.select2("data").id;void 0!==o&&o!==n.get("genome_build")&&(n.set("genome_build",o),t=!0);var s=this.select_extension.$el.select2("data").id;void 0!==s&&s!==n.get("file_ext")&&(n.set("file_ext",s),t=!0);var l=this;t?n.save(null,{patch:!0,success:function(e){l.render(),d.default.success("Changes to library dataset saved.")},error:function(e,t){void 0!==t.responseJSON?d.default.error(t.responseJSON.err_msg):d.default.error("An error occured while attempting to update the library dataset.")}}):(l.render(),d.default.info("Nothing has changed."))},copyToClipboard:function(t){t.preventDefault();var n=e.history.location.href;-1!==n.lastIndexOf("/permissions")&&(n=n.substr(0,n.lastIndexOf("/permissions"))),window.prompt("Copy to clipboard: Ctrl+C, Enter",n)},makeDatasetPrivate:function(){var e=this;r.post(Galaxy.root+"api/libraries/datasets/"+e.id+"/permissions?action=make_private").done(function(t){e.model.set({is_unrestricted:!1}),e.showPermissions({fetched_permissions:t}),d.default.success("The dataset is now private to you.")}).fail(function(){d.default.error("An error occurred while attempting to make dataset private.")})},removeDatasetRestrictions:function(){var e=this;r.post(Galaxy.root+"api/libraries/datasets/"+e.id+"/permissions?action=remove_restrictions").done(function(t){e.model.set({is_unrestricted:!0}),e.showPermissions({fetched_permissions:t}),d.default.success("Access to this dataset is now unrestricted.")}).fail(function(){d.default.error("An error occurred while attempting to make dataset unrestricted.")})},_extractIds:function(e){for(var t=[],n=e.length-1;n>=0;n--)t.push(e[n].id);return t},savePermissions:function(e){var t=this,n=this._extractIds(this.accessSelectObject.$el.select2("data")),i=this._extractIds(this.manageSelectObject.$el.select2("data")),a=this._extractIds(this.modifySelectObject.$el.select2("data"));r.post(Galaxy.root+"api/libraries/datasets/"+t.id+"/permissions?action=set_permissions",{"access_ids[]":n,"manage_ids[]":i,"modify_ids[]":a}).done(function(e){t.showPermissions({fetched_permissions:e}),d.default.success("Permissions saved.")}).fail(function(){d.default.error("An error occurred while attempting to set dataset permissions.")})},fetchExtAndGenomes:function(){var e=this;0==this.list_genomes.length&&p.default.get({url:Galaxy.root+"api/datatypes?extension_only=False",success:function(t){for(var n in t)e.list_extensions.push({id:t[n].extension,text:t[n].extension,description:t[n].description,description_url:t[n].description_url});e.list_extensions.sort(function(e,t){return e.id>t.id?1:e.id<t.id?-1:0}),e.list_extensions.unshift(e.auto)}}),0==this.list_extensions.length&&p.default.get({url:Galaxy.root+"api/genomes",success:function(t){for(var n in t)e.list_genomes.push({id:t[n][1],text:t[n][0]});e.list_genomes.sort(function(e,t){return e.id>t.id?1:e.id<t.id?-1:0})}})},renderSelectBoxes:function(e){var t=this,n="?",i="auto";void 0!==e&&(void 0!==e.genome_build&&(n=e.genome_build),void 0!==e.file_ext&&(i=e.file_ext)),this.select_genome=new m.default.View({css:"dataset-genome-select",data:t.list_genomes,container:t.$el.find("#dataset_genome_select"),value:n}),this.select_extension=new m.default.View({css:"dataset-extension-select",data:t.list_extensions,container:t.$el.find("#dataset_extension_select"),value:i})},templateDataset:function(){return i.template(['<div class="library_style_container">','<div id="library_toolbar">','<button data-toggle="tooltip" data-placement="top" title="Download dataset" class="btn btn-default toolbtn-download-dataset primary-button toolbar-item" type="button">','<span class="fa fa-download"></span>',"&nbsp;Download","</button>",'<button data-toggle="tooltip" data-placement="top" title="Import dataset into history" class="btn btn-default toolbtn-import-dataset primary-button toolbar-item" type="button">','<span class="fa fa-book"></span>',"&nbsp;to History","</button>",'<% if (item.get("can_user_modify")) { %>','<button data-toggle="tooltip" data-placement="top" title="Modify library item" class="btn btn-default toolbtn_modify_dataset primary-button toolbar-item" type="button">','<span class="fa fa-pencil"></span>',"&nbsp;Modify","</button>","<% } %>",'<% if (item.get("can_user_manage")) { %>','<a href="#folders/<%- item.get("folder_id") %>/datasets/<%- item.id %>/permissions">','<button data-toggle="tooltip" data-placement="top" title="Manage permissions" class="btn btn-default toolbtn_change_permissions primary-button toolbar-item" type="button">','<span class="fa fa-group"></span>',"&nbsp;Permissions","</button>","</a>","<% } %>","</div>",'<ol class="breadcrumb">','<li><a title="Return to the list of libraries" href="#">Libraries</a></li>','<% _.each(item.get("full_path"), function(path_item) { %>',"<% if (path_item[0] != item.id) { %>",'<li><a title="Return to this folder" href="#/folders/<%- path_item[0] %>"><%- path_item[1] %></a> </li> ',"<% } else { %>",'<li class="active"><span title="You are here"><%- path_item[1] %></span></li>',"<% } %>","<% }); %>","</ol>",'<% if (item.get("is_unrestricted")) { %>',"<div>",'This dataset is unrestricted so everybody with the link can access it. Just share <span class="copy-link-to-clipboard"><a href=""a>this page</a></span>.',"</div>","<% } %>",'<div class="dataset_table">','<table class="grid table table-striped table-condensed">',"<tr>",'<th class="dataset-first-column" scope="row" id="id_row" data-id="<%= _.escape(item.get("ldda_id")) %>">Name</th>','<td><%= _.escape(item.get("name")) %></td>',"</tr>",'<% if (item.get("file_ext")) { %>',"<tr>",'<th scope="row">Data type</th>','<td><%= _.escape(item.get("file_ext")) %></td>',"</tr>","<% } %>",'<% if (item.get("genome_build")) { %>',"<tr>",'<th scope="row">Genome build</th>','<td><%= _.escape(item.get("genome_build")) %></td>',"</tr>","<% } %>",'<% if (item.get("file_size")) { %>',"<tr>",'<th scope="row">Size</th>','<td><%= _.escape(item.get("file_size")) %></td>',"</tr>","<% } %>",'<% if (item.get("date_uploaded")) { %>',"<tr>",'<th scope="row">Date uploaded (UTC)</th>','<td><%= _.escape(item.get("date_uploaded")) %></td>',"</tr>","<% } %>",'<% if (item.get("uploaded_by")) { %>',"<tr>",'<th scope="row">Uploaded by</th>','<td><%= _.escape(item.get("uploaded_by")) %></td>',"</tr>","<% } %>",'<% if (item.get("metadata_data_lines")) { %>',"<tr>",'<th scope="row">Data Lines</th>','<td scope="row"><%= _.escape(item.get("metadata_data_lines")) %></td>',"</tr>","<% } %>",'<% if (item.get("metadata_comment_lines")) { %>',"<tr>",'<th scope="row">Comment Lines</th>','<td scope="row"><%= _.escape(item.get("metadata_comment_lines")) %></td>',"</tr>","<% } %>",'<% if (item.get("metadata_columns")) { %>',"<tr>",'<th scope="row">Number of Columns</th>','<td scope="row"><%= _.escape(item.get("metadata_columns")) %></td>',"</tr>","<% } %>",'<% if (item.get("metadata_column_types")) { %>',"<tr>",'<th scope="row">Column Types</th>','<td scope="row"><%= _.escape(item.get("metadata_column_types")) %></td>',"</tr>","<% } %>",'<% if (item.get("message")) { %>',"<tr>",'<th scope="row">Message</th>','<td scope="row"><%= _.escape(item.get("message")) %></td>',"</tr>","<% } %>",'<% if (item.get("misc_blurb")) { %>',"<tr>",'<th scope="row">Misc. blurb</th>','<td scope="row"><%= _.escape(item.get("misc_blurb")) %></td>',"</tr>","<% } %>",'<% if (item.get("misc_info")) { %>',"<tr>",'<th scope="row">Misc. info</th>','<td scope="row"><%= _.escape(item.get("misc_info")) %></td>',"</tr>","<% } %>",'<% if (item.get("tags")) { %>',"<tr>",'<th scope="row">Tags</th>','<td scope="row"><%= _.escape(item.get("tags")) %></td>',"</tr>","<% } %>",'<% if ( item.get("uuid") !== "ok" ) { %>',"<tr>",'<th scope="row">UUID</th>','<td scope="row"><%= _.escape(item.get("uuid")) %></td>',"</tr>","<% } %>",'<% if ( item.get("state") !== "ok" ) { %>',"<tr>",'<th scope="row">State</th>','<td scope="row"><%= _.escape(item.get("state")) %></td>',"</tr>","<% } %>","</table>",'<% if (item.get("job_stderr")) { %>',"<h4>Job Standard Error</h4>",'<pre class="code">','<%= _.escape(item.get("job_stderr")) %>',"</pre>","<% } %>",'<% if (item.get("job_stdout")) { %>',"<h4>Job Standard Output</h4>",'<pre class="code">','<%= _.escape(item.get("job_stdout")) %>',"</pre>","<% } %>","<div>",'<pre class="peek">',"</pre>","</div>",'<% if (item.get("has_versions")) { %>',"<div>","<h3>Expired versions:</h3>","<ul>",'<% _.each(item.get("expired_versions"), function(version) { %>','<li><a title="See details of this version" href="#folders/<%- item.get("folder_id") %>/datasets/<%- item.id %>/versions/<%- version[0] %>"><%- version[1] %></a></li>',"<% }) %>","<ul>","</div>","<% } %>","</div>","</div>"].join(""))},templateVersion:function(){return i.template(['<div class="library_style_container">','<div id="library_toolbar">','<a href="#folders/<%- item.get("folder_id") %>/datasets/<%- item.id %>">','<button data-toggle="tooltip" data-placement="top" title="Go to latest dataset" class="btn btn-default primary-button toolbar-item" type="button">','<span class="fa fa-caret-left fa-lg"></span>',"&nbsp;Latest dataset","</button>","<a>","</div>",'<ol class="breadcrumb">','<li><a title="Return to the list of libraries" href="#">Libraries</a></li>','<% _.each(item.get("full_path"), function(path_item) { %>',"<% if (path_item[0] != item.id) { %>",'<li><a title="Return to this folder" href="#/folders/<%- path_item[0] %>"><%- path_item[1] %></a> </li> ',"<% } else { %>",'<li class="active"><span title="You are here"><%- path_item[1] %></span></li>',"<% } %>","<% }); %>","</ol>",'<div class="alert alert-warning">This is an expired version of the library dataset: <%= _.escape(item.get("name")) %></div>','<div class="dataset_table">','<table class="grid table table-striped table-condensed">',"<tr>",'<th scope="row" id="id_row" data-id="<%= _.escape(ldda.id) %>">Name</th>','<td><%= _.escape(ldda.get("name")) %></td>',"</tr>",'<% if (ldda.get("file_ext")) { %>',"<tr>",'<th scope="row">Data type</th>','<td><%= _.escape(ldda.get("file_ext")) %></td>',"</tr>","<% } %>",'<% if (ldda.get("genome_build")) { %>',"<tr>",'<th scope="row">Genome build</th>','<td><%= _.escape(ldda.get("genome_build")) %></td>',"</tr>","<% } %>",'<% if (ldda.get("file_size")) { %>',"<tr>",'<th scope="row">Size</th>','<td><%= _.escape(ldda.get("file_size")) %></td>',"</tr>","<% } %>",'<% if (ldda.get("date_uploaded")) { %>',"<tr>",'<th scope="row">Date uploaded (UTC)</th>','<td><%= _.escape(ldda.get("date_uploaded")) %></td>',"</tr>","<% } %>",'<% if (ldda.get("uploaded_by")) { %>',"<tr>",'<th scope="row">Uploaded by</th>','<td><%= _.escape(ldda.get("uploaded_by")) %></td>',"</tr>","<% } %>",'<% if (ldda.get("metadata_data_lines")) { %>',"<tr>",'<th scope="row">Data Lines</th>','<td scope="row"><%= _.escape(ldda.get("metadata_data_lines")) %></td>',"</tr>","<% } %>",'<% if (ldda.get("metadata_comment_lines")) { %>',"<tr>",'<th scope="row">Comment Lines</th>','<td scope="row"><%= _.escape(ldda.get("metadata_comment_lines")) %></td>',"</tr>","<% } %>",'<% if (ldda.get("metadata_columns")) { %>',"<tr>",'<th scope="row">Number of Columns</th>','<td scope="row"><%= _.escape(ldda.get("metadata_columns")) %></td>',"</tr>","<% } %>",'<% if (ldda.get("metadata_column_types")) { %>',"<tr>",'<th scope="row">Column Types</th>','<td scope="row"><%= _.escape(ldda.get("metadata_column_types")) %></td>',"</tr>","<% } %>",'<% if (ldda.get("message")) { %>',"<tr>",'<th scope="row">Message</th>','<td scope="row"><%= _.escape(ldda.get("message")) %></td>',"</tr>","<% } %>",'<% if (ldda.get("misc_blurb")) { %>',"<tr>",'<th scope="row">Miscellaneous blurb</th>','<td scope="row"><%= _.escape(ldda.get("misc_blurb")) %></td>',"</tr>","<% } %>",'<% if (ldda.get("misc_info")) { %>',"<tr>",'<th scope="row">Miscellaneous information</th>','<td scope="row"><%= _.escape(ldda.get("misc_info")) %></td>',"</tr>","<% } %>",'<% if (item.get("tags")) { %>',"<tr>",'<th scope="row">Tags</th>','<td scope="row"><%= _.escape(item.get("tags")) %></td>',"</tr>","<% } %>","</table>","<div>",'<pre class="peek">',"</pre>","</div>","</div>","</div>"].join(""))},templateModifyDataset:function(){return i.template(['<div class="library_style_container">','<div id="library_toolbar">','<button data-toggle="tooltip" data-placement="top" title="Cancel modifications" class="btn btn-default toolbtn_cancel_modifications primary-button toolbar-item" type="button">','<span class="fa fa-times"></span>',"&nbsp;Cancel","</button>",'<button data-toggle="tooltip" data-placement="top" title="Save modifications" class="btn btn-default toolbtn_save_modifications primary-button toolbar-item" type="button">','<span class="fa fa-floppy-o"></span>',"&nbsp;Save","</button>","</div>",'<ol class="breadcrumb">','<li><a title="Return to the list of libraries" href="#">Libraries</a></li>','<% _.each(item.get("full_path"), function(path_item) { %>',"<% if (path_item[0] != item.id) { %>",'<li><a title="Return to this folder" href="#/folders/<%- path_item[0] %>"><%- path_item[1] %></a> </li> ',"<% } else { %>",'<li class="active"><span title="You are here"><%- path_item[1] %></span></li>',"<% } %>","<% }); %>","</ol>",'<div class="dataset_table">','<table class="grid table table-striped table-condensed">',"<tr>",'<th class="dataset-first-column" scope="row" id="id_row" data-id="<%= _.escape(item.get("ldda_id")) %>">Name</th>','<td><input class="input_dataset_name form-control" type="text" placeholder="name" value="<%= _.escape(item.get("name")) %>"></td>',"</tr>","<tr>",'<th scope="row">Data type</th>',"<td>",'<span id="dataset_extension_select" class="dataset-extension-select" />',"</td>","</tr>","<tr>",'<th scope="row">Genome build</th>',"<td>",'<span id="dataset_genome_select" class="dataset-genome-select" />',"</td>","</tr>","<tr>",'<th scope="row">Size</th>','<td><%= _.escape(item.get("file_size")) %></td>',"</tr>","<tr>",'<th scope="row">Date uploaded (UTC)</th>','<td><%= _.escape(item.get("date_uploaded")) %></td>',"</tr>","<tr>",'<th scope="row">Uploaded by</th>','<td><%= _.escape(item.get("uploaded_by")) %></td>',"</tr>",'<tr scope="row">','<th scope="row">Data Lines</th>','<td scope="row"><%= _.escape(item.get("metadata_data_lines")) %></td>',"</tr>",'<th scope="row">Comment Lines</th>','<% if (item.get("metadata_comment_lines") === "") { %>','<td scope="row"><%= _.escape(item.get("metadata_comment_lines")) %></td>',"<% } else { %>",'<td scope="row">unknown</td>',"<% } %>","</tr>","<tr>",'<th scope="row">Number of Columns</th>','<td scope="row"><%= _.escape(item.get("metadata_columns")) %></td>',"</tr>","<tr>",'<th scope="row">Column Types</th>','<td scope="row"><%= _.escape(item.get("metadata_column_types")) %></td>',"</tr>","<tr>",'<th scope="row">Message</th>','<td scope="row"><input class="input_dataset_message form-control" type="text" placeholder="message" value="<%= _.escape(item.get("message")) %>"></td>',"</tr>","<tr>",'<th scope="row">Misc. blurb</th>','<td scope="row"><%= _.escape(item.get("misc_blurb")) %></td>',"</tr>","<tr>",'<th scope="row">Misc. information</th>','<td><input class="input_dataset_misc_info form-control" type="text" placeholder="info" value="<%= _.escape(item.get("misc_info")) %>"></td>',"</tr>",'<% if (item.get("tags")) { %>',"<tr>",'<th scope="row">Tags</th>','<td scope="row"><%= _.escape(item.get("tags")) %></td>',"</tr>","<% } %>","</table>","<div>",'<pre class="peek">',"</pre>","</div>","</div>","</div>"].join(""))},templateDatasetPermissions:function(){return i.template(['<div class="library_style_container">','<div id="library_toolbar">','<a href="#folders/<%- item.get("folder_id") %>/datasets/<%- item.id %>">','<button data-toggle="tooltip" data-placement="top" title="Go back to dataset" class="btn btn-default primary-button toolbar-item" type="button">','<span class="fa fa-file-o"></span>',"&nbsp;Dataset Details","</button>","<a>","</div>",'<ol class="breadcrumb">','<li><a title="Return to the list of libraries" href="#">Libraries</a></li>','<% _.each(item.get("full_path"), function(path_item) { %>',"<% if (path_item[0] != item.id) { %>",'<li><a title="Return to this folder" href="#/folders/<%- path_item[0] %>"><%- path_item[1] %></a> </li> ',"<% } else { %>",'<li class="active"><span title="You are here"><%- path_item[1] %></span></li>',"<% } %>","<% }); %>","</ol>",'<h1>Dataset: <%= _.escape(item.get("name")) %></h1>','<div class="alert alert-warning">',"<% if (is_admin) { %>","You are logged in as an <strong>administrator</strong> therefore you can manage any dataset on this Galaxy instance. Please make sure you understand the consequences.","<% } else { %>","You can assign any number of roles to any of the following permission types. However please read carefully the implications of such actions.","<% } %>","</div>",'<div class="dataset_table">',"<h2>Library-related permissions</h2>","<h4>Roles that can modify the library item</h4>",'<div id="modify_perm" class="modify_perm roles-selection"></div>','<div class="alert alert-info roles-selection">User with <strong>any</strong> of these roles can modify name, metadata, and other information about this library item.</div>',"<hr/>","<h2>Dataset-related permissions</h2>",'<div class="alert alert-warning">Changes made below will affect <strong>every</strong> library item that was created from this dataset and also every history this dataset is part of.</div>','<% if (!item.get("is_unrestricted")) { %>','<p>You can <span class="remove-restrictions"><a href="">remove all access restrictions</a></span> on this dataset.</p>',"<% } else { %>",'<p>You can <span class="make-private"><a href="">make this dataset private</a></span> to you.</p>',"<% } %>","<h4>Roles that can access the dataset</h4>",'<div id="access_perm" class="access_perm roles-selection"></div>','<div class="alert alert-info roles-selection">',"User has to have <strong>all these roles</strong> in order to access this dataset."," Users without access permission <strong>cannot</strong> have other permissions on this dataset."," If there are no access roles set on the dataset it is considered <strong>unrestricted</strong>.","</div>","<h4>Roles that can manage permissions on the dataset</h4>",'<div id="manage_perm" class="manage_perm roles-selection"></div>','<div class="alert alert-info roles-selection">',"User with <strong>any</strong> of these roles can manage permissions of this dataset. If you remove yourself you will lose the ability manage this dataset unless you are an admin.","</div>",'<button data-toggle="tooltip" data-placement="top" title="Save modifications made on this page" class="btn btn-default toolbtn_save_permissions primary-button" type="button">','<span class="fa fa-floppy-o"></span>',"&nbsp;Save","</button>","</div>","</div>"].join(""))},templateBulkImportInModal:function(){return i.template(["<div>",'<div class="library-modal-item">',"Select history: ",'<select id="dataset_import_single" name="dataset_import_single" style="width:50%; margin-bottom: 1em; " autofocus>',"<% _.each(histories, function(history) { %>",'<option value="<%= _.escape(history.get("id")) %>"><%= _.escape(history.get("name")) %></option>',"<% }); %>","</select>","</div>",'<div class="library-modal-item">',"or create new: ",'<input type="text" name="history_name" value="" placeholder="name of the new history" style="width:50%;">',"</input>","</div>","</div>"].join(""))}});t.default={LibraryDatasetView:_}}).call(t,n(2),n(1),n(0),n(0))},function(e,t,n){var i,r,a;!function(o){"use strict";r=[n(0)],i=o,void 0!==(a="function"==typeof i?i.apply(t,r):i)&&(e.exports=a)}(function(e,t){"use strict";/*!
 * jsTree 3.0.3
 * http://jstree.com/
 *
 * Copyright (c) 2014 Ivan Bozhanov (http://vakata.com)
 *
 * Licensed same as jquery - under the terms of the MIT License
 *   http://www.opensource.org/licenses/mit-license.php
 */
/*!
 * if using jslint please allow for the jQuery global and use following options: 
 * jslint: browser: true, ass: true, bitwise: true, continue: true, nomen: true, plusplus: true, regexp: true, unparam: true, todo: true, white: true
 */
if(!e.jstree){var n,i,r=0,a=!1,o=!1,s=!1,l=[],c=e("script:last").attr("src"),d=document,u=d.createElement("LI");u.setAttribute("role","treeitem"),n=d.createElement("I"),n.className="jstree-icon jstree-ocl",u.appendChild(n),n=d.createElement("A"),n.className="jstree-anchor",n.setAttribute("href","#"),i=d.createElement("I"),i.className="jstree-icon jstree-themeicon",n.appendChild(i),u.appendChild(n),n=i=null,e.jstree={version:"3.0.3",defaults:{plugins:[]},plugins:{},path:c&&-1!==c.indexOf("/")?c.replace(/\/[^\/]+$/,""):"",idregex:/[\\:&!^|()\[\]<>@*'+~#";.,=\- \/${}%]/g},e.jstree.create=function(t,n){var i=new e.jstree.core(++r),a=n;return n=e.extend(!0,{},e.jstree.defaults,n),a&&a.plugins&&(n.plugins=a.plugins),e.each(n.plugins,function(e,t){"core"!==e&&(i=i.plugin(t,n[t]))}),i.init(t,n),i},e.jstree.core=function(e){this._id=e,this._cnt=0,this._wrk=null,this._data={core:{themes:{name:!1,dots:!1,icons:!1},selected:[],last_error:{},working:!1,worker_queue:[]}}},e.jstree.reference=function(t){var n=null,i=null;if(t&&t.id&&(t=t.id),!i||!i.length)try{i=e(t)}catch(e){}if(!i||!i.length)try{i=e("#"+t.replace(e.jstree.idregex,"\\$&"))}catch(e){}return i&&i.length&&(i=i.closest(".jstree")).length&&(i=i.data("jstree"))?n=i:e(".jstree").each(function(){var i=e(this).data("jstree");if(i&&i._model.data[t])return n=i,!1}),n},e.fn.jstree=function(n){var i="string"==typeof n,r=Array.prototype.slice.call(arguments,1),a=null;return this.each(function(){var o=e.jstree.reference(this),s=i&&o?o[n]:null;if(a=i&&s?s.apply(o,r):null,o||i||n!==t&&!e.isPlainObject(n)||e(this).data("jstree",new e.jstree.create(this,n)),(o&&!i||!0===n)&&(a=o||!1),null!==a&&a!==t)return!1}),null!==a&&a!==t?a:this},e.expr[":"].jstree=e.expr.createPseudo(function(n){return function(n){return e(n).hasClass("jstree")&&e(n).data("jstree")!==t}}),e.jstree.defaults.core={data:!1,strings:!1,check_callback:!1,error:e.noop,animation:200,multiple:!0,themes:{name:!1,url:!1,dir:!1,dots:!0,icons:!0,stripes:!1,variant:!1,responsive:!1},expand_selected_onload:!0,worker:!0,force_text:!1},e.jstree.core.prototype={plugin:function(t,n){var i=e.jstree.plugins[t];return i?(this._data[t]={},i.prototype=this,new i(n,this)):this},init:function(t,n){this._model={data:{"#":{id:"#",parent:null,parents:[],children:[],children_d:[],state:{loaded:!1}}},changed:[],force_full_redraw:!1,redraw_timeout:!1,default_state:{loaded:!0,opened:!1,selected:!1,disabled:!1}},this.element=e(t).addClass("jstree jstree-"+this._id),this.settings=n,this.element.bind("destroyed",e.proxy(this.teardown,this)),this._data.core.ready=!1,this._data.core.loaded=!1,this._data.core.rtl="rtl"===this.element.css("direction"),this.element[this._data.core.rtl?"addClass":"removeClass"]("jstree-rtl"),this.element.attr("role","tree"),this.bind(),this.trigger("init"),this._data.core.original_container_html=this.element.find(" > ul > li").clone(!0),this._data.core.original_container_html.find("li").addBack().contents().filter(function(){return 3===this.nodeType&&(!this.nodeValue||/^\s+$/.test(this.nodeValue))}).remove(),this.element.html("<ul class='jstree-container-ul jstree-children'><li class='jstree-initial-node jstree-loading jstree-leaf jstree-last'><i class='jstree-icon jstree-ocl'></i><a class='jstree-anchor' href='#'><i class='jstree-icon jstree-themeicon-hidden'></i>"+this.get_string("Loading ...")+"</a></li></ul>"),this._data.core.li_height=this.get_container_ul().children("li:eq(0)").height()||24,this.trigger("loading"),this.load_node("#")},destroy:function(e){e||this.element.empty(),this.element.unbind("destroyed",this.teardown),this.teardown()},teardown:function(){this.unbind(),this.element.removeClass("jstree").removeData("jstree").find("[class^='jstree']").addBack().attr("class",function(){return this.className.replace(/jstree[^ ]*|$/gi,"")}),this.element=null},bind:function(){this.element.on("dblclick.jstree",function(){if(document.selection&&document.selection.empty)document.selection.empty();else if(window.getSelection){var e=window.getSelection();try{e.removeAllRanges(),e.collapse()}catch(e){}}}).on("click.jstree",".jstree-ocl",e.proxy(function(e){this.toggle_node(e.target)},this)).on("click.jstree",".jstree-anchor",e.proxy(function(t){t.preventDefault(),e(t.currentTarget).focus(),this.activate_node(t.currentTarget,t)},this)).on("keydown.jstree",".jstree-anchor",e.proxy(function(t){if("INPUT"===t.target.tagName)return!0;var n=null;switch(t.which){case 13:case 32:t.type="click",e(t.currentTarget).trigger(t);break;case 37:t.preventDefault(),this.is_open(t.currentTarget)?this.close_node(t.currentTarget):(n=this.get_prev_dom(t.currentTarget))&&n.length&&n.children(".jstree-anchor").focus();break;case 38:t.preventDefault(),n=this.get_prev_dom(t.currentTarget),n&&n.length&&n.children(".jstree-anchor").focus();break;case 39:t.preventDefault(),this.is_closed(t.currentTarget)?this.open_node(t.currentTarget,function(e){this.get_node(e,!0).children(".jstree-anchor").focus()}):(n=this.get_next_dom(t.currentTarget))&&n.length&&n.children(".jstree-anchor").focus();break;case 40:t.preventDefault(),n=this.get_next_dom(t.currentTarget),n&&n.length&&n.children(".jstree-anchor").focus();break;case 46:t.preventDefault(),n=this.get_node(t.currentTarget),n&&n.id&&"#"!==n.id&&(n=this.is_selected(n)?this.get_selected():n);break;case 113:t.preventDefault(),n=this.get_node(t.currentTarget)}},this)).on("load_node.jstree",e.proxy(function(t,n){if(n.status&&("#"!==n.node.id||this._data.core.loaded||(this._data.core.loaded=!0,this.trigger("loaded")),!this._data.core.ready&&!this.get_container_ul().find(".jstree-loading:eq(0)").length)){if(this._data.core.ready=!0,this._data.core.selected.length){if(this.settings.core.expand_selected_onload){var i,r,a=[];for(i=0,r=this._data.core.selected.length;i<r;i++)a=a.concat(this._model.data[this._data.core.selected[i]].parents);for(a=e.vakata.array_unique(a),i=0,r=a.length;i<r;i++)this.open_node(a[i],!1,0)}this.trigger("changed",{action:"ready",selected:this._data.core.selected})}setTimeout(e.proxy(function(){this.trigger("ready")},this),0)}},this)).on("init.jstree",e.proxy(function(){var e=this.settings.core.themes;this._data.core.themes.dots=e.dots,this._data.core.themes.stripes=e.stripes,this._data.core.themes.icons=e.icons,this.set_theme(e.name||"default",e.url),this.set_theme_variant(e.variant)},this)).on("loading.jstree",e.proxy(function(){this[this._data.core.themes.dots?"show_dots":"hide_dots"](),this[this._data.core.themes.icons?"show_icons":"hide_icons"](),this[this._data.core.themes.stripes?"show_stripes":"hide_stripes"]()},this)).on("blur.jstree",".jstree-anchor",e.proxy(function(t){e(t.currentTarget).filter(".jstree-hovered").mouseleave()},this)).on("focus.jstree",".jstree-anchor",e.proxy(function(t){this.element.find(".jstree-hovered").not(t.currentTarget).mouseleave(),e(t.currentTarget).mouseenter()},this)).on("mouseenter.jstree",".jstree-anchor",e.proxy(function(e){this.hover_node(e.currentTarget)},this)).on("mouseleave.jstree",".jstree-anchor",e.proxy(function(e){this.dehover_node(e.currentTarget)},this))},unbind:function(){this.element.off(".jstree"),e(document).off(".jstree-"+this._id)},trigger:function(e,t){t||(t={}),t.instance=this,this.element.triggerHandler(e.replace(".jstree","")+".jstree",t)},get_container:function(){return this.element},get_container_ul:function(){return this.element.children(".jstree-children:eq(0)")},get_string:function(t){var n=this.settings.core.strings;return e.isFunction(n)?n.call(this,t):n&&n[t]?n[t]:t},_firstChild:function(e){for(e=e?e.firstChild:null;null!==e&&1!==e.nodeType;)e=e.nextSibling;return e},_nextSibling:function(e){for(e=e?e.nextSibling:null;null!==e&&1!==e.nodeType;)e=e.nextSibling;return e},_previousSibling:function(e){for(e=e?e.previousSibling:null;null!==e&&1!==e.nodeType;)e=e.previousSibling;return e},get_node:function(t,n){t&&t.id&&(t=t.id);var i;try{if(this._model.data[t])t=this._model.data[t];else if(((i=e(t,this.element)).length||(i=e("#"+t.replace(e.jstree.idregex,"\\$&"),this.element)).length)&&this._model.data[i.closest(".jstree-node").attr("id")])t=this._model.data[i.closest(".jstree-node").attr("id")];else{if(!(i=e(t,this.element)).length||!i.hasClass("jstree"))return!1;t=this._model.data["#"]}return n&&(t="#"===t.id?this.element:e("#"+t.id.replace(e.jstree.idregex,"\\$&"),this.element)),t}catch(e){return!1}},get_path:function(e,t,n){if(!(e=e.parents?e:this.get_node(e))||"#"===e.id||!e.parents)return!1;var i,r,a=[];for(a.push(n?e.id:e.text),i=0,r=e.parents.length;i<r;i++)a.push(n?e.parents[i]:this.get_text(e.parents[i]));return a=a.reverse().slice(1),t?a.join(t):a},get_next_dom:function(t,n){var i;return t=this.get_node(t,!0),t[0]===this.element[0]?!!(i=this._firstChild(this.get_container_ul()[0]))&&e(i):!(!t||!t.length)&&(n?!!(i=this._nextSibling(t[0]))&&e(i):t.hasClass("jstree-open")?!!(i=this._firstChild(t.children(".jstree-children")[0]))&&e(i):null!==(i=this._nextSibling(t[0]))?e(i):t.parentsUntil(".jstree",".jstree-node").next(".jstree-node").eq(0))},get_prev_dom:function(t,n){var i;if(t=this.get_node(t,!0),t[0]===this.element[0])return!!(i=this.get_container_ul()[0].lastChild)&&e(i);if(!t||!t.length)return!1;if(n)return!!(i=this._previousSibling(t[0]))&&e(i);if(null!==(i=this._previousSibling(t[0]))){for(t=e(i);t.hasClass("jstree-open");)t=t.children(".jstree-children:eq(0)").children(".jstree-node:last");return t}return!(!(i=t[0].parentNode.parentNode)||!i.className||-1===i.className.indexOf("jstree-node"))&&e(i)},get_parent:function(e){return!(!(e=this.get_node(e))||"#"===e.id)&&e.parent},get_children_dom:function(e){return e=this.get_node(e,!0),e[0]===this.element[0]?this.get_container_ul().children(".jstree-node"):!(!e||!e.length)&&e.children(".jstree-children").children(".jstree-node")},is_parent:function(e){return(e=this.get_node(e))&&(!1===e.state.loaded||e.children.length>0)},is_loaded:function(e){return(e=this.get_node(e))&&e.state.loaded},is_loading:function(e){return(e=this.get_node(e))&&e.state&&e.state.loading},is_open:function(e){return(e=this.get_node(e))&&e.state.opened},is_closed:function(e){return(e=this.get_node(e))&&this.is_parent(e)&&!e.state.opened},is_leaf:function(e){return!this.is_parent(e)},load_node:function(t,n){var i,r,a,o,s;if(e.isArray(t))return this._load_nodes(t.slice(),n),!0;if(!(t=this.get_node(t)))return n&&n.call(this,t,!1),!1;if(t.state.loaded){for(t.state.loaded=!1,i=0,r=t.children_d.length;i<r;i++){for(a=0,o=t.parents.length;a<o;a++)this._model.data[t.parents[a]].children_d=e.vakata.array_remove_item(this._model.data[t.parents[a]].children_d,t.children_d[i]);this._model.data[t.children_d[i]].state.selected&&(s=!0,this._data.core.selected=e.vakata.array_remove_item(this._data.core.selected,t.children_d[i])),delete this._model.data[t.children_d[i]]}t.children=[],t.children_d=[],s&&this.trigger("changed",{action:"load_node",node:t,selected:this._data.core.selected})}return t.state.loading=!0,this.get_node(t,!0).addClass("jstree-loading"),this._load_node(t,e.proxy(function(e){t=this._model.data[t.id],t.state.loading=!1,t.state.loaded=e;var i=this.get_node(t,!0);t.state.loaded&&!t.children.length&&i&&i.length&&!i.hasClass("jstree-leaf")&&i.removeClass("jstree-closed jstree-open").addClass("jstree-leaf"),i.removeClass("jstree-loading"),this.trigger("load_node",{node:t,status:e}),n&&n.call(this,t,e)},this)),!0},_load_nodes:function(e,t,n){var i,r,a=!0,o=function(){this._load_nodes(e,t,!0)},s=this._model.data;for(i=0,r=e.length;i<r;i++)!s[e[i]]||s[e[i]].state.loaded&&n||(this.is_loading(e[i])||this.load_node(e[i],o),a=!1);a&&t&&!t.done&&(t.call(this,e),t.done=!0)},_load_node:function(t,n){var i,r=this.settings.core.data;return r?e.isFunction(r)?r.call(this,t,e.proxy(function(i){!1===i&&n.call(this,!1),this["string"==typeof i?"_append_html_data":"_append_json_data"](t,"string"==typeof i?e(i):i,function(e){n.call(this,e)})},this)):"object"==typeof r?r.url?(r=e.extend(!0,{},r),e.isFunction(r.url)&&(r.url=r.url.call(this,t)),e.isFunction(r.data)&&(r.data=r.data.call(this,t)),e.ajax(r).done(e.proxy(function(i,r,a){var o=a.getResponseHeader("Content-Type");return-1!==o.indexOf("json")||"object"==typeof i?this._append_json_data(t,i,function(e){n.call(this,e)}):-1!==o.indexOf("html")||"string"==typeof i?this._append_html_data(t,e(i),function(e){n.call(this,e)}):(this._data.core.last_error={error:"ajax",plugin:"core",id:"core_04",reason:"Could not load node",data:JSON.stringify({id:t.id,xhr:a})},this.settings.core.error.call(this,this._data.core.last_error),n.call(this,!1))},this)).fail(e.proxy(function(e){n.call(this,!1),this._data.core.last_error={error:"ajax",plugin:"core",id:"core_04",reason:"Could not load node",data:JSON.stringify({id:t.id,xhr:e})},this.settings.core.error.call(this,this._data.core.last_error)},this))):(i=e.isArray(r)||e.isPlainObject(r)?JSON.parse(JSON.stringify(r)):r,"#"===t.id?this._append_json_data(t,i,function(e){n.call(this,e)}):(this._data.core.last_error={error:"nodata",plugin:"core",id:"core_05",reason:"Could not load node",data:JSON.stringify({id:t.id})},this.settings.core.error.call(this,this._data.core.last_error),n.call(this,!1))):"string"==typeof r?"#"===t.id?this._append_html_data(t,e(r),function(e){n.call(this,e)}):(this._data.core.last_error={error:"nodata",plugin:"core",id:"core_06",reason:"Could not load node",data:JSON.stringify({id:t.id})},this.settings.core.error.call(this,this._data.core.last_error),n.call(this,!1)):n.call(this,!1):"#"===t.id?this._append_html_data(t,this._data.core.original_container_html.clone(!0),function(e){n.call(this,e)}):n.call(this,!1)},_node_changed:function(e){(e=this.get_node(e))&&this._model.changed.push(e.id)},_append_html_data:function(t,n,i){t=this.get_node(t),t.children=[],t.children_d=[];var r,a,o,s=n.is("ul")?n.children():n,l=t.id,c=[],d=[],u=this._model.data,h=u[l],f=this._data.core.selected.length;for(s.each(e.proxy(function(t,n){(r=this._parse_model_from_html(e(n),l,h.parents.concat()))&&(c.push(r),d.push(r),u[r].children_d.length&&(d=d.concat(u[r].children_d)))},this)),h.children=c,h.children_d=d,a=0,o=h.parents.length;a<o;a++)u[h.parents[a]].children_d=u[h.parents[a]].children_d.concat(d);this.trigger("model",{nodes:d,parent:l}),"#"!==l?(this._node_changed(l),this.redraw()):(this.get_container_ul().children(".jstree-initial-node").remove(),this.redraw(!0)),this._data.core.selected.length!==f&&this.trigger("changed",{action:"model",selected:this._data.core.selected}),i.call(this,!0)},_append_json_data:function(t,n,i){t=this.get_node(t),t.children=[],t.children_d=[],n.d&&"string"==typeof(n=n.d)&&(n=JSON.parse(n)),e.isArray(n)||(n=[n]);var r=null,a={df:this._model.default_state,dat:n,par:t.id,m:this._model.data,t_id:this._id,t_cnt:this._cnt,sel:this._data.core.selected},o=function(e,t){e.data&&(e=e.data);var n,i,r,a,o=e.dat,s=e.par,l=[],c=[],d=[],u=e.df,h=e.t_id,f=e.t_cnt,p=e.m,g=p[s],m=e.sel,_=function(e,n,i){i=i?i.concat():[],n&&i.unshift(n);var r,a,o,s,l=e.id.toString(),c={id:l,text:e.text||"",icon:e.icon===t||e.icon,parent:n,parents:i,children:e.children||[],children_d:e.children_d||[],data:e.data,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(r in u)u.hasOwnProperty(r)&&(c.state[r]=u[r]);if(e&&e.data&&e.data.jstree&&e.data.jstree.icon&&(c.icon=e.data.jstree.icon),e&&e.data&&(c.data=e.data,e.data.jstree))for(r in e.data.jstree)e.data.jstree.hasOwnProperty(r)&&(c.state[r]=e.data.jstree[r]);if(e&&"object"==typeof e.state)for(r in e.state)e.state.hasOwnProperty(r)&&(c.state[r]=e.state[r]);if(e&&"object"==typeof e.li_attr)for(r in e.li_attr)e.li_attr.hasOwnProperty(r)&&(c.li_attr[r]=e.li_attr[r]);if(c.li_attr.id||(c.li_attr.id=l),e&&"object"==typeof e.a_attr)for(r in e.a_attr)e.a_attr.hasOwnProperty(r)&&(c.a_attr[r]=e.a_attr[r]);for(e&&e.children&&!0===e.children&&(c.state.loaded=!1,c.children=[],c.children_d=[]),p[c.id]=c,r=0,a=c.children.length;r<a;r++)o=_(p[c.children[r]],c.id,i),s=p[o],c.children_d.push(o),s.children_d.length&&(c.children_d=c.children_d.concat(s.children_d));return delete e.data,delete e.children,p[c.id].original=e,c.state.selected&&d.push(c.id),c.id},v=function(e,n,i){i=i?i.concat():[],n&&i.unshift(n);var r,a,o,s,l,c=!1;do{c="j"+h+"_"+ ++f}while(p[c]);l={id:!1,text:"string"==typeof e?e:"",icon:"object"!=typeof e||e.icon===t||e.icon,parent:n,parents:i,children:[],children_d:[],data:null,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(r in u)u.hasOwnProperty(r)&&(l.state[r]=u[r]);if(e&&e.id&&(l.id=e.id.toString()),e&&e.text&&(l.text=e.text),e&&e.data&&e.data.jstree&&e.data.jstree.icon&&(l.icon=e.data.jstree.icon),e&&e.data&&(l.data=e.data,e.data.jstree))for(r in e.data.jstree)e.data.jstree.hasOwnProperty(r)&&(l.state[r]=e.data.jstree[r]);if(e&&"object"==typeof e.state)for(r in e.state)e.state.hasOwnProperty(r)&&(l.state[r]=e.state[r]);if(e&&"object"==typeof e.li_attr)for(r in e.li_attr)e.li_attr.hasOwnProperty(r)&&(l.li_attr[r]=e.li_attr[r]);if(l.li_attr.id&&!l.id&&(l.id=l.li_attr.id.toString()),l.id||(l.id=c),l.li_attr.id||(l.li_attr.id=l.id),e&&"object"==typeof e.a_attr)for(r in e.a_attr)e.a_attr.hasOwnProperty(r)&&(l.a_attr[r]=e.a_attr[r]);if(e&&e.children&&e.children.length){for(r=0,a=e.children.length;r<a;r++)o=v(e.children[r],l.id,i),s=p[o],l.children.push(o),s.children_d.length&&(l.children_d=l.children_d.concat(s.children_d));l.children_d=l.children_d.concat(l.children)}return e&&e.children&&!0===e.children&&(l.state.loaded=!1,l.children=[],l.children_d=[]),delete e.data,delete e.children,l.original=e,p[l.id]=l,l.state.selected&&d.push(l.id),l.id};if(o.length&&o[0].id!==t&&o[0].parent!==t){for(i=0,r=o.length;i<r;i++)o[i].children||(o[i].children=[]),p[o[i].id.toString()]=o[i];for(i=0,r=o.length;i<r;i++)p[o[i].parent.toString()].children.push(o[i].id.toString()),g.children_d.push(o[i].id.toString());for(i=0,r=g.children.length;i<r;i++)n=_(p[g.children[i]],s,g.parents.concat()),c.push(n),p[n].children_d.length&&(c=c.concat(p[n].children_d));for(i=0,r=g.parents.length;i<r;i++)p[g.parents[i]].children_d=p[g.parents[i]].children_d.concat(c);a={cnt:f,mod:p,sel:m,par:s,dpc:c,add:d}}else{for(i=0,r=o.length;i<r;i++)(n=v(o[i],s,g.parents.concat()))&&(l.push(n),c.push(n),p[n].children_d.length&&(c=c.concat(p[n].children_d)));for(g.children=l,g.children_d=c,i=0,r=g.parents.length;i<r;i++)p[g.parents[i]].children_d=p[g.parents[i]].children_d.concat(c);a={cnt:f,mod:p,sel:m,par:s,dpc:c,add:d}}return a},s=function(t,n){if(this._cnt=t.cnt,this._model.data=t.mod,n){var r,a,o=t.add,s=t.sel,l=this._data.core.selected.slice(),c=this._model.data;if(s.length!==l.length||e.vakata.array_unique(s.concat(l)).length!==s.length){for(r=0,a=s.length;r<a;r++)-1===e.inArray(s[r],o)&&-1===e.inArray(s[r],l)&&(c[s[r]].state.selected=!1);for(r=0,a=l.length;r<a;r++)-1===e.inArray(l[r],s)&&(c[l[r]].state.selected=!0)}}t.add.length&&(this._data.core.selected=this._data.core.selected.concat(t.add)),this.trigger("model",{nodes:t.dpc,parent:t.par}),"#"!==t.par?(this._node_changed(t.par),this.redraw()):this.redraw(!0),t.add.length&&this.trigger("changed",{action:"model",selected:this._data.core.selected}),i.call(this,!0)};if(this.settings.core.worker&&window.Blob&&window.URL&&window.Worker)try{null===this._wrk&&(this._wrk=window.URL.createObjectURL(new window.Blob(["self.onmessage = "+o.toString().replace(/return ([^;}]+)[\s;}]+$/,"postMessage($1);}")],{type:"text/javascript"}))),r=new window.Worker(this._wrk),r.onmessage=e.proxy(function(e){s.call(this,e.data,!0),this._data.core.working=!1,this._data.core.worker_queue.length&&this._append_json_data.apply(this,this._data.core.worker_queue.shift())},this),this._data.core.working?this._data.core.worker_queue.push([t,n,i]):(this._data.core.working=!0,r.postMessage(a))}catch(e){s.call(this,o(a),!1)}else s.call(this,o(a),!1)},_parse_model_from_html:function(t,n,i){i=i?[].concat(i):[],n&&i.unshift(n);var r,a,o,s,l,c=this._model.data,d={id:!1,text:!1,icon:!0,parent:n,parents:i,children:[],children_d:[],data:null,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(o in this._model.default_state)this._model.default_state.hasOwnProperty(o)&&(d.state[o]=this._model.default_state[o]);if(s=e.vakata.attributes(t,!0),e.each(s,function(t,n){if(n=e.trim(n),!n.length)return!0;d.li_attr[t]=n,"id"===t&&(d.id=n.toString())}),s=t.children("a").eq(0),s.length&&(s=e.vakata.attributes(s,!0),e.each(s,function(t,n){n=e.trim(n),n.length&&(d.a_attr[t]=n)})),s=t.children("a:eq(0)").length?t.children("a:eq(0)").clone():t.clone(),s.children("ins, i, ul").remove(),s=s.html(),s=e("<div />").html(s),d.text=this.settings.core.force_text?s.text():s.html(),s=t.data(),d.data=s?e.extend(!0,{},s):null,d.state.opened=t.hasClass("jstree-open"),d.state.selected=t.children("a").hasClass("jstree-clicked"),d.state.disabled=t.children("a").hasClass("jstree-disabled"),d.data&&d.data.jstree)for(o in d.data.jstree)d.data.jstree.hasOwnProperty(o)&&(d.state[o]=d.data.jstree[o]);s=t.children("a").children(".jstree-themeicon"),s.length&&(d.icon=!s.hasClass("jstree-themeicon-hidden")&&s.attr("rel")),d.state.icon&&(d.icon=d.state.icon),s=t.children("ul").children("li");do{l="j"+this._id+"_"+ ++this._cnt}while(c[l]);return d.id=d.li_attr.id?d.li_attr.id.toString():l,s.length?(s.each(e.proxy(function(t,n){r=this._parse_model_from_html(e(n),d.id,i),a=this._model.data[r],d.children.push(r),a.children_d.length&&(d.children_d=d.children_d.concat(a.children_d))},this)),d.children_d=d.children_d.concat(d.children)):t.hasClass("jstree-closed")&&(d.state.loaded=!1),d.li_attr.class&&(d.li_attr.class=d.li_attr.class.replace("jstree-closed","").replace("jstree-open","")),d.a_attr.class&&(d.a_attr.class=d.a_attr.class.replace("jstree-clicked","").replace("jstree-disabled","")),c[d.id]=d,d.state.selected&&this._data.core.selected.push(d.id),d.id},_parse_model_from_flat_json:function(e,n,i){i=i?i.concat():[],n&&i.unshift(n);var r,a,o,s,l=e.id.toString(),c=this._model.data,d=this._model.default_state,u={id:l,text:e.text||"",icon:e.icon===t||e.icon,parent:n,parents:i,children:e.children||[],children_d:e.children_d||[],data:e.data,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(r in d)d.hasOwnProperty(r)&&(u.state[r]=d[r]);if(e&&e.data&&e.data.jstree&&e.data.jstree.icon&&(u.icon=e.data.jstree.icon),e&&e.data&&(u.data=e.data,e.data.jstree))for(r in e.data.jstree)e.data.jstree.hasOwnProperty(r)&&(u.state[r]=e.data.jstree[r]);if(e&&"object"==typeof e.state)for(r in e.state)e.state.hasOwnProperty(r)&&(u.state[r]=e.state[r]);if(e&&"object"==typeof e.li_attr)for(r in e.li_attr)e.li_attr.hasOwnProperty(r)&&(u.li_attr[r]=e.li_attr[r]);if(u.li_attr.id||(u.li_attr.id=l),e&&"object"==typeof e.a_attr)for(r in e.a_attr)e.a_attr.hasOwnProperty(r)&&(u.a_attr[r]=e.a_attr[r]);for(e&&e.children&&!0===e.children&&(u.state.loaded=!1,u.children=[],u.children_d=[]),c[u.id]=u,r=0,a=u.children.length;r<a;r++)o=this._parse_model_from_flat_json(c[u.children[r]],u.id,i),s=c[o],u.children_d.push(o),s.children_d.length&&(u.children_d=u.children_d.concat(s.children_d));return delete e.data,delete e.children,c[u.id].original=e,u.state.selected&&this._data.core.selected.push(u.id),u.id},_parse_model_from_json:function(e,n,i){i=i?i.concat():[],n&&i.unshift(n);var r,a,o,s,l,c=!1,d=this._model.data,u=this._model.default_state;do{c="j"+this._id+"_"+ ++this._cnt}while(d[c]);l={id:!1,text:"string"==typeof e?e:"",icon:"object"!=typeof e||e.icon===t||e.icon,parent:n,parents:i,children:[],children_d:[],data:null,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(r in u)u.hasOwnProperty(r)&&(l.state[r]=u[r]);if(e&&e.id&&(l.id=e.id.toString()),e&&e.text&&(l.text=e.text),e&&e.data&&e.data.jstree&&e.data.jstree.icon&&(l.icon=e.data.jstree.icon),e&&e.data&&(l.data=e.data,e.data.jstree))for(r in e.data.jstree)e.data.jstree.hasOwnProperty(r)&&(l.state[r]=e.data.jstree[r]);if(e&&"object"==typeof e.state)for(r in e.state)e.state.hasOwnProperty(r)&&(l.state[r]=e.state[r]);if(e&&"object"==typeof e.li_attr)for(r in e.li_attr)e.li_attr.hasOwnProperty(r)&&(l.li_attr[r]=e.li_attr[r]);if(l.li_attr.id&&!l.id&&(l.id=l.li_attr.id.toString()),l.id||(l.id=c),l.li_attr.id||(l.li_attr.id=l.id),e&&"object"==typeof e.a_attr)for(r in e.a_attr)e.a_attr.hasOwnProperty(r)&&(l.a_attr[r]=e.a_attr[r]);if(e&&e.children&&e.children.length){for(r=0,a=e.children.length;r<a;r++)o=this._parse_model_from_json(e.children[r],l.id,i),s=d[o],l.children.push(o),s.children_d.length&&(l.children_d=l.children_d.concat(s.children_d));l.children_d=l.children_d.concat(l.children)}return e&&e.children&&!0===e.children&&(l.state.loaded=!1,l.children=[],l.children_d=[]),delete e.data,delete e.children,l.original=e,d[l.id]=l,l.state.selected&&this._data.core.selected.push(l.id),l.id},_redraw:function(){var e,t,n,i=this._model.force_full_redraw?this._model.data["#"].children.concat([]):this._model.changed.concat([]),r=document.createElement("UL");for(t=0,n=i.length;t<n;t++)(e=this.redraw_node(i[t],!0,this._model.force_full_redraw))&&this._model.force_full_redraw&&r.appendChild(e);this._model.force_full_redraw&&(r.className=this.get_container_ul()[0].className,this.element.empty().append(r)),this._model.force_full_redraw=!1,this._model.changed=[],this.trigger("redraw",{nodes:i})},redraw:function(e){e&&(this._model.force_full_redraw=!0),this._redraw()},redraw_node:function(t,n,i){var r=this.get_node(t),a=!1,o=!1,s=!1,l=!1,c=!1,d=!1,h="",f=document,p=this._model.data,g=!1,m=!1,_=null;if(!r)return!1;if("#"===r.id)return this.redraw(!0);if(n=n||0===r.children.length,t=document.querySelector?this.element[0].querySelector("#"+(-1!=="0123456789".indexOf(r.id[0])?"\\3"+r.id[0]+" "+r.id.substr(1).replace(e.jstree.idregex,"\\$&"):r.id.replace(e.jstree.idregex,"\\$&"))):document.getElementById(r.id))t=e(t),i||(a=t.parent().parent()[0],a===this.element[0]&&(a=null),o=t.index()),n||!r.children.length||t.children(".jstree-children").length||(n=!0),n||(s=t.children(".jstree-children")[0]),m=t.attr("aria-selected"),g=t.children(".jstree-anchor")[0]===document.activeElement,t.remove();else if(n=!0,!i){if(!(null===(a="#"!==r.parent?e("#"+r.parent.replace(e.jstree.idregex,"\\$&"),this.element)[0]:null)||a&&p[r.parent].state.opened))return!1;o=e.inArray(r.id,null===a?p["#"].children:p[r.parent].children)}t=u.cloneNode(!0),h="jstree-node ";for(l in r.li_attr)if(r.li_attr.hasOwnProperty(l)){if("id"===l)continue;"class"!==l?t.setAttribute(l,r.li_attr[l]):h+=r.li_attr[l]}m&&"false"!==m&&t.setAttribute("aria-selected",!0),r.state.loaded&&!r.children.length?h+=" jstree-leaf":(h+=r.state.opened&&r.state.loaded?" jstree-open":" jstree-closed",t.setAttribute("aria-expanded",r.state.opened&&r.state.loaded)),null!==r.parent&&p[r.parent].children[p[r.parent].children.length-1]===r.id&&(h+=" jstree-last"),t.id=r.id,t.className=h,h=(r.state.selected?" jstree-clicked":"")+(r.state.disabled?" jstree-disabled":"");for(c in r.a_attr)if(r.a_attr.hasOwnProperty(c)){if("href"===c&&"#"===r.a_attr[c])continue;"class"!==c?t.childNodes[1].setAttribute(c,r.a_attr[c]):h+=" "+r.a_attr[c]}if(h.length&&(t.childNodes[1].className="jstree-anchor "+h),(r.icon&&!0!==r.icon||!1===r.icon)&&(!1===r.icon?t.childNodes[1].childNodes[0].className+=" jstree-themeicon-hidden":-1===r.icon.indexOf("/")&&-1===r.icon.indexOf(".")?t.childNodes[1].childNodes[0].className+=" "+r.icon+" jstree-themeicon-custom":(t.childNodes[1].childNodes[0].style.backgroundImage="url("+r.icon+")",t.childNodes[1].childNodes[0].style.backgroundPosition="center center",t.childNodes[1].childNodes[0].style.backgroundSize="auto",t.childNodes[1].childNodes[0].className+=" jstree-themeicon-custom")),this.settings.core.force_text?t.childNodes[1].appendChild(f.createTextNode(r.text)):t.childNodes[1].innerHTML+=r.text,n&&r.children.length&&r.state.opened&&r.state.loaded){for(d=f.createElement("UL"),d.setAttribute("role","group"),d.className="jstree-children",l=0,c=r.children.length;l<c;l++)d.appendChild(this.redraw_node(r.children[l],n,!0));t.appendChild(d)}if(s&&t.appendChild(s),!i){for(a||(a=this.element[0]),l=0,c=a.childNodes.length;l<c;l++)if(a.childNodes[l]&&a.childNodes[l].className&&-1!==a.childNodes[l].className.indexOf("jstree-children")){_=a.childNodes[l];break}_||(_=f.createElement("UL"),_.setAttribute("role","group"),_.className="jstree-children",a.appendChild(_)),a=_,o<a.childNodes.length?a.insertBefore(t,a.childNodes[o]):a.appendChild(t),g&&t.childNodes[1].focus()}return r.state.opened&&!r.state.loaded&&(r.state.opened=!1,setTimeout(e.proxy(function(){this.open_node(r.id,!1,0)},this),0)),t},open_node:function(n,i,r){var a,o,s,l;if(e.isArray(n)){for(n=n.slice(),a=0,o=n.length;a<o;a++)this.open_node(n[a],i,r);return!0}if(!(n=this.get_node(n))||"#"===n.id)return!1;if(r=r===t?this.settings.core.animation:r,!this.is_closed(n))return i&&i.call(this,n,!1),!1;if(this.is_loaded(n))s=this.get_node(n,!0),l=this,s.length&&(n.children.length&&!this._firstChild(s.children(".jstree-children")[0])&&(n.state.opened=!0,this.redraw_node(n,!0),s=this.get_node(n,!0)),r?(this.trigger("before_open",{node:n}),s.children(".jstree-children").css("display","none").end().removeClass("jstree-closed").addClass("jstree-open").attr("aria-expanded",!0).children(".jstree-children").stop(!0,!0).slideDown(r,function(){this.style.display="",l.trigger("after_open",{node:n})})):(this.trigger("before_open",{node:n}),s[0].className=s[0].className.replace("jstree-closed","jstree-open"),s[0].setAttribute("aria-expanded",!0))),n.state.opened=!0,i&&i.call(this,n,!0),s.length||this.trigger("before_open",{node:n}),this.trigger("open_node",{node:n}),r&&s.length||this.trigger("after_open",{node:n});else{if(this.is_loading(n))return setTimeout(e.proxy(function(){this.open_node(n,i,r)},this),500);this.load_node(n,function(e,t){return t?this.open_node(e,i,r):!!i&&i.call(this,e,!1)})}},_open_to:function(t){if(!(t=this.get_node(t))||"#"===t.id)return!1;var n,i,r=t.parents;for(n=0,i=r.length;n<i;n+=1)"#"!==n&&this.open_node(r[n],!1,0);return e("#"+t.id.replace(e.jstree.idregex,"\\$&"),this.element)},close_node:function(n,i){var r,a,o,s;if(e.isArray(n)){for(n=n.slice(),r=0,a=n.length;r<a;r++)this.close_node(n[r],i);return!0}return!(!(n=this.get_node(n))||"#"===n.id)&&(!this.is_closed(n)&&(i=i===t?this.settings.core.animation:i,o=this,s=this.get_node(n,!0),s.length&&(i?s.children(".jstree-children").attr("style","display:block !important").end().removeClass("jstree-open").addClass("jstree-closed").attr("aria-expanded",!1).children(".jstree-children").stop(!0,!0).slideUp(i,function(){this.style.display="",s.children(".jstree-children").remove(),o.trigger("after_close",{node:n})}):(s[0].className=s[0].className.replace("jstree-open","jstree-closed"),s.attr("aria-expanded",!1).children(".jstree-children").remove())),n.state.opened=!1,this.trigger("close_node",{node:n}),void(i&&s.length||this.trigger("after_close",{node:n}))))},toggle_node:function(t){var n,i;if(e.isArray(t)){for(t=t.slice(),n=0,i=t.length;n<i;n++)this.toggle_node(t[n]);return!0}return this.is_closed(t)?this.open_node(t):this.is_open(t)?this.close_node(t):void 0},open_all:function(e,t,n){if(e||(e="#"),!(e=this.get_node(e)))return!1;var i,r,a,o="#"===e.id?this.get_container_ul():this.get_node(e,!0);if(!o.length){for(i=0,r=e.children_d.length;i<r;i++)this.is_closed(this._model.data[e.children_d[i]])&&(this._model.data[e.children_d[i]].state.opened=!0);return this.trigger("open_all",{node:e})}n=n||o,a=this,o=this.is_closed(e)?o.find(".jstree-closed").addBack():o.find(".jstree-closed"),o.each(function(){a.open_node(this,function(e,i){i&&this.is_parent(e)&&this.open_all(e,t,n)},t||0)}),0===n.find(".jstree-closed").length&&this.trigger("open_all",{node:this.get_node(n)})},close_all:function(t,n){if(t||(t="#"),!(t=this.get_node(t)))return!1;var i,r,a="#"===t.id?this.get_container_ul():this.get_node(t,!0),o=this;if(!a.length){for(i=0,r=t.children_d.length;i<r;i++)this._model.data[t.children_d[i]].state.opened=!1;return this.trigger("close_all",{node:t})}a=this.is_open(t)?a.find(".jstree-open").addBack():a.find(".jstree-open"),e(a.get().reverse()).each(function(){o.close_node(this,n||0)}),this.trigger("close_all",{node:t})},is_disabled:function(e){return(e=this.get_node(e))&&e.state&&e.state.disabled},enable_node:function(t){var n,i;if(e.isArray(t)){for(t=t.slice(),n=0,i=t.length;n<i;n++)this.enable_node(t[n]);return!0}if(!(t=this.get_node(t))||"#"===t.id)return!1;t.state.disabled=!1,this.get_node(t,!0).children(".jstree-anchor").removeClass("jstree-disabled"),this.trigger("enable_node",{node:t})},disable_node:function(t){var n,i;if(e.isArray(t)){for(t=t.slice(),n=0,i=t.length;n<i;n++)this.disable_node(t[n]);return!0}if(!(t=this.get_node(t))||"#"===t.id)return!1;t.state.disabled=!0,this.get_node(t,!0).children(".jstree-anchor").addClass("jstree-disabled"),this.trigger("disable_node",{node:t})},activate_node:function(e,n){if(this.is_disabled(e))return!1;if(this._data.core.last_clicked=this._data.core.last_clicked&&this._data.core.last_clicked.id!==t?this.get_node(this._data.core.last_clicked.id):null,this._data.core.last_clicked&&!this._data.core.last_clicked.state.selected&&(this._data.core.last_clicked=null),!this._data.core.last_clicked&&this._data.core.selected.length&&(this._data.core.last_clicked=this.get_node(this._data.core.selected[this._data.core.selected.length-1])),this.settings.core.multiple&&(n.metaKey||n.ctrlKey||n.shiftKey)&&(!n.shiftKey||this._data.core.last_clicked&&this.get_parent(e)&&this.get_parent(e)===this._data.core.last_clicked.parent))if(n.shiftKey){var i,r,a=this.get_node(e).id,o=this._data.core.last_clicked.id,s=this.get_node(this._data.core.last_clicked.parent).children,l=!1;for(i=0,r=s.length;i<r;i+=1)s[i]===a&&(l=!l),s[i]===o&&(l=!l),l||s[i]===a||s[i]===o?this.select_node(s[i],!1,!1,n):this.deselect_node(s[i],!1,n)}else this.is_selected(e)?this.deselect_node(e,!1,n):this.select_node(e,!1,!1,n);else!this.settings.core.multiple&&(n.metaKey||n.ctrlKey||n.shiftKey)&&this.is_selected(e)?this.deselect_node(e,!1,n):(this.deselect_all(!0),this.select_node(e,!1,!1,n),this._data.core.last_clicked=this.get_node(e));this.trigger("activate_node",{node:this.get_node(e)})},hover_node:function(e){if(!(e=this.get_node(e,!0))||!e.length||e.children(".jstree-hovered").length)return!1;var t=this.element.find(".jstree-hovered"),n=this.element;t&&t.length&&this.dehover_node(t),e.children(".jstree-anchor").addClass("jstree-hovered"),this.trigger("hover_node",{node:this.get_node(e)}),setTimeout(function(){n.attr("aria-activedescendant",e[0].id),e.attr("aria-selected",!0)},0)},dehover_node:function(e){if(!(e=this.get_node(e,!0))||!e.length||!e.children(".jstree-hovered").length)return!1;e.attr("aria-selected",!1).children(".jstree-anchor").removeClass("jstree-hovered"),this.trigger("dehover_node",{node:this.get_node(e)})},select_node:function(t,n,i,r){var a,o,s;if(e.isArray(t)){for(t=t.slice(),o=0,s=t.length;o<s;o++)this.select_node(t[o],n,i,r);return!0}if(!(t=this.get_node(t))||"#"===t.id)return!1;a=this.get_node(t,!0),t.state.selected||(t.state.selected=!0,this._data.core.selected.push(t.id),i||(a=this._open_to(t)),a&&a.length&&a.children(".jstree-anchor").addClass("jstree-clicked"),this.trigger("select_node",{node:t,selected:this._data.core.selected,event:r}),n||this.trigger("changed",{action:"select_node",node:t,selected:this._data.core.selected,event:r}))},deselect_node:function(t,n,i){var r,a,o;if(e.isArray(t)){for(t=t.slice(),r=0,a=t.length;r<a;r++)this.deselect_node(t[r],n,i);return!0}if(!(t=this.get_node(t))||"#"===t.id)return!1;o=this.get_node(t,!0),t.state.selected&&(t.state.selected=!1,this._data.core.selected=e.vakata.array_remove_item(this._data.core.selected,t.id),o.length&&o.children(".jstree-anchor").removeClass("jstree-clicked"),this.trigger("deselect_node",{node:t,selected:this._data.core.selected,event:i}),n||this.trigger("changed",{action:"deselect_node",node:t,selected:this._data.core.selected,event:i}))},select_all:function(e){var t,n,i=this._data.core.selected.concat([]);for(this._data.core.selected=this._model.data["#"].children_d.concat(),t=0,n=this._data.core.selected.length;t<n;t++)this._model.data[this._data.core.selected[t]]&&(this._model.data[this._data.core.selected[t]].state.selected=!0);this.redraw(!0),this.trigger("select_all",{selected:this._data.core.selected}),e||this.trigger("changed",{action:"select_all",selected:this._data.core.selected,old_selection:i})},deselect_all:function(e){var t,n,i=this._data.core.selected.concat([]);for(t=0,n=this._data.core.selected.length;t<n;t++)this._model.data[this._data.core.selected[t]]&&(this._model.data[this._data.core.selected[t]].state.selected=!1);this._data.core.selected=[],this.element.find(".jstree-clicked").removeClass("jstree-clicked"),this.trigger("deselect_all",{selected:this._data.core.selected,node:i}),e||this.trigger("changed",{action:"deselect_all",selected:this._data.core.selected,old_selection:i})},is_selected:function(e){return!(!(e=this.get_node(e))||"#"===e.id)&&e.state.selected},get_selected:function(t){return t?e.map(this._data.core.selected,e.proxy(function(e){return this.get_node(e)},this)):this._data.core.selected.slice()},get_top_selected:function(t){var n,i,r,a,o=this.get_selected(!0),s={};for(n=0,i=o.length;n<i;n++)s[o[n].id]=o[n];for(n=0,i=o.length;n<i;n++)for(r=0,a=o[n].children_d.length;r<a;r++)s[o[n].children_d[r]]&&delete s[o[n].children_d[r]];o=[];for(n in s)s.hasOwnProperty(n)&&o.push(n);return t?e.map(o,e.proxy(function(e){return this.get_node(e)},this)):o},get_bottom_selected:function(t){var n,i,r=this.get_selected(!0),a=[];for(n=0,i=r.length;n<i;n++)r[n].children.length||a.push(r[n].id);return t?e.map(a,e.proxy(function(e){return this.get_node(e)},this)):a},get_state:function(){var e,t={core:{open:[],scroll:{left:this.element.scrollLeft(),top:this.element.scrollTop()},/*!
					'themes' : {
						'name' : this.get_theme(),
						'icons' : this._data.core.themes.icons,
						'dots' : this._data.core.themes.dots
					},
					*/
selected:[]}};for(e in this._model.data)this._model.data.hasOwnProperty(e)&&"#"!==e&&(this._model.data[e].state.opened&&t.core.open.push(e),this._model.data[e].state.selected&&t.core.selected.push(e));return t},set_state:function(n,i){if(n){if(n.core){var r,a,o,s;if(n.core.open)return e.isArray(n.core.open)?(r=!0,a=!1,o=this,e.each(n.core.open.concat([]),function(t,s){(a=o.get_node(s))&&(o.is_loaded(s)?(o.is_closed(s)&&o.open_node(s,!1,0),n&&n.core&&n.core.open&&e.vakata.array_remove_item(n.core.open,s)):(o.is_loading(s)||o.open_node(s,e.proxy(function(t,r){!r&&n&&n.core&&n.core.open&&e.vakata.array_remove_item(n.core.open,t.id),this.set_state(n,i)},o),0),r=!1))}),r&&(delete n.core.open,this.set_state(n,i)),!1):(delete n.core.open,this.set_state(n,i),!1);if(n.core.scroll)return n.core.scroll&&n.core.scroll.left!==t&&this.element.scrollLeft(n.core.scroll.left),n.core.scroll&&n.core.scroll.top!==t&&this.element.scrollTop(n.core.scroll.top),delete n.core.scroll,this.set_state(n,i),!1;/*!
					if(state.core.themes) {
						if(state.core.themes.name) {
							this.set_theme(state.core.themes.name);
						}
						if(typeof state.core.themes.dots !== 'undefined') {
							this[ state.core.themes.dots ? "show_dots" : "hide_dots" ]();
						}
						if(typeof state.core.themes.icons !== 'undefined') {
							this[ state.core.themes.icons ? "show_icons" : "hide_icons" ]();
						}
						delete state.core.themes;
						delete state.core.open;
						this.set_state(state, callback);
						return false;
					}
					*/
if(n.core.selected)return s=this,this.deselect_all(),e.each(n.core.selected,function(e,t){s.select_node(t)}),delete n.core.selected,this.set_state(n,i),!1;if(e.isEmptyObject(n.core))return delete n.core,this.set_state(n,i),!1}return!e.isEmptyObject(n)||(n=null,i&&i.call(this),this.trigger("set_state"),!1)}return!1},refresh:function(t,n){this._data.core.state=!0===n?{}:this.get_state(),n&&e.isFunction(n)&&(this._data.core.state=n.call(this,this._data.core.state)),this._cnt=0,this._model.data={"#":{id:"#",parent:null,parents:[],children:[],children_d:[],state:{loaded:!1}}};var i=this.get_container_ul()[0].className;t||this.element.html("<ul class='"+i+"'><li class='jstree-initial-node jstree-loading jstree-leaf jstree-last'><i class='jstree-icon jstree-ocl'></i><a class='jstree-anchor' href='#'><i class='jstree-icon jstree-themeicon-hidden'></i>"+this.get_string("Loading ...")+"</a></li></ul>"),this.load_node("#",function(t,n){n&&(this.get_container_ul()[0].className=i,this.set_state(e.extend(!0,{},this._data.core.state),function(){this.trigger("refresh")})),this._data.core.state=null})},refresh_node:function(t){if(!(t=this.get_node(t))||"#"===t.id)return!1;var n=[],i=[];this._data.core.selected.concat([]);i.push(t.id),!0===t.state.opened&&n.push(t.id),this.get_node(t,!0).find(".jstree-open").each(function(){n.push(this.id)}),this._load_nodes(i,e.proxy(function(e){this.open_node(n,!1,0),this.select_node(this._data.core.selected),this.trigger("refresh_node",{node:t,nodes:e})},this))},set_id:function(t,n){if(!(t=this.get_node(t))||"#"===t.id)return!1;var i,r,a=this._model.data;for(n=n.toString(),a[t.parent].children[e.inArray(t.id,a[t.parent].children)]=n,i=0,r=t.parents.length;i<r;i++)a[t.parents[i]].children_d[e.inArray(t.id,a[t.parents[i]].children_d)]=n;for(i=0,r=t.children.length;i<r;i++)a[t.children[i]].parent=n;for(i=0,r=t.children_d.length;i<r;i++)a[t.children_d[i]].parents[e.inArray(t.id,a[t.children_d[i]].parents)]=n;return i=e.inArray(t.id,this._data.core.selected),-1!==i&&(this._data.core.selected[i]=n),i=this.get_node(t.id,!0),i&&i.attr("id",n),delete a[t.id],t.id=n,a[n]=t,!0},get_text:function(e){return!(!(e=this.get_node(e))||"#"===e.id)&&e.text},set_text:function(t,n){var i,r;if(e.isArray(t)){for(t=t.slice(),i=0,r=t.length;i<r;i++)this.set_text(t[i],n);return!0}return!(!(t=this.get_node(t))||"#"===t.id)&&(t.text=n,this.get_node(t,!0).length&&this.redraw_node(t.id),this.trigger("set_text",{obj:t,text:n}),!0)},get_json:function(e,t,n){if(!(e=this.get_node(e||"#")))return!1;t&&t.flat&&!n&&(n=[]);var i,r,a={id:e.id,text:e.text,icon:this.get_icon(e),li_attr:e.li_attr,a_attr:e.a_attr,state:{},data:(!t||!t.no_data)&&e.data};if(t&&t.flat?a.parent=e.parent:a.children=[],!t||!t.no_state)for(i in e.state)e.state.hasOwnProperty(i)&&(a.state[i]=e.state[i]);if(t&&t.no_id&&(delete a.id,a.li_attr&&a.li_attr.id&&delete a.li_attr.id),t&&t.flat&&"#"!==e.id&&n.push(a),!t||!t.no_children)for(i=0,r=e.children.length;i<r;i++)t&&t.flat?this.get_json(e.children[i],t,n):a.children.push(this.get_json(e.children[i],t));return t&&t.flat?n:"#"===e.id?a.children:a},create_node:function(n,i,r,a,o){if(null===n&&(n="#"),!(n=this.get_node(n)))return!1;if(r=r===t?"last":r,!r.toString().match(/^(before|after)$/)&&!o&&!this.is_loaded(n))return this.load_node(n,function(){this.create_node(n,i,r,a,!0)});i||(i={text:this.get_string("New node")}),i.text===t&&(i.text=this.get_string("New node"));var s,l,c,d;switch("#"===n.id&&("before"===r&&(r="first"),"after"===r&&(r="last")),r){case"before":s=this.get_node(n.parent),r=e.inArray(n.id,s.children),n=s;break;case"after":s=this.get_node(n.parent),r=e.inArray(n.id,s.children)+1,n=s;break;case"inside":case"first":r=0;break;case"last":r=n.children.length;break;default:r||(r=0)}if(r>n.children.length&&(r=n.children.length),i.id||(i.id=!0),!this.check("create_node",i,n,r))return this.settings.core.error.call(this,this._data.core.last_error),!1;if(!0===i.id&&delete i.id,!(i=this._parse_model_from_json(i,n.id,n.parents.concat())))return!1;for(s=this.get_node(i),l=[],l.push(i),l=l.concat(s.children_d),this.trigger("model",{nodes:l,parent:n.id}),n.children_d=n.children_d.concat(l),c=0,d=n.parents.length;c<d;c++)this._model.data[n.parents[c]].children_d=this._model.data[n.parents[c]].children_d.concat(l);for(i=s,s=[],c=0,d=n.children.length;c<d;c++)s[c>=r?c+1:c]=n.children[c];return s[r]=i.id,n.children=s,this.redraw_node(n,!0),a&&a.call(this,this.get_node(i)),this.trigger("create_node",{node:this.get_node(i),parent:n.id,position:r}),i.id},rename_node:function(t,n){var i,r,a;if(e.isArray(t)){for(t=t.slice(),i=0,r=t.length;i<r;i++)this.rename_node(t[i],n);return!0}return!(!(t=this.get_node(t))||"#"===t.id)&&(a=t.text,this.check("rename_node",t,this.get_parent(t),n)?(this.set_text(t,n),this.trigger("rename_node",{node:t,text:n,old:a}),!0):(this.settings.core.error.call(this,this._data.core.last_error),!1))},delete_node:function(t){var n,i,r,a,o,s,l,c,d,u;if(e.isArray(t)){for(t=t.slice(),n=0,i=t.length;n<i;n++)this.delete_node(t[n]);return!0}if(!(t=this.get_node(t))||"#"===t.id)return!1;if(r=this.get_node(t.parent),a=e.inArray(t.id,r.children),u=!1,!this.check("delete_node",t,r,a))return this.settings.core.error.call(this,this._data.core.last_error),!1;for(-1!==a&&(r.children=e.vakata.array_remove(r.children,a)),o=t.children_d.concat([]),o.push(t.id),c=0,d=o.length;c<d;c++){for(s=0,l=t.parents.length;s<l;s++)-1!==(a=e.inArray(o[c],this._model.data[t.parents[s]].children_d))&&(this._model.data[t.parents[s]].children_d=e.vakata.array_remove(this._model.data[t.parents[s]].children_d,a));this._model.data[o[c]].state.selected&&(u=!0,-1!==(a=e.inArray(o[c],this._data.core.selected))&&(this._data.core.selected=e.vakata.array_remove(this._data.core.selected,a)))}for(this.trigger("delete_node",{node:t,parent:r.id}),u&&this.trigger("changed",{action:"delete_node",node:t,selected:this._data.core.selected,parent:r.id}),c=0,d=o.length;c<d;c++)delete this._model.data[o[c]];return this.redraw_node(r,!0),!0},check:function(t,n,i,r,a){n=n&&n.id?n:this.get_node(n),i=i&&i.id?i:this.get_node(i);var o=t.match(/^move_node|copy_node|create_node$/i)?i:n,s=this.settings.core.check_callback;return"move_node"!==t&&"copy_node"!==t||a&&a.is_multi||n.id!==i.id&&e.inArray(n.id,i.children)!==r&&-1===e.inArray(i.id,n.children_d)?(o&&o.data&&(o=o.data),o&&o.functions&&(!1===o.functions[t]||!0===o.functions[t])?(!1===o.functions[t]&&(this._data.core.last_error={error:"check",plugin:"core",id:"core_02",reason:"Node data prevents function: "+t,data:JSON.stringify({chk:t,pos:r,obj:!(!n||!n.id)&&n.id,par:!(!i||!i.id)&&i.id})}),o.functions[t]):!(!1===s||e.isFunction(s)&&!1===s.call(this,t,n,i,r,a)||s&&!1===s[t])||(this._data.core.last_error={error:"check",plugin:"core",id:"core_03",reason:"User config for core.check_callback prevents function: "+t,data:JSON.stringify({chk:t,pos:r,obj:!(!n||!n.id)&&n.id,par:!(!i||!i.id)&&i.id})},!1)):(this._data.core.last_error={error:"check",plugin:"core",id:"core_01",reason:"Moving parent inside child",data:JSON.stringify({chk:t,pos:r,obj:!(!n||!n.id)&&n.id,par:!(!i||!i.id)&&i.id})},!1)},last_error:function(){return this._data.core.last_error},move_node:function(n,i,r,a,o){var s,l,c,d,u,h,f,p,g,m,_,v,y,b;if(i=this.get_node(i),r=r===t?0:r,!i)return!1;if(!r.toString().match(/^(before|after)$/)&&!o&&!this.is_loaded(i))return this.load_node(i,function(){this.move_node(n,i,r,a,!0)});if(e.isArray(n)){for(n=n.reverse().slice(),s=0,l=n.length;s<l;s++)this.move_node(n[s],i,r,a,o);return!0}if(!(n=n&&n.id?n:this.get_node(n))||"#"===n.id)return!1;if(c=(n.parent||"#").toString(),u=r.toString().match(/^(before|after)$/)&&"#"!==i.id?this.get_node(i.parent):i,h=n.instance?n.instance:this._model.data[n.id]?this:e.jstree.reference(n.id),f=!h||!h._id||this._id!==h._id,d=h&&h._id&&c&&h._model.data[c]&&h._model.data[c].children?e.inArray(n.id,h._model.data[c].children):-1,f)return!!this.copy_node(n,i,r,a,o)&&(h&&h.delete_node(n),!0);switch("#"===u.id&&("before"===r&&(r="first"),"after"===r&&(r="last")),r){case"before":r=e.inArray(i.id,u.children);break;case"after":r=e.inArray(i.id,u.children)+1;break;case"inside":case"first":r=0;break;case"last":r=u.children.length;break;default:r||(r=0)}if(r>u.children.length&&(r=u.children.length),!this.check("move_node",n,u,r,{core:!0,is_multi:h&&h._id&&h._id!==this._id,is_foreign:!h||!h._id}))return this.settings.core.error.call(this,this._data.core.last_error),!1;if(n.parent===u.id){for(p=u.children.concat(),g=e.inArray(n.id,p),-1!==g&&(p=e.vakata.array_remove(p,g),r>g&&r--),g=[],m=0,_=p.length;m<_;m++)g[m>=r?m+1:m]=p[m];g[r]=n.id,u.children=g,this._node_changed(u.id),this.redraw("#"===u.id)}else{for(g=n.children_d.concat(),g.push(n.id),m=0,_=n.parents.length;m<_;m++){for(p=[],b=h._model.data[n.parents[m]].children_d,v=0,y=b.length;v<y;v++)-1===e.inArray(b[v],g)&&p.push(b[v]);h._model.data[n.parents[m]].children_d=p}for(h._model.data[c].children=e.vakata.array_remove_item(h._model.data[c].children,n.id),m=0,_=u.parents.length;m<_;m++)this._model.data[u.parents[m]].children_d=this._model.data[u.parents[m]].children_d.concat(g);for(p=[],m=0,_=u.children.length;m<_;m++)p[m>=r?m+1:m]=u.children[m];for(p[r]=n.id,u.children=p,u.children_d.push(n.id),u.children_d=u.children_d.concat(n.children_d),n.parent=u.id,g=u.parents.concat(),g.unshift(u.id),b=n.parents.length,n.parents=g,g=g.concat(),m=0,_=n.children_d.length;m<_;m++)this._model.data[n.children_d[m]].parents=this._model.data[n.children_d[m]].parents.slice(0,-1*b),Array.prototype.push.apply(this._model.data[n.children_d[m]].parents,g);this._node_changed(c),this._node_changed(u.id),this.redraw("#"===c||"#"===u.id)}return a&&a.call(this,n,u,r),this.trigger("move_node",{node:n,parent:u.id,position:r,old_parent:c,old_position:d,is_multi:h&&h._id&&h._id!==this._id,is_foreign:!h||!h._id,old_instance:h,new_instance:this}),!0},copy_node:function(n,i,r,a,o){var s,l,c,d,u,h,f,p,g,m;if(i=this.get_node(i),r=r===t?0:r,!i)return!1;if(!r.toString().match(/^(before|after)$/)&&!o&&!this.is_loaded(i))return this.load_node(i,function(){this.copy_node(n,i,r,a,!0)});if(e.isArray(n)){for(n=n.reverse().slice(),s=0,l=n.length;s<l;s++)this.copy_node(n[s],i,r,a,o);return!0}if(!(n=n&&n.id?n:this.get_node(n))||"#"===n.id)return!1;switch(p=(n.parent||"#").toString(),g=r.toString().match(/^(before|after)$/)&&"#"!==i.id?this.get_node(i.parent):i,m=n.instance?n.instance:this._model.data[n.id]?this:e.jstree.reference(n.id),!m||!m._id||this._id!==m._id,"#"===g.id&&("before"===r&&(r="first"),"after"===r&&(r="last")),r){case"before":r=e.inArray(i.id,g.children);break;case"after":r=e.inArray(i.id,g.children)+1;break;case"inside":case"first":r=0;break;case"last":r=g.children.length;break;default:r||(r=0)}if(r>g.children.length&&(r=g.children.length),!this.check("copy_node",n,g,r,{core:!0,is_multi:m&&m._id&&m._id!==this._id,is_foreign:!m||!m._id}))return this.settings.core.error.call(this,this._data.core.last_error),!1;if(!(f=m?m.get_json(n,{no_id:!0,no_data:!0,no_state:!0}):n))return!1;if(!0===f.id&&delete f.id,!(f=this._parse_model_from_json(f,g.id,g.parents.concat())))return!1;for(d=this.get_node(f),n&&n.state&&!1===n.state.loaded&&(d.state.loaded=!1),c=[],c.push(f),c=c.concat(d.children_d),this.trigger("model",{nodes:c,parent:g.id}),u=0,h=g.parents.length;u<h;u++)this._model.data[g.parents[u]].children_d=this._model.data[g.parents[u]].children_d.concat(c);for(c=[],u=0,h=g.children.length;u<h;u++)c[u>=r?u+1:u]=g.children[u];return c[r]=d.id,g.children=c,g.children_d.push(d.id),g.children_d=g.children_d.concat(d.children_d),this._node_changed(g.id),this.redraw("#"===g.id),a&&a.call(this,d,g,r),this.trigger("copy_node",{node:d,original:n,parent:g.id,position:r,old_parent:p,old_position:m&&m._id&&p&&m._model.data[p]&&m._model.data[p].children?e.inArray(n.id,m._model.data[p].children):-1,is_multi:m&&m._id&&m._id!==this._id,is_foreign:!m||!m._id,old_instance:m,new_instance:this}),d.id},cut:function(t){if(t||(t=this._data.core.selected.concat()),e.isArray(t)||(t=[t]),!t.length)return!1;var n,i,r,l=[];for(i=0,r=t.length;i<r;i++)(n=this.get_node(t[i]))&&n.id&&"#"!==n.id&&l.push(n);if(!l.length)return!1;a=l,s=this,o="move_node",this.trigger("cut",{node:t})},copy:function(t){if(t||(t=this._data.core.selected.concat()),e.isArray(t)||(t=[t]),!t.length)return!1;var n,i,r,l=[];for(i=0,r=t.length;i<r;i++)(n=this.get_node(t[i]))&&n.id&&"#"!==n.id&&l.push(n);if(!l.length)return!1;a=l,s=this,o="copy_node",this.trigger("copy",{node:t})},get_buffer:function(){return{mode:o,node:a,inst:s}},can_paste:function(){return!1!==o&&!1!==a},paste:function(e,t){if(!((e=this.get_node(e))&&o&&o.match(/^(copy_node|move_node)$/)&&a))return!1;this[o](a,e,t)&&this.trigger("paste",{parent:e.id,node:a,mode:o}),a=!1,o=!1,s=!1},edit:function(t,n){if(!(t=this.get_node(t)))return!1;if(!1===this.settings.core.check_callback)return this._data.core.last_error={error:"check",plugin:"core",id:"core_07",reason:"Could not edit node because of check_callback"},this.settings.core.error.call(this,this._data.core.last_error),!1;n="string"==typeof n?n:t.text,this.set_text(t,""),t=this._open_to(t);var i=this._data.core.rtl,r=this.element.width(),a=t.children(".jstree-anchor"),o=e("<span>"),/*!
				oi = obj.children("i:visible"),
				ai = a.children("i:visible"),
				w1 = oi.width() * oi.length,
				w2 = ai.width() * ai.length,
				*/
s=n,l=e("<div />",{css:{position:"absolute",top:"-200px",left:i?"0px":"-1000px",visibility:"hidden"}}).appendTo("body"),c=e("<input />",{value:s,class:"jstree-rename-input",css:{padding:"0",border:"1px solid silver","box-sizing":"border-box",display:"inline-block",height:this._data.core.li_height+"px",lineHeight:this._data.core.li_height+"px",width:"150px"},blur:e.proxy(function(){var n=o.children(".jstree-rename-input"),i=n.val();""===i&&(i=s),l.remove(),o.replaceWith(a),o.remove(),this.set_text(t,s),!1===this.rename_node(t,e("<div></div>").text(i)[this.settings.core.force_text?"text":"html"]())&&this.set_text(t,s)},this),keydown:function(e){var t=e.which;27===t&&(this.value=s),27!==t&&13!==t&&37!==t&&38!==t&&39!==t&&40!==t&&32!==t||e.stopImmediatePropagation(),27!==t&&13!==t||(e.preventDefault(),this.blur())},click:function(e){e.stopImmediatePropagation()},mousedown:function(e){e.stopImmediatePropagation()},keyup:function(e){c.width(Math.min(l.text("pW"+this.value).width(),r))},keypress:function(e){if(13===e.which)return!1}}),d={fontFamily:a.css("fontFamily")||"",fontSize:a.css("fontSize")||"",fontWeight:a.css("fontWeight")||"",fontStyle:a.css("fontStyle")||"",fontStretch:a.css("fontStretch")||"",fontVariant:a.css("fontVariant")||"",letterSpacing:a.css("letterSpacing")||"",wordSpacing:a.css("wordSpacing")||""};o.attr("class",a.attr("class")).append(a.contents().clone()).append(c),a.replaceWith(o),l.css(d),c.css(d).width(Math.min(l.text("pW"+c[0].value).width(),r))[0].select()},set_theme:function(t,n){if(!t)return!1;if(!0===n){var i=this.settings.core.themes.dir;i||(i=e.jstree.path+"/themes"),n=i+"/"+t+"/style.css"}n&&-1===e.inArray(n,l)&&(e("head").append('<link rel="stylesheet" href="'+n+'" type="text/css" />'),l.push(n)),this._data.core.themes.name&&this.element.removeClass("jstree-"+this._data.core.themes.name),this._data.core.themes.name=t,this.element.addClass("jstree-"+t),this.element[this.settings.core.themes.responsive?"addClass":"removeClass"]("jstree-"+t+"-responsive"),this.trigger("set_theme",{theme:t})},get_theme:function(){return this._data.core.themes.name},set_theme_variant:function(e){this._data.core.themes.variant&&this.element.removeClass("jstree-"+this._data.core.themes.name+"-"+this._data.core.themes.variant),this._data.core.themes.variant=e,e&&this.element.addClass("jstree-"+this._data.core.themes.name+"-"+this._data.core.themes.variant)},get_theme_variant:function(){return this._data.core.themes.variant},show_stripes:function(){this._data.core.themes.stripes=!0,this.get_container_ul().addClass("jstree-striped")},hide_stripes:function(){this._data.core.themes.stripes=!1,this.get_container_ul().removeClass("jstree-striped")},toggle_stripes:function(){this._data.core.themes.stripes?this.hide_stripes():this.show_stripes()},show_dots:function(){this._data.core.themes.dots=!0,this.get_container_ul().removeClass("jstree-no-dots")},hide_dots:function(){this._data.core.themes.dots=!1,this.get_container_ul().addClass("jstree-no-dots")},toggle_dots:function(){this._data.core.themes.dots?this.hide_dots():this.show_dots()},show_icons:function(){this._data.core.themes.icons=!0,this.get_container_ul().removeClass("jstree-no-icons")},hide_icons:function(){this._data.core.themes.icons=!1,this.get_container_ul().addClass("jstree-no-icons")},toggle_icons:function(){this._data.core.themes.icons?this.hide_icons():this.show_icons()},set_icon:function(t,n){var i,r,a,o;if(e.isArray(t)){for(t=t.slice(),i=0,r=t.length;i<r;i++)this.set_icon(t[i],n);return!0}return!(!(t=this.get_node(t))||"#"===t.id)&&(o=t.icon,t.icon=n,a=this.get_node(t,!0).children(".jstree-anchor").children(".jstree-themeicon"),!1===n?this.hide_icon(t):!0===n?a.removeClass("jstree-themeicon-custom "+o).css("background","").removeAttr("rel"):-1===n.indexOf("/")&&-1===n.indexOf(".")?(a.removeClass(o).css("background",""),a.addClass(n+" jstree-themeicon-custom").attr("rel",n)):(a.removeClass(o).css("background",""),a.addClass("jstree-themeicon-custom").css("background","url('"+n+"') center center no-repeat").attr("rel",n)),!0)},get_icon:function(e){return!(!(e=this.get_node(e))||"#"===e.id)&&e.icon},hide_icon:function(t){var n,i;if(e.isArray(t)){for(t=t.slice(),n=0,i=t.length;n<i;n++)this.hide_icon(t[n]);return!0}return!(!(t=this.get_node(t))||"#"===t)&&(t.icon=!1,this.get_node(t,!0).children(".jstree-anchor").children(".jstree-themeicon").addClass("jstree-themeicon-hidden"),!0)},show_icon:function(t){var n,i,r;if(e.isArray(t)){for(t=t.slice(),n=0,i=t.length;n<i;n++)this.show_icon(t[n]);return!0}return!(!(t=this.get_node(t))||"#"===t)&&(r=this.get_node(t,!0),t.icon=!r.length||r.children(".jstree-anchor").children(".jstree-themeicon").attr("rel"),t.icon||(t.icon=!0),r.children(".jstree-anchor").children(".jstree-themeicon").removeClass("jstree-themeicon-hidden"),!0)}},e.vakata={},e.vakata.attributes=function(t,n){t=e(t)[0];var i=n?{}:[];return t&&t.attributes&&e.each(t.attributes,function(t,r){-1===e.inArray(r.nodeName.toLowerCase(),["style","contenteditable","hasfocus","tabindex"])&&null!==r.nodeValue&&""!==e.trim(r.nodeValue)&&(n?i[r.nodeName]=r.nodeValue:i.push(r.nodeName))}),i},e.vakata.array_unique=function(e){var t,n,i,r=[];for(t=0,i=e.length;t<i;t++){for(n=0;n<=t&&e[t]!==e[n];n++);n===t&&r.push(e[t])}return r},e.vakata.array_remove=function(e,t,n){var i=e.slice((n||t)+1||e.length);return e.length=t<0?e.length+t:t,e.push.apply(e,i),e},e.vakata.array_remove_item=function(t,n){var i=e.inArray(n,t);return-1!==i?e.vakata.array_remove(t,i):t};var h=document.createElement("I");h.className="jstree-icon jstree-checkbox",e.jstree.defaults.checkbox={visible:!0,three_state:!0,whole_node:!0,keep_selected_style:!0,cascade:"",tie_selection:!0},e.jstree.plugins.checkbox=function(t,n){this.bind=function(){n.bind.call(this),this._data.checkbox.uto=!1,this._data.checkbox.selected=[],this.settings.checkbox.three_state&&(this.settings.checkbox.cascade="up+down+undetermined"),this.element.on("init.jstree",e.proxy(function(){this._data.checkbox.visible=this.settings.checkbox.visible,this.settings.checkbox.keep_selected_style||this.element.addClass("jstree-checkbox-no-clicked"),this.settings.checkbox.tie_selection&&this.element.addClass("jstree-checkbox-selection")},this)).on("loading.jstree",e.proxy(function(){this[this._data.checkbox.visible?"show_checkboxes":"hide_checkboxes"]()},this)),-1!==this.settings.checkbox.cascade.indexOf("undetermined")&&this.element.on("changed.jstree uncheck_node.jstree check_node.jstree uncheck_all.jstree check_all.jstree move_node.jstree copy_node.jstree redraw.jstree open_node.jstree",e.proxy(function(){this._data.checkbox.uto&&clearTimeout(this._data.checkbox.uto),this._data.checkbox.uto=setTimeout(e.proxy(this._undetermined,this),50)},this)),this.settings.checkbox.tie_selection||this.element.on("model.jstree",e.proxy(function(e,t){var n,i,r=this._model.data,a=(r[t.parent],t.nodes);for(n=0,i=a.length;n<i;n++)r[a[n]].state.checked=r[a[n]].original&&r[a[n]].original.state&&r[a[n]].original.state.checked,r[a[n]].state.checked&&this._data.checkbox.selected.push(a[n])},this)),-1===this.settings.checkbox.cascade.indexOf("up")&&-1===this.settings.checkbox.cascade.indexOf("down")||this.element.on("model.jstree",e.proxy(function(t,n){var i,r,a,o,s,l,c=this._model.data,d=c[n.parent],u=n.nodes,h=[],f=this.settings.checkbox.cascade,p=this.settings.checkbox.tie_selection;if(-1!==f.indexOf("down"))if(d.state[p?"selected":"checked"]){for(r=0,a=u.length;r<a;r++)c[u[r]].state[p?"selected":"checked"]=!0;this._data[p?"core":"checkbox"].selected=this._data[p?"core":"checkbox"].selected.concat(u)}else for(r=0,a=u.length;r<a;r++)if(c[u[r]].state[p?"selected":"checked"]){for(o=0,s=c[u[r]].children_d.length;o<s;o++)c[c[u[r]].children_d[o]].state[p?"selected":"checked"]=!0;this._data[p?"core":"checkbox"].selected=this._data[p?"core":"checkbox"].selected.concat(c[u[r]].children_d)}if(-1!==f.indexOf("up")){for(r=0,a=d.children_d.length;r<a;r++)c[d.children_d[r]].children.length||h.push(c[d.children_d[r]].parent);for(h=e.vakata.array_unique(h),o=0,s=h.length;o<s;o++)for(d=c[h[o]];d&&"#"!==d.id;){for(i=0,r=0,a=d.children.length;r<a;r++)i+=c[d.children[r]].state[p?"selected":"checked"];if(i!==a)break;d.state[p?"selected":"checked"]=!0,this._data[p?"core":"checkbox"].selected.push(d.id),(l=this.get_node(d,!0))&&l.length&&l.children(".jstree-anchor").addClass(p?"jstree-clicked":"jstree-checked"),d=this.get_node(d.parent)}}this._data[p?"core":"checkbox"].selected=e.vakata.array_unique(this._data[p?"core":"checkbox"].selected)},this)).on(this.settings.checkbox.tie_selection?"select_node.jstree":"check_node.jstree",e.proxy(function(t,n){var i,r,a,o,s=n.node,l=this._model.data,c=this.get_node(s.parent),d=this.get_node(s,!0),u=this.settings.checkbox.cascade,h=this.settings.checkbox.tie_selection;if(-1!==u.indexOf("down"))for(this._data[h?"core":"checkbox"].selected=e.vakata.array_unique(this._data[h?"core":"checkbox"].selected.concat(s.children_d)),i=0,r=s.children_d.length;i<r;i++)o=l[s.children_d[i]],o.state[h?"selected":"checked"]=!0,o&&o.original&&o.original.state&&o.original.state.undetermined&&(o.original.state.undetermined=!1);if(-1!==u.indexOf("up"))for(;c&&"#"!==c.id;){for(a=0,i=0,r=c.children.length;i<r;i++)a+=l[c.children[i]].state[h?"selected":"checked"];if(a!==r)break;c.state[h?"selected":"checked"]=!0,this._data[h?"core":"checkbox"].selected.push(c.id),(o=this.get_node(c,!0))&&o.length&&o.children(".jstree-anchor").addClass(h?"jstree-clicked":"jstree-checked"),c=this.get_node(c.parent)}-1!==u.indexOf("down")&&d.length&&d.find(".jstree-anchor").addClass(h?"jstree-clicked":"jstree-checked")},this)).on(this.settings.checkbox.tie_selection?"deselect_all.jstree":"uncheck_all.jstree",e.proxy(function(e,t){var n,i,r,a=this.get_node("#"),o=this._model.data;for(n=0,i=a.children_d.length;n<i;n++)(r=o[a.children_d[n]])&&r.original&&r.original.state&&r.original.state.undetermined&&(r.original.state.undetermined=!1)},this)).on(this.settings.checkbox.tie_selection?"deselect_node.jstree":"uncheck_node.jstree",e.proxy(function(t,n){var i,r,a,o=n.node,s=this.get_node(o,!0),l=this.settings.checkbox.cascade,c=this.settings.checkbox.tie_selection;if(o&&o.original&&o.original.state&&o.original.state.undetermined&&(o.original.state.undetermined=!1),-1!==l.indexOf("down"))for(i=0,r=o.children_d.length;i<r;i++)a=this._model.data[o.children_d[i]],a.state[c?"selected":"checked"]=!1,a&&a.original&&a.original.state&&a.original.state.undetermined&&(a.original.state.undetermined=!1);if(-1!==l.indexOf("up"))for(i=0,r=o.parents.length;i<r;i++)a=this._model.data[o.parents[i]],a.state[c?"selected":"checked"]=!1,a&&a.original&&a.original.state&&a.original.state.undetermined&&(a.original.state.undetermined=!1),(a=this.get_node(o.parents[i],!0))&&a.length&&a.children(".jstree-anchor").removeClass(c?"jstree-clicked":"jstree-checked");for(a=[],i=0,r=this._data[c?"core":"checkbox"].selected.length;i<r;i++)-1!==l.indexOf("down")&&-1!==e.inArray(this._data[c?"core":"checkbox"].selected[i],o.children_d)||-1!==l.indexOf("up")&&-1!==e.inArray(this._data[c?"core":"checkbox"].selected[i],o.parents)||a.push(this._data[c?"core":"checkbox"].selected[i]);this._data[c?"core":"checkbox"].selected=e.vakata.array_unique(a),-1!==l.indexOf("down")&&s.length&&s.find(".jstree-anchor").removeClass(c?"jstree-clicked":"jstree-checked")},this)),-1!==this.settings.checkbox.cascade.indexOf("up")&&this.element.on("delete_node.jstree",e.proxy(function(e,t){for(var n,i,r,a,o=this.get_node(t.parent),s=this._model.data,l=this.settings.checkbox.tie_selection;o&&"#"!==o.id;){for(r=0,n=0,i=o.children.length;n<i;n++)r+=s[o.children[n]].state[l?"selected":"checked"];if(r!==i)break;o.state[l?"selected":"checked"]=!0,this._data[l?"core":"checkbox"].selected.push(o.id),(a=this.get_node(o,!0))&&a.length&&a.children(".jstree-anchor").addClass(l?"jstree-clicked":"jstree-checked"),o=this.get_node(o.parent)}},this)).on("move_node.jstree",e.proxy(function(t,n){var i,r,a,o,s,l=n.is_multi,c=n.old_parent,d=this.get_node(n.parent),u=this._model.data,h=this.settings.checkbox.tie_selection;if(!l)for(i=this.get_node(c);i&&"#"!==i.id;){for(r=0,a=0,o=i.children.length;a<o;a++)r+=u[i.children[a]].state[h?"selected":"checked"];if(r!==o)break;i.state[h?"selected":"checked"]=!0,this._data[h?"core":"checkbox"].selected.push(i.id),(s=this.get_node(i,!0))&&s.length&&s.children(".jstree-anchor").addClass(h?"jstree-clicked":"jstree-checked"),i=this.get_node(i.parent)}for(i=d;i&&"#"!==i.id;){for(r=0,a=0,o=i.children.length;a<o;a++)r+=u[i.children[a]].state[h?"selected":"checked"];if(r===o)i.state[h?"selected":"checked"]||(i.state[h?"selected":"checked"]=!0,this._data[h?"core":"checkbox"].selected.push(i.id),(s=this.get_node(i,!0))&&s.length&&s.children(".jstree-anchor").addClass(h?"jstree-clicked":"jstree-checked"));else{if(!i.state[h?"selected":"checked"])break;i.state[h?"selected":"checked"]=!1,this._data[h?"core":"checkbox"].selected=e.vakata.array_remove_item(this._data[h?"core":"checkbox"].selected,i.id),(s=this.get_node(i,!0))&&s.length&&s.children(".jstree-anchor").removeClass(h?"jstree-clicked":"jstree-checked")}i=this.get_node(i.parent)}},this))},this._undetermined=function(){var t,n,i=this._model.data,r=this.settings.checkbox.tie_selection,a=this._data[r?"core":"checkbox"].selected,o=[],s=this;for(t=0,n=a.length;t<n;t++)i[a[t]]&&i[a[t]].parents&&(o=o.concat(i[a[t]].parents));for(this.element.find(".jstree-closed").not(":has(.jstree-children)").each(function(){var e,r=s.get_node(this);if(r.state.loaded)for(t=0,n=r.children_d.length;t<n;t++)e=i[r.children_d[t]],!e.state.loaded&&e.original&&e.original.state&&e.original.state.undetermined&&!0===e.original.state.undetermined&&(o.push(e.id),o=o.concat(e.parents));else r.original&&r.original.state&&r.original.state.undetermined&&!0===r.original.state.undetermined&&(o.push(r.id),o=o.concat(r.parents))}),o=e.vakata.array_unique(o),o=e.vakata.array_remove_item(o,"#"),this.element.find(".jstree-undetermined").removeClass("jstree-undetermined"),t=0,n=o.length;t<n;t++)i[o[t]].state[r?"selected":"checked"]||(a=this.get_node(o[t],!0))&&a.length&&a.children(".jstree-anchor").children(".jstree-checkbox").addClass("jstree-undetermined")},this.redraw_node=function(t,i,r){if(t=n.redraw_node.call(this,t,i,r)){var a,o,s=null;for(a=0,o=t.childNodes.length;a<o;a++)if(t.childNodes[a]&&t.childNodes[a].className&&-1!==t.childNodes[a].className.indexOf("jstree-anchor")){s=t.childNodes[a];break}s&&(!this.settings.checkbox.tie_selection&&this._model.data[t.id].state.checked&&(s.className+=" jstree-checked"),s.insertBefore(h.cloneNode(!1),s.childNodes[0]))}return r||-1===this.settings.checkbox.cascade.indexOf("undetermined")||(this._data.checkbox.uto&&clearTimeout(this._data.checkbox.uto),this._data.checkbox.uto=setTimeout(e.proxy(this._undetermined,this),50)),t},this.show_checkboxes=function(){this._data.core.themes.checkboxes=!0,this.get_container_ul().removeClass("jstree-no-checkboxes")},this.hide_checkboxes=function(){this._data.core.themes.checkboxes=!1,this.get_container_ul().addClass("jstree-no-checkboxes")},this.toggle_checkboxes=function(){this._data.core.themes.checkboxes?this.hide_checkboxes():this.show_checkboxes()},this.is_undetermined=function(t){t=this.get_node(t);var n,i,r=this.settings.checkbox.cascade,a=this.settings.checkbox.tie_selection,o=this._data[a?"core":"checkbox"].selected,s=this._model.data;if(!t||!0===t.state[a?"selected":"checked"]||-1===r.indexOf("undetermined")||-1===r.indexOf("down")&&-1===r.indexOf("up"))return!1;if(!t.state.loaded&&!0===t.original.state.undetermined)return!0;for(n=0,i=t.children_d.length;n<i;n++)if(-1!==e.inArray(t.children_d[n],o)||!s[t.children_d[n]].state.loaded&&s[t.children_d[n]].original.state.undetermined)return!0;return!1},this.activate_node=function(t,i){if(this.settings.checkbox.tie_selection&&(this.settings.checkbox.whole_node||e(i.target).hasClass("jstree-checkbox"))&&(i.ctrlKey=!0),this.settings.checkbox.tie_selection||!this.settings.checkbox.whole_node&&!e(i.target).hasClass("jstree-checkbox"))return n.activate_node.call(this,t,i);this.is_checked(t)?this.uncheck_node(t,i):this.check_node(t,i),this.trigger("activate_node",{node:this.get_node(t)})},this.check_node=function(t,n){if(this.settings.checkbox.tie_selection)return this.select_node(t,!1,!0,n);var i,r,a;if(e.isArray(t)){for(t=t.slice(),r=0,a=t.length;r<a;r++)this.check_node(t[r],n);return!0}if(!(t=this.get_node(t))||"#"===t.id)return!1;i=this.get_node(t,!0),t.state.checked||(t.state.checked=!0,this._data.checkbox.selected.push(t.id),i&&i.length&&i.children(".jstree-anchor").addClass("jstree-checked"),this.trigger("check_node",{node:t,selected:this._data.checkbox.selected,event:n}))},this.uncheck_node=function(t,n){if(this.settings.checkbox.tie_selection)return this.deselect_node(t,!1,n);var i,r,a;if(e.isArray(t)){for(t=t.slice(),i=0,r=t.length;i<r;i++)this.uncheck_node(t[i],n);return!0}if(!(t=this.get_node(t))||"#"===t.id)return!1;a=this.get_node(t,!0),t.state.checked&&(t.state.checked=!1,this._data.checkbox.selected=e.vakata.array_remove_item(this._data.checkbox.selected,t.id),a.length&&a.children(".jstree-anchor").removeClass("jstree-checked"),this.trigger("uncheck_node",{node:t,selected:this._data.checkbox.selected,event:n}))},this.check_all=function(){if(this.settings.checkbox.tie_selection)return this.select_all();var e,t;this._data.checkbox.selected.concat([]);for(this._data.checkbox.selected=this._model.data["#"].children_d.concat(),e=0,t=this._data.checkbox.selected.length;e<t;e++)this._model.data[this._data.checkbox.selected[e]]&&(this._model.data[this._data.checkbox.selected[e]].state.checked=!0);this.redraw(!0),this.trigger("check_all",{selected:this._data.checkbox.selected})},this.uncheck_all=function(){if(this.settings.checkbox.tie_selection)return this.deselect_all();var e,t,n=this._data.checkbox.selected.concat([]);for(e=0,t=this._data.checkbox.selected.length;e<t;e++)this._model.data[this._data.checkbox.selected[e]]&&(this._model.data[this._data.checkbox.selected[e]].state.checked=!1);this._data.checkbox.selected=[],this.element.find(".jstree-checked").removeClass("jstree-checked"),this.trigger("uncheck_all",{selected:this._data.checkbox.selected,node:n})},this.is_checked=function(e){return this.settings.checkbox.tie_selection?this.is_selected(e):!(!(e=this.get_node(e))||"#"===e.id)&&e.state.checked},this.get_checked=function(t){return this.settings.checkbox.tie_selection?this.get_selected(t):t?e.map(this._data.checkbox.selected,e.proxy(function(e){return this.get_node(e)},this)):this._data.checkbox.selected},this.get_top_checked=function(t){if(this.settings.checkbox.tie_selection)return this.get_top_selected(t);var n,i,r,a,o=this.get_checked(!0),s={};for(n=0,i=o.length;n<i;n++)s[o[n].id]=o[n];for(n=0,i=o.length;n<i;n++)for(r=0,a=o[n].children_d.length;r<a;r++)s[o[n].children_d[r]]&&delete s[o[n].children_d[r]];o=[];for(n in s)s.hasOwnProperty(n)&&o.push(n);return t?e.map(o,e.proxy(function(e){return this.get_node(e)},this)):o},this.get_bottom_checked=function(t){if(this.settings.checkbox.tie_selection)return this.get_bottom_selected(t);var n,i,r=this.get_checked(!0),a=[];for(n=0,i=r.length;n<i;n++)r[n].children.length||a.push(r[n].id);return t?e.map(a,e.proxy(function(e){return this.get_node(e)},this)):a}},e.jstree.defaults.contextmenu={select_node:!0,show_at_node:!0,items:function(t,n){return{create:{separator_before:!1,separator_after:!0,_disabled:!1,label:"Create",action:function(t){var n=e.jstree.reference(t.reference),i=n.get_node(t.reference);n.create_node(i,{},"last",function(e){setTimeout(function(){n.edit(e)},0)})}},rename:{separator_before:!1,separator_after:!1,_disabled:!1,label:"Rename",action:function(t){var n=e.jstree.reference(t.reference),i=n.get_node(t.reference);n.edit(i)}},remove:{separator_before:!1,icon:!1,separator_after:!1,_disabled:!1,label:"Delete",action:function(t){var n=e.jstree.reference(t.reference),i=n.get_node(t.reference);n.is_selected(i)?n.delete_node(n.get_selected()):n.delete_node(i)}},ccp:{separator_before:!0,icon:!1,separator_after:!1,label:"Edit",action:!1,submenu:{cut:{separator_before:!1,separator_after:!1,label:"Cut",action:function(t){var n=e.jstree.reference(t.reference),i=n.get_node(t.reference);n.is_selected(i)?n.cut(n.get_selected()):n.cut(i)}},copy:{separator_before:!1,icon:!1,separator_after:!1,label:"Copy",action:function(t){var n=e.jstree.reference(t.reference),i=n.get_node(t.reference);n.is_selected(i)?n.copy(n.get_selected()):n.copy(i)}},paste:{separator_before:!1,icon:!1,_disabled:function(t){return!e.jstree.reference(t.reference).can_paste()},separator_after:!1,label:"Paste",action:function(t){var n=e.jstree.reference(t.reference),i=n.get_node(t.reference);n.paste(i)}}}}}}},e.jstree.plugins.contextmenu=function(n,i){this.bind=function(){i.bind.call(this);var t=0;this.element.on("contextmenu.jstree",".jstree-anchor",e.proxy(function(e){e.preventDefault(),t=e.ctrlKey?e.timeStamp:0,this.is_loading(e.currentTarget)||this.show_contextmenu(e.currentTarget,e.pageX,e.pageY,e)},this)).on("click.jstree",".jstree-anchor",e.proxy(function(n){this._data.contextmenu.visible&&(!t||n.timeStamp-t>250)&&e.vakata.context.hide()},this)),e(document).on("context_hide.vakata",e.proxy(function(){this._data.contextmenu.visible=!1},this))},this.teardown=function(){this._data.contextmenu.visible&&e.vakata.context.hide(),i.teardown.call(this)},this.show_contextmenu=function(n,i,r,a){if(!(n=this.get_node(n))||"#"===n.id)return!1;var o=this.settings.contextmenu,s=this.get_node(n,!0),l=s.children(".jstree-anchor"),c=!1,d=!1;(o.show_at_node||i===t||r===t)&&(c=l.offset(),i=c.left,r=c.top+this._data.core.li_height),this.settings.contextmenu.select_node&&!this.is_selected(n)&&this.activate_node(n,a),d=o.items,e.isFunction(d)&&(d=d.call(this,n,e.proxy(function(e){this._show_contextmenu(n,i,r,e)},this))),e.isPlainObject(d)&&this._show_contextmenu(n,i,r,d)},this._show_contextmenu=function(t,n,i,r){var a=this.get_node(t,!0),o=a.children(".jstree-anchor");e(document).one("context_show.vakata",e.proxy(function(t,n){var i="jstree-contextmenu jstree-"+this.get_theme()+"-contextmenu";e(n.element).addClass(i)},this)),this._data.contextmenu.visible=!0,e.vakata.context.show(o,{x:n,y:i},r),this.trigger("show_contextmenu",{node:t,x:n,y:i})}},function(e){var t=!1,n={element:!1,reference:!1,position_x:0,position_y:0,items:[],html:"",is_visible:!1};e.vakata.context={settings:{hide_onmouseleave:0,icons:!0},_trigger:function(t){e(document).triggerHandler("context_"+t+".vakata",{reference:n.reference,element:n.element,position:{x:n.position_x,y:n.position_y}})},_execute:function(t){return!(!(t=n.items[t])||t._disabled&&(!e.isFunction(t._disabled)||t._disabled({item:t,reference:n.reference,element:n.element}))||!t.action)&&t.action.call(null,{item:t,reference:n.reference,element:n.element,position:{x:n.position_x,y:n.position_y}})},_parse:function(t,i){if(!t)return!1;i||(n.html="",n.items=[]);var r,a="",o=!1;return i&&(a+="<ul>"),e.each(t,function(t,i){if(!i)return!0;n.items.push(i),!o&&i.separator_before&&(a+="<li class='vakata-context-separator'><a href='#' "+(e.vakata.context.settings.icons?"":'style="margin-left:0px;"')+">&#160;</a></li>"),o=!1,a+="<li class='"+(i._class||"")+(!0===i._disabled||e.isFunction(i._disabled)&&i._disabled({item:i,reference:n.reference,element:n.element})?" vakata-contextmenu-disabled ":"")+"' "+(i.shortcut?" data-shortcut='"+i.shortcut+"' ":"")+">",a+="<a href='#' rel='"+(n.items.length-1)+"'>",e.vakata.context.settings.icons&&(a+="<i ",i.icon&&(-1!==i.icon.indexOf("/")||-1!==i.icon.indexOf(".")?a+=" style='background:url(\""+i.icon+"\") center center no-repeat' ":a+=" class='"+i.icon+"' "),a+="></i><span class='vakata-contextmenu-sep'>&#160;</span>"),a+=(e.isFunction(i.label)?i.label({item:t,reference:n.reference,element:n.element}):i.label)+(i.shortcut?' <span class="vakata-contextmenu-shortcut vakata-contextmenu-shortcut-'+i.shortcut+'">'+(i.shortcut_label||"")+"</span>":"")+"</a>",i.submenu&&(r=e.vakata.context._parse(i.submenu,!0))&&(a+=r),a+="</li>",i.separator_after&&(a+="<li class='vakata-context-separator'><a href='#' "+(e.vakata.context.settings.icons?"":'style="margin-left:0px;"')+">&#160;</a></li>",o=!0)}),a=a.replace(/<li class\='vakata-context-separator'\><\/li\>$/,""),i&&(a+="</ul>"),i||(n.html=a,e.vakata.context._trigger("parse")),a.length>10&&a},_show_submenu:function(n){if(n=e(n),n.length&&n.children("ul").length){var i=n.children("ul"),r=n.offset().left+n.outerWidth(),a=n.offset().top,o=i.width(),s=i.height(),l=e(window).width()+e(window).scrollLeft(),c=e(window).height()+e(window).scrollTop();t?n[r-(o+10+n.outerWidth())<0?"addClass":"removeClass"]("vakata-context-left"):n[r+o+10>l?"addClass":"removeClass"]("vakata-context-right"),a+s+10>c&&i.css("bottom","-1px"),i.show()}},show:function(i,r,a){var o,s,l,c,d,u,h,f;switch(n.element&&n.element.length&&n.element.width(""),!0){case!r&&!i:return!1;case!!r&&!!i:n.reference=i,n.position_x=r.x,n.position_y=r.y;break;case!r&&!!i:n.reference=i,o=i.offset(),n.position_x=o.left+i.outerHeight(),n.position_y=o.top;break;case!!r&&!i:n.position_x=r.x,n.position_y=r.y}i&&!a&&e(i).data("vakata_contextmenu")&&(a=e(i).data("vakata_contextmenu")),e.vakata.context._parse(a)&&n.element.html(n.html),n.items.length&&(s=n.element,l=n.position_x,c=n.position_y,d=s.width(),u=s.height(),h=e(window).width()+e(window).scrollLeft(),f=e(window).height()+e(window).scrollTop(),t&&(l-=s.outerWidth())<e(window).scrollLeft()+20&&(l=e(window).scrollLeft()+20),l+d+20>h&&(l=h-(d+20)),c+u+20>f&&(c=f-(u+20)),n.element.css({left:l,top:c}).show().find("a:eq(0)").focus().parent().addClass("vakata-context-hover"),n.is_visible=!0,e.vakata.context._trigger("show"))},hide:function(){n.is_visible&&(n.element.hide().find("ul").hide().end().find(":focus").blur(),n.is_visible=!1,e.vakata.context._trigger("hide"))}},e(function(){t="rtl"===e("body").css("direction");var i=!1;n.element=e("<ul class='vakata-context'></ul>"),n.element.on("mouseenter","li",function(t){t.stopImmediatePropagation(),e.contains(this,t.relatedTarget)||(i&&clearTimeout(i),n.element.find(".vakata-context-hover").removeClass("vakata-context-hover").end(),e(this).siblings().find("ul").hide().end().end().parentsUntil(".vakata-context","li").addBack().addClass("vakata-context-hover"),e.vakata.context._show_submenu(this))}).on("mouseleave","li",function(t){e.contains(this,t.relatedTarget)||e(this).find(".vakata-context-hover").addBack().removeClass("vakata-context-hover")}).on("mouseleave",function(t){e(this).find(".vakata-context-hover").removeClass("vakata-context-hover"),e.vakata.context.settings.hide_onmouseleave&&(i=setTimeout(function(t){return function(){e.vakata.context.hide()}}(),e.vakata.context.settings.hide_onmouseleave))}).on("click","a",function(t){t.preventDefault(),e(this).blur().parent().hasClass("vakata-context-disabled")||!1===e.vakata.context._execute(e(this).attr("rel"))||e.vakata.context.hide()}).on("keydown","a",function(t){var i=null;switch(t.which){case 13:case 32:t.type="mouseup",t.preventDefault(),e(t.currentTarget).trigger(t);break;case 37:n.is_visible&&(n.element.find(".vakata-context-hover").last().parents("li:eq(0)").find("ul").hide().find(".vakata-context-hover").removeClass("vakata-context-hover").end().end().children("a").focus(),t.stopImmediatePropagation(),t.preventDefault());break;case 38:n.is_visible&&(i=n.element.find("ul:visible").addBack().last().children(".vakata-context-hover").removeClass("vakata-context-hover").prevAll("li:not(.vakata-context-separator)").first(),i.length||(i=n.element.find("ul:visible").addBack().last().children("li:not(.vakata-context-separator)").last()),i.addClass("vakata-context-hover").children("a").focus(),t.stopImmediatePropagation(),t.preventDefault());break;case 39:n.is_visible&&(n.element.find(".vakata-context-hover").last().children("ul").show().children("li:not(.vakata-context-separator)").removeClass("vakata-context-hover").first().addClass("vakata-context-hover").children("a").focus(),t.stopImmediatePropagation(),t.preventDefault());break;case 40:n.is_visible&&(i=n.element.find("ul:visible").addBack().last().children(".vakata-context-hover").removeClass("vakata-context-hover").nextAll("li:not(.vakata-context-separator)").first(),i.length||(i=n.element.find("ul:visible").addBack().last().children("li:not(.vakata-context-separator)").first()),i.addClass("vakata-context-hover").children("a").focus(),t.stopImmediatePropagation(),t.preventDefault());break;case 27:e.vakata.context.hide(),t.preventDefault()}}).on("keydown",function(e){e.preventDefault();var t=n.element.find(".vakata-contextmenu-shortcut-"+e.which).parent();t.parent().not(".vakata-context-disabled")&&t.mouseup()}).appendTo("body"),e(document).on("mousedown",function(t){n.is_visible&&!e.contains(n.element[0],t.target)&&e.vakata.context.hide()}).on("context_show.vakata",function(e,i){n.element.find("li:has(ul)").children("a").addClass("vakata-context-parent"),t&&n.element.addClass("vakata-context-rtl").css("direction","rtl"),n.element.find("ul").hide().end()})})}(e),e.jstree.defaults.dnd={copy:!0,open_timeout:500,is_draggable:!0,check_while_dragging:!0,always_copy:!1,inside_pos:0},e.jstree.plugins.dnd=function(t,n){this.bind=function(){n.bind.call(this),this.element.on("mousedown.jstree touchstart.jstree",".jstree-anchor",e.proxy(function(t){var n=this.get_node(t.target),i=this.is_selected(n)?this.get_selected().length:1;if(n&&n.id&&"#"!==n.id&&(1===t.which||"touchstart"===t.type)&&(!0===this.settings.dnd.is_draggable||e.isFunction(this.settings.dnd.is_draggable)&&this.settings.dnd.is_draggable.call(this,i>1?this.get_selected(!0):[n])))return this.element.trigger("mousedown.jstree"),e.vakata.dnd.start(t,{jstree:!0,origin:this,obj:this.get_node(n,!0),nodes:i>1?this.get_selected():[n.id]},'<div id="jstree-dnd" class="jstree-'+this.get_theme()+(this.settings.core.themes.responsive?" jstree-dnd-responsive":"")+'"><i class="jstree-icon jstree-er"></i>'+(i>1?i+" "+this.get_string("nodes"):this.get_text(t.currentTarget,!0))+'<ins class="jstree-copy" style="display:none;">+</ins></div>')},this))}},e(function(){var t=!1,n=!1,i=!1,r=e('<div id="jstree-marker">&#160;</div>').hide().appendTo("body");e(document).bind("dnd_start.vakata",function(e,n){t=!1}).bind("dnd_move.vakata",function(a,o){if(i&&clearTimeout(i),o&&o.data&&o.data.jstree&&(!o.event.target.id||"jstree-marker"!==o.event.target.id)){var s,l,c,d,u,h,f,p,g,m,_,v,y,b,w=e.jstree.reference(o.event.target),x=!1,k=!1,M=!1;if(w&&w._data&&w._data.dnd)if(r.attr("class","jstree-"+w.get_theme()+(w.settings.core.themes.responsive?" jstree-dnd-responsive":"")),o.helper.children().attr("class","jstree-"+w.get_theme()+(w.settings.core.themes.responsive?" jstree-dnd-responsive":"")).find(".jstree-copy:eq(0)")[o.data.origin&&(o.data.origin.settings.dnd.always_copy||o.data.origin.settings.dnd.copy&&(o.event.metaKey||o.event.ctrlKey))?"show":"hide"](),o.event.target!==w.element[0]&&o.event.target!==w.get_container_ul()[0]||0!==w.get_container_ul().children().length){if((x=e(o.event.target).closest(".jstree-anchor"))&&x.length&&x.parent().is(".jstree-closed, .jstree-open, .jstree-leaf")&&(k=x.offset(),M=o.event.pageY-k.top,c=x.height(),h=M<c/3?["b","i","a"]:M>c-c/3?["a","i","b"]:M>c/2?["i","a","b"]:["i","b","a"],e.each(h,function(a,M){switch(M){case"b":s=k.left-6,l=k.top,d=w.get_parent(x),u=x.parent().index();break;case"i":y=w.settings.dnd.inside_pos,b=w.get_node(x.parent()),s=k.left-2,l=k.top+c/2+1,d=b.id,u="first"===y?0:"last"===y?b.children.length:Math.min(y,b.children.length);break;case"a":s=k.left-6,l=k.top+c,d=w.get_parent(x),u=x.parent().index()+1}for(/*!
								// TODO: moving inside, but the node is not yet loaded?
								// the check will work anyway, as when moving the node will be loaded first and checked again
								if(v === 'i' && !ins.is_loaded(p)) { }
								*/
f=!0,p=0,g=o.data.nodes.length;p<g;p++)if(m=o.data.origin&&(o.data.origin.settings.dnd.always_copy||o.data.origin.settings.dnd.copy&&(o.event.metaKey||o.event.ctrlKey))?"copy_node":"move_node",_=u,"move_node"===m&&"a"===M&&o.data.origin&&o.data.origin===w&&d===w.get_parent(o.data.nodes[p])&&(v=w.get_node(d),_>e.inArray(o.data.nodes[p],v.children)&&(_-=1)),!(f=f&&(w&&w.settings&&w.settings.dnd&&!1===w.settings.dnd.check_while_dragging||w.check(m,o.data.origin&&o.data.origin!==w?o.data.origin.get_node(o.data.nodes[p]):o.data.nodes[p],d,_,{dnd:!0,ref:w.get_node(x.parent()),pos:M,is_multi:o.data.origin&&o.data.origin!==w,is_foreign:!o.data.origin})))){w&&w.last_error&&(n=w.last_error());break}if(f)return"i"===M&&x.parent().is(".jstree-closed")&&w.settings.dnd.open_timeout&&(i=setTimeout(function(e,t){return function(){e.open_node(t)}}(w,x),w.settings.dnd.open_timeout)),t={ins:w,par:d,pos:"i"!==M||"last"!==y||0!==u||w.is_loaded(b)?u:"last"},r.css({left:s+"px",top:l+"px"}).show(),o.helper.find(".jstree-icon:eq(0)").removeClass("jstree-er").addClass("jstree-ok"),n={},h=!0,!1}),!0===h))return}else{for(f=!0,p=0,g=o.data.nodes.length;p<g&&(f=f&&w.check(o.data.origin&&(o.data.origin.settings.dnd.always_copy||o.data.origin.settings.dnd.copy&&(o.event.metaKey||o.event.ctrlKey))?"copy_node":"move_node",o.data.origin&&o.data.origin!==w?o.data.origin.get_node(o.data.nodes[p]):o.data.nodes[p],"#","last",{dnd:!0,ref:w.get_node("#"),pos:"i",is_multi:o.data.origin&&o.data.origin!==w,is_foreign:!o.data.origin}));p++);if(f)return t={ins:w,par:"#",pos:"last"},r.hide(),void o.helper.find(".jstree-icon:eq(0)").removeClass("jstree-er").addClass("jstree-ok")}t=!1,o.helper.find(".jstree-icon").removeClass("jstree-ok").addClass("jstree-er"),r.hide()}}).bind("dnd_scroll.vakata",function(e,n){n&&n.data&&n.data.jstree&&(r.hide(),t=!1,n.helper.find(".jstree-icon:eq(0)").removeClass("jstree-ok").addClass("jstree-er"))}).bind("dnd_stop.vakata",function(a,o){if(i&&clearTimeout(i),o&&o.data&&o.data.jstree){r.hide();var s,l,c=[];if(t){for(s=0,l=o.data.nodes.length;s<l;s++)c[s]=o.data.origin?o.data.origin.get_node(o.data.nodes[s]):o.data.nodes[s],o.data.origin&&(c[s].instance=o.data.origin);t.ins[o.data.origin&&(o.data.origin.settings.dnd.always_copy||o.data.origin.settings.dnd.copy&&(o.event.metaKey||o.event.ctrlKey))?"copy_node":"move_node"](c,t.par,t.pos)}else s=e(o.event.target).closest(".jstree"),s.length&&n&&n.error&&"check"===n.error&&(s=s.jstree(!0))&&s.settings.core.error.call(this,n)}}).bind("keyup keydown",function(t,n){(n=e.vakata.dnd._get())&&n.data&&n.data.jstree&&n.helper.find(".jstree-copy:eq(0)")[n.data.origin&&(n.data.origin.settings.dnd.always_copy||n.data.origin.settings.dnd.copy&&(t.metaKey||t.ctrlKey))?"show":"hide"]()})}),function(e){var t={element:!1,target:!1,is_down:!1,is_drag:!1,helper:!1,helper_w:0,data:!1,init_x:0,init_y:0,scroll_l:0,scroll_t:0,scroll_e:!1,scroll_i:!1,is_touch:!1};e.vakata.dnd={settings:{scroll_speed:10,scroll_proximity:20,helper_left:5,helper_top:10,threshold:5,threshold_touch:50},_trigger:function(t,n){var i=e.vakata.dnd._get();i.event=n,e(document).triggerHandler("dnd_"+t+".vakata",i)},_get:function(){return{data:t.data,element:t.element,helper:t.helper}},_clean:function(){t.helper&&t.helper.remove(),t.scroll_i&&(clearInterval(t.scroll_i),t.scroll_i=!1),t={element:!1,target:!1,is_down:!1,is_drag:!1,helper:!1,helper_w:0,data:!1,init_x:0,init_y:0,scroll_l:0,scroll_t:0,scroll_e:!1,scroll_i:!1,is_touch:!1},e(document).off("mousemove touchmove",e.vakata.dnd.drag),e(document).off("mouseup touchend",e.vakata.dnd.stop)},_scroll:function(n){if(!t.scroll_e||!t.scroll_l&&!t.scroll_t)return t.scroll_i&&(clearInterval(t.scroll_i),t.scroll_i=!1),!1;if(!t.scroll_i)return t.scroll_i=setInterval(e.vakata.dnd._scroll,100),!1;if(!0===n)return!1;var i=t.scroll_e.scrollTop(),r=t.scroll_e.scrollLeft();t.scroll_e.scrollTop(i+t.scroll_t*e.vakata.dnd.settings.scroll_speed),t.scroll_e.scrollLeft(r+t.scroll_l*e.vakata.dnd.settings.scroll_speed),i===t.scroll_e.scrollTop()&&r===t.scroll_e.scrollLeft()||e.vakata.dnd._trigger("scroll",t.scroll_e)},start:function(n,i,r){"touchstart"===n.type&&n.originalEvent&&n.originalEvent.changedTouches&&n.originalEvent.changedTouches[0]&&(n.pageX=n.originalEvent.changedTouches[0].pageX,n.pageY=n.originalEvent.changedTouches[0].pageY,n.target=document.elementFromPoint(n.originalEvent.changedTouches[0].pageX-window.pageXOffset,n.originalEvent.changedTouches[0].pageY-window.pageYOffset)),t.is_drag&&e.vakata.dnd.stop({});try{n.currentTarget.unselectable="on",n.currentTarget.onselectstart=function(){return!1},n.currentTarget.style&&(n.currentTarget.style.MozUserSelect="none")}catch(e){}return t.init_x=n.pageX,t.init_y=n.pageY,t.data=i,t.is_down=!0,t.element=n.currentTarget,t.target=n.target,t.is_touch="touchstart"===n.type,!1!==r&&(t.helper=e("<div id='vakata-dnd'></div>").html(r).css({display:"block",margin:"0",padding:"0",position:"absolute",top:"-2000px",lineHeight:"16px",zIndex:"10000"})),e(document).bind("mousemove touchmove",e.vakata.dnd.drag),e(document).bind("mouseup touchend",e.vakata.dnd.stop),!1},drag:function(n){if("touchmove"===n.type&&n.originalEvent&&n.originalEvent.changedTouches&&n.originalEvent.changedTouches[0]&&(n.pageX=n.originalEvent.changedTouches[0].pageX,n.pageY=n.originalEvent.changedTouches[0].pageY,n.target=document.elementFromPoint(n.originalEvent.changedTouches[0].pageX-window.pageXOffset,n.originalEvent.changedTouches[0].pageY-window.pageYOffset)),t.is_down){if(!t.is_drag){if(!(Math.abs(n.pageX-t.init_x)>(t.is_touch?e.vakata.dnd.settings.threshold_touch:e.vakata.dnd.settings.threshold)||Math.abs(n.pageY-t.init_y)>(t.is_touch?e.vakata.dnd.settings.threshold_touch:e.vakata.dnd.settings.threshold)))return;t.helper&&(t.helper.appendTo("body"),t.helper_w=t.helper.outerWidth()),t.is_drag=!0,e.vakata.dnd._trigger("start",n)}var i=!1,r=!1,a=!1,o=!1,s=!1,l=!1,c=!1,d=!1,u=!1,h=!1;return t.scroll_t=0,t.scroll_l=0,t.scroll_e=!1,e(e(n.target).parentsUntil("body").addBack().get().reverse()).filter(function(){return/^auto|scroll$/.test(e(this).css("overflow"))&&(this.scrollHeight>this.offsetHeight||this.scrollWidth>this.offsetWidth)}).each(function(){var i=e(this),r=i.offset();if(this.scrollHeight>this.offsetHeight&&(r.top+i.height()-n.pageY<e.vakata.dnd.settings.scroll_proximity&&(t.scroll_t=1),n.pageY-r.top<e.vakata.dnd.settings.scroll_proximity&&(t.scroll_t=-1)),this.scrollWidth>this.offsetWidth&&(r.left+i.width()-n.pageX<e.vakata.dnd.settings.scroll_proximity&&(t.scroll_l=1),n.pageX-r.left<e.vakata.dnd.settings.scroll_proximity&&(t.scroll_l=-1)),t.scroll_t||t.scroll_l)return t.scroll_e=e(this),!1}),t.scroll_e||(i=e(document),r=e(window),a=i.height(),o=r.height(),s=i.width(),l=r.width(),c=i.scrollTop(),d=i.scrollLeft(),a>o&&n.pageY-c<e.vakata.dnd.settings.scroll_proximity&&(t.scroll_t=-1),a>o&&o-(n.pageY-c)<e.vakata.dnd.settings.scroll_proximity&&(t.scroll_t=1),s>l&&n.pageX-d<e.vakata.dnd.settings.scroll_proximity&&(t.scroll_l=-1),s>l&&l-(n.pageX-d)<e.vakata.dnd.settings.scroll_proximity&&(t.scroll_l=1),(t.scroll_t||t.scroll_l)&&(t.scroll_e=i)),t.scroll_e&&e.vakata.dnd._scroll(!0),t.helper&&(u=parseInt(n.pageY+e.vakata.dnd.settings.helper_top,10),h=parseInt(n.pageX+e.vakata.dnd.settings.helper_left,10),a&&u+25>a&&(u=a-50),s&&h+t.helper_w>s&&(h=s-(t.helper_w+2)),t.helper.css({left:h+"px",top:u+"px"})),e.vakata.dnd._trigger("move",n),!1}},stop:function(n){if("touchend"===n.type&&n.originalEvent&&n.originalEvent.changedTouches&&n.originalEvent.changedTouches[0]&&(n.pageX=n.originalEvent.changedTouches[0].pageX,n.pageY=n.originalEvent.changedTouches[0].pageY,n.target=document.elementFromPoint(n.originalEvent.changedTouches[0].pageX-window.pageXOffset,n.originalEvent.changedTouches[0].pageY-window.pageYOffset)),t.is_drag)e.vakata.dnd._trigger("stop",n);else if("touchend"===n.type&&n.target===t.target){var i=setTimeout(function(){e(n.target).click()},100);e(n.target).one("click",function(){i&&clearTimeout(i)})}return e.vakata.dnd._clean(),!1}}}(e),e.jstree.defaults.search={ajax:!1,fuzzy:!1,case_sensitive:!1,show_only_matches:!1,close_opened_onclear:!0,search_leaves_only:!1,search_callback:!1},e.jstree.plugins.search=function(t,n){this.bind=function(){n.bind.call(this),this._data.search.str="",this._data.search.dom=e(),this._data.search.res=[],this._data.search.opn=[],this.element.on("before_open.jstree",e.proxy(function(t,n){var i,r,a=this._data.search.res,o=[],s=e();if(a&&a.length&&(this._data.search.dom=e(this.element[0].querySelectorAll("#"+e.map(a,function(t){return-1!=="0123456789".indexOf(t[0])?"\\3"+t[0]+" "+t.substr(1).replace(e.jstree.idregex,"\\$&"):t.replace(e.jstree.idregex,"\\$&")}).join(", #"))),this._data.search.dom.children(".jstree-anchor").addClass("jstree-search"),this.settings.search.show_only_matches&&this._data.search.res.length)){for(i=0,r=a.length;i<r;i++)o=o.concat(this.get_node(a[i]).parents);o=e.vakata.array_remove_item(e.vakata.array_unique(o),"#"),s=o.length?e(this.element[0].querySelectorAll("#"+e.map(o,function(t){return-1!=="0123456789".indexOf(t[0])?"\\3"+t[0]+" "+t.substr(1).replace(e.jstree.idregex,"\\$&"):t.replace(e.jstree.idregex,"\\$&")}).join(", #"))):e(),this.element.find(".jstree-node").hide().filter(".jstree-last").filter(function(){return this.nextSibling}).removeClass("jstree-last"),s=s.add(this._data.search.dom),s.parentsUntil(".jstree").addBack().show().filter(".jstree-children").each(function(){e(this).children(".jstree-node:visible").eq(-1).addClass("jstree-last")})}},this)),this.settings.search.show_only_matches&&this.element.on("search.jstree",function(t,n){n.nodes.length&&(e(this).find(".jstree-node").hide().filter(".jstree-last").filter(function(){return this.nextSibling}).removeClass("jstree-last"),n.nodes.parentsUntil(".jstree").addBack().show().filter(".jstree-children").each(function(){e(this).children(".jstree-node:visible").eq(-1).addClass("jstree-last")}))}).on("clear_search.jstree",function(t,n){n.nodes.length&&e(this).find(".jstree-node").css("display","").filter(".jstree-last").filter(function(){return this.nextSibling}).removeClass("jstree-last")})},this.search=function(t,n){if(!1===t||""===e.trim(t.toString()))return this.clear_search();t=t.toString();var i=this.settings.search,r=!!i.ajax&&i.ajax,a=null,o=[],s=[];if(this._data.search.res.length&&this.clear_search(),!n&&!1!==r)return e.isFunction(r)?r.call(this,t,e.proxy(function(n){n&&n.d&&(n=n.d),this._load_nodes(e.isArray(n)?e.vakata.array_unique(n):[],function(){this.search(t,!0)},!0)},this)):(r=e.extend({},r),r.data||(r.data={}),r.data.str=t,e.ajax(r).fail(e.proxy(function(){this._data.core.last_error={error:"ajax",plugin:"search",id:"search_01",reason:"Could not load search parents",data:JSON.stringify(r)},this.settings.core.error.call(this,this._data.core.last_error)},this)).done(e.proxy(function(n){n&&n.d&&(n=n.d),this._load_nodes(e.isArray(n)?e.vakata.array_unique(n):[],function(){this.search(t,!0)},!0)},this)));this._data.search.str=t,this._data.search.dom=e(),this._data.search.res=[],this._data.search.opn=[],a=new e.vakata.search(t,!0,{caseSensitive:i.case_sensitive,fuzzy:i.fuzzy}),e.each(this._model.data,function(e,n){n.text&&(i.search_callback&&i.search_callback.call(this,t,n)||!i.search_callback&&a.search(n.text).isMatch)&&(!i.search_leaves_only||n.state.loaded&&0===n.children.length)&&(o.push(e),s=s.concat(n.parents))}),o.length&&(s=e.vakata.array_unique(s),this._search_open(s),this._data.search.dom=e(this.element[0].querySelectorAll("#"+e.map(o,function(t){return-1!=="0123456789".indexOf(t[0])?"\\3"+t[0]+" "+t.substr(1).replace(e.jstree.idregex,"\\$&"):t.replace(e.jstree.idregex,"\\$&")}).join(", #"))),this._data.search.res=o,this._data.search.dom.children(".jstree-anchor").addClass("jstree-search")),this.trigger("search",{nodes:this._data.search.dom,str:t,res:this._data.search.res})},this.clear_search=function(){this._data.search.dom.children(".jstree-anchor").removeClass("jstree-search"),this.settings.search.close_opened_onclear&&this.close_node(this._data.search.opn,0),this.trigger("clear_search",{nodes:this._data.search.dom,str:this._data.search.str,res:this._data.search.res}),this._data.search.str="",this._data.search.res=[],this._data.search.opn=[],this._data.search.dom=e()},this._search_open=function(t){var n=this;e.each(t.concat([]),function(i,r){if("#"===r)return!0;try{r=e("#"+r.replace(e.jstree.idregex,"\\$&"),n.element)}catch(e){}r&&r.length&&n.is_closed(r)&&(n._data.search.opn.push(r[0].id),n.open_node(r,function(){n._search_open(t)},0))})}},function(e){e.vakata.search=function(e,t,n){n=n||{},!1!==n.fuzzy&&(n.fuzzy=!0),e=n.caseSensitive?e:e.toLowerCase();var i,r,a,o,s=n.location||0,l=n.distance||100,c=n.threshold||.6,d=e.length;return d>32&&(n.fuzzy=!1),n.fuzzy&&(i=1<<d-1,r=function(){var t={},n=0;for(n=0;n<d;n++)t[e.charAt(n)]=0;for(n=0;n<d;n++)t[e.charAt(n)]|=1<<d-n-1;return t}(),a=function(e,t){var n=e/d,i=Math.abs(s-t);return l?n+i/l:i?1:n}),o=function(t){if(t=n.caseSensitive?t:t.toLowerCase(),e===t||-1!==t.indexOf(e))return{isMatch:!0,score:0};if(!n.fuzzy)return{isMatch:!1,score:1};var o,l,u,h,f,p,g,m,_,v=t.length,y=c,b=t.indexOf(e,s),w=d+v,x=1,k=[];for(-1!==b&&(y=Math.min(a(0,b),y),-1!==(b=t.lastIndexOf(e,s+d))&&(y=Math.min(a(0,b),y))),b=-1,o=0;o<d;o++){for(u=0,h=w;u<h;)a(o,s+h)<=y?u=h:w=h,h=Math.floor((w-u)/2+u);for(w=h,p=Math.max(1,s-h+1),g=Math.min(s+h,v)+d,m=new Array(g+2),m[g+1]=(1<<o)-1,l=g;l>=p;l--)if(_=r[t.charAt(l-1)],m[l]=0===o?(m[l+1]<<1|1)&_:(m[l+1]<<1|1)&_|(f[l+1]|f[l])<<1|1|f[l+1],m[l]&i&&(x=a(o,l-1))<=y){if(y=x,b=l-1,k.push(b),!(b>s))break;p=Math.max(1,2*s-b)}if(a(o+1,s)>y)break;f=m}return{isMatch:b>=0,score:x}},!0===t?{search:o}:o(t)}}(e),e.jstree.defaults.sort=function(e,t){return this.get_text(e)>this.get_text(t)?1:-1},e.jstree.plugins.sort=function(t,n){this.bind=function(){n.bind.call(this),this.element.on("model.jstree",e.proxy(function(e,t){this.sort(t.parent,!0)},this)).on("rename_node.jstree create_node.jstree",e.proxy(function(e,t){this.sort(t.parent||t.node.parent,!1),this.redraw_node(t.parent||t.node.parent,!0)},this)).on("move_node.jstree copy_node.jstree",e.proxy(function(e,t){this.sort(t.parent,!1),this.redraw_node(t.parent,!0)},this))},this.sort=function(t,n){var i,r;if((t=this.get_node(t))&&t.children&&t.children.length&&(t.children.sort(e.proxy(this.settings.sort,this)),n))for(i=0,r=t.children_d.length;i<r;i++)this.sort(t.children_d[i],!1)}};var f=!1;e.jstree.defaults.state={key:"jstree",events:"changed.jstree open_node.jstree close_node.jstree",ttl:!1,filter:!1},e.jstree.plugins.state=function(t,n){this.bind=function(){n.bind.call(this);var t=e.proxy(function(){this.element.on(this.settings.state.events,e.proxy(function(){f&&clearTimeout(f),f=setTimeout(e.proxy(function(){this.save_state()},this),100)},this))},this);this.element.on("ready.jstree",e.proxy(function(e,n){this.element.one("restore_state.jstree",t),this.restore_state()||t()},this))},this.save_state=function(){var t={state:this.get_state(),ttl:this.settings.state.ttl,sec:+new Date};e.vakata.storage.set(this.settings.state.key,JSON.stringify(t))},this.restore_state=function(){var t=e.vakata.storage.get(this.settings.state.key);if(t)try{t=JSON.parse(t)}catch(e){return!1}return!(t&&t.ttl&&t.sec&&+new Date-t.sec>t.ttl)&&(t&&t.state&&(t=t.state),t&&e.isFunction(this.settings.state.filter)&&(t=this.settings.state.filter.call(this,t)),!!t&&(this.element.one("set_state.jstree",function(n,i){i.instance.trigger("restore_state",{state:e.extend(!0,{},t)})}),this.set_state(t),!0))},this.clear_state=function(){return e.vakata.storage.del(this.settings.state.key)}},function(e,t){e.vakata.storage={set:function(e,t){return window.localStorage.setItem(e,t)},get:function(e){return window.localStorage.getItem(e)},del:function(e){return window.localStorage.removeItem(e)}}}(e),e.jstree.defaults.types={"#":{},default:{}},e.jstree.plugins.types=function(n,i){this.init=function(e,n){var r,a;if(n&&n.types&&n.types.default)for(r in n.types)if("default"!==r&&"#"!==r&&n.types.hasOwnProperty(r))for(a in n.types.default)n.types.default.hasOwnProperty(a)&&n.types[r][a]===t&&(n.types[r][a]=n.types.default[a]);i.init.call(this,e,n),this._model.data["#"].type="#"},this.refresh=function(e,t){i.refresh.call(this,e,t),this._model.data["#"].type="#"},this.bind=function(){this.element.on("model.jstree",e.proxy(function(e,n){var i,r,a=this._model.data,o=n.nodes,s=this.settings.types,l="default";for(i=0,r=o.length;i<r;i++)l="default",a[o[i]].original&&a[o[i]].original.type&&s[a[o[i]].original.type]&&(l=a[o[i]].original.type),a[o[i]].data&&a[o[i]].data.jstree&&a[o[i]].data.jstree.type&&s[a[o[i]].data.jstree.type]&&(l=a[o[i]].data.jstree.type),a[o[i]].type=l,!0===a[o[i]].icon&&s[l].icon!==t&&(a[o[i]].icon=s[l].icon);a["#"].type="#"},this)),i.bind.call(this)},this.get_json=function(t,n,r){var a,o,s=this._model.data,l=n?e.extend(!0,{},n,{no_id:!1}):{},c=i.get_json.call(this,t,l,r);if(!1===c)return!1;if(e.isArray(c))for(a=0,o=c.length;a<o;a++)c[a].type=c[a].id&&s[c[a].id]&&s[c[a].id].type?s[c[a].id].type:"default",n&&n.no_id&&(delete c[a].id,c[a].li_attr&&c[a].li_attr.id&&delete c[a].li_attr.id);else c.type=c.id&&s[c.id]&&s[c.id].type?s[c.id].type:"default",n&&n.no_id&&(c=this._delete_ids(c));return c},this._delete_ids=function(t){if(e.isArray(t)){for(var n=0,i=t.length;n<i;n++)t[n]=this._delete_ids(t[n]);return t}return delete t.id,t.li_attr&&t.li_attr.id&&delete t.li_attr.id,t.children&&e.isArray(t.children)&&(t.children=this._delete_ids(t.children)),t},this.check=function(n,r,a,o,s){if(!1===i.check.call(this,n,r,a,o,s))return!1;r=r&&r.id?r:this.get_node(r),a=a&&a.id?a:this.get_node(a);var l,c,d,u,h=r&&r.id?e.jstree.reference(r.id):null;switch(h=h&&h._model&&h._model.data?h._model.data:null,n){case"create_node":case"move_node":case"copy_node":if("move_node"!==n||-1===e.inArray(r.id,a.children)){if(l=this.get_rules(a),l.max_children!==t&&-1!==l.max_children&&l.max_children===a.children.length)return this._data.core.last_error={error:"check",plugin:"types",id:"types_01",reason:"max_children prevents function: "+n,data:JSON.stringify({chk:n,pos:o,obj:!(!r||!r.id)&&r.id,par:!(!a||!a.id)&&a.id})},!1;if(l.valid_children!==t&&-1!==l.valid_children&&-1===e.inArray(r.type,l.valid_children))return this._data.core.last_error={error:"check",plugin:"types",id:"types_02",reason:"valid_children prevents function: "+n,data:JSON.stringify({chk:n,pos:o,obj:!(!r||!r.id)&&r.id,par:!(!a||!a.id)&&a.id})},!1;if(h&&r.children_d&&r.parents){for(c=0,d=0,u=r.children_d.length;d<u;d++)c=Math.max(c,h[r.children_d[d]].parents.length);c=c-r.parents.length+1}(c<=0||c===t)&&(c=1);do{if(l.max_depth!==t&&-1!==l.max_depth&&l.max_depth<c)return this._data.core.last_error={error:"check",plugin:"types",id:"types_03",reason:"max_depth prevents function: "+n,data:JSON.stringify({chk:n,pos:o,obj:!(!r||!r.id)&&r.id,par:!(!a||!a.id)&&a.id})},!1;a=this.get_node(a.parent),l=this.get_rules(a),c++}while(a)}}return!0},this.get_rules=function(e){if(!(e=this.get_node(e)))return!1;var n=this.get_type(e,!0);return n.max_depth===t&&(n.max_depth=-1),n.max_children===t&&(n.max_children=-1),n.valid_children===t&&(n.valid_children=-1),n},this.get_type=function(t,n){return!!(t=this.get_node(t))&&(n?e.extend({type:t.type},this.settings.types[t.type]):t.type)},this.set_type=function(n,i){var r,a,o,s,l;if(e.isArray(n)){for(n=n.slice(),a=0,o=n.length;a<o;a++)this.set_type(n[a],i);return!0}return r=this.settings.types,n=this.get_node(n),!(!r[i]||!n)&&(s=n.type,l=this.get_icon(n),n.type=i,(!0===l||r[s]&&r[s].icon&&l===r[s].icon)&&this.set_icon(n,r[i].icon===t||r[i].icon),!0)}},e.jstree.defaults.unique={case_sensitive:!1,duplicate:function(e,t){return e+" ("+t+")"}},e.jstree.plugins.unique=function(n,i){this.check=function(t,n,r,a,o){if(!1===i.check.call(this,t,n,r,a,o))return!1;if(n=n&&n.id?n:this.get_node(n),!(r=r&&r.id?r:this.get_node(r))||!r.children)return!0;var s,l,c="rename_node"===t?a:n.text,d=[],u=this.settings.unique.case_sensitive,h=this._model.data;for(s=0,l=r.children.length;s<l;s++)d.push(u?h[r.children[s]].text:h[r.children[s]].text.toLowerCase());switch(u||(c=c.toLowerCase()),t){case"delete_node":return!0;case"rename_node":return s=-1===e.inArray(c,d)||n.text&&n.text[u?"toString":"toLowerCase"]()===c,s||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_01",reason:"Child with name "+c+" already exists. Preventing: "+t,data:JSON.stringify({chk:t,pos:a,obj:!(!n||!n.id)&&n.id,par:!(!r||!r.id)&&r.id})}),s;case"create_node":return s=-1===e.inArray(c,d),s||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_04",reason:"Child with name "+c+" already exists. Preventing: "+t,data:JSON.stringify({chk:t,pos:a,obj:!(!n||!n.id)&&n.id,par:!(!r||!r.id)&&r.id})}),s;case"copy_node":return s=-1===e.inArray(c,d),s||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_02",reason:"Child with name "+c+" already exists. Preventing: "+t,data:JSON.stringify({chk:t,pos:a,obj:!(!n||!n.id)&&n.id,par:!(!r||!r.id)&&r.id})}),s;case"move_node":return s=n.parent===r.id||-1===e.inArray(c,d),s||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_03",reason:"Child with name "+c+" already exists. Preventing: "+t,data:JSON.stringify({chk:t,pos:a,obj:!(!n||!n.id)&&n.id,par:!(!r||!r.id)&&r.id})}),s}return!0},this.create_node=function(n,r,a,o,s){if(!r||r.text===t){if(null===n&&(n="#"),!(n=this.get_node(n)))return i.create_node.call(this,n,r,a,o,s);if(a=a===t?"last":a,!a.toString().match(/^(before|after)$/)&&!s&&!this.is_loaded(n))return i.create_node.call(this,n,r,a,o,s);r||(r={});var l,c,d,u,h,f=this._model.data,p=this.settings.unique.case_sensitive,g=this.settings.unique.duplicate;for(c=l=this.get_string("New node"),d=[],u=0,h=n.children.length;u<h;u++)d.push(p?f[n.children[u]].text:f[n.children[u]].text.toLowerCase());for(u=1;-1!==e.inArray(p?c:c.toLowerCase(),d);)c=g.call(this,l,++u).toString();r.text=c}return i.create_node.call(this,n,r,a,o,s)}};var p=document.createElement("DIV");p.setAttribute("unselectable","on"),p.className="jstree-wholerow",p.innerHTML="&#160;",e.jstree.plugins.wholerow=function(t,n){this.bind=function(){n.bind.call(this),this.element.on("ready.jstree set_state.jstree",e.proxy(function(){this.hide_dots()},this)).on("init.jstree loading.jstree ready.jstree",e.proxy(function(){this.get_container_ul().addClass("jstree-wholerow-ul")},this)).on("deselect_all.jstree",e.proxy(function(e,t){this.element.find(".jstree-wholerow-clicked").removeClass("jstree-wholerow-clicked")},this)).on("changed.jstree",e.proxy(function(e,t){this.element.find(".jstree-wholerow-clicked").removeClass("jstree-wholerow-clicked");var n,i,r=!1;for(n=0,i=t.selected.length;n<i;n++)(r=this.get_node(t.selected[n],!0))&&r.length&&r.children(".jstree-wholerow").addClass("jstree-wholerow-clicked")},this)).on("open_node.jstree",e.proxy(function(e,t){this.get_node(t.node,!0).find(".jstree-clicked").parent().children(".jstree-wholerow").addClass("jstree-wholerow-clicked")},this)).on("hover_node.jstree dehover_node.jstree",e.proxy(function(e,t){this.get_node(t.node,!0).children(".jstree-wholerow")["hover_node"===e.type?"addClass":"removeClass"]("jstree-wholerow-hovered")},this)).on("contextmenu.jstree",".jstree-wholerow",e.proxy(function(t){t.preventDefault();var n=e.Event("contextmenu",{metaKey:t.metaKey,ctrlKey:t.ctrlKey,altKey:t.altKey,shiftKey:t.shiftKey,pageX:t.pageX,pageY:t.pageY});e(t.currentTarget).closest(".jstree-node").children(".jstree-anchor:eq(0)").trigger(n)},this)).on("click.jstree",".jstree-wholerow",function(t){t.stopImmediatePropagation();var n=e.Event("click",{metaKey:t.metaKey,ctrlKey:t.ctrlKey,altKey:t.altKey,shiftKey:t.shiftKey});e(t.currentTarget).closest(".jstree-node").children(".jstree-anchor:eq(0)").trigger(n).focus()}).on("click.jstree",".jstree-leaf > .jstree-ocl",e.proxy(function(t){t.stopImmediatePropagation();var n=e.Event("click",{metaKey:t.metaKey,ctrlKey:t.ctrlKey,altKey:t.altKey,shiftKey:t.shiftKey});e(t.currentTarget).closest(".jstree-node").children(".jstree-anchor:eq(0)").trigger(n).focus()},this)).on("mouseover.jstree",".jstree-wholerow, .jstree-icon",e.proxy(function(e){return e.stopImmediatePropagation(),this.hover_node(e.currentTarget),!1},this)).on("mouseleave.jstree",".jstree-node",e.proxy(function(e){this.dehover_node(e.currentTarget)},this))},this.teardown=function(){this.settings.wholerow&&this.element.find(".jstree-wholerow").remove(),n.teardown.call(this)},this.redraw_node=function(t,i,r){if(t=n.redraw_node.call(this,t,i,r)){var a=p.cloneNode(!0);-1!==e.inArray(t.id,this._data.core.selected)&&(a.className+=" jstree-wholerow-clicked"),t.insertBefore(a,t.childNodes[0])}return t}}}})},function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0});var n=e.Model.extend({urlRoot:Galaxy.root+"api/groups"}),i=e.Collection.extend({url:Galaxy.root+"api/groups",model:n});t.default={Group:n,Groups:i}}).call(t,n(2))},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";(function(e){function i(e){return e&&e.__esModule?e:{default:e}}function r(t){Galaxy.user||(Galaxy.user=new I.default.User(t.user_json)),Galaxy.masthead||(Galaxy.masthead=new N.default.View(t),Galaxy.modal=new O.default.View,e("#masthead").replaceWith(Galaxy.masthead.render().$el))}function a(e){new j.default.GalaxyApp(e)}function o(e){new y.default.GalaxyApp(e)}function s(e){new w.default.GalaxyApp(e)}function l(e){new _.default(e)}function c(e){new T.default.GalaxyApp(e)}function d(t){e("#toggle-deleted").modeButton({initialMode:t.initialModeDeleted,modes:[{mode:"showing_deleted",html:(0,f.default)("Exclude deleted")},{mode:"not_showing_deleted",html:(0,f.default)("Include deleted")}]}),e("#toggle-hidden").modeButton({initialMode:t.initialModeHidden,modes:[{mode:"showing_hidden",html:(0,f.default)("Exclude hidden")},{mode:"not_showing_hidden",html:(0,f.default)("Include hidden")}]}),e("#switch").click(function(){var e=Galaxy.currHistoryPanel||window.top.Galaxy&&window.top.Galaxy.currHistoryPanel?window.top.Galaxy.currHistoryPanel:null;e?e.switchToHistory("${ history[ 'id' ] }"):window.location="${ switch_to_url }"}),t.hasMasthead&&e("#center").addClass("flex-vertical-container");var n=t.userIsOwner?X.default.HistoryViewEdit:J.default.HistoryView,i=new H.default.History(t.historyJSON);e("#import").click(function(){(0,te.default)(i,{useImport:!0,allDatasets:"showing_deleted"===e("#toggle-deleted").modeButton("getMode").mode}).done(function(){window===window.parent?window.location=Galaxy.root:Galaxy.currHistoryPanel&&Galaxy.currHistoryPanel.loadCurrentHistory()})});var r=new n({el:e("#history-"+t.historyJSON.id),className:n.prototype.className+" wide",$scrollContainer:t.hasMasthead?function(){return this.$el.parent()}:void 0,model:i,show_deleted:t.showDeletedJson,show_hidden:t.showHiddenJson,purgeAllowed:t.allow_user_dataset_purge});r.trigger("loading"),i.fetchContents({silent:!0}).fail(function(){alert("Galaxy history failed to load")}).done(function(){r.trigger("loading-done"),r.render()}),e("#toggle-deleted").on("click",function(){r.toggleShowDeleted()}),e("#toggle-hidden").on("click",function(){r.toggleShowHidden()})}function u(t){var n=new H.default.HistoryCollection([],{includeDeleted:t.includingDeleted,order:t.order,limitOnFirstFetch:t.limit,limitPerFetch:t.limit,currentHistoryId:t.current_history_id}),i=new q.default.MultiPanelColumns({el:e("#center").get(0),histories:n});n.fetchFirst({silent:!0}).done(function(){i.createColumns(),i.render(0)})}Object.defineProperty(t,"__esModule",{value:!0}),t.bundleEntries=void 0,t.mastheadEntry=r,t.adminToolshedEntry=a,t.tracksterEntry=o,t.circsterEntry=s,t.workflowEntry=l,t.libraryEntry=c,t.historyEntry=d,t.multiHistoryEntry=u;var h=n(3),f=i(h),p=n(65),g=i(p),m=n(302),_=i(m),v=n(114),y=i(v),b=n(311),w=i(b),x=n(313),k=i(x),M=n(314),C=i(M),S=n(315),T=i(S),E=n(325),j=i(E),A=n(68),N=i(A),L=n(67),I=i(L),D=n(9),O=i(D),P=n(333),W=i(P),R=n(24),$=i(R),z=n(31),H=i(z),V=n(335),Y=i(V),F=n(16),G=i(F),U=n(341),q=i(U),B=n(58),J=i(B),Q=n(72),X=i(Q),K=n(343),Z=i(K),ee=n(55),te=i(ee),ne=n(73),ie=i(ne),re=n(38),ae=i(re),oe=n(66),se=i(oe),le=n(344),ce=i(le),de=n(347),ue=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(de),he=n(348),fe=i(he);window.Galaxy&&void 0===window.Galaxy.debug&&(0,se.default)(window.Galaxy,"GalaxyApp");var pe=t.bundleEntries={library:c,masthead:r,workflow:l,trackster:o,circster:s,adminToolshed:a,pages:W.default,phyloviz:k.default.PhylovizView,createTabularDatasetChunkedView:$.default.createTabularDatasetChunkedView,multiHistory:u,history:d,History:H.default.History,HistoryContents:G.default.HistoryContents,SweepsterVisualization:C.default.SweepsterVisualization,SweepsterVisualizationView:C.default.SweepsterVisualizationView,HistoryCopyDialog:te.default,HistoryViewAnnotated:Z.default,Trackster:y.default,StructureView:Y.default,HDAListItemEdit:ie.default,HDAModel:ae.default,GalaxyApp:g.default,LegacyGridView:ce.default,run_stats:ue,ToolshedGroups:fe.default};window.bundleEntries=pe}).call(t,n(0))},function(e,t,n){"use strict";(function(e,i,r){function a(e){return e&&e.__esModule?e:{default:e}}function o(t){var n=e("#galaxy_tools").contents();if(0===n.length&&(n=e(document),e(this).removeClass("search_active"),n.find(".toolTitle").removeClass("search_match"),n.find(".toolSectionBody").hide(),n.find(".toolTitle").show(),n.find(".toolPanelLabel").show(),n.find(".toolSectionWrapper").each(function(){"recently_used_wrapper"!==e(this).attr("id")?e(this).show():e(this).hasClass("user_pref_visible")&&e(this).show()}),n.find("#search-no-results").hide(),n.find("#search-spinner").hide(),t)){n.find("#tool-search-query").val("search tools")}}function s(t,n){var i=y.default[n];if(i){var r=e('<i class="icon fa">&nbsp;</i>').addClass(i);t.before(r)}}Object.defineProperty(t,"__esModule",{value:!0});var l=n(3),c=a(l),d=n(5),u=a(d),h=n(303),f=a(h),p=n(304),g=a(p),m=n(305),_=a(m),v=n(95),y=a(v),b=n(310),w=a(b),x=n(6),k=a(x),M=n(112),C=a(M),S=n(7);!function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);t.default=e}(S);n(15),window.workflow_globals=window.workflow_globals||{},t.default=i.View.extend({initialize:function(t){function n(){var t=e('<form><label style="display:inline-block; width: 100%;">Save as name: </label><input type="text" id="workflow_rename" style="width: 80%;" autofocus/><br><label style="display:inline-block; width: 100%;">Annotation: </label><input type="text" id="wf_annotation" style="width: 80%;" /></form>');window.show_modal("Save As a New Workflow",t,{OK:function(){var t=e("#workflow_rename").val().length>0?e("#workflow_rename").val():"SavedAs_"+l.workflow.name,n=e("#wf_annotation").val().length>0?e("#wf_annotation").val():"";e.ajax({url:l.urls.workflow_save_as,type:"POST",data:{workflow_name:t,workflow_annotation:n,workflow_data:function(){return JSON.stringify(l.workflow.to_simple())}}}).done(function(e){window.onbeforeunload=void 0,window.location=Galaxy.root+"workflow/editor?id="+e,hide_modal()}).fail(function(){hide_modal(),alert("Saving this workflow failed. Please contact this site's administrator.")})},Cancel:hide_modal})}function i(){l.workflow.layout(),l.workflow.fit_canvas_to_nodes(),l.scroll_to_nodes(),l.canvas_manager.draw_overview()}function a(){e.jStorage.set("overview-off",!1),e("#overview-border").css("right","0px"),e("#close-viewport").css("background-position","0px 0px")}function s(){e.jStorage.set("overview-off",!0),e("#overview-border").css("right","20000px"),e("#close-viewport").css("background-position","12px 0px")}var l=window.workflow_globals.app=this;this.options=t,this.urls=t&&t.urls||{};var c=function(){if(l.workflow.check_changes_in_active_form(),workflow&&l.workflow.has_changes){var e=function(){window.onbeforeunload=void 0,window.document.location=l.urls.workflow_index};window.show_modal("Close workflow editor","There are unsaved changes to your workflow which will be lost.",{Cancel:hide_modal,"Save Changes":function(){d(null,e)}},{"Don't Save":e})}else window.document.location=l.urls.workflow_index},d=function(t,n){if(show_message("Saving workflow","progress"),l.workflow.check_changes_in_active_form(),!l.workflow.has_changes)return hide_modal(),void(n&&n());l.workflow.rectify_workflow_outputs(),u.default.request({url:Galaxy.root+"api/workflows/"+l.options.id,type:"PUT",data:{workflow:l.workflow.to_simple()},success:function(t){var i=e("<div/>").text(t.message);if(t.errors){i.addClass("warningmark");var r=e("<ul/>");e.each(t.errors,function(t,n){e("<li/>").text(n).appendTo(r)}),i.append(r)}else i.addClass("donemark");l.workflow.name=t.name,l.workflow.has_changes=!1,l.workflow.stored=!0,l.showWorkflowParameters(),t.errors?window.show_modal("Saving workflow",i,{Ok:hide_modal}):(n&&n(),hide_modal())},error:function(e){window.show_modal("Saving workflow failed.",e.err_msg,{Ok:hide_modal})}})};e("#tool-search-query").click(function(){e(this).focus(),e(this).select()}).keyup(function(){if(e(this).css("font-style","normal"),this.value.length<3)o(!1);else if(this.value!=this.lastValue){e(this).addClass("search_active");var t=this.value;this.timer&&clearTimeout(this.timer),e("#search-spinner").show(),this.timer=setTimeout(function(){e.get(l.urls.tool_search,{q:t},function(t){if(e("#search-no-results").hide(),e(".toolSectionWrapper").hide(),e(".toolSectionWrapper").find(".toolTitle").hide(),0!=t.length){var n=e.map(t,function(e,t){return"link-"+e});e(n).each(function(t,n){e("[id='"+n+"']").parent().addClass("search_match"),e("[id='"+n+"']").parent().show().parent().parent().show().parent().show()}),e(".toolPanelLabel").each(function(){for(var t=e(this),n=t.next(),i=!0;0!==n.length&&n.hasClass("toolTitle");){if(n.is(":visible")){i=!1;break}n=n.next()}i&&t.hide()})}else e("#search-no-results").show();e("#search-spinner").hide()},"json")},400)}this.lastValue=this.value}),this.canvas_manager=window.workflow_globals.canvas_manager=new g.default(this,e("#canvas-viewport"),e("#overview")),this.reset(),this.datatypes=JSON.parse(e.ajax({url:Galaxy.root+"api/datatypes",async:!1}).responseText),this.datatypes_mapping=JSON.parse(e.ajax({url:Galaxy.root+"api/datatypes/mapping",async:!1}).responseText),this.ext_to_type=this.datatypes_mapping.ext_to_class_name,this.type_to_type=this.datatypes_mapping.class_to_classes,this._workflowLoadAjax(l.options.id,{success:function(e){l.reset(),l.workflow.from_simple(e,!0),l.workflow.has_changes=!1,l.workflow.fit_canvas_to_nodes(),l.scroll_to_nodes(),l.canvas_manager.draw_overview();var t="";r.each(e.steps,function(n,i){var a="";n.errors&&(a+="<li>"+n.errors+"</li>"),r.each(e.upgrade_messages[i],function(e){a+="<li>"+e+"</li>"}),a&&(t+="<li>Step "+(parseInt(i,10)+1)+": "+l.workflow.nodes[i].name+"<ul>"+a+"</ul></li>")}),t?window.show_modal("Issues loading this workflow","Please review the following issues, possibly resulting from tool upgrades or changes.<p><ul>"+t+"</ul></p>",{Continue:hide_modal}):hide_modal(),l.showWorkflowParameters()},beforeSubmit:function(e){show_message("Loading workflow","progress")}}),window.make_popupmenu&&make_popupmenu(e("#workflow-options-button"),{Save:d,"Save As":n,Run:function(){window.location=Galaxy.root+"workflows/run?id="+l.options.id},"Edit Attributes":function(){l.workflow.clear_active_node()},"Auto Re-layout":i,Close:c});var h=e.jStorage.get("overview-size");void 0!==h&&e("#overview-border").css({width:h,height:h}),e.jStorage.get("overview-off")?s():a(),e("#overview-border").bind("dragend",function(t,n){var i=e(this).offsetParent(),r=i.offset(),a=Math.max(i.width()-(n.offsetX-r.left),i.height()-(n.offsetY-r.top));e.jStorage.set("overview-size",a+"px")}),e("#close-viewport").click(function(){"0px"===e("#overview-border").css("right")?s():a()}),window.onbeforeunload=function(){if(workflow&&l.workflow.has_changes)return"There are unsaved changes to your workflow which will be lost."},this.options.workflows.length>0&&e("#left").find(".toolMenu").append(this._buildToolPanelWorkflows()),e("div.toolSectionBody").hide(),e("div.toolSectionTitle > span").wrap("<a href='#'></a>");var f=null;e("div.toolSectionTitle").each(function(){var t=e(this).next("div.toolSectionBody");e(this).click(function(){t.is(":hidden")?(f&&f.slideUp("fast"),f=t,t.slideDown("fast")):(t.slideUp("fast"),f=null)})}),(0,C.default)("workflow-name","workflow-name",l.urls.rename_async,"new_name"),e("#workflow-tag").click(function(){return e(".tag-area").click(),!1}),(0,C.default)("workflow-annotation","workflow-annotation",l.urls.annotate_async,"new_annotation",25,!0,4)},_buildToolPanelWorkflows:function(){var t=this,n=e('<div class="toolSectionWrapper"><div class="toolSectionTitle"><a href="#"><span>Workflows</span></a></div><div class="toolSectionBody"><div class="toolSectionBg"/></div></div>');return r.each(this.options.workflows,function(i){if(i.id!==t.options.id){var r=new k.default.ButtonIcon({icon:"fa fa-copy",cls:"ui-button-icon-plain",tooltip:(0,c.default)("Copy and insert individual steps"),onclick:function(){i.step_count<2?t.copy_into_workflow(i.id,i.name):Galaxy.modal.show({title:(0,c.default)("Warning"),body:"This will copy "+i.step_count+" new steps into your workflow.",buttons:{Cancel:function(){Galaxy.modal.hide()},Copy:function(){Galaxy.modal.hide(),t.copy_into_workflow(i.id,i.name)}}})}}),a=e("<a/>").attr("href","#").html(i.name).on("click",function(){t.add_node_for_subworkflow(i.latest_id,i.name)});n.find(".toolSectionBg").append(e("<div/>").addClass("toolTitle").append(a).append(r.$el))}}),n},copy_into_workflow:function(t){var n=this;this._workflowLoadAjax(t,{success:function(t){n.workflow.from_simple(t,!1);var i="";e.each(t.upgrade_messages,function(t,r){i+="<li>Step "+(parseInt(t,10)+1)+": "+n.workflow.nodes[t].name+"<ul>",e.each(r,function(e,t){i+="<li>"+t+"</li>"}),i+="</ul></li>"}),i?window.show_modal("Subworkflow embedded with changes","Problems were encountered loading this workflow (possibly a result of tool upgrades). Please review the following parameters and then save.<ul>"+i+"</ul>",{Continue:hide_modal}):hide_modal()},beforeSubmit:function(e){show_message("Importing workflow","progress")}})},reset:function(){this.workflow&&this.workflow.remove_all(),this.workflow=window.workflow_globals.workflow=new f.default(this,e("#canvas-container"))},scroll_to_nodes:function(){var t,n,i=e("#canvas-viewport"),r=e("#canvas-container");n=r.width()<i.width()?(i.width()-r.width())/2:0,t=r.height()<i.height()?(i.height()-r.height())/2:0,r.css({left:n,top:t})},_workflowLoadAjax:function(t,n){e.ajax(u.default.merge(n,{url:this.urls.load_workflow,data:{id:t,_:"true"},dataType:"json",cache:!1}))},_moduleInitAjax:function(e,t){var n=this;u.default.request({type:"POST",url:Galaxy.root+"api/workflows/build_module",data:t,success:function(t){e.init_field_data(t),e.update_field_data(t),n.workflow.activate_node(e)}})},add_node_for_tool:function(e,t){var n=this.workflow.create_node("tool",t,e);this._moduleInitAjax(n,{type:"tool",tool_id:e,_:"true"})},add_node_for_subworkflow:function(e,t){var n=this.workflow.create_node("subworkflow",t,e);this._moduleInitAjax(n,{type:"subworkflow",content_id:e,_:"true"})},add_node_for_module:function(e,t){var n=this.workflow.create_node(e,t);this._moduleInitAjax(n,{type:e,_:"true"})},display_file_list:function(e){var t="<select id='node_data_list' name='node_data_list'>";for(var n in e.output_terminals)t+="<option value='"+n+"'>"+n+"</option>";return t+="</select>"},showWorkflowParameters:function(){var t=/\$\{.+?\}/g,n=[],i=e("#workflow-parameters-container"),r=e("#workflow-parameters-box"),a="",o=[];e.each(this.workflow.nodes,function(i,r){r.config_form&&r.config_form.inputs&&u.default.deepeach(r.config_form.inputs,function(e){if("string"==typeof e.value){var n=e.value.match(t);n&&(o=o.concat(n))}}),r.post_job_actions&&e.each(r.post_job_actions,function(n,i){i.action_arguments&&e.each(i.action_arguments,function(e,n){var i=n.match(t);i&&(o=o.concat(i))})}),o&&e.each(o,function(t,i){-1===e.inArray(i,n)&&n.push(i)})}),n&&0!==n.length?(e.each(n,function(e,t){a+="<div>"+t.substring(2,t.length-1)+"</div>"}),i.html(a),r.show()):(i.html(a),r.hide())},showAttributes:function(){e(".right-content").hide(),e("#edit-attributes").show()},showForm:function(t,n){var i="right-content",r=i+"-"+n.id,a=e("#"+i);if(t&&0==a.find("#"+r).length){var o=e('<div id="'+r+'" class="'+i+'"/>');if(t.node=n,t.workflow=this.workflow,t.datatypes=this.datatypes,t.icon=y.default[n.type],t.cls="ui-portlet-narrow",n){var s="tool"==n.type?"Tool":"Default";o.append(new w.default[s](t).form.$el),a.append(o)}else Galaxy.emit.debug("workflow-view::initialize()","Node not found in workflow.")}e("."+i).hide(),a.find("#"+r).show(),a.show(),a.scrollTop()},isSubType:function(e,t){return e=this.ext_to_type[e],t=this.ext_to_type[t],this.type_to_type[e]&&t in this.type_to_type[e]},prebuildNode:function(t,n,i){var r=this,a=e("<div class='toolForm toolFormInCanvas'/>"),o=e("<div class='toolFormTitle unselectable'><span class='nodeTitle'>"+n+"</div></div>");s(o.find(".nodeTitle"),t),a.append(o),a.css("left",e(window).scrollLeft()+20),a.css("top",e(window).scrollTop()+20),a.append(e("<div class='toolFormBody'></div>"));var l=new _.default(this,{element:a});l.type=t,l.content_id=i;var c="<div><img height='16' align='middle' src='"+Galaxy.root+"static/images/loading_small_white_bg.gif'/> loading tool info...</div>";a.find(".toolFormBody").append(c);var d=e("<div class='buttons' style='float: right;'></div>");"subworkflow"!==t&&d.append(e("<div/>").addClass("fa-icon-button fa fa-files-o").click(function(e){l.clone()})),d.append(e("<div/>").addClass("fa-icon-button fa fa-times").click(function(e){l.destroy()})),a.appendTo("#canvas-container");var u=e("#canvas-container").position(),h=e("#canvas-container").parent(),f=a.width(),p=a.height();return a.css({left:-u.left+h.width()/2-f/2,top:-u.top+h.height()/2-p/2}),d.prependTo(a.find(".toolFormTitle")),f+=d.width()+10,a.css("width",f),a.bind("dragstart",function(){r.workflow.activate_node(l)}).bind("dragend",function(){r.workflow.node_changed(this),r.workflow.fit_canvas_to_nodes(),r.canvas_manager.draw_overview()}).bind("dragclickonly",function(){r.workflow.activate_node(l)}).bind("drag",function(t,n){var i=e(this).offsetParent().offset(),r=n.offsetX-i.left,a=n.offsetY-i.top;e(this).css({left:r,top:a}),e(this).find(".terminal").each(function(){this.terminal.redraw()})}),l}})}).call(t,n(0),n(2),n(1))},function(e,t,n){"use strict";(function(e){function i(e,t){this.app=e,this.canvas_container=t,this.id_counter=0,this.nodes={},this.name=null,this.has_changes=!1,this.active_form_has_changes=!1,this.workflowOutputLabels={}}Object.defineProperty(t,"__esModule",{value:!0});var r=n(137),a=function(e){return e&&e.__esModule?e:{default:e}}(r),o=n(7),s=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(o);e.extend(i.prototype,{canLabelOutputWith:function(e){return!e||!(e in this.workflowOutputLabels)},registerOutputLabel:function(e){e&&(this.workflowOutputLabels[e]=!0)},unregisterOutputLabel:function(e){e&&delete this.workflowOutputLabels[e]},updateOutputLabel:function(e,t){e&&this.unregisterOutputLabel(e),this.canLabelOutputWith(t)||s.warning("Workflow contains duplicate workflow output labels "+t+". This must be fixed before it can be saved."),t&&this.registerOutputLabel(t)},attemptUpdateOutputLabel:function(e,t,n){return!!this.canLabelOutputWith(n)&&(e.labelWorkflowOutput(t,n),e.nodeView.redrawWorkflowOutputs(),!0)},create_node:function(e,t,n){var i=this.app.prebuildNode(e,t,n);return this.add_node(i),this.fit_canvas_to_nodes(),this.app.canvas_manager.draw_overview(),this.activate_node(i),i},add_node:function(e){e.id=this.id_counter,e.element.attr("id","wf-node-step-"+e.id),this.id_counter++,this.nodes[e.id]=e,this.has_changes=!0,e.workflow=this},remove_node:function(e){this.active_node==e&&this.clear_active_node(),delete this.nodes[e.id],this.has_changes=!0},remove_all:function(){var t=this;e.each(this.nodes,function(e,n){n.destroy(),t.remove_node(n)})},rectify_workflow_outputs:function(){var t=!1,n=!1;if(e.each(this.nodes,function(i,r){r.workflow_outputs&&r.workflow_outputs.length>0&&(t=!0),e.each(r.post_job_actions,function(e,t){"HideDatasetAction"===t.action_type&&(n=!0)})}),!1!==t||!1!==n){var i=this;e.each(this.nodes,function(n,r){if("tool"===r.type){var a=!1;null===r.post_job_actions&&(r.post_job_actions={},a=!0);var o=[];e.each(r.post_job_actions,function(e,t){"HideDatasetAction"==t.action_type&&o.push(e)}),o.length>0&&e.each(o,function(e,t){a=!0,delete r.post_job_actions[t]}),t&&e.each(r.output_terminals,function(e,t){if(!0==!r.isWorkflowOutput(t.name)){a=!0;var n={action_type:"HideDatasetAction",output_name:t.name,action_arguments:{}};r.post_job_actions["HideDatasetAction"+t.name]=null,r.post_job_actions["HideDatasetAction"+t.name]=n}}),i.active_node==r&&!0===a&&i.reload_active_node()}})}},to_simple:function(){var t={};return e.each(this.nodes,function(n,i){var r={};e.each(i.input_terminals,function(t,n){r[n.name]=null;var i=[];e.each(n.connectors,function(e,t){if(t.handle1){var a={id:t.handle1.node.id,output_name:t.handle1.name},o=n.attributes.input.input_subworkflow_step_id;void 0!==o&&(a.input_subworkflow_step_id=o),i[e]=a,r[n.name]=i}})});var a={};i.post_job_actions&&e.each(i.post_job_actions,function(e,t){var n={action_type:t.action_type,output_name:t.output_name,action_arguments:t.action_arguments};a[t.action_type+t.output_name]=null,a[t.action_type+t.output_name]=n}),i.workflow_outputs||(i.workflow_outputs=[]);var o={id:i.id,type:i.type,content_id:i.content_id,tool_version:i.config_form.version,tool_state:i.tool_state,errors:i.errors,input_connections:r,position:e(i.element).position(),annotation:i.annotation,post_job_actions:i.post_job_actions,uuid:i.uuid,label:i.label,workflow_outputs:i.workflow_outputs};t[i.id]=o}),{steps:t}},from_simple:function(t,n){var i=void 0===n||n,r=this,o=0;i?r.name=t.name:o=Object.keys(r.nodes).length;var s=o,l=!1;e.each(t.steps,function(t,n){var a=r.app.prebuildNode(n.type,n.name,n.content_id);i||(n.uuid=null,e.each(n.workflow_outputs,function(e,t){t.uuid=null})),a.init_field_data(n),n.position&&a.element.css({top:n.position.top,left:n.position.left}),a.id=parseInt(n.id)+o,r.nodes[a.id]=a,s=Math.max(s,parseInt(t)+o),l||(a.workflow_outputs.length>0?l=!0:e.each(a.post_job_actions||[],function(e,t){"HideDatasetAction"===t.action_type&&(l=!0)}))}),r.id_counter=s+1,e.each(t.steps,function(t,n){var i=r.nodes[parseInt(t)+o];e.each(n.input_connections,function(t,n){n&&(e.isArray(n)||(n=[n]),e.each(n,function(e,n){var s=r.nodes[parseInt(n.id)+o],l=new a.default;l.connect(s.output_terminals[n.output_name],i.input_terminals[t]),l.redraw()}))}),l&&e.each(i.output_terminals,function(t,n){if(void 0===i.post_job_actions["HideDatasetAction"+n.name]){i.addWorkflowOutput(n.name);e(i.element).find(".callout."+n.name).find("img").attr("src",Galaxy.root+"static/images/fugue/asterisk-small.png"),r.has_changes=!0}})})},check_changes_in_active_form:function(){this.active_form_has_changes&&(this.has_changes=!0,e("#right-content").find("form").submit(),this.active_form_has_changes=!1)},reload_active_node:function(){if(this.active_node){var e=this.active_node;this.clear_active_node(),this.activate_node(e)}},clear_active_node:function(){this.active_node&&(this.active_node.make_inactive(),this.active_node=null),document.activeElement.blur(),this.app.showAttributes()},activate_node:function(e){this.active_node!=e&&(this.check_changes_in_active_form(),this.clear_active_node(),this.app.showForm(e.config_form,e),e.make_active(),this.active_node=e)},node_changed:function(e,t){this.has_changes=!0,this.active_node==e&&t&&(this.check_changes_in_active_form(),this.app.showForm(e.config_form,e)),this.app.showWorkflowParameters()},layout:function(){this.check_changes_in_active_form(),this.has_changes=!0;var t={},n={};e.each(this.nodes,function(e,i){void 0===t[e]&&(t[e]=0),void 0===n[e]&&(n[e]=[])}),e.each(this.nodes,function(i,r){e.each(r.input_terminals,function(i,a){e.each(a.connectors,function(e,i){var a=i.handle1.node;t[r.id]+=1,n[a.id].push(r.id)})})});for(var i=[];;){var r=[];for(var a in t)0===t[a]&&r.push(a);if(0===r.length)break;i.push(r);for(var o in r){var s=r[o];delete t[s];for(var l in n[s])t[n[s][l]]-=1}}if(!t.length){var c=this.nodes,d=80;e.each(i,function(t,n){n.sort(function(t,n){return e(c[t].element).position().top-e(c[n].element).position().top});var i=0,r=30;e.each(n,function(t,n){var a=c[n],o=e(a.element);e(o).css({top:r,left:d}),i=Math.max(i,e(o).width()),r+=e(o).height()+30}),d+=i+80}),e.each(c,function(e,t){t.redraw()})}},bounds_for_all_nodes:function(){var t,n=1/0,i=-1/0,r=1/0,a=-1/0;return e.each(this.nodes,function(o,s){var l=e(s.element);t=l.position(),n=Math.min(n,t.left),i=Math.max(i,t.left+l.width()),r=Math.min(r,t.top),a=Math.max(a,t.top+l.width())}),{xmin:n,xmax:i,ymin:r,ymax:a}},fit_canvas_to_nodes:function(){function t(e,t){return Math.ceil(e/t)*t}function n(e,t){if(e<t||e>3*t){return-(e-(Math.ceil(e%t/t)+1)*t)}return 0}var i=this.bounds_for_all_nodes(),r=this.canvas_container.position(),a=this.canvas_container.parent(),o=n(i.xmin,100),s=n(i.ymin,100);o=Math.max(o,r.left),s=Math.max(s,r.top);var l=r.left-o,c=r.top-s,d=t(i.xmax+100,100)+o,u=t(i.ymax+100,100)+s;d=Math.max(d,-l+a.width()),u=Math.max(u,-c+a.height()),this.canvas_container.css({left:l,top:c,width:d,height:u}),this.canvas_container.children().each(function(){var t=e(this).position();e(this).css("left",t.left+o),e(this).css("top",t.top+s)})}}),t.default=i}).call(t,n(0))},function(e,t,n){"use strict";(function(e){function n(e,t,n){this.app=e,this.cv=t,this.cc=this.cv.find("#canvas-container"),this.overview=n,this.oc=n.find("#overview-canvas"),this.ov=n.find("#overview-viewport"),this.init_drag(),this.init_copy_paste()}function i(e){this.panel=e}Object.defineProperty(t,"__esModule",{value:!0}),e.extend(n.prototype,{init_drag:function(){var t=this,n=function(e,n){e=Math.min(e,t.cv.width()/2),e=Math.max(e,-t.cc.width()+t.cv.width()/2),n=Math.min(n,t.cv.height()/2),n=Math.max(n,-t.cc.height()+t.cv.height()/2),t.cc.css({left:e,top:n}),t.cv.css({"background-position-x":e,"background-position-y":n}),t.update_viewport_overlay()};this.cc.each(function(){this.scroll_panel=new i(this)});var r,a;this.cv.bind("click",function(){document.activeElement.blur()}).bind("dragstart",function(){var n=e(this).offset(),i=t.cc.position();a=i.top-n.top,r=i.left-n.left}).bind("drag",function(e,t){n(t.offsetX+r,t.offsetY+a)}).bind("dragend",function(){t.app.workflow.fit_canvas_to_nodes(),t.draw_overview()}),this.overview.click(function(e){if(t.overview.hasClass("blockaclick"))t.overview.removeClass("blockaclick");else{var i=t.cc.width(),r=t.cc.height(),a=t.oc.width(),o=t.oc.height(),s=e.pageX-t.oc.offset().left-t.ov.width()/2,l=e.pageY-t.oc.offset().top-t.ov.height()/2;n(-s/a*i,-l/o*r),t.app.workflow.fit_canvas_to_nodes(),t.draw_overview()}}),this.ov.bind("drag",function(e,i){var r=t.cc.width(),a=t.cc.height(),o=t.oc.width(),s=t.oc.height(),l=i.offsetX-t.overview.offset().left,c=i.offsetY-t.overview.offset().top;n(-l/o*r,-c/s*a)}).bind("dragend",function(){t.overview.addClass("blockaclick"),t.app.workflow.fit_canvas_to_nodes(),t.draw_overview()}),e("#overview-border").bind("drag",function(n,i){var r=e(this).offsetParent(),a=r.offset(),o=Math.max(r.width()-(i.offsetX-a.left),r.height()-(i.offsetY-a.top));e(this).css({width:o,height:o}),t.draw_overview()}),e("#overview-border div").bind("drag",function(){})},init_copy_paste:function(){var e=this;document.addEventListener("copy",function(t){""===window.getSelection().toString()&&(e.app.workflow.active_node&&"subworkflow"!==e.app.workflow.active_node.type&&t.clipboardData.setData("application/json",JSON.stringify({nodeId:e.app.workflow.active_node.id})),t.preventDefault())}),document.addEventListener("paste",function(t){if(document.activeElement&&"textarea"!==document.activeElement.type&&"text"!==document.activeElement.type){var n;try{n=JSON.parse(t.clipboardData.getData("application/json")).nodeId}catch(e){}n&&e.app.workflow.nodes.hasOwnProperty(n)&&e.app.workflow.nodes[n].clone(),t.preventDefault()}})},update_viewport_overlay:function(){var e=this.cc,t=this.cv,n=this.oc,i=this.ov,r=e.width(),a=e.height(),o=n.width(),s=n.height(),l=e.position();i.css({left:-l.left/r*o,top:-l.top/a*s,width:t.width()/r*o-2,height:t.height()/a*s-2})},draw_overview:function(){var t,n,i,r,a=e("#overview-canvas"),o=a.parent().parent().width(),s=a.get(0).getContext("2d"),l=e("#canvas-container").width(),c=e("#canvas-container").height(),d=this.cv.width(),u=this.cv.height();l<d&&c<u?(i=l/d*o,r=(o-i)/2,t=c/u*o,n=(o-t)/2):l<c?(n=0,t=o,i=Math.ceil(t*l/c),r=(o-i)/2):(i=o,r=0,t=Math.ceil(i*c/l),n=(o-t)/2),a.parent().css({left:r,top:n,width:i,height:t}),a.attr("width",i),a.attr("height",t),e.each(this.app.workflow.nodes,function(n,r){s.fillStyle="#D2C099",s.strokeStyle="#D8B365",s.lineWidth=1;var a=e(r.element),o=a.position(),d=o.left/l*i,u=o.top/c*t,h=a.width()/l*i,f=a.height()/c*t;r.errors?(s.fillStyle="#FFCCCC",s.strokeStyle="#AA6666"):void 0!==r.workflow_outputs&&r.workflow_outputs.length>0&&(s.fillStyle="#E8A92D",s.strokeStyle="#E8A92D"),s.fillRect(d,u,h,f),s.strokeRect(d,u,h,f)}),this.update_viewport_overlay()}}),e.extend(i.prototype,{test:function(t,n){var i=this;clearTimeout(this.timeout);var r=t.pageX,a=t.pageY,o=e(this.panel),s=o.position(),l=o.width(),c=o.height(),d=o.parent(),u=d.width(),h=d.height(),f=d.offset(),p=f.left,g=f.top,m=p+d.width(),_=g+d.height(),v=-(l-u/2),y=-(c-h/2),b=u/2,w=h/2,x=!1,k=0;r-5<p?s.left<b&&(k=Math.min(23,b-s.left),o.css("left",s.left+k),x=!0):r+5>m?s.left>v&&(k=Math.min(23,s.left-v),o.css("left",s.left-k),x=!0):a-5<g?s.top<w&&(k=Math.min(23,w-s.top),o.css("top",s.top+k),x=!0):a+5>_&&s.top>y&&(k=Math.min(23,s.top-v),o.css("top",s.top-k+"px"),x=!0),x&&(n(),this.timeout=setTimeout(function(){i.test(t,n)},50))},stop:function(){clearTimeout(this.timeout)}}),t.default=n}).call(t,n(0))},function(e,t,n){"use strict";(function(e,i,r){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(5),s=a(o),l=n(306),c=a(l),d=e.Model.extend({initialize:function(e,t){this.app=e,this.element=t.element,this.input_terminals={},this.output_terminals={},this.errors={},this.workflow_outputs=[]},getWorkflowOutput:function(e){return i.findWhere(this.workflow_outputs,{output_name:e})},isWorkflowOutput:function(e){return void 0!==this.getWorkflowOutput(e)},removeWorkflowOutput:function(e){for(;this.isWorkflowOutput(e);)this.workflow_outputs.splice(this.getWorkflowOutput(e),1)},addWorkflowOutput:function(e,t){if(!this.isWorkflowOutput(e)){var n={output_name:e};return t&&(n.label=t),this.workflow_outputs.push(n),!0}return!1},labelWorkflowOutput:function(e,t){var n=!1,i=null;if(this.isWorkflowOutput(e)){var r=this.getWorkflowOutput(e);i=r.label,r.label=t,n=i!=t}else n=this.addWorkflowOutput(e,t);return n&&(this.app.workflow.updateOutputLabel(i,t),this.markChanged(),this.nodeView.redrawWorkflowOutputs()),n},connectedOutputTerminals:function(){return this._connectedTerminals(this.output_terminals)},_connectedTerminals:function(e){var t=[];return r.each(e,function(e,n){n.connectors.length>0&&t.push(n)}),t},hasConnectedOutputTerminals:function(){var e=this.output_terminals;for(var t in e)if(e[t].connectors.length>0)return!0;return!1},connectedMappedInputTerminals:function(){return this._connectedMappedTerminals(this.input_terminals)},hasConnectedMappedInputTerminals:function(){var e=this.input_terminals;for(var t in e){var n=e[t];if(n.connectors.length>0&&n.isMappedOver())return!0}return!1},_connectedMappedTerminals:function(e){var t=[];return r.each(e,function(e,n){n.mapOver().isCollection&&n.connectors.length>0&&t.push(n)}),t},mappedInputTerminals:function(){return this._mappedTerminals(this.input_terminals)},_mappedTerminals:function(e){var t=[];return r.each(e,function(e,n){n.mapOver().isCollection&&t.push(n)}),t},hasMappedOverInputTerminals:function(){var e=!1;return i.each(this.input_terminals,function(t){t.mapOver().isCollection&&(e=!0)}),e},redraw:function(){r.each(this.input_terminals,function(e,t){t.redraw()}),r.each(this.output_terminals,function(e,t){t.redraw()})},clone:function(){var e=this,t={name:this.name,label:this.label,annotation:this.annotation,post_job_actions:this.post_job_actions},n=this.app.workflow.create_node(this.type,this.name,this.content_id);s.default.request({type:"POST",url:Galaxy.root+"api/workflows/build_module",data:{type:this.type,tool_id:this.content_id,tool_state:this.tool_state},success:function(i){var r=Object.assign({},i,t);n.init_field_data(r),n.update_field_data(r),e.app.workflow.activate_node(n)}})},destroy:function(){r.each(this.input_terminals,function(e,t){t.destroy()}),r.each(this.output_terminals,function(e,t){t.destroy()}),this.app.workflow.remove_node(this),r(this.element).remove()},make_active:function(){r(this.element).addClass("toolForm-active")},make_inactive:function(){var e=this.element.get(0);!function(t){t.removeChild(e),t.appendChild(e)}(e.parentNode),r(e).removeClass("toolForm-active")},set_tool_version:function(){"tool"===this.type&&this.config_form&&(this.tool_version=this.config_form.version,this.content_id=this.config_form.id)},init_field_data:function(e){e.type&&(this.type=e.type),this.name=e.name,this.config_form=e.config_form,this.set_tool_version(),this.tool_state=e.tool_state,this.errors=e.errors,this.tooltip=e.tooltip?e.tooltip:"",this.annotation=e.annotation,this.post_job_actions=e.post_job_actions?e.post_job_actions:{},this.label=e.label,this.uuid=e.uuid,this.workflow_outputs=e.workflow_outputs?e.workflow_outputs:[];var t=this,n=new c.default({el:this.element[0],node:t});t.nodeView=n,r.each(e.data_inputs,function(e,t){n.addDataInput(t)}),e.data_inputs.length>0&&e.data_outputs.length>0&&n.addRule(),r.each(e.data_outputs,function(e,t){n.addDataOutput(t)}),n.render(),this.app.workflow.node_changed(this,!0)},update_field_data:function(e){var t=this,n=t.nodeView,a=[];if(r.each(n.outputViews,function(t,n){var r=n.output.name,o=e.data_outputs,s=!1;i.each(o,function(e){e.name==r&&(s=!0)}),!1===s&&a.push(r)}),i.each(a,function(e){i.each(n.outputViews[e].terminalElement.terminal.connectors,function(e){e&&e.destroy()}),n.outputViews[e].remove(),delete n.outputViews[e],delete t.output_terminals[e]}),r.each(t.workflow_outputs,function(e,n){n&&!t.output_terminals[n.output_name]&&t.workflow_outputs.splice(e,1)}),r.each(e.data_outputs,function(e,i){n.outputViews[i.name]?(t.output_terminals[i.name].datatypes=i.extensions,t.output_terminals[i.name].destroyInvalidConnections()):n.addDataOutput(i)}),this.tool_state=e.tool_state,this.config_form=e.config_form,this.set_tool_version(),this.errors=e.errors,this.annotation=e.annotation,this.label=e.label,"post_job_actions"in e){var o=e.post_job_actions;this.post_job_actions=o||{}}t.nodeView.renderToolErrors();var s=n.$("div.inputs"),l=n.newInputsDiv(),c={};i.each(e.data_inputs,function(e){var n=t.nodeView.addDataInput(e,l);c[e.name]=n}),i.each(i.difference(i.values(n.terminalViews),i.values(c)),function(e){e.el.terminal.destroy()}),n.terminalViews=c,t.nodeView.render(),1==e.data_outputs.length&&"collection_type"in e.data_outputs[0]&&n.updateDataOutput(e.data_outputs[0]),s.replaceWith(l),"workflow_outputs"in e&&(this.workflow_outputs=e.workflow_outputs?e.workflow_outputs:[]),this.markChanged(),this.redraw()},error:function(e){var t=r(this.element).find(".toolFormBody");t.find("div").remove();var n="<div style='color: red; text-style: italic;'>"+e+"</div>";this.config_form=n,t.html(n),this.app.workflow.node_changed(this)},markChanged:function(){this.app.workflow.node_changed(this)}});t.default=d}).call(t,n(2),n(1),n(0))},function(e,t,n){"use strict";(function(e,i){function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var a=n(1),o=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(a),s=n(307),l=r(s),c=n(309),d=r(c);t.default=e.View.extend({initialize:function(e){this.node=e.node,this.output_width=Math.max(150,this.$el.width()),this.tool_body=this.$el.find(".toolFormBody"),this.tool_body.find("div").remove(),this.newInputsDiv().appendTo(this.tool_body),this.terminalViews={},this.outputViews={}},render:function(){this.renderToolLabel(),this.renderToolErrors(),this.$el.css("width",Math.min(250,Math.max(this.$el.width(),this.output_width)))},renderToolLabel:function(){this.$(".nodeTitle").text(this.node.label||this.node.name)},renderToolErrors:function(){this.node.errors?this.$el.addClass("tool-node-error"):this.$el.removeClass("tool-node-error")},newInputsDiv:function(){return i("<div/>").addClass("inputs")},updateMaxWidth:function(e){this.output_width=Math.max(this.output_width,e)},addRule:function(){this.tool_body.append(i("<div/>").addClass("rule"))},addDataInput:function(e,t){var n=!0;t||(t=this.$(".inputs"),n=!1);var i=this.terminalViews[e.name],r="dataset_collection"==e.input_type?l.default.InputCollectionTerminalView:l.default.InputTerminalView;if(!i||i instanceof r||(i.el.terminal.destroy(),i=null),i){var a=i.el.terminal;a.update(e),a.destroyInvalidConnections()}else i=new r({node:this.node,input:e});this.terminalViews[e.name]=i;var o=i.el,s=new d.default.DataInputView({terminalElement:o,input:e,nodeView:this,skipResize:n}),c=s.$el;return t.append(c.prepend(i.terminalElements())),i},addDataOutput:function(e){var t=e.collection?l.default.OutputCollectionTerminalView:l.default.OutputTerminalView,n=new t({node:this.node,output:e}),i=new d.default.DataOutputView({output:e,terminalElement:n.el,nodeView:this});this.outputViews[e.name]=i,this.tool_body.append(i.$el.append(n.terminalElements()))},redrawWorkflowOutputs:function(){o.each(this.outputViews,function(e){e.redrawWorkflowOutput()})},updateDataOutput:function(e){this.node.output_terminals[e.name].update(e)}})}).call(t,n(2),n(0))},function(e,t,n){"use strict";(function(e,i,r){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(308),s=a(o),l=n(137),c=a(l);window.workflow_globals=window.workflow_globals||{};var d=e.View.extend({tagName:"div",className:"fa-icon-button fa fa-folder-o",initialize:function(e){this.$el.tooltip({delay:500,title:"Run tool in parallel over collection"}),this.model.bind("change",i.bind(this.render,this))},render:function(){this.model.mapOver.isCollection?this.$el.show():this.$el.hide()}}),u=d.extend({events:{click:"onClick",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave"},onMouseEnter:function(e){var t=this.model;!t.terminal.connected()&&t.mapOver.isCollection&&this.$el.css("color","red")},onMouseLeave:function(e){this.$el.css("color","black")},onClick:function(e){var t=this.model;!t.terminal.connected()&&t.mapOver.isCollection&&t.terminal.resetMapping()}}),h=e.View.extend({setupMappingView:function(e){var t=new this.terminalMappingClass({terminal:e}),n=new this.terminalMappingViewClass({model:t});n.render(),e.terminalMappingView=n,this.terminalMappingView=n},terminalElements:function(){return this.terminalMappingView?[this.terminalMappingView.el,this.el]:[this.el]}}),f=h.extend({className:"terminal input-terminal",initialize:function(e){var t=e.node,n=e.input,i=n.name,r=this.terminalForInput(n);r.multiple||this.setupMappingView(r),this.el.terminal=r,r.node=t,r.name=i,t.input_terminals[i]=r},events:{dropinit:"onDropInit",dropstart:"onDropStart",dropend:"onDropEnd",drop:"onDrop",hover:"onHover"},onDropInit:function(e,t){var n=this.el.terminal;return r(t.drag).hasClass("output-terminal")&&n.canAccept(t.drag.terminal)},onDropStart:function(e,t){t.proxy.terminal&&(t.proxy.terminal.connectors[0].inner_color="#BBFFBB")},onDropEnd:function(e,t){t.proxy.terminal&&(t.proxy.terminal.connectors[0].inner_color="#FFFFFF")},onDrop:function(e,t){var n=this.el.terminal;new c.default(t.drag.terminal,n).redraw()},onHover:function(){var e=this.el,t=e.terminal;if(t.connectors.length>0){var n=r("<div class='callout'></div>").css({display:"none"}).appendTo("body").append(r("<div class='button'></div>").append(r("<div/>").addClass("fa-icon-button fa fa-times").click(function(){r.each(t.connectors,function(e,t){t&&t.destroy()}),n.remove()}))).bind("mouseleave",function(){r(this).remove()});n.css({top:r(e).offset().top-2,left:r(e).offset().left-n.width(),"padding-right":r(e).width()}).show()}}}),p=f.extend({terminalMappingClass:s.default.TerminalMapping,terminalMappingViewClass:u,terminalForInput:function(e){return new s.default.InputTerminal({element:this.el,input:e})}}),g=f.extend({terminalMappingClass:s.default.TerminalMapping,terminalMappingViewClass:u,terminalForInput:function(e){return new s.default.InputCollectionTerminal({element:this.el,input:e})}}),m=h.extend({className:"terminal output-terminal",initialize:function(e){var t=e.node,n=e.output,i=n.name,r=this.terminalForOutput(n);this.setupMappingView(r),this.el.terminal=r,r.node=t,r.name=i,t.output_terminals[i]=r},events:{drag:"onDrag",dragstart:"onDragStart",dragend:"onDragEnd"},onDrag:function(e,t){var n=function(){var e=r(t.proxy).offsetParent().offset(),n=t.offsetX-e.left,i=t.offsetY-e.top;r(t.proxy).css({left:n,top:i}),t.proxy.terminal.redraw(),window.workflow_globals.canvas_manager.update_viewport_overlay()};n(),r("#canvas-container").get(0).scroll_panel.test(e,n)},onDragStart:function(e,t){r(t.available).addClass("input-terminal-active"),window.workflow_globals.workflow.check_changes_in_active_form();var n=r('<div class="drag-terminal" style="position: absolute;"></div>').appendTo("#canvas-container").get(0);n.terminal=new s.default.OutputTerminal({element:n});var i=new c.default;return i.dragging=!0,i.connect(this.el.terminal,n.terminal),n},onDragEnd:function(e,t){var n=t.proxy.terminal.connectors[0];n&&n.destroy(),r(t.proxy).remove(),r(t.available).removeClass("input-terminal-active"),r("#canvas-container").get(0).scroll_panel.stop()}}),_=m.extend({terminalMappingClass:s.default.TerminalMapping,terminalMappingViewClass:d,terminalForOutput:function(e){var t=e.extensions;return new s.default.OutputTerminal({element:this.el,datatypes:t})}}),v=m.extend({terminalMappingClass:s.default.TerminalMapping,terminalMappingViewClass:d,terminalForOutput:function(e){var t=e.collection_type,n=e.collection_type_source;return new s.default.OutputCollectionTerminal({element:this.el,collection_type:t,collection_type_source:n,datatypes:e.extensions})}});t.default={InputTerminalView:p,OutputTerminalView:_,InputCollectionTerminalView:g,OutputCollectionTerminalView:v}}).call(t,n(2),n(1),n(0))},function(e,t,n){"use strict";(function(e,n,i){function r(e){this.collectionType=e,this.isCollection=!0,this.rank=e.split(":").length}Object.defineProperty(t,"__esModule",{value:!0}),window.workflow_globals=window.workflow_globals||{};var a={isCollection:!1,canMatch:function(){return!1},canMapOver:function(){return!1},toString:function(){return"NullCollectionType[]"},append:function(e){return e},equal:function(e){return e===this}},o={isCollection:!0,canMatch:function(e){return a!==e},canMapOver:function(){return!1},toString:function(){return"AnyCollectionType[]"},append:function(){throw"Cannot append to ANY_COLLECTION_TYPE_DESCRIPTION"},equal:function(e){return e===this}};e.extend(r.prototype,{append:function(e){return e===a?this:e===o?e:new r(this.collectionType+":"+e.collectionType)},canMatch:function(e){return e!==a&&(e===o||e.collectionType==this.collectionType)},canMapOver:function(e){if(e===a)return!1;if(e===o)return!1;if(this.rank<=e.rank)return!1;var t=e.collectionType;return this._endsWith(this.collectionType,t)},effectiveMapOver:function(e){var t=e.collectionType;return new r(this.collectionType.substring(0,this.collectionType.length-t.length-1))},equal:function(e){return e.collectionType==this.collectionType},toString:function(){return"CollectionType["+this.collectionType+"]"},_endsWith:function(e,t){return-1!==e.indexOf(t,e.length-t.length)}});var s=n.Model.extend({initialize:function(e){this.mapOver=e.mapOver||a,this.terminal=e.terminal,this.terminal.terminalMapping=this},disableMapOver:function(){this.setMapOver(a)},setMapOver:function(e){this.mapOver=e,this.trigger("change")}}),l=n.Model.extend({initialize:function(e){this.element=e.element,this.connectors=[]},connect:function(e){this.connectors.push(e),this.node&&this.node.markChanged()},disconnect:function(t){this.connectors.splice(e.inArray(t,this.connectors),1),this.node&&(this.node.markChanged(),this.resetMappingIfNeeded())},redraw:function(){e.each(this.connectors,function(e,t){t.redraw()})},destroy:function(){e.each(this.connectors.slice(),function(e,t){t.destroy()})},destroyInvalidConnections:function(){i.each(this.connectors,function(e){e&&e.destroyIfInvalid()})},setMapOver:function(e){this.multiple||this.mapOver().equal(e)||(this.terminalMapping.setMapOver(e),i.each(this.node.output_terminals,function(t){t.setMapOver(e)}))},mapOver:function(){return this.terminalMapping?this.terminalMapping.mapOver:a},isMappedOver:function(){return this.terminalMapping&&this.terminalMapping.mapOver.isCollection},resetMapping:function(){this.terminalMapping.disableMapOver()},resetMappingIfNeeded:function(){}}),c=l.extend({initialize:function(e){l.prototype.initialize.call(this,e),this.datatypes=e.datatypes},resetMappingIfNeeded:function(){this.node.hasConnectedOutputTerminals()||this.node.hasConnectedMappedInputTerminals()||i.each(this.node.mappedInputTerminals(),function(e){e.resetMappingIfNeeded()}),!this.node.hasMappedOverInputTerminals()&&this.resetMapping()},resetMapping:function(){this.terminalMapping.disableMapOver(),i.each(this.connectors,function(e){var t=e.handle2;t&&(t.resetMappingIfNeeded(),e.destroyIfInvalid())})}}),d=l.extend({initialize:function(e){l.prototype.initialize.call(this,e),this.update(e.input)},canAccept:function(e){return!this._inputFilled()&&this.attachable(e)},resetMappingIfNeeded:function(){this.mapOver().isCollection&&((this.node.hasConnectedMappedInputTerminals()||!this.node.hasConnectedOutputTerminals())&&this.resetMapping())},resetMapping:function(){this.terminalMapping.disableMapOver(),this.node.hasMappedOverInputTerminals()||i.each(this.node.output_terminals,function(e){e.resetMapping()})},connected:function(){return 0!==this.connectors.length},_inputFilled:function(){return!!this.connected()&&(!this.multiple||!!this._collectionAttached())},_collectionAttached:function(){if(this.connected()){var e=this.connectors[0].handle1;return!!e&&!!(e.isCollection||e.isMappedOver()||e.datatypes.indexOf("input_collection")>0)}return!1},_mappingConstraints:function(){if(!this.node)return[];var e=this.mapOver();if(e.isCollection)return[e];var t=[];return this.node.hasConnectedOutputTerminals()?t.push(i.first(i.values(this.node.output_terminals)).mapOver()):i.each(this.node.connectedMappedInputTerminals(),function(e){t.push(e.mapOver())}),t},_producesAcceptableDatatype:function(e){for(var t in this.datatypes){var n=this.datatypes[t];if("input"==n)return!0;var i=[];if(i=i.concat(e.datatypes),e.node.post_job_actions)for(var r in e.node.post_job_actions){var a=e.node.post_job_actions[r];"ChangeDatatypeAction"!=a.action_type||""!==a.output_name&&a.output_name!=e.name||!a.action_arguments||i.push(a.action_arguments.newtype)}for(var o in i){var s=i[o];if("input"==s||"_sniff_"==s||"input_collection"==s||window.workflow_globals.app.isSubType(i[o],n))return!0}}return!1},_otherCollectionType:function(e){var t=a;e.isCollection&&(t=e.collectionType);var n=e.mapOver();return n.isCollection&&(t=n.append(t)),t}}),u=d.extend({update:function(e){this.datatypes=e.extensions,this.multiple=e.multiple,this.collection=!1},connect:function(e){d.prototype.connect.call(this,e);var t=e.handle1;if(t){var n=this._otherCollectionType(t);n.isCollection&&this.setMapOver(n)}},attachable:function(e){var t=this._otherCollectionType(e),n=this.mapOver();if(t.isCollection){if(this.multiple)return!(this.connected()&&!this._collectionAttached())&&(1==t.rank&&this._producesAcceptableDatatype(e));if(n.isCollection&&n.canMatch(t))return this._producesAcceptableDatatype(e);return!!this._mappingConstraints().every(i.bind(t.canMatch,t))&&this._producesAcceptableDatatype(e)}return!n.isCollection&&this._producesAcceptableDatatype(e)}}),h=d.extend({update:function(e){this.multiple=!1,this.collection=!0,this.datatypes=e.extensions;var t=[];e.collection_types?i.each(e.collection_types,function(e){t.push(new r(e))}):t.push(o),this.collectionTypes=t},connect:function(e){d.prototype.connect.call(this,e);var t=e.handle1;if(t){var n=this._effectiveMapOver(t);this.setMapOver(n)}},_effectiveMapOver:function(e){var t=this.collectionTypes,n=this._otherCollectionType(e);if(!i.some(t,function(e){return e.canMatch(n)}))for(var r in t){var o=t[r];if(n.canMapOver(o)){var s=n.effectiveMapOver(o);if(s!=a)return s}}return a},_effectiveCollectionTypes:function(){var e=this.mapOver();return i.map(this.collectionTypes,function(t){return e.append(t)})},attachable:function(e){var t=this._otherCollectionType(e);if(t.isCollection){var n=this._effectiveCollectionTypes(),r=this.mapOver();if(i.some(n,function(e){return e.canMatch(t)}))return this._producesAcceptableDatatype(e);if(r.isCollection)return!1;if(i.some(this.collectionTypes,function(e){return t.canMapOver(e)})){var a=this._effectiveMapOver(e);if(!a.isCollection)return!1;if(this._mappingConstraints().every(a.canMatch))return this._producesAcceptableDatatype(e)}}return!1}}),f=l.extend({initialize:function(e){if(l.prototype.initialize.call(this,e),this.datatypes=e.datatypes,e.collection_type)this.collectionType=new r(e.collection_type);else{e.collection_type_source||console.log("Warning: No collection type or collection type source defined."),this.collectionType=o}this.isCollection=!0},update:function(e){var t;if(e.collection_type)t=new r(e.collection_type);else{e.collection_type_source||console.log("Warning: No collection type or collection type source defined."),t=o}t.collectionType!=this.collectionType.collectionType&&i.each(this.connectors,function(e){e.destroy()}),this.collectionType=t}});t.default={InputTerminal:u,OutputTerminal:c,InputCollectionTerminal:h,OutputCollectionTerminal:f,TerminalMapping:s,CollectionTypeDescription:r,NULL_COLLECTION_TYPE_DESCRIPTION:a,ANY_COLLECTION_TYPE_DESCRIPTION:o}}).call(t,n(0),n(2),n(1))},function(e,t,n){"use strict";(function(e,n){Object.defineProperty(t,"__esModule",{value:!0}),window.workflow_globals=window.workflow_globals||{};var i=e.View.extend({className:"form-row dataRow input-data-row",initialize:function(e){this.input=e.input,this.nodeView=e.nodeView,this.terminalElement=e.terminalElement,this.$el.attr("name",this.input.name).html(this.input.label),e.skipResize||(this.$el.css({position:"absolute",left:-1e3,top:-1e3,display:"none"}),n("body").append(this.el),this.nodeView.updateMaxWidth(this.$el.outerWidth()),this.$el.css({position:"",left:"",top:"",display:""}),this.$el.remove())}}),r=e.View.extend({className:"form-row dataRow",initialize:function(e){this.output=e.output,this.terminalElement=e.terminalElement,this.nodeView=e.nodeView;var t=this.output,i=t.name,r=this.nodeView.node;if(t.extensions.indexOf("input")>=0||t.extensions.indexOf("input_collection")>=0||(i=i+" ("+t.extensions.join(", ")+")"),this.$el.html(i),this.calloutView=null,["tool","subworkflow"].indexOf(r.type)>=0){var o=new a({label:i,output:t,node:r});this.calloutView=o,this.$el.append(o.el),this.$el.hover(function(){o.hoverImage()},function(){o.resetImage()})}this.$el.css({position:"absolute",left:-1e3,top:-1e3,display:"none"}),n("body").append(this.el),this.nodeView.updateMaxWidth(this.$el.outerWidth()+17),this.$el.css({position:"",left:"",top:"",display:""}).detach()},redrawWorkflowOutput:function(){this.calloutView&&this.calloutView.resetImage()}}),a=e.View.extend({tagName:"div",initialize:function(e){this.label=e.label,this.node=e.node,this.output=e.output;var t=this,i=this.node;this.$el.attr("class","callout "+this.label).css({display:"none"}).append(n("<div class='buttons'></div>").append(n("<img/>").attr("src",Galaxy.root+"static/images/fugue/asterisk-small-outline.png").click(function(){var e=t.output.name;i.isWorkflowOutput(e)?(i.removeWorkflowOutput(e),t.$("img").attr("src",Galaxy.root+"static/images/fugue/asterisk-small-outline.png")):(i.addWorkflowOutput(e),t.$("img").attr("src",Galaxy.root+"static/images/fugue/asterisk-small.png")),window.workflow_globals.workflow.has_changes=!0,window.workflow_globals.canvas_manager.draw_overview()}))).tooltip({delay:500,title:"Mark dataset as a workflow output. All unmarked datasets will be hidden."}),this.$el.css({top:"50%",margin:"-8px 0px 0px 0px",right:8}),this.$el.show(),this.resetImage()},resetImage:function(){this.node.isWorkflowOutput(this.output.name)?this.$("img").attr("src",Galaxy.root+"static/images/fugue/asterisk-small.png"):this.$("img").attr("src",Galaxy.root+"static/images/fugue/asterisk-small-outline.png")},hoverImage:function(){this.$("img").attr("src",Galaxy.root+"static/images/fugue/asterisk-small-yellow.png")}});t.default={DataInputView:i,DataOutputView:r}}).call(t,n(2),n(0))},function(e,t,n){"use strict";(function(e,i){function r(e){return e&&e.__esModule?e:{default:e}}function a(e){var t=e.model.attributes,n=t.workflow,i=t.node;t.inputs.unshift({type:"text",name:"__annotation",label:"Annotation",fixed:!0,value:i.annotation,area:!0,help:"Add an annotation or notes to this step. Annotations are available when a workflow is viewed."}),t.inputs.unshift({type:"text",name:"__label",label:"Label",value:i.label,help:(0,d.default)("Add a step label."),fixed:!0,onchange:function(t){var r=!1;for(var a in n.nodes){var o=n.nodes[a];if(o.label&&o.label==t&&o.id!=i.id){r=!0;break}}var s=e.data.match("__label");e.element_list[s].model.set("error_text",r&&"Duplicate label. Please fix this before saving the workflow."),e.trigger("change")}})}function o(e,t,n,i){var r=i.node.post_job_actions;t=t||[],t.push(e);for(var a in e.inputs){var s=e.inputs[a];if(s.action){if(s.name="pja__"+n+"__"+s.action,s.pja_arg&&(s.name+="__"+s.pja_arg),s.payload)for(var l in s.payload)s.payload[s.name+"__"+l]=s.payload[l],delete s.payload[l];var c=r[s.action+n];if(c){for(var d in t)t[d].expanded=!0;s.pja_arg?s.value=c.action_arguments&&c.action_arguments[s.pja_arg]||s.value:s.value="true"}}s.inputs&&o(s,t.slice(0),n,i)}}function s(e,t){var n=[],i=[],r=t.datatypes,a=t.node,s=t.workflow;for(var l in r)n.push({0:r[l],1:r[l]});for(l in a.input_terminals)i.push(a.input_terminals[l].name);n.sort(function(e,t){return e.label>t.label?1:e.label<t.label?-1:0}),n.unshift({0:"Sequences",1:"Sequences"}),n.unshift({0:"Roadmaps",1:"Roadmaps"}),n.unshift({0:"Leave unchanged",1:"__empty__"});var c,u={title:"Configure Output: '"+e+"'",type:"section",flat:!0,inputs:[{label:"Label",type:"text",value:(c=a.getWorkflowOutput(e))&&c.label||"",help:"This will provide a short name to describe the output - this must be unique across workflows.",onchange:function(t){s.attemptUpdateOutputLabel(a,e,t)}},{action:"RenameDatasetAction",pja_arg:"newname",label:"Rename dataset",type:"text",value:"",ignore:"",help:'This action will rename the output dataset. Click <a href="https://galaxyproject.org/learn/advanced-workflow/variables/">here</a> for more information. Valid inputs are: <strong>'+i.join(", ")+"</strong>."},{action:"ChangeDatatypeAction",pja_arg:"newtype",label:"Change datatype",type:"select",ignore:"__empty__",value:"__empty__",options:n,help:"This action will change the datatype of the output to the indicated value."},{action:"TagDatasetAction",pja_arg:"tags",label:"Add Tags",type:"text",value:"",ignore:"",help:"This action will set tags for the dataset."},{action:"RemoveTagDatasetAction",pja_arg:"tags",label:"Remove Tags",type:"text",value:"",ignore:"",help:"This action will remove tags for the dataset."},{title:(0,d.default)("Assign columns"),type:"section",flat:!0,inputs:[{action:"ColumnSetAction",pja_arg:"chromCol",label:"Chrom column",type:"integer",value:"",ignore:""},{action:"ColumnSetAction",pja_arg:"startCol",label:"Start column",type:"integer",value:"",ignore:""},{action:"ColumnSetAction",pja_arg:"endCol",label:"End column",type:"integer",value:"",ignore:""},{action:"ColumnSetAction",pja_arg:"strandCol",label:"Strand column",type:"integer",value:"",ignore:""},{action:"ColumnSetAction",pja_arg:"nameCol",label:"Name column",type:"integer",value:"",ignore:""}],help:"This action will set column assignments in the output dataset. Blank fields are ignored."}]};return o(u,[],e,t),u}function l(e){var t=e.model.attributes,n=t.inputs,i=t.node,r=i.post_job_actions,a=i.output_terminals&&Object.keys(i.output_terminals)[0];if(a){n.push({name:"pja__"+a+"__EmailAction",label:"Email notification",type:"boolean",value:String(Boolean(r["EmailAction"+a])),ignore:"false",help:(0,d.default)("An email notification will be sent when the job has completed."),payload:{host:window.location.host}}),n.push({name:"pja__"+a+"__DeleteIntermediatesAction",label:"Output cleanup",type:"boolean",value:String(Boolean(r["DeleteIntermediatesAction"+a])),ignore:"false",help:"Upon completion of this step, delete non-starred outputs from completed workflow steps if they are no longer required as inputs."});for(var o in i.output_terminals)n.push(s(o,t))}}Object.defineProperty(t,"__esModule",{value:!0});var c=n(3),d=r(c),u=n(5),h=r(u),f=n(13),p=r(f),g=n(82),m=r(g),_=e.View.extend({initialize:function(e){var t=this,n=e.node;this.form=new p.default(h.default.merge(e,{onchange:function(){h.default.request({type:"POST",url:Galaxy.root+"api/workflows/build_module",data:{id:n.id,type:n.type,content_id:n.content_id,inputs:t.form.data.create()},success:function(e){n.update_field_data(e)}})}})),a(this.form),this.form.render()}}),v=e.View.extend({initialize:function(e){var t=this,n=e.node;this.form=new m.default(h.default.merge(e,{text_enable:"Set in Advance",text_disable:"Set at Runtime",narrow:!0,initial_errors:!0,cls:"ui-portlet-narrow",initialmodel:function(e,n){t._customize(n),e.resolve()},buildmodel:function(e,t){t.model.get("postchange")(e,t)},postchange:function(e,r){var a=r.model.attributes,o={tool_id:a.id,tool_version:a.version,type:"tool",inputs:i.extend(!0,{},r.data.create())};Galaxy.emit.debug("tool-form-workflow::postchange()","Sending current state.",o),h.default.request({type:"POST",url:Galaxy.root+"api/workflows/build_module",data:o,success:function(i){r.model.set(i.config_form),t._customize(r),r.update(i.config_form),r.errors(i.config_form),n.update_field_data(i),Galaxy.emit.debug("tool-form-workflow::postchange()","Received new model.",i),e.resolve()},error:function(t){Galaxy.emit.debug("tool-form-workflow::postchange()","Refresh request failed.",t),e.reject()}})}}))},_customize:function(e){var t=e.model.attributes;h.default.deepeach(t.inputs,function(e){e.type&&(-1!=["data","data_collection"].indexOf(e.type)?(e.type="hidden",e.info="Data input '"+e.name+"' ("+h.default.textify(e.extensions)+")",e.value={__class__:"RuntimeValue"}):e.fixed||(e.collapsible_value={__class__:"RuntimeValue"},e.is_workflow=e.options&&0===e.options.length||-1!=["integer","float"].indexOf(e.type)))}),h.default.deepeach(t.inputs,function(e){"conditional"===e.type&&(e.test_param.collapsible_value=void 0)}),l(e),a(e)}});t.default={Default:_,Tool:v}}).call(t,n(2),n(0))},function(e,t,n){"use strict";(function(e,i){function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(3),s=a(o),l=n(1),c=r(l),d=n(312),u=r(d),h=n(25),f=a(h),p=n(5),g=a(p),m=n(69),_=a(m),v=n(45),y=a(v);n(78);var b=e.Model.extend({is_visible:function(e,t){var n=e.getBoundingClientRect(),r=i("svg")[0].getBoundingClientRect();return!(n.right<0||n.left>r.right||n.bottom<0||n.top>r.bottom)}}),w={drawTicks:function(e,t,n,i,r){var a=e.append("g").selectAll("g").data(t).enter().append("g").selectAll("g").data(n).enter().append("g").attr("class","tick").attr("transform",function(e){return"rotate("+(180*e.angle/Math.PI-90)+")translate("+e.radius+",0)"}),o=[],s=[],l=function(e){return e.angle>Math.PI?"end":null};return r?(o=[0,0,0,-4],s=[4,0,"",".35em"],l=null):(o=[1,0,4,0],s=[0,4,".35em",""]),a.append("line").attr("x1",o[0]).attr("y1",o[1]).attr("x2",o[2]).attr("y1",o[3]).style("stroke","#000"),a.append("text").attr("x",s[0]).attr("y",s[1]).attr("dx",s[2]).attr("dy",s[3]).attr("text-anchor",l).attr("transform",i).text(function(e){return e.label})},formatNum:function(e,t){if(void 0===t&&(t=2),null===e)return null;var n=null;if(Math.abs(e)<1)n=e.toPrecision(t);else{var i=Math.round(e.toPrecision(t));e=Math.abs(e),e<1e3?n=i:e<1e6?n=Math.round((i/1e3).toPrecision(3)).toFixed(0)+"K":e<1e9&&(n=Math.round((i/1e6).toPrecision(3)).toFixed(0)+"M")}return n}},x=e.Model.extend({}),k=e.View.extend({className:"circster",initialize:function(e){this.genome=e.genome,this.label_arc_height=50,this.scale=1,this.circular_views=null,this.chords_views=null,this.model.get("drawables").on("add",this.add_track,this),this.model.get("drawables").on("remove",this.remove_track,this);var t=this.model.get("config");t.get("arc_dataset_height").on("change:value",this.update_track_bounds,this),t.get("track_gap").on("change:value",this.update_track_bounds,this)},get_circular_tracks:function(){return this.model.get("drawables").filter(function(e){return"DiagonalHeatmapTrack"!==e.get("track_type")})},get_chord_tracks:function(){return this.model.get("drawables").filter(function(e){return"DiagonalHeatmapTrack"===e.get("track_type")})},get_tracks_bounds:function(){var e=this.get_circular_tracks(),t=this.model.get("config").get_value("arc_dataset_height"),n=this.model.get("config").get_value("track_gap"),i=Math.min(this.$el.width(),this.$el.height())-20,r=i/2-e.length*(t+n)+n-this.label_arc_height,a=u.range(r,i/2,t+n);return c.map(a,function(e){return[e,e+t]})},render:function(){var e=this,t=e.$el.width(),n=e.$el.height(),i=this.get_circular_tracks(),r=this.get_chord_tracks(),a=e.model.get("config").get_value("total_gap"),o=this.get_tracks_bounds(),s=u.select(e.$el[0]).append("svg").attr("width",t).attr("height",n).attr("pointer-events","all").append("svg:g").call(u.behavior.zoom().on("zoom",function(){var t=d.event.scale;s.attr("transform","translate("+d.event.translate+") scale("+t+")"),e.scale!==t&&(e.zoom_drag_timeout&&clearTimeout(e.zoom_drag_timeout),e.zoom_drag_timeout=setTimeout(function(){},400))})).attr("transform","translate("+t/2+","+n/2+")").append("svg:g").attr("class","tracks");this.circular_views=i.map(function(t,n){var i=new T({el:s.append("g")[0],track:t,radius_bounds:o[n],genome:e.genome,total_gap:a});return i.render(),i}),this.chords_views=r.map(function(t){var n=new E({el:s.append("g")[0],track:t,radius_bounds:o[0],genome:e.genome,total_gap:a});return n.render(),n});var l=this.circular_views[this.circular_views.length-1].radius_bounds[1],c=[l,l+this.label_arc_height];this.label_track_view=new C({el:s.append("g")[0],track:new x,radius_bounds:c,genome:e.genome,total_gap:a}),this.label_track_view.render()},add_track:function(e){var t=this.model.get("config").get_value("total_gap");if("DiagonalHeatmapTrack"===e.get("track_type")){var n=this.circular_views[0].radius_bounds,i=new E({el:u.select("g.tracks").append("g")[0],track:e,radius_bounds:n,genome:this.genome,total_gap:t});i.render(),this.chords_views.push(i)}else{var r=this.get_tracks_bounds();c.each(this.circular_views,function(e,t){e.update_radius_bounds(r[t])}),c.each(this.chords_views,function(e){e.update_radius_bounds(r[0])});var a=this.circular_views.length,o=new T({el:u.select("g.tracks").append("g")[0],track:e,radius_bounds:r[a],genome:this.genome,total_gap:t});o.render(),this.circular_views.push(o)}},remove_track:function(e,t,n){var i=this.circular_views[n.index];this.circular_views.splice(n.index,1),i.$el.remove();var r=this.get_tracks_bounds();c.each(this.circular_views,function(e,t){e.update_radius_bounds(r[t])})},update_track_bounds:function(){var e=this.get_tracks_bounds();c.each(this.circular_views,function(t,n){t.update_radius_bounds(e[n])}),c.each(this.chords_views,function(t){t.update_radius_bounds(e[0])})}}),M=e.View.extend({tagName:"g",initialize:function(e){this.bg_stroke="#ddd",this.loading_bg_fill="#ffc",this.bg_fill="#ddd",this.total_gap=e.total_gap,this.track=e.track,this.radius_bounds=e.radius_bounds,this.genome=e.genome,this.chroms_layout=this._chroms_layout(),this.data_bounds=[],this.scale=1,this.parent_elt=u.select(this.$el[0])},get_fill_color:function(){var e=this.track.get("config").get_value("block_color");return e||(e=this.track.get("config").get_value("color")),e},render:function(){var e=this.parent_elt,t=this.chroms_layout,n=u.svg.arc().innerRadius(this.radius_bounds[0]).outerRadius(this.radius_bounds[1]),r=e.selectAll("g").data(t).enter().append("svg:g"),a=r.append("path").attr("d",n).attr("class","chrom-background").style("stroke",this.bg_stroke).style("fill",this.loading_bg_fill);a.append("title").text(function(e){return e.data.chrom});var o=this,s=o.track.get("data_manager"),l=!s||s.data_is_ready();i.when(l).then(function(){i.when(o._render_data(e)).then(function(){a.style("fill",o.bg_fill),o.render_labels()})})},render_labels:function(){},update_radius_bounds:function(e){this.radius_bounds=e;var t=u.svg.arc().innerRadius(this.radius_bounds[0]).outerRadius(this.radius_bounds[1]);this.parent_elt.selectAll("g>path.chrom-background").transition().duration(1e3).attr("d",t),this._transition_chrom_data(),this._transition_labels()},update_scale:function(e){var t=this.scale;if(this.scale=e,!(e<=t)){var n=this,r=new b;return this.parent_elt.selectAll("path.chrom-data").filter(function(e,t){return r.is_visible(this)}).each(function(t,r){var a,o=u.select(this),s=o.attr("chrom"),l=n.genome.get_chrom_region(s),d=n.track.get("data_manager");d.can_get_more_detailed_data(l)&&(a=n.track.get("data_manager").get_more_detailed_data(l,"Coverage",0,e),i.when(a).then(function(e){o.remove(),n._update_data_bounds();var t=c.find(n.chroms_layout,function(e){return e.data.chrom===s}),i=n.get_fill_color();n._render_chrom_data(n.parent_elt,t,e).style("stroke",i).style("fill",i)}))}),n}},_transition_chrom_data:function(){var e=this.track,t=this.chroms_layout,n=this.parent_elt.selectAll("g>path.chrom-data");if(n[0].length>0){var r=this;i.when(e.get("data_manager").get_genome_wide_data(this.genome)).then(function(i){var a=c.reject(c.map(i,function(e,n){var i=null,a=r._get_path_function(t[n],e);return a&&(i=a(e.data)),i}),function(e){return null===e}),o=e.get("config").get_value("color");n.each(function(e,t){u.select(this).transition().duration(1e3).style("stroke",o).style("fill",o).attr("d",a[t])})})}},_transition_labels:function(){},_update_data_bounds:function(e){this.data_bounds=e||this.get_data_bounds(this.track.get("data_manager").get_genome_wide_data(this.genome)),this._transition_chrom_data()},_render_data:function(e){var t=this,n=this.chroms_layout,r=this.track,a=i.Deferred();return i.when(r.get("data_manager").get_genome_wide_data(this.genome)).then(function(i){t.data_bounds=t.get_data_bounds(i),r.get("config").set_value("min_value",t.data_bounds[0],{silent:!0}),r.get("config").set_value("max_value",t.data_bounds[1],{silent:!0});var o=c.zip(n,i);c.each(o,function(n){var i=n[0],r=n[1];return t._render_chrom_data(e,i,r)});var s=t.get_fill_color();t.parent_elt.selectAll("path.chrom-data").style("stroke",s).style("fill",s),a.resolve(e)}),a},_render_chrom_data:function(e,t,n){},_get_path_function:function(e,t){},_chroms_layout:function(){var e=this.genome.get_chroms_info(),t=u.layout.pie().value(function(e){return e.len}).sort(null),n=t(e),i=2*Math.PI*this.total_gap/e.length;return c.map(n,function(e,t){var n=e.endAngle-i;return e.endAngle=n>e.startAngle?n:e.startAngle,e})}}),C=M.extend({initialize:function(e){M.prototype.initialize.call(this,e),this.innerRadius=this.radius_bounds[0],this.radius_bounds[0]=this.radius_bounds[1],this.bg_stroke="#fff",this.bg_fill="#fff",this.min_arc_len=.05},_render_data:function(e){var t=this,n=e.selectAll("g");n.selectAll("path").attr("id",function(e){return"label-"+e.data.chrom}),n.append("svg:text").filter(function(e){return e.endAngle-e.startAngle>t.min_arc_len}).attr("text-anchor","middle").append("svg:textPath").attr("class","chrom-label").attr("xlink:href",function(e){return"#label-"+e.data.chrom}).attr("startOffset","25%").text(function(e){return e.data.chrom});var i=function(e){var n=(e.endAngle-e.startAngle)/e.value,i=u.range(0,e.value,25e6).map(function(i,r){return{radius:t.innerRadius,angle:i*n+e.startAngle,label:0===r?0:r%3?null:t.formatNum(i)}});return i.length<4&&(i[i.length-1].label=t.formatNum(Math.round((i[i.length-1].angle-e.startAngle)/n))),i},r=function(e){return e.angle>Math.PI?"rotate(180)translate(-16)":null},a=c.filter(this.chroms_layout,function(e){return e.endAngle-e.startAngle>t.min_arc_len});this.drawTicks(this.parent_elt,a,i,r)}});c.extend(C.prototype,w);var S=M.extend({initialize:function(e){M.prototype.initialize.call(this,e);var t=this.track.get("config");t.get("min_value").on("change:value",this._update_min_max,this),t.get("max_value").on("change:value",this._update_min_max,this),t.get("color").on("change:value",this._transition_chrom_data,this)},_update_min_max:function(){var e=this.track.get("config"),t=[e.get_value("min_value"),e.get_value("max_value")];this._update_data_bounds(t),this.parent_elt.selectAll(".min_max").text(function(e,n){return t[n]})},_quantile:function(e,t){return e.sort(u.ascending),u.quantile(e,t)},_render_chrom_data:function(e,t,n){var i=this._get_path_function(t,n);return i?e.datum(n.data).append("path").attr("class","chrom-data").attr("chrom",t.data.chrom).attr("d",i):null},_get_path_function:function(e,t){if("string"==typeof t||!t.data||0===t.data.length)return null;var n=u.scale.linear().domain(this.data_bounds).range(this.radius_bounds).clamp(!0),i=u.scale.linear().domain([0,t.data.length]).range([e.startAngle,e.endAngle]),r=u.svg.line.radial().interpolate("linear").radius(function(e){return n(e[1])}).angle(function(e,t){return i(t)});return u.svg.area.radial().interpolate(r.interpolate()).innerRadius(n(0)).outerRadius(r.radius()).angle(r.angle())},render_labels:function(){var e=this,t=function(){return"rotate(90)"},n=this.drawTicks(this.parent_elt,[this.chroms_layout[0]],this._data_bounds_ticks_fn(),t,!0).classed("min_max",!0);c.each(n,function(t){i(t).click(function(){new _.default.ConfigSettingCollectionView({collection:e.track.get("config")}).render_in_modal("Configure Track")})})},_transition_labels:function(){if(0!==this.data_bounds.length){var e=this,t=c.filter(this.chroms_layout,function(e){return e.endAngle-e.startAngle>.08}),n=c.filter(t,function(e,t){return t%3==0}),i=c.flatten(c.map(n,function(t){return e._data_bounds_ticks_fn()(t)}));this.parent_elt.selectAll("g.tick").data(i).transition().attr("transform",function(e){return"rotate("+(180*e.angle/Math.PI-90)+")translate("+e.radius+",0)"})}},_data_bounds_ticks_fn:function(){var e=this;return function(t){return[{radius:e.radius_bounds[0],angle:t.startAngle,label:e.formatNum(e.data_bounds[0])},{radius:e.radius_bounds[1],angle:t.startAngle,label:e.formatNum(e.data_bounds[1])}]}},get_data_bounds:function(e){}});c.extend(S.prototype,w);var T=S.extend({get_data_bounds:function(e){var t=c.flatten(c.map(e,function(e){return e?c.map(e.data,function(e){return parseInt(e[1],10)||0}):0}));return[c.min(t),this._quantile(t,.98)||c.max(t)]}}),E=M.extend({render:function(){var e=this;i.when(e.track.get("data_manager").data_is_ready()).then(function(){i.when(e.track.get("data_manager").get_genome_wide_data(e.genome)).then(function(t){var n=[],i=e.genome.get_chroms_info();c.each(t,function(t,r){var a=i[r].chrom,o=c.map(t.data,function(t){var n=e._get_region_angle(a,t[1]),i=e._get_region_angle(t[3],t[4]);return{source:{startAngle:n,endAngle:n+.01},target:{startAngle:i,endAngle:i+.01}}});n=n.concat(o)}),e.parent_elt.append("g").attr("class","chord").selectAll("path").data(n).enter().append("path").style("fill",e.get_fill_color()).attr("d",u.svg.chord().radius(e.radius_bounds[0])).style("opacity",1)})})},update_radius_bounds:function(e){this.radius_bounds=e,this.parent_elt.selectAll("path").transition().attr("d",u.svg.chord().radius(this.radius_bounds[0]))},_get_region_angle:function(e,t){var n=c.find(this.chroms_layout,function(t){return t.data.chrom===e});return n.endAngle-(n.endAngle-n.startAngle)*(n.data.len-t)/n.data.len}}),j=e.View.extend({initialize:function(){g.default.cssLoadFile("static/style/circster.css");var e=new f.default.Genome(window.galaxy_config.app.genome),t=new f.default.GenomeVisualization(window.galaxy_config.app.viz_config);t.get("config").add([{key:"arc_dataset_height",label:"Arc Dataset Height",type:"int",value:25,view:"circster"},{key:"track_gap",label:"Gap Between Tracks",type:"int",value:5,view:"circster"},{key:"total_gap",label:"Gap [0-1]",type:"float",value:.4,view:"circster",hidden:!0}]),new k({el:i("#center .unified-panel-body"),genome:e,model:t}).render(),i("#center .unified-panel-header-inner").append(window.galaxy_config.app.viz_config.title+" "+window.galaxy_config.app.viz_config.dbkey);var n=y.default.create_icon_buttons_menu([{icon_class:"plus-button",title:(0,s.default)("Add tracks"),on_click:function(){f.default.select_datasets({dbkey:t.get("dbkey")},function(e){t.add_tracks(e)})}},{icon_class:"gear",title:(0,s.default)("Settings"),on_click:function(){new _.default.ConfigSettingCollectionView({collection:t.get("config")}).render_in_modal("Configure Visualization")}},{icon_class:"disk--arrow",title:(0,s.default)("Save"),on_click:function(){Galaxy.modal.show({title:(0,s.default)("Saving..."),body:"progress"}),i.ajax({url:Galaxy.root+"visualization/save",type:"POST",dataType:"json",data:{id:t.get("vis_id"),title:t.get("title"),dbkey:t.get("dbkey"),type:"trackster",vis_json:JSON.stringify(t)}}).success(function(e){Galaxy.modal.hide(),t.set("vis_id",e.vis_id)}).error(function(){Galaxy.modal.show({title:(0,s.default)("Could Not Save"),body:"Could not save visualization. Please try again later.",buttons:{Cancel:function(){Galaxy.modal.hide()}}})})}},{icon_class:"cross-circle",title:(0,s.default)("Close"),on_click:function(){window.location=Galaxy.root+"visualizations/list"}}],{tooltip_config:{placement:"bottom"}});n.$el.attr("style","float: right"),i("#center .unified-panel-header-inner").append(n.$el),i(".menu-button").tooltip({placement:"bottom"})}});t.default={GalaxyApp:j}}).call(t,n(2),n(0))},function(e,t,n){var i,r;!function(){function a(e){return e&&(e.ownerDocument||e.document||e).documentElement}function o(e){return e&&(e.ownerDocument&&e.ownerDocument.defaultView||e.document&&e||e.defaultView)}function s(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function l(e){return null===e?NaN:+e}function c(e){return!isNaN(e)}function d(e){return{left:function(t,n,i,r){for(arguments.length<3&&(i=0),arguments.length<4&&(r=t.length);i<r;){var a=i+r>>>1;e(t[a],n)<0?i=a+1:r=a}return i},right:function(t,n,i,r){for(arguments.length<3&&(i=0),arguments.length<4&&(r=t.length);i<r;){var a=i+r>>>1;e(t[a],n)>0?r=a:i=a+1}return i}}}function u(e){return e.length}function h(e){for(var t=1;e*t%1;)t*=10;return t}function f(e,t){for(var n in t)Object.defineProperty(e.prototype,n,{value:t[n],enumerable:!1})}function p(){this._=Object.create(null)}function g(e){return(e+="")===Mo||e[0]===Co?Co+e:e}function m(e){return(e+="")[0]===Co?e.slice(1):e}function _(e){return g(e)in this._}function v(e){return(e=g(e))in this._&&delete this._[e]}function y(){var e=[];for(var t in this._)e.push(m(t));return e}function b(){var e=0;for(var t in this._)++e;return e}function w(){for(var e in this._)return!1;return!0}function x(){this._=Object.create(null)}function k(e){return e}function M(e,t,n){return function(){var i=n.apply(t,arguments);return i===t?e:i}}function C(e,t){if(t in e)return t;t=t.charAt(0).toUpperCase()+t.slice(1);for(var n=0,i=So.length;n<i;++n){var r=So[n]+t;if(r in e)return r}}function S(){}function T(){}function E(e){function t(){for(var t,i=n,r=-1,a=i.length;++r<a;)(t=i[r].on)&&t.apply(this,arguments);return e}var n=[],i=new p;return t.on=function(t,r){var a,o=i.get(t);return arguments.length<2?o&&o.on:(o&&(o.on=null,n=n.slice(0,a=n.indexOf(o)).concat(n.slice(a+1)),i.remove(t)),r&&n.push(i.set(t,{on:r})),e)},t}function j(){fo.event.preventDefault()}function A(){for(var e,t=fo.event;e=t.sourceEvent;)t=e;return t}function N(e){for(var t=new T,n=0,i=arguments.length;++n<i;)t[arguments[n]]=E(t);return t.of=function(n,i){return function(r){try{var a=r.sourceEvent=fo.event;r.target=e,fo.event=r,t[r.type].apply(n,i)}finally{fo.event=a}}},t}function L(e){return Eo(e,Lo),e}function I(e){return"function"==typeof e?e:function(){return jo(e,this)}}function D(e){return"function"==typeof e?e:function(){return Ao(e,this)}}function O(e,t){function n(){this.removeAttribute(e)}function i(){this.removeAttributeNS(e.space,e.local)}function r(){this.setAttribute(e,t)}function a(){this.setAttributeNS(e.space,e.local,t)}function o(){var n=t.apply(this,arguments);null==n?this.removeAttribute(e):this.setAttribute(e,n)}function s(){var n=t.apply(this,arguments);null==n?this.removeAttributeNS(e.space,e.local):this.setAttributeNS(e.space,e.local,n)}return e=fo.ns.qualify(e),null==t?e.local?i:n:"function"==typeof t?e.local?s:o:e.local?a:r}function P(e){return e.trim().replace(/\s+/g," ")}function W(e){return new RegExp("(?:^|\\s+)"+fo.requote(e)+"(?:\\s+|$)","g")}function R(e){return(e+"").trim().split(/^|\s+/)}function $(e,t){function n(){for(var n=-1;++n<r;)e[n](this,t)}function i(){for(var n=-1,i=t.apply(this,arguments);++n<r;)e[n](this,i)}e=R(e).map(z);var r=e.length;return"function"==typeof t?i:n}function z(e){var t=W(e);return function(n,i){if(r=n.classList)return i?r.add(e):r.remove(e);var r=n.getAttribute("class")||"";i?(t.lastIndex=0,t.test(r)||n.setAttribute("class",P(r+" "+e))):n.setAttribute("class",P(r.replace(t," ")))}}function H(e,t,n){function i(){this.style.removeProperty(e)}function r(){this.style.setProperty(e,t,n)}function a(){var i=t.apply(this,arguments);null==i?this.style.removeProperty(e):this.style.setProperty(e,i,n)}return null==t?i:"function"==typeof t?a:r}function V(e,t){function n(){delete this[e]}function i(){this[e]=t}function r(){var n=t.apply(this,arguments);null==n?delete this[e]:this[e]=n}return null==t?n:"function"==typeof t?r:i}function Y(e){function t(){var t=this.ownerDocument,n=this.namespaceURI;return n===Io&&t.documentElement.namespaceURI===Io?t.createElement(e):t.createElementNS(n,e)}function n(){return this.ownerDocument.createElementNS(e.space,e.local)}return"function"==typeof e?e:(e=fo.ns.qualify(e)).local?n:t}function F(){var e=this.parentNode;e&&e.removeChild(this)}function G(e){return{__data__:e}}function U(e){return function(){return No(this,e)}}function q(e){return arguments.length||(e=s),function(t,n){return t&&n?e(t.__data__,n.__data__):!t-!n}}function B(e,t){for(var n=0,i=e.length;n<i;n++)for(var r,a=e[n],o=0,s=a.length;o<s;o++)(r=a[o])&&t(r,o,n);return e}function J(e){return Eo(e,Oo),e}function Q(e){var t,n;return function(i,r,a){var o,s=e[a].update,l=s.length;for(a!=n&&(n=a,t=0),r>=t&&(t=r+1);!(o=s[t])&&++t<l;);return o}}function X(e,t,n){function i(){var t=this[o];t&&(this.removeEventListener(e,t,t.$),delete this[o])}function r(){var r=l(t,go(arguments));i.call(this),this.addEventListener(e,this[o]=r,r.$=n),r._=t}function a(){var t,n=new RegExp("^__on([^.]+)"+fo.requote(e)+"$");for(var i in this)if(t=i.match(n)){var r=this[i];this.removeEventListener(t[1],r,r.$),delete this[i]}}var o="__on"+e,s=e.indexOf("."),l=K;s>0&&(e=e.slice(0,s));var c=Po.get(e);return c&&(e=c,l=Z),s?t?r:i:t?S:a}function K(e,t){return function(n){var i=fo.event;fo.event=n,t[0]=this.__data__;try{e.apply(this,t)}finally{fo.event=i}}}function Z(e,t){var n=K(e,t);return function(e){var t=this,i=e.relatedTarget;i&&(i===t||8&i.compareDocumentPosition(t))||n.call(t,e)}}function ee(e){var t=".dragsuppress-"+ ++Ro,n="click"+t,i=fo.select(o(e)).on("touchmove"+t,j).on("dragstart"+t,j).on("selectstart"+t,j);if(null==Wo&&(Wo=!("onselectstart"in e)&&C(e.style,"userSelect")),Wo){var r=a(e).style,s=r[Wo];r[Wo]="none"}return function(e){if(i.on(t,null),Wo&&(r[Wo]=s),e){var a=function(){i.on(n,null)};i.on(n,function(){j(),a()},!0),setTimeout(a,0)}}}function te(e,t){t.changedTouches&&(t=t.changedTouches[0]);var n=e.ownerSVGElement||e;if(n.createSVGPoint){var i=n.createSVGPoint();if($o<0){var r=o(e);if(r.scrollX||r.scrollY){n=fo.select("body").append("svg").style({position:"absolute",top:0,left:0,margin:0,padding:0,border:"none"},"important");var a=n[0][0].getScreenCTM();$o=!(a.f||a.e),n.remove()}}return $o?(i.x=t.pageX,i.y=t.pageY):(i.x=t.clientX,i.y=t.clientY),i=i.matrixTransform(e.getScreenCTM().inverse()),[i.x,i.y]}var s=e.getBoundingClientRect();return[t.clientX-s.left-e.clientLeft,t.clientY-s.top-e.clientTop]}function ne(){return fo.event.changedTouches[0].identifier}function ie(e){return e>0?1:e<0?-1:0}function re(e,t,n){return(t[0]-e[0])*(n[1]-e[1])-(t[1]-e[1])*(n[0]-e[0])}function ae(e){return e>1?0:e<-1?Vo:Math.acos(e)}function oe(e){return e>1?Go:e<-1?-Go:Math.asin(e)}function se(e){return((e=Math.exp(e))-1/e)/2}function le(e){return((e=Math.exp(e))+1/e)/2}function ce(e){return((e=Math.exp(2*e))-1)/(e+1)}function de(e){return(e=Math.sin(e/2))*e}function ue(){}function he(e,t,n){return this instanceof he?(this.h=+e,this.s=+t,void(this.l=+n)):arguments.length<2?e instanceof he?new he(e.h,e.s,e.l):Se(""+e,Te,he):new he(e,t,n)}function fe(e,t,n){function i(e){return e>360?e-=360:e<0&&(e+=360),e<60?a+(o-a)*e/60:e<180?o:e<240?a+(o-a)*(240-e)/60:a}function r(e){return Math.round(255*i(e))}var a,o;return e=isNaN(e)?0:(e%=360)<0?e+360:e,t=isNaN(t)?0:t<0?0:t>1?1:t,n=n<0?0:n>1?1:n,o=n<=.5?n*(1+t):n+t-n*t,a=2*n-o,new xe(r(e+120),r(e),r(e-120))}function pe(e,t,n){return this instanceof pe?(this.h=+e,this.c=+t,void(this.l=+n)):arguments.length<2?e instanceof pe?new pe(e.h,e.c,e.l):e instanceof me?ve(e.l,e.a,e.b):ve((e=Ee((e=fo.rgb(e)).r,e.g,e.b)).l,e.a,e.b):new pe(e,t,n)}function ge(e,t,n){return isNaN(e)&&(e=0),isNaN(t)&&(t=0),new me(n,Math.cos(e*=Uo)*t,Math.sin(e)*t)}function me(e,t,n){return this instanceof me?(this.l=+e,this.a=+t,void(this.b=+n)):arguments.length<2?e instanceof me?new me(e.l,e.a,e.b):e instanceof pe?ge(e.h,e.c,e.l):Ee((e=xe(e)).r,e.g,e.b):new me(e,t,n)}function _e(e,t,n){var i=(e+16)/116,r=i+t/500,a=i-n/200;return r=ye(r)*ts,i=ye(i)*ns,a=ye(a)*is,new xe(we(3.2404542*r-1.5371385*i-.4985314*a),we(-.969266*r+1.8760108*i+.041556*a),we(.0556434*r-.2040259*i+1.0572252*a))}function ve(e,t,n){return e>0?new pe(Math.atan2(n,t)*qo,Math.sqrt(t*t+n*n),e):new pe(NaN,NaN,e)}function ye(e){return e>.206893034?e*e*e:(e-4/29)/7.787037}function be(e){return e>.008856?Math.pow(e,1/3):7.787037*e+4/29}function we(e){return Math.round(255*(e<=.00304?12.92*e:1.055*Math.pow(e,1/2.4)-.055))}function xe(e,t,n){return this instanceof xe?(this.r=~~e,this.g=~~t,void(this.b=~~n)):arguments.length<2?e instanceof xe?new xe(e.r,e.g,e.b):Se(""+e,xe,fe):new xe(e,t,n)}function ke(e){return new xe(e>>16,e>>8&255,255&e)}function Me(e){return ke(e)+""}function Ce(e){return e<16?"0"+Math.max(0,e).toString(16):Math.min(255,e).toString(16)}function Se(e,t,n){var i,r,a,o=0,s=0,l=0;if(i=/([a-z]+)\((.*)\)/.exec(e=e.toLowerCase()))switch(r=i[2].split(","),i[1]){case"hsl":return n(parseFloat(r[0]),parseFloat(r[1])/100,parseFloat(r[2])/100);case"rgb":return t(Ae(r[0]),Ae(r[1]),Ae(r[2]))}return(a=os.get(e))?t(a.r,a.g,a.b):(null==e||"#"!==e.charAt(0)||isNaN(a=parseInt(e.slice(1),16))||(4===e.length?(o=(3840&a)>>4,o|=o>>4,s=240&a,s|=s>>4,l=15&a,l|=l<<4):7===e.length&&(o=(16711680&a)>>16,s=(65280&a)>>8,l=255&a)),t(o,s,l))}function Te(e,t,n){var i,r,a=Math.min(e/=255,t/=255,n/=255),o=Math.max(e,t,n),s=o-a,l=(o+a)/2;return s?(r=l<.5?s/(o+a):s/(2-o-a),i=e==o?(t-n)/s+(t<n?6:0):t==o?(n-e)/s+2:(e-t)/s+4,i*=60):(i=NaN,r=l>0&&l<1?0:i),new he(i,r,l)}function Ee(e,t,n){e=je(e),t=je(t),n=je(n);var i=be((.4124564*e+.3575761*t+.1804375*n)/ts),r=be((.2126729*e+.7151522*t+.072175*n)/ns);return me(116*r-16,500*(i-r),200*(r-be((.0193339*e+.119192*t+.9503041*n)/is)))}function je(e){return(e/=255)<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function Ae(e){var t=parseFloat(e);return"%"===e.charAt(e.length-1)?Math.round(2.55*t):t}function Ne(e){return"function"==typeof e?e:function(){return e}}function Le(e){return function(t,n,i){return 2===arguments.length&&"function"==typeof n&&(i=n,n=null),Ie(t,n,e,i)}}function Ie(e,t,n,i){function r(){var e,t=l.status;if(!t&&Oe(l)||t>=200&&t<300||304===t){try{e=n.call(a,l)}catch(e){return void o.error.call(a,e)}o.load.call(a,e)}else o.error.call(a,l)}var a={},o=fo.dispatch("beforesend","progress","load","error"),s={},l=new XMLHttpRequest,c=null;return!this.XDomainRequest||"withCredentials"in l||!/^(http(s)?:)?\/\//.test(e)||(l=new XDomainRequest),"onload"in l?l.onload=l.onerror=r:l.onreadystatechange=function(){l.readyState>3&&r()},l.onprogress=function(e){var t=fo.event;fo.event=e;try{o.progress.call(a,l)}finally{fo.event=t}},a.header=function(e,t){return e=(e+"").toLowerCase(),arguments.length<2?s[e]:(null==t?delete s[e]:s[e]=t+"",a)},a.mimeType=function(e){return arguments.length?(t=null==e?null:e+"",a):t},a.responseType=function(e){return arguments.length?(c=e,a):c},a.response=function(e){return n=e,a},["get","post"].forEach(function(e){a[e]=function(){return a.send.apply(a,[e].concat(go(arguments)))}}),a.send=function(n,i,r){if(2===arguments.length&&"function"==typeof i&&(r=i,i=null),l.open(n,e,!0),null==t||"accept"in s||(s.accept=t+",*/*"),l.setRequestHeader)for(var d in s)l.setRequestHeader(d,s[d]);return null!=t&&l.overrideMimeType&&l.overrideMimeType(t),null!=c&&(l.responseType=c),null!=r&&a.on("error",r).on("load",function(e){r(null,e)}),o.beforesend.call(a,l),l.send(null==i?null:i),a},a.abort=function(){return l.abort(),a},fo.rebind(a,o,"on"),null==i?a:a.get(De(i))}function De(e){return 1===e.length?function(t,n){e(null==t?n:null)}:e}function Oe(e){var t=e.responseType;return t&&"text"!==t?e.response:e.responseText}function Pe(e,t,n){var i=arguments.length;i<2&&(t=0),i<3&&(n=Date.now());var r=n+t,a={c:e,t:r,n:null};return ls?ls.n=a:ss=a,ls=a,cs||(ds=clearTimeout(ds),cs=1,us(We)),a}function We(){var e=Re(),t=$e()-e;t>24?(isFinite(t)&&(clearTimeout(ds),ds=setTimeout(We,t)),cs=0):(cs=1,us(We))}function Re(){for(var e=Date.now(),t=ss;t;)e>=t.t&&t.c(e-t.t)&&(t.c=null),t=t.n;return e}function $e(){for(var e,t=ss,n=1/0;t;)t.c?(t.t<n&&(n=t.t),t=(e=t).n):t=e?e.n=t.n:ss=t.n;return ls=e,n}function ze(e,t){return t-(e?Math.ceil(Math.log(e)/Math.LN10):1)}function He(e,t){var n=Math.pow(10,3*ko(8-t));return{scale:t>8?function(e){return e/n}:function(e){return e*n},symbol:e}}function Ve(e){var t=e.decimal,n=e.thousands,i=e.grouping,r=e.currency,a=i&&n?function(e,t){for(var r=e.length,a=[],o=0,s=i[0],l=0;r>0&&s>0&&(l+s+1>t&&(s=Math.max(1,t-l)),a.push(e.substring(r-=s,r+s)),!((l+=s+1)>t));)s=i[o=(o+1)%i.length];return a.reverse().join(n)}:k;return function(e){var n=fs.exec(e),i=n[1]||" ",o=n[2]||">",s=n[3]||"-",l=n[4]||"",c=n[5],d=+n[6],u=n[7],h=n[8],f=n[9],p=1,g="",m="",_=!1,v=!0;switch(h&&(h=+h.substring(1)),(c||"0"===i&&"="===o)&&(c=i="0",o="="),f){case"n":u=!0,f="g";break;case"%":p=100,m="%",f="f";break;case"p":p=100,m="%",f="r";break;case"b":case"o":case"x":case"X":"#"===l&&(g="0"+f.toLowerCase());case"c":v=!1;case"d":_=!0,h=0;break;case"s":p=-1,f="r"}"$"===l&&(g=r[0],m=r[1]),"r"!=f||h||(f="g"),null!=h&&("g"==f?h=Math.max(1,Math.min(21,h)):"e"!=f&&"f"!=f||(h=Math.max(0,Math.min(20,h)))),f=ps.get(f)||Ye;var y=c&&u;return function(e){var n=m;if(_&&e%1)return"";var r=e<0||0===e&&1/e<0?(e=-e,"-"):"-"===s?"":s;if(p<0){var l=fo.formatPrefix(e,h);e=l.scale(e),n=l.symbol+m}else e*=p;e=f(e,h);var b,w,x=e.lastIndexOf(".");if(x<0){var k=v?e.lastIndexOf("e"):-1;k<0?(b=e,w=""):(b=e.substring(0,k),w=e.substring(k))}else b=e.substring(0,x),w=t+e.substring(x+1);!c&&u&&(b=a(b,1/0));var M=g.length+b.length+w.length+(y?0:r.length),C=M<d?new Array(M=d-M+1).join(i):"";return y&&(b=a(C+b,C.length?d-w.length:1/0)),r+=g,e=b+w,("<"===o?r+e+C:">"===o?C+r+e:"^"===o?C.substring(0,M>>=1)+r+e+C.substring(M):r+(y?e:C+e))+n}}}function Ye(e){return e+""}function Fe(){this._=new Date(arguments.length>1?Date.UTC.apply(this,arguments):arguments[0])}function Ge(e,t,n){function i(t){var n=e(t),i=a(n,1);return t-n<i-t?n:i}function r(n){return t(n=e(new ms(n-1)),1),n}function a(e,n){return t(e=new ms(+e),n),e}function o(e,i,a){var o=r(e),s=[];if(a>1)for(;o<i;)n(o)%a||s.push(new Date(+o)),t(o,1);else for(;o<i;)s.push(new Date(+o)),t(o,1);return s}function s(e,t,n){try{ms=Fe;var i=new Fe;return i._=e,o(i,t,n)}finally{ms=Date}}e.floor=e,e.round=i,e.ceil=r,e.offset=a,e.range=o;var l=e.utc=Ue(e);return l.floor=l,l.round=Ue(i),l.ceil=Ue(r),l.offset=Ue(a),l.range=s,e}function Ue(e){return function(t,n){try{ms=Fe;var i=new Fe;return i._=t,e(i,n)._}finally{ms=Date}}}function qe(e){function t(e){function t(t){for(var n,r,a,o=[],s=-1,l=0;++s<i;)37===e.charCodeAt(s)&&(o.push(e.slice(l,s)),null!=(r=vs[n=e.charAt(++s)])&&(n=e.charAt(++s)),(a=E[n])&&(n=a(t,null==r?"e"===n?" ":"0":r)),o.push(n),l=s+1);return o.push(e.slice(l,s)),o.join("")}var i=e.length;return t.parse=function(t){var i={y:1900,m:0,d:1,H:0,M:0,S:0,L:0,Z:null};if(n(i,e,t,0)!=t.length)return null;"p"in i&&(i.H=i.H%12+12*i.p);var r=null!=i.Z&&ms!==Fe,a=new(r?Fe:ms);return"j"in i?a.setFullYear(i.y,0,i.j):"W"in i||"U"in i?("w"in i||(i.w="W"in i?1:0),a.setFullYear(i.y,0,1),a.setFullYear(i.y,0,"W"in i?(i.w+6)%7+7*i.W-(a.getDay()+5)%7:i.w+7*i.U-(a.getDay()+6)%7)):a.setFullYear(i.y,i.m,i.d),a.setHours(i.H+(i.Z/100|0),i.M+i.Z%100,i.S,i.L),r?a._:a},t.toString=function(){return e},t}function n(e,t,n,i){for(var r,a,o,s=0,l=t.length,c=n.length;s<l;){if(i>=c)return-1;if(37===(r=t.charCodeAt(s++))){if(o=t.charAt(s++),!(a=j[o in vs?t.charAt(s++):o])||(i=a(e,n,i))<0)return-1}else if(r!=n.charCodeAt(i++))return-1}return i}function i(e,t,n){x.lastIndex=0;var i=x.exec(t.slice(n));return i?(e.w=k.get(i[0].toLowerCase()),n+i[0].length):-1}function r(e,t,n){b.lastIndex=0;var i=b.exec(t.slice(n));return i?(e.w=w.get(i[0].toLowerCase()),n+i[0].length):-1}function a(e,t,n){S.lastIndex=0;var i=S.exec(t.slice(n));return i?(e.m=T.get(i[0].toLowerCase()),n+i[0].length):-1}function o(e,t,n){M.lastIndex=0;var i=M.exec(t.slice(n));return i?(e.m=C.get(i[0].toLowerCase()),n+i[0].length):-1}function s(e,t,i){return n(e,E.c.toString(),t,i)}function l(e,t,i){return n(e,E.x.toString(),t,i)}function c(e,t,i){return n(e,E.X.toString(),t,i)}function d(e,t,n){var i=y.get(t.slice(n,n+=2).toLowerCase());return null==i?-1:(e.p=i,n)}var u=e.dateTime,h=e.date,f=e.time,p=e.periods,g=e.days,m=e.shortDays,_=e.months,v=e.shortMonths;t.utc=function(e){function n(e){try{ms=Fe;var t=new ms;return t._=e,i(t)}finally{ms=Date}}var i=t(e);return n.parse=function(e){try{ms=Fe;var t=i.parse(e);return t&&t._}finally{ms=Date}},n.toString=i.toString,n},t.multi=t.utc.multi=ft;var y=fo.map(),b=Je(g),w=Qe(g),x=Je(m),k=Qe(m),M=Je(_),C=Qe(_),S=Je(v),T=Qe(v);p.forEach(function(e,t){y.set(e.toLowerCase(),t)});var E={a:function(e){return m[e.getDay()]},A:function(e){return g[e.getDay()]},b:function(e){return v[e.getMonth()]},B:function(e){return _[e.getMonth()]},c:t(u),d:function(e,t){return Be(e.getDate(),t,2)},e:function(e,t){return Be(e.getDate(),t,2)},H:function(e,t){return Be(e.getHours(),t,2)},I:function(e,t){return Be(e.getHours()%12||12,t,2)},j:function(e,t){return Be(1+gs.dayOfYear(e),t,3)},L:function(e,t){return Be(e.getMilliseconds(),t,3)},m:function(e,t){return Be(e.getMonth()+1,t,2)},M:function(e,t){return Be(e.getMinutes(),t,2)},p:function(e){return p[+(e.getHours()>=12)]},S:function(e,t){return Be(e.getSeconds(),t,2)},U:function(e,t){return Be(gs.sundayOfYear(e),t,2)},w:function(e){return e.getDay()},W:function(e,t){return Be(gs.mondayOfYear(e),t,2)},x:t(h),X:t(f),y:function(e,t){return Be(e.getFullYear()%100,t,2)},Y:function(e,t){return Be(e.getFullYear()%1e4,t,4)},Z:ut,"%":function(){return"%"}},j={a:i,A:r,b:a,B:o,c:s,d:at,e:at,H:st,I:st,j:ot,L:dt,m:rt,M:lt,p:d,S:ct,U:Ke,w:Xe,W:Ze,x:l,X:c,y:tt,Y:et,Z:nt,"%":ht};return t}function Be(e,t,n){var i=e<0?"-":"",r=(i?-e:e)+"",a=r.length;return i+(a<n?new Array(n-a+1).join(t)+r:r)}function Je(e){return new RegExp("^(?:"+e.map(fo.requote).join("|")+")","i")}function Qe(e){for(var t=new p,n=-1,i=e.length;++n<i;)t.set(e[n].toLowerCase(),n);return t}function Xe(e,t,n){ys.lastIndex=0;var i=ys.exec(t.slice(n,n+1));return i?(e.w=+i[0],n+i[0].length):-1}function Ke(e,t,n){ys.lastIndex=0;var i=ys.exec(t.slice(n));return i?(e.U=+i[0],n+i[0].length):-1}function Ze(e,t,n){ys.lastIndex=0;var i=ys.exec(t.slice(n));return i?(e.W=+i[0],n+i[0].length):-1}function et(e,t,n){ys.lastIndex=0;var i=ys.exec(t.slice(n,n+4));return i?(e.y=+i[0],n+i[0].length):-1}function tt(e,t,n){ys.lastIndex=0;var i=ys.exec(t.slice(n,n+2));return i?(e.y=it(+i[0]),n+i[0].length):-1}function nt(e,t,n){return/^[+-]\d{4}$/.test(t=t.slice(n,n+5))?(e.Z=-t,n+5):-1}function it(e){return e+(e>68?1900:2e3)}function rt(e,t,n){ys.lastIndex=0;var i=ys.exec(t.slice(n,n+2));return i?(e.m=i[0]-1,n+i[0].length):-1}function at(e,t,n){ys.lastIndex=0;var i=ys.exec(t.slice(n,n+2));return i?(e.d=+i[0],n+i[0].length):-1}function ot(e,t,n){ys.lastIndex=0;var i=ys.exec(t.slice(n,n+3));return i?(e.j=+i[0],n+i[0].length):-1}function st(e,t,n){ys.lastIndex=0;var i=ys.exec(t.slice(n,n+2));return i?(e.H=+i[0],n+i[0].length):-1}function lt(e,t,n){ys.lastIndex=0;var i=ys.exec(t.slice(n,n+2));return i?(e.M=+i[0],n+i[0].length):-1}function ct(e,t,n){ys.lastIndex=0;var i=ys.exec(t.slice(n,n+2));return i?(e.S=+i[0],n+i[0].length):-1}function dt(e,t,n){ys.lastIndex=0;var i=ys.exec(t.slice(n,n+3));return i?(e.L=+i[0],n+i[0].length):-1}function ut(e){var t=e.getTimezoneOffset(),n=t>0?"-":"+",i=ko(t)/60|0,r=ko(t)%60;return n+Be(i,"0",2)+Be(r,"0",2)}function ht(e,t,n){bs.lastIndex=0;var i=bs.exec(t.slice(n,n+1));return i?n+i[0].length:-1}function ft(e){for(var t=e.length,n=-1;++n<t;)e[n][0]=this(e[n][0]);return function(t){for(var n=0,i=e[n];!i[1](t);)i=e[++n];return i[0](t)}}function pt(){}function gt(e,t,n){var i=n.s=e+t,r=i-e,a=i-r;n.t=e-a+(t-r)}function mt(e,t){e&&Ms.hasOwnProperty(e.type)&&Ms[e.type](e,t)}function _t(e,t,n){var i,r=-1,a=e.length-n;for(t.lineStart();++r<a;)i=e[r],t.point(i[0],i[1],i[2]);t.lineEnd()}function vt(e,t){var n=-1,i=e.length;for(t.polygonStart();++n<i;)_t(e[n],t,1);t.polygonEnd()}function yt(){function e(e,t){e*=Uo,t=t*Uo/2+Vo/4;var n=e-i,o=n>=0?1:-1,s=o*n,l=Math.cos(t),c=Math.sin(t),d=a*c,u=r*l+d*Math.cos(s),h=d*o*Math.sin(s);Ss.add(Math.atan2(h,u)),i=e,r=l,a=c}var t,n,i,r,a;Ts.point=function(o,s){Ts.point=e,i=(t=o)*Uo,r=Math.cos(s=(n=s)*Uo/2+Vo/4),a=Math.sin(s)},Ts.lineEnd=function(){e(t,n)}}function bt(e){var t=e[0],n=e[1],i=Math.cos(n);return[i*Math.cos(t),i*Math.sin(t),Math.sin(n)]}function wt(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function xt(e,t){return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]}function kt(e,t){e[0]+=t[0],e[1]+=t[1],e[2]+=t[2]}function Mt(e,t){return[e[0]*t,e[1]*t,e[2]*t]}function Ct(e){var t=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]/=t,e[1]/=t,e[2]/=t}function St(e){return[Math.atan2(e[1],e[0]),oe(e[2])]}function Tt(e,t){return ko(e[0]-t[0])<zo&&ko(e[1]-t[1])<zo}function Et(e,t){e*=Uo;var n=Math.cos(t*=Uo);jt(n*Math.cos(e),n*Math.sin(e),Math.sin(t))}function jt(e,t,n){++Es,As+=(e-As)/Es,Ns+=(t-Ns)/Es,Ls+=(n-Ls)/Es}function At(){function e(e,r){e*=Uo;var a=Math.cos(r*=Uo),o=a*Math.cos(e),s=a*Math.sin(e),l=Math.sin(r),c=Math.atan2(Math.sqrt((c=n*l-i*s)*c+(c=i*o-t*l)*c+(c=t*s-n*o)*c),t*o+n*s+i*l);js+=c,Is+=c*(t+(t=o)),Ds+=c*(n+(n=s)),Os+=c*(i+(i=l)),jt(t,n,i)}var t,n,i;$s.point=function(r,a){r*=Uo;var o=Math.cos(a*=Uo);t=o*Math.cos(r),n=o*Math.sin(r),i=Math.sin(a),$s.point=e,jt(t,n,i)}}function Nt(){$s.point=Et}function Lt(){function e(e,t){e*=Uo;var n=Math.cos(t*=Uo),o=n*Math.cos(e),s=n*Math.sin(e),l=Math.sin(t),c=r*l-a*s,d=a*o-i*l,u=i*s-r*o,h=Math.sqrt(c*c+d*d+u*u),f=i*o+r*s+a*l,p=h&&-ae(f)/h,g=Math.atan2(h,f);Ps+=p*c,Ws+=p*d,Rs+=p*u,js+=g,Is+=g*(i+(i=o)),Ds+=g*(r+(r=s)),Os+=g*(a+(a=l)),jt(i,r,a)}var t,n,i,r,a;$s.point=function(o,s){t=o,n=s,$s.point=e,o*=Uo;var l=Math.cos(s*=Uo);i=l*Math.cos(o),r=l*Math.sin(o),a=Math.sin(s),jt(i,r,a)},$s.lineEnd=function(){e(t,n),$s.lineEnd=Nt,$s.point=Et}}function It(e,t){function n(n,i){return n=e(n,i),t(n[0],n[1])}return e.invert&&t.invert&&(n.invert=function(n,i){return(n=t.invert(n,i))&&e.invert(n[0],n[1])}),n}function Dt(){return!0}function Ot(e,t,n,i,r){var a=[],o=[];if(e.forEach(function(e){if(!((t=e.length-1)<=0)){var t,n=e[0],i=e[t];if(Tt(n,i)){r.lineStart();for(var s=0;s<t;++s)r.point((n=e[s])[0],n[1]);return void r.lineEnd()}var l=new Wt(n,e,null,!0),c=new Wt(n,null,l,!1);l.o=c,a.push(l),o.push(c),l=new Wt(i,e,null,!1),c=new Wt(i,null,l,!0),l.o=c,a.push(l),o.push(c)}}),o.sort(t),Pt(a),Pt(o),a.length){for(var s=0,l=n,c=o.length;s<c;++s)o[s].e=l=!l;for(var d,u,h=a[0];;){for(var f=h,p=!0;f.v;)if((f=f.n)===h)return;d=f.z,r.lineStart();do{if(f.v=f.o.v=!0,f.e){if(p)for(var s=0,c=d.length;s<c;++s)r.point((u=d[s])[0],u[1]);else i(f.x,f.n.x,1,r);f=f.n}else{if(p){d=f.p.z;for(var s=d.length-1;s>=0;--s)r.point((u=d[s])[0],u[1])}else i(f.x,f.p.x,-1,r);f=f.p}f=f.o,d=f.z,p=!p}while(!f.v);r.lineEnd()}}}function Pt(e){if(t=e.length){for(var t,n,i=0,r=e[0];++i<t;)r.n=n=e[i],n.p=r,r=n;r.n=n=e[0],n.p=r}}function Wt(e,t,n,i){this.x=e,this.z=t,this.o=n,this.e=i,this.v=!1,this.n=this.p=null}function Rt(e,t,n,i){return function(r,a){function o(t,n){var i=r(t,n);e(t=i[0],n=i[1])&&a.point(t,n)}function s(e,t){var n=r(e,t);m.point(n[0],n[1])}function l(){v.point=s,m.lineStart()}function c(){v.point=o,m.lineEnd()}function d(e,t){g.push([e,t]);var n=r(e,t);b.point(n[0],n[1])}function u(){b.lineStart(),g=[]}function h(){d(g[0][0],g[0][1]),b.lineEnd();var e,t=b.clean(),n=y.buffer(),i=n.length;if(g.pop(),p.push(g),g=null,i)if(1&t){e=n[0];var r,i=e.length-1,o=-1;if(i>0){for(w||(a.polygonStart(),w=!0),a.lineStart();++o<i;)a.point((r=e[o])[0],r[1]);a.lineEnd()}}else i>1&&2&t&&n.push(n.pop().concat(n.shift())),f.push(n.filter($t))}var f,p,g,m=t(a),_=r.invert(i[0],i[1]),v={point:o,lineStart:l,lineEnd:c,polygonStart:function(){v.point=d,v.lineStart=u,v.lineEnd=h,f=[],p=[]},polygonEnd:function(){v.point=o,v.lineStart=l,v.lineEnd=c,f=fo.merge(f);var e=Gt(_,p);f.length?(w||(a.polygonStart(),w=!0),Ot(f,Ht,e,n,a)):e&&(w||(a.polygonStart(),w=!0),a.lineStart(),n(null,null,1,a),a.lineEnd()),w&&(a.polygonEnd(),w=!1),f=p=null},sphere:function(){a.polygonStart(),a.lineStart(),n(null,null,1,a),a.lineEnd(),a.polygonEnd()}},y=zt(),b=t(y),w=!1;return v}}function $t(e){return e.length>1}function zt(){var e,t=[];return{lineStart:function(){t.push(e=[])},point:function(t,n){e.push([t,n])},lineEnd:S,buffer:function(){var n=t;return t=[],e=null,n},rejoin:function(){t.length>1&&t.push(t.pop().concat(t.shift()))}}}function Ht(e,t){return((e=e.x)[0]<0?e[1]-Go-zo:Go-e[1])-((t=t.x)[0]<0?t[1]-Go-zo:Go-t[1])}function Vt(e){var t,n=NaN,i=NaN,r=NaN;return{lineStart:function(){e.lineStart(),t=1},point:function(a,o){var s=a>0?Vo:-Vo,l=ko(a-n);ko(l-Vo)<zo?(e.point(n,i=(i+o)/2>0?Go:-Go),e.point(r,i),e.lineEnd(),e.lineStart(),e.point(s,i),e.point(a,i),t=0):r!==s&&l>=Vo&&(ko(n-r)<zo&&(n-=r*zo),ko(a-s)<zo&&(a-=s*zo),i=Yt(n,i,a,o),e.point(r,i),e.lineEnd(),e.lineStart(),e.point(s,i),t=0),e.point(n=a,i=o),r=s},lineEnd:function(){e.lineEnd(),n=i=NaN},clean:function(){return 2-t}}}function Yt(e,t,n,i){var r,a,o=Math.sin(e-n);return ko(o)>zo?Math.atan((Math.sin(t)*(a=Math.cos(i))*Math.sin(n)-Math.sin(i)*(r=Math.cos(t))*Math.sin(e))/(r*a*o)):(t+i)/2}function Ft(e,t,n,i){var r;if(null==e)r=n*Go,i.point(-Vo,r),i.point(0,r),i.point(Vo,r),i.point(Vo,0),i.point(Vo,-r),i.point(0,-r),i.point(-Vo,-r),i.point(-Vo,0),i.point(-Vo,r);else if(ko(e[0]-t[0])>zo){var a=e[0]<t[0]?Vo:-Vo;r=n*a/2,i.point(-a,r),i.point(0,r),i.point(a,r)}else i.point(t[0],t[1])}function Gt(e,t){var n=e[0],i=e[1],r=[Math.sin(n),-Math.cos(n),0],a=0,o=0;Ss.reset();for(var s=0,l=t.length;s<l;++s){var c=t[s],d=c.length;if(d)for(var u=c[0],h=u[0],f=u[1]/2+Vo/4,p=Math.sin(f),g=Math.cos(f),m=1;;){m===d&&(m=0),e=c[m];var _=e[0],v=e[1]/2+Vo/4,y=Math.sin(v),b=Math.cos(v),w=_-h,x=w>=0?1:-1,k=x*w,M=k>Vo,C=p*y;if(Ss.add(Math.atan2(C*x*Math.sin(k),g*b+C*Math.cos(k))),a+=M?w+x*Yo:w,M^h>=n^_>=n){var S=xt(bt(u),bt(e));Ct(S);var T=xt(r,S);Ct(T);var E=(M^w>=0?-1:1)*oe(T[2]);(i>E||i===E&&(S[0]||S[1]))&&(o+=M^w>=0?1:-1)}if(!m++)break;h=_,p=y,g=b,u=e}}return(a<-zo||a<zo&&Ss<-zo)^1&o}function Ut(e){function t(e,t){return Math.cos(e)*Math.cos(t)>a}function n(e){var n,a,l,c,d;return{lineStart:function(){c=l=!1,d=1},point:function(u,h){var f,p=[u,h],g=t(u,h),m=o?g?0:r(u,h):g?r(u+(u<0?Vo:-Vo),h):0;if(!n&&(c=l=g)&&e.lineStart(),g!==l&&(f=i(n,p),(Tt(n,f)||Tt(p,f))&&(p[0]+=zo,p[1]+=zo,g=t(p[0],p[1]))),g!==l)d=0,g?(e.lineStart(),f=i(p,n),e.point(f[0],f[1])):(f=i(n,p),e.point(f[0],f[1]),e.lineEnd()),n=f;else if(s&&n&&o^g){var _;m&a||!(_=i(p,n,!0))||(d=0,o?(e.lineStart(),e.point(_[0][0],_[0][1]),e.point(_[1][0],_[1][1]),e.lineEnd()):(e.point(_[1][0],_[1][1]),e.lineEnd(),e.lineStart(),e.point(_[0][0],_[0][1])))}!g||n&&Tt(n,p)||e.point(p[0],p[1]),n=p,l=g,a=m},lineEnd:function(){l&&e.lineEnd(),n=null},clean:function(){return d|(c&&l)<<1}}}function i(e,t,n){var i=bt(e),r=bt(t),o=[1,0,0],s=xt(i,r),l=wt(s,s),c=s[0],d=l-c*c;if(!d)return!n&&e;var u=a*l/d,h=-a*c/d,f=xt(o,s),p=Mt(o,u);kt(p,Mt(s,h));var g=f,m=wt(p,g),_=wt(g,g),v=m*m-_*(wt(p,p)-1);if(!(v<0)){var y=Math.sqrt(v),b=Mt(g,(-m-y)/_);if(kt(b,p),b=St(b),!n)return b;var w,x=e[0],k=t[0],M=e[1],C=t[1];k<x&&(w=x,x=k,k=w);var S=k-x,T=ko(S-Vo)<zo,E=T||S<zo;if(!T&&C<M&&(w=M,M=C,C=w),E?T?M+C>0^b[1]<(ko(b[0]-x)<zo?M:C):M<=b[1]&&b[1]<=C:S>Vo^(x<=b[0]&&b[0]<=k)){var j=Mt(g,(-m+y)/_);return kt(j,p),[b,St(j)]}}}function r(t,n){var i=o?e:Vo-e,r=0;return t<-i?r|=1:t>i&&(r|=2),n<-i?r|=4:n>i&&(r|=8),r}var a=Math.cos(e),o=a>0,s=ko(a)>zo;return Rt(t,n,bn(e,6*Uo),o?[0,-e]:[-Vo,e-Vo])}function qt(e,t,n,i){return function(r){var a,o=r.a,s=r.b,l=o.x,c=o.y,d=s.x,u=s.y,h=0,f=1,p=d-l,g=u-c;if(a=e-l,p||!(a>0)){if(a/=p,p<0){if(a<h)return;a<f&&(f=a)}else if(p>0){if(a>f)return;a>h&&(h=a)}if(a=n-l,p||!(a<0)){if(a/=p,p<0){if(a>f)return;a>h&&(h=a)}else if(p>0){if(a<h)return;a<f&&(f=a)}if(a=t-c,g||!(a>0)){if(a/=g,g<0){if(a<h)return;a<f&&(f=a)}else if(g>0){if(a>f)return;a>h&&(h=a)}if(a=i-c,g||!(a<0)){if(a/=g,g<0){if(a>f)return;a>h&&(h=a)}else if(g>0){if(a<h)return;a<f&&(f=a)}return h>0&&(r.a={x:l+h*p,y:c+h*g}),f<1&&(r.b={x:l+f*p,y:c+f*g}),r}}}}}}function Bt(e,t,n,i){function r(i,r){return ko(i[0]-e)<zo?r>0?0:3:ko(i[0]-n)<zo?r>0?2:1:ko(i[1]-t)<zo?r>0?1:0:r>0?3:2}function a(e,t){return o(e.x,t.x)}function o(e,t){var n=r(e,1),i=r(t,1);return n!==i?n-i:0===n?t[1]-e[1]:1===n?e[0]-t[0]:2===n?e[1]-t[1]:t[0]-e[0]}return function(s){function l(e){for(var t=0,n=m.length,i=e[1],r=0;r<n;++r)for(var a,o=1,s=m[r],l=s.length,c=s[0];o<l;++o)a=s[o],c[1]<=i?a[1]>i&&re(c,a,e)>0&&++t:a[1]<=i&&re(c,a,e)<0&&--t,c=a;return 0!==t}function c(a,s,l,c){var d=0,u=0;if(null==a||(d=r(a,l))!==(u=r(s,l))||o(a,s)<0^l>0)do{c.point(0===d||3===d?e:n,d>1?i:t)}while((d=(d+l+4)%4)!==u);else c.point(s[0],s[1])}function d(r,a){return e<=r&&r<=n&&t<=a&&a<=i}function u(e,t){d(e,t)&&s.point(e,t)}function h(){j.point=p,m&&m.push(_=[]),M=!0,k=!1,w=x=NaN}function f(){g&&(p(v,y),b&&k&&T.rejoin(),g.push(T.buffer())),j.point=u,k&&s.lineEnd()}function p(e,t){e=Math.max(-Hs,Math.min(Hs,e)),t=Math.max(-Hs,Math.min(Hs,t));var n=d(e,t);if(m&&_.push([e,t]),M)v=e,y=t,b=n,M=!1,n&&(s.lineStart(),s.point(e,t));else if(n&&k)s.point(e,t);else{var i={a:{x:w,y:x},b:{x:e,y:t}};E(i)?(k||(s.lineStart(),s.point(i.a.x,i.a.y)),s.point(i.b.x,i.b.y),n||s.lineEnd(),C=!1):n&&(s.lineStart(),s.point(e,t),C=!1)}w=e,x=t,k=n}var g,m,_,v,y,b,w,x,k,M,C,S=s,T=zt(),E=qt(e,t,n,i),j={point:u,lineStart:h,lineEnd:f,polygonStart:function(){s=T,g=[],m=[],C=!0},polygonEnd:function(){s=S,g=fo.merge(g);var t=l([e,i]),n=C&&t,r=g.length;(n||r)&&(s.polygonStart(),n&&(s.lineStart(),c(null,null,1,s),s.lineEnd()),r&&Ot(g,a,t,c,s),s.polygonEnd()),g=m=_=null}};return j}}function Jt(e){var t=0,n=Vo/3,i=hn(e),r=i(t,n);return r.parallels=function(e){return arguments.length?i(t=e[0]*Vo/180,n=e[1]*Vo/180):[t/Vo*180,n/Vo*180]},r}function Qt(e,t){function n(e,t){var n=Math.sqrt(a-2*r*Math.sin(t))/r;return[n*Math.sin(e*=r),o-n*Math.cos(e)]}var i=Math.sin(e),r=(i+Math.sin(t))/2,a=1+i*(2*r-i),o=Math.sqrt(a)/r;return n.invert=function(e,t){var n=o-t;return[Math.atan2(e,n)/r,oe((a-(e*e+n*n)*r*r)/(2*r))]},n}function Xt(){function e(e,t){Ys+=r*e-i*t,i=e,r=t}var t,n,i,r;Bs.point=function(a,o){Bs.point=e,t=i=a,n=r=o},Bs.lineEnd=function(){e(t,n)}}function Kt(e,t){e<Fs&&(Fs=e),e>Us&&(Us=e),t<Gs&&(Gs=t),t>qs&&(qs=t)}function Zt(){function e(e,t){o.push("M",e,",",t,a)}function t(e,t){o.push("M",e,",",t),s.point=n}function n(e,t){o.push("L",e,",",t)}function i(){s.point=e}function r(){o.push("Z")}var a=en(4.5),o=[],s={point:e,lineStart:function(){s.point=t},lineEnd:i,polygonStart:function(){s.lineEnd=r},polygonEnd:function(){s.lineEnd=i,s.point=e},pointRadius:function(e){return a=en(e),s},result:function(){if(o.length){var e=o.join("");return o=[],e}}};return s}function en(e){return"m0,"+e+"a"+e+","+e+" 0 1,1 0,"+-2*e+"a"+e+","+e+" 0 1,1 0,"+2*e+"z"}function tn(e,t){As+=e,Ns+=t,++Ls}function nn(){function e(e,i){var r=e-t,a=i-n,o=Math.sqrt(r*r+a*a);Is+=o*(t+e)/2,Ds+=o*(n+i)/2,Os+=o,tn(t=e,n=i)}var t,n;Qs.point=function(i,r){Qs.point=e,tn(t=i,n=r)}}function rn(){Qs.point=tn}function an(){function e(e,t){var n=e-i,a=t-r,o=Math.sqrt(n*n+a*a);Is+=o*(i+e)/2,Ds+=o*(r+t)/2,Os+=o,o=r*e-i*t,Ps+=o*(i+e),Ws+=o*(r+t),Rs+=3*o,tn(i=e,r=t)}var t,n,i,r;Qs.point=function(a,o){Qs.point=e,tn(t=i=a,n=r=o)},Qs.lineEnd=function(){e(t,n)}}function on(e){function t(t,n){e.moveTo(t+o,n),e.arc(t,n,o,0,Yo)}function n(t,n){e.moveTo(t,n),s.point=i}function i(t,n){e.lineTo(t,n)}function r(){s.point=t}function a(){e.closePath()}var o=4.5,s={point:t,lineStart:function(){s.point=n},lineEnd:r,polygonStart:function(){s.lineEnd=a},polygonEnd:function(){s.lineEnd=r,s.point=t},pointRadius:function(e){return o=e,s},result:S};return s}function sn(e){function t(e){return(s?i:n)(e)}function n(t){return dn(t,function(n,i){n=e(n,i),t.point(n[0],n[1])})}function i(t){function n(n,i){n=e(n,i),t.point(n[0],n[1])}function i(){y=NaN,M.point=a,t.lineStart()}function a(n,i){var a=bt([n,i]),o=e(n,i);r(y,b,v,w,x,k,y=o[0],b=o[1],v=n,w=a[0],x=a[1],k=a[2],s,t),t.point(y,b)}function o(){M.point=n,t.lineEnd()}function l(){i(),M.point=c,M.lineEnd=d}function c(e,t){a(u=e,h=t),f=y,p=b,g=w,m=x,_=k,M.point=a}function d(){r(y,b,v,w,x,k,f,p,u,g,m,_,s,t),M.lineEnd=o,o()}var u,h,f,p,g,m,_,v,y,b,w,x,k,M={point:n,lineStart:i,lineEnd:o,polygonStart:function(){t.polygonStart(),M.lineStart=l},polygonEnd:function(){t.polygonEnd(),M.lineStart=i}};return M}function r(t,n,i,s,l,c,d,u,h,f,p,g,m,_){var v=d-t,y=u-n,b=v*v+y*y;if(b>4*a&&m--){var w=s+f,x=l+p,k=c+g,M=Math.sqrt(w*w+x*x+k*k),C=Math.asin(k/=M),S=ko(ko(k)-1)<zo||ko(i-h)<zo?(i+h)/2:Math.atan2(x,w),T=e(S,C),E=T[0],j=T[1],A=E-t,N=j-n,L=y*A-v*N;(L*L/b>a||ko((v*A+y*N)/b-.5)>.3||s*f+l*p+c*g<o)&&(r(t,n,i,s,l,c,E,j,S,w/=M,x/=M,k,m,_),_.point(E,j),r(E,j,S,w,x,k,d,u,h,f,p,g,m,_))}}var a=.5,o=Math.cos(30*Uo),s=16;return t.precision=function(e){return arguments.length?(s=(a=e*e)>0&&16,t):Math.sqrt(a)},t}function ln(e){var t=sn(function(t,n){return e([t*qo,n*qo])});return function(e){return fn(t(e))}}function cn(e){this.stream=e}function dn(e,t){return{point:t,sphere:function(){e.sphere()},lineStart:function(){e.lineStart()},lineEnd:function(){e.lineEnd()},polygonStart:function(){e.polygonStart()},polygonEnd:function(){e.polygonEnd()}}}function un(e){return hn(function(){return e})()}function hn(e){function t(e){return e=s(e[0]*Uo,e[1]*Uo),[e[0]*h+l,c-e[1]*h]}function n(e){return(e=s.invert((e[0]-l)/h,(c-e[1])/h))&&[e[0]*qo,e[1]*qo]}function i(){s=It(o=mn(_,v,y),a);var e=a(g,m);return l=f-e[0]*h,c=p+e[1]*h,r()}function r(){return d&&(d.valid=!1,d=null),t}var a,o,s,l,c,d,u=sn(function(e,t){return e=a(e,t),[e[0]*h+l,c-e[1]*h]}),h=150,f=480,p=250,g=0,m=0,_=0,v=0,y=0,b=zs,w=k,x=null,M=null;return t.stream=function(e){return d&&(d.valid=!1),d=fn(b(o,u(w(e)))),d.valid=!0,d},t.clipAngle=function(e){return arguments.length?(b=null==e?(x=e,zs):Ut((x=+e)*Uo),r()):x},t.clipExtent=function(e){return arguments.length?(M=e,w=e?Bt(e[0][0],e[0][1],e[1][0],e[1][1]):k,r()):M},t.scale=function(e){return arguments.length?(h=+e,i()):h},t.translate=function(e){return arguments.length?(f=+e[0],p=+e[1],i()):[f,p]},t.center=function(e){return arguments.length?(g=e[0]%360*Uo,m=e[1]%360*Uo,i()):[g*qo,m*qo]},t.rotate=function(e){return arguments.length?(_=e[0]%360*Uo,v=e[1]%360*Uo,y=e.length>2?e[2]%360*Uo:0,i()):[_*qo,v*qo,y*qo]},fo.rebind(t,u,"precision"),function(){return a=e.apply(this,arguments),t.invert=a.invert&&n,i()}}function fn(e){return dn(e,function(t,n){e.point(t*Uo,n*Uo)})}function pn(e,t){return[e,t]}function gn(e,t){return[e>Vo?e-Yo:e<-Vo?e+Yo:e,t]}function mn(e,t,n){return e?t||n?It(vn(e),yn(t,n)):vn(e):t||n?yn(t,n):gn}function _n(e){return function(t,n){return t+=e,[t>Vo?t-Yo:t<-Vo?t+Yo:t,n]}}function vn(e){var t=_n(e);return t.invert=_n(-e),t}function yn(e,t){function n(e,t){var n=Math.cos(t),s=Math.cos(e)*n,l=Math.sin(e)*n,c=Math.sin(t),d=c*i+s*r;return[Math.atan2(l*a-d*o,s*i-c*r),oe(d*a+l*o)]}var i=Math.cos(e),r=Math.sin(e),a=Math.cos(t),o=Math.sin(t);return n.invert=function(e,t){var n=Math.cos(t),s=Math.cos(e)*n,l=Math.sin(e)*n,c=Math.sin(t),d=c*a-l*o;return[Math.atan2(l*a+c*o,s*i+d*r),oe(d*i-s*r)]},n}function bn(e,t){var n=Math.cos(e),i=Math.sin(e);return function(r,a,o,s){var l=o*t;null!=r?(r=wn(n,r),a=wn(n,a),(o>0?r<a:r>a)&&(r+=o*Yo)):(r=e+o*Yo,a=e-.5*l);for(var c,d=r;o>0?d>a:d<a;d-=l)s.point((c=St([n,-i*Math.cos(d),-i*Math.sin(d)]))[0],c[1])}}function wn(e,t){var n=bt(t);n[0]-=e,Ct(n);var i=ae(-n[1]);return((-n[2]<0?-i:i)+2*Math.PI-zo)%(2*Math.PI)}function xn(e,t,n){var i=fo.range(e,t-zo,n).concat(t);return function(e){return i.map(function(t){return[e,t]})}}function kn(e,t,n){var i=fo.range(e,t-zo,n).concat(t);return function(e){return i.map(function(t){return[t,e]})}}function Mn(e){return e.source}function Cn(e){return e.target}function Sn(e,t,n,i){var r=Math.cos(t),a=Math.sin(t),o=Math.cos(i),s=Math.sin(i),l=r*Math.cos(e),c=r*Math.sin(e),d=o*Math.cos(n),u=o*Math.sin(n),h=2*Math.asin(Math.sqrt(de(i-t)+r*o*de(n-e))),f=1/Math.sin(h),p=h?function(e){var t=Math.sin(e*=h)*f,n=Math.sin(h-e)*f,i=n*l+t*d,r=n*c+t*u,o=n*a+t*s;return[Math.atan2(r,i)*qo,Math.atan2(o,Math.sqrt(i*i+r*r))*qo]}:function(){return[e*qo,t*qo]};return p.distance=h,p}function Tn(){function e(e,r){var a=Math.sin(r*=Uo),o=Math.cos(r),s=ko((e*=Uo)-t),l=Math.cos(s);Xs+=Math.atan2(Math.sqrt((s=o*Math.sin(s))*s+(s=i*a-n*o*l)*s),n*a+i*o*l),t=e,n=a,i=o}var t,n,i;Ks.point=function(r,a){t=r*Uo,n=Math.sin(a*=Uo),i=Math.cos(a),Ks.point=e},Ks.lineEnd=function(){Ks.point=Ks.lineEnd=S}}function En(e,t){function n(t,n){var i=Math.cos(t),r=Math.cos(n),a=e(i*r);return[a*r*Math.sin(t),a*Math.sin(n)]}return n.invert=function(e,n){var i=Math.sqrt(e*e+n*n),r=t(i),a=Math.sin(r),o=Math.cos(r);return[Math.atan2(e*a,i*o),Math.asin(i&&n*a/i)]},n}function jn(e,t){function n(e,t){o>0?t<-Go+zo&&(t=-Go+zo):t>Go-zo&&(t=Go-zo);var n=o/Math.pow(r(t),a);return[n*Math.sin(a*e),o-n*Math.cos(a*e)]}var i=Math.cos(e),r=function(e){return Math.tan(Vo/4+e/2)},a=e===t?Math.sin(e):Math.log(i/Math.cos(t))/Math.log(r(t)/r(e)),o=i*Math.pow(r(e),a)/a;return a?(n.invert=function(e,t){var n=o-t,i=ie(a)*Math.sqrt(e*e+n*n);return[Math.atan2(e,n)/a,2*Math.atan(Math.pow(o/i,1/a))-Go]},n):Nn}function An(e,t){function n(e,t){var n=a-t;return[n*Math.sin(r*e),a-n*Math.cos(r*e)]}var i=Math.cos(e),r=e===t?Math.sin(e):(i-Math.cos(t))/(t-e),a=i/r+e;return ko(r)<zo?pn:(n.invert=function(e,t){var n=a-t;return[Math.atan2(e,n)/r,a-ie(r)*Math.sqrt(e*e+n*n)]},n)}function Nn(e,t){return[e,Math.log(Math.tan(Vo/4+t/2))]}function Ln(e){var t,n=un(e),i=n.scale,r=n.translate,a=n.clipExtent;return n.scale=function(){var e=i.apply(n,arguments);return e===n?t?n.clipExtent(null):n:e},n.translate=function(){var e=r.apply(n,arguments);return e===n?t?n.clipExtent(null):n:e},n.clipExtent=function(e){var o=a.apply(n,arguments);if(o===n){if(t=null==e){var s=Vo*i(),l=r();a([[l[0]-s,l[1]-s],[l[0]+s,l[1]+s]])}}else t&&(o=null);return o},n.clipExtent(null)}function In(e,t){return[Math.log(Math.tan(Vo/4+t/2)),-e]}function Dn(e){return e[0]}function On(e){return e[1]}function Pn(e){for(var t=e.length,n=[0,1],i=2,r=2;r<t;r++){for(;i>1&&re(e[n[i-2]],e[n[i-1]],e[r])<=0;)--i;n[i++]=r}return n.slice(0,i)}function Wn(e,t){return e[0]-t[0]||e[1]-t[1]}function Rn(e,t,n){return(n[0]-t[0])*(e[1]-t[1])<(n[1]-t[1])*(e[0]-t[0])}function $n(e,t,n,i){var r=e[0],a=n[0],o=t[0]-r,s=i[0]-a,l=e[1],c=n[1],d=t[1]-l,u=i[1]-c,h=(s*(l-c)-u*(r-a))/(u*o-s*d);return[r+h*o,l+h*d]}function zn(e){var t=e[0],n=e[e.length-1];return!(t[0]-n[0]||t[1]-n[1])}function Hn(){li(this),this.edge=this.site=this.circle=null}function Vn(e){var t=dl.pop()||new Hn;return t.site=e,t}function Yn(e){Zn(e),sl.remove(e),dl.push(e),li(e)}function Fn(e){var t=e.circle,n=t.x,i=t.cy,r={x:n,y:i},a=e.P,o=e.N,s=[e];Yn(e);for(var l=a;l.circle&&ko(n-l.circle.x)<zo&&ko(i-l.circle.cy)<zo;)a=l.P,s.unshift(l),Yn(l),l=a;s.unshift(l),Zn(l);for(var c=o;c.circle&&ko(n-c.circle.x)<zo&&ko(i-c.circle.cy)<zo;)o=c.N,s.push(c),Yn(c),c=o;s.push(c),Zn(c);var d,u=s.length;for(d=1;d<u;++d)c=s[d],l=s[d-1],ai(c.edge,l.site,c.site,r);l=s[0],c=s[u-1],c.edge=ii(l.site,c.site,null,r),Kn(l),Kn(c)}function Gn(e){for(var t,n,i,r,a=e.x,o=e.y,s=sl._;s;)if((i=Un(s,o)-a)>zo)s=s.L;else{if(!((r=a-qn(s,o))>zo)){i>-zo?(t=s.P,n=s):r>-zo?(t=s,n=s.N):t=n=s;break}if(!s.R){t=s;break}s=s.R}var l=Vn(e);if(sl.insert(t,l),t||n){if(t===n)return Zn(t),n=Vn(t.site),sl.insert(l,n),l.edge=n.edge=ii(t.site,l.site),Kn(t),void Kn(n);if(!n)return void(l.edge=ii(t.site,l.site));Zn(t),Zn(n);var c=t.site,d=c.x,u=c.y,h=e.x-d,f=e.y-u,p=n.site,g=p.x-d,m=p.y-u,_=2*(h*m-f*g),v=h*h+f*f,y=g*g+m*m,b={x:(m*v-f*y)/_+d,y:(h*y-g*v)/_+u};ai(n.edge,c,p,b),l.edge=ii(c,e,null,b),n.edge=ii(e,p,null,b),Kn(t),Kn(n)}}function Un(e,t){var n=e.site,i=n.x,r=n.y,a=r-t;if(!a)return i;var o=e.P;if(!o)return-1/0;n=o.site;var s=n.x,l=n.y,c=l-t;if(!c)return s;var d=s-i,u=1/a-1/c,h=d/c;return u?(-h+Math.sqrt(h*h-2*u*(d*d/(-2*c)-l+c/2+r-a/2)))/u+i:(i+s)/2}function qn(e,t){var n=e.N;if(n)return Un(n,t);var i=e.site;return i.y===t?i.x:1/0}function Bn(e){this.site=e,this.edges=[]}function Jn(e){for(var t,n,i,r,a,o,s,l,c,d,u=e[0][0],h=e[1][0],f=e[0][1],p=e[1][1],g=ol,m=g.length;m--;)if((a=g[m])&&a.prepare())for(s=a.edges,l=s.length,o=0;o<l;)d=s[o].end(),i=d.x,r=d.y,c=s[++o%l].start(),t=c.x,n=c.y,(ko(i-t)>zo||ko(r-n)>zo)&&(s.splice(o,0,new oi(ri(a.site,d,ko(i-u)<zo&&p-r>zo?{x:u,y:ko(t-u)<zo?n:p}:ko(r-p)<zo&&h-i>zo?{x:ko(n-p)<zo?t:h,y:p}:ko(i-h)<zo&&r-f>zo?{x:h,y:ko(t-h)<zo?n:f}:ko(r-f)<zo&&i-u>zo?{x:ko(n-f)<zo?t:u,y:f}:null),a.site,null)),++l)}function Qn(e,t){return t.angle-e.angle}function Xn(){li(this),this.x=this.y=this.arc=this.site=this.cy=null}function Kn(e){var t=e.P,n=e.N;if(t&&n){var i=t.site,r=e.site,a=n.site;if(i!==a){var o=r.x,s=r.y,l=i.x-o,c=i.y-s,d=a.x-o,u=a.y-s,h=2*(l*u-c*d);if(!(h>=-Ho)){var f=l*l+c*c,p=d*d+u*u,g=(u*f-c*p)/h,m=(l*p-d*f)/h,u=m+s,_=ul.pop()||new Xn;_.arc=e,_.site=r,_.x=g+o,_.y=u+Math.sqrt(g*g+m*m),_.cy=u,e.circle=_;for(var v=null,y=cl._;y;)if(_.y<y.y||_.y===y.y&&_.x<=y.x){if(!y.L){v=y.P;break}y=y.L}else{if(!y.R){v=y;break}y=y.R}cl.insert(v,_),v||(ll=_)}}}}function Zn(e){var t=e.circle;t&&(t.P||(ll=t.N),cl.remove(t),ul.push(t),li(t),e.circle=null)}function ei(e){for(var t,n=al,i=qt(e[0][0],e[0][1],e[1][0],e[1][1]),r=n.length;r--;)t=n[r],(!ti(t,e)||!i(t)||ko(t.a.x-t.b.x)<zo&&ko(t.a.y-t.b.y)<zo)&&(t.a=t.b=null,n.splice(r,1))}function ti(e,t){var n=e.b;if(n)return!0;var i,r,a=e.a,o=t[0][0],s=t[1][0],l=t[0][1],c=t[1][1],d=e.l,u=e.r,h=d.x,f=d.y,p=u.x,g=u.y,m=(h+p)/2,_=(f+g)/2;if(g===f){if(m<o||m>=s)return;if(h>p){if(a){if(a.y>=c)return}else a={x:m,y:l};n={x:m,y:c}}else{if(a){if(a.y<l)return}else a={x:m,y:c};n={x:m,y:l}}}else if(i=(h-p)/(g-f),r=_-i*m,i<-1||i>1)if(h>p){if(a){if(a.y>=c)return}else a={x:(l-r)/i,y:l};n={x:(c-r)/i,y:c}}else{if(a){if(a.y<l)return}else a={x:(c-r)/i,y:c};n={x:(l-r)/i,y:l}}else if(f<g){if(a){if(a.x>=s)return}else a={x:o,y:i*o+r};n={x:s,y:i*s+r}}else{if(a){if(a.x<o)return}else a={x:s,y:i*s+r};n={x:o,y:i*o+r}}return e.a=a,e.b=n,!0}function ni(e,t){this.l=e,this.r=t,this.a=this.b=null}function ii(e,t,n,i){var r=new ni(e,t);return al.push(r),n&&ai(r,e,t,n),i&&ai(r,t,e,i),ol[e.i].edges.push(new oi(r,e,t)),ol[t.i].edges.push(new oi(r,t,e)),r}function ri(e,t,n){var i=new ni(e,null);return i.a=t,i.b=n,al.push(i),i}function ai(e,t,n,i){e.a||e.b?e.l===n?e.b=i:e.a=i:(e.a=i,e.l=t,e.r=n)}function oi(e,t,n){var i=e.a,r=e.b;this.edge=e,this.site=t,this.angle=n?Math.atan2(n.y-t.y,n.x-t.x):e.l===t?Math.atan2(r.x-i.x,i.y-r.y):Math.atan2(i.x-r.x,r.y-i.y)}function si(){this._=null}function li(e){e.U=e.C=e.L=e.R=e.P=e.N=null}function ci(e,t){var n=t,i=t.R,r=n.U;r?r.L===n?r.L=i:r.R=i:e._=i,i.U=r,n.U=i,n.R=i.L,n.R&&(n.R.U=n),i.L=n}function di(e,t){var n=t,i=t.L,r=n.U;r?r.L===n?r.L=i:r.R=i:e._=i,i.U=r,n.U=i,n.L=i.R,n.L&&(n.L.U=n),i.R=n}function ui(e){for(;e.L;)e=e.L;return e}function hi(e,t){var n,i,r,a=e.sort(fi).pop();for(al=[],ol=new Array(e.length),sl=new si,cl=new si;;)if(r=ll,a&&(!r||a.y<r.y||a.y===r.y&&a.x<r.x))a.x===n&&a.y===i||(ol[a.i]=new Bn(a),Gn(a),n=a.x,i=a.y),a=e.pop();else{if(!r)break;Fn(r.arc)}t&&(ei(t),Jn(t));var o={cells:ol,edges:al};return sl=cl=al=ol=null,o}function fi(e,t){return t.y-e.y||t.x-e.x}function pi(e,t,n){return(e.x-n.x)*(t.y-e.y)-(e.x-t.x)*(n.y-e.y)}function gi(e){return e.x}function mi(e){return e.y}function _i(){return{leaf:!0,nodes:[],point:null,x:null,y:null}}function vi(e,t,n,i,r,a){if(!e(t,n,i,r,a)){var o=.5*(n+r),s=.5*(i+a),l=t.nodes;l[0]&&vi(e,l[0],n,i,o,s),l[1]&&vi(e,l[1],o,i,r,s),l[2]&&vi(e,l[2],n,s,o,a),l[3]&&vi(e,l[3],o,s,r,a)}}function yi(e,t,n,i,r,a,o){var s,l=1/0;return function e(c,d,u,h,f){if(!(d>a||u>o||h<i||f<r)){if(p=c.point){var p,g=t-c.x,m=n-c.y,_=g*g+m*m;if(_<l){var v=Math.sqrt(l=_);i=t-v,r=n-v,a=t+v,o=n+v,s=p}}for(var y=c.nodes,b=.5*(d+h),w=.5*(u+f),x=t>=b,k=n>=w,M=k<<1|x,C=M+4;M<C;++M)if(c=y[3&M])switch(3&M){case 0:e(c,d,u,b,w);break;case 1:e(c,b,u,h,w);break;case 2:e(c,d,w,b,f);break;case 3:e(c,b,w,h,f)}}}(e,i,r,a,o),s}function bi(e,t){e=fo.rgb(e),t=fo.rgb(t);var n=e.r,i=e.g,r=e.b,a=t.r-n,o=t.g-i,s=t.b-r;return function(e){return"#"+Ce(Math.round(n+a*e))+Ce(Math.round(i+o*e))+Ce(Math.round(r+s*e))}}function wi(e,t){var n,i={},r={};for(n in e)n in t?i[n]=Mi(e[n],t[n]):r[n]=e[n];for(n in t)n in e||(r[n]=t[n]);return function(e){for(n in i)r[n]=i[n](e);return r}}function xi(e,t){return e=+e,t=+t,function(n){return e*(1-n)+t*n}}function ki(e,t){var n,i,r,a=fl.lastIndex=pl.lastIndex=0,o=-1,s=[],l=[];for(e+="",t+="";(n=fl.exec(e))&&(i=pl.exec(t));)(r=i.index)>a&&(r=t.slice(a,r),s[o]?s[o]+=r:s[++o]=r),(n=n[0])===(i=i[0])?s[o]?s[o]+=i:s[++o]=i:(s[++o]=null,l.push({i:o,x:xi(n,i)})),a=pl.lastIndex;return a<t.length&&(r=t.slice(a),s[o]?s[o]+=r:s[++o]=r),s.length<2?l[0]?(t=l[0].x,function(e){return t(e)+""}):function(){return t}:(t=l.length,function(e){for(var n,i=0;i<t;++i)s[(n=l[i]).i]=n.x(e);return s.join("")})}function Mi(e,t){for(var n,i=fo.interpolators.length;--i>=0&&!(n=fo.interpolators[i](e,t)););return n}function Ci(e,t){var n,i=[],r=[],a=e.length,o=t.length,s=Math.min(e.length,t.length);for(n=0;n<s;++n)i.push(Mi(e[n],t[n]));for(;n<a;++n)r[n]=e[n];for(;n<o;++n)r[n]=t[n];return function(e){for(n=0;n<s;++n)r[n]=i[n](e);return r}}function Si(e){return function(t){return t<=0?0:t>=1?1:e(t)}}function Ti(e){return function(t){return 1-e(1-t)}}function Ei(e){return function(t){return.5*(t<.5?e(2*t):2-e(2-2*t))}}function ji(e){return e*e}function Ai(e){return e*e*e}function Ni(e){if(e<=0)return 0;if(e>=1)return 1;var t=e*e,n=t*e;return 4*(e<.5?n:3*(e-t)+n-.75)}function Li(e){return function(t){return Math.pow(t,e)}}function Ii(e){return 1-Math.cos(e*Go)}function Di(e){return Math.pow(2,10*(e-1))}function Oi(e){return 1-Math.sqrt(1-e*e)}function Pi(e,t){var n;return arguments.length<2&&(t=.45),arguments.length?n=t/Yo*Math.asin(1/e):(e=1,n=t/4),function(i){return 1+e*Math.pow(2,-10*i)*Math.sin((i-n)*Yo/t)}}function Wi(e){return e||(e=1.70158),function(t){return t*t*((e+1)*t-e)}}function Ri(e){return e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375}function $i(e,t){e=fo.hcl(e),t=fo.hcl(t);var n=e.h,i=e.c,r=e.l,a=t.h-n,o=t.c-i,s=t.l-r;return isNaN(o)&&(o=0,i=isNaN(i)?t.c:i),isNaN(a)?(a=0,n=isNaN(n)?t.h:n):a>180?a-=360:a<-180&&(a+=360),function(e){return ge(n+a*e,i+o*e,r+s*e)+""}}function zi(e,t){e=fo.hsl(e),t=fo.hsl(t);var n=e.h,i=e.s,r=e.l,a=t.h-n,o=t.s-i,s=t.l-r;return isNaN(o)&&(o=0,i=isNaN(i)?t.s:i),isNaN(a)?(a=0,n=isNaN(n)?t.h:n):a>180?a-=360:a<-180&&(a+=360),function(e){return fe(n+a*e,i+o*e,r+s*e)+""}}function Hi(e,t){e=fo.lab(e),t=fo.lab(t);var n=e.l,i=e.a,r=e.b,a=t.l-n,o=t.a-i,s=t.b-r;return function(e){return _e(n+a*e,i+o*e,r+s*e)+""}}function Vi(e,t){return t-=e,function(n){return Math.round(e+t*n)}}function Yi(e){var t=[e.a,e.b],n=[e.c,e.d],i=Gi(t),r=Fi(t,n),a=Gi(Ui(n,t,-r))||0;t[0]*n[1]<n[0]*t[1]&&(t[0]*=-1,t[1]*=-1,i*=-1,r*=-1),this.rotate=(i?Math.atan2(t[1],t[0]):Math.atan2(-n[0],n[1]))*qo,this.translate=[e.e,e.f],this.scale=[i,a],this.skew=a?Math.atan2(r,a)*qo:0}function Fi(e,t){return e[0]*t[0]+e[1]*t[1]}function Gi(e){var t=Math.sqrt(Fi(e,e));return t&&(e[0]/=t,e[1]/=t),t}function Ui(e,t,n){return e[0]+=n*t[0],e[1]+=n*t[1],e}function qi(e){return e.length?e.pop()+",":""}function Bi(e,t,n,i){if(e[0]!==t[0]||e[1]!==t[1]){var r=n.push("translate(",null,",",null,")");i.push({i:r-4,x:xi(e[0],t[0])},{i:r-2,x:xi(e[1],t[1])})}else(t[0]||t[1])&&n.push("translate("+t+")")}function Ji(e,t,n,i){e!==t?(e-t>180?t+=360:t-e>180&&(e+=360),i.push({i:n.push(qi(n)+"rotate(",null,")")-2,x:xi(e,t)})):t&&n.push(qi(n)+"rotate("+t+")")}function Qi(e,t,n,i){e!==t?i.push({i:n.push(qi(n)+"skewX(",null,")")-2,x:xi(e,t)}):t&&n.push(qi(n)+"skewX("+t+")")}function Xi(e,t,n,i){if(e[0]!==t[0]||e[1]!==t[1]){var r=n.push(qi(n)+"scale(",null,",",null,")");i.push({i:r-4,x:xi(e[0],t[0])},{i:r-2,x:xi(e[1],t[1])})}else 1===t[0]&&1===t[1]||n.push(qi(n)+"scale("+t+")")}function Ki(e,t){var n=[],i=[];return e=fo.transform(e),t=fo.transform(t),Bi(e.translate,t.translate,n,i),Ji(e.rotate,t.rotate,n,i),Qi(e.skew,t.skew,n,i),Xi(e.scale,t.scale,n,i),e=t=null,function(e){for(var t,r=-1,a=i.length;++r<a;)n[(t=i[r]).i]=t.x(e);return n.join("")}}function Zi(e,t){return t=(t-=e=+e)||1/t,function(n){return(n-e)/t}}function er(e,t){return t=(t-=e=+e)||1/t,function(n){return Math.max(0,Math.min(1,(n-e)/t))}}function tr(e){for(var t=e.source,n=e.target,i=ir(t,n),r=[t];t!==i;)t=t.parent,r.push(t);for(var a=r.length;n!==i;)r.splice(a,0,n),n=n.parent;return r}function nr(e){for(var t=[],n=e.parent;null!=n;)t.push(e),e=n,n=n.parent;return t.push(e),t}function ir(e,t){if(e===t)return e;for(var n=nr(e),i=nr(t),r=n.pop(),a=i.pop(),o=null;r===a;)o=r,r=n.pop(),a=i.pop();return o}function rr(e){e.fixed|=2}function ar(e){e.fixed&=-7}function or(e){e.fixed|=4,e.px=e.x,e.py=e.y}function sr(e){e.fixed&=-5}function lr(e,t,n){var i=0,r=0;if(e.charge=0,!e.leaf)for(var a,o=e.nodes,s=o.length,l=-1;++l<s;)null!=(a=o[l])&&(lr(a,t,n),e.charge+=a.charge,i+=a.charge*a.cx,r+=a.charge*a.cy);if(e.point){e.leaf||(e.point.x+=Math.random()-.5,e.point.y+=Math.random()-.5);var c=t*n[e.point.index];e.charge+=e.pointCharge=c,i+=c*e.point.x,r+=c*e.point.y}e.cx=i/e.charge,e.cy=r/e.charge}function cr(e,t){return fo.rebind(e,t,"sort","children","value"),e.nodes=e,e.links=gr,e}function dr(e,t){for(var n=[e];null!=(e=n.pop());)if(t(e),(r=e.children)&&(i=r.length))for(var i,r;--i>=0;)n.push(r[i])}function ur(e,t){for(var n=[e],i=[];null!=(e=n.pop());)if(i.push(e),(a=e.children)&&(r=a.length))for(var r,a,o=-1;++o<r;)n.push(a[o]);for(;null!=(e=i.pop());)t(e)}function hr(e){return e.children}function fr(e){return e.value}function pr(e,t){return t.value-e.value}function gr(e){return fo.merge(e.map(function(e){return(e.children||[]).map(function(t){return{source:e,target:t}})}))}function mr(e){return e.x}function _r(e){return e.y}function vr(e,t,n){e.y0=t,e.y=n}function yr(e){return fo.range(e.length)}function br(e){for(var t=-1,n=e[0].length,i=[];++t<n;)i[t]=0;return i}function wr(e){for(var t,n=1,i=0,r=e[0][1],a=e.length;n<a;++n)(t=e[n][1])>r&&(i=n,r=t);return i}function xr(e){return e.reduce(kr,0)}function kr(e,t){return e+t[1]}function Mr(e,t){return Cr(e,Math.ceil(Math.log(t.length)/Math.LN2+1))}function Cr(e,t){for(var n=-1,i=+e[0],r=(e[1]-i)/t,a=[];++n<=t;)a[n]=r*n+i;return a}function Sr(e){return[fo.min(e),fo.max(e)]}function Tr(e,t){return e.value-t.value}function Er(e,t){var n=e._pack_next;e._pack_next=t,t._pack_prev=e,t._pack_next=n,n._pack_prev=t}function jr(e,t){e._pack_next=t,t._pack_prev=e}function Ar(e,t){var n=t.x-e.x,i=t.y-e.y,r=e.r+t.r;return.999*r*r>n*n+i*i}function Nr(e){function t(e){d=Math.min(e.x-e.r,d),u=Math.max(e.x+e.r,u),h=Math.min(e.y-e.r,h),f=Math.max(e.y+e.r,f)}if((n=e.children)&&(c=n.length)){var n,i,r,a,o,s,l,c,d=1/0,u=-1/0,h=1/0,f=-1/0;if(n.forEach(Lr),i=n[0],i.x=-i.r,i.y=0,t(i),c>1&&(r=n[1],r.x=r.r,r.y=0,t(r),c>2))for(a=n[2],Or(i,r,a),t(a),Er(i,a),i._pack_prev=a,Er(a,r),r=i._pack_next,o=3;o<c;o++){Or(i,r,a=n[o]);var p=0,g=1,m=1;for(s=r._pack_next;s!==r;s=s._pack_next,g++)if(Ar(s,a)){p=1;break}if(1==p)for(l=i._pack_prev;l!==s._pack_prev&&!Ar(l,a);l=l._pack_prev,m++);p?(g<m||g==m&&r.r<i.r?jr(i,r=s):jr(i=l,r),o--):(Er(i,a),r=a,t(a))}var _=(d+u)/2,v=(h+f)/2,y=0;for(o=0;o<c;o++)a=n[o],a.x-=_,a.y-=v,y=Math.max(y,a.r+Math.sqrt(a.x*a.x+a.y*a.y));e.r=y,n.forEach(Ir)}}function Lr(e){e._pack_next=e._pack_prev=e}function Ir(e){delete e._pack_next,delete e._pack_prev}function Dr(e,t,n,i){var r=e.children;if(e.x=t+=i*e.x,e.y=n+=i*e.y,e.r*=i,r)for(var a=-1,o=r.length;++a<o;)Dr(r[a],t,n,i)}function Or(e,t,n){var i=e.r+n.r,r=t.x-e.x,a=t.y-e.y;if(i&&(r||a)){var o=t.r+n.r,s=r*r+a*a;o*=o,i*=i;var l=.5+(i-o)/(2*s),c=Math.sqrt(Math.max(0,2*o*(i+s)-(i-=s)*i-o*o))/(2*s);n.x=e.x+l*r+c*a,n.y=e.y+l*a-c*r}else n.x=e.x+i,n.y=e.y}function Pr(e,t){return e.parent==t.parent?1:2}function Wr(e){var t=e.children;return t.length?t[0]:e.t}function Rr(e){var t,n=e.children;return(t=n.length)?n[t-1]:e.t}function $r(e,t,n){var i=n/(t.i-e.i);t.c-=i,t.s+=n,e.c+=i,t.z+=n,t.m+=n}function zr(e){for(var t,n=0,i=0,r=e.children,a=r.length;--a>=0;)t=r[a],t.z+=n,t.m+=n,n+=t.s+(i+=t.c)}function Hr(e,t,n){return e.a.parent===t.parent?e.a:n}function Vr(e){return 1+fo.max(e,function(e){return e.y})}function Yr(e){return e.reduce(function(e,t){return e+t.x},0)/e.length}function Fr(e){var t=e.children;return t&&t.length?Fr(t[0]):e}function Gr(e){var t,n=e.children;return n&&(t=n.length)?Gr(n[t-1]):e}function Ur(e){return{x:e.x,y:e.y,dx:e.dx,dy:e.dy}}function qr(e,t){var n=e.x+t[3],i=e.y+t[0],r=e.dx-t[1]-t[3],a=e.dy-t[0]-t[2];return r<0&&(n+=r/2,r=0),a<0&&(i+=a/2,a=0),{x:n,y:i,dx:r,dy:a}}function Br(e){var t=e[0],n=e[e.length-1];return t<n?[t,n]:[n,t]}function Jr(e){return e.rangeExtent?e.rangeExtent():Br(e.range())}function Qr(e,t,n,i){var r=n(e[0],e[1]),a=i(t[0],t[1]);return function(e){return a(r(e))}}function Xr(e,t){var n,i=0,r=e.length-1,a=e[i],o=e[r];return o<a&&(n=i,i=r,r=n,n=a,a=o,o=n),e[i]=t.floor(a),e[r]=t.ceil(o),e}function Kr(e){return e?{floor:function(t){return Math.floor(t/e)*e},ceil:function(t){return Math.ceil(t/e)*e}}:Cl}function Zr(e,t,n,i){var r=[],a=[],o=0,s=Math.min(e.length,t.length)-1;for(e[s]<e[0]&&(e=e.slice().reverse(),t=t.slice().reverse());++o<=s;)r.push(n(e[o-1],e[o])),a.push(i(t[o-1],t[o]));return function(t){var n=fo.bisect(e,t,1,s)-1;return a[n](r[n](t))}}function ea(e,t,n,i){function r(){var r=Math.min(e.length,t.length)>2?Zr:Qr,l=i?er:Zi;return o=r(e,t,l,n),s=r(t,e,l,Mi),a}function a(e){return o(e)}var o,s;return a.invert=function(e){return s(e)},a.domain=function(t){return arguments.length?(e=t.map(Number),r()):e},a.range=function(e){return arguments.length?(t=e,r()):t},a.rangeRound=function(e){return a.range(e).interpolate(Vi)},a.clamp=function(e){return arguments.length?(i=e,r()):i},a.interpolate=function(e){return arguments.length?(n=e,r()):n},a.ticks=function(t){return ra(e,t)},a.tickFormat=function(t,n){return aa(e,t,n)},a.nice=function(t){return na(e,t),r()},a.copy=function(){return ea(e,t,n,i)},r()}function ta(e,t){return fo.rebind(e,t,"range","rangeRound","interpolate","clamp")}function na(e,t){return Xr(e,Kr(ia(e,t)[2])),Xr(e,Kr(ia(e,t)[2])),e}function ia(e,t){null==t&&(t=10);var n=Br(e),i=n[1]-n[0],r=Math.pow(10,Math.floor(Math.log(i/t)/Math.LN10)),a=t/i*r;return a<=.15?r*=10:a<=.35?r*=5:a<=.75&&(r*=2),n[0]=Math.ceil(n[0]/r)*r,n[1]=Math.floor(n[1]/r)*r+.5*r,n[2]=r,n}function ra(e,t){return fo.range.apply(fo,ia(e,t))}function aa(e,t,n){var i=ia(e,t);if(n){var r=fs.exec(n);if(r.shift(),"s"===r[8]){var a=fo.formatPrefix(Math.max(ko(i[0]),ko(i[1])));return r[7]||(r[7]="."+oa(a.scale(i[2]))),r[8]="f",n=fo.format(r.join("")),function(e){return n(a.scale(e))+a.symbol}}r[7]||(r[7]="."+sa(r[8],i)),n=r.join("")}else n=",."+oa(i[2])+"f";return fo.format(n)}function oa(e){return-Math.floor(Math.log(e)/Math.LN10+.01)}function sa(e,t){var n=oa(t[2]);return e in Sl?Math.abs(n-oa(Math.max(ko(t[0]),ko(t[1]))))+ +("e"!==e):n-2*("%"===e)}function la(e,t,n,i){function r(e){return(n?Math.log(e<0?0:e):-Math.log(e>0?0:-e))/Math.log(t)}function a(e){return n?Math.pow(t,e):-Math.pow(t,-e)}function o(t){return e(r(t))}return o.invert=function(t){return a(e.invert(t))},o.domain=function(t){return arguments.length?(n=t[0]>=0,e.domain((i=t.map(Number)).map(r)),o):i},o.base=function(n){return arguments.length?(t=+n,e.domain(i.map(r)),o):t},o.nice=function(){var t=Xr(i.map(r),n?Math:El);return e.domain(t),i=t.map(a),o},o.ticks=function(){var e=Br(i),o=[],s=e[0],l=e[1],c=Math.floor(r(s)),d=Math.ceil(r(l)),u=t%1?2:t;if(isFinite(d-c)){if(n){for(;c<d;c++)for(var h=1;h<u;h++)o.push(a(c)*h);o.push(a(c))}else for(o.push(a(c));c++<d;)for(var h=u-1;h>0;h--)o.push(a(c)*h);for(c=0;o[c]<s;c++);for(d=o.length;o[d-1]>l;d--);o=o.slice(c,d)}return o},o.tickFormat=function(e,n){if(!arguments.length)return Tl;arguments.length<2?n=Tl:"function"!=typeof n&&(n=fo.format(n));var i=Math.max(1,t*e/o.ticks().length);return function(e){var o=e/a(Math.round(r(e)));return o*t<t-.5&&(o*=t),o<=i?n(e):""}},o.copy=function(){return la(e.copy(),t,n,i)},ta(o,e)}function ca(e,t,n){function i(t){return e(r(t))}var r=da(t),a=da(1/t);return i.invert=function(t){return a(e.invert(t))},i.domain=function(t){return arguments.length?(e.domain((n=t.map(Number)).map(r)),i):n},i.ticks=function(e){return ra(n,e)},i.tickFormat=function(e,t){return aa(n,e,t)},i.nice=function(e){return i.domain(na(n,e))},i.exponent=function(o){return arguments.length?(r=da(t=o),a=da(1/t),e.domain(n.map(r)),i):t},i.copy=function(){return ca(e.copy(),t,n)},ta(i,e)}function da(e){return function(t){return t<0?-Math.pow(-t,e):Math.pow(t,e)}}function ua(e,t){function n(n){return a[((r.get(n)||("range"===t.t?r.set(n,e.push(n)):NaN))-1)%a.length]}function i(t,n){return fo.range(e.length).map(function(e){return t+n*e})}var r,a,o;return n.domain=function(i){if(!arguments.length)return e;e=[],r=new p;for(var a,o=-1,s=i.length;++o<s;)r.has(a=i[o])||r.set(a,e.push(a));return n[t.t].apply(n,t.a)},n.range=function(e){return arguments.length?(a=e,o=0,t={t:"range",a:arguments},n):a},n.rangePoints=function(r,s){arguments.length<2&&(s=0);var l=r[0],c=r[1],d=e.length<2?(l=(l+c)/2,0):(c-l)/(e.length-1+s);return a=i(l+d*s/2,d),o=0,t={t:"rangePoints",a:arguments},n},n.rangeRoundPoints=function(r,s){arguments.length<2&&(s=0);var l=r[0],c=r[1],d=e.length<2?(l=c=Math.round((l+c)/2),0):(c-l)/(e.length-1+s)|0;return a=i(l+Math.round(d*s/2+(c-l-(e.length-1+s)*d)/2),d),o=0,t={t:"rangeRoundPoints",a:arguments},n},n.rangeBands=function(r,s,l){arguments.length<2&&(s=0),arguments.length<3&&(l=s);var c=r[1]<r[0],d=r[c-0],u=r[1-c],h=(u-d)/(e.length-s+2*l);return a=i(d+h*l,h),c&&a.reverse(),o=h*(1-s),t={t:"rangeBands",a:arguments},n},n.rangeRoundBands=function(r,s,l){arguments.length<2&&(s=0),arguments.length<3&&(l=s);var c=r[1]<r[0],d=r[c-0],u=r[1-c],h=Math.floor((u-d)/(e.length-s+2*l));return a=i(d+Math.round((u-d-(e.length-s)*h)/2),h),c&&a.reverse(),o=Math.round(h*(1-s)),t={t:"rangeRoundBands",a:arguments},n},n.rangeBand=function(){return o},n.rangeExtent=function(){return Br(t.a[0])},n.copy=function(){return ua(e,t)},n.domain(e)}function ha(e,t){function n(){var n=0,a=t.length;for(r=[];++n<a;)r[n-1]=fo.quantile(e,n/a);return i}function i(e){if(!isNaN(e=+e))return t[fo.bisect(r,e)]}var r;return i.domain=function(t){return arguments.length?(e=t.map(l).filter(c).sort(s),n()):e},i.range=function(e){return arguments.length?(t=e,n()):t},i.quantiles=function(){return r},i.invertExtent=function(n){return n=t.indexOf(n),n<0?[NaN,NaN]:[n>0?r[n-1]:e[0],n<r.length?r[n]:e[e.length-1]]},i.copy=function(){return ha(e,t)},n()}function fa(e,t,n){function i(t){return n[Math.max(0,Math.min(o,Math.floor(a*(t-e))))]}function r(){return a=n.length/(t-e),o=n.length-1,i}var a,o;return i.domain=function(n){return arguments.length?(e=+n[0],t=+n[n.length-1],r()):[e,t]},i.range=function(e){return arguments.length?(n=e,r()):n},i.invertExtent=function(t){return t=n.indexOf(t),t=t<0?NaN:t/a+e,[t,t+1/a]},i.copy=function(){return fa(e,t,n)},r()}function pa(e,t){function n(n){if(n<=n)return t[fo.bisect(e,n)]}return n.domain=function(t){return arguments.length?(e=t,n):e},n.range=function(e){return arguments.length?(t=e,n):t},n.invertExtent=function(n){return n=t.indexOf(n),[e[n-1],e[n]]},n.copy=function(){return pa(e,t)},n}function ga(e){function t(e){return+e}return t.invert=t,t.domain=t.range=function(n){return arguments.length?(e=n.map(t),t):e},t.ticks=function(t){return ra(e,t)},t.tickFormat=function(t,n){return aa(e,t,n)},t.copy=function(){return ga(e)},t}function ma(){return 0}function _a(e){return e.innerRadius}function va(e){return e.outerRadius}function ya(e){return e.startAngle}function ba(e){return e.endAngle}function wa(e){return e&&e.padAngle}function xa(e,t,n,i){return(e-n)*t-(t-i)*e>0?0:1}function ka(e,t,n,i,r){var a=e[0]-t[0],o=e[1]-t[1],s=(r?i:-i)/Math.sqrt(a*a+o*o),l=s*o,c=-s*a,d=e[0]+l,u=e[1]+c,h=t[0]+l,f=t[1]+c,p=(d+h)/2,g=(u+f)/2,m=h-d,_=f-u,v=m*m+_*_,y=n-i,b=d*f-h*u,w=(_<0?-1:1)*Math.sqrt(Math.max(0,y*y*v-b*b)),x=(b*_-m*w)/v,k=(-b*m-_*w)/v,M=(b*_+m*w)/v,C=(-b*m+_*w)/v,S=x-p,T=k-g,E=M-p,j=C-g;return S*S+T*T>E*E+j*j&&(x=M,k=C),[[x-l,k-c],[x*n/y,k*n/y]]}function Ma(e){function t(t){function o(){c.push("M",a(e(d),s))}for(var l,c=[],d=[],u=-1,h=t.length,f=Ne(n),p=Ne(i);++u<h;)r.call(this,l=t[u],u)?d.push([+f.call(this,l,u),+p.call(this,l,u)]):d.length&&(o(),d=[]);return d.length&&o(),c.length?c.join(""):null}var n=Dn,i=On,r=Dt,a=Ca,o=a.key,s=.7;return t.x=function(e){return arguments.length?(n=e,t):n},t.y=function(e){return arguments.length?(i=e,t):i},t.defined=function(e){return arguments.length?(r=e,t):r},t.interpolate=function(e){return arguments.length?(o="function"==typeof e?a=e:(a=Dl.get(e)||Ca).key,t):o},t.tension=function(e){return arguments.length?(s=e,t):s},t}function Ca(e){return e.length>1?e.join("L"):e+"Z"}function Sa(e){return e.join("L")+"Z"}function Ta(e){for(var t=0,n=e.length,i=e[0],r=[i[0],",",i[1]];++t<n;)r.push("H",(i[0]+(i=e[t])[0])/2,"V",i[1]);return n>1&&r.push("H",i[0]),r.join("")}function Ea(e){for(var t=0,n=e.length,i=e[0],r=[i[0],",",i[1]];++t<n;)r.push("V",(i=e[t])[1],"H",i[0]);return r.join("")}function ja(e){for(var t=0,n=e.length,i=e[0],r=[i[0],",",i[1]];++t<n;)r.push("H",(i=e[t])[0],"V",i[1]);return r.join("")}function Aa(e,t){return e.length<4?Ca(e):e[1]+Ia(e.slice(1,-1),Da(e,t))}function Na(e,t){return e.length<3?Sa(e):e[0]+Ia((e.push(e[0]),e),Da([e[e.length-2]].concat(e,[e[1]]),t))}function La(e,t){return e.length<3?Ca(e):e[0]+Ia(e,Da(e,t))}function Ia(e,t){if(t.length<1||e.length!=t.length&&e.length!=t.length+2)return Ca(e);var n=e.length!=t.length,i="",r=e[0],a=e[1],o=t[0],s=o,l=1;if(n&&(i+="Q"+(a[0]-2*o[0]/3)+","+(a[1]-2*o[1]/3)+","+a[0]+","+a[1],r=e[1],l=2),t.length>1){s=t[1],a=e[l],l++,i+="C"+(r[0]+o[0])+","+(r[1]+o[1])+","+(a[0]-s[0])+","+(a[1]-s[1])+","+a[0]+","+a[1];for(var c=2;c<t.length;c++,l++)a=e[l],s=t[c],i+="S"+(a[0]-s[0])+","+(a[1]-s[1])+","+a[0]+","+a[1]}if(n){var d=e[l];i+="Q"+(a[0]+2*s[0]/3)+","+(a[1]+2*s[1]/3)+","+d[0]+","+d[1]}return i}function Da(e,t){for(var n,i=[],r=(1-t)/2,a=e[0],o=e[1],s=1,l=e.length;++s<l;)n=a,a=o,o=e[s],i.push([r*(o[0]-n[0]),r*(o[1]-n[1])]);return i}function Oa(e){if(e.length<3)return Ca(e);var t=1,n=e.length,i=e[0],r=i[0],a=i[1],o=[r,r,r,(i=e[1])[0]],s=[a,a,a,i[1]],l=[r,",",a,"L",$a(Wl,o),",",$a(Wl,s)];for(e.push(e[n-1]);++t<=n;)i=e[t],o.shift(),o.push(i[0]),s.shift(),s.push(i[1]),za(l,o,s);return e.pop(),l.push("L",i),l.join("")}function Pa(e){if(e.length<4)return Ca(e);for(var t,n=[],i=-1,r=e.length,a=[0],o=[0];++i<3;)t=e[i],a.push(t[0]),o.push(t[1]);for(n.push($a(Wl,a)+","+$a(Wl,o)),--i;++i<r;)t=e[i],a.shift(),a.push(t[0]),o.shift(),o.push(t[1]),za(n,a,o);return n.join("")}function Wa(e){for(var t,n,i=-1,r=e.length,a=r+4,o=[],s=[];++i<4;)n=e[i%r],o.push(n[0]),s.push(n[1]);for(t=[$a(Wl,o),",",$a(Wl,s)],--i;++i<a;)n=e[i%r],o.shift(),o.push(n[0]),s.shift(),s.push(n[1]),za(t,o,s);return t.join("")}function Ra(e,t){var n=e.length-1;if(n)for(var i,r,a=e[0][0],o=e[0][1],s=e[n][0]-a,l=e[n][1]-o,c=-1;++c<=n;)i=e[c],r=c/n,i[0]=t*i[0]+(1-t)*(a+r*s),i[1]=t*i[1]+(1-t)*(o+r*l);return Oa(e)}function $a(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]}function za(e,t,n){e.push("C",$a(Ol,t),",",$a(Ol,n),",",$a(Pl,t),",",$a(Pl,n),",",$a(Wl,t),",",$a(Wl,n))}function Ha(e,t){return(t[1]-e[1])/(t[0]-e[0])}function Va(e){for(var t=0,n=e.length-1,i=[],r=e[0],a=e[1],o=i[0]=Ha(r,a);++t<n;)i[t]=(o+(o=Ha(r=a,a=e[t+1])))/2;return i[t]=o,i}function Ya(e){for(var t,n,i,r,a=[],o=Va(e),s=-1,l=e.length-1;++s<l;)t=Ha(e[s],e[s+1]),ko(t)<zo?o[s]=o[s+1]=0:(n=o[s]/t,i=o[s+1]/t,(r=n*n+i*i)>9&&(r=3*t/Math.sqrt(r),o[s]=r*n,o[s+1]=r*i));for(s=-1;++s<=l;)r=(e[Math.min(l,s+1)][0]-e[Math.max(0,s-1)][0])/(6*(1+o[s]*o[s])),a.push([r||0,o[s]*r||0]);return a}function Fa(e){return e.length<3?Ca(e):e[0]+Ia(e,Ya(e))}function Ga(e){for(var t,n,i,r=-1,a=e.length;++r<a;)t=e[r],n=t[0],i=t[1]-Go,t[0]=n*Math.cos(i),t[1]=n*Math.sin(i);return e}function Ua(e){function t(t){function l(){g.push("M",s(e(_),u),d,c(e(m.reverse()),u),"Z")}for(var h,f,p,g=[],m=[],_=[],v=-1,y=t.length,b=Ne(n),w=Ne(r),x=n===i?function(){return f}:Ne(i),k=r===a?function(){return p}:Ne(a);++v<y;)o.call(this,h=t[v],v)?(m.push([f=+b.call(this,h,v),p=+w.call(this,h,v)]),_.push([+x.call(this,h,v),+k.call(this,h,v)])):m.length&&(l(),m=[],_=[]);return m.length&&l(),g.length?g.join(""):null}var n=Dn,i=Dn,r=0,a=On,o=Dt,s=Ca,l=s.key,c=s,d="L",u=.7;return t.x=function(e){return arguments.length?(n=i=e,t):i},t.x0=function(e){return arguments.length?(n=e,t):n},t.x1=function(e){return arguments.length?(i=e,t):i},t.y=function(e){return arguments.length?(r=a=e,t):a},t.y0=function(e){return arguments.length?(r=e,t):r},t.y1=function(e){return arguments.length?(a=e,t):a},t.defined=function(e){return arguments.length?(o=e,t):o},t.interpolate=function(e){return arguments.length?(l="function"==typeof e?s=e:(s=Dl.get(e)||Ca).key,c=s.reverse||s,d=s.closed?"M":"L",t):l},t.tension=function(e){return arguments.length?(u=e,t):u},t}function qa(e){return e.radius}function Ba(e){return[e.x,e.y]}function Ja(e){return function(){var t=e.apply(this,arguments),n=t[0],i=t[1]-Go;return[n*Math.cos(i),n*Math.sin(i)]}}function Qa(){return 64}function Xa(){return"circle"}function Ka(e){var t=Math.sqrt(e/Vo);return"M0,"+t+"A"+t+","+t+" 0 1,1 0,"+-t+"A"+t+","+t+" 0 1,1 0,"+t+"Z"}function Za(e){return function(){var t,n,i;(t=this[e])&&(i=t[n=t.active])&&(i.timer.c=null,i.timer.t=NaN,--t.count?delete t[n]:delete this[e],t.active+=.5,i.event&&i.event.interrupt.call(this,this.__data__,i.index))}}function eo(e,t,n){return Eo(e,Fl),e.namespace=t,e.id=n,e}function to(e,t,n,i){var r=e.id,a=e.namespace;return B(e,"function"==typeof n?function(e,o,s){e[a][r].tween.set(t,i(n.call(e,e.__data__,o,s)))}:(n=i(n),function(e){e[a][r].tween.set(t,n)}))}function no(e){return null==e&&(e=""),function(){this.textContent=e}}function io(e){return null==e?"__transition__":"__transition_"+e+"__"}function ro(e,t,n,i,r){function a(e){var t=g.delay;if(c.t=t+l,t<=e)return o(e-t);c.c=o}function o(n){var r=f.active,a=f[r];a&&(a.timer.c=null,a.timer.t=NaN,--f.count,delete f[r],a.event&&a.event.interrupt.call(e,e.__data__,a.index));for(var o in f)if(+o<i){var p=f[o];p.timer.c=null,p.timer.t=NaN,--f.count,delete f[o]}c.c=s,Pe(function(){return c.c&&s(n||1)&&(c.c=null,c.t=NaN),1},0,l),f.active=i,g.event&&g.event.start.call(e,e.__data__,t),h=[],g.tween.forEach(function(n,i){(i=i.call(e,e.__data__,t))&&h.push(i)}),u=g.ease,d=g.duration}function s(r){for(var a=r/d,o=u(a),s=h.length;s>0;)h[--s].call(e,o);if(a>=1)return g.event&&g.event.end.call(e,e.__data__,t),--f.count?delete f[i]:delete e[n],1}var l,c,d,u,h,f=e[n]||(e[n]={active:0,count:0}),g=f[i];g||(l=r.time,c=Pe(a,0,l),g=f[i]={tween:new p,time:l,timer:c,delay:r.delay,duration:r.duration,ease:r.ease,index:t},r=null,++f.count)}function ao(e,t,n){e.attr("transform",function(e){var i=t(e);return"translate("+(isFinite(i)?i:n(e))+",0)"})}function oo(e,t,n){e.attr("transform",function(e){var i=t(e);return"translate(0,"+(isFinite(i)?i:n(e))+")"})}function so(e){return e.toISOString()}function lo(e,t,n){function i(t){return e(t)}function r(e,n){var i=e[1]-e[0],r=i/n,a=fo.bisect(Zl,r);return a==Zl.length?[t.year,ia(e.map(function(e){return e/31536e6}),n)[2]]:a?t[r/Zl[a-1]<Zl[a]/r?a-1:a]:[nc,ia(e,n)[2]]}return i.invert=function(t){return co(e.invert(t))},i.domain=function(t){return arguments.length?(e.domain(t),i):e.domain().map(co)},i.nice=function(e,t){function n(n){return!isNaN(n)&&!e.range(n,co(+n+1),t).length}var a=i.domain(),o=Br(a),s=null==e?r(o,10):"number"==typeof e&&r(o,e);return s&&(e=s[0],t=s[1]),i.domain(Xr(a,t>1?{floor:function(t){for(;n(t=e.floor(t));)t=co(t-1);return t},ceil:function(t){for(;n(t=e.ceil(t));)t=co(+t+1);return t}}:e))},i.ticks=function(e,t){var n=Br(i.domain()),a=null==e?r(n,10):"number"==typeof e?r(n,e):!e.range&&[{range:e},t];return a&&(e=a[0],t=a[1]),e.range(n[0],co(+n[1]+1),t<1?1:t)},i.tickFormat=function(){return n},i.copy=function(){return lo(e.copy(),t,n)},ta(i,e)}function co(e){return new Date(e)}function uo(e){return JSON.parse(e.responseText)}function ho(e){var t=mo.createRange();return t.selectNode(mo.body),t.createContextualFragment(e.responseText)}var fo={version:"3.5.17"},po=[].slice,go=function(e){return po.call(e)},mo=this.document;if(mo)try{go(mo.documentElement.childNodes)[0].nodeType}catch(e){go=function(e){for(var t=e.length,n=new Array(t);t--;)n[t]=e[t];return n}}if(Date.now||(Date.now=function(){return+new Date}),mo)try{mo.createElement("DIV").style.setProperty("opacity",0,"")}catch(e){var _o=this.Element.prototype,vo=_o.setAttribute,yo=_o.setAttributeNS,bo=this.CSSStyleDeclaration.prototype,wo=bo.setProperty;_o.setAttribute=function(e,t){vo.call(this,e,t+"")},_o.setAttributeNS=function(e,t,n){yo.call(this,e,t,n+"")},bo.setProperty=function(e,t,n){wo.call(this,e,t+"",n)}}fo.ascending=s,fo.descending=function(e,t){return t<e?-1:t>e?1:t>=e?0:NaN},fo.min=function(e,t){var n,i,r=-1,a=e.length;if(1===arguments.length){for(;++r<a;)if(null!=(i=e[r])&&i>=i){n=i;break}for(;++r<a;)null!=(i=e[r])&&n>i&&(n=i)}else{for(;++r<a;)if(null!=(i=t.call(e,e[r],r))&&i>=i){n=i;break}for(;++r<a;)null!=(i=t.call(e,e[r],r))&&n>i&&(n=i)}return n},fo.max=function(e,t){var n,i,r=-1,a=e.length;if(1===arguments.length){for(;++r<a;)if(null!=(i=e[r])&&i>=i){n=i;break}for(;++r<a;)null!=(i=e[r])&&i>n&&(n=i)}else{for(;++r<a;)if(null!=(i=t.call(e,e[r],r))&&i>=i){n=i;break}for(;++r<a;)null!=(i=t.call(e,e[r],r))&&i>n&&(n=i)}return n},fo.extent=function(e,t){var n,i,r,a=-1,o=e.length;if(1===arguments.length){for(;++a<o;)if(null!=(i=e[a])&&i>=i){n=r=i;break}for(;++a<o;)null!=(i=e[a])&&(n>i&&(n=i),r<i&&(r=i))}else{for(;++a<o;)if(null!=(i=t.call(e,e[a],a))&&i>=i){n=r=i;break}for(;++a<o;)null!=(i=t.call(e,e[a],a))&&(n>i&&(n=i),r<i&&(r=i))}return[n,r]},fo.sum=function(e,t){var n,i=0,r=e.length,a=-1;if(1===arguments.length)for(;++a<r;)c(n=+e[a])&&(i+=n);else for(;++a<r;)c(n=+t.call(e,e[a],a))&&(i+=n);return i},fo.mean=function(e,t){var n,i=0,r=e.length,a=-1,o=r;if(1===arguments.length)for(;++a<r;)c(n=l(e[a]))?i+=n:--o;else for(;++a<r;)c(n=l(t.call(e,e[a],a)))?i+=n:--o;if(o)return i/o},fo.quantile=function(e,t){var n=(e.length-1)*t+1,i=Math.floor(n),r=+e[i-1],a=n-i;return a?r+a*(e[i]-r):r},fo.median=function(e,t){var n,i=[],r=e.length,a=-1;if(1===arguments.length)for(;++a<r;)c(n=l(e[a]))&&i.push(n);else for(;++a<r;)c(n=l(t.call(e,e[a],a)))&&i.push(n);if(i.length)return fo.quantile(i.sort(s),.5)},fo.variance=function(e,t){var n,i,r=e.length,a=0,o=0,s=-1,d=0;if(1===arguments.length)for(;++s<r;)c(n=l(e[s]))&&(i=n-a,a+=i/++d,o+=i*(n-a));else for(;++s<r;)c(n=l(t.call(e,e[s],s)))&&(i=n-a,a+=i/++d,o+=i*(n-a));if(d>1)return o/(d-1)},fo.deviation=function(){var e=fo.variance.apply(this,arguments);return e?Math.sqrt(e):e};var xo=d(s);fo.bisectLeft=xo.left,fo.bisect=fo.bisectRight=xo.right,fo.bisector=function(e){return d(1===e.length?function(t,n){return s(e(t),n)}:e)},fo.shuffle=function(e,t,n){(a=arguments.length)<3&&(n=e.length,a<2&&(t=0));for(var i,r,a=n-t;a;)r=Math.random()*a--|0,i=e[a+t],e[a+t]=e[r+t],e[r+t]=i;return e},fo.permute=function(e,t){for(var n=t.length,i=new Array(n);n--;)i[n]=e[t[n]];return i},fo.pairs=function(e){for(var t=0,n=e.length-1,i=e[0],r=new Array(n<0?0:n);t<n;)r[t]=[i,i=e[++t]];return r},fo.transpose=function(e){if(!(r=e.length))return[];for(var t=-1,n=fo.min(e,u),i=new Array(n);++t<n;)for(var r,a=-1,o=i[t]=new Array(r);++a<r;)o[a]=e[a][t];return i},fo.zip=function(){return fo.transpose(arguments)},fo.keys=function(e){var t=[];for(var n in e)t.push(n);return t},fo.values=function(e){var t=[];for(var n in e)t.push(e[n]);return t},fo.entries=function(e){var t=[];for(var n in e)t.push({key:n,value:e[n]});return t},fo.merge=function(e){for(var t,n,i,r=e.length,a=-1,o=0;++a<r;)o+=e[a].length;for(n=new Array(o);--r>=0;)for(i=e[r],t=i.length;--t>=0;)n[--o]=i[t];return n};var ko=Math.abs;fo.range=function(e,t,n){if(arguments.length<3&&(n=1,arguments.length<2&&(t=e,e=0)),(t-e)/n==1/0)throw new Error("infinite range");var i,r=[],a=h(ko(n)),o=-1;if(e*=a,t*=a,n*=a,n<0)for(;(i=e+n*++o)>t;)r.push(i/a);else for(;(i=e+n*++o)<t;)r.push(i/a);return r},fo.map=function(e,t){var n=new p;if(e instanceof p)e.forEach(function(e,t){n.set(e,t)});else if(Array.isArray(e)){var i,r=-1,a=e.length;if(1===arguments.length)for(;++r<a;)n.set(r,e[r]);else for(;++r<a;)n.set(t.call(e,i=e[r],r),i)}else for(var o in e)n.set(o,e[o]);return n};var Mo="__proto__",Co="\0";f(p,{has:_,get:function(e){return this._[g(e)]},set:function(e,t){return this._[g(e)]=t},remove:v,keys:y,values:function(){var e=[];for(var t in this._)e.push(this._[t]);return e},entries:function(){var e=[];for(var t in this._)e.push({key:m(t),value:this._[t]});return e},size:b,empty:w,forEach:function(e){for(var t in this._)e.call(this,m(t),this._[t])}}),fo.nest=function(){function e(t,o,s){if(s>=a.length)return i?i.call(r,o):n?o.sort(n):o;for(var l,c,d,u,h=-1,f=o.length,g=a[s++],m=new p;++h<f;)(u=m.get(l=g(c=o[h])))?u.push(c):m.set(l,[c]);return t?(c=t(),d=function(n,i){c.set(n,e(t,i,s))}):(c={},d=function(n,i){c[n]=e(t,i,s)}),m.forEach(d),c}function t(e,n){if(n>=a.length)return e;var i=[],r=o[n++];return e.forEach(function(e,r){i.push({key:e,values:t(r,n)})}),r?i.sort(function(e,t){return r(e.key,t.key)}):i}var n,i,r={},a=[],o=[];return r.map=function(t,n){return e(n,t,0)},r.entries=function(n){return t(e(fo.map,n,0),0)},r.key=function(e){return a.push(e),r},r.sortKeys=function(e){return o[a.length-1]=e,r},r.sortValues=function(e){return n=e,r},r.rollup=function(e){return i=e,r},r},fo.set=function(e){var t=new x;if(e)for(var n=0,i=e.length;n<i;++n)t.add(e[n]);return t},f(x,{has:_,add:function(e){return this._[g(e+="")]=!0,e},remove:v,values:y,size:b,empty:w,forEach:function(e){for(var t in this._)e.call(this,m(t))}}),fo.behavior={},fo.rebind=function(e,t){for(var n,i=1,r=arguments.length;++i<r;)e[n=arguments[i]]=M(e,t,t[n]);return e};var So=["webkit","ms","moz","Moz","o","O"];fo.dispatch=function(){for(var e=new T,t=-1,n=arguments.length;++t<n;)e[arguments[t]]=E(e);return e},T.prototype.on=function(e,t){var n=e.indexOf("."),i="";if(n>=0&&(i=e.slice(n+1),e=e.slice(0,n)),e)return arguments.length<2?this[e].on(i):this[e].on(i,t);if(2===arguments.length){if(null==t)for(e in this)this.hasOwnProperty(e)&&this[e].on(i,null);return this}},fo.event=null,fo.requote=function(e){return e.replace(To,"\\$&")};var To=/[\\\^\$\*\+\?\|\[\]\(\)\.\{\}]/g,Eo={}.__proto__?function(e,t){e.__proto__=t}:function(e,t){for(var n in t)e[n]=t[n]},jo=function(e,t){return t.querySelector(e)},Ao=function(e,t){return t.querySelectorAll(e)},No=function(e,t){var n=e.matches||e[C(e,"matchesSelector")];return(No=function(e,t){return n.call(e,t)})(e,t)};"function"==typeof Sizzle&&(jo=function(e,t){return Sizzle(e,t)[0]||null},Ao=Sizzle,No=Sizzle.matchesSelector),fo.selection=function(){return fo.select(mo.documentElement)};var Lo=fo.selection.prototype=[];Lo.select=function(e){var t,n,i,r,a=[];e=I(e);for(var o=-1,s=this.length;++o<s;){a.push(t=[]),t.parentNode=(i=this[o]).parentNode;for(var l=-1,c=i.length;++l<c;)(r=i[l])?(t.push(n=e.call(r,r.__data__,l,o)),n&&"__data__"in r&&(n.__data__=r.__data__)):t.push(null)}return L(a)},Lo.selectAll=function(e){var t,n,i=[];e=D(e);for(var r=-1,a=this.length;++r<a;)for(var o=this[r],s=-1,l=o.length;++s<l;)(n=o[s])&&(i.push(t=go(e.call(n,n.__data__,s,r))),t.parentNode=n);return L(i)};var Io="http://www.w3.org/1999/xhtml",Do={svg:"http://www.w3.org/2000/svg",xhtml:Io,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};fo.ns={prefix:Do,qualify:function(e){var t=e.indexOf(":"),n=e;return t>=0&&"xmlns"!==(n=e.slice(0,t))&&(e=e.slice(t+1)),Do.hasOwnProperty(n)?{space:Do[n],local:e}:e}},Lo.attr=function(e,t){if(arguments.length<2){if("string"==typeof e){var n=this.node();return e=fo.ns.qualify(e),e.local?n.getAttributeNS(e.space,e.local):n.getAttribute(e)}for(t in e)this.each(O(t,e[t]));return this}return this.each(O(e,t))},Lo.classed=function(e,t){if(arguments.length<2){if("string"==typeof e){var n=this.node(),i=(e=R(e)).length,r=-1;if(t=n.classList){for(;++r<i;)if(!t.contains(e[r]))return!1}else for(t=n.getAttribute("class");++r<i;)if(!W(e[r]).test(t))return!1;return!0}for(t in e)this.each($(t,e[t]));return this}return this.each($(e,t))},Lo.style=function(e,t,n){var i=arguments.length;if(i<3){if("string"!=typeof e){i<2&&(t="");for(n in e)this.each(H(n,e[n],t));return this}if(i<2){var r=this.node();return o(r).getComputedStyle(r,null).getPropertyValue(e)}n=""}return this.each(H(e,t,n))},Lo.property=function(e,t){if(arguments.length<2){if("string"==typeof e)return this.node()[e];for(t in e)this.each(V(t,e[t]));return this}return this.each(V(e,t))},Lo.text=function(e){return arguments.length?this.each("function"==typeof e?function(){var t=e.apply(this,arguments);this.textContent=null==t?"":t}:null==e?function(){this.textContent=""}:function(){this.textContent=e}):this.node().textContent},Lo.html=function(e){return arguments.length?this.each("function"==typeof e?function(){var t=e.apply(this,arguments);this.innerHTML=null==t?"":t}:null==e?function(){this.innerHTML=""}:function(){this.innerHTML=e}):this.node().innerHTML},Lo.append=function(e){return e=Y(e),this.select(function(){return this.appendChild(e.apply(this,arguments))})},Lo.insert=function(e,t){return e=Y(e),t=I(t),this.select(function(){return this.insertBefore(e.apply(this,arguments),t.apply(this,arguments)||null)})},Lo.remove=function(){return this.each(F)},Lo.data=function(e,t){function n(e,n){var i,r,a,o=e.length,d=n.length,u=Math.min(o,d),h=new Array(d),f=new Array(d),g=new Array(o);if(t){var m,_=new p,v=new Array(o);for(i=-1;++i<o;)(r=e[i])&&(_.has(m=t.call(r,r.__data__,i))?g[i]=r:_.set(m,r),v[i]=m);for(i=-1;++i<d;)(r=_.get(m=t.call(n,a=n[i],i)))?!0!==r&&(h[i]=r,r.__data__=a):f[i]=G(a),_.set(m,!0);for(i=-1;++i<o;)i in v&&!0!==_.get(v[i])&&(g[i]=e[i])}else{for(i=-1;++i<u;)r=e[i],a=n[i],r?(r.__data__=a,h[i]=r):f[i]=G(a);for(;i<d;++i)f[i]=G(n[i]);for(;i<o;++i)g[i]=e[i]}f.update=h,f.parentNode=h.parentNode=g.parentNode=e.parentNode,s.push(f),l.push(h),c.push(g)}var i,r,a=-1,o=this.length;if(!arguments.length){for(e=new Array(o=(i=this[0]).length);++a<o;)(r=i[a])&&(e[a]=r.__data__);return e}var s=J([]),l=L([]),c=L([]);if("function"==typeof e)for(;++a<o;)n(i=this[a],e.call(i,i.parentNode.__data__,a));else for(;++a<o;)n(i=this[a],e);return l.enter=function(){return s},l.exit=function(){return c},l},Lo.datum=function(e){return arguments.length?this.property("__data__",e):this.property("__data__")},Lo.filter=function(e){var t,n,i,r=[];"function"!=typeof e&&(e=U(e));for(var a=0,o=this.length;a<o;a++){r.push(t=[]),t.parentNode=(n=this[a]).parentNode;for(var s=0,l=n.length;s<l;s++)(i=n[s])&&e.call(i,i.__data__,s,a)&&t.push(i)}return L(r)},Lo.order=function(){for(var e=-1,t=this.length;++e<t;)for(var n,i=this[e],r=i.length-1,a=i[r];--r>=0;)(n=i[r])&&(a&&a!==n.nextSibling&&a.parentNode.insertBefore(n,a),a=n);return this},Lo.sort=function(e){e=q.apply(this,arguments);for(var t=-1,n=this.length;++t<n;)this[t].sort(e);return this.order()},Lo.each=function(e){return B(this,function(t,n,i){e.call(t,t.__data__,n,i)})},Lo.call=function(e){var t=go(arguments);return e.apply(t[0]=this,t),this},Lo.empty=function(){return!this.node()},Lo.node=function(){for(var e=0,t=this.length;e<t;e++)for(var n=this[e],i=0,r=n.length;i<r;i++){var a=n[i];if(a)return a}return null},Lo.size=function(){var e=0;return B(this,function(){++e}),e};var Oo=[];fo.selection.enter=J,fo.selection.enter.prototype=Oo,Oo.append=Lo.append,Oo.empty=Lo.empty,Oo.node=Lo.node,Oo.call=Lo.call,Oo.size=Lo.size,Oo.select=function(e){for(var t,n,i,r,a,o=[],s=-1,l=this.length;++s<l;){i=(r=this[s]).update,o.push(t=[]),t.parentNode=r.parentNode;for(var c=-1,d=r.length;++c<d;)(a=r[c])?(t.push(i[c]=n=e.call(r.parentNode,a.__data__,c,s)),n.__data__=a.__data__):t.push(null)}return L(o)},Oo.insert=function(e,t){return arguments.length<2&&(t=Q(this)),Lo.insert.call(this,e,t)},fo.select=function(e){var t;return"string"==typeof e?(t=[jo(e,mo)],t.parentNode=mo.documentElement):(t=[e],t.parentNode=a(e)),L([t])},fo.selectAll=function(e){var t;return"string"==typeof e?(t=go(Ao(e,mo)),t.parentNode=mo.documentElement):(t=go(e),t.parentNode=null),L([t])},Lo.on=function(e,t,n){var i=arguments.length;if(i<3){if("string"!=typeof e){i<2&&(t=!1);for(n in e)this.each(X(n,e[n],t));return this}if(i<2)return(i=this.node()["__on"+e])&&i._;n=!1}return this.each(X(e,t,n))};var Po=fo.map({mouseenter:"mouseover",mouseleave:"mouseout"});mo&&Po.forEach(function(e){"on"+e in mo&&Po.remove(e)});var Wo,Ro=0;fo.mouse=function(e){return te(e,A())};var $o=this.navigator&&/WebKit/.test(this.navigator.userAgent)?-1:0;fo.touch=function(e,t,n){if(arguments.length<3&&(n=t,t=A().changedTouches),t)for(var i,r=0,a=t.length;r<a;++r)if((i=t[r]).identifier===n)return te(e,i)},fo.behavior.drag=function(){function e(){this.on("mousedown.drag",r).on("touchstart.drag",a)}function t(e,t,r,a,o){return function(){function s(){var e,n,i=t(h,g);i&&(e=i[0]-y[0],n=i[1]-y[1],p|=e|n,y=i,f({type:"drag",x:i[0]+c[0],y:i[1]+c[1],dx:e,dy:n}))}function l(){t(h,g)&&(_.on(a+m,null).on(o+m,null),v(p),f({type:"dragend"}))}var c,d=this,u=fo.event.target.correspondingElement||fo.event.target,h=d.parentNode,f=n.of(d,arguments),p=0,g=e(),m=".drag"+(null==g?"":"-"+g),_=fo.select(r(u)).on(a+m,s).on(o+m,l),v=ee(u),y=t(h,g);i?(c=i.apply(d,arguments),c=[c.x-y[0],c.y-y[1]]):c=[0,0],f({type:"dragstart"})}}var n=N(e,"drag","dragstart","dragend"),i=null,r=t(S,fo.mouse,o,"mousemove","mouseup"),a=t(ne,fo.touch,k,"touchmove","touchend");return e.origin=function(t){return arguments.length?(i=t,e):i},fo.rebind(e,n,"on")},fo.touches=function(e,t){return arguments.length<2&&(t=A().touches),t?go(t).map(function(t){var n=te(e,t);return n.identifier=t.identifier,n}):[]};var zo=1e-6,Ho=zo*zo,Vo=Math.PI,Yo=2*Vo,Fo=Yo-zo,Go=Vo/2,Uo=Vo/180,qo=180/Vo,Bo=Math.SQRT2;fo.interpolateZoom=function(e,t){var n,i,r=e[0],a=e[1],o=e[2],s=t[0],l=t[1],c=t[2],d=s-r,u=l-a,h=d*d+u*u;if(h<Ho)i=Math.log(c/o)/Bo,n=function(e){return[r+e*d,a+e*u,o*Math.exp(Bo*e*i)]};else{var f=Math.sqrt(h),p=(c*c-o*o+4*h)/(2*o*2*f),g=(c*c-o*o-4*h)/(2*c*2*f),m=Math.log(Math.sqrt(p*p+1)-p),_=Math.log(Math.sqrt(g*g+1)-g);i=(_-m)/Bo,n=function(e){var t=e*i,n=le(m),s=o/(2*f)*(n*ce(Bo*t+m)-se(m));return[r+s*d,a+s*u,o*n/le(Bo*t+m)]}}return n.duration=1e3*i,n},fo.behavior.zoom=function(){function e(e){e.on(A,u).on(Qo+".zoom",f).on("dblclick.zoom",p).on(D,h)}function t(e){return[(e[0]-M.x)/M.k,(e[1]-M.y)/M.k]}function n(e){return[e[0]*M.k+M.x,e[1]*M.k+M.y]}function i(e){M.k=Math.max(S[0],Math.min(S[1],e))}function r(e,t){t=n(t),M.x+=e[0]-t[0],M.y+=e[1]-t[1]}function a(t,n,a,o){t.__chart__={x:M.x,y:M.y,k:M.k},i(Math.pow(2,o)),r(m=n,a),t=fo.select(t),T>0&&(t=t.transition().duration(T)),t.call(e.event)}function s(){w&&w.domain(b.range().map(function(e){return(e-M.x)/M.k}).map(b.invert)),k&&k.domain(x.range().map(function(e){return(e-M.y)/M.k}).map(x.invert))}function l(e){E++||e({type:"zoomstart"})}function c(e){s(),e({type:"zoom",scale:M.k,translate:[M.x,M.y]})}function d(e){--E||(e({type:"zoomend"}),m=null)}function u(){function e(){s=1,r(fo.mouse(i),h),c(a)}function n(){u.on(L,null).on(I,null),f(s),d(a)}var i=this,a=O.of(i,arguments),s=0,u=fo.select(o(i)).on(L,e).on(I,n),h=t(fo.mouse(i)),f=ee(i);Yl.call(i),l(a)}function h(){function e(){var e=fo.touches(p);return f=M.k,e.forEach(function(e){e.identifier in m&&(m[e.identifier]=t(e))}),e}function n(){var t=fo.event.target;fo.select(t).on(b,o).on(w,s),x.push(t);for(var n=fo.event.changedTouches,i=0,r=n.length;i<r;++i)m[n[i].identifier]=null;var l=e(),c=Date.now();if(1===l.length){if(c-y<500){var d=l[0];a(p,d,m[d.identifier],Math.floor(Math.log(M.k)/Math.LN2)+1),j()}y=c}else if(l.length>1){var d=l[0],u=l[1],h=d[0]-u[0],f=d[1]-u[1];_=h*h+f*f}}function o(){var e,t,n,a,o=fo.touches(p);Yl.call(p);for(var s=0,l=o.length;s<l;++s,a=null)if(n=o[s],a=m[n.identifier]){if(t)break;e=n,t=a}if(a){var d=(d=n[0]-e[0])*d+(d=n[1]-e[1])*d,u=_&&Math.sqrt(d/_);e=[(e[0]+n[0])/2,(e[1]+n[1])/2],t=[(t[0]+a[0])/2,(t[1]+a[1])/2],i(u*f)}y=null,r(e,t),c(g)}function s(){if(fo.event.touches.length){for(var t=fo.event.changedTouches,n=0,i=t.length;n<i;++n)delete m[t[n].identifier];for(var r in m)return void e()}fo.selectAll(x).on(v,null),k.on(A,u).on(D,h),C(),d(g)}var f,p=this,g=O.of(p,arguments),m={},_=0,v=".zoom-"+fo.event.changedTouches[0].identifier,b="touchmove"+v,w="touchend"+v,x=[],k=fo.select(p),C=ee(p);n(),l(g),k.on(A,null).on(D,n)}function f(){var e=O.of(this,arguments);v?clearTimeout(v):(Yl.call(this),g=t(m=_||fo.mouse(this)),l(e)),v=setTimeout(function(){v=null,d(e)},50),j(),i(Math.pow(2,.002*Jo())*M.k),r(m,g),c(e)}function p(){var e=fo.mouse(this),n=Math.log(M.k)/Math.LN2;a(this,e,t(e),fo.event.shiftKey?Math.ceil(n)-1:Math.floor(n)+1)}var g,m,_,v,y,b,w,x,k,M={x:0,y:0,k:1},C=[960,500],S=Xo,T=250,E=0,A="mousedown.zoom",L="mousemove.zoom",I="mouseup.zoom",D="touchstart.zoom",O=N(e,"zoomstart","zoom","zoomend");return Qo||(Qo="onwheel"in mo?(Jo=function(){return-fo.event.deltaY*(fo.event.deltaMode?120:1)},"wheel"):"onmousewheel"in mo?(Jo=function(){return fo.event.wheelDelta},"mousewheel"):(Jo=function(){return-fo.event.detail},"MozMousePixelScroll")),e.event=function(e){e.each(function(){var e=O.of(this,arguments),t=M;Hl?fo.select(this).transition().each("start.zoom",function(){M=this.__chart__||{x:0,y:0,k:1},l(e)}).tween("zoom:zoom",function(){var n=C[0],i=C[1],r=m?m[0]:n/2,a=m?m[1]:i/2,o=fo.interpolateZoom([(r-M.x)/M.k,(a-M.y)/M.k,n/M.k],[(r-t.x)/t.k,(a-t.y)/t.k,n/t.k]);return function(t){var i=o(t),s=n/i[2];this.__chart__=M={x:r-i[0]*s,y:a-i[1]*s,k:s},c(e)}}).each("interrupt.zoom",function(){d(e)}).each("end.zoom",function(){d(e)}):(this.__chart__=M,l(e),c(e),d(e))})},e.translate=function(t){return arguments.length?(M={x:+t[0],y:+t[1],k:M.k},s(),e):[M.x,M.y]},e.scale=function(t){return arguments.length?(M={x:M.x,y:M.y,k:null},i(+t),s(),e):M.k},e.scaleExtent=function(t){return arguments.length?(S=null==t?Xo:[+t[0],+t[1]],e):S},e.center=function(t){return arguments.length?(_=t&&[+t[0],+t[1]],e):_},e.size=function(t){return arguments.length?(C=t&&[+t[0],+t[1]],e):C},e.duration=function(t){return arguments.length?(T=+t,e):T},e.x=function(t){return arguments.length?(w=t,b=t.copy(),M={x:0,y:0,k:1},e):w},e.y=function(t){return arguments.length?(k=t,x=t.copy(),M={x:0,y:0,k:1},e):k},fo.rebind(e,O,"on")};var Jo,Qo,Xo=[0,1/0];fo.color=ue,ue.prototype.toString=function(){return this.rgb()+""},fo.hsl=he;var Ko=he.prototype=new ue;Ko.brighter=function(e){return e=Math.pow(.7,arguments.length?e:1),new he(this.h,this.s,this.l/e)},Ko.darker=function(e){return e=Math.pow(.7,arguments.length?e:1),new he(this.h,this.s,e*this.l)},Ko.rgb=function(){return fe(this.h,this.s,this.l)},fo.hcl=pe;var Zo=pe.prototype=new ue;Zo.brighter=function(e){return new pe(this.h,this.c,Math.min(100,this.l+es*(arguments.length?e:1)))},Zo.darker=function(e){return new pe(this.h,this.c,Math.max(0,this.l-es*(arguments.length?e:1)))},Zo.rgb=function(){return ge(this.h,this.c,this.l).rgb()},fo.lab=me;var es=18,ts=.95047,ns=1,is=1.08883,rs=me.prototype=new ue;rs.brighter=function(e){return new me(Math.min(100,this.l+es*(arguments.length?e:1)),this.a,this.b)},rs.darker=function(e){return new me(Math.max(0,this.l-es*(arguments.length?e:1)),this.a,this.b)},rs.rgb=function(){return _e(this.l,this.a,this.b)},fo.rgb=xe;var as=xe.prototype=new ue;as.brighter=function(e){e=Math.pow(.7,arguments.length?e:1);var t=this.r,n=this.g,i=this.b,r=30;return t||n||i?(t&&t<r&&(t=r),n&&n<r&&(n=r),i&&i<r&&(i=r),new xe(Math.min(255,t/e),Math.min(255,n/e),Math.min(255,i/e))):new xe(r,r,r)},as.darker=function(e){return e=Math.pow(.7,arguments.length?e:1),new xe(e*this.r,e*this.g,e*this.b)},as.hsl=function(){return Te(this.r,this.g,this.b)},as.toString=function(){return"#"+Ce(this.r)+Ce(this.g)+Ce(this.b)};var os=fo.map({aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074});os.forEach(function(e,t){os.set(e,ke(t))}),fo.functor=Ne,fo.xhr=Le(k),fo.dsv=function(e,t){function n(e,n,a){arguments.length<3&&(a=n,n=null);var o=Ie(e,t,null==n?i:r(n),a);return o.row=function(e){return arguments.length?o.response(null==(n=e)?i:r(e)):n},o}function i(e){return n.parse(e.responseText)}function r(e){return function(t){return n.parse(t.responseText,e)}}function a(t){return t.map(o).join(e)}function o(e){return s.test(e)?'"'+e.replace(/\"/g,'""')+'"':e}var s=new RegExp('["'+e+"\n]"),l=e.charCodeAt(0);return n.parse=function(e,t){var i;return n.parseRows(e,function(e,n){if(i)return i(e,n-1);var r=new Function("d","return {"+e.map(function(e,t){return JSON.stringify(e)+": d["+t+"]"}).join(",")+"}");i=t?function(e,n){return t(r(e),n)}:r})},n.parseRows=function(e,t){function n(){if(d>=c)return o;if(r)return r=!1,a;var t=d;if(34===e.charCodeAt(t)){for(var n=t;n++<c;)if(34===e.charCodeAt(n)){if(34!==e.charCodeAt(n+1))break;++n}d=n+2;var i=e.charCodeAt(n+1);return 13===i?(r=!0,10===e.charCodeAt(n+2)&&++d):10===i&&(r=!0),e.slice(t+1,n).replace(/""/g,'"')}for(;d<c;){var i=e.charCodeAt(d++),s=1;if(10===i)r=!0;else if(13===i)r=!0,10===e.charCodeAt(d)&&(++d,++s);else if(i!==l)continue;return e.slice(t,d-s)}return e.slice(t)}for(var i,r,a={},o={},s=[],c=e.length,d=0,u=0;(i=n())!==o;){for(var h=[];i!==a&&i!==o;)h.push(i),i=n();t&&null==(h=t(h,u++))||s.push(h)}return s},n.format=function(t){if(Array.isArray(t[0]))return n.formatRows(t);var i=new x,r=[];return t.forEach(function(e){for(var t in e)i.has(t)||r.push(i.add(t))}),[r.map(o).join(e)].concat(t.map(function(t){return r.map(function(e){return o(t[e])}).join(e)})).join("\n")},n.formatRows=function(e){return e.map(a).join("\n")},n},fo.csv=fo.dsv(",","text/csv"),fo.tsv=fo.dsv("\t","text/tab-separated-values");var ss,ls,cs,ds,us=this[C(this,"requestAnimationFrame")]||function(e){setTimeout(e,17)};fo.timer=function(){Pe.apply(this,arguments)},fo.timer.flush=function(){Re(),$e()},fo.round=function(e,t){return t?Math.round(e*(t=Math.pow(10,t)))/t:Math.round(e)};var hs=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"].map(He);fo.formatPrefix=function(e,t){var n=0;return(e=+e)&&(e<0&&(e*=-1),t&&(e=fo.round(e,ze(e,t))),n=1+Math.floor(1e-12+Math.log(e)/Math.LN10),n=Math.max(-24,Math.min(24,3*Math.floor((n-1)/3)))),hs[8+n/3]};var fs=/(?:([^{])?([<>=^]))?([+\- ])?([$#])?(0)?(\d+)?(,)?(\.-?\d+)?([a-z%])?/i,ps=fo.map({b:function(e){return e.toString(2)},c:function(e){return String.fromCharCode(e)},o:function(e){return e.toString(8)},x:function(e){return e.toString(16)},X:function(e){return e.toString(16).toUpperCase()},g:function(e,t){return e.toPrecision(t)},e:function(e,t){return e.toExponential(t)},f:function(e,t){return e.toFixed(t)},r:function(e,t){return(e=fo.round(e,ze(e,t))).toFixed(Math.max(0,Math.min(20,ze(e*(1+1e-15),t))))}}),gs=fo.time={},ms=Date;Fe.prototype={getDate:function(){return this._.getUTCDate()},getDay:function(){return this._.getUTCDay()},getFullYear:function(){return this._.getUTCFullYear()},getHours:function(){return this._.getUTCHours()},getMilliseconds:function(){return this._.getUTCMilliseconds()},getMinutes:function(){return this._.getUTCMinutes()},getMonth:function(){return this._.getUTCMonth()},getSeconds:function(){return this._.getUTCSeconds()},getTime:function(){return this._.getTime()},getTimezoneOffset:function(){return 0},valueOf:function(){return this._.valueOf()},setDate:function(){_s.setUTCDate.apply(this._,arguments)},setDay:function(){_s.setUTCDay.apply(this._,arguments)},setFullYear:function(){_s.setUTCFullYear.apply(this._,arguments)},setHours:function(){_s.setUTCHours.apply(this._,arguments)},setMilliseconds:function(){_s.setUTCMilliseconds.apply(this._,arguments)},setMinutes:function(){_s.setUTCMinutes.apply(this._,arguments)},setMonth:function(){_s.setUTCMonth.apply(this._,arguments)},setSeconds:function(){_s.setUTCSeconds.apply(this._,arguments)},setTime:function(){_s.setTime.apply(this._,arguments)}};var _s=Date.prototype;gs.year=Ge(function(e){return e=gs.day(e),e.setMonth(0,1),e},function(e,t){e.setFullYear(e.getFullYear()+t)},function(e){return e.getFullYear()}),gs.years=gs.year.range,gs.years.utc=gs.year.utc.range,gs.day=Ge(function(e){var t=new ms(2e3,0);return t.setFullYear(e.getFullYear(),e.getMonth(),e.getDate()),t},function(e,t){e.setDate(e.getDate()+t)},function(e){return e.getDate()-1}),gs.days=gs.day.range,gs.days.utc=gs.day.utc.range,gs.dayOfYear=function(e){var t=gs.year(e);return Math.floor((e-t-6e4*(e.getTimezoneOffset()-t.getTimezoneOffset()))/864e5)},["sunday","monday","tuesday","wednesday","thursday","friday","saturday"].forEach(function(e,t){t=7-t;var n=gs[e]=Ge(function(e){return(e=gs.day(e)).setDate(e.getDate()-(e.getDay()+t)%7),e},function(e,t){e.setDate(e.getDate()+7*Math.floor(t))},function(e){var n=gs.year(e).getDay();return Math.floor((gs.dayOfYear(e)+(n+t)%7)/7)-(n!==t)});gs[e+"s"]=n.range,gs[e+"s"].utc=n.utc.range,gs[e+"OfYear"]=function(e){var n=gs.year(e).getDay();return Math.floor((gs.dayOfYear(e)+(n+t)%7)/7)}}),gs.week=gs.sunday,gs.weeks=gs.sunday.range,gs.weeks.utc=gs.sunday.utc.range,gs.weekOfYear=gs.sundayOfYear;var vs={"-":"",_:" ",0:"0"},ys=/^\s*\d+/,bs=/^%/;fo.locale=function(e){return{numberFormat:Ve(e),timeFormat:qe(e)}};var ws=fo.locale({decimal:".",thousands:",",grouping:[3],currency:["$",""],dateTime:"%a %b %e %X %Y",date:"%m/%d/%Y",time:"%H:%M:%S",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});fo.format=ws.numberFormat,fo.geo={},pt.prototype={s:0,t:0,add:function(e){gt(e,this.t,xs),gt(xs.s,this.s,this),this.s?this.t+=xs.t:this.s=xs.t},reset:function(){this.s=this.t=0},valueOf:function(){return this.s}};var xs=new pt;fo.geo.stream=function(e,t){e&&ks.hasOwnProperty(e.type)?ks[e.type](e,t):mt(e,t)};var ks={Feature:function(e,t){mt(e.geometry,t)},FeatureCollection:function(e,t){for(var n=e.features,i=-1,r=n.length;++i<r;)mt(n[i].geometry,t)}},Ms={Sphere:function(e,t){t.sphere()},Point:function(e,t){e=e.coordinates,t.point(e[0],e[1],e[2])},MultiPoint:function(e,t){for(var n=e.coordinates,i=-1,r=n.length;++i<r;)e=n[i],t.point(e[0],e[1],e[2])},LineString:function(e,t){_t(e.coordinates,t,0)},MultiLineString:function(e,t){for(var n=e.coordinates,i=-1,r=n.length;++i<r;)_t(n[i],t,0)},Polygon:function(e,t){vt(e.coordinates,t)},MultiPolygon:function(e,t){for(var n=e.coordinates,i=-1,r=n.length;++i<r;)vt(n[i],t)},GeometryCollection:function(e,t){for(var n=e.geometries,i=-1,r=n.length;++i<r;)mt(n[i],t)}};fo.geo.area=function(e){return Cs=0,fo.geo.stream(e,Ts),Cs};var Cs,Ss=new pt,Ts={sphere:function(){Cs+=4*Vo},point:S,lineStart:S,lineEnd:S,polygonStart:function(){Ss.reset(),Ts.lineStart=yt},polygonEnd:function(){var e=2*Ss;Cs+=e<0?4*Vo+e:e,Ts.lineStart=Ts.lineEnd=Ts.point=S}};fo.geo.bounds=function(){function e(e,t){y.push(b=[d=e,h=e]),t<u&&(u=t),t>f&&(f=t)}function t(t,n){var i=bt([t*Uo,n*Uo]);if(_){var r=xt(_,i),a=[r[1],-r[0],0],o=xt(a,r);Ct(o),o=St(o);var l=t-p,c=l>0?1:-1,g=o[0]*qo*c,m=ko(l)>180;if(m^(c*p<g&&g<c*t)){var v=o[1]*qo;v>f&&(f=v)}else if(g=(g+360)%360-180,m^(c*p<g&&g<c*t)){var v=-o[1]*qo;v<u&&(u=v)}else n<u&&(u=n),n>f&&(f=n);m?t<p?s(d,t)>s(d,h)&&(h=t):s(t,h)>s(d,h)&&(d=t):h>=d?(t<d&&(d=t),t>h&&(h=t)):t>p?s(d,t)>s(d,h)&&(h=t):s(t,h)>s(d,h)&&(d=t)}else e(t,n);_=i,p=t}function n(){w.point=t}function i(){b[0]=d,b[1]=h,w.point=e,_=null}function r(e,n){if(_){var i=e-p;v+=ko(i)>180?i+(i>0?360:-360):i}else g=e,m=n;Ts.point(e,n),t(e,n)}function a(){Ts.lineStart()}function o(){r(g,m),Ts.lineEnd(),ko(v)>zo&&(d=-(h=180)),b[0]=d,b[1]=h,_=null}function s(e,t){return(t-=e)<0?t+360:t}function l(e,t){return e[0]-t[0]}function c(e,t){return t[0]<=t[1]?t[0]<=e&&e<=t[1]:e<t[0]||t[1]<e}var d,u,h,f,p,g,m,_,v,y,b,w={point:e,lineStart:n,lineEnd:i,polygonStart:function(){w.point=r,w.lineStart=a,w.lineEnd=o,v=0,Ts.polygonStart()},polygonEnd:function(){Ts.polygonEnd(),w.point=e,w.lineStart=n,w.lineEnd=i,Ss<0?(d=-(h=180),u=-(f=90)):v>zo?f=90:v<-zo&&(u=-90),b[0]=d,b[1]=h}};return function(e){f=h=-(d=u=1/0),y=[],fo.geo.stream(e,w);var t=y.length;if(t){y.sort(l);for(var n,i=1,r=y[0],a=[r];i<t;++i)n=y[i],c(n[0],r)||c(n[1],r)?(s(r[0],n[1])>s(r[0],r[1])&&(r[1]=n[1]),s(n[0],r[1])>s(r[0],r[1])&&(r[0]=n[0])):a.push(r=n);for(var o,n,p=-1/0,t=a.length-1,i=0,r=a[t];i<=t;r=n,++i)n=a[i],(o=s(r[1],n[0]))>p&&(p=o,d=n[0],h=r[1])}return y=b=null,d===1/0||u===1/0?[[NaN,NaN],[NaN,NaN]]:[[d,u],[h,f]]}}(),fo.geo.centroid=function(e){Es=js=As=Ns=Ls=Is=Ds=Os=Ps=Ws=Rs=0,fo.geo.stream(e,$s);var t=Ps,n=Ws,i=Rs,r=t*t+n*n+i*i;return r<Ho&&(t=Is,n=Ds,i=Os,js<zo&&(t=As,n=Ns,i=Ls),(r=t*t+n*n+i*i)<Ho)?[NaN,NaN]:[Math.atan2(n,t)*qo,oe(i/Math.sqrt(r))*qo]};var Es,js,As,Ns,Ls,Is,Ds,Os,Ps,Ws,Rs,$s={sphere:S,point:Et,lineStart:At,lineEnd:Nt,polygonStart:function(){$s.lineStart=Lt},polygonEnd:function(){$s.lineStart=At}},zs=Rt(Dt,Vt,Ft,[-Vo,-Vo/2]),Hs=1e9;fo.geo.clipExtent=function(){var e,t,n,i,r,a,o={stream:function(e){return r&&(r.valid=!1),r=a(e),r.valid=!0,r},extent:function(s){return arguments.length?(a=Bt(e=+s[0][0],t=+s[0][1],n=+s[1][0],i=+s[1][1]),r&&(r.valid=!1,r=null),o):[[e,t],[n,i]]}};return o.extent([[0,0],[960,500]])},(fo.geo.conicEqualArea=function(){return Jt(Qt)}).raw=Qt,fo.geo.albers=function(){return fo.geo.conicEqualArea().rotate([96,0]).center([-.6,38.7]).parallels([29.5,45.5]).scale(1070)},fo.geo.albersUsa=function(){function e(e){var a=e[0],o=e[1];return t=null,n(a,o),t||(i(a,o),t)||r(a,o),t}var t,n,i,r,a=fo.geo.albers(),o=fo.geo.conicEqualArea().rotate([154,0]).center([-2,58.5]).parallels([55,65]),s=fo.geo.conicEqualArea().rotate([157,0]).center([-3,19.9]).parallels([8,18]),l={point:function(e,n){t=[e,n]}};return e.invert=function(e){var t=a.scale(),n=a.translate(),i=(e[0]-n[0])/t,r=(e[1]-n[1])/t;return(r>=.12&&r<.234&&i>=-.425&&i<-.214?o:r>=.166&&r<.234&&i>=-.214&&i<-.115?s:a).invert(e)},e.stream=function(e){var t=a.stream(e),n=o.stream(e),i=s.stream(e);return{point:function(e,r){t.point(e,r),n.point(e,r),i.point(e,r)},sphere:function(){t.sphere(),n.sphere(),i.sphere()},lineStart:function(){t.lineStart(),n.lineStart(),i.lineStart()},lineEnd:function(){t.lineEnd(),n.lineEnd(),i.lineEnd()},polygonStart:function(){t.polygonStart(),n.polygonStart(),i.polygonStart()},polygonEnd:function(){t.polygonEnd(),n.polygonEnd(),i.polygonEnd()}}},e.precision=function(t){return arguments.length?(a.precision(t),o.precision(t),s.precision(t),e):a.precision()},e.scale=function(t){return arguments.length?(a.scale(t),o.scale(.35*t),s.scale(t),e.translate(a.translate())):a.scale()},e.translate=function(t){if(!arguments.length)return a.translate();var c=a.scale(),d=+t[0],u=+t[1];return n=a.translate(t).clipExtent([[d-.455*c,u-.238*c],[d+.455*c,u+.238*c]]).stream(l).point,i=o.translate([d-.307*c,u+.201*c]).clipExtent([[d-.425*c+zo,u+.12*c+zo],[d-.214*c-zo,u+.234*c-zo]]).stream(l).point,r=s.translate([d-.205*c,u+.212*c]).clipExtent([[d-.214*c+zo,u+.166*c+zo],[d-.115*c-zo,u+.234*c-zo]]).stream(l).point,e},e.scale(1070)};var Vs,Ys,Fs,Gs,Us,qs,Bs={point:S,lineStart:S,lineEnd:S,polygonStart:function(){Ys=0,Bs.lineStart=Xt},polygonEnd:function(){Bs.lineStart=Bs.lineEnd=Bs.point=S,Vs+=ko(Ys/2)}},Js={point:Kt,lineStart:S,lineEnd:S,polygonStart:S,polygonEnd:S},Qs={point:tn,lineStart:nn,lineEnd:rn,polygonStart:function(){Qs.lineStart=an},polygonEnd:function(){Qs.point=tn,Qs.lineStart=nn,Qs.lineEnd=rn}};fo.geo.path=function(){function e(e){return e&&("function"==typeof s&&a.pointRadius(+s.apply(this,arguments)),o&&o.valid||(o=r(a)),fo.geo.stream(e,o)),a.result()}function t(){return o=null,e}var n,i,r,a,o,s=4.5;return e.area=function(e){return Vs=0,fo.geo.stream(e,r(Bs)),Vs},e.centroid=function(e){return As=Ns=Ls=Is=Ds=Os=Ps=Ws=Rs=0,fo.geo.stream(e,r(Qs)),Rs?[Ps/Rs,Ws/Rs]:Os?[Is/Os,Ds/Os]:Ls?[As/Ls,Ns/Ls]:[NaN,NaN]},e.bounds=function(e){return Us=qs=-(Fs=Gs=1/0),fo.geo.stream(e,r(Js)),[[Fs,Gs],[Us,qs]]},e.projection=function(e){return arguments.length?(r=(n=e)?e.stream||ln(e):k,t()):n},e.context=function(e){return arguments.length?(a=null==(i=e)?new Zt:new on(e),"function"!=typeof s&&a.pointRadius(s),t()):i},e.pointRadius=function(t){return arguments.length?(s="function"==typeof t?t:(a.pointRadius(+t),+t),e):s},e.projection(fo.geo.albersUsa()).context(null)},fo.geo.transform=function(e){return{stream:function(t){var n=new cn(t);for(var i in e)n[i]=e[i];return n}}},cn.prototype={point:function(e,t){this.stream.point(e,t)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}},fo.geo.projection=un,fo.geo.projectionMutator=hn,(fo.geo.equirectangular=function(){return un(pn)}).raw=pn.invert=pn,fo.geo.rotation=function(e){function t(t){return t=e(t[0]*Uo,t[1]*Uo),t[0]*=qo,t[1]*=qo,t}return e=mn(e[0]%360*Uo,e[1]*Uo,e.length>2?e[2]*Uo:0),t.invert=function(t){return t=e.invert(t[0]*Uo,t[1]*Uo),t[0]*=qo,t[1]*=qo,t},t},gn.invert=pn,fo.geo.circle=function(){function e(){var e="function"==typeof i?i.apply(this,arguments):i,t=mn(-e[0]*Uo,-e[1]*Uo,0).invert,r=[];return n(null,null,1,{point:function(e,n){r.push(e=t(e,n)),e[0]*=qo,e[1]*=qo}}),{type:"Polygon",coordinates:[r]}}var t,n,i=[0,0],r=6;return e.origin=function(t){return arguments.length?(i=t,e):i},e.angle=function(i){return arguments.length?(n=bn((t=+i)*Uo,r*Uo),e):t},e.precision=function(i){return arguments.length?(n=bn(t*Uo,(r=+i)*Uo),e):r},e.angle(90)},fo.geo.distance=function(e,t){var n,i=(t[0]-e[0])*Uo,r=e[1]*Uo,a=t[1]*Uo,o=Math.sin(i),s=Math.cos(i),l=Math.sin(r),c=Math.cos(r),d=Math.sin(a),u=Math.cos(a);return Math.atan2(Math.sqrt((n=u*o)*n+(n=c*d-l*u*s)*n),l*d+c*u*s)},fo.geo.graticule=function(){function e(){return{type:"MultiLineString",coordinates:t()}}function t(){return fo.range(Math.ceil(a/m)*m,r,m).map(h).concat(fo.range(Math.ceil(c/_)*_,l,_).map(f)).concat(fo.range(Math.ceil(i/p)*p,n,p).filter(function(e){return ko(e%m)>zo}).map(d)).concat(fo.range(Math.ceil(s/g)*g,o,g).filter(function(e){return ko(e%_)>zo}).map(u))}var n,i,r,a,o,s,l,c,d,u,h,f,p=10,g=p,m=90,_=360,v=2.5;return e.lines=function(){return t().map(function(e){return{type:"LineString",coordinates:e}})},e.outline=function(){return{type:"Polygon",coordinates:[h(a).concat(f(l).slice(1),h(r).reverse().slice(1),f(c).reverse().slice(1))]}},e.extent=function(t){return arguments.length?e.majorExtent(t).minorExtent(t):e.minorExtent()},e.majorExtent=function(t){return arguments.length?(a=+t[0][0],r=+t[1][0],c=+t[0][1],l=+t[1][1],a>r&&(t=a,a=r,r=t),c>l&&(t=c,c=l,l=t),e.precision(v)):[[a,c],[r,l]]},e.minorExtent=function(t){return arguments.length?(i=+t[0][0],n=+t[1][0],s=+t[0][1],o=+t[1][1],i>n&&(t=i,i=n,n=t),s>o&&(t=s,s=o,o=t),e.precision(v)):[[i,s],[n,o]]},e.step=function(t){return arguments.length?e.majorStep(t).minorStep(t):e.minorStep()},e.majorStep=function(t){return arguments.length?(m=+t[0],_=+t[1],e):[m,_]},e.minorStep=function(t){return arguments.length?(p=+t[0],g=+t[1],e):[p,g]},e.precision=function(t){return arguments.length?(v=+t,d=xn(s,o,90),u=kn(i,n,v),h=xn(c,l,90),f=kn(a,r,v),e):v},e.majorExtent([[-180,-90+zo],[180,90-zo]]).minorExtent([[-180,-80-zo],[180,80+zo]])},fo.geo.greatArc=function(){function e(){return{type:"LineString",coordinates:[t||i.apply(this,arguments),n||r.apply(this,arguments)]}}var t,n,i=Mn,r=Cn;return e.distance=function(){return fo.geo.distance(t||i.apply(this,arguments),n||r.apply(this,arguments))},e.source=function(n){return arguments.length?(i=n,t="function"==typeof n?null:n,e):i},e.target=function(t){return arguments.length?(r=t,n="function"==typeof t?null:t,e):r},e.precision=function(){return arguments.length?e:0},e},fo.geo.interpolate=function(e,t){return Sn(e[0]*Uo,e[1]*Uo,t[0]*Uo,t[1]*Uo)},fo.geo.length=function(e){return Xs=0,fo.geo.stream(e,Ks),Xs};var Xs,Ks={sphere:S,point:S,lineStart:Tn,lineEnd:S,polygonStart:S,polygonEnd:S},Zs=En(function(e){return Math.sqrt(2/(1+e))},function(e){return 2*Math.asin(e/2)});(fo.geo.azimuthalEqualArea=function(){return un(Zs)}).raw=Zs;var el=En(function(e){var t=Math.acos(e);return t&&t/Math.sin(t)},k);(fo.geo.azimuthalEquidistant=function(){return un(el)}).raw=el,(fo.geo.conicConformal=function(){return Jt(jn)}).raw=jn,(fo.geo.conicEquidistant=function(){return Jt(An)}).raw=An;var tl=En(function(e){return 1/e},Math.atan);(fo.geo.gnomonic=function(){return un(tl)}).raw=tl,Nn.invert=function(e,t){return[e,2*Math.atan(Math.exp(t))-Go]},(fo.geo.mercator=function(){return Ln(Nn)}).raw=Nn;var nl=En(function(){return 1},Math.asin);(fo.geo.orthographic=function(){return un(nl)}).raw=nl;var il=En(function(e){return 1/(1+e)},function(e){return 2*Math.atan(e)});(fo.geo.stereographic=function(){return un(il)}).raw=il,In.invert=function(e,t){return[-t,2*Math.atan(Math.exp(e))-Go]},(fo.geo.transverseMercator=function(){var e=Ln(In),t=e.center,n=e.rotate;return e.center=function(e){return e?t([-e[1],e[0]]):(e=t(),[e[1],-e[0]])},e.rotate=function(e){return e?n([e[0],e[1],e.length>2?e[2]+90:90]):(e=n(),[e[0],e[1],e[2]-90])},n([0,0,90])}).raw=In,fo.geom={},fo.geom.hull=function(e){function t(e){if(e.length<3)return[];var t,r=Ne(n),a=Ne(i),o=e.length,s=[],l=[];for(t=0;t<o;t++)s.push([+r.call(this,e[t],t),+a.call(this,e[t],t),t]);for(s.sort(Wn),t=0;t<o;t++)l.push([s[t][0],-s[t][1]]);var c=Pn(s),d=Pn(l),u=d[0]===c[0],h=d[d.length-1]===c[c.length-1],f=[];for(t=c.length-1;t>=0;--t)f.push(e[s[c[t]][2]]);for(t=+u;t<d.length-h;++t)f.push(e[s[d[t]][2]]);return f}var n=Dn,i=On;return arguments.length?t(e):(t.x=function(e){return arguments.length?(n=e,t):n},t.y=function(e){return arguments.length?(i=e,t):i},t)},fo.geom.polygon=function(e){return Eo(e,rl),e};var rl=fo.geom.polygon.prototype=[];rl.area=function(){for(var e,t=-1,n=this.length,i=this[n-1],r=0;++t<n;)e=i,i=this[t],r+=e[1]*i[0]-e[0]*i[1];return.5*r},rl.centroid=function(e){var t,n,i=-1,r=this.length,a=0,o=0,s=this[r-1];for(arguments.length||(e=-1/(6*this.area()));++i<r;)t=s,s=this[i],n=t[0]*s[1]-s[0]*t[1],a+=(t[0]+s[0])*n,o+=(t[1]+s[1])*n;return[a*e,o*e]},rl.clip=function(e){for(var t,n,i,r,a,o,s=zn(e),l=-1,c=this.length-zn(this),d=this[c-1];++l<c;){for(t=e.slice(),e.length=0,r=this[l],a=t[(i=t.length-s)-1],n=-1;++n<i;)o=t[n],Rn(o,d,r)?(Rn(a,d,r)||e.push($n(a,o,d,r)),e.push(o)):Rn(a,d,r)&&e.push($n(a,o,d,r)),a=o;s&&e.push(e[0]),d=r}return e};var al,ol,sl,ll,cl,dl=[],ul=[];Bn.prototype.prepare=function(){for(var e,t=this.edges,n=t.length;n--;)e=t[n].edge,e.b&&e.a||t.splice(n,1);return t.sort(Qn),t.length},oi.prototype={start:function(){return this.edge.l===this.site?this.edge.a:this.edge.b},end:function(){return this.edge.l===this.site?this.edge.b:this.edge.a}},si.prototype={insert:function(e,t){var n,i,r;if(e){if(t.P=e,t.N=e.N,e.N&&(e.N.P=t),e.N=t,e.R){for(e=e.R;e.L;)e=e.L;e.L=t}else e.R=t;n=e}else this._?(e=ui(this._),t.P=null,t.N=e,e.P=e.L=t,n=e):(t.P=t.N=null,this._=t,n=null);for(t.L=t.R=null,t.U=n,t.C=!0,e=t;n&&n.C;)i=n.U,n===i.L?(r=i.R,r&&r.C?(n.C=r.C=!1,i.C=!0,e=i):(e===n.R&&(ci(this,n),e=n,n=e.U),n.C=!1,i.C=!0,di(this,i))):(r=i.L,r&&r.C?(n.C=r.C=!1,i.C=!0,e=i):(e===n.L&&(di(this,n),e=n,n=e.U),n.C=!1,i.C=!0,ci(this,i))),n=e.U;this._.C=!1},remove:function(e){e.N&&(e.N.P=e.P),e.P&&(e.P.N=e.N),e.N=e.P=null;var t,n,i,r=e.U,a=e.L,o=e.R;if(n=a?o?ui(o):a:o,r?r.L===e?r.L=n:r.R=n:this._=n,a&&o?(i=n.C,n.C=e.C,n.L=a,a.U=n,n!==o?(r=n.U,n.U=e.U,e=n.R,r.L=e,n.R=o,o.U=n):(n.U=r,r=n,e=n.R)):(i=e.C,e=n),e&&(e.U=r),!i){if(e&&e.C)return void(e.C=!1);do{if(e===this._)break;if(e===r.L){if(t=r.R,t.C&&(t.C=!1,r.C=!0,ci(this,r),t=r.R),t.L&&t.L.C||t.R&&t.R.C){t.R&&t.R.C||(t.L.C=!1,t.C=!0,di(this,t),t=r.R),t.C=r.C,r.C=t.R.C=!1,ci(this,r),e=this._;break}}else if(t=r.L,t.C&&(t.C=!1,r.C=!0,di(this,r),t=r.L),t.L&&t.L.C||t.R&&t.R.C){t.L&&t.L.C||(t.R.C=!1,t.C=!0,ci(this,t),t=r.L),t.C=r.C,r.C=t.L.C=!1,di(this,r),e=this._;break}t.C=!0,e=r,r=r.U}while(!e.C);e&&(e.C=!1)}}},fo.geom.voronoi=function(e){function t(e){var t=new Array(e.length),i=s[0][0],r=s[0][1],a=s[1][0],o=s[1][1];return hi(n(e),s).cells.forEach(function(n,s){var l=n.edges,c=n.site;(t[s]=l.length?l.map(function(e){var t=e.start();return[t.x,t.y]}):c.x>=i&&c.x<=a&&c.y>=r&&c.y<=o?[[i,o],[a,o],[a,r],[i,r]]:[]).point=e[s]}),t}function n(e){return e.map(function(e,t){return{x:Math.round(a(e,t)/zo)*zo,y:Math.round(o(e,t)/zo)*zo,i:t}})}var i=Dn,r=On,a=i,o=r,s=hl;return e?t(e):(t.links=function(e){return hi(n(e)).edges.filter(function(e){return e.l&&e.r}).map(function(t){return{source:e[t.l.i],target:e[t.r.i]}})},t.triangles=function(e){var t=[];return hi(n(e)).cells.forEach(function(n,i){for(var r,a=n.site,o=n.edges.sort(Qn),s=-1,l=o.length,c=o[l-1].edge,d=c.l===a?c.r:c.l;++s<l;)c,r=d,c=o[s].edge,d=c.l===a?c.r:c.l,i<r.i&&i<d.i&&pi(a,r,d)<0&&t.push([e[i],e[r.i],e[d.i]])}),t},t.x=function(e){return arguments.length?(a=Ne(i=e),t):i},t.y=function(e){return arguments.length?(o=Ne(r=e),t):r},t.clipExtent=function(e){return arguments.length?(s=null==e?hl:e,t):s===hl?null:s},t.size=function(e){return arguments.length?t.clipExtent(e&&[[0,0],e]):s===hl?null:s&&s[1]},t)};var hl=[[-1e6,-1e6],[1e6,1e6]];fo.geom.delaunay=function(e){return fo.geom.voronoi().triangles(e)},fo.geom.quadtree=function(e,t,n,i,r){function a(e){function a(e,t,n,i,r,a,o,s){if(!isNaN(n)&&!isNaN(i))if(e.leaf){var l=e.x,d=e.y;if(null!=l)if(ko(l-n)+ko(d-i)<.01)c(e,t,n,i,r,a,o,s);else{var u=e.point;e.x=e.y=e.point=null,c(e,u,l,d,r,a,o,s),c(e,t,n,i,r,a,o,s)}else e.x=n,e.y=i,e.point=t}else c(e,t,n,i,r,a,o,s)}function c(e,t,n,i,r,o,s,l){var c=.5*(r+s),d=.5*(o+l),u=n>=c,h=i>=d,f=h<<1|u;e.leaf=!1,e=e.nodes[f]||(e.nodes[f]=_i()),u?r=c:s=c,h?o=d:l=d,a(e,t,n,i,r,o,s,l)}var d,u,h,f,p,g,m,_,v,y=Ne(s),b=Ne(l);if(null!=t)g=t,m=n,_=i,v=r;else if(_=v=-(g=m=1/0),u=[],h=[],p=e.length,o)for(f=0;f<p;++f)d=e[f],d.x<g&&(g=d.x),d.y<m&&(m=d.y),d.x>_&&(_=d.x),d.y>v&&(v=d.y),u.push(d.x),h.push(d.y);else for(f=0;f<p;++f){var w=+y(d=e[f],f),x=+b(d,f);w<g&&(g=w),x<m&&(m=x),w>_&&(_=w),x>v&&(v=x),u.push(w),h.push(x)}var k=_-g,M=v-m;k>M?v=m+k:_=g+M;var C=_i();if(C.add=function(e){a(C,e,+y(e,++f),+b(e,f),g,m,_,v)},C.visit=function(e){vi(e,C,g,m,_,v)},C.find=function(e){return yi(C,e[0],e[1],g,m,_,v)},f=-1,null==t){for(;++f<p;)a(C,e[f],u[f],h[f],g,m,_,v);--f}else e.forEach(C.add);return u=h=e=d=null,C}var o,s=Dn,l=On;return(o=arguments.length)?(s=gi,l=mi,3===o&&(r=n,i=t,n=t=0),a(e)):(a.x=function(e){return arguments.length?(s=e,a):s},a.y=function(e){return arguments.length?(l=e,a):l},a.extent=function(e){return arguments.length?(null==e?t=n=i=r=null:(t=+e[0][0],n=+e[0][1],i=+e[1][0],r=+e[1][1]),a):null==t?null:[[t,n],[i,r]]},a.size=function(e){return arguments.length?(null==e?t=n=i=r=null:(t=n=0,i=+e[0],r=+e[1]),a):null==t?null:[i-t,r-n]},a)},fo.interpolateRgb=bi,fo.interpolateObject=wi,fo.interpolateNumber=xi,fo.interpolateString=ki;var fl=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,pl=new RegExp(fl.source,"g");fo.interpolate=Mi,fo.interpolators=[function(e,t){var n=typeof t;return("string"===n?os.has(t.toLowerCase())||/^(#|rgb\(|hsl\()/i.test(t)?bi:ki:t instanceof ue?bi:Array.isArray(t)?Ci:"object"===n&&isNaN(t)?wi:xi)(e,t)}],fo.interpolateArray=Ci;var gl=function(){return k},ml=fo.map({linear:gl,poly:Li,quad:function(){return ji},cubic:function(){return Ai},sin:function(){return Ii},exp:function(){return Di},circle:function(){return Oi},elastic:Pi,back:Wi,bounce:function(){return Ri}}),_l=fo.map({in:k,out:Ti,"in-out":Ei,"out-in":function(e){return Ei(Ti(e))}});fo.ease=function(e){var t=e.indexOf("-"),n=t>=0?e.slice(0,t):e,i=t>=0?e.slice(t+1):"in";return n=ml.get(n)||gl,i=_l.get(i)||k,Si(i(n.apply(null,po.call(arguments,1))))},fo.interpolateHcl=$i,fo.interpolateHsl=zi,fo.interpolateLab=Hi,fo.interpolateRound=Vi,fo.transform=function(e){var t=mo.createElementNS(fo.ns.prefix.svg,"g");return(fo.transform=function(e){if(null!=e){t.setAttribute("transform",e);var n=t.transform.baseVal.consolidate()}return new Yi(n?n.matrix:vl)})(e)},Yi.prototype.toString=function(){return"translate("+this.translate+")rotate("+this.rotate+")skewX("+this.skew+")scale("+this.scale+")"};var vl={a:1,b:0,c:0,d:1,e:0,f:0};fo.interpolateTransform=Ki,fo.layout={},fo.layout.bundle=function(){return function(e){for(var t=[],n=-1,i=e.length;++n<i;)t.push(tr(e[n]));return t}},fo.layout.chord=function(){function e(){var e,c,u,h,f,p={},g=[],m=fo.range(a),_=[];for(n=[],i=[],e=0,h=-1;++h<a;){for(c=0,f=-1;++f<a;)c+=r[h][f];g.push(c),_.push(fo.range(a)),e+=c}for(o&&m.sort(function(e,t){return o(g[e],g[t])}),s&&_.forEach(function(e,t){e.sort(function(e,n){return s(r[t][e],r[t][n])})}),e=(Yo-d*a)/e,c=0,h=-1;++h<a;){for(u=c,f=-1;++f<a;){var v=m[h],y=_[v][f],b=r[v][y],w=c,x=c+=b*e;p[v+"-"+y]={index:v,subindex:y,startAngle:w,endAngle:x,value:b}}i[v]={index:v,startAngle:u,endAngle:c,value:g[v]},c+=d}for(h=-1;++h<a;)for(f=h-1;++f<a;){var k=p[h+"-"+f],M=p[f+"-"+h];(k.value||M.value)&&n.push(k.value<M.value?{source:M,target:k}:{source:k,target:M})}l&&t()}function t(){n.sort(function(e,t){return l((e.source.value+e.target.value)/2,(t.source.value+t.target.value)/2)})}var n,i,r,a,o,s,l,c={},d=0;return c.matrix=function(e){return arguments.length?(a=(r=e)&&r.length,n=i=null,c):r},c.padding=function(e){return arguments.length?(d=e,n=i=null,c):d},c.sortGroups=function(e){return arguments.length?(o=e,n=i=null,c):o},c.sortSubgroups=function(e){return arguments.length?(s=e,n=null,c):s},c.sortChords=function(e){return arguments.length?(l=e,n&&t(),c):l},c.chords=function(){return n||e(),n},c.groups=function(){return i||e(),i},c},fo.layout.force=function(){function e(e){return function(t,n,i,r){if(t.point!==e){var a=t.cx-e.x,o=t.cy-e.y,s=r-n,l=a*a+o*o;if(s*s/_<l){if(l<g){var c=t.charge/l;e.px-=a*c,e.py-=o*c}return!0}if(t.point&&l&&l<g){var c=t.pointCharge/l;e.px-=a*c,e.py-=o*c}}return!t.charge}}function t(e){e.px=fo.event.x,e.py=fo.event.y,l.resume()}var n,i,r,a,o,s,l={},c=fo.dispatch("start","tick","end"),d=[1,1],u=.9,h=yl,f=bl,p=-30,g=wl,m=.1,_=.64,v=[],y=[];return l.tick=function(){if((r*=.99)<.005)return n=null,c.end({type:"end",alpha:r=0}),!0;var t,i,l,h,f,g,_,b,w,x=v.length,k=y.length;for(i=0;i<k;++i)l=y[i],h=l.source,f=l.target,b=f.x-h.x,w=f.y-h.y,(g=b*b+w*w)&&(g=r*o[i]*((g=Math.sqrt(g))-a[i])/g,b*=g,w*=g,f.x-=b*(_=h.weight+f.weight?h.weight/(h.weight+f.weight):.5),f.y-=w*_,h.x+=b*(_=1-_),h.y+=w*_);if((_=r*m)&&(b=d[0]/2,w=d[1]/2,i=-1,_))for(;++i<x;)l=v[i],l.x+=(b-l.x)*_,l.y+=(w-l.y)*_;if(p)for(lr(t=fo.geom.quadtree(v),r,s),i=-1;++i<x;)(l=v[i]).fixed||t.visit(e(l));for(i=-1;++i<x;)l=v[i],l.fixed?(l.x=l.px,l.y=l.py):(l.x-=(l.px-(l.px=l.x))*u,l.y-=(l.py-(l.py=l.y))*u);c.tick({type:"tick",alpha:r})},l.nodes=function(e){return arguments.length?(v=e,l):v},l.links=function(e){return arguments.length?(y=e,l):y},l.size=function(e){return arguments.length?(d=e,l):d},l.linkDistance=function(e){return arguments.length?(h="function"==typeof e?e:+e,l):h},l.distance=l.linkDistance,l.linkStrength=function(e){return arguments.length?(f="function"==typeof e?e:+e,l):f},l.friction=function(e){return arguments.length?(u=+e,l):u},l.charge=function(e){return arguments.length?(p="function"==typeof e?e:+e,l):p},l.chargeDistance=function(e){return arguments.length?(g=e*e,l):Math.sqrt(g)},l.gravity=function(e){return arguments.length?(m=+e,l):m},l.theta=function(e){return arguments.length?(_=e*e,l):Math.sqrt(_)},l.alpha=function(e){return arguments.length?(e=+e,r?e>0?r=e:(n.c=null,n.t=NaN,n=null,c.end({type:"end",alpha:r=0})):e>0&&(c.start({type:"start",alpha:r=e}),n=Pe(l.tick)),l):r},l.start=function(){function e(e,i){if(!n){for(n=new Array(r),l=0;l<r;++l)n[l]=[];for(l=0;l<c;++l){var a=y[l];n[a.source.index].push(a.target),n[a.target.index].push(a.source)}}for(var o,s=n[t],l=-1,d=s.length;++l<d;)if(!isNaN(o=s[l][e]))return o;return Math.random()*i}var t,n,i,r=v.length,c=y.length,u=d[0],g=d[1];for(t=0;t<r;++t)(i=v[t]).index=t,i.weight=0;for(t=0;t<c;++t)i=y[t],"number"==typeof i.source&&(i.source=v[i.source]),"number"==typeof i.target&&(i.target=v[i.target]),++i.source.weight,++i.target.weight;for(t=0;t<r;++t)i=v[t],isNaN(i.x)&&(i.x=e("x",u)),isNaN(i.y)&&(i.y=e("y",g)),isNaN(i.px)&&(i.px=i.x),isNaN(i.py)&&(i.py=i.y);if(a=[],"function"==typeof h)for(t=0;t<c;++t)a[t]=+h.call(this,y[t],t);else for(t=0;t<c;++t)a[t]=h;if(o=[],"function"==typeof f)for(t=0;t<c;++t)o[t]=+f.call(this,y[t],t);else for(t=0;t<c;++t)o[t]=f;if(s=[],"function"==typeof p)for(t=0;t<r;++t)s[t]=+p.call(this,v[t],t);else for(t=0;t<r;++t)s[t]=p;return l.resume()},l.resume=function(){return l.alpha(.1)},l.stop=function(){return l.alpha(0)},l.drag=function(){if(i||(i=fo.behavior.drag().origin(k).on("dragstart.force",rr).on("drag.force",t).on("dragend.force",ar)),!arguments.length)return i;this.on("mouseover.force",or).on("mouseout.force",sr).call(i)},fo.rebind(l,c,"on")};var yl=20,bl=1,wl=1/0;fo.layout.hierarchy=function(){function e(r){var a,o=[r],s=[];for(r.depth=0;null!=(a=o.pop());)if(s.push(a),(c=n.call(e,a,a.depth))&&(l=c.length)){for(var l,c,d;--l>=0;)o.push(d=c[l]),d.parent=a,d.depth=a.depth+1;i&&(a.value=0),a.children=c}else i&&(a.value=+i.call(e,a,a.depth)||0),delete a.children;return ur(r,function(e){var n,r;t&&(n=e.children)&&n.sort(t),i&&(r=e.parent)&&(r.value+=e.value)}),s}var t=pr,n=hr,i=fr;return e.sort=function(n){return arguments.length?(t=n,e):t},e.children=function(t){return arguments.length?(n=t,e):n},e.value=function(t){return arguments.length?(i=t,e):i},e.revalue=function(t){return i&&(dr(t,function(e){e.children&&(e.value=0)}),ur(t,function(t){var n;t.children||(t.value=+i.call(e,t,t.depth)||0),(n=t.parent)&&(n.value+=t.value)})),t},e},fo.layout.partition=function(){function e(t,n,i,r){var a=t.children;if(t.x=n,t.y=t.depth*r,t.dx=i,t.dy=r,a&&(o=a.length)){var o,s,l,c=-1;for(i=t.value?i/t.value:0;++c<o;)e(s=a[c],n,l=s.value*i,r),n+=l}}function t(e){var n=e.children,i=0;if(n&&(r=n.length))for(var r,a=-1;++a<r;)i=Math.max(i,t(n[a]));return 1+i}function n(n,a){var o=i.call(this,n,a);return e(o[0],0,r[0],r[1]/t(o[0])),o}var i=fo.layout.hierarchy(),r=[1,1];return n.size=function(e){return arguments.length?(r=e,n):r},cr(n,i)},fo.layout.pie=function(){function e(o){var s,l=o.length,c=o.map(function(n,i){return+t.call(e,n,i)}),d=+("function"==typeof i?i.apply(this,arguments):i),u=("function"==typeof r?r.apply(this,arguments):r)-d,h=Math.min(Math.abs(u)/l,+("function"==typeof a?a.apply(this,arguments):a)),f=h*(u<0?-1:1),p=fo.sum(c),g=p?(u-l*f)/p:0,m=fo.range(l),_=[];return null!=n&&m.sort(n===xl?function(e,t){return c[t]-c[e]}:function(e,t){return n(o[e],o[t])}),m.forEach(function(e){_[e]={data:o[e],value:s=c[e],startAngle:d,endAngle:d+=s*g+f,padAngle:h}}),_}var t=Number,n=xl,i=0,r=Yo,a=0;return e.value=function(n){return arguments.length?(t=n,e):t},e.sort=function(t){return arguments.length?(n=t,e):n},e.startAngle=function(t){return arguments.length?(i=t,e):i},e.endAngle=function(t){return arguments.length?(r=t,e):r},e.padAngle=function(t){return arguments.length?(a=t,e):a},e};var xl={};fo.layout.stack=function(){function e(s,l){if(!(h=s.length))return s;var c=s.map(function(n,i){return t.call(e,n,i)}),d=c.map(function(t){return t.map(function(t,n){return[a.call(e,t,n),o.call(e,t,n)]})}),u=n.call(e,d,l);c=fo.permute(c,u),d=fo.permute(d,u);var h,f,p,g,m=i.call(e,d,l),_=c[0].length;for(p=0;p<_;++p)for(r.call(e,c[0][p],g=m[p],d[0][p][1]),f=1;f<h;++f)r.call(e,c[f][p],g+=d[f-1][p][1],d[f][p][1]);return s}var t=k,n=yr,i=br,r=vr,a=mr,o=_r;return e.values=function(n){return arguments.length?(t=n,e):t},e.order=function(t){return arguments.length?(n="function"==typeof t?t:kl.get(t)||yr,e):n},e.offset=function(t){return arguments.length?(i="function"==typeof t?t:Ml.get(t)||br,e):i},e.x=function(t){return arguments.length?(a=t,e):a},e.y=function(t){return arguments.length?(o=t,e):o},e.out=function(t){return arguments.length?(r=t,e):r},e};var kl=fo.map({"inside-out":function(e){var t,n,i=e.length,r=e.map(wr),a=e.map(xr),o=fo.range(i).sort(function(e,t){return r[e]-r[t]}),s=0,l=0,c=[],d=[];for(t=0;t<i;++t)n=o[t],s<l?(s+=a[n],c.push(n)):(l+=a[n],d.push(n));return d.reverse().concat(c)},reverse:function(e){return fo.range(e.length).reverse()},default:yr}),Ml=fo.map({silhouette:function(e){var t,n,i,r=e.length,a=e[0].length,o=[],s=0,l=[];for(n=0;n<a;++n){for(t=0,i=0;t<r;t++)i+=e[t][n][1];i>s&&(s=i),o.push(i)}for(n=0;n<a;++n)l[n]=(s-o[n])/2;return l},wiggle:function(e){var t,n,i,r,a,o,s,l,c,d=e.length,u=e[0],h=u.length,f=[];for(f[0]=l=c=0,n=1;n<h;++n){for(t=0,r=0;t<d;++t)r+=e[t][n][1];for(t=0,a=0,s=u[n][0]-u[n-1][0];t<d;++t){for(i=0,o=(e[t][n][1]-e[t][n-1][1])/(2*s);i<t;++i)o+=(e[i][n][1]-e[i][n-1][1])/s;a+=o*e[t][n][1]}f[n]=l-=r?a/r*s:0,l<c&&(c=l)}for(n=0;n<h;++n)f[n]-=c;return f},expand:function(e){var t,n,i,r=e.length,a=e[0].length,o=1/r,s=[];for(n=0;n<a;++n){for(t=0,i=0;t<r;t++)i+=e[t][n][1];if(i)for(t=0;t<r;t++)e[t][n][1]/=i;else for(t=0;t<r;t++)e[t][n][1]=o}for(n=0;n<a;++n)s[n]=0;return s},zero:br});fo.layout.histogram=function(){function e(e,a){for(var o,s,l=[],c=e.map(n,this),d=i.call(this,c,a),u=r.call(this,d,c,a),a=-1,h=c.length,f=u.length-1,p=t?1:1/h;++a<f;)o=l[a]=[],o.dx=u[a+1]-(o.x=u[a]),o.y=0;if(f>0)for(a=-1;++a<h;)(s=c[a])>=d[0]&&s<=d[1]&&(o=l[fo.bisect(u,s,1,f)-1],o.y+=p,o.push(e[a]));return l}var t=!0,n=Number,i=Sr,r=Mr;return e.value=function(t){return arguments.length?(n=t,e):n},e.range=function(t){return arguments.length?(i=Ne(t),e):i},e.bins=function(t){return arguments.length?(r="number"==typeof t?function(e){return Cr(e,t)}:Ne(t),e):r},e.frequency=function(n){return arguments.length?(t=!!n,e):t},e},fo.layout.pack=function(){function e(e,a){var o=n.call(this,e,a),s=o[0],l=r[0],c=r[1],d=null==t?Math.sqrt:"function"==typeof t?t:function(){return t};if(s.x=s.y=0,ur(s,function(e){e.r=+d(e.value)}),ur(s,Nr),i){var u=i*(t?1:Math.max(2*s.r/l,2*s.r/c))/2;ur(s,function(e){e.r+=u}),ur(s,Nr),ur(s,function(e){e.r-=u})}return Dr(s,l/2,c/2,t?1:1/Math.max(2*s.r/l,2*s.r/c)),o}var t,n=fo.layout.hierarchy().sort(Tr),i=0,r=[1,1];return e.size=function(t){return arguments.length?(r=t,e):r},e.radius=function(n){return arguments.length?(t=null==n||"function"==typeof n?n:+n,e):t},e.padding=function(t){return arguments.length?(i=+t,e):i},cr(e,n)},fo.layout.tree=function(){function e(e,r){var d=o.call(this,e,r),u=d[0],h=t(u);if(ur(h,n),h.parent.m=-h.z,dr(h,i),c)dr(u,a);else{var f=u,p=u,g=u;dr(u,function(e){e.x<f.x&&(f=e),e.x>p.x&&(p=e),e.depth>g.depth&&(g=e)});var m=s(f,p)/2-f.x,_=l[0]/(p.x+s(p,f)/2+m),v=l[1]/(g.depth||1);dr(u,function(e){e.x=(e.x+m)*_,e.y=e.depth*v})}return d}function t(e){for(var t,n={A:null,children:[e]},i=[n];null!=(t=i.pop());)for(var r,a=t.children,o=0,s=a.length;o<s;++o)i.push((a[o]=r={_:a[o],parent:t,children:(r=a[o].children)&&r.slice()||[],A:null,a:null,z:0,m:0,c:0,s:0,t:null,i:o}).a=r);return n.children[0]}function n(e){var t=e.children,n=e.parent.children,i=e.i?n[e.i-1]:null;if(t.length){zr(e);var a=(t[0].z+t[t.length-1].z)/2;i?(e.z=i.z+s(e._,i._),e.m=e.z-a):e.z=a}else i&&(e.z=i.z+s(e._,i._));e.parent.A=r(e,i,e.parent.A||n[0])}function i(e){e._.x=e.z+e.parent.m,e.m+=e.parent.m}function r(e,t,n){if(t){for(var i,r=e,a=e,o=t,l=r.parent.children[0],c=r.m,d=a.m,u=o.m,h=l.m;o=Rr(o),r=Wr(r),o&&r;)l=Wr(l),a=Rr(a),a.a=e,i=o.z+u-r.z-c+s(o._,r._),i>0&&($r(Hr(o,e,n),e,i),c+=i,d+=i),u+=o.m,c+=r.m,h+=l.m,d+=a.m;o&&!Rr(a)&&(a.t=o,a.m+=u-d),r&&!Wr(l)&&(l.t=r,l.m+=c-h,n=e)}return n}function a(e){e.x*=l[0],e.y=e.depth*l[1]}var o=fo.layout.hierarchy().sort(null).value(null),s=Pr,l=[1,1],c=null;return e.separation=function(t){return arguments.length?(s=t,e):s},e.size=function(t){return arguments.length?(c=null==(l=t)?a:null,e):c?null:l},e.nodeSize=function(t){return arguments.length?(c=null==(l=t)?null:a,e):c?l:null},cr(e,o)},fo.layout.cluster=function(){function e(e,a){var o,s=t.call(this,e,a),l=s[0],c=0;ur(l,function(e){var t=e.children;t&&t.length?(e.x=Yr(t),e.y=Vr(t)):(e.x=o?c+=n(e,o):0,e.y=0,o=e)});var d=Fr(l),u=Gr(l),h=d.x-n(d,u)/2,f=u.x+n(u,d)/2;return ur(l,r?function(e){e.x=(e.x-l.x)*i[0],e.y=(l.y-e.y)*i[1]}:function(e){e.x=(e.x-h)/(f-h)*i[0],e.y=(1-(l.y?e.y/l.y:1))*i[1]}),s}var t=fo.layout.hierarchy().sort(null).value(null),n=Pr,i=[1,1],r=!1;return e.separation=function(t){return arguments.length?(n=t,e):n},e.size=function(t){return arguments.length?(r=null==(i=t),e):r?null:i},e.nodeSize=function(t){return arguments.length?(r=null!=(i=t),e):r?i:null},cr(e,t)},fo.layout.treemap=function(){function e(e,t){for(var n,i,r=-1,a=e.length;++r<a;)i=(n=e[r]).value*(t<0?0:t),n.area=isNaN(i)||i<=0?0:i}function t(n){var a=n.children;if(a&&a.length){var o,s,l,c=u(n),d=[],h=a.slice(),p=1/0,g="slice"===f?c.dx:"dice"===f?c.dy:"slice-dice"===f?1&n.depth?c.dy:c.dx:Math.min(c.dx,c.dy);for(e(h,c.dx*c.dy/n.value),d.area=0;(l=h.length)>0;)d.push(o=h[l-1]),d.area+=o.area,"squarify"!==f||(s=i(d,g))<=p?(h.pop(),p=s):(d.area-=d.pop().area,r(d,g,c,!1),g=Math.min(c.dx,c.dy),d.length=d.area=0,p=1/0);d.length&&(r(d,g,c,!0),d.length=d.area=0),a.forEach(t)}}function n(t){var i=t.children;if(i&&i.length){var a,o=u(t),s=i.slice(),l=[];for(e(s,o.dx*o.dy/t.value),l.area=0;a=s.pop();)l.push(a),l.area+=a.area,null!=a.z&&(r(l,a.z?o.dx:o.dy,o,!s.length),l.length=l.area=0);i.forEach(n)}}function i(e,t){for(var n,i=e.area,r=0,a=1/0,o=-1,s=e.length;++o<s;)(n=e[o].area)&&(n<a&&(a=n),n>r&&(r=n));return i*=i,t*=t,i?Math.max(t*r*p/i,i/(t*a*p)):1/0}function r(e,t,n,i){var r,a=-1,o=e.length,s=n.x,c=n.y,d=t?l(e.area/t):0;if(t==n.dx){for((i||d>n.dy)&&(d=n.dy);++a<o;)r=e[a],r.x=s,r.y=c,r.dy=d,s+=r.dx=Math.min(n.x+n.dx-s,d?l(r.area/d):0);r.z=!0,r.dx+=n.x+n.dx-s,n.y+=d,n.dy-=d}else{for((i||d>n.dx)&&(d=n.dx);++a<o;)r=e[a],r.x=s,r.y=c,r.dx=d,c+=r.dy=Math.min(n.y+n.dy-c,d?l(r.area/d):0);r.z=!1,r.dy+=n.y+n.dy-c,n.x+=d,n.dx-=d}}function a(i){var r=o||s(i),a=r[0];return a.x=a.y=0,a.value?(a.dx=c[0],a.dy=c[1]):a.dx=a.dy=0,o&&s.revalue(a),e([a],a.dx*a.dy/a.value),(o?n:t)(a),h&&(o=r),r}var o,s=fo.layout.hierarchy(),l=Math.round,c=[1,1],d=null,u=Ur,h=!1,f="squarify",p=.5*(1+Math.sqrt(5));return a.size=function(e){return arguments.length?(c=e,a):c},a.padding=function(e){function t(t){var n=e.call(a,t,t.depth);return null==n?Ur(t):qr(t,"number"==typeof n?[n,n,n,n]:n)}function n(t){return qr(t,e)}if(!arguments.length)return d;var i;return u=null==(d=e)?Ur:"function"==(i=typeof e)?t:"number"===i?(e=[e,e,e,e],n):n,a},a.round=function(e){return arguments.length?(l=e?Math.round:Number,a):l!=Number},a.sticky=function(e){return arguments.length?(h=e,o=null,a):h},a.ratio=function(e){return arguments.length?(p=e,a):p},a.mode=function(e){return arguments.length?(f=e+"",a):f},cr(a,s)},fo.random={normal:function(e,t){var n=arguments.length;return n<2&&(t=1),n<1&&(e=0),function(){var n,i,r;do{n=2*Math.random()-1,i=2*Math.random()-1,r=n*n+i*i}while(!r||r>1);return e+t*n*Math.sqrt(-2*Math.log(r)/r)}},logNormal:function(){var e=fo.random.normal.apply(fo,arguments);return function(){return Math.exp(e())}},bates:function(e){var t=fo.random.irwinHall(e);return function(){return t()/e}},irwinHall:function(e){return function(){for(var t=0,n=0;n<e;n++)t+=Math.random();return t}}},fo.scale={};var Cl={floor:k,ceil:k};fo.scale.linear=function(){return ea([0,1],[0,1],Mi,!1)};var Sl={s:1,g:1,p:1,r:1,e:1};fo.scale.log=function(){return la(fo.scale.linear().domain([0,1]),10,!0,[1,10])};var Tl=fo.format(".0e"),El={floor:function(e){return-Math.ceil(-e)},ceil:function(e){return-Math.floor(-e)}};fo.scale.pow=function(){return ca(fo.scale.linear(),1,[0,1])},fo.scale.sqrt=function(){return fo.scale.pow().exponent(.5)},fo.scale.ordinal=function(){return ua([],{t:"range",a:[[]]})},fo.scale.category10=function(){return fo.scale.ordinal().range(jl)},fo.scale.category20=function(){return fo.scale.ordinal().range(Al)},fo.scale.category20b=function(){return fo.scale.ordinal().range(Nl)},fo.scale.category20c=function(){return fo.scale.ordinal().range(Ll)};var jl=[2062260,16744206,2924588,14034728,9725885,9197131,14907330,8355711,12369186,1556175].map(Me),Al=[2062260,11454440,16744206,16759672,2924588,10018698,14034728,16750742,9725885,12955861,9197131,12885140,14907330,16234194,8355711,13092807,12369186,14408589,1556175,10410725].map(Me),Nl=[3750777,5395619,7040719,10264286,6519097,9216594,11915115,13556636,9202993,12426809,15186514,15190932,8666169,11356490,14049643,15177372,8077683,10834324,13528509,14589654].map(Me),Ll=[3244733,7057110,10406625,13032431,15095053,16616764,16625259,16634018,3253076,7652470,10607003,13101504,7695281,10394312,12369372,14342891,6513507,9868950,12434877,14277081].map(Me);fo.scale.quantile=function(){return ha([],[])},fo.scale.quantize=function(){return fa(0,1,[0,1])},fo.scale.threshold=function(){return pa([.5],[0,1])},fo.scale.identity=function(){return ga([0,1])},fo.svg={},fo.svg.arc=function(){function e(){var e=Math.max(0,+n.apply(this,arguments)),c=Math.max(0,+i.apply(this,arguments)),d=o.apply(this,arguments)-Go,u=s.apply(this,arguments)-Go,h=Math.abs(u-d),f=d>u?0:1;if(c<e&&(p=c,c=e,e=p),h>=Fo)return t(c,f)+(e?t(e,1-f):"")+"Z";var p,g,m,_,v,y,b,w,x,k,M,C,S=0,T=0,E=[];if((_=(+l.apply(this,arguments)||0)/2)&&(m=a===Il?Math.sqrt(e*e+c*c):+a.apply(this,arguments),f||(T*=-1),c&&(T=oe(m/c*Math.sin(_))),e&&(S=oe(m/e*Math.sin(_)))),c){v=c*Math.cos(d+T),y=c*Math.sin(d+T),b=c*Math.cos(u-T),w=c*Math.sin(u-T);var j=Math.abs(u-d-2*T)<=Vo?0:1;if(T&&xa(v,y,b,w)===f^j){var A=(d+u)/2;v=c*Math.cos(A),y=c*Math.sin(A),b=w=null}}else v=y=0;if(e){x=e*Math.cos(u-S),k=e*Math.sin(u-S),M=e*Math.cos(d+S),C=e*Math.sin(d+S);var N=Math.abs(d-u+2*S)<=Vo?0:1;if(S&&xa(x,k,M,C)===1-f^N){var L=(d+u)/2;x=e*Math.cos(L),k=e*Math.sin(L),M=C=null}}else x=k=0;if(h>zo&&(p=Math.min(Math.abs(c-e)/2,+r.apply(this,arguments)))>.001){g=e<c^f?0:1;var I=p,D=p;if(h<Vo){var O=null==M?[x,k]:null==b?[v,y]:$n([v,y],[M,C],[b,w],[x,k]),P=v-O[0],W=y-O[1],R=b-O[0],$=w-O[1],z=1/Math.sin(Math.acos((P*R+W*$)/(Math.sqrt(P*P+W*W)*Math.sqrt(R*R+$*$)))/2),H=Math.sqrt(O[0]*O[0]+O[1]*O[1]);D=Math.min(p,(e-H)/(z-1)),I=Math.min(p,(c-H)/(z+1))}if(null!=b){var V=ka(null==M?[x,k]:[M,C],[v,y],c,I,f),Y=ka([b,w],[x,k],c,I,f);p===I?E.push("M",V[0],"A",I,",",I," 0 0,",g," ",V[1],"A",c,",",c," 0 ",1-f^xa(V[1][0],V[1][1],Y[1][0],Y[1][1]),",",f," ",Y[1],"A",I,",",I," 0 0,",g," ",Y[0]):E.push("M",V[0],"A",I,",",I," 0 1,",g," ",Y[0])}else E.push("M",v,",",y);if(null!=M){var F=ka([v,y],[M,C],e,-D,f),G=ka([x,k],null==b?[v,y]:[b,w],e,-D,f);p===D?E.push("L",G[0],"A",D,",",D," 0 0,",g," ",G[1],"A",e,",",e," 0 ",f^xa(G[1][0],G[1][1],F[1][0],F[1][1]),",",1-f," ",F[1],"A",D,",",D," 0 0,",g," ",F[0]):E.push("L",G[0],"A",D,",",D," 0 0,",g," ",F[0])}else E.push("L",x,",",k)}else E.push("M",v,",",y),null!=b&&E.push("A",c,",",c," 0 ",j,",",f," ",b,",",w),E.push("L",x,",",k),null!=M&&E.push("A",e,",",e," 0 ",N,",",1-f," ",M,",",C);return E.push("Z"),E.join("")}function t(e,t){return"M0,"+e+"A"+e+","+e+" 0 1,"+t+" 0,"+-e+"A"+e+","+e+" 0 1,"+t+" 0,"+e}var n=_a,i=va,r=ma,a=Il,o=ya,s=ba,l=wa;return e.innerRadius=function(t){return arguments.length?(n=Ne(t),e):n},e.outerRadius=function(t){return arguments.length?(i=Ne(t),e):i},e.cornerRadius=function(t){return arguments.length?(r=Ne(t),e):r},e.padRadius=function(t){return arguments.length?(a=t==Il?Il:Ne(t),e):a},e.startAngle=function(t){return arguments.length?(o=Ne(t),e):o},e.endAngle=function(t){return arguments.length?(s=Ne(t),e):s},e.padAngle=function(t){return arguments.length?(l=Ne(t),e):l},e.centroid=function(){var e=(+n.apply(this,arguments)+ +i.apply(this,arguments))/2,t=(+o.apply(this,arguments)+ +s.apply(this,arguments))/2-Go;return[Math.cos(t)*e,Math.sin(t)*e]},e};var Il="auto";fo.svg.line=function(){return Ma(k)};var Dl=fo.map({linear:Ca,"linear-closed":Sa,step:Ta,"step-before":Ea,"step-after":ja,basis:Oa,"basis-open":Pa,"basis-closed":Wa,bundle:Ra,cardinal:La,"cardinal-open":Aa,"cardinal-closed":Na,monotone:Fa});Dl.forEach(function(e,t){t.key=e,t.closed=/-closed$/.test(e)});var Ol=[0,2/3,1/3,0],Pl=[0,1/3,2/3,0],Wl=[0,1/6,2/3,1/6];fo.svg.line.radial=function(){var e=Ma(Ga);return e.radius=e.x,delete e.x,e.angle=e.y,delete e.y,e},Ea.reverse=ja,ja.reverse=Ea,fo.svg.area=function(){return Ua(k)},fo.svg.area.radial=function(){var e=Ua(Ga);return e.radius=e.x,delete e.x,e.innerRadius=e.x0,delete e.x0,e.outerRadius=e.x1,delete e.x1,e.angle=e.y,delete e.y,e.startAngle=e.y0,delete e.y0,e.endAngle=e.y1,delete e.y1,e},fo.svg.chord=function(){function e(e,s){var l=t(this,a,e,s),c=t(this,o,e,s);return"M"+l.p0+i(l.r,l.p1,l.a1-l.a0)+(n(l,c)?r(l.r,l.p1,l.r,l.p0):r(l.r,l.p1,c.r,c.p0)+i(c.r,c.p1,c.a1-c.a0)+r(c.r,c.p1,l.r,l.p0))+"Z"}function t(e,t,n,i){var r=t.call(e,n,i),a=s.call(e,r,i),o=l.call(e,r,i)-Go,d=c.call(e,r,i)-Go;return{r:a,a0:o,a1:d,p0:[a*Math.cos(o),a*Math.sin(o)],p1:[a*Math.cos(d),a*Math.sin(d)]}}function n(e,t){return e.a0==t.a0&&e.a1==t.a1}function i(e,t,n){return"A"+e+","+e+" 0 "+ +(n>Vo)+",1 "+t}function r(e,t,n,i){return"Q 0,0 "+i}var a=Mn,o=Cn,s=qa,l=ya,c=ba;return e.radius=function(t){return arguments.length?(s=Ne(t),e):s},e.source=function(t){return arguments.length?(a=Ne(t),e):a},e.target=function(t){return arguments.length?(o=Ne(t),e):o},e.startAngle=function(t){return arguments.length?(l=Ne(t),e):l},e.endAngle=function(t){return arguments.length?(c=Ne(t),e):c},e},fo.svg.diagonal=function(){function e(e,r){var a=t.call(this,e,r),o=n.call(this,e,r),s=(a.y+o.y)/2,l=[a,{x:a.x,y:s},{x:o.x,y:s},o];return l=l.map(i),"M"+l[0]+"C"+l[1]+" "+l[2]+" "+l[3]}var t=Mn,n=Cn,i=Ba;return e.source=function(n){return arguments.length?(t=Ne(n),e):t},e.target=function(t){return arguments.length?(n=Ne(t),e):n},e.projection=function(t){return arguments.length?(i=t,e):i},e},fo.svg.diagonal.radial=function(){var e=fo.svg.diagonal(),t=Ba,n=e.projection;return e.projection=function(e){return arguments.length?n(Ja(t=e)):t},e},fo.svg.symbol=function(){function e(e,i){return(Rl.get(t.call(this,e,i))||Ka)(n.call(this,e,i))}var t=Xa,n=Qa;return e.type=function(n){return arguments.length?(t=Ne(n),e):t},e.size=function(t){return arguments.length?(n=Ne(t),e):n},e};var Rl=fo.map({circle:Ka,cross:function(e){var t=Math.sqrt(e/5)/2;return"M"+-3*t+","+-t+"H"+-t+"V"+-3*t+"H"+t+"V"+-t+"H"+3*t+"V"+t+"H"+t+"V"+3*t+"H"+-t+"V"+t+"H"+-3*t+"Z"},diamond:function(e){var t=Math.sqrt(e/(2*zl)),n=t*zl;return"M0,"+-t+"L"+n+",0 0,"+t+" "+-n+",0Z"},square:function(e){var t=Math.sqrt(e)/2;return"M"+-t+","+-t+"L"+t+","+-t+" "+t+","+t+" "+-t+","+t+"Z"},"triangle-down":function(e){var t=Math.sqrt(e/$l),n=t*$l/2;return"M0,"+n+"L"+t+","+-n+" "+-t+","+-n+"Z"},"triangle-up":function(e){var t=Math.sqrt(e/$l),n=t*$l/2;return"M0,"+-n+"L"+t+","+n+" "+-t+","+n+"Z"}});fo.svg.symbolTypes=Rl.keys();var $l=Math.sqrt(3),zl=Math.tan(30*Uo);Lo.transition=function(e){for(var t,n,i=Hl||++Gl,r=io(e),a=[],o=Vl||{time:Date.now(),ease:Ni,delay:0,duration:250},s=-1,l=this.length;++s<l;){a.push(t=[]);for(var c=this[s],d=-1,u=c.length;++d<u;)(n=c[d])&&ro(n,d,r,i,o),t.push(n)}return eo(a,r,i)},Lo.interrupt=function(e){return this.each(null==e?Yl:Za(io(e)))};var Hl,Vl,Yl=Za(io()),Fl=[],Gl=0;Fl.call=Lo.call,Fl.empty=Lo.empty,Fl.node=Lo.node,Fl.size=Lo.size,fo.transition=function(e,t){return e&&e.transition?Hl?e.transition(t):e:fo.selection().transition(e)},fo.transition.prototype=Fl,Fl.select=function(e){var t,n,i,r=this.id,a=this.namespace,o=[];e=I(e);for(var s=-1,l=this.length;++s<l;){o.push(t=[]);for(var c=this[s],d=-1,u=c.length;++d<u;)(i=c[d])&&(n=e.call(i,i.__data__,d,s))?("__data__"in i&&(n.__data__=i.__data__),ro(n,d,a,r,i[a][r]),t.push(n)):t.push(null)}return eo(o,a,r)},Fl.selectAll=function(e){var t,n,i,r,a,o=this.id,s=this.namespace,l=[];e=D(e);for(var c=-1,d=this.length;++c<d;)for(var u=this[c],h=-1,f=u.length;++h<f;)if(i=u[h]){a=i[s][o],n=e.call(i,i.__data__,h,c),l.push(t=[]);for(var p=-1,g=n.length;++p<g;)(r=n[p])&&ro(r,p,s,o,a),t.push(r)}return eo(l,s,o)},Fl.filter=function(e){var t,n,i,r=[];"function"!=typeof e&&(e=U(e));for(var a=0,o=this.length;a<o;a++){r.push(t=[]);for(var n=this[a],s=0,l=n.length;s<l;s++)(i=n[s])&&e.call(i,i.__data__,s,a)&&t.push(i)}return eo(r,this.namespace,this.id)},Fl.tween=function(e,t){var n=this.id,i=this.namespace;return arguments.length<2?this.node()[i][n].tween.get(e):B(this,null==t?function(t){t[i][n].tween.remove(e)}:function(r){r[i][n].tween.set(e,t)})},Fl.attr=function(e,t){function n(){this.removeAttribute(s)}function i(){this.removeAttributeNS(s.space,s.local)}function r(e){return null==e?n:(e+="",function(){var t,n=this.getAttribute(s);return n!==e&&(t=o(n,e),function(e){this.setAttribute(s,t(e))})})}function a(e){return null==e?i:(e+="",function(){var t,n=this.getAttributeNS(s.space,s.local);return n!==e&&(t=o(n,e),function(e){this.setAttributeNS(s.space,s.local,t(e))})})}if(arguments.length<2){for(t in e)this.attr(t,e[t]);return this}var o="transform"==e?Ki:Mi,s=fo.ns.qualify(e);return to(this,"attr."+e,t,s.local?a:r)},Fl.attrTween=function(e,t){function n(e,n){var i=t.call(this,e,n,this.getAttribute(r));return i&&function(e){this.setAttribute(r,i(e))}}function i(e,n){var i=t.call(this,e,n,this.getAttributeNS(r.space,r.local));return i&&function(e){this.setAttributeNS(r.space,r.local,i(e))}}var r=fo.ns.qualify(e);return this.tween("attr."+e,r.local?i:n)},Fl.style=function(e,t,n){function i(){this.style.removeProperty(e)}function r(t){return null==t?i:(t+="",function(){var i,r=o(this).getComputedStyle(this,null).getPropertyValue(e);return r!==t&&(i=Mi(r,t),function(t){this.style.setProperty(e,i(t),n)})})}var a=arguments.length;if(a<3){if("string"!=typeof e){a<2&&(t="");for(n in e)this.style(n,e[n],t);return this}n=""}return to(this,"style."+e,t,r)},Fl.styleTween=function(e,t,n){function i(i,r){var a=t.call(this,i,r,o(this).getComputedStyle(this,null).getPropertyValue(e));return a&&function(t){this.style.setProperty(e,a(t),n)}}return arguments.length<3&&(n=""),this.tween("style."+e,i)},Fl.text=function(e){return to(this,"text",e,no)},Fl.remove=function(){var e=this.namespace;return this.each("end.transition",function(){var t;this[e].count<2&&(t=this.parentNode)&&t.removeChild(this)})},Fl.ease=function(e){var t=this.id,n=this.namespace;return arguments.length<1?this.node()[n][t].ease:("function"!=typeof e&&(e=fo.ease.apply(fo,arguments)),B(this,function(i){i[n][t].ease=e}))},Fl.delay=function(e){var t=this.id,n=this.namespace;return arguments.length<1?this.node()[n][t].delay:B(this,"function"==typeof e?function(i,r,a){i[n][t].delay=+e.call(i,i.__data__,r,a)}:(e=+e,function(i){i[n][t].delay=e}))},Fl.duration=function(e){var t=this.id,n=this.namespace;return arguments.length<1?this.node()[n][t].duration:B(this,"function"==typeof e?function(i,r,a){i[n][t].duration=Math.max(1,e.call(i,i.__data__,r,a))}:(e=Math.max(1,e),function(i){i[n][t].duration=e}))},Fl.each=function(e,t){var n=this.id,i=this.namespace;if(arguments.length<2){var r=Vl,a=Hl;try{Hl=n,B(this,function(t,r,a){Vl=t[i][n],e.call(t,t.__data__,r,a)})}finally{Vl=r,Hl=a}}else B(this,function(r){var a=r[i][n];(a.event||(a.event=fo.dispatch("start","end","interrupt"))).on(e,t)});return this},Fl.transition=function(){for(var e,t,n,i,r=this.id,a=++Gl,o=this.namespace,s=[],l=0,c=this.length;l<c;l++){s.push(e=[]);for(var t=this[l],d=0,u=t.length;d<u;d++)(n=t[d])&&(i=n[o][r],ro(n,d,o,a,{time:i.time,ease:i.ease,delay:i.delay+i.duration,duration:i.duration})),e.push(n)}return eo(s,o,a)},fo.svg.axis=function(){function e(e){e.each(function(){var e,c=fo.select(this),d=this.__chart__||n,u=this.__chart__=n.copy(),h=null==l?u.ticks?u.ticks.apply(u,s):u.domain():l,f=null==t?u.tickFormat?u.tickFormat.apply(u,s):k:t,p=c.selectAll(".tick").data(h,u),g=p.enter().insert("g",".domain").attr("class","tick").style("opacity",zo),m=fo.transition(p.exit()).style("opacity",zo).remove(),_=fo.transition(p.order()).style("opacity",1),v=Math.max(r,0)+o,y=Jr(u),b=c.selectAll(".domain").data([0]),w=(b.enter().append("path").attr("class","domain"),fo.transition(b));g.append("line"),g.append("text");var x,M,C,S,T=g.select("line"),E=_.select("line"),j=p.select("text").text(f),A=g.select("text"),N=_.select("text"),L="top"===i||"left"===i?-1:1;if("bottom"===i||"top"===i?(e=ao,x="x",C="y",M="x2",S="y2",j.attr("dy",L<0?"0em":".71em").style("text-anchor","middle"),w.attr("d","M"+y[0]+","+L*a+"V0H"+y[1]+"V"+L*a)):(e=oo,x="y",C="x",M="y2",S="x2",j.attr("dy",".32em").style("text-anchor",L<0?"end":"start"),w.attr("d","M"+L*a+","+y[0]+"H0V"+y[1]+"H"+L*a)),T.attr(S,L*r),A.attr(C,L*v),E.attr(M,0).attr(S,L*r),N.attr(x,0).attr(C,L*v),u.rangeBand){var I=u,D=I.rangeBand()/2;d=u=function(e){return I(e)+D}}else d.rangeBand?d=u:m.call(e,u,d);g.call(e,d,u),_.call(e,u,u)})}var t,n=fo.scale.linear(),i=Ul,r=6,a=6,o=3,s=[10],l=null;return e.scale=function(t){return arguments.length?(n=t,e):n},e.orient=function(t){return arguments.length?(i=t in ql?t+"":Ul,e):i},e.ticks=function(){return arguments.length?(s=go(arguments),e):s},e.tickValues=function(t){return arguments.length?(l=t,e):l},e.tickFormat=function(n){return arguments.length?(t=n,e):t},e.tickSize=function(t){var n=arguments.length;return n?(r=+t,a=+arguments[n-1],e):r},e.innerTickSize=function(t){return arguments.length?(r=+t,e):r},e.outerTickSize=function(t){return arguments.length?(a=+t,e):a},e.tickPadding=function(t){return arguments.length?(o=+t,e):o},e.tickSubdivide=function(){return arguments.length&&e},e};var Ul="bottom",ql={top:1,right:1,bottom:1,left:1};fo.svg.brush=function(){function e(a){a.each(function(){var a=fo.select(this).style("pointer-events","all").style("-webkit-tap-highlight-color","rgba(0,0,0,0)").on("mousedown.brush",r).on("touchstart.brush",r),o=a.selectAll(".background").data([0]);o.enter().append("rect").attr("class","background").style("visibility","hidden").style("cursor","crosshair"),a.selectAll(".extent").data([0]).enter().append("rect").attr("class","extent").style("cursor","move");var s=a.selectAll(".resize").data(g,k);s.exit().remove(),s.enter().append("g").attr("class",function(e){return"resize "+e}).style("cursor",function(e){return Bl[e]}).append("rect").attr("x",function(e){return/[ew]$/.test(e)?-3:null}).attr("y",function(e){return/^[ns]/.test(e)?-3:null}).attr("width",6).attr("height",6).style("visibility","hidden"),s.style("display",e.empty()?"none":null);var l,u=fo.transition(a),h=fo.transition(o);c&&(l=Jr(c),h.attr("x",l[0]).attr("width",l[1]-l[0]),n(u)),d&&(l=Jr(d),h.attr("y",l[0]).attr("height",l[1]-l[0]),i(u)),t(u)})}function t(e){e.selectAll(".resize").attr("transform",function(e){return"translate("+u[+/e$/.test(e)]+","+h[+/^s/.test(e)]+")"})}function n(e){e.select(".extent").attr("x",u[0]),e.selectAll(".extent,.n>rect,.s>rect").attr("width",u[1]-u[0])}function i(e){e.select(".extent").attr("y",h[0]),e.selectAll(".extent,.e>rect,.w>rect").attr("height",h[1]-h[0])}function r(){function r(){32==fo.event.keyCode&&(E||(y=null,N[0]-=u[1],N[1]-=h[1],E=2),j())}function g(){32==fo.event.keyCode&&2==E&&(N[0]+=u[1],N[1]+=h[1],E=0,j())}function m(){var e=fo.mouse(w),r=!1;b&&(e[0]+=b[0],e[1]+=b[1]),E||(fo.event.altKey?(y||(y=[(u[0]+u[1])/2,(h[0]+h[1])/2]),N[0]=u[+(e[0]<y[0])],N[1]=h[+(e[1]<y[1])]):y=null),S&&_(e,c,0)&&(n(M),r=!0),T&&_(e,d,1)&&(i(M),r=!0),r&&(t(M),k({type:"brush",mode:E?"move":"resize"}))}function _(e,t,n){var i,r,o=Jr(t),l=o[0],c=o[1],d=N[n],g=n?h:u,m=g[1]-g[0];if(E&&(l-=d,c-=m+d),i=(n?p:f)?Math.max(l,Math.min(c,e[n])):e[n],E?r=(i+=d)+m:(y&&(d=Math.max(l,Math.min(c,2*y[n]-i))),d<i?(r=i,i=d):r=d),g[0]!=i||g[1]!=r)return n?s=null:a=null,g[0]=i,g[1]=r,!0}function v(){m(),M.style("pointer-events","all").selectAll(".resize").style("display",e.empty()?"none":null),fo.select("body").style("cursor",null),L.on("mousemove.brush",null).on("mouseup.brush",null).on("touchmove.brush",null).on("touchend.brush",null).on("keydown.brush",null).on("keyup.brush",null),A(),k({type:"brushend"})}var y,b,w=this,x=fo.select(fo.event.target),k=l.of(w,arguments),M=fo.select(w),C=x.datum(),S=!/^(n|s)$/.test(C)&&c,T=!/^(e|w)$/.test(C)&&d,E=x.classed("extent"),A=ee(w),N=fo.mouse(w),L=fo.select(o(w)).on("keydown.brush",r).on("keyup.brush",g);if(fo.event.changedTouches?L.on("touchmove.brush",m).on("touchend.brush",v):L.on("mousemove.brush",m).on("mouseup.brush",v),M.interrupt().selectAll("*").interrupt(),E)N[0]=u[0]-N[0],N[1]=h[0]-N[1];else if(C){var I=+/w$/.test(C),D=+/^n/.test(C);b=[u[1-I]-N[0],h[1-D]-N[1]],N[0]=u[I],N[1]=h[D]}else fo.event.altKey&&(y=N.slice());M.style("pointer-events","none").selectAll(".resize").style("display",null),fo.select("body").style("cursor",x.style("cursor")),k({type:"brushstart"}),m()}var a,s,l=N(e,"brushstart","brush","brushend"),c=null,d=null,u=[0,0],h=[0,0],f=!0,p=!0,g=Jl[0];return e.event=function(e){e.each(function(){var e=l.of(this,arguments),t={x:u,y:h,i:a,j:s},n=this.__chart__||t;this.__chart__=t,Hl?fo.select(this).transition().each("start.brush",function(){a=n.i,s=n.j,u=n.x,h=n.y,e({type:"brushstart"})}).tween("brush:brush",function(){var n=Ci(u,t.x),i=Ci(h,t.y);return a=s=null,function(r){u=t.x=n(r),h=t.y=i(r),e({type:"brush",mode:"resize"})}}).each("end.brush",function(){a=t.i,s=t.j,e({type:"brush",mode:"resize"}),e({type:"brushend"})}):(e({type:"brushstart"}),e({type:"brush",mode:"resize"}),e({type:"brushend"}))})},e.x=function(t){return arguments.length?(c=t,g=Jl[!c<<1|!d],e):c},e.y=function(t){return arguments.length?(d=t,g=Jl[!c<<1|!d],e):d},e.clamp=function(t){return arguments.length?(c&&d?(f=!!t[0],p=!!t[1]):c?f=!!t:d&&(p=!!t),e):c&&d?[f,p]:c?f:d?p:null},e.extent=function(t){var n,i,r,o,l;return arguments.length?(c&&(n=t[0],i=t[1],d&&(n=n[0],i=i[0]),a=[n,i],c.invert&&(n=c(n),i=c(i)),i<n&&(l=n,n=i,i=l),n==u[0]&&i==u[1]||(u=[n,i])),d&&(r=t[0],o=t[1],c&&(r=r[1],o=o[1]),s=[r,o],d.invert&&(r=d(r),o=d(o)),o<r&&(l=r,r=o,o=l),r==h[0]&&o==h[1]||(h=[r,o])),e):(c&&(a?(n=a[0],i=a[1]):(n=u[0],i=u[1],c.invert&&(n=c.invert(n),i=c.invert(i)),i<n&&(l=n,n=i,i=l))),d&&(s?(r=s[0],o=s[1]):(r=h[0],o=h[1],d.invert&&(r=d.invert(r),o=d.invert(o)),o<r&&(l=r,r=o,o=l))),c&&d?[[n,r],[i,o]]:c?[n,i]:d&&[r,o])},e.clear=function(){return e.empty()||(u=[0,0],h=[0,0],a=s=null),e},e.empty=function(){return!!c&&u[0]==u[1]||!!d&&h[0]==h[1]},fo.rebind(e,l,"on")};var Bl={n:"ns-resize",e:"ew-resize",s:"ns-resize",w:"ew-resize",nw:"nwse-resize",ne:"nesw-resize",se:"nwse-resize",sw:"nesw-resize"},Jl=[["n","e","s","w","nw","ne","se","sw"],["e","w"],["n","s"],[]],Ql=gs.format=ws.timeFormat,Xl=Ql.utc,Kl=Xl("%Y-%m-%dT%H:%M:%S.%LZ");Ql.iso=Date.prototype.toISOString&&+new Date("2000-01-01T00:00:00.000Z")?so:Kl,so.parse=function(e){var t=new Date(e);return isNaN(t)?null:t},so.toString=Kl.toString,gs.second=Ge(function(e){return new ms(1e3*Math.floor(e/1e3))},function(e,t){e.setTime(e.getTime()+1e3*Math.floor(t))},function(e){return e.getSeconds()}),gs.seconds=gs.second.range,gs.seconds.utc=gs.second.utc.range,gs.minute=Ge(function(e){return new ms(6e4*Math.floor(e/6e4))},function(e,t){e.setTime(e.getTime()+6e4*Math.floor(t))},function(e){return e.getMinutes()}),gs.minutes=gs.minute.range,gs.minutes.utc=gs.minute.utc.range,gs.hour=Ge(function(e){var t=e.getTimezoneOffset()/60;return new ms(36e5*(Math.floor(e/36e5-t)+t))},function(e,t){e.setTime(e.getTime()+36e5*Math.floor(t))},function(e){return e.getHours()}),gs.hours=gs.hour.range,gs.hours.utc=gs.hour.utc.range,gs.month=Ge(function(e){return e=gs.day(e),e.setDate(1),e},function(e,t){e.setMonth(e.getMonth()+t)},function(e){return e.getMonth()}),gs.months=gs.month.range,gs.months.utc=gs.month.utc.range;var Zl=[1e3,5e3,15e3,3e4,6e4,3e5,9e5,18e5,36e5,108e5,216e5,432e5,864e5,1728e5,6048e5,2592e6,7776e6,31536e6],ec=[[gs.second,1],[gs.second,5],[gs.second,15],[gs.second,30],[gs.minute,1],[gs.minute,5],[gs.minute,15],[gs.minute,30],[gs.hour,1],[gs.hour,3],[gs.hour,6],[gs.hour,12],[gs.day,1],[gs.day,2],[gs.week,1],[gs.month,1],[gs.month,3],[gs.year,1]],tc=Ql.multi([[".%L",function(e){return e.getMilliseconds()}],[":%S",function(e){return e.getSeconds()}],["%I:%M",function(e){return e.getMinutes()}],["%I %p",function(e){return e.getHours()}],["%a %d",function(e){return e.getDay()&&1!=e.getDate()}],["%b %d",function(e){return 1!=e.getDate()}],["%B",function(e){return e.getMonth()}],["%Y",Dt]]),nc={range:function(e,t,n){return fo.range(Math.ceil(e/n)*n,+t,n).map(co)},floor:k,ceil:k};ec.year=gs.year,gs.scale=function(){return lo(fo.scale.linear(),ec,tc)};var ic=ec.map(function(e){return[e[0].utc,e[1]]}),rc=Xl.multi([[".%L",function(e){return e.getUTCMilliseconds()}],[":%S",function(e){return e.getUTCSeconds()}],["%I:%M",function(e){return e.getUTCMinutes()}],["%I %p",function(e){return e.getUTCHours()}],["%a %d",function(e){return e.getUTCDay()&&1!=e.getUTCDate()}],["%b %d",function(e){return 1!=e.getUTCDate()}],["%B",function(e){return e.getUTCMonth()}],["%Y",Dt]]);ic.year=gs.year.utc,gs.scale.utc=function(){return lo(fo.scale.linear(),ic,rc)},fo.text=Le(function(e){return e.responseText}),fo.json=function(e,t){return Ie(e,"application/json",uo,t)},fo.html=function(e,t){return Ie(e,"text/html",ho,t)},fo.xml=Le(function(e){return e.responseXML}),this.d3=fo,i=fo,void 0!==(r="function"==typeof i?i.call(t,n,t,e):i)&&(e.exports=r)}()},function(e,t,n){"use strict";(function(e,i,r){function a(e){return e&&e.__esModule?e:{default:e}}function o(){function e(t,n,i,r){var a=t.children,d=0,u=t.dist||l;return u=u>1?1:u,t.dist=u,t.y0=null!==r?r.y0+u*o:c,a?(a.forEach(function(r){r.parent=t,d+=e(r,n,i,t)}),t.x0=d/a.length):(t.x0=s*i,s+=1),t.x=t.x0,t.y=t.y0,t.x0}var t=this,n=d.layout.hierarchy().sort(null).value(null),i=360,r="Linear",a=18,o=200,s=0,l=.5,c=50;return t.leafHeight=function(e){return void 0===e?a:(a=e,t)},t.layoutMode=function(e){return void 0===e?r:(r=e,t)},t.layoutAngle=function(e){return void 0===e?i:isNaN(e)||e<0||e>360?t:(i=e,t)},t.separation=function(e){return void 0===e?o:(o=e,t)},t.links=function(e){return d.layout.tree().links(e)},t.nodes=function(o,l){"[object Array]"===toString.call(o)&&(o=o[0]);var c=n.call(t,o,l),d=[],u=0,h=0;return window._d=o,window._nodes=c,c.forEach(function(e){u=e.depth>u?e.depth:u,d.push(e)}),d.forEach(function(e){e.children||(h+=1,e.depth=u)}),a="Circular"===r?i/h:a,s=0,e(d[0],u,a,null),d},t}Object.defineProperty(t,"__esModule",{value:!0});var s=n(3),l=a(s),c=n(76),d=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(c),u=n(25),h=a(u),f=n(24),p=a(f),g=n(45),m=a(g),_=e.View.extend({className:"UserMenuBase",isAcceptableValue:function(e,t,n){var i=e.val(),r=e.attr("displayLabel")||e.attr("id").replace("phyloViz","");return function(e){return!isNaN(parseFloat(e))&&isFinite(e)}(i)?i>n?(alert(r+" is too large."),!1):!(i<t)||(alert(r+" is too small."),!1):(alert(r+" is not a number!"),!1)},hasIllegalJsonCharacters:function(e){return-1!==e.val().search(/"|'|\\/)&&(alert("Named fields cannot contain these illegal characters: double quote(\"), single guote('), or back slash(\\). "),!0)}}),v=h.default.Visualization.extend({defaults:{layout:"Linear",separation:250,leafHeight:18,type:"phyloviz",title:(0,l.default)("Title"),scaleFactor:1,translate:[0,0],fontSize:12,selectedNode:null,nodeAttrChangedTime:0},initialize:function(e){this.set("dataset",new p.default.Dataset({id:e.dataset_id}))},root:{},toggle:function(e){void 0!==e&&(e.children?(e._children=e.children,e.children=null):(e.children=e._children,e._children=null))},toggleAll:function(e){e.children&&0!==e.children.length&&(e.children.forEach(this.toggleAll),toggle(e))},getData:function(){return this.root},save:function(){function e(t){delete t.parent,t._selected&&delete t._selected,t.children&&t.children.forEach(e),t._children&&t._children.forEach(e)}e(this.root);var t=i.extend(!0,{},this.attributes);return t.selectedNode=null,show_message("Saving to Galaxy","progress"),r.ajax({url:this.url(),type:"POST",dataType:"json",data:{config:JSON.stringify(t),type:"phyloviz"},success:function(e){hide_modal()}})}}),y=e.View.extend({defaults:{nodeRadius:4.5},stdInit:function(e){var t=this;t.model.on("change:separation change:leafHeight change:fontSize change:nodeAttrChangedTime",t.updateAndRender,t),t.vis=e.vis,t.i=0,t.maxDepth=-1,t.width=e.width,t.height=e.height},updateAndRender:function(e){var t=(d.select(".vis"),this);e=e||t.model.root,t.renderNodes(e),t.renderLinks(e),t.addTooltips()},renderLinks:function(e){var t=this,n=(t.diagonal,t.duration,t.layoutMode,t.vis.selectAll("g.completeLink").data(t.tree.links(t.nodes),function(e){return e.target.id})),i=function(e){e.pos0=e.source.y0+" "+e.source.x0,e.pos1=e.source.y0+" "+e.target.x0,e.pos2=e.target.y0+" "+e.target.x0};n.enter().insert("svg:g","g.node").attr("class","completeLink").append("svg:path").attr("class","link").attr("d",function(e){return i(e),"M "+e.pos0+" L "+e.pos1}),n.transition().duration(500).select("path.link").attr("d",function(e){return i(e),"M "+e.pos0+" L "+e.pos1+" L "+e.pos2});n.exit().remove()},selectNode:function(e){var t=this;d.selectAll("g.node").classed("selectedHighlight",function(t){return e.id===t.id&&(e._selected?(delete e._selected,!1):(e._selected=!0,!0))}),t.model.set("selectedNode",e),r("#phyloVizSelectedNodeName").val(e.name),r("#phyloVizSelectedNodeDist").val(e.dist),r("#phyloVizSelectedNodeAnnotation").val(e.annotation||"")},addTooltips:function(){r(".tooltip").remove(),r(".node").attr("data-original-title",function(){var e=this.__data__,t=e.annotation||"None";return e?(e.name?e.name+"<br/>":"")+"Dist: "+e.dist+" <br/>Annotation1: "+t+(e.bootstrap?"<br/>Confidence level: "+Math.round(100*e.bootstrap):""):""}).tooltip({placement:"top",trigger:"hover"})}}),b=y.extend({initialize:function(e){var t=this;t.margins=e.margins,t.layoutMode="Linear",t.stdInit(e),t.layout(),t.updateAndRender(t.model.root)},layout:function(){var e=this;e.tree=(new o).layoutMode("Linear"),e.diagonal=d.svg.diagonal().projection(function(e){return[e.y,e.x]})},renderNodes:function(e){var t=this,n=t.model.get("fontSize")+"px";t.tree.separation(t.model.get("separation")).leafHeight(t.model.get("leafHeight"));var i=t.tree.separation(t.model.get("separation")).nodes(t.model.root),r=t.vis.selectAll("g.node").data(i,function(e){return e.name+e.id||(e.id=++t.i)});t.nodes=i,t.duration=500;var a=r.enter().append("svg:g").attr("class","node").on("dblclick",function(){d.event.stopPropagation()}).on("click",function(e){if(d.event.altKey)t.selectNode(e);else{if(e.children&&0===e.children.length)return;t.model.toggle(e),t.updateAndRender(e)}});"[object Array]"===toString.call(e)&&(e=e[0]),a.attr("transform",function(t){return"translate("+e.y0+","+e.x0+")"}),a.append("svg:circle").attr("r",1e-6).style("fill",function(e){return e._children?"lightsteelblue":"#fff"}),a.append("svg:text").attr("class","nodeLabel").attr("x",function(e){return e.children||e._children?-10:10}).attr("dy",".35em").attr("text-anchor",function(e){return e.children||e._children?"end":"start"}).style("fill-opacity",1e-6);var o=r.transition().duration(500);o.attr("transform",function(e){return"translate("+e.y+","+e.x+")"}),o.select("circle").attr("r",t.defaults.nodeRadius).style("fill",function(e){return e._children?"lightsteelblue":"#fff"}),o.select("text").style("fill-opacity",1).style("font-size",n).text(function(e){return e.name&&""!==e.name?e.name:e.bootstrap?Math.round(100*e.bootstrap):""});var s=r.exit().transition().duration(500).remove();s.select("circle").attr("r",1e-6),s.select("text").style("fill-opacity",1e-6),i.forEach(function(e){e.x0=e.x,e.y0=e.y})}}),w=e.View.extend({className:"phyloviz",initialize:function(e){var t=this;t.MIN_SCALE=.05,t.MAX_SCALE=5,t.MAX_DISPLACEMENT=500,t.margins=[10,60,10,80],t.width=r("#PhyloViz").width(),t.height=r("#PhyloViz").height(),t.radius=t.width,t.data=e.data,r(window).resize(function(){t.width=r("#PhyloViz").width(),t.height=r("#PhyloViz").height(),t.render()}),t.phyloTree=new v(e.config),t.phyloTree.root=t.data,t.zoomFunc=d.behavior.zoom().scaleExtent([t.MIN_SCALE,t.MAX_SCALE]),t.zoomFunc.translate(t.phyloTree.get("translate")),t.zoomFunc.scale(t.phyloTree.get("scaleFactor")),t.navMenu=new x(t),t.settingsMenu=new k({phyloTree:t.phyloTree}),t.nodeSelectionView=new M({phyloTree:t.phyloTree}),t.search=new C,setTimeout(function(){t.zoomAndPan()},1e3)},render:function(){var e=this;r("#PhyloViz").empty(),e.mainSVG=d.select("#PhyloViz").append("svg:svg").attr("width",e.width).attr("height",e.height).attr("pointer-events","all").call(e.zoomFunc.on("zoom",function(){e.zoomAndPan()})),e.boundingRect=e.mainSVG.append("svg:rect").attr("class","boundingRect").attr("width",e.width).attr("height",e.height).attr("stroke","black").attr("fill","white"),e.vis=e.mainSVG.append("svg:g").attr("class","vis"),e.layoutOptions={model:e.phyloTree,width:e.width,height:e.height,vis:e.vis,margins:e.margins},r("#title").text("Phylogenetic Tree from "+e.phyloTree.get("title")+":");new b(e.layoutOptions)},zoomAndPan:function(e){var t,n;void 0!==e&&(t=e.zoom,n=e.translate);var i=this,r=i.zoomFunc.scale(),a=i.zoomFunc.translate(),o="",s="";switch(t){case"reset":r=1,a=[0,0];break;case"+":r*=1.1;break;case"-":r*=.9;break;default:"number"==typeof t?r=t:null!==d.event&&(r=d.event.scale)}if(!(r<i.MIN_SCALE||r>i.MAX_SCALE)){if(i.zoomFunc.scale(r),o="translate("+i.margins[3]+","+i.margins[0]+") scale("+r+")",null!==d.event)s="translate("+d.event.translate+")";else{if(void 0!==n){var l=n.split(",")[0],c=n.split(",")[1];isNaN(l)||isNaN(c)||(a=[a[0]+parseFloat(l),a[1]+parseFloat(c)])}i.zoomFunc.translate(a),s="translate("+a+")"}i.phyloTree.set("scaleFactor",r),i.phyloTree.set("translate",a),i.vis.attr("transform",s+o)}},reloadViz:function(){var e=this,t=r("#phylovizNexSelector :selected").val();r.getJSON(e.phyloTree.get("dataset").url(),{tree_index:t,data_type:"raw_data"},function(t){e.data=t.data,e.config=t,e.render()})}}),x=e.View.extend({initialize:function(e){var t=this;t.phylovizView=e,r("#panelHeaderRightBtns").empty(),r("#phyloVizNavBtns").empty(),r("#phylovizNexSelector").off(),t.initNavBtns(),t.initRightHeaderBtns(),r("#phylovizNexSelector").off().on("change",function(){t.phylovizView.reloadViz()})},initRightHeaderBtns:function(){var e=this,t=m.default.create_icon_buttons_menu([{icon_class:"gear",title:(0,l.default)("PhyloViz Settings"),on_click:function(){r("#SettingsMenu").show(),e.settingsMenu.updateUI()}},{icon_class:"disk",title:(0,l.default)("Save visualization"),on_click:function(){var t=r("#phylovizNexSelector option:selected").text();t&&e.phylovizView.phyloTree.set("title",t),e.phylovizView.phyloTree.save()}},{icon_class:"chevron-expand",title:"Search / Edit Nodes",on_click:function(){r("#nodeSelectionView").show()}},{icon_class:"information",title:(0,l.default)("Phyloviz Help"),on_click:function(){window.open("https://galaxyproject.org/learn/visualization/phylogenetic-tree/")}}],{tooltip_config:{placement:"bottom"}});r("#panelHeaderRightBtns").append(t.$el)},initNavBtns:function(){var e=this,t=m.default.create_icon_buttons_menu([{icon_class:"zoom-in",title:(0,l.default)("Zoom in"),on_click:function(){e.phylovizView.zoomAndPan({zoom:"+"})}},{icon_class:"zoom-out",title:(0,l.default)("Zoom out"),on_click:function(){e.phylovizView.zoomAndPan({zoom:"-"})}},{icon_class:"arrow-circle",title:"Reset Zoom/Pan",on_click:function(){e.phylovizView.zoomAndPan({zoom:"reset"})}}],{tooltip_config:{placement:"bottom"}});r("#phyloVizNavBtns").append(t.$el)}}),k=_.extend({className:"Settings",initialize:function(e){var t=this;t.phyloTree=e.phyloTree,t.el=r("#SettingsMenu"),t.inputs={separation:r("#phyloVizTreeSeparation"),leafHeight:r("#phyloVizTreeLeafHeight"),fontSize:r("#phyloVizTreeFontSize")},r("#settingsCloseBtn").off().on("click",function(){t.el.hide()}),r("#phylovizResetSettingsBtn").off().on("click",function(){t.resetToDefaults()}),r("#phylovizApplySettingsBtn").off().on("click",function(){t.apply()})},apply:function(){var e=this;e.isAcceptableValue(e.inputs.separation,50,2500)&&e.isAcceptableValue(e.inputs.leafHeight,5,30)&&e.isAcceptableValue(e.inputs.fontSize,5,20)&&r.each(e.inputs,function(t,n){e.phyloTree.set(t,n.val())})},updateUI:function(){var e=this;r.each(e.inputs,function(t,n){n.val(e.phyloTree.get(t))})},resetToDefaults:function(){r(".tooltip").remove();var e=this;r.each(e.phyloTree.defaults,function(t,n){e.phyloTree.set(t,n)}),e.updateUI()},render:function(){}}),M=_.extend({className:"Settings",initialize:function(e){var t=this;t.el=r("#nodeSelectionView"),t.phyloTree=e.phyloTree,t.UI={enableEdit:r("#phylovizEditNodesCheck"),saveChanges:r("#phylovizNodeSaveChanges"),cancelChanges:r("#phylovizNodeCancelChanges"),name:r("#phyloVizSelectedNodeName"),dist:r("#phyloVizSelectedNodeDist"),annotation:r("#phyloVizSelectedNodeAnnotation")},t.valuesOfConcern={name:null,dist:null,annotation:null},r("#nodeSelCloseBtn").off().on("click",function(){t.el.hide()}),t.UI.saveChanges.off().on("click",function(){t.updateNodes()}),t.UI.cancelChanges.off().on("click",function(){t.cancelChanges()}),function(e){e.fn.enable=function(t){return e(this).each(function(){t?e(this).removeAttr("disabled"):e(this).attr("disabled","disabled")})}}(i),t.UI.enableEdit.off().on("click",function(){t.toggleUI()})},toggleUI:function(){var e=this,t=e.UI.enableEdit.is(":checked");t||e.cancelChanges(),r.each(e.valuesOfConcern,function(n,i){e.UI[n].enable(t)}),t?(e.UI.saveChanges.show(),e.UI.cancelChanges.show()):(e.UI.saveChanges.hide(),e.UI.cancelChanges.hide())},cancelChanges:function(){var e=this,t=e.phyloTree.get("selectedNode");t&&r.each(e.valuesOfConcern,function(n,i){e.UI[n].val(t[n])})},updateNodes:function(){var e=this,t=e.phyloTree.get("selectedNode");if(t){if(!e.isAcceptableValue(e.UI.dist,0,1)||e.hasIllegalJsonCharacters(e.UI.name)||e.hasIllegalJsonCharacters(e.UI.annotation))return;r.each(e.valuesOfConcern,function(n,i){t[n]=e.UI[n].val()}),e.phyloTree.set("nodeAttrChangedTime",new Date)}else alert("No node selected")}}),C=_.extend({initialize:function(){var e=this;r("#phyloVizSearchBtn").on("click",function(){var t=r("#phyloVizSearchTerm"),n=r("#phyloVizSearchCondition").val().split("-"),i=n[0],a=n[1];e.hasIllegalJsonCharacters(t),"dist"===i&&e.isAcceptableValue(t,0,1),e.searchTree(i,a,t.val())})},searchTree:function(e,t,n){d.selectAll("g.node").classed("searchHighlight",function(i){var r=i[e];if(void 0!==r&&null!==r)if("dist"===e)switch(t){case"greaterEqual":return r>=+n;case"lesserEqual":return r<=+n;default:return}else if("name"===e||"annotation"===e)return-1!==r.toLowerCase().indexOf(n.toLowerCase())})}});t.default={PhylovizView:w}}).call(t,n(2),n(0),n(0))},function(e,t,n){"use strict";(function(e,i){function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(3),s=a(o),l=n(1),c=r(l),d=n(76),u=r(d),h=n(46),f=(a(h),n(25)),p=a(f),g=n(115),m=a(g),_=n(80),v=a(_),y=n(24),b=a(y),w=n(69),x=a(w),k=n(45),M=a(k),C=e.Model.extend({defaults:{inputs:null,values:null}}),S=e.Model.extend({defaults:{tool:null,tree_data:null},initialize:function(e){var t=this;this.get("tool").get("inputs").each(function(e){e.on("change:min change:max change:num_samples",function(e){e.get("in_ptree")&&t.set_tree_data()},t),e.on("change:in_ptree",function(e){e.get("in_ptree")?t.add_param(e):t.remove_param(e),t.set_tree_data()},t)}),e.config&&c.each(e.config,function(e){var n=t.get("tool").get("inputs").find(function(t){return t.get("name")===e.name});t.add_param(n),n.set(e)})},add_param:function(e){e.get("ptree_index")||(e.set("in_ptree",!0),e.set("ptree_index",this.get_tree_params().length))},remove_param:function(e){e.set("in_ptree",!1),e.set("ptree_index",null),c(this.get_tree_params()).each(function(e,t){e.set("ptree_index",t+1)})},set_tree_data:function(){var e=c.map(this.get_tree_params(),function(e){return{param:e,samples:e.get_samples()}}),t=0;this.set("tree_data",{name:"Root",id:t++,children:0!==e.length?function e(n,i){var r=n[i],a=r.param,o=(a.get("label"),r.samples);return n.length-1===i?c.map(o,function(e){return{id:t++,name:e,param:a,value:e}}):c.map(o,function(r){return{id:t++,name:r,param:a,value:r,children:e(n,i+1)}})}(e,0):null})},get_tree_params:function(){return c(this.get("tool").get("inputs").where({in_ptree:!0})).sortBy(function(e){return e.get("ptree_index")})},get_num_leaves:function(){return this.get_tree_params().reduce(function(e,t){return e*t.get_samples().length},1)},get_node_settings:function(e){var t=this.get("tool").get_inputs_dict(),n=e.parent;if(n)for(;0!==n.depth;)t[n.param.get("name")]=n.value,n=n.parent;var i=this,r=function e(t,n){return t.param&&(n[t.param.get("name")]=t.value),t.children?c.flatten(c.map(t.children,function(t){return e(t,c.clone(n))})):new C({inputs:i.get("tool").get("inputs"),values:n})}(e,t);return c.isArray(r)||(r=[r]),r},get_connected_nodes:function(e){for(var t=[],n=e.parent;n;)t.push(n),n=n.parent;return c.flatten([t,function e(t){return t.children?c.flatten([t,c.map(t.children,function(t){return e(t)})]):t}(e)])},get_leaf:function(e){for(var t=this.get("tree_data");t.children;)t=function(t){return c.find(t,function(t){return e[t.param.get("name")]===t.value})}(t.children);return t},toJSON:function(){return this.get_tree_params().map(function(e){return{name:e.get("name"),min:e.get("min"),max:e.get("max"),num_samples:e.get("num_samples")}})}}),T=e.Model.extend({defaults:{track:null,mode:"Pack",settings:null,regions:null},initialize:function(e){if(this.set("regions",e.regions),e.track){var t=c.extend({data_url:Galaxy.root+"dummy1",converted_datasets_state_url:Galaxy.root+"dummy2"},e.track);this.set("track",m.default.object_from_template(t,{},null))}},same_settings:function(e){var t=this.get("settings"),n=e.get("settings");for(var i in t)if(!n[i]||t[i]!==n[i])return!1;return!0},toJSON:function(){return{track:this.get("track").to_dict(),settings:this.get("settings"),regions:this.get("regions")}}}),E=e.Collection.extend({model:T}),j=p.default.Visualization.extend({defaults:c.extend({},p.default.Visualization.prototype.defaults,{dataset:null,tool:null,parameter_tree:null,regions:null,tracks:null,default_mode:"Pack"}),initialize:function(e){this.set("dataset",new b.default.Dataset(e.dataset)),this.set("tool",new v.default.Tool(e.tool)),this.set("regions",new p.default.GenomeRegionCollection(e.regions)),this.set("tracks",new E(e.tracks));var t=this.get("tool");this.set("tool_with_samplable_inputs",t),t.remove_inputs(["data","hidden_data","conditional","text"]),this.set("parameter_tree",new S({tool:t,config:e.tree_config}))},add_track:function(e){this.get("tracks").add(e)},toJSON:function(){return{id:this.get("id"),title:"Parameter exploration for dataset '"+this.get("dataset").get("name")+"'",type:"sweepster",dataset_id:this.get("dataset").id,tool_id:this.get("tool").id,regions:this.get("regions").toJSON(),tree_config:this.get("parameter_tree").toJSON(),tracks:this.get("tracks").toJSON()}}}),A=e.View.extend({tagName:"tr",TILE_LEN:250,initialize:function(e){this.canvas_manager=e.canvas_manager,this.render(),this.model.on("change:track change:mode",this.draw_tiles,this)},render:function(){var e=this.model.get("settings"),t=e.get("values"),n=i("<td/>").addClass("settings").appendTo(this.$el),r=i("<div/>").addClass("track-info").hide().appendTo(n);r.append(i("<div/>").css("font-weight","bold").text("Track Settings")),e.get("inputs").each(function(e){r.append(e.get("label")+": "+t[e.get("name")]+"<br/>")});var a=this,o=(i("<button/>").appendTo(r).text("Run on complete dataset").click(function(){r.toggle(),a.trigger("run_on_dataset",e)}),M.default.create_icon_buttons_menu([{title:(0,s.default)("Settings"),icon_class:"gear track-settings",on_click:function(){r.toggle()}},{title:(0,s.default)("Remove"),icon_class:"cross-circle",on_click:function(){a.$el.remove(),i(".tooltip").remove()}}]));n.prepend(o.$el),this.model.get("regions").each(function(){a.$el.append(i("<td/>").addClass("tile").html(i("<img/>").attr("src",Galaxy.root+"images/loading_large_white_bg.gif")))}),this.model.get("track")&&this.draw_tiles()},draw_tiles:function(){var e=this,t=this.model.get("track"),n=this.model.get("regions"),r=this.$el.find("td.tile");t&&i.when(t.data_manager.data_is_ready()).then(function(a){n.each(function(n,a){var o=n.length()/e.TILE_LEN,s=1/o,l=e.model.get("mode");i.when(t.data_manager.get_data(n,l,o,{})).then(function(o){var c=e.canvas_manager.new_canvas();c.width=e.TILE_LEN,c.height=t.get_canvas_height(o,l,s,c.width),t.draw_tile(o,c.getContext("2d"),l,n,s),i(r[a]).empty().append(c)})})})}}),N=e.View.extend({number_input_template:'<div class="form-row-input sweep"><input class="min" type="text" size="6" value="<%= min %>"> - <input class="max" type="text" size="6" value="<%= max %>"> samples: <input class="num_samples" type="text" size="1" value="<%= num_samples %>"></div>',select_input_template:'<div class="form-row-input sweep"><%= options %></div>',initialize:function(e){this.$el=e.tool_row,this.render()},render:function(){var e=this.model,t=(e.get("type"),this.$el.find(".form-row-input")),n=null;if(t.find(":input").change(function(){e.set("value",i(this).val())}),e instanceof v.default.IntegerToolParameter)n=i(c.template(this.number_input_template)(this.model.toJSON()));else if(e instanceof v.default.SelectToolParameter){var r=c.map(this.$el.find("select option"),function(e){return i(e).val()}),a=r.join(", ");n=i(c.template(this.select_input_template)({options:a}))}n.insertAfter(t);var o=this,l=M.default.create_icon_buttons_menu([{title:(0,s.default)("Add parameter to tree"),icon_class:"plus-button",on_click:function(){e.set("in_ptree",!0),t.hide(),n.show(),i(this).hide(),o.$el.find(".icon-button.toggle").show()}},{title:(0,s.default)("Remove parameter from tree"),icon_class:"toggle",on_click:function(){e.set("in_ptree",!1),n.hide(),t.show(),i(this).hide(),o.$el.find(".icon-button.plus-button").show()}}],{});this.$el.prepend(l.$el),e.get("in_ptree")?(t.hide(),o.$el.find(".icon-button.plus-button").hide()):(o.$el.find(".icon-button.toggle").hide(),n.hide()),c.each(["min","max","num_samples"],function(t){n.find("."+t).change(function(){e.set(t,parseFloat(i(this).val()))})})}}),L=e.View.extend({className:"tree-design",initialize:function(e){this.render()},render:function(){var e=new v.default.ToolFormView({model:this.model.get("tool")});e.render(),this.$el.append(e.$el);var t=this,n=t.model.get("tool").get("inputs");this.$el.find(".form-row").not(".form-actions").each(function(e){new N({model:n.at(e),tool_row:i(this)})})}}),I=e.View.extend({className:"tool-parameter-tree",initialize:function(e){this.model.on("change:tree_data",this.render,this)},render:function(){this.$el.children().remove();var e=this.model.get_tree_params();if(e.length){this.width=100*(2+e.length),this.height=15*this.model.get_num_leaves();var t=this,n=u.layout.cluster().size([this.height,this.width-160]),r=u.svg.diagonal().projection(function(e){return[e.y,e.x]}),a=n.nodes(this.model.get("tree_data")),o=c.uniq(c.pluck(a,"y"));c.each(e,function(e,n){var r=o[n+1],a=i("#center").position().left;t.$el.append(i("<div>").addClass("label").text(e.get("label")).css("left",r+a))});var s=u.select(this.$el[0]).append("svg").attr("width",this.width).attr("height",this.height+30).append("g").attr("transform","translate(40, 20)"),l=(s.selectAll("path.link").data(n.links(a)).enter().append("path").attr("class","link").attr("d",r),s.selectAll("g.node").data(a).enter().append("g").attr("class","node").attr("transform",function(e){return"translate("+e.y+","+e.x+")"}).on("mouseover",function(e){var n=c.pluck(t.model.get_connected_nodes(e),"id");l.filter(function(e){return void 0!==c.find(n,function(t){return t===e.id})}).style("fill","#f00")}).on("mouseout",function(){l.style("fill","#000")}));l.append("circle").attr("r",9),l.append("text").attr("dx",function(e){return e.children?-12:12}).attr("dy",3).attr("text-anchor",function(e){return e.children?"end":"start"}).text(function(e){return e.name})}}}),D=e.View.extend({className:"Sweepster",helpText:"<div><h4>Getting Started</h4><ol><li>Create a parameter tree by using the icons next to the tool's parameter names to add or remove parameters.<li>Adjust the tree by using parameter inputs to select min, max, and number of samples<li>Run the tool with different settings by clicking on tree nodes</ol></div>",initialize:function(e){this.canvas_manager=new p.default.CanvasManager(this.$el.parents("body")),this.tool_param_tree_view=new I({model:this.model.get("parameter_tree")}),this.track_collection_container=i("<table/>").addClass("tracks"),this.model.get("parameter_tree").on("change:tree_data",this.handle_node_clicks,this);var t=this;this.model.get("tracks").each(function(e){e.get("track").view=t}),this.config=x.default.ConfigSettingCollection.from_models_and_saved_values([{key:"name",label:"Name",type:"text",default_value:""},{key:"a_color",label:"A Color",type:"color",default_value:"#FF0000"},{key:"c_color",label:"C Color",type:"color",default_value:"#00FF00"},{key:"g_color",label:"G Color",type:"color",default_value:"#0000FF"},{key:"t_color",label:"T Color",type:"color",default_value:"#FF00FF"},{key:"n_color",label:"N Color",type:"color",default_value:"#AAAAAA"},{key:"block_color",label:"Block color",type:"color"},{key:"reverse_strand_color",label:"Antisense strand color",type:"color"}],{})},render:function(){var e=new L({model:this.model.get("parameter_tree")});i("#left").append(e.$el);var t=this,n=t.model.get("regions"),r=i("<tr/>").appendTo(this.track_collection_container);n.each(function(e){r.append(i("<th>").text(e.toString()))}),r.children().first().attr("colspan",2);var a=i("<div>").addClass("tiles");i("#right").append(a.append(this.track_collection_container)),t.model.get("tracks").each(function(e){t.add_track(e)});var o=i(this.helpText).addClass("help"),l=M.default.create_icon_buttons_menu([{title:(0,s.default)("Close"),icon_class:"cross-circle",on_click:function(){i(".tooltip").remove(),o.remove()}}]);o.prepend(l.$el.css("float","right")),i("#center").append(o),this.tool_param_tree_view.render(),i("#center").append(this.tool_param_tree_view.$el),this.handle_node_clicks();var d=M.default.create_icon_buttons_menu([{icon_class:"chevron-expand",title:"Set display mode"},{icon_class:"cross-circle",title:(0,s.default)("Close"),on_click:function(){window.location="${h.url_for( controller='visualization', action='list' )}"}}],{tooltip_config:{placement:"bottom"}}),u=["Squish","Pack"],h={};c.each(u,function(e){h[e]=function(){t.model.set("default_mode",e),t.model.get("tracks").each(function(t){t.set("mode",e)})}}),make_popupmenu(d.$el.find(".chevron-expand"),h),d.$el.attr("style","float: right"),i("#right .unified-panel-header-inner").append(d.$el)},get_base_color:function(e){return this.config.get_value(e.toLowerCase()+"_color")||this.config.get_value("n_color")},run_tool_on_dataset:function(e){var t=this.model.get("tool"),n=t.get("name"),r=this.model.get("dataset");t.set_input_values(e.get("values")),i.when(t.rerun(r)).then(function(e){}),show_modal("Running "+n+" on complete dataset",n+" is running on dataset '"+r.get("name")+"'. Outputs are in the dataset's history.",{Ok:function(){hide_modal()}})},add_track:function(e){var t=this,n=this.model.get("parameter_tree");t.model.add_track(e);var i=new A({model:e,canvas_manager:t.canvas_manager});return i.on("run_on_dataset",t.run_tool_on_dataset,t),t.track_collection_container.append(i.$el),i.$el.hover(function(){var i=n.get_leaf(e.get("settings").get("values")),r=c.pluck(n.get_connected_nodes(i),"id");u.select(t.tool_param_tree_view.$el[0]).selectAll("g.node").filter(function(e){return void 0!==c.find(r,function(t){return t===e.id})}).style("fill","#f00")},function(){u.select(t.tool_param_tree_view.$el[0]).selectAll("g.node").style("fill","#000")}),e},handle_node_clicks:function(){var e=this,t=this.model.get("parameter_tree"),n=this.model.get("regions");u.select(this.tool_param_tree_view.$el[0]).selectAll("g.node").on("click",function(r,a){var o=e.model.get("tool"),s=e.model.get("dataset"),l=t.get_node_settings(r),d=i.Deferred();l.length>=10?show_modal("Whoa there cowboy!","You clicked on a node to try "+e.model.get("tool").get("name")+" with "+l.length+" different combinations of settings. You can only run 10 jobs at a time.",{Ok:function(){hide_modal(),d.resolve(!1)}}):d.resolve(!0),i.when(d).then(function(t){if(t){var r=c.map(l,function(t){var i=new T({settings:t,regions:n,mode:e.model.get("default_mode")});return e.add_track(i),i});c.each(r,function(t,r){setTimeout(function(){o.set_input_values(t.get("settings").get("values")),i.when(o.rerun(s,n)).then(function(n){var i=n.first(),r=i.get("track_config");r.dataset=i,r.tool=null,r.prefs=e.config.to_key_value_dict();var a=m.default.object_from_template(r,e,null);a.init_for_tool_data(),t.set("track",a)})},1e4*r)})}})})}});t.default={SweepsterVisualization:j,SweepsterVisualizationView:D}}).call(t,n(2),n(0))},function(e,t,n){"use strict";(function(e,i){function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var a=n(5),o=(r(a),n(7)),s=r(o),l=n(4),c=r(l),d=n(18),u=(r(d),n(317)),h=r(u),f=n(319),p=r(f),g=n(321),m=r(g),_=n(322),v=r(_),y=n(138),b=r(y),w=n(323),x=r(w),k=n(324),M=r(k),C=e.Router.extend({initialize:function(){this.routesHit=0,e.history.on("route",function(){this.routesHit++},this),this.bind("route",this.trackPageview)},routes:{"":"libraries","page/:show_page":"libraries_page","library/:library_id/permissions":"library_permissions","folders/:folder_id/permissions":"folder_permissions","folders/:id":"folder_content","folders/:id/page/:show_page":"folder_page","folders/:folder_id/datasets/:dataset_id":"dataset_detail","folders/:folder_id/datasets/:dataset_id/permissions":"dataset_permissions","folders/:folder_id/datasets/:dataset_id/versions/:ldda_id":"dataset_version","folders/:folder_id/download/:format":"download","folders/:folder_id/import/:source":"import_datasets"},back:function(){this.routesHit>1?window.history.back():this.navigate("#",{trigger:!0,replace:!0})},trackPageview:function(){var t=e.history.getFragment();/^\//.test(t)||""==t||(t="/"+t),"undefined"!=typeof ga&&ga("send","pageview",Galaxy.root+"library/list"+t)}}),S=c.default.SessionStorageModel.extend({defaults:{with_deleted:!1,without_restricted:!1,sort_order:"asc",sort_by:"name",library_page_size:20,folder_page_size:15}}),T=e.View.extend({libraryToolbarView:null,libraryListView:null,library_router:null,libraryView:null,folderToolbarView:null,folderListView:null,datasetView:null,initialize:function(){window.Galaxy.config.ga_code&&(!function(e,t,n,i,r,a,o){e.GoogleAnalyticsObject=r,e[r]=e[r]||function(){(e[r].q=e[r].q||[]).push(arguments)},e[r].l=1*new Date,a=t.createElement(n),o=t.getElementsByTagName(n)[0],a.async=1,a.src="//www.google-analytics.com/analytics.js",o.parentNode.insertBefore(a,o)}(window,document,"script",0,"ga"),ga("create",window.Galaxy.config.ga_code,"auto"),ga("send","pageview")),Galaxy.libraries=this,this.preferences=new S({id:"global-lib-prefs"}),this.library_router=new C,this.library_router.on("route:libraries",function(){Galaxy.libraries.libraryToolbarView&&Galaxy.libraries.libraryToolbarView.$el.unbind("click"),Galaxy.libraries.libraryToolbarView=new m.default.LibraryToolbarView,Galaxy.libraries.libraryListView=new p.default.LibraryListView}),this.library_router.on("route:libraries_page",function(e){null===Galaxy.libraries.libraryToolbarView?(Galaxy.libraries.libraryToolbarView=new m.default.LibraryToolbarView,Galaxy.libraries.libraryListView=new p.default.LibraryListView({show_page:e})):Galaxy.libraries.libraryListView.render({show_page:e})}),this.library_router.on("route:folder_content",function(e){Galaxy.libraries.folderToolbarView&&Galaxy.libraries.folderToolbarView.$el.unbind("click"),Galaxy.libraries.folderToolbarView=new v.default.FolderToolbarView({id:e}),Galaxy.libraries.folderListView=new h.default.FolderListView({id:e})}),this.library_router.on("route:folder_page",function(e,t){null===Galaxy.libraries.folderToolbarView?(Galaxy.libraries.folderToolbarView=new v.default.FolderToolbarView({id:e}),Galaxy.libraries.folderListView=new h.default.FolderListView({id:e,show_page:t})):Galaxy.libraries.folderListView.render({id:e,show_page:parseInt(t)})}),this.library_router.on("route:download",function(e,t){0===i("#folder_list_body").find(":checked").length?(s.default.info("You must select at least one dataset to download"),Galaxy.libraries.library_router.navigate("folders/"+e,{trigger:!0,replace:!0})):(Galaxy.libraries.folderToolbarView.download(t),Galaxy.libraries.library_router.navigate("folders/"+e,{trigger:!1,replace:!0}))}),this.library_router.on("route:dataset_detail",function(e,t){Galaxy.libraries.datasetView&&Galaxy.libraries.datasetView.$el.unbind("click"),Galaxy.libraries.datasetView=new b.default.LibraryDatasetView({id:t,show_version:!1,show_permissions:!1})}),this.library_router.on("route:dataset_version",function(e,t,n){Galaxy.libraries.datasetView&&Galaxy.libraries.datasetView.$el.unbind("click"),Galaxy.libraries.datasetView=new b.default.LibraryDatasetView({id:t,ldda_id:n,show_version:!0})}),this.library_router.on("route:dataset_permissions",function(e,t){Galaxy.libraries.datasetView&&Galaxy.libraries.datasetView.$el.unbind("click"),Galaxy.libraries.datasetView=new b.default.LibraryDatasetView({id:t,show_permissions:!0})}),this.library_router.on("route:library_permissions",function(e){Galaxy.libraries.libraryView&&Galaxy.libraries.libraryView.$el.unbind("click"),Galaxy.libraries.libraryView=new x.default.LibraryView({id:e,show_permissions:!0})}),this.library_router.on("route:folder_permissions",function(e){Galaxy.libraries.folderView&&Galaxy.libraries.folderView.$el.unbind("click"),Galaxy.libraries.folderView=new M.default.FolderView({id:e,show_permissions:!0})}),this.library_router.on("route:import_datasets",function(e,t){Galaxy.libraries.folderToolbarView&&Galaxy.libraries.folderListView?Galaxy.libraries.folderToolbarView.showImportModal({source:t}):(Galaxy.libraries.folderToolbarView=new v.default.FolderToolbarView({id:e}),Galaxy.libraries.folderListView=new h.default.FolderListView({id:e}),Galaxy.libraries.folderToolbarView.showImportModal({source:t}))}),e.history.start({pushState:!1})}});t.default={GalaxyApp:T}}).call(t,n(2),n(0))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(e,t){return function(n,i){return n.get("type")===i.get("type")?n.has(e)||i.has(e)?n.has(e)?i.has(e)?n.get(e).toLowerCase()>i.get(e).toLowerCase()?"asc"===t?1:-1:i.get(e).toLowerCase()>n.get(e).toLowerCase()?"asc"===t?-1:1:0:-1:1:0:"folder"===n.get("type")?-1:1}},r=function(e,t){return function(n,i){return n.get(e).toLowerCase()>i.get(e).toLowerCase()?"asc"===t?1:-1:i.get(e).toLowerCase()>n.get(e).toLowerCase()?"asc"===t?-1:1:0}};t.default={generateFolderComparator:i,generateLibraryComparator:r}},function(e,t,n){"use strict";(function(e,i,r){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(7),s=a(o),l=n(18),c=a(l),d=n(318),u=a(d),h=e.View.extend({el:"#folder_items_element",progress:0,progressStep:1,folderContainer:null,current_sort_order:"asc",current_sort_key:"name",events:{"click #select-all-checkboxes":"selectAll","click .dataset_row":"selectClickedRow","click .folder_row":"selectClickedRow","click .sort-folder-name":"sortColumnClicked","click .sort-folder-file_ext":"sortColumnClicked","click .sort-folder-description":"sortColumnClicked","click .sort-folder-state":"sortColumnClicked"},collection:null,defaults:{include_deleted:!1,page_count:null,show_page:null},initialize:function(e){this.options=i.defaults(this.options||{},this.defaults,e),this.modal=null,this.rowViews={},this.collection=new c.default.Folder,this.listenTo(this.collection,"add",this.renderOne),this.listenTo(this.collection,"remove",this.removeOne),this.listenTo(this.collection,"sort",this.rePaint),this.listenTo(this.collection,"reset",this.rePaint),this.fetchFolder()},fetchFolder:function(e){var e=e||{};this.options.include_deleted=e.include_deleted;var t=this;this.folderContainer=new c.default.FolderContainer({id:this.options.id}),this.folderContainer.url=this.folderContainer.attributes.urlRoot+this.options.id+"/contents",this.options.include_deleted&&(this.folderContainer.url=this.folderContainer.url+"?include_deleted=true"),this.folderContainer.fetch({success:function(e){t.folder_container=e,t.render()},error:function(e,t){void 0!==t.responseJSON?s.default.error(t.responseJSON.err_msg+" Click this to go back.","",{onclick:function(){Galaxy.libraries.library_router.back()}}):s.default.error("An error occurred. Click this to go back.","",{onclick:function(){Galaxy.libraries.library_router.back()}})}})},render:function(e){this.options=i.extend(this.options,e);var t=this.templateFolder();r(".tooltip").hide();var n,a=this.folderContainer.attributes.metadata.full_path;if(n=1===a.length?0:a[a.length-2][0],this.$el.html(t({path:this.folderContainer.attributes.metadata.full_path,parent_library_id:this.folderContainer.attributes.metadata.parent_library_id,id:this.options.id,upper_folder_id:n,order:this.current_sort_order})),this.options.dataset_id){var o=i.findWhere(self.rowViews,{id:this.options.dataset_id});o?o.showDatasetDetails():s.default.error("Requested dataset not found. Showing folder instead.")}else(null===this.options.show_page||this.options.show_page<1)&&(this.options.show_page=1),this.paginate();r("#center [data-toggle]").tooltip(),r("#center").css("overflow","auto")},paginate:function(e){this.options=i.extend(this.options,e),(null===this.options.show_page||this.options.show_page<1)&&(this.options.show_page=1),this.options.total_items_count=this.folder_container.get("folder").models.length,this.options.page_count=Math.ceil(this.options.total_items_count/Galaxy.libraries.preferences.get("folder_page_size"));var t=Galaxy.libraries.preferences.get("folder_page_size")*(this.options.show_page-1),n=null;n=this.folder_container.get("folder").models.slice(t,t+Galaxy.libraries.preferences.get("folder_page_size")),this.options.items_shown=n.length,Galaxy.libraries.preferences.get("folder_page_size")*this.options.show_page>this.options.total_items_count+Galaxy.libraries.preferences.get("folder_page_size")&&(n=[]),Galaxy.libraries.folderToolbarView.renderPaginator(this.options),this.collection.reset(n)},rePaint:function(e){this.options=i.extend(this.options,e),this.removeAllRows(),this.renderAll(),this.checkEmptiness()},addAll:function(e){i.each(e,function(e){Galaxy.libraries.folderListView.collection.add(e,{current_sort_order:!1})}),r("#center [data-toggle]").tooltip(),this.checkEmptiness(),this.postRender()},postRender:function(){var e=this.folderContainer.attributes.metadata;e.contains_file_or_folder=void 0!==this.collection.findWhere({type:"file"})||void 0!==this.collection.findWhere({type:"folder"}),Galaxy.libraries.folderToolbarView.configureElements(e)},renderAll:function(){var e=this;i.each(this.collection.models.reverse(),function(t){e.renderOne(t)}),this.postRender()},renderOne:function(e){this.options.contains_file_or_folder=!0,e.set("folder_id",this.id);var t=new u.default.FolderRowView({model:e});this.rowViews[e.get("id")]=t,this.$el.find("#first_folder_item").after(t.el)},removeOne:function(e){this.$el.find("tr").filter(function(){return r(this).data("id")&&r(this).data("id")===e.id}).remove()},removeAllRows:function(){r(".library-row").remove()},checkEmptiness:function(){0===this.$el.find(".dataset_row").length&&0===this.$el.find(".folder_row").length?this.$el.find(".empty-folder-message").show():this.$el.find(".empty-folder-message").hide()},sortColumnClicked:function(e){e.preventDefault(),this.current_sort_order="asc"===this.current_sort_order?"desc":"asc",this.current_sort_key=e.currentTarget.className.replace("sort-folder-",""),this.collection.sortFolder(this.current_sort_key,this.current_sort_order),this.renderSortIcon()},selectAll:function(e){var t=e.target.checked,n=this;r(":checkbox","#folder_list_body").each(function(){this.checked=t;var e=r(this).closest("tr");t?n.makeDarkRow(e):n.makeWhiteRow(e)})},selectClickedRow:function(e){var t,n,i="";t=r(e.target).closest("tr"),"input"===e.target.localName?(i=e.target,n="input"):"td"===e.target.localName&&(i=t.find(":checkbox")[0],n="td"),i.checked?"td"===n?(i.checked="",this.makeWhiteRow(t)):"input"===n&&this.makeDarkRow(t):"td"===n?(i.checked="selected",this.makeDarkRow(t)):"input"===n&&this.makeWhiteRow(t)},makeDarkRow:function(e){e.removeClass("light").addClass("dark"),e.find("a").removeClass("light").addClass("dark"),e.find(".fa-file-o").removeClass("fa-file-o").addClass("fa-file"),e.find(".fa-folder-o").removeClass("fa-folder-o").addClass("fa-folder")},makeWhiteRow:function(e){e.removeClass("dark").addClass("light"),e.find("a").removeClass("dark").addClass("light"),e.find(".fa-file").removeClass("fa-file").addClass("fa-file-o"),e.find(".fa-folder").removeClass("fa-folder").addClass("fa-folder-o")},renderSortIcon:function(){"asc"===this.current_sort_order?(r('[class*="sort-icon"]').removeClass("fa-sort-alpha-desc").removeClass("fa-sort-alpha-asc"),r(".sort-icon-"+this.current_sort_key).addClass("fa-sort-alpha-asc")):r(".sort-icon-"+this.current_sort_key).addClass("fa-sort-alpha-desc")},templateFolder:function(){return i.template(['<ol class="breadcrumb">','<li><a title="Return to the list of libraries" href="#">Libraries</a></li>',"<% _.each(path, function(path_item) { %>","<% if (path_item[0] != id) { %>",'<li><a title="Return to this folder" href="#/folders/<%- path_item[0] %>"><%- path_item[1] %></a> </li> ',"<% } else { %>",'<li class="active"><span title="You are in this folder"><%- path_item[1] %></span></li>',"<% } %>","<% }); %>","</ol>",'<table data-library-id="<%- parent_library_id  %>" class="grid table table-condensed">',"<thead>",'<th class="button_heading"></th>','<th style="text-align: center; width: 20px; " title="Check to select all datasets"><input id="select-all-checkboxes" style="margin: 0;" type="checkbox"></th>','<th><a class="sort-folder-name" title="Click to reverse order" href="#">name</a> <span title="Sorted alphabetically" class="sort-icon-name fa fa-sort-alpha-<%- order %>"></span></th>','<th style="width:20%;"><a class="sort-folder-description" title="Click to reverse order" href="#">description</a> <span title="Sorted alphabetically" class="sort-icon-description fa"></span></th>','<th style="width:5%;"><a class="sort-folder-file_ext" title="Click to reverse order" href="#">data type</a> <span title="Sorted alphabetically" class="sort-icon-file_ext fa"></span></th>','<th style="width:10%;">size</th>','<th style="width:160px;">time updated (UTC)</th>','<th style="width:5%;"><a class="sort-folder-state" title="Click to reverse order" href="#">state</a> <span title="Sorted alphabetically" class="sort-icon-state fa"></span></th>','<th style="width:150px;"></th> ',"</thead>",'<tbody id="folder_list_body">','<tr id="first_folder_item">',"<td>",'<a href="#<% if (upper_folder_id !== 0){ print("folders/" + upper_folder_id)} %>" title="Go to parent folder" class="btn_open_folder btn btn-default btn-xs">..<a>',"</td>","<td></td>","<td></td>","<td></td>","<td></td>","<td></td>","<td></td>","<td></td>","<td></td>","</tr>","</tbody>","</table>",'<div class="empty-folder-message" style="display:none;">',"This folder is either empty or you do not have proper access permissions to see the contents. If you expected something to show up",' please consult the <a href="https://galaxyproject.org/data-libraries/#permissions" target="_blank">library security wikipage</a>',' or visit the <a href="https://biostar.usegalaxy.org/" target="_blank">Galaxy support site</a>.',"</div>"].join(""))}});t.default={FolderListView:h}}).call(t,n(2),n(1),n(0))},function(e,t,n){"use strict";(function(e,i,r){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(7),s=a(o),l=n(18),c=a(l),d=n(138),u=a(d),h=e.View.extend({events:{"click .undelete_dataset_btn":"undeleteDataset","click .undelete_folder_btn":"undeleteFolder","click .edit_folder_btn":"startModifications","click .cancel_folder_btn":"cancelModifications","click .save_folder_btn":"saveModifications"},defaults:{type:null,visibility_config:{edit_folder_btn:!1,save_folder_btn:!1,cancel_folder_btn:!1,permission_folder_btn:!1},edit_mode:!1},initialize:function(e){this.options=i.defaults(e||{},this.defaults),this.render(this.options)},render:function(e){this.options=i.extend(this.options,e);var t=this.options.model,n=null;return"folder"===t.get("type")||"LibraryFolder"===t.get("model_class")?(this.options.type="folder",this.prepareButtons(t),n=t.get("deleted")?this.templateRowDeletedFolder():this.templateRowFolder()):"file"===t.get("type")||"LibraryDatasetDatasetAssociation"===t.get("model_class")||"LibraryDataset"===t.get("model_class")?(this.options.type="file",n=t.get("deleted")?this.templateRowDeletedFile():this.templateRowFile()):(Galaxy.emit.error("Unknown library item type found."),Galaxy.emit.error(t.get("type")||t.get("model_class"))),this.setElement(n({content_item:t,edit_mode:this.options.edit_mode,button_config:this.options.visibility_config})),this.$el.show(),this},prepareButtons:function(e){var t=this.options.visibility_config;!1===this.options.edit_mode?(t.save_folder_btn=!1,t.cancel_folder_btn=!1,!0===e.get("deleted")?(t.edit_folder_btn=!1,t.permission_folder_btn=!1):!1===e.get("deleted")&&(t.save_folder_btn=!1,t.cancel_folder_btn=!1,!0===e.get("can_modify")&&(t.edit_folder_btn=!0),!0===e.get("can_manage")&&(t.permission_folder_btn=!0))):!0===this.options.edit_mode&&(t.edit_folder_btn=!1,t.permission_folder_btn=!1,t.save_folder_btn=!0,t.cancel_folder_btn=!0),this.options.visibility_config=t},showDatasetDetails:function(){Galaxy.libraries.datasetView=new u.default.LibraryDatasetView({id:this.id})},undeleteDataset:function(e){r(".tooltip").hide();var t=this,n=r(e.target).closest("tr").data("id"),i=Galaxy.libraries.folderListView.collection.get(n);i.url=i.urlRoot+i.id+"?undelete=true",i.destroy({success:function(e,i){Galaxy.libraries.folderListView.collection.remove(n);var r=new c.default.Item(i);Galaxy.libraries.folderListView.collection.add(r),Galaxy.libraries.folderListView.collection.sortFolder("name","asc"),s.default.success("Dataset undeleted. Click this to see it.","",{onclick:function(){var e=t.model.get("folder_id");window.location=Galaxy.root+"library/list#folders/"+e+"/datasets/"+t.id}})},error:function(e,t){void 0!==t.responseJSON?s.default.error("Dataset was not undeleted. "+t.responseJSON.err_msg):s.default.error("An error occured! Dataset was not undeleted. Please try again.")}})},undeleteFolder:function(e){r(".tooltip").hide();var t=r(e.target).closest("tr").data("id"),n=Galaxy.libraries.folderListView.collection.get(t);n.url=n.urlRoot+n.id+"?undelete=true",n.destroy({success:function(e,n){Galaxy.libraries.folderListView.collection.remove(t);var i=new c.default.FolderAsModel(n);Galaxy.libraries.folderListView.collection.add(i),Galaxy.libraries.folderListView.collection.sortFolder("name","asc"),s.default.success("Folder undeleted.")},error:function(e,t){void 0!==t.responseJSON?s.default.error("Folder was not undeleted. "+t.responseJSON.err_msg):s.default.error("An error occured! Folder was not undeleted. Please try again.")}})},startModifications:function(){this.options.edit_mode=!0,this.repaint()},cancelModifications:function(){this.options.edit_mode=!1,this.repaint()},saveModifications:function(){var e=Galaxy.libraries.folderListView.collection.get(this.$el.data("id")),t=!1,n=this.$el.find(".input_folder_name").val();if(void 0!==n&&n!==e.get("name")){if(!(n.length>2))return void s.default.warning("Folder name has to be at least 3 characters long.");e.set("name",n),t=!0}var i=this.$el.find(".input_folder_description").val();if(void 0!==i&&i!==e.get("description")&&(e.set("description",i),t=!0),t){var r=this;e.save(null,{patch:!0,success:function(e){r.options.edit_mode=!1,r.repaint(e),s.default.success("Changes to folder saved.")},error:function(e,t){void 0!==t.responseJSON?s.default.error(t.responseJSON.err_msg):s.default.error("An error occured while attempting to update the folder.")}})}else this.options.edit_mode=!1,this.repaint(e),s.default.info("Nothing has changed.")},repaint:function(){r(".tooltip").hide();var e=this.$el;this.render(),e.replaceWith(this.$el),this.$el.find("[data-toggle]").tooltip()},templateRowFolder:function(){return i.template(['<tr class="folder_row light library-row" data-id="<%- content_item.id %>">',"<td>",'<span title="Folder" class="fa fa-folder-o"/>',"</td>",'<td style="text-align: center; "><input style="margin: 0;" type="checkbox"></td>',"<% if(!edit_mode) { %>","<td>",'<a href="#folders/<%- content_item.id %>"><%- content_item.get("name") %></a>',"</td>","<td>",'<%- content_item.get("description") %>',"</td>","<% } else if(edit_mode){ %>",'<td><textarea rows="4" class="form-control input_folder_name" placeholder="name" ><%- content_item.get("name") %></textarea></td>','<td><textarea rows="4" class="form-control input_folder_description" placeholder="description" ><%- content_item.get("description") %></textarea></td>',"<% } %>","<td>folder</td>","<td></td>","<td>",'<%= _.escape(content_item.get("update_time")) %>',"</td>","<td></td>","<td>","<% if(edit_mode) { %>",'<button data-toggle="tooltip" data-placement="top" title="Save changes" class="primary-button btn-xs save_folder_btn" type="button" style="<% if(button_config.save_folder_btn === false) { print("display:none;") } %>">','<span class="fa fa-floppy-o"/> Save',"</button>",'<button data-toggle="tooltip" data-placement="top" title="Discard changes" class="primary-button btn-xs cancel_folder_btn" type="button" style="<% if(button_config.cancel_folder_btn === false) { print("display:none;") } %>">','<span class="fa fa-times"/> Cancel',"</button>","<% } else if (!edit_mode){%>",'<button data-toggle="tooltip" data-placement="top" title="Modify \'<%- content_item.get("name") %>\'" class="primary-button btn-xs edit_folder_btn" type="button" style="<% if(button_config.edit_folder_btn === false) { print("display:none;") } %>">','<span class="fa fa-pencil"/> Edit',"</button>",'<a href="#/folders/<%- content_item.id %>/permissions">','<button data-toggle="tooltip" data-placement="top" class="primary-button btn-xs permission_folder_btn" title="Permissions of \'<%- content_item.get("name") %>\'" style="<% if(button_config.permission_folder_btn === false) { print("display:none;") } %>">','<span class="fa fa-group"/> Manage',"</button>","</a>","<% } %>","</td>","</tr>"].join(""))},templateRowFile:function(){return i.template(['<tr class="dataset_row light library-row" data-id="<%- content_item.id %>">',"<td>",'<span title="Dataset" class="fa fa-file-o"/>',"</td>",'<td style="text-align: center; ">','<input style="margin: 0;" type="checkbox">',"</td>","<td>",'<a href="#folders/<%- content_item.get("folder_id") %>/datasets/<%- content_item.id %>" class="library-dataset">','<%- content_item.get("name") %>',"<a>","</td>",'<td><%- content_item.get("message") %></td>','<td><%= _.escape(content_item.get("file_ext")) %></td>','<td><%= _.escape(content_item.get("file_size")) %></td>','<td><%= _.escape(content_item.get("update_time")) %></td>',"<td>",'<% if ( content_item.get("state") !== "ok" ) { %>','<%= _.escape(content_item.get("state")) %>',"<% } %>","</td>","<td>",'<% if (content_item.get("is_unrestricted")) { %>','<span data-toggle="tooltip" data-placement="top" title="Unrestricted dataset" style="color:grey;" class="fa fa-globe fa-lg"/>',"<% } %>",'<% if (content_item.get("is_private")) { %>','<span data-toggle="tooltip" data-placement="top" title="Private dataset" style="color:grey;" class="fa fa-key fa-lg"/>',"<% } %>",'<% if ((content_item.get("is_unrestricted") === false) && (content_item.get("is_private") === false)) { %>','<span data-toggle="tooltip" data-placement="top" title="Restricted dataset" style="color:grey;" class="fa fa-shield fa-lg"/>',"<% } %>",'<% if (content_item.get("can_manage")) { %>','<a href="#folders/<%- content_item.get("folder_id") %>/datasets/<%- content_item.id %>/permissions">','<button data-toggle="tooltip" data-placement="top" class="primary-button btn-xs permissions-dataset-btn" title="Permissions of \'<%- content_item.get("name") %>\'">','<span class="fa fa-group"/> Manage',"</button>","</a>","<% } %>","</td>","</tr>"].join(""))},templateRowDeletedFile:function(){return i.template(['<tr class="active deleted_dataset library-row" data-id="<%- content_item.id %>">',"<td>",'<span title="Dataset" class="fa fa-file-o"/>',"</td>","<td></td>",'<td style="color:grey;">','<%- content_item.get("name") %>',"</td>","<td>",'<%- content_item.get("message") %>',"</td>","<td>",'<%= _.escape(content_item.get("file_ext")) %>',"</td>","<td>",'<%= _.escape(content_item.get("file_size")) %>',"</td>","<td>",'<%= _.escape(content_item.get("update_time")) %>',"</td>","<td>",'<% if ( content_item.get("state") !== "ok" ) { %>','<%= _.escape(content_item.get("state")) %>',"<% } %>","</td>","<td>",'<span data-toggle="tooltip" data-placement="top" title="Marked deleted" style="color:grey;" class="fa fa-ban fa-lg"/>','<button data-toggle="tooltip" data-placement="top" title="Undelete \'<%- content_item.get("name") %>\'" class="primary-button btn-xs undelete_dataset_btn" type="button" style="margin-left:1em;">','<span class="fa fa-unlock"/> Undelete',"</button>","</td>","</tr>"].join(""))},templateRowDeletedFolder:function(){return i.template(['<tr class="active deleted_folder light library-row" data-id="<%- content_item.id %>">',"<td>",'<span title="Folder" class="fa fa-folder-o"/>',"</td>","<td></td>",'<td style="color:grey;">','<%- content_item.get("name") %>',"</td>","<td>",'<%- content_item.get("description") %>',"</td>","<td>","folder","</td>","<td></td>","<td>",'<%= _.escape(content_item.get("update_time")) %>',"</td>","<td></td>","<td>",'<span data-toggle="tooltip" data-placement="top" title="Marked deleted" style="color:grey;" class="fa fa-ban fa-lg"/>','<button data-toggle="tooltip" data-placement="top" title="Undelete \'<%- content_item.get("name") %>\'" class="primary-button btn-xs undelete_folder_btn" type="button" style="margin-left:1em;">','<span class="fa fa-unlock"/> Undelete',"</button>","</td>","</tr>"].join(""))}});t.default={FolderRowView:h}}).call(t,n(2),n(1),n(0))},function(e,t,n){"use strict";(function(e,i){function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var a=n(7),o=r(a),s=n(18),l=r(s),c=n(320),d=r(c),u=n(1),h=r(u),f=e.View.extend({el:"#libraries_element",events:{"click .sort-libraries-link":"sort_clicked"},defaults:{page_count:null,show_page:null,all_fetched:!1},initialize:function(e){this.options=h.default.defaults(this.options||{},e,this.defaults);var t=this;this.modal=null,this.collection=new l.default.Libraries,this.collection.url=this.collection.urlRoot+"?deleted=false",this.collection.fetch({success:function(){t.render()},error:function(e,t){void 0!==t.responseJSON?o.default.error(t.responseJSON.err_msg):o.default.error("An error occurred.")}})},render:function(e){this.options=h.default.extend(this.options,e),this.setElement("#libraries_element");var t=this.templateLibraryList(),n=null,r=null,a=function(e){return!0===e.get("public")};if(i(".tooltip").hide(),void 0!==e&&(r=void 0!==e.models?e.models:null),null!==this.collection&&null===r)this.sortLibraries(),n=Galaxy.libraries.preferences.get("with_deleted")?this.collection.models:this.collection.where({deleted:!1}),Galaxy.libraries.preferences.get("without_restricted")&&(n=h.default.filter(n,a));else if(null!==r){if(Galaxy.libraries.preferences.get("with_deleted"))n=r;else{var o=function(e){return!1===e.get("deleted")};n=h.default.filter(r,o)}Galaxy.libraries.preferences.get("without_restricted")&&(n=h.default.filter(n,a))}else n=[];(null===this.options.show_page||this.options.show_page<1)&&(this.options.show_page=1),this.options.total_libraries_count=n.length;var s=Galaxy.libraries.preferences.get("library_page_size")*(this.options.show_page-1);this.options.page_count=Math.ceil(this.options.total_libraries_count/Galaxy.libraries.preferences.get("library_page_size")),this.options.total_libraries_count>0&&s<this.options.total_libraries_count?(n=n.slice(s,s+Galaxy.libraries.preferences.get("library_page_size")),this.options.libraries_shown=n.length,Galaxy.libraries.preferences.get("library_page_size")*this.options.show_page>this.options.total_libraries_count+Galaxy.libraries.preferences.get("library_page_size")&&(n=[]),this.$el.html(t({length:1,order:Galaxy.libraries.preferences.get("sort_order"),search_term:Galaxy.libraries.libraryToolbarView.options.search_term})),Galaxy.libraries.libraryToolbarView.renderPaginator(this.options),this.renderRows(n)):(this.$el.html(t({length:0,order:Galaxy.libraries.preferences.get("sort_order"),search_term:Galaxy.libraries.libraryToolbarView.options.search_term})),Galaxy.libraries.libraryToolbarView.renderPaginator(this.options)),i("#center [data-toggle]").tooltip(),i("#center").css("overflow","auto")},fetchDeleted:function(){if(this.options.all_fetched)this.render();else{var e=this;this.collection.url=this.collection.urlRoot+"?deleted=true",this.collection.fetch({remove:!1,success:function(){e.options.all_fetched=!0,e.render()},error:function(e,t){void 0!==t.responseJSON?o.default.error(t.responseJSON.err_msg):o.default.error("An error occurred.")}})}},renderRows:function(e){for(var t=0;t<e.length;t++){var n=e[t];this.renderOne({library:n})}},renderOne:function(e){var t=e.library,n=new d.default.LibraryRowView(t);this.$el.find("#library_list_body").append(n.el)},sort_clicked:function(){"asc"===Galaxy.libraries.preferences.get("sort_order")?Galaxy.libraries.preferences.set({sort_order:"desc"}):Galaxy.libraries.preferences.set({sort_order:"asc"}),this.render()},sortLibraries:function(){"name"===Galaxy.libraries.preferences.get("sort_by")&&("asc"===Galaxy.libraries.preferences.get("sort_order")?this.collection.sortLibraries("name","asc"):"desc"===Galaxy.libraries.preferences.get("sort_order")&&this.collection.sortLibraries("name","desc"))},searchLibraries:function(e){if(""!==i.trim(e)){var t=null;t=this.collection.search(e),this.options.searching=!0,this.render({models:t,show_page:1})}else this.options.searching=!1,this.render()},templateLibraryList:function(){return h.default.template(['<div class="library_container table-responsive">',"<% if(length === 0) { %>","<% if(search_term.length > 0) { %>","<div>","There are no libraries matching your search. Try different keyword.","</div>","<% } else{ %>","<div>","There are no libraries visible to you here. If you expected some to show up please consult the",' <a href="https://galaxyproject.org/data-libraries/#permissions" target="_blank">library security wikipage</a>',' or visit the <a href="https://biostar.usegalaxy.org/" target="_blank">Galaxy support site</a>.',"</div>","<% }%>","<% } else{ %>",'<table class="grid table table-condensed">',"<thead>",'<th style="width:30%;">','<a class="sort-libraries-link" title="Click to reverse order" href="#">',"name","</a>",'<span title="Sorted alphabetically" class="fa fa-sort-alpha-<%- order %>"/>',"</th>",'<th style="width:22%;">description</th>','<th style="width:22%;">synopsis</th> ','<th style="width:26%;"></th>',"</thead>",'<tbody id="library_list_body">',"</tbody>","</table>","<% }%>","</div>"].join(""))}});t.default={LibraryListView:f}}).call(t,n(2),n(0))},function(e,t,n){"use strict";(function(e,i,r){Object.defineProperty(t,"__esModule",{value:!0});var a=n(7),o=function(e){return e&&e.__esModule?e:{default:e}}(a),s=e.View.extend({events:{"click .edit_library_btn":"edit_button_clicked","click .cancel_library_btn":"cancel_library_modification","click .save_library_btn":"save_library_modification","click .delete_library_btn":"delete_library","click .undelete_library_btn":"undelete_library"},edit_mode:!1,element_visibility_config:{upload_library_btn:!1,edit_library_btn:!1,permission_library_btn:!1,save_library_btn:!1,cancel_library_btn:!1,delete_library_btn:!1,undelete_library_btn:!1},initialize:function(e){this.render(e)},render:function(e){void 0===e&&(e=Galaxy.libraries.libraryListView.collection.get(this.$el.data("id"))),this.prepareButtons(e);var t=this.templateRow();return this.setElement(t({library:e,button_config:this.element_visibility_config,edit_mode:this.edit_mode})),this.$el.show(),this},repaint:function(e){i(".tooltip").hide();var t=this.$el;this.render(),t.replaceWith(this.$el),this.$el.find("[data-toggle]").tooltip()},prepareButtons:function(e){var t=this.element_visibility_config;!1===this.edit_mode?(t.save_library_btn=!1,t.cancel_library_btn=!1,t.delete_library_btn=!1,!0===e.get("deleted")?(t.undelete_library_btn=!0,t.upload_library_btn=!1,t.edit_library_btn=!1,t.permission_library_btn=!1):!1===e.get("deleted")&&(t.save_library_btn=!1,t.cancel_library_btn=!1,t.undelete_library_btn=!1,!0===e.get("can_user_add")&&(t.upload_library_btn=!0),!0===e.get("can_user_modify")&&(t.edit_library_btn=!0),!0===e.get("can_user_manage")&&(t.permission_library_btn=!0))):!0===this.edit_mode&&(t.upload_library_btn=!1,t.edit_library_btn=!1,t.permission_library_btn=!1,t.save_library_btn=!0,t.cancel_library_btn=!0,t.delete_library_btn=!0,t.undelete_library_btn=!1),this.element_visibility_config=t},edit_button_clicked:function(){this.edit_mode=!0,this.repaint()},cancel_library_modification:function(){this.edit_mode=!1,this.repaint()},save_library_modification:function(){var e=Galaxy.libraries.libraryListView.collection.get(this.$el.data("id")),t=!1,n=this.$el.find(".input_library_name").val();if(void 0!==n&&n!==e.get("name")){if(!(n.length>2))return void o.default.warning("Library name has to be at least 3 characters long.");e.set("name",n),t=!0}var i=this.$el.find(".input_library_description").val();void 0!==i&&i!==e.get("description")&&(e.set("description",i),t=!0);var r=this.$el.find(".input_library_synopsis").val();if(void 0!==r&&r!==e.get("synopsis")&&(e.set("synopsis",r),t=!0),t){var a=this;e.save(null,{patch:!0,success:function(e){a.edit_mode=!1,a.repaint(e),o.default.success("Changes to library saved.")},error:function(e,t){void 0!==t.responseJSON?o.default.error(t.responseJSON.err_msg):o.default.error("An error occured while attempting to update the library.")}})}else this.edit_mode=!1,this.repaint(e),o.default.info("Nothing has changed.")},delete_library:function(){var e=Galaxy.libraries.libraryListView.collection.get(this.$el.data("id")),t=this;e.destroy({success:function(e){e.set("deleted",!0),Galaxy.libraries.libraryListView.collection.add(e),t.edit_mode=!1,!1===Galaxy.libraries.preferences.get("with_deleted")?(i(".tooltip").hide(),t.repaint(e),t.$el.remove()):!0===Galaxy.libraries.preferences.get("with_deleted")&&t.repaint(e),o.default.success("Library has been marked deleted.")},error:function(e,t){void 0!==t.responseJSON?o.default.error(t.responseJSON.err_msg):o.default.error("An error occured during deleting the library.")}})},undelete_library:function(){var e=Galaxy.libraries.libraryListView.collection.get(this.$el.data("id")),t=this;e.url=e.urlRoot+e.id+"?undelete=true",e.destroy({success:function(e){e.set("deleted",!1),Galaxy.libraries.libraryListView.collection.add(e),t.edit_mode=!1,t.repaint(e),o.default.success("Library has been undeleted.")},error:function(e,t){void 0!==t.responseJSON?o.default.error(t.responseJSON.err_msg):o.default.error("An error occured while undeleting the library.")}})},templateRow:function(){return r.template(['<tr class="<% if(library.get("deleted") === true) { print("active") } %>" style="display:none;" data-id="<%- library.get("id") %>">',"<% if(!edit_mode) { %>",'<% if(library.get("deleted")) { %>','<td style="color:grey;"><%- library.get("name") %></td>',"<% } else { %>",'<td><a href="#folders/<%- library.get("root_folder_id") %>"><%- library.get("name") %></a></td>',"<% } %>",'<% if(library.get("description")) { %>','<% if( (library.get("description")).length> 80 ) { %>','<td data-toggle="tooltip" data-placement="bottom" title="<%= _.escape(library.get("description")) %>"><%= _.escape(library.get("description")).substring(0, 80) + "..." %></td>',"<% } else { %>",'<td><%= _.escape(library.get("description"))%></td>',"<% } %>","<% } else { %>","<td></td>","<% } %>",'<% if(library.get("synopsis")) { %>','<% if( (library.get("synopsis")).length> 120 ) { %>','<td data-toggle="tooltip" data-placement="bottom" title="<%= _.escape(library.get("synopsis")) %>"><%= _.escape(library.get("synopsis")).substring(0, 120) + "..." %></td>',"<% } else { %>",'<td><%= _.escape(library.get("synopsis"))%></td>',"<% } %>","<% } else { %>","<td></td>","<% } %>","<% } else if(edit_mode){ %>",'<td><textarea rows="4" class="form-control input_library_name" placeholder="name" ><%- library.get("name") %></textarea></td>','<td><textarea rows="4" class="form-control input_library_description" placeholder="description" ><%- library.get("description") %></textarea></td>','<td><textarea rows="4" class="form-control input_library_synopsis" placeholder="synopsis" ><%- library.get("synopsis") %></textarea></td>',"<% } %>",'<td class="right-center">','<% if( (library.get("public")) && (library.get("deleted") === false) ) { %>','<span data-toggle="tooltip" data-placement="top" title="Unrestricted library" style="color:grey;" class="fa fa-globe fa-lg"> </span>',"<% }%>",'<button data-toggle="tooltip" data-placement="top" title="Modify \'<%- library.get("name") %>\'" class="primary-button btn-xs edit_library_btn" type="button" style="<% if(button_config.edit_library_btn === false) { print("display:none;") } %>"><span class="fa fa-pencil"></span> Edit</button>','<a href="#library/<%- library.get("id") %>/permissions"><button data-toggle="tooltip" data-placement="top" title="Permissions of \'<%- library.get("name") %>\'" class="primary-button btn-xs permission_library_btn" type="button" style="<% if(button_config.permission_library_btn === false) { print("display:none;") } %>"><span class="fa fa-group"></span> Manage</button></a>','<button data-toggle="tooltip" data-placement="top" title="Save changes" class="primary-button btn-xs save_library_btn" type="button" style="<% if(button_config.save_library_btn === false) { print("display:none;") } %>"><span class="fa fa-floppy-o"></span> Save</button>','<button data-toggle="tooltip" data-placement="top" title="Discard changes" class="primary-button btn-xs cancel_library_btn" type="button" style="<% if(button_config.cancel_library_btn === false) { print("display:none;") } %>"><span class="fa fa-times"></span> Cancel</button>','<button data-toggle="tooltip" data-placement="top" title="Delete \'<%- library.get("name") %>\'" class="primary-button btn-xs delete_library_btn" type="button" style="<% if(button_config.delete_library_btn === false) { print("display:none;") } %>"><span class="fa fa-trash-o"></span> Delete</button>','<span data-toggle="tooltip" data-placement="top" title="Marked deleted" style="color:grey; <% if(button_config.undelete_library_btn === false) { print("display:none;") } %>" class="fa fa-ban fa-lg"></span>','<button data-toggle="tooltip" data-placement="top" title="Undelete \'<%- library.get("name") %>\' " class="primary-button btn-xs undelete_library_btn" type="button" style="<% if(button_config.undelete_library_btn === false) { print("display:none;") } %>"><span class="fa fa-unlock"></span> Undelete</button>',"</td>","</tr>"].join(""))}});t.default={LibraryRowView:s}}).call(t,n(2),n(0),n(1))},function(e,t,n){"use strict";(function(e,i,r){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(3),s=a(o),l=n(7),c=a(l),d=n(18),u=a(d),h=e.View.extend({el:"#center",defaults:{search_term:""},events:{"click #create_new_library_btn":"createLibraryFromModal","click #include_deleted_chk":"includeDeletedChecked","click #exclude_restricted_chk":"excludeRestrictedChecked","click .page_size_prompt":"showPageSizePrompt","keyup .library-search-input":"searchLibraries"},initialize:function(e){this.options=i.defaults(this.options||{},e,this.defaults),this.render()},render:function(){var e=this.templateToolBar(),t=!1,n=!0;Galaxy.user&&(t=Galaxy.user.isAdmin(),n=Galaxy.user.isAnonymous()),this.$el.html(e({admin_user:t,anon_user:n})),t&&(this.$el.find("#include_deleted_chk")[0].checked=Galaxy.libraries.preferences.get("with_deleted"),this.$el.find("#exclude_restricted_chk")[0].checked=Galaxy.libraries.preferences.get("without_restricted"))},renderPaginator:function(e){this.options=i.extend(this.options,e);var t=this.templatePaginator();this.$el.find("#library_paginator").html(t({show_page:parseInt(this.options.show_page),page_count:parseInt(this.options.page_count),total_libraries_count:this.options.total_libraries_count,libraries_shown:this.options.libraries_shown,library_page_size:Galaxy.libraries.preferences.get("library_page_size")}))},createLibraryFromModal:function(e){e.preventDefault(),e.stopPropagation();var t=this;this.modal=Galaxy.modal,this.modal.show({closing_events:!0,title:(0,s.default)("Create New Library"),body:this.templateNewLibraryInModal(),buttons:{Create:function(){t.createNewLibrary()},Close:function(){t.modal.hide()}}})},createNewLibrary:function(){var e=this.serializeNewLibrary();if(this.validateNewLibrary(e)){var t=new u.default.Library,n=this;t.save(e,{success:function(e){Galaxy.libraries.libraryListView.collection.add(e),n.modal.hide(),n.clearLibraryModal(),Galaxy.libraries.libraryListView.render(),c.default.success("Library created.")},error:function(e,t){void 0!==t.responseJSON?c.default.error(t.responseJSON.err_msg):c.default.error("An error occured.")}})}else c.default.error("Library's name is missing.");return!1},showPageSizePrompt:function(e){e.preventDefault();var t=prompt("How many libraries per page do you want to see?",Galaxy.libraries.preferences.get("library_page_size"));null!=t&&t==parseInt(t)&&(Galaxy.libraries.preferences.set({library_page_size:parseInt(t)}),Galaxy.libraries.libraryListView.render({show_page:1}))},clearLibraryModal:function(){r("input[name='Name']").val(""),r("input[name='Description']").val(""),r("input[name='Synopsis']").val("")},serializeNewLibrary:function(){return{name:r("input[name='Name']").val(),description:r("input[name='Description']").val(),synopsis:r("input[name='Synopsis']").val()}},validateNewLibrary:function(e){return""!==e.name},includeDeletedChecked:function(e){e.target.checked?(Galaxy.libraries.preferences.set({with_deleted:!0}),Galaxy.libraries.libraryListView.fetchDeleted()):(Galaxy.libraries.preferences.set({with_deleted:!1}),Galaxy.libraries.libraryListView.render())},excludeRestrictedChecked:function(e){e.target.checked?Galaxy.libraries.preferences.set({without_restricted:!0}):Galaxy.libraries.preferences.set({without_restricted:!1}),Galaxy.libraries.libraryListView.render()},searchLibraries:function(e){var t=r(".library-search-input").val();this.options.search_term=t,Galaxy.libraries.libraryListView.searchLibraries(t)},templateToolBar:function(){return i.template(['<div class="library_style_container">','<div id="toolbar_form">','<div id="library_toolbar">','<form class="form-inline" role="form">','<span><strong><a href="#" title="Go to first page">DATA LIBRARIES</a></strong></span>','<span id="library_paginator" class="library-paginator">',"</span>",'<div class="form-group toolbar-item">','<input type="text" class="form-control library-search-input" placeholder="Search" size="30">',"</div>","<% if(admin_user === true) { %>",'<div class="checkbox toolbar-item" style="height: 20px;">',"<label>",'<input id="include_deleted_chk" type="checkbox">',"include deleted ","</input>","</label>","<label>",'<input id="exclude_restricted_chk" type="checkbox">',"exclude restricted","</input>","</label>","</div>",'<span class="toolbar-item" data-toggle="tooltip" data-placement="top" title="Create New Library">','<button id="create_new_library_btn" class="primary-button btn-xs" type="button"><span class="fa fa-plus"></span> New Library</button>',"</span>","<% } %>",'<span class="help-button" data-toggle="tooltip" data-placement="top" title="See this screen annotated">','<a href="https://galaxyproject.org/data-libraries/screen/list-of-libraries/" target="_blank">','<button class="primary-button" type="button"><span class="fa fa-question-circle"></span> Help</button>',"</a>","</span>","</form>","</div>","</div>",'<div id="libraries_element">',"</div>","</div>"].join(""))},templatePaginator:function(){return i.template(['<ul class="pagination pagination-sm">',"<% if ( ( show_page - 1 ) > 0 ) { %>","<% if ( ( show_page - 1 ) > page_count ) { %>",'<li><a href="#page/1"><span class="fa fa-angle-double-left"></span></a></li>','<li class="disabled"><a href="#page/<% print( show_page ) %>"><% print( show_page - 1 ) %></a></li>',"<% } else { %>",'<li><a href="#page/1"><span class="fa fa-angle-double-left"></span></a></li>','<li><a href="#page/<% print( show_page - 1 ) %>"><% print( show_page - 1 ) %></a></li>',"<% } %>","<% } else { %>",'<li class="disabled"><a href="#page/1"><span class="fa fa-angle-double-left"></span></a></li>','<li class="disabled"><a href="#page/<% print( show_page ) %>"><% print( show_page - 1 ) %></a></li>',"<% } %>",'<li class="active">','<a href="#page/<% print( show_page ) %>"><% print( show_page ) %></a>',"</li>","<% if ( ( show_page ) < page_count ) { %>",'<li><a href="#page/<% print( show_page + 1 ) %>"><% print( show_page + 1 ) %></a></li>','<li><a href="#page/<% print( page_count ) %>"><span class="fa fa-angle-double-right"></span></a></li>',"<% } else { %>",'<li class="disabled"><a href="#page/<% print( show_page  ) %>"><% print( show_page + 1 ) %></a></li>','<li class="disabled"><a href="#page/<% print( page_count ) %>"><span class="fa fa-angle-double-right"></span></a></li>',"<% } %>","</ul>","<span>",' <%- libraries_shown %> libraries shown <a href="" data-toggle="tooltip" data-placement="top" title="currently <%- library_page_size %> per page" class="page_size_prompt">(change)</a>',"</span>","<span>"," <%- total_libraries_count %> total","</span>"].join(""))},templateNewLibraryInModal:function(){return i.template(['<div id="new_library_modal">',"<form>",'<input type="text" name="Name" value="" placeholder="Name" autofocus>','<input type="text" name="Description" value="" placeholder="Description">','<input type="text" name="Synopsis" value="" placeholder="Synopsis">',"</form>","</div>"].join(""))}});t.default={LibraryToolbarView:h}}).call(t,n(2),n(1),n(0))},function(e,t,n){"use strict";(function(e,i,r,a){function o(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var s=n(3),l=o(s),c=n(5),d=o(c),u=n(7),h=o(u),f=n(18),p=o(f),g=n(12),m=o(g),_=n(29),v=o(_),y=n(74),b=o(y),w=n(75),x=o(w),k=n(20),M=o(k);n(139);var C=e.View.extend({el:"#center",events:{"click .toolbtn-create-folder":"createFolderFromModal","click .toolbtn-bulk-import":"importToHistoryModal","click .include-deleted-datasets-chk":"checkIncludeDeleted","click .toolbtn-bulk-delete":"deleteSelectedItems","click .toolbtn-show-locinfo":"showLocInfo","click .page-size-prompt":"showPageSizePrompt","click .toolbtn-collection-import":"showCollectionSelect"},defaults:{can_add_library_item:!1,contains_file_or_folder:!1,chain_call_control:{total_number:0,failed_number:0},disabled_jstree_element:"folders"},modal:null,jstree:null,histories:null,select_genome:null,select_extension:null,list_extensions:[],auto:{id:"auto",text:"Auto-detect",description:"This system will try to detect the file type automatically. If your file is not detected properly as one of the known formats, it most likely means that it has some format problems (e.g., different number of columns on different rows). You can still coerce the system to set your data to the format you think it should be. You can also upload compressed files, which will automatically be decompressed."},list_genomes:[],initialize:function(e){this.options=i.defaults(e||{},this.defaults),this.fetchExtAndGenomes(),this.render()},render:function(e){this.options=i.extend(this.options,e);var t=this.templateToolBar(),n={id:this.options.id,is_admin:!1,is_anonym:!0,multiple_add_dataset_options:!1};Galaxy.user&&(n.is_admin=Galaxy.user.isAdmin(),n.is_anonym=Galaxy.user.isAnonymous(),null===Galaxy.config.user_library_import_dir&&!1===Galaxy.config.allow_library_path_paste&&null===Galaxy.config.library_import_dir||(n.multiple_add_dataset_options=!0)),this.$el.html(t(n))},renderPaginator:function(e){this.options=i.extend(this.options,e);var t=this.templatePaginator();r("body").find(".folder-paginator").html(t({id:this.options.id,show_page:parseInt(this.options.show_page),page_count:parseInt(this.options.page_count),total_items_count:this.options.total_items_count,items_shown:this.options.items_shown,folder_page_size:Galaxy.libraries.preferences.get("folder_page_size")}))},configureElements:function(e){this.options=i.extend(this.options,e),!0===this.options.can_add_library_item?r(".add-library-items").show():r(".add-library-items").hide(),!0===this.options.contains_file_or_folder&&Galaxy.user?Galaxy.user.isAnonymous()?(r(".dataset-manipulation").show(),r(".logged-dataset-manipulation").hide()):(r(".logged-dataset-manipulation").show(),r(".dataset-manipulation").show()):(r(".logged-dataset-manipulation").hide(),r(".dataset-manipulation").hide()),this.$el.find("[data-toggle]").tooltip()},createFolderFromModal:function(e){var t=this;e.preventDefault(),e.stopPropagation();var n=this.templateNewFolderInModal();this.modal=Galaxy.modal,this.modal.show({closing_events:!0,title:(0,l.default)("Create New Folder"),body:n(),buttons:{Create:function(){t.createNewFolderEvent()},Close:function(){Galaxy.modal.hide()}}})},createNewFolderEvent:function(){var t=this.serializeNewFolder();if(this.validateNewFolder(t)){var n,i=new p.default.FolderAsModel,r=e.history.fragment.split("/");n=r.indexOf("page")>-1?r[r.length-3]:r[r.length-1],i.url=i.urlRoot+n,i.save(t,{success:function(e){Galaxy.modal.hide(),h.default.success("Folder created."),e.set({type:"folder"}),Galaxy.libraries.folderListView.collection.add(e)},error:function(e,t){Galaxy.modal.hide(),void 0!==t.responseJSON?h.default.error(t.responseJSON.err_msg):h.default.error("An error occurred.")}})}else h.default.error("Folder's name is missing.");return!1},serializeNewFolder:function(){return{name:r("input[name='Name']").val(),description:r("input[name='Description']").val()}},validateNewFolder:function(e){return""!==e.name},importToHistoryModal:function(e){var t=this;e.preventDefault();var n=this.findCheckedRows(),i=this.templateImportIntoHistoryModal();if(0===n.length)h.default.info("You must select some datasets first.");else{this.fetchUserHistories().done(function(){t.modal=Galaxy.modal,t.modal.show({closing_events:!0,title:(0,l.default)("Import into History"),body:i({histories:t.histories.models}),buttons:{Import:function(){t.importAllIntoHistory()},Close:function(){Galaxy.modal.hide()}}})}).fail(function(e,t){void 0!==t.responseJSON?h.default.error(t.responseJSON.err_msg):h.default.error("An error occurred.")})}},fetchUserHistories:function(){return this.histories=new p.default.GalaxyHistories,this.histories.fetch()},importAllIntoHistory:function(){var e=this;this.modal.disableButton("Import");var t=this.modal.$("input[name=history_name]").val();if(""!==t)this.createNewHistory(t).done(function(t){e.processImportToHistory(t.id,t.name)}).fail(function(e,t,n){h.default.error("An error occurred.")}).always(function(){e.modal.enableButton("Import")});else{var n=r("select[name=import_to_history] option:selected").val(),i=r("select[name=import_to_history] option:selected").text();this.processImportToHistory(n,i),this.modal.enableButton("Import")}},createNewHistory:function(e){return r.post(Galaxy.root+"api/histories",{name:e})},processImportToHistory:function(e,t){for(var n=this.findCheckedItems(),i=[],r=n.dataset_ids.length-1;r>=0;r--){var o=n.dataset_ids[r],s=new p.default.HistoryItem;s.url=s.urlRoot+e+"/contents",s.content=o,s.source="library",i.push(s)}for(var l=n.folder_ids.length-1;l>=0;l--){var c=n.folder_ids[l],s=new p.default.HistoryItem;s.url=s.urlRoot+e+"/contents",s.content=c,s.source="library_folder",i.push(s)}this.initChainCallControl({length:i.length,action:"to_history",history_name:t}),a.getJSON(Galaxy.root+"history/set_as_current?id="+e),this.chainCallImportingIntoHistory(i,t)},updateProgress:function(){this.progress+=this.progressStep,r(".progress-bar-import").width(Math.round(this.progress)+"%");var e=Math.round(this.progress)+"% Complete";r(".completion_span").text(e)},download:function(e){var t=this.findCheckedItems(),n=Galaxy.root+"api/libraries/datasets/download/"+e,i={ld_ids:t.dataset_ids,folder_ids:t.folder_ids};this.processDownload(n,i,"get")},processDownload:function(e,t,n){if(e&&t){t="string"==typeof t?t:r.param(t);var i="";r.each(t.split("&"),function(){var e=this.split("=");i+='<input type="hidden" name="'+e[0]+'" value="'+e[1]+'" />'}),r('<form action="'+e+'" method="'+(n||"post")+'">'+i+"</form>").appendTo("body").submit().remove(),h.default.info("Your download will begin soon.")}else h.default.error("An error occurred.")},addFilesFromHistoryModal:function(){var e=this;this.histories=new p.default.GalaxyHistories,this.histories.fetch().done(function(){e.modal=Galaxy.modal;var t=e.templateAddFilesFromHistory();e.modal.show({closing_events:!0,title:(0,l.default)("Adding datasets from your history"),body:t({histories:e.histories.models}),buttons:{Add:function(){e.addAllDatasetsFromHistory()},Close:function(){Galaxy.modal.hide()}},closing_callback:function(){Galaxy.libraries.library_router.navigate("folders/"+e.id,{trigger:!0})}}),e.fetchAndDisplayHistoryContents(e.histories.models[0].id),r("#dataset_add_bulk").change(function(t){e.fetchAndDisplayHistoryContents(t.target.value)})}).fail(function(e,t){void 0!==t.responseJSON?h.default.error(t.responseJSON.err_msg):h.default.error("An error occurred.")})},importFilesFromPathModal:function(){var e=this;this.modal=Galaxy.modal;var t=this.templateImportPathModal();this.modal.show({closing_events:!0,title:(0,l.default)("Please enter paths to import"),body:t({}),buttons:{Import:function(){e.importFromPathsClicked(e)},Close:function(){Galaxy.modal.hide()}},closing_callback:function(){Galaxy.libraries.library_router.navigate("folders/"+e.id,{trigger:!0})}}),this.renderSelectBoxes()},fetchExtAndGenomes:function(){var e=this;d.default.get({url:Galaxy.root+"api/datatypes?extension_only=False",success:function(t){e.list_extensions=[];for(var n in t)e.list_extensions.push({id:t[n].extension,text:t[n].extension,description:t[n].description,description_url:t[n].description_url});e.list_extensions.sort(function(e,t){return e.id>t.id?1:e.id<t.id?-1:0}),e.list_extensions.unshift(e.auto)},cache:!0}),d.default.get({url:Galaxy.root+"api/genomes",success:function(t){e.list_genomes=[];for(var n in t)e.list_genomes.push({id:t[n][1],text:t[n][0]});e.list_genomes.sort(function(e,t){return e.id>t.id?1:e.id<t.id?-1:0})},cache:!0})},renderSelectBoxes:function(){this.select_genome=new m.default.View({css:"library-genome-select",data:this.list_genomes,container:Galaxy.modal.$el.find("#library_genome_select"),value:"?"}),this.select_extension=new m.default.View({css:"library-extension-select",data:this.list_extensions,container:Galaxy.modal.$el.find("#library_extension_select"),value:"auto"})},importFilesFromGalaxyFolderModal:function(e){var t=this,n=this.templateBrowserModal();this.modal=Galaxy.modal,this.modal.show({closing_events:!0,title:(0,l.default)("Please select folders or files"),body:n({}),buttons:{Import:function(){t.importFromJstreePath(t,e)},Close:function(){Galaxy.modal.hide()}},closing_callback:function(){Galaxy.libraries.library_router.navigate("folders/"+t.id,{trigger:!0})}}),r(".libimport-select-all").bind("click",function(){r("#jstree_browser").jstree("check_all")}),r(".libimport-select-none").bind("click",function(){r("#jstree_browser").jstree("uncheck_all")}),this.renderSelectBoxes(),e.disabled_jstree_element="folders",this.renderJstree(e),r("input[type=radio]").change(function(n){"jstree-disable-folders"===n.target.value?(e.disabled_jstree_element="folders",t.renderJstree(e),r(".jstree-folders-message").hide(),r(".jstree-preserve-structure").hide(),r(".jstree-files-message").show()):"jstree-disable-files"===n.target.value&&(r(".jstree-files-message").hide(),r(".jstree-folders-message").show(),r(".jstree-preserve-structure").show(),e.disabled_jstree_element="files",t.renderJstree(e))})},renderJstree:function(e){this.options=i.extend(this.options,e);var t=e.source||"userdir",n=this.options.disabled_jstree_element;this.jstree=new p.default.Jstree,this.jstree.url=this.jstree.urlRoot+"?target="+t+"&format=jstree&disable="+n,this.jstree.fetch({success:function(e,t){r("#jstree_browser").jstree("destroy"),r("#jstree_browser").jstree({core:{data:e},plugins:["types","checkbox"],types:{folder:{icon:"jstree-folder"},file:{icon:"jstree-file"}},checkbox:{three_state:!1}})},error:function(e,t){void 0!==t.responseJSON?404001===t.responseJSON.err_code?h.default.warning(t.responseJSON.err_msg):h.default.error(t.responseJSON.err_msg):h.default.error("An error occurred.")}})},importFromPathsClicked:function(){var e=this.modal.$el.find(".preserve-checkbox").is(":checked"),t=this.modal.$el.find(".link-checkbox").is(":checked"),n=this.modal.$el.find(".spacetab-checkbox").is(":checked"),i=this.modal.$el.find(".posix-checkbox").is(":checked"),a=this.modal.$el.find(".tag-files").is(":checked"),o=this.select_extension.value(),s=this.select_genome.value(),l=r("textarea#import_paths").val(),c=[];if(l){this.modal.disableButton("Import"),l=l.split("\n");for(var d=l.length-1;d>=0;d--){var u=l[d].trim();0!==u.length&&c.push(u)}this.initChainCallControl({length:c.length,action:"adding_datasets"}),this.chainCallImportingFolders({paths:c,preserve_dirs:e,link_data:t,space_to_tab:n,to_posix_lines:i,source:"admin_path",file_type:o,tag_using_filenames:a,dbkey:s})}else h.default.info("Please enter a path relative to Galaxy root.")},initChainCallControl:function(e){var t;switch(e.action){case"adding_datasets":t=this.templateAddingDatasetsProgressBar(),this.modal.$el.find(".modal-body").html(t({folder_name:this.options.folder_name}));break;case"deleting_datasets":t=this.templateDeletingItemsProgressBar(),this.modal.$el.find(".modal-body").html(t());break;case"to_history":t=this.templateImportIntoHistoryProgressBar(),this.modal.$el.find(".modal-body").html(t({history_name:e.history_name}));break;default:Galaxy.emit.error("Wrong action specified.","datalibs")}this.progress=0,this.progressStep=100/e.length,this.options.chain_call_control.total_number=e.length,this.options.chain_call_control.failed_number=0},importFromJstreePath:function(e,t){var n=r("#jstree_browser").jstree().get_selected(!0),a=i.filter(n,function(e){return 0==e.state.disabled}),o=this.modal.$el.find(".preserve-checkbox").is(":checked"),s=this.modal.$el.find(".link-checkbox").is(":checked"),l=this.modal.$el.find(".spacetab-checkbox").is(":checked"),c=this.modal.$el.find(".posix-checkbox").is(":checked"),d=this.select_extension.value(),u=this.select_genome.value(),f=this.modal.$el.find(".tag-files").is(":checked"),p=a[0].type,g=[];if(a.length<1)h.default.info("Please select some items first.");else{this.modal.disableButton("Import");for(var m=a.length-1;m>=0;m--)void 0!==a[m].li_attr.full_path&&g.push(a[m].li_attr.full_path);if(this.initChainCallControl({length:g.length,action:"adding_datasets"}),"folder"===p){var _=t.source+"_folder";this.chainCallImportingFolders({paths:g,preserve_dirs:o,link_data:s,space_to_tab:l,to_posix_lines:c,source:_,file_type:d,dbkey:u,tag_using_filenames:f})}else if("file"===p){var _=t.source+"_file";this.chainCallImportingUserdirFiles({paths:g,file_type:d,dbkey:u,link_data:s,space_to_tab:l,to_posix_lines:c,source:_,tag_using_filenames:f})}}},fetchAndDisplayHistoryContents:function(e){var t=this;new p.default.HistoryContents({id:e}).fetch({success:function(n){var i=t.templateHistoryContents();t.histories.get(e).set({contents:n}),t.modal.$el.find(".library_selected_history_content").html(i({history_contents:n.models.reverse()})),t.modal.$el.find(".history-import-select-all").bind("click",function(){r(".library_selected_history_content [type=checkbox]").prop("checked",!0)}),t.modal.$el.find(".history-import-unselect-all").bind("click",function(){r(".library_selected_history_content [type=checkbox]").prop("checked",!1)})},error:function(e,t){void 0!==t.responseJSON?h.default.error(t.responseJSON.err_msg):h.default.error("An error occurred.")}})},addAllDatasetsFromHistory:function(){var e=this.modal.$el.find(".library_selected_history_content").find(":checked"),t=[],n=[],i=[];if(e.length<1)h.default.info("You must select some datasets first.");else{this.modal.disableButton("Add"),e.each(function(){var e=r(this).closest("li").data("id");if(e){var i=r(this).closest("li").data("name");t.push(e),n.push(i)}});for(var a=t.length-1;a>=0;a--){var o=t[a],s=new p.default.Item;s.url=Galaxy.root+"api/folders/"+this.options.id+"/contents","collection"===n[a]?s.set({from_hdca_id:o}):s.set({from_hda_id:o}),i.push(s)}this.initChainCallControl({length:i.length,action:"adding_datasets"}),this.chainCallAddingHdas(i)}},chainCallImportingIntoHistory:function(e,t){var n=this,i=e.pop();if(void 0===i)return 0===this.options.chain_call_control.failed_number?h.default.success("Selected datasets imported into history. Click this to start analyzing it.","",{onclick:function(){window.location=Galaxy.root}}):this.options.chain_call_control.failed_number===this.options.chain_call_control.total_number?h.default.error("There was an error and no datasets were imported into history."):this.options.chain_call_control.failed_number<this.options.chain_call_control.total_number&&h.default.warning("Some of the datasets could not be imported into history. Click this to see what was imported.","",{onclick:function(){window.location=Galaxy.root}}),Galaxy.modal.hide(),!0;r.when(i.save({content:i.content,source:i.source})).done(function(){n.updateProgress(),n.chainCallImportingIntoHistory(e,t)}).fail(function(){n.options.chain_call_control.failed_number+=1,n.updateProgress(),n.chainCallImportingIntoHistory(e,t)})},chainCallImportingUserdirFiles:function(e){var t=this,n=e.paths.pop();if(void 0===n)return 0===this.options.chain_call_control.failed_number?(h.default.success("Selected files imported into the current folder"),Galaxy.modal.hide()):h.default.error("An error occured."),!0;r.when(r.post(Galaxy.root+"api/libraries/datasets?encoded_folder_id="+this.id+"&source="+e.source+"&path="+n+"&file_type="+e.file_type+"&link_data="+e.link_data+"&space_to_tab="+e.space_to_tab+"&to_posix_lines="+e.to_posix_lines+"&dbkey="+e.dbkey+"&tag_using_filenames="+e.tag_using_filenames)).done(function(n){t.updateProgress(),t.chainCallImportingUserdirFiles(e)}).fail(function(){t.options.chain_call_control.failed_number+=1,t.updateProgress(),t.chainCallImportingUserdirFiles(e)})},chainCallImportingFolders:function(e){var t=this,n=e.paths.pop();if(void 0===n)return 0===this.options.chain_call_control.failed_number?(h.default.success("Selected folders and their contents imported into the current folder."),Galaxy.modal.hide()):h.default.error("An error occured."),!0;r.when(r.post(Galaxy.root+"api/libraries/datasets?encoded_folder_id="+this.id+"&source="+e.source+"&path="+n+"&preserve_dirs="+e.preserve_dirs+"&link_data="+e.link_data+"&to_posix_lines="+e.to_posix_lines+"&space_to_tab="+e.space_to_tab+"&file_type="+e.file_type+"&dbkey="+e.dbkey+"&tag_using_filenames="+e.tag_using_filenames)).done(function(n){t.updateProgress(),t.chainCallImportingFolders(e)}).fail(function(){t.options.chain_call_control.failed_number+=1,t.updateProgress(),t.chainCallImportingFolders(e)})},chainCallAddingHdas:function(e){var t=this;this.added_hdas=new p.default.Folder;var n=e.pop();if(void 0===n)return 0===this.options.chain_call_control.failed_number?h.default.success("Selected datasets from history added to the folder"):this.options.chain_call_control.failed_number===this.options.chain_call_control.total_number?h.default.error("There was an error and no datasets were added to the folder."):this.options.chain_call_control.failed_number<this.options.chain_call_control.total_number&&h.default.warning("Some of the datasets could not be added to the folder"),Galaxy.modal.hide(),this.added_hdas;r.when(n.save({from_hda_id:n.get("from_hda_id")})).done(function(n){Galaxy.libraries.folderListView.collection.add(n),t.updateProgress(),t.chainCallAddingHdas(e)}).fail(function(){t.options.chain_call_control.failed_number+=1,t.updateProgress(),t.chainCallAddingHdas(e)})},chainCallDeletingItems:function(e){var t=this;this.deleted_items=new p.default.Folder;var n=e.pop();if(void 0===n)return 0===this.options.chain_call_control.failed_number?h.default.success("Selected items were deleted."):this.options.chain_call_control.failed_number===this.options.chain_call_control.total_number?h.default.error("There was an error and no items were deleted. Please make sure you have sufficient permissions."):this.options.chain_call_control.failed_number<this.options.chain_call_control.total_number&&h.default.warning("Some of the items could not be deleted. Please make sure you have sufficient permissions."),Galaxy.modal.hide(),this.deleted_items;n.destroy().done(function(i){if(Galaxy.libraries.folderListView.collection.remove(n.id),t.updateProgress(),Galaxy.libraries.folderListView.options.include_deleted){var r=null;"folder"===i.type||"LibraryFolder"===i.model_class?r=new p.default.FolderAsModel(i):"file"===i.type||"LibraryDataset"===i.model_class?r=new p.default.Item(i):(Galaxy.emit.error("Unknown library item type found.","datalibs"),Galaxy.emit.error(i.type||i.model_class,"datalibs")),Galaxy.libraries.folderListView.collection.add(r)}t.chainCallDeletingItems(e)}).fail(function(){t.options.chain_call_control.failed_number+=1,t.updateProgress(),t.chainCallDeletingItems(e)})},checkIncludeDeleted:function(e){e.target.checked?Galaxy.libraries.folderListView.fetchFolder({include_deleted:!0}):Galaxy.libraries.folderListView.fetchFolder({include_deleted:!1})},deleteSelectedItems:function(){var e=[],t=[],n=this.findCheckedRows();if(0===n.length)h.default.info("You must select at least one item for deletion.");else{var i=this.templateDeletingItemsProgressBar();this.modal=Galaxy.modal,this.modal.show({closing_events:!0,title:(0,l.default)("Deleting selected items"),body:i({}),buttons:{Close:function(){Galaxy.modal.hide()}}}),this.options.chain_call_control.total_number=0,this.options.chain_call_control.failed_number=0,n.each(function(){var n=r(this).closest("tr").data("id");void 0!==n&&("F"==n.substring(0,1)?t.push(n):e.push(n))});var a=e.length+t.length;this.progressStep=100/a,this.progress=0;for(var o=[],s=e.length-1;s>=0;s--){var c=new p.default.Item({id:e[s]});o.push(c)}for(var d=t.length-1;d>=0;d--){var u=new p.default.FolderAsModel({id:t[d]});o.push(u)}this.options.chain_call_control.total_number=a,this.chainCallDeletingItems(o)}},showLocInfo:function(){var e=this,t=null;null!==Galaxy.libraries.libraryListView?(t=Galaxy.libraries.libraryListView.collection.get(this.options.parent_library_id),this.showLocInfoModal(t)):(t=new p.default.Library({id:this.options.parent_library_id}),t.fetch({success:function(){e.showLocInfoModal(t)},error:function(e,t){void 0!==t.responseJSON?h.default.error(t.responseJSON.err_msg):h.default.error("An error occurred.")}}))},showLocInfoModal:function(e){var t=this.templateLocInfoInModal();this.modal=Galaxy.modal,this.modal.show({closing_events:!0,title:(0,l.default)("Location Details"),body:t({library:e,options:this.options}),buttons:{Close:function(){Galaxy.modal.hide()}}})},showImportModal:function(e){switch(e.source){case"history":this.addFilesFromHistoryModal();break;case"importdir":this.importFilesFromGalaxyFolderModal({source:"importdir"});break;case"path":this.importFilesFromPathModal();break;case"userdir":this.importFilesFromGalaxyFolderModal({source:"userdir"});break;default:Galaxy.libraries.library_router.back(),h.default.error("Invalid import source.")}},showPageSizePrompt:function(e){e.preventDefault();var t=prompt("How many items per page do you want to see?",Galaxy.libraries.preferences.get("folder_page_size"));null!=t&&t==parseInt(t)&&(Galaxy.libraries.preferences.set({folder_page_size:parseInt(t)}),Galaxy.libraries.folderListView.render({id:this.options.id,show_page:1}))},findCheckedRows:function(){return r("#folder_list_body").find(":checked")},findCheckedItems:function(){var e=[],t=[];return this.findCheckedRows().each(function(){var n=r(this).closest("tr").data("id");"F"==n.substring(0,1)?e.push(n):t.push(n)}),{folder_ids:e,dataset_ids:t}},showCollectionSelect:function(e){var t=this;e.preventDefault();var n=this.findCheckedItems(),i=this.templateCollectionSelectModal();this.modal=Galaxy.modal,this.modal.show({closing_events:!0,title:"Create History Collection from Datasets",body:i({selected_datasets:n.dataset_ids.length}),buttons:{Continue:function(){t.showColectionBuilder(n.dataset_ids)},Close:function(){Galaxy.modal.hide()}}}),this.prepareCollectionTypeSelect(),this.prepareHistoryTypeSelect()},prepareCollectionTypeSelect:function(){var e=this;this.collectionType="list",this.select_collection_type=new m.default.View({css:"library-collection-type-select",container:this.modal.$el.find(".library-collection-type-select"),data:[{id:"list",text:"List"},{id:"paired",text:"Paired"},{id:"list:paired",text:"List of Pairs"}],value:"list",onchange:function(t){e.updateCollectionType(t)}})},prepareHistoryTypeSelect:function(){var e=this;this.fetchUserHistories().done(function(){for(var t=[],n=e.histories.length-1;n>=0;n--)t.unshift({id:e.histories.models[n].id,text:e.histories.models[n].get("name")});e.select_collection_history=new m.default.View({css:"library-collection-history-select",container:e.modal.$el.find(".library-collection-history-select"),data:t,value:t[0].id})})},updateCollectionType:function(e){this.collectionType=e},showColectionBuilder:function(t){var n=this,i=[],r=this.modal.$('input[type="radio"]:checked').val();if("selection"===r)for(var a=t.length-1;a>=0;a--){var o={},s=Galaxy.libraries.folderListView.folder_container.get("folder").get(t[a]);o.id=t[a],o.name=s.get("name"),o.deleted=s.get("deleted"),o.state=s.get("state"),i.push(o)}else"folder"===r&&(i=new e.Collection(Galaxy.libraries.folderListView.folder_container.get("folder").where({type:"file"})).toJSON());var l=this.modal.$("input[name=history_name]").val();if(""!==l)this.createNewHistory(l).done(function(e){h.default.success("History created"),n.collectionImport(i,e.id,e.name)}).fail(function(e,t,n){h.default.error("An error occurred.")});else{var c=this.select_collection_history.value(),d=this.select_collection_history.text();this.collectionImport(i,c,d)}},collectionImport:function(e,t,n){var i=this,r="Creating Collection in "+n,a=void 0,o=void 0;if("list"===this.collectionType)a=v.default.ListCollectionCreator,o=function(e,n,r){return e=e.map(function(e){return{id:e.id,name:e.name,src:"ldda"}}),i.createHDCA(e,i.collectionType,n,r,t)},v.default.collectionCreatorModal(e,{creationFn:o,title:r,defaultHideSourceItems:!0},a);else if("paired"===this.collectionType)a=b.default.PairCollectionCreator,o=function(e,n,r){return e=[{name:"forward",src:"ldda",id:e[0].id},{name:"reverse",src:"ldda",id:e[1].id}],i.createHDCA(e,i.collectionType,n,r,t)},v.default.collectionCreatorModal(e,{creationFn:o,title:r,defaultHideSourceItems:!0},a);else if("list:paired"===this.collectionType){var s=e.map(function(e){return{id:e.id,name:e.name,src:"ldda"}});x.default.pairedCollectionCreatorModal(s,{historyId:t,title:r,defaultHideSourceItems:!0})}},createHDCA:function(e,t,n,i,r,a){return new M.default.HistoryDatasetCollection({history_content_type:"dataset_collection",collection_type:t,history_id:r,name:n,hide_source_items:i||!1,element_identifiers:e}).save(a)},templateToolBar:function(){return i.template(['<div class="library_style_container">','<div id="library_toolbar">','<form class="form-inline" role="form">',"<span><strong>DATA LIBRARIES</strong></span>",'<span class="library-paginator folder-paginator"></span>','<div class="checkbox toolbar-item logged-dataset-manipulation" style="height: 20px; display:none;">',"<label>",'<input type="checkbox" class="include-deleted-datasets-chk">include deleted</input>',"</label>","</div>",'<button style="display:none;" data-toggle="tooltip" data-placement="top" title="Create New Folder" class="btn btn-default primary-button toolbtn-create-folder add-library-items add-library-items-folder toolbar-item" type="button">','<span class="fa fa-plus"></span><span class="fa fa-folder"></span> Create Folder ',"</button>","<% if(multiple_add_dataset_options) { %>",'<div class="btn-group add-library-items add-library-items-datasets toolbar-item" style="display:none;">','<button title="Add Datasets to Current Folder" id="" type="button" class="primary-button dropdown-toggle" data-toggle="dropdown">','<span class="fa fa-plus"></span><span class="fa fa-file"></span> Add Datasets <span class="caret"></span>',"</button>",'<ul class="dropdown-menu" role="menu">','<li><a href="#folders/<%= id %>/import/history"> from History</a></li>',"<% if(Galaxy.config.user_library_import_dir !== null) { %>",'<li><a href="#folders/<%= id %>/import/userdir"> from User Directory</a></li>',"<% } %>","<% if(Galaxy.config.library_import_dir !== null || Galaxy.config.allow_library_path_paste) { %>",'<li class="divider"></li>','<li class="dropdown-header">Admins only</li>',"<% if(Galaxy.config.library_import_dir !== null) { %>",'<li><a href="#folders/<%= id %>/import/importdir">from Import Directory</a></li>',"<% } %>","<% if(Galaxy.config.allow_library_path_paste) { %>",'<li><a href="#folders/<%= id %>/import/path">from Path</a></li>',"<% } %>","<% } %>","</ul>","</div>","<% } else { %>",'<a data-placement="top" title="Add Datasets to Current Folder" style="display:none;" class="btn btn-default add-library-items add-library-items-datasets" href="#folders/<%= id %>/import/history" role="button">','<span class="fa fa-plus"></span><span class="fa fa-file"></span>',"</a>","<% } %>",'<div class="btn-group toolbar-item">','<button title="Import to history" type="button" class="primary-button dropdown-toggle add-to-history" data-toggle="dropdown">','<span class="fa fa-book"></span> To History <span class="caret"></span>',"</button>",'<ul class="dropdown-menu" role="menu">','<li><a href="" class="toolbtn-bulk-import add-to-history-datasets">as Datasets</a></li>','<li><a href="" class="toolbtn-collection-import add-to-history-collection">as a Collection</a></li>',"</ul>","</div>",'<div class="btn-group dataset-manipulation toolbar-item" style="display:none; ">','<button title="Download items as archive" type="button" class="primary-button dropdown-toggle" data-toggle="dropdown">','<span class="fa fa-save"></span> Download <span class="caret"></span>',"</button>",'<ul class="dropdown-menu" role="menu">','<li><a href="#/folders/<%= id %>/download/tgz">.tar.gz</a></li>','<li><a href="#/folders/<%= id %>/download/tbz">.tar.bz</a></li>','<li><a href="#/folders/<%= id %>/download/zip">.zip</a></li>',"</ul>","</div>",'<button data-toggle="tooltip" data-placement="top" title="Mark items deleted" class="primary-button toolbtn-bulk-delete logged-dataset-manipulation toolbar-item" style="display:none;" type="button">','<span class="fa fa-trash"></span> Delete',"</button>",'<span class="right-float" data-toggle="tooltip" data-placement="top" title="See this screen annotated">','<a href="https://galaxyproject.org/data-libraries/screen/folder-contents/" target="_blank">','<button class="primary-button" type="button">','<span class="fa fa-question-circle"></span>',"&nbsp;Help","</button>","</a>","</span>",'<span class="right-float" data-toggle="tooltip" data-placement="top" title="Show location details">','<button data-id="<%- id %>" class="primary-button toolbtn-show-locinfo toolbar-item" type="button">','<span class="fa fa-info-circle"></span>',"&nbsp;Details","</button>","</span>","</div>","</form>",'<div id="folder_items_element" />','<div class="folder-paginator paginator-bottom" />',"</div>"].join(""))},templateLocInfoInModal:function(){return i.template(["<div>",'<table class="grid table table-condensed">',"<thead>",'<th style="width: 25%;">library</th>',"<th></th>","</thead>","<tbody>","<tr>","<td>name</td>",'<td><%- library.get("name") %></td>',"</tr>",'<% if(library.get("description") !== "") { %>',"<tr>","<td>description</td>",'<td><%- library.get("description") %></td>',"</tr>","<% } %>",'<% if(library.get("synopsis") !== "") { %>',"<tr>","<td>synopsis</td>",'<td><%- library.get("synopsis") %></td>',"</tr>","<% } %>",'<% if(library.get("create_time_pretty") !== "") { %>',"<tr>","<td>created</td>",'<td><span title="<%- library.get("create_time") %>"><%- library.get("create_time_pretty") %></span></td>',"</tr>","<% } %>","<tr>","<td>id</td>",'<td><%- library.get("id") %></td>',"</tr>","</tbody>","</table>",'<table class="grid table table-condensed">',"<thead>",'<th style="width: 25%;">folder</th>',"<th></th>","</thead>","<tbody>","<tr>","<td>name</td>","<td><%- options.folder_name %></td>","</tr>",'<% if(options.folder_description !== "") { %>',"<tr>","<td>description</td>","<td><%- options.folder_description %></td>","</tr>","<% } %>","<tr>","<td>id</td>","<td><%- options.id %></td>","</tr>","</tbody>","</table>","</div>"].join(""))},templateNewFolderInModal:function(){return i.template(['<div id="new_folder_modal">',"<form>",'<input type="text" name="Name" value="" placeholder="Name" autofocus>','<input type="text" name="Description" value="" placeholder="Description">',"</form>","</div>"].join(""))},templateImportIntoHistoryModal:function(){return i.template(["<div>",'<div class="library-modal-item">',"Select history: ",'<select name="import_to_history" style="width:50%; margin-bottom: 1em; " autofocus>',"<% _.each(histories, function(history) { %>",'<option value="<%= _.escape(history.get("id")) %>"><%= _.escape(history.get("name")) %></option>',"<% }); %>","</select>","</div>",'<div class="library-modal-item">',"or create new: ",'<input type="text" name="history_name" value="" placeholder="name of the new history" style="width:50%;" />',"</div>","</div>"].join(""))},templateImportIntoHistoryProgressBar:function(){return i.template(['<div class="import_text">',"Importing selected items to history <b><%= _.escape(history_name) %></b>","</div>",'<div class="progress">','<div class="progress-bar progress-bar-import" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 00%;">','<span class="completion_span">0% Complete</span>',"</div>","</div>"].join(""))},templateAddingDatasetsProgressBar:function(){return i.template(['<div class="import_text">',"Adding selected datasets to library folder <b><%= _.escape(folder_name) %></b>","</div>",'<div class="progress">','<div class="progress-bar progress-bar-import" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 00%;">','<span class="completion_span">0% Complete</span>',"</div>","</div>"].join(""))},templateDeletingItemsProgressBar:function(){return i.template(['<div class="import_text">',"</div>",'<div class="progress">','<div class="progress-bar progress-bar-import" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 00%;">','<span class="completion_span">0% Complete</span>',"</div>","</div>"].join(""))},templateBrowserModal:function(){return i.template(['<div id="file_browser_modal">','<div class="alert alert-info jstree-files-message">All files you select will be imported into the current folder ignoring their folder structure.</div>','<div class="alert alert-info jstree-folders-message" style="display:none;">All files within the selected folders and their subfolders will be imported into the current folder.</div>','<div style="margin-bottom:1em;">','<label title="Switch to selecting files" class="radio-inline import-type-switch">','<input type="radio" name="jstree-radio" value="jstree-disable-folders" checked="checked"> Choose Files',"</label>",'<label title="Switch to selecting folders" class="radio-inline import-type-switch">','<input type="radio" name="jstree-radio" value="jstree-disable-files"> Choose Folders',"</label>","</div>",'<div style="margin-bottom:1em;">','<label class="checkbox-inline jstree-preserve-structure" style="display:none;">','<input class="preserve-checkbox" type="checkbox" value="preserve_directory_structure">',"Preserve directory structure","</label>",'<label class="checkbox-inline">','<input class="link-checkbox" type="checkbox" value="link_files">',"Link files instead of copying","</label>",'<label class="checkbox-inline">','<input class="posix-checkbox" type="checkbox" value="to_posix_lines" checked="checked">',"Convert line endings to POSIX","</label>",'<label class="checkbox-inline">','<input class="spacetab-checkbox" type="checkbox" value="space_to_tab">',"Convert spaces to tabs","</label>","</div>",'<button title="Select all files" type="button" class="button primary-button libimport-select-all">',"Select all","</button>",'<button title="Select no files" type="button" class="button primary-button libimport-select-none">',"Unselect all","</button>","<hr />",'<div id="jstree_browser">',"</div>","<hr />","<p>You can set extension type and genome for all imported datasets at once:</p>","<div>",'Type: <span id="library_extension_select" class="library-extension-select" />','Genome: <span id="library_genome_select" class="library-genome-select" />',"</div>","<br>","<div>",'<label class="checkbox-inline tag-files">',"Tag datasets based on file names",'<input class="tag-files" type="checkbox" value="tag_using_filenames">',"</label>","</div>","</div>"].join(""))},templateImportPathModal:function(){return i.template(['<div id="file_browser_modal">','<div class="alert alert-info jstree-folders-message">All files within the given folders and their subfolders will be imported into the current folder.</div>','<div style="margin-bottom: 0.5em;">','<label class="checkbox-inline">','<input class="preserve-checkbox" type="checkbox" value="preserve_directory_structure">',"Preserve directory structure","</label>",'<label class="checkbox-inline">','<input class="link-checkbox" type="checkbox" value="link_files">',"Link files instead of copying","</label>","<br>",'<label class="checkbox-inline">','<input class="posix-checkbox" type="checkbox" value="to_posix_lines" checked="checked">',"Convert line endings to POSIX","</label>",'<label class="checkbox-inline">','<input class="spacetab-checkbox" type="checkbox" value="space_to_tab">',"Convert spaces to tabs","</label>","</div>",'<textarea id="import_paths" class="form-control" rows="5" placeholder="Absolute paths (or paths relative to Galaxy root) separated by newline" autofocus></textarea>',"<hr />","<p>You can set extension type and genome for all imported datasets at once:</p>","<div>",'Type: <span id="library_extension_select" class="library-extension-select" />','Genome: <span id="library_genome_select" class="library-genome-select" />',"</div>","<div>",'<label class="checkbox-inline tag-files">',"Tag datasets based on file names",'<input class="tag-files" type="checkbox" value="tag_using_filenames">',"</label>","</div>","</div>"].join(""))},templateAddFilesFromHistory:function(){return i.template(['<div id="add_files_modal">',"<div>","1.&nbsp;Select history:&nbsp;",'<select id="dataset_add_bulk" name="dataset_add_bulk" style="width:66%; "> ',"<% _.each(histories, function(history) { %>",'<option value="<%= _.escape(history.get("id")) %>"><%= _.escape(history.get("name")) %></option>',"<% }); %>","</select>","</div>","<br/>",'<div class="library_selected_history_content">',"</div>","</div>"].join(""))},templateHistoryContents:function(){return i.template(["<p>2.&nbsp;Choose the datasets to import:</p>","<div>",'<button title="Select all datasets" type="button" class="button primary-button history-import-select-all">',"Select all","</button>",'<button title="Select all datasets" type="button" class="button primary-button history-import-unselect-all">',"Unselect all","</button>","</div>","<br>","<ul>","<% _.each(history_contents, function(history_item) { %>",'<% if (history_item.get("deleted") != true ) { %>','<% var item_name = history_item.get("name") %>','<% if (history_item.get("type") === "collection") { %>','<% var collection_type = history_item.get("collection_type") %>','<% if (collection_type === "list") { %>','<li data-id="<%= _.escape(history_item.get("id")) %>" data-name="<%= _.escape(history_item.get("type")) %>">',"<label>",'<label title="<%= _.escape(item_name) %>">','<input style="margin: 0;" type="checkbox"> <%= _.escape(history_item.get("hid")) %>: ','<%= item_name.length > 75 ? _.escape("...".concat(item_name.substr(-75))) : _.escape(item_name) %> (Dataset Collection)',"</label>","</li>","<% } else { %>",'<li><input style="margin: 0;" type="checkbox" onclick="return false;" disabled="disabled">','<span title="You can convert this collection into a collection of type list using the Collection Tools">','<%= _.escape(history_item.get("hid")) %>: ','<%= item_name.length > 75 ? _.escape("...".concat(item_name.substr(-75))) : _.escape(item_name) %> (Dataset Collection of type <%= _.escape(collection_type) %> not supported.)',"</span>","</li>","<% } %>",'<% } else if (history_item.get("visible") === true && history_item.get("state") === "ok") { %>','<li data-id="<%= _.escape(history_item.get("id")) %>" data-name="<%= _.escape(history_item.get("type")) %>">','<label title="<%= _.escape(item_name) %>">','<input style="margin: 0;" type="checkbox"> <%= _.escape(history_item.get("hid")) %>: ','<%= item_name.length > 75 ? _.escape("...".concat(item_name.substr(-75))) : _.escape(item_name) %>',"</label>","</li>","<% } %>","<% } %>","<% }); %>","</ul>"].join(""))},templatePaginator:function(){return i.template(['<ul class="pagination pagination-sm">',"<% if ( ( show_page - 1 ) > 0 ) { %>","<% if ( ( show_page - 1 ) > page_count ) { %>",'<li><a href="#folders/<%= id %>/page/1"><span class="fa fa-angle-double-left"></span></a></li>','<li class="disabled"><a href="#folders/<%= id %>/page/<% print( show_page ) %>"><% print( show_page - 1 ) %></a></li>',"<% } else { %>",'<li><a href="#folders/<%= id %>/page/1"><span class="fa fa-angle-double-left"></span></a></li>','<li><a href="#folders/<%= id %>/page/<% print( show_page - 1 ) %>"><% print( show_page - 1 ) %></a></li>',"<% } %>","<% } else { %>",'<li class="disabled"><a href="#folders/<%= id %>/page/1"><span class="fa fa-angle-double-left"></span></a></li>','<li class="disabled"><a href="#folders/<%= id %>/page/<% print( show_page ) %>"><% print( show_page - 1 ) %></a></li>',"<% } %>",'<li class="active">','<a href="#folders/<%= id %>/page/<% print( show_page ) %>"><% print( show_page ) %></a>',"</li>","<% if ( ( show_page ) < page_count ) { %>",'<li><a href="#folders/<%= id %>/page/<% print( show_page + 1 ) %>"><% print( show_page + 1 ) %></a></li>','<li><a href="#folders/<%= id %>/page/<% print( page_count ) %>"><span class="fa fa-angle-double-right"></span></a></li>',"<% } else { %>",'<li class="disabled"><a href="#folders/<%= id %>/page/<% print( show_page  ) %>"><% print( show_page + 1 ) %></a></li>','<li class="disabled"><a href="#folders/<%= id %>/page/<% print( page_count ) %>"><span class="fa fa-angle-double-right"></span></a></li>',"<% } %>","</ul>","<span>",' <%- items_shown %> items shown <a href="" data-toggle="tooltip" data-placement="top" title="currently <%- folder_page_size %> per page" class="page-size-prompt">(change)</a>',"</span>","<span>"," <%- total_items_count %> total","</span>"].join(""))},templateCollectionSelectModal:function(){return i.template(["<div>",'<div class="library-modal-item">',"<h4>Which datasets?</h4>",'<form class="form-inline">','<label class="radio-inline">','<input type="radio" name="radio_elements" id="selection_radio" value="selection" <% if (!selected_datasets) { %> disabled <% } else { %> checked <% } %> > current selection',"<% if (selected_datasets) { %>"," (<%- selected_datasets %>)","<% } %>","</label>",'<label class="radio-inline">','<input type="radio" name="radio_elements" id="folder_radio" value="folder" <% if (!selected_datasets) { %> checked <% } %> > all datasets in current folder',"</label>","</form>","</div>",'<div class="library-modal-item">',"<h4>Collection type</h4>",'<span class="library-collection-type-select"/>',"<h5>Which type to choose?</h5>","<ul>","<li>","List: Generic collection which groups any number of datasets into a set; similar to file system folder.","</li>","<li>","Paired: Simple collection containing exactly two sequence datasets; one reverse and the other forward.","</li>","<li>","List of Pairs: Advanced collection containing any number of Pairs; imagine as Pair-type collections inside of a List-type collection.","</li>","</ul>","</div>",'<div class="library-modal-item">',"<h4>Select history</h4>",'<span class="library-collection-history-select"/>'," or create new: ",'<input type="text" name="history_name" value="" placeholder="name of the new history" />',"</div>","</div>"].join(""))}});t.default={FolderToolbarView:C}}).call(t,n(2),n(1),n(0),n(0))},function(e,t,n){"use strict";(function(e,i,r){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(7),s=a(o),l=n(18),c=a(l),d=n(12),u=a(d),h=e.View.extend({el:"#center",model:null,options:{},events:{"click .toolbtn_save_permissions":"savePermissions"},initialize:function(e){this.options=i.extend(this.options,e),this.options.id&&this.fetchLibrary()},fetchLibrary:function(e){this.options=i.extend(this.options,e),this.model=new c.default.Library({id:this.options.id});var t=this;this.model.fetch({success:function(){t.options.show_permissions&&t.showPermissions()},error:function(e,t){void 0!==t.responseJSON?s.default.error(t.responseJSON.err_msg+" Click this to go back.","",{onclick:function(){Galaxy.libraries.library_router.back()}}):s.default.error("An error occurred. Click this to go back.","",{onclick:function(){Galaxy.libraries.library_router.back()}})}})},showPermissions:function(e){this.options=i.extend(this.options,e),r(".tooltip").remove(),void 0!==this.options.fetched_permissions&&(0===this.options.fetched_permissions.access_library_role_list.length?this.model.set({is_unrestricted:!0}):this.model.set({is_unrestricted:!1}));var t=!1;Galaxy.user&&(t=Galaxy.user.isAdmin());var n=this.templateLibraryPermissions();this.$el.html(n({library:this.model,is_admin:t}));var a=this;r.get(Galaxy.root+"api/libraries/"+a.id+"/permissions?scope=current").done(function(e){a.prepareSelectBoxes({fetched_permissions:e})}).fail(function(){s.default.error("An error occurred while attempting to fetch library permissions.")}),r("#center [data-toggle]").tooltip(),r("#center").css("overflow","auto")},_serializeRoles:function(e){for(var t=[],n=0;n<e.length;n++)t.push(e[n][1]+":"+e[n][0]);return t},prepareSelectBoxes:function(e){this.options=i.extend(this.options,e);var t=this.options.fetched_permissions,n=this,r=this._serializeRoles(t.access_library_role_list),a=this._serializeRoles(t.add_library_item_role_list),o=this._serializeRoles(t.manage_library_role_list),s=this._serializeRoles(t.modify_library_role_list);n.accessSelectObject=new u.default.View(this._createSelectOptions(this,"access_perm",r,!0)),n.addSelectObject=new u.default.View(this._createSelectOptions(this,"add_perm",a,!1)),n.manageSelectObject=new u.default.View(this._createSelectOptions(this,"manage_perm",o,!1)),n.modifySelectObject=new u.default.View(this._createSelectOptions(this,"modify_perm",s,!1))},_createSelectOptions:function(e,t,n,i){return i=!0===i&&i,{minimumInputLength:0,css:t,multiple:!0,placeholder:"Click to select a role",container:e.$el.find("#"+t),ajax:{url:Galaxy.root+"api/libraries/"+e.id+"/permissions?scope=available&is_library_access="+i,dataType:"json",quietMillis:100,data:function(e,t){return{q:e,page_limit:10,page:t}},results:function(e,t){var n=10*t<e.total;return{results:e.roles,more:n}}},formatResult:function(e){return e.name+" type: "+e.type},formatSelection:function(e){return e.name},initSelection:function(e,t){var n=[];r(e.val().split(",")).each(function(){var e=this.split(":");n.push({id:e[0],name:e[1]})}),t(n)},initialData:n,dropdownCssClass:"bigdrop"}},makeDatasetPrivate:function(){var e=this;r.post(Galaxy.root+"api/libraries/datasets/"+e.id+"/permissions?action=make_private").done(function(t){e.model.set({is_unrestricted:!1}),e.showPermissions({fetched_permissions:t}),s.default.success("The dataset is now private to you.")}).fail(function(){s.default.error("An error occurred while attempting to make dataset private.")})},removeDatasetRestrictions:function(){var e=this;r.post(Galaxy.root+"api/libraries/datasets/"+e.id+"/permissions?action=remove_restrictions").done(function(t){e.model.set({is_unrestricted:!0}),e.showPermissions({fetched_permissions:t}),s.default.success("Access to this dataset is now unrestricted.")}).fail(function(){s.default.error("An error occurred while attempting to make dataset unrestricted.")})},_extractIds:function(e){for(var t=[],n=e.length-1;n>=0;n--)t.push(e[n].id);return t},savePermissions:function(e){var t=this,n=this._extractIds(this.accessSelectObject.$el.select2("data")),i=this._extractIds(this.addSelectObject.$el.select2("data")),a=this._extractIds(this.manageSelectObject.$el.select2("data")),o=this._extractIds(this.modifySelectObject.$el.select2("data"));r.post(Galaxy.root+"api/libraries/"+t.id+"/permissions?action=set_permissions",{"access_ids[]":n,"add_ids[]":i,"manage_ids[]":a,"modify_ids[]":o}).done(function(e){t.showPermissions({fetched_permissions:e}),s.default.success("Permissions saved.")}).fail(function(){s.default.error("An error occurred while attempting to set library permissions.")})},templateLibraryPermissions:function(){return i.template(['<div class="library_style_container">','<div id="library_toolbar">','<a href="#">','<button data-toggle="tooltip" data-placement="top" title="Go back to the list of Libraries" class="btn btn-default primary-button" type="button">','<span class="fa fa-list"/>',"&nbsp;Libraries","</button>","</a>","</div>","<h1>",'Library: <%= _.escape(library.get("name")) %>',"</h1>",'<div class="alert alert-warning">',"<% if (is_admin) { %>","You are logged in as an <strong>administrator</strong> therefore you can manage any library on this Galaxy instance. Please make sure you understand the consequences.","<% } else { %>","You can assign any number of roles to any of the following permission types. However please read carefully the implications of such actions.","<% }%>","</div>",'<div class="dataset_table">',"<h2>Library permissions</h2>","<h4>Roles that can access the library</h4>",'<div id="access_perm" class="access_perm roles-selection"/>','<div class="alert alert-info roles-selection">',"User with <strong>any</strong> of these roles can access this library. If there are no access roles set on the library it is considered <strong>unrestricted</strong>.","</div>","<h4>Roles that can manage permissions on this library</h4>",'<div id="manage_perm" class="manage_perm roles-selection"/>','<div class="alert alert-info roles-selection">',"User with <strong>any</strong> of these roles can manage permissions on this library (includes giving access).","</div>","<h4>Roles that can add items to this library</h4>",'<div id="add_perm" class="add_perm roles-selection"/>','<div class="alert alert-info roles-selection">',"User with <strong>any</strong> of these roles can add items to this library (folders and datasets).","</div>","<h4>Roles that can modify this library</h4>",'<div id="modify_perm" class="modify_perm roles-selection"/>','<div class="alert alert-info roles-selection">',"User with <strong>any</strong> of these roles can modify this library (name, synopsis, etc.).","</div>",'<button data-toggle="tooltip" data-placement="top" title="Save modifications made on this page" class="btn btn-default toolbtn_save_permissions primary-button" type="button">','<span class="fa fa-floppy-o"/>',"&nbsp;Save","</button>","</div>","</div>"].join(""))}});t.default={LibraryView:h}}).call(t,n(2),n(1),n(0))},function(e,t,n){"use strict";(function(e,i,r){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(7),s=a(o),l=n(18),c=a(l),d=n(12),u=a(d),h=e.View.extend({el:"#center",model:null,options:{},events:{"click .toolbtn_save_permissions":"savePermissions"},initialize:function(e){this.options=i.extend(this.options,e),this.options.id&&this.fetchFolder()},fetchFolder:function(e){this.options=i.extend(this.options,e),this.model=new c.default.FolderAsModel({id:this.options.id});var t=this;this.model.fetch({success:function(){t.options.show_permissions&&t.showPermissions()},error:function(e,t){void 0!==t.responseJSON?s.default.error(t.responseJSON.err_msg+" Click this to go back.","",{onclick:function(){Galaxy.libraries.library_router.back()}}):s.default.error("An error occurred. Click this to go back.","",{onclick:function(){Galaxy.libraries.library_router.back()}})}})},showPermissions:function(e){this.options=i.extend(this.options,e),r(".tooltip").remove();var t=!1;Galaxy.user&&(t=Galaxy.user.isAdmin());var n=this.templateFolderPermissions();this.$el.html(n({folder:this.model,is_admin:t}));var a=this;r.get(Galaxy.root+"api/folders/"+a.id+"/permissions?scope=current").done(function(e){a.prepareSelectBoxes({fetched_permissions:e})}).fail(function(){s.default.error("An error occurred while attempting to fetch folder permissions.")}),r("#center [data-toggle]").tooltip(),r("#center").css("overflow","auto")},_serializeRoles:function(e){for(var t=[],n=0;n<e.length;n++)t.push(e[n][1]+":"+e[n][0]);return t},prepareSelectBoxes:function(e){this.options=i.extend(this.options,e);var t=this.options.fetched_permissions,n=this,r=this._serializeRoles(t.add_library_item_role_list),a=this._serializeRoles(t.manage_folder_role_list),o=this._serializeRoles(t.modify_folder_role_list);n.addSelectObject=new u.default.View(this._createSelectOptions(this,"add_perm",r,!1)),n.manageSelectObject=new u.default.View(this._createSelectOptions(this,"manage_perm",a,!1)),n.modifySelectObject=new u.default.View(this._createSelectOptions(this,"modify_perm",o,!1))},_createSelectOptions:function(e,t,n){return{minimumInputLength:0,css:t,multiple:!0,placeholder:"Click to select a role",container:e.$el.find("#"+t),ajax:{url:Galaxy.root+"api/folders/"+e.id+"/permissions?scope=available",dataType:"json",quietMillis:100,data:function(e,t){return{q:e,page_limit:10,page:t}},results:function(e,t){var n=10*t<e.total;return{results:e.roles,more:n}}},formatResult:function(e){return e.name+" type: "+e.type},formatSelection:function(e){return e.name},initSelection:function(e,t){var n=[];r(e.val().split(",")).each(function(){var e=this.split(":");n.push({id:e[0],name:e[1]})}),t(n)},initialData:n.join(","),dropdownCssClass:"bigdrop"}},_extractIds:function(e){for(var t=[],n=e.length-1;n>=0;n--)t.push(e[n].id);return t},savePermissions:function(e){var t=this,n=this._extractIds(this.addSelectObject.$el.select2("data")),i=this._extractIds(this.manageSelectObject.$el.select2("data")),a=this._extractIds(this.modifySelectObject.$el.select2("data"));r.post(Galaxy.root+"api/folders/"+t.id+"/permissions?action=set_permissions",{"add_ids[]":n,"manage_ids[]":i,"modify_ids[]":a}).done(function(e){t.showPermissions({fetched_permissions:e}),s.default.success("Permissions saved.")}).fail(function(){s.default.error("An error occurred while attempting to set folder permissions.")})},templateFolderPermissions:function(){return i.template(['<div class="library_style_container">','<div id="library_toolbar">','<a href="#/folders/<%= folder.get("parent_id") %>">','<button data-toggle="tooltip" data-placement="top" title="Go back to the parent folder" class="btn btn-default primary-button" type="button">','<span class="fa fa-caret-left fa-lg"/>',"&nbsp;Parent folder","</button>","</a>","</div>","<h1>",'Folder: <%= _.escape(folder.get("name")) %>',"</h1>",'<div class="alert alert-warning">',"<% if (is_admin) { %>","You are logged in as an <strong>administrator</strong> therefore you can manage any folder on this Galaxy instance. Please make sure you understand the consequences.","<% } else { %>","You can assign any number of roles to any of the following permission types. However please read carefully the implications of such actions.","<% }%>","</div>",'<div class="dataset_table">',"<h2>Folder permissions</h2>","<h4>","Roles that can manage permissions on this folder","</h4>",'<div id="manage_perm" class="manage_perm roles-selection"/>','<div class="alert alert-info roles-selection">',"User with <strong>any</strong> of these roles can manage permissions on this folder.","</div>","<h4>","Roles that can add items to this folder","</h4>",'<div id="add_perm" class="add_perm roles-selection"/>','<div class="alert alert-info roles-selection">',"User with <strong>any</strong> of these roles can add items to this folder (folders and datasets).","</div>","<h4>","Roles that can modify this folder","</h4>",'<div id="modify_perm" class="modify_perm roles-selection"/>','<div class="alert alert-info roles-selection">',"User with <strong>any</strong> of these roles can modify this folder (name, etc.).","</div>",'<button data-toggle="tooltip" data-placement="top" title="Save modifications" class="btn btn-default toolbtn_save_permissions primary-button" type="button">','<span class="fa fa-floppy-o"/>',"&nbsp;Save","</button>","</div>","</div>"].join(""))}});t.default={FolderView:h}}).call(t,n(2),n(1),n(0))},function(e,t,n){"use strict";(function(e){function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var r=n(326),a=i(r),o=n(327),s=i(o),l=n(328),c=i(l),d=n(329),u=i(d),h=n(330),f=i(h),p=n(331),g=i(p),m=n(332),_=i(m),v=e.Router.extend({initialize:function(){this.routesHit=0,e.history.on("route",function(){this.routesHit++},this),this.bind("route",this.trackPageview)},routes:{"":"toolsheds",sheds:"toolsheds",queue:"queue",workflows:"workflows","status/r/:repositories":"status",status:"status","categories/s/:tool_shed":"categories","category/s/:tool_shed/c/:cateory_id":"repositories","repository/s/:tool_shed/r/:repository_id":"repository"},back:function(){this.routesHit>1?window.history.back():this.navigate("#",{trigger:!0,replace:!0})}}),y=e.View.extend({app_config:{known_views:["toolsheds","queue","status","categories","repositories","repoository"]},initialize:function(){Galaxy.admintoolshedapp=this,this.admin_toolshed_router=new v,this.admin_toolshed_router.on("route:queue",function(){Galaxy.admintoolshedapp.adminRepoQueueView?Galaxy.admintoolshedapp.adminRepoQueueView.reDraw():Galaxy.admintoolshedapp.adminRepoQueueView=new f.default.RepoQueueView}),this.admin_toolshed_router.on("route:toolsheds",function(){Galaxy.admintoolshedapp.adminShedListView?Galaxy.admintoolshedapp.adminShedListView.reDraw():Galaxy.admintoolshedapp.adminShedListView=new a.default.ShedListView}),this.admin_toolshed_router.on("route:categories",function(e){Galaxy.admintoolshedapp.adminShedCategoriesView?Galaxy.admintoolshedapp.adminShedCategoriesView.reDraw({tool_shed:e.replace(/\//g,"%2f")}):Galaxy.admintoolshedapp.adminShedCategoriesView=new s.default.CategoryView({tool_shed:e.replace(/\//g,"%2f")})}),this.admin_toolshed_router.on("route:repositories",function(e,t){Galaxy.admintoolshedapp.adminShedCategoryView?Galaxy.admintoolshedapp.adminShedCategoryView.reDraw({tool_shed:e.replace(/\//g,"%2f"),category_id:t}):Galaxy.admintoolshedapp.adminShedCategoryView=new c.default.Category({tool_shed:e.replace(/\//g,"%2f"),category_id:t})}),this.admin_toolshed_router.on("route:repository",function(e,t){Galaxy.admintoolshedapp.adminRepositoryView?Galaxy.admintoolshedapp.adminRepositoryView.reDraw({tool_shed:e.replace(/\//g,"%2f"),repository_id:t}):Galaxy.admintoolshedapp.adminRepositoryView=new u.default.RepoDetails({tool_shed:e.replace(/\//g,"%2f"),repository_id:t})}),this.admin_toolshed_router.on("route:status",function(e){Galaxy.admintoolshedapp.adminRepoStatusView?Galaxy.admintoolshedapp.adminRepoStatusView.reDraw({repositories:e.split("|")}):Galaxy.admintoolshedapp.adminRepoStatusView=new g.default.RepoStatus({repositories:e.split("|")})}),this.admin_toolshed_router.on("route:workflows",function(){Galaxy.admintoolshedapp.adminWorkflowsView?Galaxy.admintoolshedapp.adminWorkflowsView.reDraw():Galaxy.admintoolshedapp.adminWorkflowsView=new _.default.Workflows}),e.history.start({pushState:!1})}});t.default={GalaxyApp:y}}).call(t,n(2))},function(e,t,n){"use strict";(function(e,i){function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var a=n(3),o=r(a),s=n(33),l=r(s),c=n(34),d=r(c),u=e.View.extend({defaults:{tool_sheds:[{url:"https://toolshed.g2.bx.psu.edu/",name:"Galaxy Main Tool Shed"}]},initialize:function(e){this.options=i.defaults(this.options||{},this.defaults),this.model=new l.default.ShedsCollection,this.listenTo(this.model,"sync",this.render),this.model.fetch()},el:"#center",render:function(e){this.options=i.defaults(this.options||{},e,this.defaults);var t=this.templateToolshedList;this.$el.html(t({title:(0,o.default)("Configured Galaxy Tool Sheds"),tool_sheds:this.model.models,queue:d.default.queueLength()}))},reDraw:function(e){this.$el.empty(),this.render(e)},templateToolshedList:i.template(['<div class="unified-panel-header" id="panel_header" unselectable="on">','<div class="unified-panel-header-inner"><%= title %></div>','<div class="unified-panel-header-inner" style="position: absolute; right: 5px; top: 0px;"><a href="#/queue">Repository Queue (<%= queue %>)</a></div>',"</div>",'<div class="unified-panel-body" id="list_toolsheds">','<div class="form-row">','<table class="grid">',"<% _.each(tool_sheds, function(shed) { %>",'<tr class="libraryTitle">',"<td>",'<div style="float: left; margin-left: 1px;" class="menubutton split">','<a class="view-info shed-selector" href="#/categories/s/<%= shed.get("url") %>"><%= shed.get("name") %></a>',"</div>","</td>","</tr>","<% }); %>","</table>","</div>",'<div style="clear: both"></div>',"</div>"].join(""))});t.default={ShedListView:u}}).call(t,n(2),n(1))},function(e,t,n){"use strict";(function(e,i,r){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(33),s=a(o),l=n(34),c=a(l);n(63);var d=e.View.extend({el:"#center",defaults:{tool_shed:"https://toolshed.g2.bx.psu.edu/"},initialize:function(e){var t=e.tool_shed.replace(/\//g,"%2f");this.options=i.defaults(this.options||e,this.defaults),this.model=new s.default.Categories,this.listenTo(this.model,"sync",this.render),this.model.url=this.model.url+"?tool_shed_url="+this.options.tool_shed,this.model.tool_shed=t,this.model.fetch()},render:function(e){this.options=i.extend(this.options,e),this.options.categories=this.model.models,this.options.queue=c.default.queueLength();var t=this.templateCategoryList;this.$el.html(t(this.options)),r("#center").css("overflow","auto"),this.bindEvents()},bindEvents:function(){var t=this;r("#search_box").autocomplete({source:function(e,n){var i=t.model.tool_shed.replace(/%2f/g,"/"),a=Galaxy.root+"api/tool_shed/search",o={term:e.term,tool_shed_url:i};r.post(a,o,function(e){console.log(e);var t=c.default.shedParser(e);n(t)})},minLength:3,select:function(n,i){var r=i.item.value,a=(Galaxy.root,t.model.tool_shed,"repository/s/"+t.model.tool_shed+"/r/"+r);e.history.navigate(a,{trigger:!0,replace:!0})}})},reDraw:function(e){this.$el.empty(),this.model.url=this.model.url+"?tool_shed_url="+this.options.tool_shed,this.initialize(e)},templateCategoryList:i.template(['<style type="text/css">',".ui-autocomplete { background-color: #fff; }","li.ui-menu-item { list-style-type: none; }","</style>",'<div class="unified-panel-header" id="panel_header" unselectable="on">','<div class="unified-panel-header-inner" style="layout: inline;">Categories in <%= tool_shed.replace(/%2f/g, "/") %></div>','<div class="unified-panel-header-inner" style="position: absolute; right: 5px; top: 0px;"><a href="#/queue">Repository Queue (<%= queue %>)</a></div>',"</div>",'<div class="unified-panel-body" id="list_categories">','<div id="standard-search" style="height: 2em; margin: 1em;">','<span class="ui-widget" >','<input class="search-box-input" id="search_box" data-shedurl="<%= tool_shed.replace(/%2f/g, "/") %>" name="search" placeholder="Search repositories by name or id" size="60" type="text" />',"</span>","</div>",'<div style="clear: both; margin-top: 1em;">','<table class="grid">','<thead id="grid-table-header">',"<tr>","<th>Name</th>","<th>Description</th>","<th>Repositories</th>","</tr>","</thead>","<% _.each(categories, function(category) { %>","<tr>","<td>",'<a href="#/category/s/<%= tool_shed %>/c/<%= category.get("id") %>"><%= category.get("name") %></a>',"</td>",'<td><%= category.get("description") %></td>','<td><%= category.get("repositories") %></td>',"</tr>","<% }); %>","</table>","</div>","</div>"].join(""))});t.default={CategoryView:d}}).call(t,n(2),n(1),n(0))},function(e,t,n){"use strict";(function(e,i,r){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(33),s=a(o),l=n(34),c=a(l);n(63);var d=e.View.extend({el:"#center",initialize:function(e){this.model=new s.default.CategoryCollection,this.listenTo(this.model,"sync",this.render);var t=e.tool_shed.replace(/\//g,"%2f");this.model.url+="?tool_shed_url="+t+"&category_id="+e.category_id,this.model.tool_shed=t,this.model.category=e.category_id,this.model.fetch()},render:function(e){this.options=i.extend(this.options,e);var t=this.templateCategoryContents;this.$el.html(t({category:this.model.models[0],tool_shed:this.model.tool_shed,queue:c.default.queueLength()})),r("#center").css("overflow","auto"),this.bindEvents()},bindEvents:function(){var t=this;r("#search_box").autocomplete({source:function(e,n){var i=t.model.tool_shed.replace(/%2f/g,"/"),a=Galaxy.root+"api/tool_shed/search",o={term:e.term,tool_shed_url:i};r.post(a,o,function(e){var t=c.default.shedParser(e);n(t)})},minLength:3,select:function(n,i){var r=i.item.value,a="repository/s/"+t.model.tool_shed+"/r/"+r;e.history.navigate(a,{trigger:!0,replace:!0})}})},reDraw:function(e){this.$el.empty(),this.initialize(e)},templateCategoryContents:i.template(['<style type="text/css">',".ui-autocomplete { background-color: #fff; }","li.ui-menu-item { list-style-type: none; }","</style>",'<div class="unified-panel-header" id="panel_header" unselectable="on">','<div class="unified-panel-header-inner">Repositories in <%= category.get("name") %></div>','<div class="unified-panel-header-inner" style="position: absolute; right: 5px; top: 0px;"><a href="#/queue">Repository Queue (<%= queue %>)</a></div>',"</div>",'<div class="unified-panel-body" id="list_repositories">','<div id="standard-search" style="height: 2em; margin: 1em;">','<span class="ui-widget" >','<input class="search-box-input" id="search_box" name="search" data-shedurl="<%= tool_shed.replace(/%2f/g, "/") %>" placeholder="Search repositories by name or id" size="60" type="text" />',"</span>","</div>",'<div style="clear: both; margin-top: 1em;">','<table class="grid">','<thead id="grid-table-header">',"<tr>",'<th style="width: 10%;">Owner</th>','<th style="width: 15%;">Name</th>',"<th>Synopsis</th>",'<th style="width: 10%;">Type</th>',"</tr>","</thead>",'<% _.each(category.get("repositories"), function(repository) { %>',"<tr>","<td><%= repository.owner %></td>","<td>",'<div style="float: left; margin-left: 1px;" class="menubutton split">','<a href="#/repository/s/<%= tool_shed %>/r/<%= repository.id %>"><%= repository.name %></a>',"</div>","</td>","<td><%= repository.description %></td>","<td><%= repository.type %></td>","</tr>","<% }); %>","</table>","</div>","</div>"].join(""))});t.default={Category:d}}).call(t,n(2),n(1),n(0))},function(e,t,n){"use strict";(function(e,i,r){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(33),s=a(o),l=n(139),c=(a(l),n(5)),d=a(c),u=n(9),h=a(u),f=n(13),p=a(f),g=n(34),m=a(g),_=e.View.extend({el:"#center",initialize:function(e){this.options=i.defaults(this.options||{},this.defaults),this.model=new s.default.RepositoryCollection,this.listenTo(this.model,"sync",this.render);var t=e.tool_shed.replace(/\//g,"%2f");this.model.url+="?tool_shed_url="+t+"&repository_id="+e.repository_id,this.model.tool_shed_url=e.tool_shed.replace(/%2f/g,"/"),this.model.tool_shed=t,this.model.category=e.repository_id,this.model.fetch()},render:function(e){var t=this.templateRepoDetails,n=this.model.models[0];this.options={repository:n.get("repository"),tool_shed:this.model.tool_shed,queue:m.default.queueLength()};var a=Object.keys(this.options.repository.metadata).sort(function(e,t){return parseInt(e.split(":")[0]-t.split(":")[0])}),o={},s=this.options.repository.metadata;a.forEach(function(e){o[e]=s[e]}),this.options.repository.metadata=o,this.options.current_changeset=this.options.current_changeset||a[a.length-1],this.options.current_metadata=this.options.repository.metadata[this.options.current_changeset],this.options.current_metadata.tool_shed_url=this.model.tool_shed_url,this.options.tools=this.options.current_metadata.tools,this.options.repository_dependencies_template=this.templateRepoDependencies,this.options.repository_dependency_template=this.templateRepoDependency,this.options.tps_template_global_select=this.templateGlobalSectionSelect,this.options.tps_template_tool_select=this.templateToolSectionSelect,this.options.tps_select_options=this.templatePanelSelectOptions,this.options.tool_dependencies=n.get("tool_dependencies"),this.options.shed_tool_conf=this.templateShedToolConf({shed_tool_confs:n.get("shed_conf")}),this.options.panel_section_dict=n.get("panel_section_dict"),this.options.api_url=Galaxy.root+"api/tool_shed_repositories/install?async=True",this.options=i.extend(this.options,e),this.$el.html(t(this.options)),this.checkInstalled(this.options.current_metadata),this.bindEvents(),r("#center").css("overflow","auto")},bindEvents:function(){var e=this;r("#changeset").on("change",function(){e.options.current_changeset=r("#changeset").find("option:selected").text(),e.options.current_metadata=e.options.repository.metadata[e.options.current_changeset],e.checkInstalled(e.options.current_metadata),e.reDraw(e.options)}),r("#tool_panel_section_select").on("change",function(){e.tpsSelection()}),r("#install_repository").on("click",function(t){r("#repository_installation");t.preventDefault();var n={};n.repositories=JSON.stringify([[r("#install_repository").attr("data-tsrid"),r("#changeset").find("option:selected").val()]]),n.tool_shed_repository_ids=JSON.stringify([r("#install_repository").attr("data-tsrid")]),n.tool_shed_url=e.model.tool_shed_url,n.install_tool_dependencies=r("#install_tool_dependencies").val(),n.install_repository_dependencies=r("#install_repository_dependencies").val(),n.install_resolver_dependencies=r("#install_resolver_dependencies").val();e.panelSelect(n);n.tool_panel_section=JSON.stringify(e.panelSelect(n)),n.shed_tool_conf=r("select[name='shed_tool_conf']").find("option:selected").val(),n.changeset=r("#changeset").find("option:selected").val();var i=r("#repository_installation").attr("action");e.prepareInstall(n,i)}),r("#queue_install").on("click",function(t){e.options.current_changeset=r("#changeset").find("option:selected").text(),e.options.current_metadata=e.options.repository.metadata[e.options.current_changeset];var n=(e.options.current_changeset,{});i.each(Object.keys(e.options.current_metadata),function(t){n[t]||(n[t]=e.options.current_metadata[t])}),n.install_tool_dependencies=r("#install_tool_dependencies").val(),n.install_repository_dependencies=r("#install_repository_dependencies").val(),n.install_resolver_dependencies=r("#install_resolver_dependencies").val(),n.tool_panel_section=JSON.stringify(e.panelSelect({})),n.shed_tool_conf=r("select[name='shed_tool_conf']").find("option:selected").val(),n.tool_shed_url=e.model.tool_shed_url,"/"==n.tool_shed_url.substr(-1)&&(n.tool_shed_url=n.tool_shed_url.substr(0,n.tool_shed_url.length-1)),m.default.addToQueue(n),e.checkInstalled(n)}),r(".tool_panel_section_picker").on("change",function(){r(this).find("option:selected").val()==r("#tool_panel_section_select").find("option:selected").val()?r(this).attr("default","active"):r(this).removeAttr("default")}),r(function(){r("#repository_dependencies").jstree()}),r(".tool_form").on("click",function(){var t=r(this).attr("data-guid"),n=(r(this).attr("data-clean"),r(this).attr("data-name")),i=r(this).attr("data-desc"),a=e.model.tool_shed_url,o=r("#repository_details").attr("data-tsrid"),s=r("#changeset").find("option:selected").val(),l=Galaxy.root+"api/tool_shed/tool_json",c={guid:t,tool_shed_url:a,tsr_id:o,changeset:s};r.get(l,c,function(e){e.cls="ui-portlet-plain";var t=new p.default(e);d.default.deepeach(e.inputs,function(e){e.type&&-1!=["data","data_collection"].indexOf(e.type)&&(e.type="hidden",e.info="Data input '"+e.name+"' ("+d.default.textify(e.extensions)+")")});var r=new h.default.View,a="<u>"+n+"</u> "+i;r.show({closing_events:!0,title:a,body:t.$el,buttons:{Close:function(){r.hide()}}})})})},checkInstalled:function(e){var t=this,n={name:e.name,owner:e.owner},i=!1;t.repoQueued(e);r.get(Galaxy.root+"api/tool_shed_repositories",n,function(n){for(var a=0;a<n.length;a++){var o=n[a],s=!o.deleted&&!o.uninstalled,l=o.changeset_revision==e.changeset_revision||o.installed_changeset_revision==e.changeset_revision;o.name==e.repository.name&&o.owner==e.repository.owner&&s&&l&&(i=!0),i?(r("#install_repository").prop("disabled",!0),r("#install_repository").val("This revision is already installed")):(r("#install_repository").prop("disabled",!1),r("#install_repository").val("Install this revision"))}t.repoQueued(e)||i?(r("#queue_install").hide(),r("#queue_install").val("This revision is already in the queue")):(r("#queue_install").show(),r("#queue_install").val("Install this revision later"))})},panelSelect:function(e){var t={};return r("#tool_panel_section_select").length?e.tool_panel_section_id=r("#tool_panel_section_select").find("option:selected").val():e.new_tool_panel_section=r("#new_tool_panel_section").val(),r(".tool_panel_section_picker").each(function(){var e=r(this).attr("name"),n=r(this).attr("data-toolguid");t[n]="tool_panel_section_id"===e?{tool_panel_section:r(this).find("option:selected").val(),action:"append"}:{tool_panel_section:r(this).val(),action:"create"}}),t},reDraw:function(e){this.$el.empty(),this.render(e)},repoQueued:function(e){var t=this;if(localStorage.repositories){var n,i=t.queueKey(e);return localStorage.repositories&&(n=JSON.parse(localStorage.repositories)),!(!n||!n.hasOwnProperty(i))}},queueKey:function(e){var t=this.model.tool_shed_url;return"/"==t.substr(-1)&&(t=t.substr(0,t.length-1)),t+"|"+e.repository_id+"|"+e.changeset_revision},tpsSelection:function(){new_tps=r("#tool_panel_section_select").find("option:selected").val(),r('.tool_panel_section_picker[default="active"]').each(function(){r(this).val(new_tps)})},prepareInstall:function(e,t){var n=this;r.post(t,e,function(e){var t=JSON.parse(e);n.doInstall(t)})},doInstall:function(t){var n=Galaxy.root+"admin_toolshed/install_repositories",i=t.repositories,a="status/r/"+i.join("|");r.post(n,t,function(e){console.log("Initializing repository installation succeeded")}),e.history.navigate(a,{trigger:!0,replace:!0})},templateRepoDetails:i.template(['<div class="unified-panel-header" id="panel_header" unselectable="on">','<div class="unified-panel-header-inner">Repository information for <strong><%= repository.name %></strong> from <strong><%= repository.owner %></strong></div>','<div class="unified-panel-header-inner" style="position: absolute; right: 5px; top: 0px;"><a href="#/queue">Repository Queue (<%= queue %>)</a></div>',"</div>",'<div class="unified-panel-body" id="repository_details" data-tsrid="<%= repository.id %>">','<form id="repository_installation" name="install_repository" method="post" action="<%= api_url %>">','<input type="hidden" id="repositories" name="<%= repository.id %>" value="ID" />','<input type="hidden" id="tool_shed_url" name="tool_shed_url" value="<%= tool_shed %>" />','<div class="toolForm">','<div class="toolFormTitle">Changeset</div>','<div class="toolFormBody changeset">','<select id="changeset" name="changeset" style="margin: 5px;">',"<% _.each(Object.keys(repository.metadata), function(changeset) { %>",'<% if (changeset == current_changeset) { var selected = "selected "; } else { var selected = ""; } %>','<option <%= selected %>value="<%= changeset.split(":")[1] %>"><%= changeset %></option>',"<% }); %>","</select>",'<input class="btn btn-primary preview-button" data-tsrid="<%= current_metadata.repository.id %>" type="submit" id="install_repository" name="install_repository" value="Install this revision now" />','<input class="btn btn-primary preview-button" type="button" id="queue_install" name="queue_install" value="Install this revision later" />','<div class="toolParamHelp" style="clear: both;">Please select a revision and review the settings below before installing.</div>',"</div>","</div>","<%= shed_tool_conf %>","<% if (current_metadata.has_repository_dependencies) { %>",'<div class="toolFormTitle">Repository dependencies for <strong id="current_changeset"><%= current_changeset %></strong></div>','<div class="toolFormBody">','<p id="install_repository_dependencies_checkbox">','<input type="checkbox" checked id="install_repository_dependencies" />','<label for="install_repository_dependencies">Install repository dependencies</label>',"</p>","<% current_metadata.repository_dependency_template = repository_dependency_template; %>",'<div class="tables container-table" id="repository_dependencies">','<div class="expandLink">','<a class="toggle_folder" data_target="repository_dependencies_table">',"Repository dependencies &ndash; <em>installation of these additional repositories is required</em>","</a>","</div>","<%= repository_dependencies_template(current_metadata) %>","</div>","</div>","<% } %>","<% if (current_metadata.includes_tool_dependencies) { %>",'<div class="toolFormTitle">Tool dependencies</div>','<div class="toolFormBody">','<p id="install_resolver_dependencies_checkbox">','<input type="checkbox" checked id="install_resolver_dependencies" />','<label for="install_resolver_dependencies">Install resolver dependencies</label>',"</p>",'<p id="install_tool_dependencies_checkbox">','<input type="checkbox" checked id="install_tool_dependencies" />','<label for="install_tool_dependencies">Install tool dependencies</label>',"</p>",'<div class="tables container-table" id="tool_dependencies">','<div class="expandLink">','<a class="toggle_folder" data_target="tool_dependencies_table">',"Tool dependencies &ndash; <em>repository tools require handling of these dependencies</em>","</a>","</div>",'<table class="tables container-table" id="tool_dependencies_table" border="0" cellpadding="2" cellspacing="2" width="100%">',"<thead>",'<tr style="display: table-row;" class="datasetRow" parent="0" id="libraryItem-rt-f9cad7b01a472135">','<th style="padding-left: 40px;">Name</th>',"<th>Version</th>","<th>Type</th>","</tr>","</thead>",'<tbody id="tool_deps">',"<% _.each(tool_dependencies[current_changeset], function(dependency) { %>",'<tr class="datasetRow tool_dependency_row" style="display: table-row;">','<td style="padding-left: 40px;">',"<%= dependency.name %></td>","<td><%= dependency.version %></td>","<td><%= dependency.type %></td>","</tr>","<% }); %>","</tbody>","</table>","</div>","</div>","<% } %>","<% if (current_metadata.includes_tools_for_display_in_tool_panel) { %>",'<div class="toolFormTitle">Tools &ndash; <em>click the name to preview the tool and use the pop-up menu to inspect all metadata</em></div>','<div class="toolFormBody">','<div class="tables container-table" id="tools_toggle">','<table class="tables container-table" id="valid_tools" border="0" cellpadding="2" cellspacing="2" width="100%">',"<thead>",'<tr style="display: table-row;" class="datasetRow" parent="0" id="libraryItem-rt-f9cad7b01a472135">','<th style="padding-left: 40px;">Name</th>',"<th>Description</th>","<th>Version</th>","<th><%= tps_template_global_select({tps: panel_section_dict, tps_select_options: tps_select_options}) %></tr>","</thead>",'<tbody id="tools_in_repo">',"<% _.each(current_metadata.tools, function(tool) { %>",'<tr id="libraryItem-<%= tool.clean %>" class="tool_row" style="display: table-row;" style="width: 15%">','<td style="padding-left: 40px;">','<div id="tool-<%= tool.clean %>" class="menubutton split popup" style="float: left;">','<a class="tool_form view-info" data-toggle="modal" data-target="toolform_<%= tool.clean %>" data-clean="<%= tool.clean %>" data-guid="<%= tool.guid %>" data-name="<%= tool.name %>" data-desc="<%= tool.description %>"><%= tool.name %></a>',"</div>","</td>","<td><%= tool.description %></td>",'<td style="width: 15%"><%= tool.version %></td>','<td style="width: 35%" id="tool_tps_<%= tool.clean %>">',"<%= tps_template_tool_select({tool: tool, tps: panel_section_dict, tps_select_options: tps_select_options}) %>","</td>","</tr>","<% }); %>","</tbody>","</table>","</div>","</div>","<% } %>","</form>","</div>"].join("")),templateRepoDependencies:i.template(['<div class="toolFormTitle">Repository Dependencies</div>','<div class="toolFormBody tables container-table" id="repository_dependencies">',"<ul>","<li>Repository installation requires the following","<% if (has_repository_dependencies) { %>","<% _.each(repository_dependencies, function(dependency) { %>","<% dependency.repository_dependency_template = repository_dependency_template; %>","<%= repository_dependency_template(dependency) %>","<% }); %>","<% } %>","</li>","</ul>","</div>"].join("")),templateRepoDependency:i.template(['<li id="metadata_<%= id %>" class="datasetRow repository_dependency_row">',"Repository <b><%= repository.name %></b> revision <b><%= changeset_revision %></b> owned by <b><%= repository.owner %></b>","<% if (has_repository_dependencies) { %>",'<ul class="child_dependencies">',"<% _.each(repository_dependencies, function(dependency) { %>","<% dependency.repository_dependency_template = repository_dependency_template; %>","<%= repository_dependency_template(dependency) %>","<% }); %>","</ul>","<% } %>","</li>"].join("")),templateShedToolConf:i.template(['<div class="toolFormTitle">Shed tool configuration file:</div>','<div class="toolFormBody">','<div class="form-row">','<select name="shed_tool_conf">',"<% _.each(shed_tool_confs.options, function(conf) { %>",'<option value="<%= conf.value %>"><%= conf.label %></option>',"<% }); %>","</select>",'<div class="toolParamHelp" style="clear: both;">Select the file whose <b>tool_path</b> setting you want used for installing repositories.</div>',"</div>","</div>"].join("")),templateToolDependency:i.template(["<% if (has_repository_dependencies) { %>","<% _.each(repository_dependencies, function(dependency) { %>","<% if (dependency.includes_tool_dependencies) { %>","<% dependency.tool_dependency_template = tool_dependency_template %>","<%= tool_dependency_template(dependency) %>","<% } %>","<% }); %>","<% } %>"].join("")),templateGlobalSectionCreate:i.template(['<div id="tool_panel_section">','<div class="form-row" id="new_tps">','<input id="new_tool_panel_section" name="new_tool_panel_section" type="textfield" value="" size="40"/>','<input class="btn btn-primary" type="button" id="select_existing" value="Select existing" />','<div class="toolParamHelp" style="clear: both;">',"Add a new tool panel section to contain the installed tools (optional).","</div>","</div>","</div>"].join("")),templateGlobalSectionSelect:i.template(['<div id="tool_panel_section">','<div class="toolFormTitle">Tool Panel Section</div>','<div class="toolFormBody">','<div class="tab-pane" id="select_tps">','<select name="<%= name %>" id="<%= tps.id %>">',"<%= tps_select_options({sections: tps.sections}) %>","</select>",'<input class="btn btn-primary" type="button" id="create_new" value="Create new" />','<div class="toolParamHelp" style="clear: both;">',"Select an existing tool panel section to contain the installed tools (optional).","</div>","</div>","</div>","</div>"].join("")),templateToolSectionCreate:i.template(['<div id="new_tps_<%= tool.clean %>" data-clean="<%= tool.clean %>" class="form-row">','<input data-toolguid="<%= tool.guid %>" class="tool_panel_section_picker" size="40" name="new_tool_panel_section" id="new_tool_panel_section_<%= tool.clean %>" type="text">','<input id="per_tool_select_<%= tool.clean %>" class="btn btn-primary" data-toolguid="<%= tool.guid %>" value="Select existing" id="select_existing_<%= tool.clean %>" type="button">',"</div>"].join("")),templateToolSectionSelect:i.template(['<div id="select_tps_<%= tool.clean %>" data-clean="<%= tool.clean %>" class="tps_creator">','<select default="active" style="width: 30em;" data-toolguid="<%= tool.guid %>" class="tool_panel_section_picker" name="tool_panel_section_id" id="tool_panel_section_select_<%= tool.clean %>">',"<%= tps_select_options({sections: tps.sections}) %>","</select>",'<input id="per_tool_create_<%= tool.clean %>" data-clean="<%= tool.clean %>" class="btn btn-primary create-tps-button" data-toolguid="<%= tool.guid %>" value="Create new" id="create_new_<%= tool.clean %>" type="button">','<div style="clear: both;" class="toolParamHelp"></div>',"</div>"].join("")),templatePanelSelectOptions:i.template(["<% _.each(sections, function(section) { %>",'<option value="<%= section.id %>"><%= section.name %></option>',"<% }); %>"].join(""))});t.default={RepoDetails:_}}).call(t,n(2),n(1),n(0))},function(e,t,n){"use strict";(function(e,i,r){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(3),s=a(o),l=n(33),c=a(l),d=n(34),u=a(d),h=e.View.extend({el:"#center",defaults:[{}],initialize:function(e){var t=this;this.model=new c.default.RepoQueue,this.listenTo(this.model,"sync",this.render),this.model.fetch(),t.render()},render:function(e){var t=this,n=t.templateRepoQueue,r=t.model.models;t.$el.html(n({title:(0,s.default)("Repository Installation Queue"),repositories:r,queue:u.default.queueLength()})),i("#center").css("overflow","auto"),t.bindEvents()},bindEvents:function(){var t=this;i(".install_one").on("click",function(){var e=t.loadFromQueue(i(this).attr("data-repokey"));t.installFromQueue(e,i(this).attr("data-repokey"))}),i(".remove_one").on("click",function(){var e=i(this).attr("data-repokey"),t=JSON.parse(localStorage.repositories);if(t.hasOwnProperty(e)){var n=t[e].repository.id;delete t[e],i("#queued_repository_"+n).remove()}localStorage.repositories=JSON.stringify(t)}),i("#clear_queue").on("click",function(){localStorage.repositories="{}"}),i("#from_workflow").on("click",function(){e.history.navigate("workflows",{trigger:!0,replace:!0})})},installFromQueue:function(t,n){var r=Object();r.install_tool_dependencies=t.install_tool_dependencies,r.install_repository_dependencies=t.install_repository_dependencies,r.install_resolver_dependencies=t.install_resolver_dependencies,r.tool_panel_section=t.tool_panel_section,r.shed_tool_conf=t.shed_tool_conf,r.repositories=JSON.stringify([[t.repository.id,t.changeset_revision]]),r.tool_shed_repository_ids=JSON.stringify([t.repository.id]),r.tool_shed_url=n.split("|")[0],r.changeset=t.changeset_revision;var a=Galaxy.root+"api/tool_shed_repositories/install?async=True";if(i("#queued_repository_"+t.repository.id).remove(),localStorage.repositories){void 0===n&&(n=u.default.queueKey(t));var o=JSON.parse(localStorage.repositories);o.hasOwnProperty(n)&&(delete o[n],localStorage.repositories=JSON.stringify(o))}i.post(a,r,function(t){var n=JSON.parse(t),r=n.repositories,a="status/r/"+r.join("|");i.post(Galaxy.root+"admin_toolshed/install_repositories",n,function(e){console.log("Initializing repository installation succeeded")}),e.history.navigate(a,{trigger:!0,replace:!0})})},loadFromQueue:function(e){var t=JSON.parse(localStorage.repositories);if(t.hasOwnProperty(e))return t[e]},reDraw:function(e){this.$el.empty(),this.initialize(e),this.model.fetch(),this.render(e)},templateRepoQueue:r.template(['<div class="unified-panel-header" id="panel_header" unselectable="on">','<div class="unified-panel-header-inner"><%= title %></div>','<div class="unified-panel-header-inner" style="position: absolute; right: 5px; top: 0px;"><a href="#/queue">Repository Queue (<%= queue %>)</a></div>',"</div>",'<div class="tab-pane" id="panel_header" id="repository_queue">','<table id="queued_repositories" class="grid" border="0" cellpadding="2" cellspacing="2" width="100%">','<thead id="grid-table-header">',"<tr>",'<th class="datasetRow">Name</th>','<th class="datasetRow">Owner</th>','<th class="datasetRow">Revision</th>','<th class="datasetRow">ToolShed</th>','<th class="datasetRow">Install</th>','<th class="datasetRow"><input class="btn btn-primary" type="submit" id="clear_queue" name="clear_queue" value="Clear queue" /></th>',"</tr>","</thead>","<tbody>","<% _.each(repositories, function(repository) { %>",'<tr id="queued_repository_<%= repository.get("id") %>">','<td class="datasetRow"><%= repository.get("repository").name %></td>','<td class="datasetRow"><%= repository.get("repository").owner %></td>','<td class="datasetRow"><%= repository.get("changeset_revision") %></td>','<td class="datasetRow"><%= repository.get("tool_shed_url") %></td>','<td class="datasetRow">','<input class="btn btn-primary install_one" data-repokey="<%= repository.get("queue_key") %>" type="submit" id="install_repository_<%= repository.get("id") %>" name="install_repository" value="Install now" />',"</td>",'<td class="datasetRow">','<input class="btn btn-primary remove_one" data-repokey="<%= repository.get("queue_key") %>" type="submit" id="unqueue_repository_<%= repository.get("id") %>" name="unqueue_repository" value="Remove from queue" />',"</td>","</tr>","<% }); %>","</tbody>","</table>",'<input type="button" class="btn btn-primary" id="from_workflow" value="Add from workflow" />',"</div>"].join(""))});t.default={RepoQueueView:h}}).call(t,n(2),n(0),n(1))},function(e,t,n){"use strict";(function(e,i,r){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(3),s=a(o),l=n(33),c=a(l),d=n(34),u=a(d),h=e.View.extend({el:"#center",initialize:function(e){this.options=i.defaults(this.options||[{}],e,this.defaults),this.model=new c.default.RepoStatus,this.listenTo(this.model,"sync",this.render),this.model.url+="?repositories="+this.options.repositories.join("|"),this.model.fetch(),this.timer=setInterval(function(e){var t=["installed","error"],n=!0;i.some(e.model.models,function(e){repo_id=e.get("id");var i=e.get("status").toLowerCase();if(-1===t.indexOf(i))return n=!1,!0}),n?clearInterval(e.timer):e.model.fetch()},2e3,this)},close:function(){clearInterval(this.timer)},render:function(e){this.options=i.extend(this.options,e);var t=this.templateRepoStatus;this.$el.html(t({title:(0,s.default)("Repository Status"),repositories:this.model.models,queue:u.default.queueLength()})),r("#center").css("overflow","auto"),this.bindEvents()},bindEvents:function(){},reDraw:function(e){this.$el.empty(),this.initialize(e)},templateRepoStatus:i.template(['<div class="unified-panel-header" id="panel_header" unselectable="on">','<div class="unified-panel-header-inner"><%= title %></div>','<div class="unified-panel-header-inner" style="position: absolute; right: 5px; top: 0px;"><a href="#/queue">Repository Queue (<%= queue %>)</a></div>',"</div>",'<style type="text/css">',".state-color-new,",".state-color-deactivated,",".state-color-uninstalled { border-color:#bfbfbf; background:#eee }",".state-color-cloning,",".state-color-setting-tool-versions,",".state-color-installing-repository-dependencies,",".state-color-installing-tool-dependencies,",".state-color-loading-proprietary-datatypes { border-color:#AAAA66; background:#FFFFCC }",".state-color-installed { border-color:#20b520; background:#b0f1b0 }",".state-color-error { border-color:#dd1b15; background:#f9c7c5 }","</style>",'<table id="grid-table" class="grid">','<thead id="grid-table-header">',"<tr>",'<th id="null-header">Name<span class="sort-arrow"></span></th>','<th id="null-header">Description<span class="sort-arrow"></span></th>','<th id="null-header">Owner<span class="sort-arrow"></span></th>','<th id="null-header">Revision<span class="sort-arrow"></span></th>','<th id="null-header">Installation Status<span class="sort-arrow"></span></th>',"</tr>","</thead>",'<tbody id="grid-table-body">',"<% _.each(repositories, function(repository) { %>","<tr>","<td>",'<div id="" class="">','<label id="repo-name-<%= repository.get("id") %>" for="<%= repository.get("id") %>">','<%= repository.get("name") %>',"</label>","</div>","</td>","<td>",'<div id="" class="">','<label id="repo-desc-<%= repository.get("id") %>" for="<%= repository.get("id") %>">','<%= repository.get("description") %>',"</label>","</div>","</td>","<td>",'<div id="" class="">','<label id="repo-user-<%= repository.get("id") %>" for="<%= repository.get("id") %>">','<%= repository.get("owner") %>',"</label>","</div>","</td>","<td>",'<div id="" class="">','<label id="repo-changeset-<%= repository.get("id") %>" for="<%= repository.get("id") %>">','<%= repository.get("changeset_revision") %>',"</label>","</div>","</td>","<td>",'<div id="" class="">','<label id="RepositoryStatus-<%= repository.get("id") %>" for="<%= repository.get("id") %>">','<div class="repo-status count-box state-color-<%= repository.get("status").toLowerCase().replace(/ /g, "-") %>" id="RepositoryStatus-<%= repository.get("id") %>">','<%= repository.get("status") %>',"</div>","</label>","</div>","</td>","</tr>","<% }); %>","</tbody>",'<tfoot id="grid-table-footer"></tfoot>',"</table>"].join(""))});t.default={RepoStatus:h}}).call(t,n(2),n(1),n(0))},function(e,t,n){"use strict";(function(e,i,r){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(3),s=a(o),l=n(33),c=a(l),d=n(34),u=a(d),h=e.View.extend({el:"#center",defaults:[{}],initialize:function(e){var t=this;this.model=new c.default.WorkflowTools,this.listenTo(this.model,"sync",this.render),this.model.fetch(),t.render()},render:function(e){var t=this,n=t.templateWorkflows,r=t.model.models;t.$el.html(n({title:(0,s.default)("Workflows Missing Tools"),workflows:r,queue:u.default.queueLength()})),i("#center").css("overflow","auto"),t.bindEvents()},bindEvents:function(){var t,n=this;i(".show_wf_repo").on("click",function(){var n=i(this).attr("data-toolids"),r=i(this).attr("data-shed"),a=Galaxy.root+"api/tool_shed/repository",o={tool_ids:n};i.get(a,o,function(n){t=n.repository.id;var i="repository/s/"+r.replace(/:/g,"%3a").replace(/\//g,"%2f")+"/r/"+n.repository.id;e.history.navigate(i,{trigger:!0,replace:!0})})}),i(".queue_wf_repo").on("click",function(){var e=i(this),n=e.attr("data-toolids"),r=e.attr("data-shed"),a=Galaxy.root+"api/tool_shed/repository",o={tool_ids:n};i.get(a,o,function(n){t=n.repository.id,o={tool_shed_url:r,repository_id:t},i.get(a,o,function(t){var n=Object.keys(t.repository.metadata),i=n[0],a=t.repository.metadata[i];a.tool_shed_url=r,u.default.addToQueue(a),e.remove()})})}),i("#from_workflow").on("click",n.loadWorkflows)},reDraw:function(e){this.$el.empty(),this.initialize(e)},templateWorkflows:r.template(['<div class="unified-panel-header" id="panel_header" unselectable="on">','<div class="unified-panel-header-inner"><%= title %></div>','<div class="unified-panel-header-inner" style="position: absolute; right: 5px; top: 0px;"><a href="#/queue">Repository Queue (<%= queue %>)</a></div>',"</div>",'<style type="text/css">',".workflow_names, .workflow_tools { list-style-type: none; } ul.workflow_tools, ul.workflow_names {  padding-left: 0px; }","</style>",'<table id="workflows_missing_tools" class="grid" border="0" cellpadding="2" cellspacing="2" width="100%">','<thead id="grid-table-header">',"<tr>",'<th class="datasetRow">Workflows</th>','<th class="datasetRow">Tool IDs</th>','<th class="datasetRow">Shed</th>','<th class="datasetRow">Name</th>','<th class="datasetRow">Owner</th>','<th class="datasetRow">Actions</th>',"</tr>","</thead>","<tbody>","<% _.each(workflows, function(workflow) { %>","<tr>",'<td class="datasetRow">','<ul class="workflow_names">','<% _.each(workflow.get("workflows"), function(name) { %>','<li class="workflow_names"><%= name %></li>',"<% }); %>","</ul>","</td>",'<td class="datasetRow">','<ul class="workflow_tools">','<% _.each(workflow.get("tools"), function(tool) { %>','<li class="workflow_tools"><%= tool %></li>',"<% }); %>","</ul>","</td>",'<td class="datasetRow"><%= workflow.get("shed") %></td>','<td class="datasetRow"><%= workflow.get("repository") %></td>','<td class="datasetRow"><%= workflow.get("owner") %></td>','<td class="datasetRow">','<ul class="workflow_tools">','<li class="workflow_tools">','<input type="button" class="show_wf_repo btn btn-primary" data-shed="<%= workflow.get("shed") %>" data-owner="<%= workflow.get("owner") %>" data-repo="<%= workflow.get("repository") %>" data-toolids="<%= workflow.get("tools").join(",") %>" value="Show Repository" /></li>',"</ul>","</td>","</tr>","<% }); %>","</ul>","</div>"].join(""))});t.default={Workflows:h}}).call(t,n(2),n(0),n(1))},function(e,t,n){"use strict";(function(e){function i(e){return e&&e.__esModule?e:{default:e}}function r(e){var t,n,i,r;switch(e){case h.ITEM_HISTORY:t="History",n="Histories",i="history",r="History";break;case h.ITEM_DATASET:t="Dataset",n="Datasets",i="dataset",r="HistoryDatasetAssociation";break;case h.ITEM_WORKFLOW:t="Workflow",n="Workflows",i="workflow",r="StoredWorkflow";break;case h.ITEM_PAGE:t="Page",n="Pages",i="page",r="Page";break;case h.ITEM_VISUALIZATION:t="Visualization",n="Visualizations",i="visualization",r="Visualization"}var a="list_"+n.toLowerCase()+"_for_selection";return{singular:t,plural:n,controller:i,iclass:r,list_ajax_url:list_objects_url.replace("LIST_ACTION",a)}}function a(t,n,i){var r=set_accessible_url.replace("ITEM_CONTROLLER",t);e.ajax({type:"POST",url:r,data:{id:n,accessible:"True"},error:function(){alert("Making "+i+" accessible failed")}})}function o(){e(document).ajaxError(function(e,t){var n=t.responseText||t.statusText||"Could not connect to server";return show_modal("Server error",n,{"Ignore error":hide_modal}),!1}),e("[name=page_content]").wymeditor({skin:"galaxy",basePath:editor_base_path,iframeBasePath:iframe_base_path,boxHtml:"<table class='wym_box' width='100%' height='100%'><tr><td><div class='wym_area_top'>"+u.TOOLS+"</div></td></tr><tr height='100%'><td><div class='wym_area_main' style='height: 100%;'>"+u.IFRAME+u.STATUS+"</div></div></td></tr></table>",toolsItems:[{name:"Bold",title:"Strong",css:"wym_tools_strong"},{name:"Italic",title:"Emphasis",css:"wym_tools_emphasis"},{name:"Superscript",title:(0,l.default)("Superscript"),css:"wym_tools_superscript"},{name:"Subscript",title:(0,l.default)("Subscript"),css:"wym_tools_subscript"},{name:"InsertOrderedList",title:"Ordered_List",css:"wym_tools_ordered_list"},{name:"InsertUnorderedList",title:"Unordered_List",css:"wym_tools_unordered_list"},{name:"Indent",title:"Indent",css:"wym_tools_indent"},{name:"Outdent",title:"Outdent",css:"wym_tools_outdent"},{name:"Undo",title:"Undo",css:"wym_tools_undo"},{name:"Redo",title:"Redo",css:"wym_tools_redo"},{name:"CreateLink",title:"Link",css:"wym_tools_link"},{name:"Unlink",title:"Unlink",css:"wym_tools_unlink"},{name:"InsertImage",title:"Image",css:"wym_tools_image"},{name:"InsertTable",title:"Table",css:"wym_tools_table"}]});var t=e.wymeditors(0),n=function(n){show_modal("Saving page","progress"),e.ajax({url:save_url,type:"POST",data:{id:page_id,content:t.xhtml(),annotations:JSON.stringify(new Object),_:"true"},success:function(){n()}})};e("#save-button").click(function(){n(function(){hide_modal()})}),e("#close-button").click(function(){window.document.location=page_list_url});var i=e("<div class='galaxy-page-editor-button'><a id='insert-galaxy-link' class='action-button popup' href='#'>Paragraph type</a></div>");e(".wym_area_top").append(i);var r={};e.each(t._options.containersItems,function(e,n){var i=n.name;r[n.title.replace("_"," ")]=function(){t.container(i)}}),make_popupmenu(i,r);var a=e("<div><a id='insert-galaxy-link' class='action-button popup' href='#'>Insert Link to Galaxy Object</a></div>").addClass("galaxy-page-editor-button");e(".wym_area_top").append(a),make_popupmenu(a,{"Insert History Link":function(){t.dialog(h.DIALOG_HISTORY_LINK)},"Insert Dataset Link":function(){t.dialog(h.DIALOG_DATASET_LINK)},"Insert Workflow Link":function(){t.dialog(h.DIALOG_WORKFLOW_LINK)},"Insert Page Link":function(){t.dialog(h.DIALOG_PAGE_LINK)},"Insert Visualization Link":function(){t.dialog(h.DIALOG_VISUALIZATION_LINK)}});var o=e("<div><a id='embed-galaxy-object' class='action-button popup' href='#'>Embed Galaxy Object</a></div>").addClass("galaxy-page-editor-button");e(".wym_area_top").append(o),make_popupmenu(o,{"Embed History":function(){t.dialog(h.DIALOG_EMBED_HISTORY)},"Embed Dataset":function(){t.dialog(h.DIALOG_EMBED_DATASET)},"Embed Workflow":function(){t.dialog(h.DIALOG_EMBED_WORKFLOW)},"Embed Visualization":function(){t.dialog(h.DIALOG_EMBED_VISUALIZATION)}})}Object.defineProperty(t,"__esModule",{value:!0}),t.default=o;var s=n(3),l=i(s);n(77),n(107),n(334),n(101);var c=n(26),d=i(c),u=window.WYMeditor,h={ITEM_HISTORY:"item_history",ITEM_DATASET:"item_dataset",ITEM_WORKFLOW:"item_workflow",ITEM_PAGE:"item_page",ITEM_VISUALIZATION:"item_visualization",DIALOG_HISTORY_LINK:"link_history",DIALOG_DATASET_LINK:"link_dataset",DIALOG_WORKFLOW_LINK:"link_workflow",DIALOG_PAGE_LINK:"link_page",DIALOG_VISUALIZATION_LINK:"link_visualization",DIALOG_EMBED_HISTORY:"embed_history",DIALOG_EMBED_DATASET:"embed_dataset",DIALOG_EMBED_WORKFLOW:"embed_workflow",DIALOG_EMBED_PAGE:"embed_page",DIALOG_EMBED_VISUALIZATION:"embed_visualization"};u.editor.prototype.dialog=function(t,n,i){function o(){e("#set_link_id").click(function(){e("#link_attribute_label").text("ID/Name");var t=e(".wym_href");t.addClass("wym_id").removeClass("wym_href"),c&&t.val(e(c).attr("id")),e(this).remove()})}var s=this,l=s.uniqueStamp(),c=s.selected();if(t==u.DIALOG_LINK){c&&(e(s._options.hrefSelector).val(e(c).attr(u.HREF)),e(s._options.srcSelector).val(e(c).attr(u.SRC)),e(s._options.titleSelector).val(e(c).attr(u.TITLE)),e(s._options.altSelector).val(e(c).attr(u.ALT)));var f,p;c&&(f=e(c).attr("href"),void 0==f&&(f=""),void 0==(p=e(c).attr("title"))&&(p="")),show_modal("Create Link","<div><div><label id='link_attribute_label'>URL <span style='float: right; font-size: 90%'><a href='#' id='set_link_id'>Create in-page anchor</a></span></label><br><input type='text' class='wym_href' value='"+f+"' size='40' /></div><div><label>Title</label><br><input type='text' class='wym_title' value='"+p+"' size='40' /></div><div>",{"Make link":function(){var t=e(s._options.hrefSelector).val()||"",n=e(".wym_id").val()||"",i=e(s._options.titleSelector).val()||"";if(t||n){s._exec(u.CREATE_LINK,l);var r=e("a[href="+l+"]",s._doc.body);r.attr(u.HREF,t).attr(u.TITLE,i).attr("id",n),0===r.text().indexOf("wym-")&&r.text(i)}hide_modal()},Cancel:function(){hide_modal()}},{},o)}if(t==u.DIALOG_IMAGE)return s._selected_image&&(e(s._options.dialogImageSelector+" "+s._options.srcSelector).val(e(s._selected_image).attr(u.SRC)),e(s._options.dialogImageSelector+" "+s._options.titleSelector).val(e(s._selected_image).attr(u.TITLE)),e(s._options.dialogImageSelector+" "+s._options.altSelector).val(e(s._selected_image).attr(u.ALT))),void show_modal("Image","<div class='row'><label>URL</label><br><input type='text' class='wym_src' value='' size='40' /></div><div class='row'><label>Alt text</label><br><input type='text' class='wym_alt' value='' size='40' /></div><div class='row'><label>Title</label><br><input type='text' class='wym_title' value='' size='40' /></div>",{Insert:function(){var t=e(s._options.srcSelector).val();t.length>0&&(s._exec(u.INSERT_IMAGE,l),e("img[src$="+l+"]",s._doc.body).attr(u.SRC,t).attr(u.TITLE,e(s._options.titleSelector).val()).attr(u.ALT,e(s._options.altSelector).val())),hide_modal()},Cancel:function(){hide_modal()}});if(t==u.DIALOG_TABLE&&show_modal("Table","<div class='row'><label>Caption</label><br><input type='text' class='wym_caption' value='' size='40' /></div><div class='row'><label>Summary</label><br><input type='text' class='wym_summary' value='' size='40' /></div><div class='row'><label>Number Of Rows<br></label><input type='text' class='wym_rows' value='3' size='3' /></div><div class='row'><label>Number Of Cols<br></label><input type='text' class='wym_cols' value='2' size='3' /></div>",{Insert:function(){var t=e(s._options.rowsSelector).val(),n=e(s._options.colsSelector).val();if(t>0&&n>0){var i=s._doc.createElement(u.TABLE),r=null,a=e(s._options.captionSelector).val();i.createCaption().innerHTML=a;for(var o=0;o<t;o++){r=i.insertRow(o);for(var l=0;l<n;l++)r.insertCell(l)}e(i).attr("summary",e(s._options.summarySelector).val());var c=e(s.findUp(s.container(),u.MAIN_CONTAINERS)).get(0);c&&c.parentNode?e(c).after(i):e(s._doc.body).append(i)}hide_modal()},Cancel:function(){hide_modal()}}),t==h.DIALOG_HISTORY_LINK||t==h.DIALOG_DATASET_LINK||t==h.DIALOG_WORKFLOW_LINK||t==h.DIALOG_PAGE_LINK||t==h.DIALOG_VISUALIZATION_LINK){var g;switch(t){case h.DIALOG_HISTORY_LINK:g=r(h.ITEM_HISTORY);break;case h.DIALOG_DATASET_LINK:g=r(h.ITEM_DATASET);break;case h.DIALOG_WORKFLOW_LINK:g=r(h.ITEM_WORKFLOW);break;case h.DIALOG_PAGE_LINK:g=r(h.ITEM_PAGE);break;case h.DIALOG_VISUALIZATION_LINK:g=r(h.ITEM_VISUALIZATION)}var m=new d.default({url_base:g.list_ajax_url,embedded:!0});Galaxy.modal.show({title:"Insert Link to "+g.singular,body:e("<div/>").append(m.$el).append(e("<div/>").append('<input id="make-importable" type="checkbox" checked/>').append("Make the selected "+g.plural.toLowerCase()+" accessible so that they can viewed by everyone.")),closing_events:!0,buttons:{Insert:function(){var t=!1;null!=e("#make-importable:checked").val()&&(t=!0);new Array;m.$("input[name=id]:checked").each(function(){var n=e(this).val();t&&a(g.controller,n,g.singular);var i=get_name_and_link_url+n,r=i.replace("ITEM_CONTROLLER",g.controller);e.getJSON(r,function(t){s._exec(u.CREATE_LINK,l);var i=e("a[href="+l+"]",s._doc.body).text();""==i||i==l?s.insert("<a href='"+t.link+"'>"+g.singular+" '"+t.name+"'</a>"):e("a[href="+l+"]",s._doc.body).attr(u.HREF,t.link).attr(u.TITLE,g.singular+n)})}),Galaxy.modal.hide()},Close:function(){Galaxy.modal.hide()}}})}if(t==h.DIALOG_EMBED_HISTORY||t==h.DIALOG_EMBED_DATASET||t==h.DIALOG_EMBED_WORKFLOW||t==h.DIALOG_EMBED_PAGE||t==h.DIALOG_EMBED_VISUALIZATION){var g;switch(t){case h.DIALOG_EMBED_HISTORY:g=r(h.ITEM_HISTORY);break;case h.DIALOG_EMBED_DATASET:g=r(h.ITEM_DATASET);break;case h.DIALOG_EMBED_WORKFLOW:g=r(h.ITEM_WORKFLOW);break;case h.DIALOG_EMBED_PAGE:g=r(h.ITEM_PAGE);break;case h.DIALOG_EMBED_VISUALIZATION:g=r(h.ITEM_VISUALIZATION)}var m=new d.default({url_base:g.list_ajax_url,embedded:!0});Galaxy.modal.show({title:"Insert Link to "+g.singular,body:e("<div/>").append(m.$el).append(e("<div/>").append('<input id="make-importable" type="checkbox" checked/>').append("Make the selected "+g.plural.toLowerCase()+" accessible so that they can viewed by everyone.")),closing_events:!0,buttons:{Embed:function(){var t=!1;null!=e("#make-importable:checked").val()&&(t=!0),m.$("input[name=id]:checked").each(function(){var n=e(this).val(),i=e("label[for='"+n+"']:first").text();t&&a(g.controller,n,g.singular);var r=g.iclass+"-"+n,o=["<div id='",r,"' class='embedded-item ",g.singular.toLowerCase()," placeholder'>","<p class='title'>","Embedded Galaxy ",g.singular," '",i,"'","</p>","<p class='content'>","[Do not edit this block; Galaxy will fill it in with the annotated ",g.singular.toLowerCase()," when it is displayed.]","</p>","</div>"].join("");s.insert(o)}),Galaxy.modal.hide()},Close:function(){Galaxy.modal.hide()}}})}}}).call(t,n(0))},function(module,exports,__webpack_require__){(function(jQuery,$){if(!WYMeditor)var WYMeditor={};!function(){if(window.console&&console.firebug)WYMeditor.console=window.console;else{var e=["log","debug","info","warn","error","assert","dir","dirxml","group","groupEnd","time","timeEnd","count","trace","profile","profileEnd"];WYMeditor.console={};for(var t=0;t<e.length;++t)WYMeditor.console[e[t]]=function(){}}}(),jQuery.extend(WYMeditor,{VERSION:"0.5-rc1",INSTANCES:[],STRINGS:[],SKINS:[],NAME:"name",INDEX:"{Wym_Index}",WYM_INDEX:"wym_index",BASE_PATH:"{Wym_Base_Path}",CSS_PATH:"{Wym_Css_Path}",WYM_PATH:"{Wym_Wym_Path}",SKINS_DEFAULT_PATH:"skins/",SKINS_DEFAULT_CSS:"skin.css",SKINS_DEFAULT_JS:"skin.js",LANG_DEFAULT_PATH:"lang/",IFRAME_BASE_PATH:"{Wym_Iframe_Base_Path}",IFRAME_DEFAULT:"iframe/default/",JQUERY_PATH:"{Wym_Jquery_Path}",DIRECTION:"{Wym_Direction}",LOGO:"{Wym_Logo}",TOOLS:"{Wym_Tools}",TOOLS_ITEMS:"{Wym_Tools_Items}",TOOL_NAME:"{Wym_Tool_Name}",TOOL_TITLE:"{Wym_Tool_Title}",TOOL_CLASS:"{Wym_Tool_Class}",CLASSES:"{Wym_Classes}",CLASSES_ITEMS:"{Wym_Classes_Items}",CLASS_NAME:"{Wym_Class_Name}",CLASS_TITLE:"{Wym_Class_Title}",CONTAINERS:"{Wym_Containers}",CONTAINERS_ITEMS:"{Wym_Containers_Items}",CONTAINER_NAME:"{Wym_Container_Name}",CONTAINER_TITLE:"{Wym_Containers_Title}",CONTAINER_CLASS:"{Wym_Container_Class}",HTML:"{Wym_Html}",IFRAME:"{Wym_Iframe}",STATUS:"{Wym_Status}",DIALOG_TITLE:"{Wym_Dialog_Title}",DIALOG_BODY:"{Wym_Dialog_Body}",STRING:"string",BODY:"body",DIV:"div",P:"p",H1:"h1",H2:"h2",H3:"h3",H4:"h4",H5:"h5",H6:"h6",PRE:"pre",BLOCKQUOTE:"blockquote",A:"a",BR:"br",IMG:"img",TABLE:"table",TD:"td",TH:"th",UL:"ul",OL:"ol",LI:"li",CLASS:"class",HREF:"href",SRC:"src",TITLE:"title",ALT:"alt",DIALOG_LINK:"Link",DIALOG_IMAGE:"Image",DIALOG_TABLE:"Table",DIALOG_PASTE:"Paste_From_Word",BOLD:"Bold",ITALIC:"Italic",CREATE_LINK:"CreateLink",INSERT_IMAGE:"InsertImage",INSERT_TABLE:"InsertTable",INSERT_HTML:"InsertHTML",PASTE:"Paste",INDENT:"Indent",OUTDENT:"Outdent",TOGGLE_HTML:"ToggleHtml",FORMAT_BLOCK:"FormatBlock",PREVIEW:"Preview",UNLINK:"Unlink",INSERT_UNORDEREDLIST:"InsertUnorderedList",INSERT_ORDEREDLIST:"InsertOrderedList",MAIN_CONTAINERS:new Array("p","h1","h2","h3","h4","h5","h6","pre","blockquote"),BLOCKS:new Array("address","blockquote","div","dl","fieldset","form","h1","h2","h3","h4","h5","h6","hr","noscript","ol","p","pre","table","ul","dd","dt","li","tbody","td","tfoot","th","thead","tr"),KEY:{BACKSPACE:8,ENTER:13,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,CURSOR:new Array(37,38,39,40),DELETE:46},NODE:{ELEMENT:1,ATTRIBUTE:2,TEXT:3},editor:function(e,t){this._index=WYMeditor.INSTANCES.push(this)-1,this._element=e,this._options=t,this._html=jQuery(e).val(),this._options.html&&(this._html=this._options.html),this._options.basePath=this._options.basePath||this.computeBasePath(),this._options.skinPath=this._options.skinPath||this._options.basePath+WYMeditor.SKINS_DEFAULT_PATH+this._options.skin+"/",this._options.wymPath=this._options.wymPath||this.computeWymPath(),this._options.langPath=this._options.langPath||this._options.basePath+WYMeditor.LANG_DEFAULT_PATH,this._options.iframeBasePath=this._options.iframeBasePath||this._options.basePath+WYMeditor.IFRAME_DEFAULT,this._options.jQueryPath=this._options.jQueryPath||this.computeJqueryPath(),this.init()}}),jQuery.fn.wymeditor=function(e){return e=jQuery.extend({html:"",basePath:!1,skinPath:!1,wymPath:!1,iframeBasePath:!1,jQueryPath:!1,styles:!1,stylesheet:!1,skin:"default",initSkin:!0,loadSkin:!0,lang:"en",direction:"ltr",boxHtml:"<div class='wym_box'><div class='wym_area_top'>"+WYMeditor.TOOLS+"</div><div class='wym_area_left'></div><div class='wym_area_right'>"+WYMeditor.CONTAINERS+WYMeditor.CLASSES+"</div><div class='wym_area_main'>"+WYMeditor.HTML+WYMeditor.IFRAME+WYMeditor.STATUS+"</div><div class='wym_area_bottom'>"+WYMeditor.LOGO+"</div></div>",logoHtml:"<a class='wym_wymeditor_link' href='http://www.wymeditor.org/'>WYMeditor</a>",iframeHtml:"<div class='wym_iframe wym_section'><iframe src='/page/get_editor_iframe' onload='this.contentWindow.parent.WYMeditor.INSTANCES["+WYMeditor.INDEX+"].initIframe(this)'></iframe></div>",editorStyles:[],toolsHtml:"<div class='wym_tools wym_section'><h2>{Tools}</h2><ul>"+WYMeditor.TOOLS_ITEMS+"</ul></div>",toolsItemHtml:"<li class='"+WYMeditor.TOOL_CLASS+"'><a href='#' name='"+WYMeditor.TOOL_NAME+"' title='"+WYMeditor.TOOL_TITLE+"'>"+WYMeditor.TOOL_TITLE+"</a></li>",toolsItems:[{name:"Bold",title:"Strong",css:"wym_tools_strong"},{name:"Italic",title:"Emphasis",css:"wym_tools_emphasis"},{name:"Superscript",title:"Superscript",css:"wym_tools_superscript"},{name:"Subscript",title:"Subscript",css:"wym_tools_subscript"},{name:"InsertOrderedList",title:"Ordered_List",css:"wym_tools_ordered_list"},{name:"InsertUnorderedList",title:"Unordered_List",css:"wym_tools_unordered_list"},{name:"Indent",title:"Indent",css:"wym_tools_indent"},{name:"Outdent",title:"Outdent",css:"wym_tools_outdent"},{name:"Undo",title:"Undo",css:"wym_tools_undo"},{name:"Redo",title:"Redo",css:"wym_tools_redo"},{name:"CreateLink",title:"Link",css:"wym_tools_link"},{name:"Unlink",title:"Unlink",css:"wym_tools_unlink"},{name:"InsertImage",title:"Image",css:"wym_tools_image"},{name:"InsertTable",title:"Table",css:"wym_tools_table"},{name:"Paste",title:"Paste_From_Word",css:"wym_tools_paste"},{name:"ToggleHtml",title:"HTML",css:"wym_tools_html"},{name:"Preview",title:"Preview",css:"wym_tools_preview"}],containersHtml:"<div class='wym_containers wym_section'><h2>{Containers}</h2><ul>"+WYMeditor.CONTAINERS_ITEMS+"</ul></div>",containersItemHtml:"<li class='"+WYMeditor.CONTAINER_CLASS+"'><a href='#' name='"+WYMeditor.CONTAINER_NAME+"'>"+WYMeditor.CONTAINER_TITLE+"</a></li>",containersItems:[{name:"P",title:"Paragraph",css:"wym_containers_p"},{name:"H1",title:"Heading_1",css:"wym_containers_h1"},{name:"H2",title:"Heading_2",css:"wym_containers_h2"},{name:"H3",title:"Heading_3",css:"wym_containers_h3"},{name:"H4",title:"Heading_4",css:"wym_containers_h4"},{name:"H5",title:"Heading_5",css:"wym_containers_h5"},{name:"H6",title:"Heading_6",css:"wym_containers_h6"},{name:"PRE",title:"Preformatted",css:"wym_containers_pre"},{name:"BLOCKQUOTE",title:"Blockquote",css:"wym_containers_blockquote"},{name:"TH",title:"Table_Header",css:"wym_containers_th"}],classesHtml:"<div class='wym_classes wym_section'><h2>{Classes}</h2><ul>"+WYMeditor.CLASSES_ITEMS+"</ul></div>",classesItemHtml:"<li><a href='#' name='"+WYMeditor.CLASS_NAME+"'>"+WYMeditor.CLASS_TITLE+"</a></li>",classesItems:[],statusHtml:"<div class='wym_status wym_section'><h2>{Status}</h2></div>",htmlHtml:"<div class='wym_html wym_section'><h2>{Source_Code}</h2><textarea class='wym_html_val'></textarea></div>",boxSelector:".wym_box",toolsSelector:".wym_tools",toolsListSelector:" ul",containersSelector:".wym_containers",classesSelector:".wym_classes",htmlSelector:".wym_html",iframeSelector:".wym_iframe iframe",iframeBodySelector:".wym_iframe",statusSelector:".wym_status",toolSelector:".wym_tools a",containerSelector:".wym_containers a",classSelector:".wym_classes a",htmlValSelector:".wym_html_val",hrefSelector:".wym_href",srcSelector:".wym_src",titleSelector:".wym_title",altSelector:".wym_alt",textSelector:".wym_text",rowsSelector:".wym_rows",colsSelector:".wym_cols",captionSelector:".wym_caption",summarySelector:".wym_summary",submitSelector:".wym_submit",cancelSelector:".wym_cancel",previewSelector:"",dialogTypeSelector:".wym_dialog_type",dialogLinkSelector:".wym_dialog_link",dialogImageSelector:".wym_dialog_image",dialogTableSelector:".wym_dialog_table",dialogPasteSelector:".wym_dialog_paste",dialogPreviewSelector:".wym_dialog_preview",updateSelector:".wymupdate",updateEvent:"click",dialogFeatures:"menubar=no,titlebar=no,toolbar=no,resizable=no,width=560,height=300,top=0,left=0",dialogFeaturesPreview:"menubar=no,titlebar=no,toolbar=no,resizable=no,scrollbars=yes,width=560,height=300,top=0,left=0",dialogHtml:"<!DOCTYPE html PUBLIC '-//W3C//DTD XHTML 1.0 Strict//EN' 'http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd'><html dir='"+WYMeditor.DIRECTION+"'><head><link rel='stylesheet' type='text/css' media='screen' href='"+WYMeditor.CSS_PATH+"' /><title>"+WYMeditor.DIALOG_TITLE+"</title><script type='text/javascript' src='"+WYMeditor.JQUERY_PATH+"'><\/script><script type='text/javascript' src='"+WYMeditor.WYM_PATH+"'><\/script></head>"+WYMeditor.DIALOG_BODY+"</html>",dialogLinkHtml:"<body class='wym_dialog wym_dialog_link' onload='WYMeditor.INIT_DIALOG("+WYMeditor.INDEX+")'><form><fieldset><input type='hidden' class='wym_dialog_type' value='"+WYMeditor.DIALOG_LINK+"' /><legend>{Link}</legend><div class='row'><label>{URL}</label><input type='text' class='wym_href' value='' size='40' /></div><div class='row'><label>{Title}</label><input type='text' class='wym_title' value='' size='40' /></div><div class='row row-indent'><input class='wym_submit' type='button' value='{Submit}' /><input class='wym_cancel' type='button'value='{Cancel}' /></div></fieldset></form></body>",dialogImageHtml:"<body class='wym_dialog wym_dialog_image' onload='WYMeditor.INIT_DIALOG("+WYMeditor.INDEX+")'><form><fieldset><input type='hidden' class='wym_dialog_type' value='"+WYMeditor.DIALOG_IMAGE+"' /><legend>{Image}</legend><div class='row'><label>{URL}</label><input type='text' class='wym_src' value='' size='40' /></div><div class='row'><label>{Alternative_Text}</label><input type='text' class='wym_alt' value='' size='40' /></div><div class='row'><label>{Title}</label><input type='text' class='wym_title' value='' size='40' /></div><div class='row row-indent'><input class='wym_submit' type='button' value='{Submit}' /><input class='wym_cancel' type='button'value='{Cancel}' /></div></fieldset></form></body>",dialogTableHtml:"<body class='wym_dialog wym_dialog_table' onload='WYMeditor.INIT_DIALOG("+WYMeditor.INDEX+")'><form><fieldset><input type='hidden' class='wym_dialog_type' value='"+WYMeditor.DIALOG_TABLE+"' /><legend>{Table}</legend><div class='row'><label>{Caption}</label><input type='text' class='wym_caption' value='' size='40' /></div><div class='row'><label>{Summary}</label><input type='text' class='wym_summary' value='' size='40' /></div><div class='row'><label>{Number_Of_Rows}</label><input type='text' class='wym_rows' value='3' size='3' /></div><div class='row'><label>{Number_Of_Cols}</label><input type='text' class='wym_cols' value='2' size='3' /></div><div class='row row-indent'><input class='wym_submit' type='button' value='{Submit}' /><input class='wym_cancel' type='button'value='{Cancel}' /></div></fieldset></form></body>",dialogPasteHtml:"<body class='wym_dialog wym_dialog_paste' onload='WYMeditor.INIT_DIALOG("+WYMeditor.INDEX+")'><form><input type='hidden' class='wym_dialog_type' value='"+WYMeditor.DIALOG_PASTE+"' /><fieldset><legend>{Paste_From_Word}</legend><div class='row'><textarea class='wym_text' rows='10' cols='50'></textarea></div><div class='row'><input class='wym_submit' type='button' value='{Submit}' /><input class='wym_cancel' type='button'value='{Cancel}' /></div></fieldset></form></body>",dialogPreviewHtml:"<body class='wym_dialog wym_dialog_preview' onload='WYMeditor.INIT_DIALOG("+WYMeditor.INDEX+")'></body>",dialogStyles:[],stringDelimiterLeft:"{",stringDelimiterRight:"}",preInit:null,preBind:null,postInit:null,preInitDialog:null,postInitDialog:null},e),this.each(function(){new WYMeditor.editor(jQuery(this),e)})},jQuery.extend({wymeditors:function(e){return WYMeditor.INSTANCES[e]}}),WYMeditor.editor.prototype.init=function(){if(jQuery.browser.msie)var WymClass=new WYMeditor.WymClassExplorer(this);else if(jQuery.browser.mozilla)var WymClass=new WYMeditor.WymClassMozilla(this);else if(jQuery.browser.opera)var WymClass=new WYMeditor.WymClassOpera(this);else if(jQuery.browser.safari||jQuery.browser.chrome)var WymClass=new WYMeditor.WymClassSafari(this);if(WymClass){jQuery.isFunction(this._options.preInit)&&this._options.preInit(this);var SaxListener=new WYMeditor.XhtmlSaxListener;jQuery.extend(SaxListener,WymClass),this.parser=new WYMeditor.XhtmlParser(SaxListener),(this._options.styles||this._options.stylesheet)&&this.configureEditorUsingRawCss(),this.helper=new WYMeditor.XmlHelper;for(var prop in WymClass)this[prop]=WymClass[prop];this._box=jQuery(this._element).hide().after(this._options.boxHtml).next().addClass("wym_box_"+this._index),jQuery.isFunction(jQuery.fn.data)&&(jQuery.data(this._box.get(0),WYMeditor.WYM_INDEX,this._index),jQuery.data(this._element.get(0),WYMeditor.WYM_INDEX,this._index));var h=WYMeditor.Helper,iframeHtml=this._options.iframeHtml;iframeHtml=h.replaceAll(iframeHtml,WYMeditor.INDEX,this._index),iframeHtml=h.replaceAll(iframeHtml,WYMeditor.IFRAME_BASE_PATH,this._options.iframeBasePath);var boxHtml=jQuery(this._box).html();boxHtml=h.replaceAll(boxHtml,WYMeditor.LOGO,this._options.logoHtml),boxHtml=h.replaceAll(boxHtml,WYMeditor.TOOLS,this._options.toolsHtml),boxHtml=h.replaceAll(boxHtml,WYMeditor.CONTAINERS,this._options.containersHtml),boxHtml=h.replaceAll(boxHtml,WYMeditor.CLASSES,this._options.classesHtml),boxHtml=h.replaceAll(boxHtml,WYMeditor.HTML,this._options.htmlHtml),boxHtml=h.replaceAll(boxHtml,WYMeditor.IFRAME,iframeHtml),boxHtml=h.replaceAll(boxHtml,WYMeditor.STATUS,this._options.statusHtml);for(var aTools=eval(this._options.toolsItems),sTools="",i=0;i<aTools.length;i++){var oTool=aTools[i];if(oTool.name&&oTool.title)var sTool=this._options.toolsItemHtml;var sTool=h.replaceAll(sTool,WYMeditor.TOOL_NAME,oTool.name);sTool=h.replaceAll(sTool,WYMeditor.TOOL_TITLE,this._options.stringDelimiterLeft+oTool.title+this._options.stringDelimiterRight),sTool=h.replaceAll(sTool,WYMeditor.TOOL_CLASS,oTool.css),sTools+=sTool}boxHtml=h.replaceAll(boxHtml,WYMeditor.TOOLS_ITEMS,sTools);for(var aClasses=eval(this._options.classesItems),sClasses="",i=0;i<aClasses.length;i++){var oClass=aClasses[i];if(oClass.name&&oClass.title)var sClass=this._options.classesItemHtml;sClass=h.replaceAll(sClass,WYMeditor.CLASS_NAME,oClass.name),sClass=h.replaceAll(sClass,WYMeditor.CLASS_TITLE,oClass.title),sClasses+=sClass}boxHtml=h.replaceAll(boxHtml,WYMeditor.CLASSES_ITEMS,sClasses);for(var aContainers=eval(this._options.containersItems),sContainers="",i=0;i<aContainers.length;i++){var oContainer=aContainers[i];if(oContainer.name&&oContainer.title)var sContainer=this._options.containersItemHtml;sContainer=h.replaceAll(sContainer,WYMeditor.CONTAINER_NAME,oContainer.name),sContainer=h.replaceAll(sContainer,WYMeditor.CONTAINER_TITLE,this._options.stringDelimiterLeft+oContainer.title+this._options.stringDelimiterRight),sContainer=h.replaceAll(sContainer,WYMeditor.CONTAINER_CLASS,oContainer.css),sContainers+=sContainer}boxHtml=h.replaceAll(boxHtml,WYMeditor.CONTAINERS_ITEMS,sContainers),boxHtml=this.replaceStrings(boxHtml),jQuery(this._box).html(boxHtml),jQuery(this._box).find(this._options.htmlSelector).hide(),this.loadSkin()}},WYMeditor.editor.prototype.bindEvents=function(){var wym=this;jQuery(this._box).find(this._options.toolSelector).click(function(){return wym._iframe.contentWindow.focus(),wym.exec(jQuery(this).attr(WYMeditor.NAME)),!1}),jQuery(this._box).find(this._options.containerSelector).click(function(){return wym.container(jQuery(this).attr(WYMeditor.NAME)),!1}),jQuery(this._box).find(this._options.htmlValSelector).keyup(function(){jQuery(wym._doc.body).html(jQuery(this).val())}).focus(function(){jQuery(this).toggleClass("hasfocus")}).blur(function(){jQuery(this).toggleClass("hasfocus")}),jQuery(this._box).find(this._options.classSelector).click(function(){var aClasses=eval(wym._options.classesItems),sName=jQuery(this).attr(WYMeditor.NAME),oClass=WYMeditor.Helper.findByName(aClasses,sName);if(oClass){var jqexpr=oClass.expr;wym.toggleClass(sName,jqexpr)}return wym._iframe.contentWindow.focus(),!1}),jQuery(this._options.updateSelector).bind(this._options.updateEvent,function(){wym.update()})},WYMeditor.editor.prototype.ready=function(){return null!=this._doc},WYMeditor.editor.prototype.box=function(){return this._box},WYMeditor.editor.prototype.html=function(e){if("string"!=typeof e)return jQuery(this._doc.body).html();jQuery(this._doc.body).html(e)},WYMeditor.editor.prototype.xhtml=function(){return this.parser.parse(this.html())},WYMeditor.editor.prototype.exec=function(e){switch(e){case WYMeditor.CREATE_LINK:(this.container()||this._selected_image)&&this.dialog(WYMeditor.DIALOG_LINK);break;case WYMeditor.INSERT_IMAGE:this.dialog(WYMeditor.DIALOG_IMAGE);break;case WYMeditor.INSERT_TABLE:this.dialog(WYMeditor.DIALOG_TABLE);break;case WYMeditor.PASTE:this.dialog(WYMeditor.DIALOG_PASTE);break;case WYMeditor.TOGGLE_HTML:this.update(),this.toggleHtml(),jQuery(this._box).find(this._options.htmlSelector).is(":visible")||this.listen();break;case WYMeditor.PREVIEW:this.dialog(WYMeditor.PREVIEW,this._options.dialogFeaturesPreview);break;default:this._exec(e)}},WYMeditor.editor.prototype.container=function(e){if(!e)return this.selected();var t=null;if(e.toLowerCase()==WYMeditor.TH){switch(t=this.container(),t.tagName.toLowerCase()){case WYMeditor.TD:case WYMeditor.TH:break;default:var n=new Array(WYMeditor.TD,WYMeditor.TH);t=this.findUp(this.container(),n)}null!=t&&(e=t.tagName.toLowerCase()==WYMeditor.TD?WYMeditor.TH:WYMeditor.TD,this.switchTo(t,e),this.update())}else{var n=new Array(WYMeditor.P,WYMeditor.H1,WYMeditor.H2,WYMeditor.H3,WYMeditor.H4,WYMeditor.H5,WYMeditor.H6,WYMeditor.PRE,WYMeditor.BLOCKQUOTE);if(t=this.findUp(this.container(),n)){var i=null;if(e.toLowerCase()==WYMeditor.BLOCKQUOTE){var r=this.findUp(this.container(),WYMeditor.BLOCKQUOTE);if(null==r)i=this._doc.createElement(e),t.parentNode.insertBefore(i,t),i.appendChild(t),this.setFocusToNode(i.firstChild);else{var a=r.childNodes,o=a.length,s=null;o>0&&(s=a.item(0));for(var l=0;l<o;l++)r.parentNode.insertBefore(a.item(0),r);r.parentNode.removeChild(r),s&&this.setFocusToNode(s)}}else this.switchTo(t,e);this.update()}}},WYMeditor.editor.prototype.toggleClass=function(e,t){var n=this._selected_image?this._selected_image:jQuery(this.selected());n=jQuery(n).parentsOrSelf(t),jQuery(n).toggleClass(e),jQuery(n).attr(WYMeditor.CLASS)||jQuery(n).removeAttr(this._class)},WYMeditor.editor.prototype.findUp=function(e,t){if(e){var n=e.tagName.toLowerCase();if(typeof t==WYMeditor.STRING)for(;n!=t&&n!=WYMeditor.BODY;)e=e.parentNode,n=e.tagName.toLowerCase();else for(var i=!1;!i&&n!=WYMeditor.BODY;){for(var r=0;r<t.length;r++)if(n==t[r]){i=!0;break}i||(e=e.parentNode,n=e.tagName.toLowerCase())}return n!=WYMeditor.BODY?e:null}return null},WYMeditor.editor.prototype.switchTo=function(e,t){var n=this._doc.createElement(t),i=jQuery(e).html();e.parentNode.replaceChild(n,e),jQuery(n).html(i),this.setFocusToNode(n)},WYMeditor.editor.prototype.replaceStrings=function(sVal){if(!WYMeditor.STRINGS[this._options.lang])try{eval(jQuery.ajax({url:this._options.langPath+this._options.lang+".js",async:!1}).responseText)}catch(e){return WYMeditor.console.error("WYMeditor: error while parsing language file."),sVal}for(var key in WYMeditor.STRINGS[this._options.lang])sVal=WYMeditor.Helper.replaceAll(sVal,this._options.stringDelimiterLeft+key+this._options.stringDelimiterRight,WYMeditor.STRINGS[this._options.lang][key]);return sVal},WYMeditor.editor.prototype.encloseString=function(e){return this._options.stringDelimiterLeft+e+this._options.stringDelimiterRight},WYMeditor.editor.prototype.status=function(e){jQuery(this._box).find(this._options.statusSelector).html(e)},WYMeditor.editor.prototype.update=function(){var e=this.xhtml();jQuery(this._element).val(e),jQuery(this._box).find(this._options.htmlValSelector).not(".hasfocus").val(e)},WYMeditor.editor.prototype.dialog=function(e,t,n){var i=t||this._wym._options.dialogFeatures,r=window.open("","dialog",i);if(r){var a="";switch(e){case WYMeditor.DIALOG_LINK:a=this._options.dialogLinkHtml;break;case WYMeditor.DIALOG_IMAGE:a=this._options.dialogImageHtml;break;case WYMeditor.DIALOG_TABLE:a=this._options.dialogTableHtml;break;case WYMeditor.DIALOG_PASTE:a=this._options.dialogPasteHtml;break;case WYMeditor.PREVIEW:a=this._options.dialogPreviewHtml;break;default:a=n}var o=WYMeditor.Helper,s=this._options.dialogHtml;s=o.replaceAll(s,WYMeditor.BASE_PATH,this._options.basePath),s=o.replaceAll(s,WYMeditor.DIRECTION,this._options.direction),s=o.replaceAll(s,WYMeditor.CSS_PATH,this._options.skinPath+WYMeditor.SKINS_DEFAULT_CSS),s=o.replaceAll(s,WYMeditor.WYM_PATH,this._options.wymPath),s=o.replaceAll(s,WYMeditor.JQUERY_PATH,this._options.jQueryPath),s=o.replaceAll(s,WYMeditor.DIALOG_TITLE,this.encloseString(e)),s=o.replaceAll(s,WYMeditor.DIALOG_BODY,a),s=o.replaceAll(s,WYMeditor.INDEX,this._index),s=this.replaceStrings(s);var l=r.document;l.write(s),l.close()}},WYMeditor.editor.prototype.toggleHtml=function(){jQuery(this._box).find(this._options.htmlSelector).toggle()},WYMeditor.editor.prototype.uniqueStamp=function(){return"wym-"+(new Date).getTime()},WYMeditor.editor.prototype.paste=function(e){var t,n=this.selected(),i=e.split(this._newLine+this._newLine),r=new RegExp(this._newLine,"g");if(n&&n.tagName.toLowerCase()!=WYMeditor.BODY)for(x=i.length-1;x>=0;x--)t=i[x],t=t.replace(r,"<br />"),jQuery(n).after("<p>"+t+"</p>");else for(x=0;x<i.length;x++)t=i[x],t=t.replace(r,"<br />"),jQuery(this._doc.body).append("<p>"+t+"</p>")},WYMeditor.editor.prototype.insert=function(e){null!=this._iframe.contentWindow.getSelection().focusNode?this._exec(WYMeditor.INSERT_HTML,e):this.paste(e)},WYMeditor.editor.prototype.wrap=function(e,t){null!=this._iframe.contentWindow.getSelection().focusNode&&this._exec(WYMeditor.INSERT_HTML,e+this._iframe.contentWindow.getSelection().toString()+t)},WYMeditor.editor.prototype.unwrap=function(){null!=this._iframe.contentWindow.getSelection().focusNode&&this._exec(WYMeditor.INSERT_HTML,this._iframe.contentWindow.getSelection().toString())},WYMeditor.editor.prototype.addCssRules=function(e,t){var n=e.styleSheets[0];if(n)for(var i=0;i<t.length;i++){var r=t[i];r.name&&r.css&&this.addCssRule(n,r)}},WYMeditor.editor.prototype.computeBasePath=function(){return jQuery(jQuery.grep(jQuery("script"),function(e){return e.src&&e.src.match(/jquery\.wymeditor(\.pack|\.min|\.packed)?\.js(\?.*)?$/)})).attr("src").replace(/jquery\.wymeditor(\.pack|\.min|\.packed)?\.js(\?.*)?$/,"")},WYMeditor.editor.prototype.computeWymPath=function(){return jQuery(jQuery.grep(jQuery("script"),function(e){return e.src&&e.src.match(/jquery\.wymeditor(\.pack|\.min|\.packed)?\.js(\?.*)?$/)})).attr("src")},WYMeditor.editor.prototype.computeJqueryPath=function(){return jQuery(jQuery.grep(jQuery("script"),function(e){return e.src&&e.src.match(/jquery(-(.*)){0,1}(\.pack|\.min|\.packed)?\.js(\?.*)?$/)})).attr("src")},WYMeditor.editor.prototype.computeCssPath=function(){return jQuery(jQuery.grep(jQuery("link"),function(e){return e.href&&e.href.match(/wymeditor\/skins\/(.*)screen\.css(\?.*)?$/)})).attr("href")},WYMeditor.editor.prototype.configureEditorUsingRawCss=function(){var e=new WYMeditor.WymCssParser;this._options.stylesheet?e.parse(jQuery.ajax({url:this._options.stylesheet,async:!1}).responseText):e.parse(this._options.styles,!1),0==this._options.classesItems.length&&(this._options.classesItems=e.css_settings.classesItems),0==this._options.editorStyles.length&&(this._options.editorStyles=e.css_settings.editorStyles),0==this._options.dialogStyles.length&&(this._options.dialogStyles=e.css_settings.dialogStyles)},WYMeditor.editor.prototype.listen=function(){jQuery(this._doc.body).bind("mousedown",this.mousedown);for(var e=this._doc.body.getElementsByTagName("img"),t=0;t<e.length;t++)jQuery(e[t]).bind("mousedown",this.mousedown)},WYMeditor.editor.prototype.mousedown=function(e){WYMeditor.INSTANCES[this.ownerDocument.title]._selected_image=this.tagName.toLowerCase()==WYMeditor.IMG?this:null,e.stopPropagation()},WYMeditor.loadCss=function(e){var t=document.createElement("link");t.rel="stylesheet",t.href=e,jQuery("head").get(0).appendChild(t)},WYMeditor.editor.prototype.loadSkin=function(){if(this._options.loadSkin&&!WYMeditor.SKINS[this._options.skin]){var found=!1,rExp=new RegExp(this._options.skin+"/"+WYMeditor.SKINS_DEFAULT_CSS+"$");jQuery("link").each(function(){this.href.match(rExp)&&(found=!0)}),found||WYMeditor.loadCss(this._options.skinPath+WYMeditor.SKINS_DEFAULT_CSS)}jQuery(this._box).addClass("wym_skin_"+this._options.skin),this._options.initSkin&&!WYMeditor.SKINS[this._options.skin]&&eval(jQuery.ajax({url:this._options.skinPath+WYMeditor.SKINS_DEFAULT_JS,async:!1}).responseText),WYMeditor.SKINS[this._options.skin]&&WYMeditor.SKINS[this._options.skin].init&&WYMeditor.SKINS[this._options.skin].init(this)},WYMeditor.INIT_DIALOG=function(index){var wym=window.opener.WYMeditor.INSTANCES[index],doc=window.document,selected=wym.selected(),dialogType=jQuery(wym._options.dialogTypeSelector).val(),sStamp=wym.uniqueStamp();switch(dialogType){case WYMeditor.DIALOG_LINK:selected&&selected.tagName&&selected.tagName.toLowerCase!=WYMeditor.A&&(selected=jQuery(selected).parentsOrSelf(WYMeditor.A)),!selected&&wym._selected_image&&(selected=jQuery(wym._selected_image).parentsOrSelf(WYMeditor.A))}jQuery.isFunction(wym._options.preInitDialog)&&wym._options.preInitDialog(wym,window);var styles=doc.styleSheets[0],aCss=eval(wym._options.dialogStyles);wym.addCssRules(doc,aCss),selected&&(jQuery(wym._options.hrefSelector).val(jQuery(selected).attr(WYMeditor.HREF)),jQuery(wym._options.srcSelector).val(jQuery(selected).attr(WYMeditor.SRC)),jQuery(wym._options.titleSelector).val(jQuery(selected).attr(WYMeditor.TITLE)),jQuery(wym._options.altSelector).val(jQuery(selected).attr(WYMeditor.ALT))),wym._selected_image&&(jQuery(wym._options.dialogImageSelector+" "+wym._options.srcSelector).val(jQuery(wym._selected_image).attr(WYMeditor.SRC)),jQuery(wym._options.dialogImageSelector+" "+wym._options.titleSelector).val(jQuery(wym._selected_image).attr(WYMeditor.TITLE)),jQuery(wym._options.dialogImageSelector+" "+wym._options.altSelector).val(jQuery(wym._selected_image).attr(WYMeditor.ALT))),jQuery(wym._options.dialogLinkSelector+" "+wym._options.submitSelector).click(function(){var e=jQuery(wym._options.hrefSelector).val();e.length>0&&(wym._exec(WYMeditor.CREATE_LINK,sStamp),jQuery("a[href="+sStamp+"]",wym._doc.body).attr(WYMeditor.HREF,e).attr(WYMeditor.TITLE,jQuery(wym._options.titleSelector).val())),window.close()}),jQuery(wym._options.dialogImageSelector+" "+wym._options.submitSelector).click(function(){var e=jQuery(wym._options.srcSelector).val();e.length>0&&(wym._exec(WYMeditor.INSERT_IMAGE,sStamp),jQuery("img[src$="+sStamp+"]",wym._doc.body).attr(WYMeditor.SRC,e).attr(WYMeditor.TITLE,jQuery(wym._options.titleSelector).val()).attr(WYMeditor.ALT,jQuery(wym._options.altSelector).val())),window.close()}),jQuery(wym._options.dialogTableSelector+" "+wym._options.submitSelector).click(function(){var e=jQuery(wym._options.rowsSelector).val(),t=jQuery(wym._options.colsSelector).val();if(e>0&&t>0){var n=wym._doc.createElement(WYMeditor.TABLE),i=null,r=jQuery(wym._options.captionSelector).val(),a=n.createCaption();for(a.innerHTML=r,x=0;x<e;x++)for(i=n.insertRow(x),y=0;y<t;y++)i.insertCell(y);jQuery(n).attr("summary",jQuery(wym._options.summarySelector).val());var o=jQuery(wym.findUp(wym.container(),WYMeditor.MAIN_CONTAINERS)).get(0);o&&o.parentNode?jQuery(o).after(n):jQuery(wym._doc.body).append(n)}window.close()}),jQuery(wym._options.dialogPasteSelector+" "+wym._options.submitSelector).click(function(){var e=jQuery(wym._options.textSelector).val();wym.paste(e),window.close()}),jQuery(wym._options.dialogPreviewSelector+" "+wym._options.previewSelector).html(wym.xhtml()),jQuery(wym._options.cancelSelector).mousedown(function(){window.close()}),jQuery.isFunction(wym._options.postInitDialog)&&wym._options.postInitDialog(wym,window)},WYMeditor.XmlHelper=function(){return this._entitiesDiv=document.createElement("div"),this},WYMeditor.XmlHelper.prototype.tag=function(e,t,n){return t=t||!1,n=n||!1,"<"+e+(t?this.tagOptions(t):"")+(n?">":" />")},WYMeditor.XmlHelper.prototype.contentTag=function(e,t,n){return n=n||!1,"<"+e+(n?this.tagOptions(n):"")+">"+t+"</"+e+">"},WYMeditor.XmlHelper.prototype.cdataSection=function(e){return"<![CDATA["+e+"]]>"},WYMeditor.XmlHelper.prototype.escapeOnce=function(e){return this._fixDoubleEscape(this.escapeEntities(e))},WYMeditor.XmlHelper.prototype._fixDoubleEscape=function(e){return e.replace(/&amp;([a-z]+|(#\d+));/gi,"&$1;")},WYMeditor.XmlHelper.prototype.tagOptions=function(e){var t=this;t._formated_options="";for(var n in e){var i=e[n];"function"!=typeof i&&i.length>0&&(parseInt(n)==n&&"object"==typeof i&&(n=i.shift(),i=i.pop()),""!=n&&""!=i&&(t._formated_options+=" "+n+'="'+t.escapeOnce(i)+'"'))}return t._formated_options},WYMeditor.XmlHelper.prototype.escapeEntities=function(e,t){this._entitiesDiv.innerHTML=e,this._entitiesDiv.textContent=e;var n=this._entitiesDiv.innerHTML;return void 0===t&&(0!=t&&(n=n.replace('"',"&quot;")),1==t&&(n=n.replace('"',"&#039;"))),n},WYMeditor.XmlHelper.prototype.parseAttributes=function(e){var t=[],n=e.split(/((=\s*")(")("))|((=\s*\')(\')(\'))|((=\s*[^>\s]*))/g);if(n.toString()!=e)for(var i in n){var r=n[i];if("function"!=typeof r&&0!=r.length){var a=new RegExp("(\\w+)\\s*"+r);if(match=e.match(a)){var o=r.replace(/^[\s=]+/,""),s=o.charAt(0);s='"'==s?'"':"'"==s?"'":"",""!=s&&(o='"'==s?o.replace(/^"|"+$/g,""):o.replace(/^'|'+$/g,"")),e=e.replace(match[0],""),t.push([match[1],o])}}}return t},WYMeditor.XhtmlValidator={_attributes:{core:{except:["base","head","html","meta","param","script","style","title"],attributes:["class","id","style","title","accesskey","tabindex"]},language:{except:["base","br","hr","iframe","param","script"],attributes:{dir:["ltr","rtl"],0:"lang",1:"xml:lang"}},keyboard:{attributes:{accesskey:/^(\w){1}$/,tabindex:/^(\d)+$/}}},_events:{window:{only:["body"],attributes:["onload","onunload"]},form:{only:["form","input","textarea","select","a","label","button"],attributes:["onchange","onsubmit","onreset","onselect","onblur","onfocus"]},keyboard:{except:["base","bdo","br","frame","frameset","head","html","iframe","meta","param","script","style","title"],attributes:["onkeydown","onkeypress","onkeyup"]},mouse:{except:["base","bdo","br","head","html","meta","param","script","style","title"],attributes:["onclick","ondblclick","onmousedown","onmousemove","onmouseover","onmouseout","onmouseup"]}},_tags:{a:{attributes:{0:"charset",1:"coords",2:"href",3:"hreflang",4:"name",rel:/^(alternate|designates|stylesheet|start|next|prev|contents|index|glossary|copyright|chapter|section|subsection|appendix|help|bookmark| |shortcut|icon)+$/,rev:/^(alternate|designates|stylesheet|start|next|prev|contents|index|glossary|copyright|chapter|section|subsection|appendix|help|bookmark| |shortcut|icon)+$/,shape:/^(rect|rectangle|circ|circle|poly|polygon)$/,5:"type"}},0:"abbr",1:"acronym",2:"address",area:{attributes:{0:"alt",1:"coords",2:"href",nohref:/^(true|false)$/,shape:/^(rect|rectangle|circ|circle|poly|polygon)$/},required:["alt"]},3:"b",base:{attributes:["href"],required:["href"]},bdo:{attributes:{dir:/^(ltr|rtl)$/},required:["dir"]},4:"big",blockquote:{attributes:["cite"]},5:"body",6:"br",button:{attributes:{disabled:/^(disabled)$/,type:/^(button|reset|submit)$/,0:"value"},inside:"form"},7:"caption",8:"cite",9:"code",col:{attributes:{align:/^(right|left|center|justify)$/,0:"char",1:"charoff",span:/^(\d)+$/,valign:/^(top|middle|bottom|baseline)$/,2:"width"},inside:"colgroup"},colgroup:{attributes:{align:/^(right|left|center|justify)$/,0:"char",1:"charoff",span:/^(\d)+$/,valign:/^(top|middle|bottom|baseline)$/,2:"width"}},10:"dd",del:{attributes:{0:"cite",datetime:/^([0-9]){8}/}},11:"div",12:"dfn",13:"dl",14:"dt",15:"em",fieldset:{inside:"form"},form:{attributes:{0:"action",1:"accept",2:"accept-charset",3:"enctype",method:/^(get|post)$/},required:["action"]},head:{attributes:["profile"]},16:"h1",17:"h2",18:"h3",19:"h4",20:"h5",21:"h6",22:"hr",html:{attributes:["xmlns"]},23:"i",img:{attributes:["alt","src","height","ismap","longdesc","usemap","width"],required:["alt","src"]},input:{attributes:{0:"accept",1:"alt",checked:/^(checked)$/,disabled:/^(disabled)$/,maxlength:/^(\d)+$/,2:"name",readonly:/^(readonly)$/,size:/^(\d)+$/,3:"src",type:/^(button|checkbox|file|hidden|image|password|radio|reset|submit|text)$/,4:"value"},inside:"form"},ins:{attributes:{0:"cite",datetime:/^([0-9]){8}/}},24:"kbd",label:{attributes:["for"],inside:"form"},25:"legend",26:"li",link:{attributes:{0:"charset",1:"href",2:"hreflang",media:/^(all|braille|print|projection|screen|speech|,|;| )+$/i,rel:/^(alternate|appendix|bookmark|chapter|contents|copyright|glossary|help|home|index|next|prev|section|start|stylesheet|subsection| |shortcut|icon)+$/i,rev:/^(alternate|appendix|bookmark|chapter|contents|copyright|glossary|help|home|index|next|prev|section|start|stylesheet|subsection| |shortcut|icon)+$/i,3:"type"},inside:"head"},map:{attributes:["id","name"],required:["id"]},meta:{attributes:{0:"content","http-equiv":/^(content\-type|expires|refresh|set\-cookie)$/i,1:"name",2:"scheme"},required:["content"]},27:"noscript",object:{attributes:["archive","classid","codebase","codetype","data","declare","height","name","standby","type","usemap","width"]},28:"ol",optgroup:{attributes:{0:"label",disabled:/^(disabled)$/},required:["label"]},option:{attributes:{0:"label",disabled:/^(disabled)$/,selected:/^(selected)$/,1:"value"},inside:"select"},29:"p",param:{attributes:{0:"type",valuetype:/^(data|ref|object)$/,1:"valuetype",2:"value"},required:["name"]},30:"pre",q:{attributes:["cite"]},31:"samp",script:{attributes:{type:/^(text\/ecmascript|text\/javascript|text\/jscript|text\/vbscript|text\/vbs|text\/xml)$/,0:"charset",defer:/^(defer)$/,1:"src"},required:["type"]},select:{attributes:{disabled:/^(disabled)$/,multiple:/^(multiple)$/,0:"name",1:"size"},inside:"form"},32:"small",33:"span",34:"strong",style:{attributes:{0:"type",media:/^(screen|tty|tv|projection|handheld|print|braille|aural|all)$/},required:["type"]},35:"sub",36:"sup",table:{attributes:{0:"border",1:"cellpadding",2:"cellspacing",frame:/^(void|above|below|hsides|lhs|rhs|vsides|box|border)$/,rules:/^(none|groups|rows|cols|all)$/,3:"summary",4:"width"}},tbody:{attributes:{align:/^(right|left|center|justify)$/,0:"char",1:"charoff",valign:/^(top|middle|bottom|baseline)$/}},td:{attributes:{0:"abbr",align:/^(left|right|center|justify|char)$/,1:"axis",2:"char",3:"charoff",colspan:/^(\d)+$/,4:"headers",rowspan:/^(\d)+$/,scope:/^(col|colgroup|row|rowgroup)$/,valign:/^(top|middle|bottom|baseline)$/}},textarea:{attributes:["cols","rows","disabled","name","readonly"],required:["cols","rows"],inside:"form"},tfoot:{attributes:{align:/^(right|left|center|justify)$/,0:"char",1:"charoff",valign:/^(top|middle|bottom)$/,2:"baseline"}},th:{attributes:{0:"abbr",align:/^(left|right|center|justify|char)$/,1:"axis",2:"char",3:"charoff",colspan:/^(\d)+$/,4:"headers",rowspan:/^(\d)+$/,scope:/^(col|colgroup|row|rowgroup)$/,valign:/^(top|middle|bottom|baseline)$/}},thead:{attributes:{align:/^(right|left|center|justify)$/,0:"char",1:"charoff",valign:/^(top|middle|bottom|baseline)$/}},37:"title",tr:{attributes:{align:/^(right|left|center|justify|char)$/,0:"char",1:"charoff",valign:/^(top|middle|bottom|baseline)$/}},38:"tt",39:"ul",40:"var"},skiped_attributes:[],skiped_attribute_values:[],getValidTagAttributes:function(e,t){var n={},i=this.getPossibleTagAttributes(e);for(var r in t){var a=t[r],o=WYMeditor.Helper;o.contains(this.skiped_attributes,r)||o.contains(this.skiped_attribute_values,a)||"function"!=typeof a&&o.contains(i,r)&&(this.doesAttributeNeedsValidation(e,r)?this.validateAttribute(e,r,a)&&(n[r]=a):n[r]=a)}return n},getUniqueAttributesAndEventsForTag:function(e){var t=[];if(this._tags[e]&&this._tags[e].attributes)for(k in this._tags[e].attributes)t.push(parseInt(k)==k?this._tags[e].attributes[k]:k);return t},getDefaultAttributesAndEventsForTags:function(){var e=[];for(var t in this._events)e.push(this._events[t]);for(var t in this._attributes)e.push(this._attributes[t]);return e},isValidTag:function(e){if(this._tags[e])return!0;for(var t in this._tags)if(this._tags[t]==e)return!0;return!1},getDefaultAttributesAndEventsForTag:function(e){var t=[];if(this.isValidTag(e)){var n=this.getDefaultAttributesAndEventsForTags();for(var i in n){var r=n[i];if("object"==typeof r){var a=WYMeditor.Helper;if(r.except&&a.contains(r.except,e)||r.only&&!a.contains(r.only,e))continue;var o=r.attributes?r.attributes:r.events;for(var s in o)t.push("string"!=typeof o[s]?s:o[s])}}}return t},doesAttributeNeedsValidation:function(e,t){return this._tags[e]&&(this._tags[e].attributes&&this._tags[e].attributes[t]||this._tags[e].required&&WYMeditor.Helper.contains(this._tags[e].required,t))},validateAttribute:function(e,t,n){return!(this._tags[e]&&this._tags[e].attributes&&this._tags[e].attributes[t]&&n.length>0&&!n.match(this._tags[e].attributes[t])||this._tags[e]&&this._tags[e].required&&WYMeditor.Helper.contains(this._tags[e].required,t)&&0==n.length)&&void 0!==this._tags[e]},getPossibleTagAttributes:function(e){return this._possible_tag_attributes||(this._possible_tag_attributes={}),this._possible_tag_attributes[e]||(this._possible_tag_attributes[e]=this.getUniqueAttributesAndEventsForTag(e).concat(this.getDefaultAttributesAndEventsForTag(e))),this._possible_tag_attributes[e]}},WYMeditor.ParallelRegex=function(e){return this._case=e,this._patterns=[],this._labels=[],this._regex=null,this},WYMeditor.ParallelRegex.prototype.addPattern=function(e,t){t=t||!0;var n=this._patterns.length;this._patterns[n]=e,this._labels[n]=t,this._regex=null},WYMeditor.ParallelRegex.prototype.match=function(e){if(0==this._patterns.length)return[!1,""];var t=e.match(this._getCompoundedRegex());if(!t)return[!1,""];for(var n=t[0],i=1;i<t.length;i++)if(t[i])return[this._labels[i-1],n];return[!0,t[0]]},WYMeditor.ParallelRegex.prototype._getCompoundedRegex=function(){if(null==this._regex){for(var e=0,t=this._patterns.length;e<t;e++)this._patterns[e]="("+this._untokenizeRegex(this._tokenizeRegex(this._patterns[e]).replace(/([\/\(\)])/g,"\\$1"))+")";this._regex=new RegExp(this._patterns.join("|"),this._getPerlMatchingFlags())}return this._regex},WYMeditor.ParallelRegex.prototype._tokenizeRegex=function(e){return e.replace(/\(\?(i|m|s|x|U)\)/,"~~~~~~Tk1$1~~~~~~").replace(/\(\?(\-[i|m|s|x|U])\)/,"~~~~~~Tk2$1~~~~~~").replace(/\(\?\=(.*)\)/,"~~~~~~Tk3$1~~~~~~").replace(/\(\?\!(.*)\)/,"~~~~~~Tk4$1~~~~~~").replace(/\(\?\<\=(.*)\)/,"~~~~~~Tk5$1~~~~~~").replace(/\(\?\<\!(.*)\)/,"~~~~~~Tk6$1~~~~~~").replace(/\(\?\:(.*)\)/,"~~~~~~Tk7$1~~~~~~")},WYMeditor.ParallelRegex.prototype._untokenizeRegex=function(e){return e.replace(/~~~~~~Tk1(.{1})~~~~~~/,"(?$1)").replace(/~~~~~~Tk2(.{2})~~~~~~/,"(?$1)").replace(/~~~~~~Tk3(.*)~~~~~~/,"(?=$1)").replace(/~~~~~~Tk4(.*)~~~~~~/,"(?!$1)").replace(/~~~~~~Tk5(.*)~~~~~~/,"(?<=$1)").replace(/~~~~~~Tk6(.*)~~~~~~/,"(?<!$1)").replace(/~~~~~~Tk7(.*)~~~~~~/,"(?:$1)")},WYMeditor.ParallelRegex.prototype._getPerlMatchingFlags=function(){return this._case?"m":"mi"},WYMeditor.StateStack=function(e){return this._stack=[e],this},WYMeditor.StateStack.prototype.getCurrent=function(){return this._stack[this._stack.length-1]},WYMeditor.StateStack.prototype.enter=function(e){this._stack.push(e)},WYMeditor.StateStack.prototype.leave=function(){return 1!=this._stack.length&&(this._stack.pop(),!0)},WYMeditor.LEXER_ENTER=1,WYMeditor.LEXER_MATCHED=2,WYMeditor.LEXER_UNMATCHED=3,WYMeditor.LEXER_EXIT=4,WYMeditor.LEXER_SPECIAL=5,WYMeditor.Lexer=function(e,t,n){return t=t||"accept",this._case=n||!1,this._regexes={},this._parser=e,this._mode=new WYMeditor.StateStack(t),this._mode_handlers={},this._mode_handlers[t]=t,this},WYMeditor.Lexer.prototype.addPattern=function(e,t){var t=t||"accept";void 0===this._regexes[t]&&(this._regexes[t]=new WYMeditor.ParallelRegex(this._case)),this._regexes[t].addPattern(e),void 0===this._mode_handlers[t]&&(this._mode_handlers[t]=t)},WYMeditor.Lexer.prototype.addEntryPattern=function(e,t,n){void 0===this._regexes[t]&&(this._regexes[t]=new WYMeditor.ParallelRegex(this._case)),this._regexes[t].addPattern(e,n),void 0===this._mode_handlers[n]&&(this._mode_handlers[n]=n)},WYMeditor.Lexer.prototype.addExitPattern=function(e,t){void 0===this._regexes[t]&&(this._regexes[t]=new WYMeditor.ParallelRegex(this._case)),this._regexes[t].addPattern(e,"__exit"),void 0===this._mode_handlers[t]&&(this._mode_handlers[t]=t)},WYMeditor.Lexer.prototype.addSpecialPattern=function(e,t,n){void 0===this._regexes[t]&&(this._regexes[t]=new WYMeditor.ParallelRegex(this._case)),this._regexes[t].addPattern(e,"_"+n),void 0===this._mode_handlers[n]&&(this._mode_handlers[n]=n)},WYMeditor.Lexer.prototype.mapHandler=function(e,t){this._mode_handlers[e]=t},WYMeditor.Lexer.prototype.parse=function(e){if(void 0===this._parser)return!1;for(var t,n=e.length;"object"==typeof(t=this._reduce(e));){var e=t[0],i=t[1],r=t[2],a=t[3];if(!this._dispatchTokens(i,r,a))return!1;if(""==e)return!0;if(e.length==n)return!1;n=e.length}return!!t&&this._invokeParser(e,WYMeditor.LEXER_UNMATCHED)},WYMeditor.Lexer.prototype._dispatchTokens=function(e,t,n){return n=n||!1,!!this._invokeParser(e,WYMeditor.LEXER_UNMATCHED)&&("boolean"==typeof n?this._invokeParser(t,WYMeditor.LEXER_MATCHED):this._isModeEnd(n)?!!this._invokeParser(t,WYMeditor.LEXER_EXIT)&&this._mode.leave():this._isSpecialMode(n)?(this._mode.enter(this._decodeSpecial(n)),!!this._invokeParser(t,WYMeditor.LEXER_SPECIAL)&&this._mode.leave()):(this._mode.enter(n),this._invokeParser(t,WYMeditor.LEXER_ENTER)))},WYMeditor.Lexer.prototype._isModeEnd=function(e){return"__exit"===e},WYMeditor.Lexer.prototype._isSpecialMode=function(e){return"_"==e.substring(0,1)},WYMeditor.Lexer.prototype._decodeSpecial=function(e){return e.substring(1)},WYMeditor.Lexer.prototype._invokeParser=function(content,is_match){if(!/ +/.test(content)&&(""===content||0==content))return!0;var current=this._mode.getCurrent(),handler=this._mode_handlers[current],result;return eval("result = this._parser."+handler+"(content, is_match);"),result},WYMeditor.Lexer.prototype._reduce=function(e){var t=this._regexes[this._mode.getCurrent()].match(e),n=t[1],i=t[0];if(i){var r=e.indexOf(n),a=e.substr(0,r);return e=e.substring(r+n.length),[e,a,n,i]}return!0},WYMeditor.XhtmlLexer=function(e){return jQuery.extend(this,new WYMeditor.Lexer(e,"Text")),this.mapHandler("Text","Text"),this.addTokens(),this.init(),this},WYMeditor.XhtmlLexer.prototype.init=function(){},WYMeditor.XhtmlLexer.prototype.addTokens=function(){this.addCommentTokens("Text"),this.addScriptTokens("Text"),this.addCssTokens("Text"),this.addTagTokens("Text")},WYMeditor.XhtmlLexer.prototype.addCommentTokens=function(e){this.addEntryPattern("\x3c!--",e,"Comment"),this.addExitPattern("--\x3e","Comment")},WYMeditor.XhtmlLexer.prototype.addScriptTokens=function(e){this.addEntryPattern("<script",e,"Script"),this.addExitPattern("<\/script>","Script")},WYMeditor.XhtmlLexer.prototype.addCssTokens=function(e){this.addEntryPattern("<style",e,"Css"),this.addExitPattern("</style>","Css")},WYMeditor.XhtmlLexer.prototype.addTagTokens=function(e){this.addSpecialPattern("<\\s*[a-z0-9:-]+\\s*>",e,"OpeningTag"),this.addEntryPattern("<[a-z0-9:-]+[\\/ \\>]+",e,"OpeningTag"),this.addInTagDeclarationTokens("OpeningTag"),this.addSpecialPattern("</\\s*[a-z0-9:-]+\\s*>",e,"ClosingTag")},WYMeditor.XhtmlLexer.prototype.addInTagDeclarationTokens=function(e){this.addSpecialPattern("\\s+",e,"Ignore"),this.addAttributeTokens(e),this.addExitPattern("/>",e),this.addExitPattern(">",e)},WYMeditor.XhtmlLexer.prototype.addAttributeTokens=function(e){this.addSpecialPattern("\\s*[a-z-_0-9]*:?[a-z-_0-9]+\\s*(?==)\\s*",e,"TagAttributes"),this.addEntryPattern('=\\s*"',e,"DoubleQuotedAttribute"),this.addPattern('\\\\"',"DoubleQuotedAttribute"),this.addExitPattern('"',"DoubleQuotedAttribute"),this.addEntryPattern("=\\s*'",e,"SingleQuotedAttribute"),this.addPattern("\\\\'","SingleQuotedAttribute"),this.addExitPattern("'","SingleQuotedAttribute"),this.addSpecialPattern("=\\s*[^>\\s]*",e,"UnquotedAttribute")},WYMeditor.XhtmlParser=function(e,t){var t=t||"Text";return this._Lexer=new WYMeditor.XhtmlLexer(this),this._Listener=e,this._mode=t,this._matches=[],this._last_match="",this._current_match="",this},WYMeditor.XhtmlParser.prototype.parse=function(e){return this._Lexer.parse(this.beforeParsing(e)),this.afterParsing(this._Listener.getResult())},WYMeditor.XhtmlParser.prototype.beforeParsing=function(e){return(e.match(/class="MsoNormal"/)||e.match(/ns = "urn:schemas-microsoft-com/))&&this._Listener.avoidStylingTagsAndAttributes(),this._Listener.beforeParsing(e)},WYMeditor.XhtmlParser.prototype.afterParsing=function(e){return this._Listener._avoiding_tags_implicitly&&this._Listener.allowStylingTagsAndAttributes(),this._Listener.afterParsing(e)},WYMeditor.XhtmlParser.prototype.Ignore=function(e,t){return!0},WYMeditor.XhtmlParser.prototype.Text=function(e){return this._Listener.addContent(e),!0},WYMeditor.XhtmlParser.prototype.Comment=function(e,t){return this._addNonTagBlock(e,t,"addComment")},WYMeditor.XhtmlParser.prototype.Script=function(e,t){return this._addNonTagBlock(e,t,"addScript")},WYMeditor.XhtmlParser.prototype.Css=function(e,t){return this._addNonTagBlock(e,t,"addCss")},WYMeditor.XhtmlParser.prototype._addNonTagBlock=function(e,t,n){switch(t){case WYMeditor.LEXER_ENTER:this._non_tag=e;break;case WYMeditor.LEXER_UNMATCHED:this._non_tag+=e;break;case WYMeditor.LEXER_EXIT:switch(n){case"addComment":this._Listener.addComment(this._non_tag+e);break;case"addScript":this._Listener.addScript(this._non_tag+e);break;case"addCss":this._Listener.addCss(this._non_tag+e)}}return!0},WYMeditor.XhtmlParser.prototype.OpeningTag=function(e,t){switch(t){case WYMeditor.LEXER_ENTER:this._tag=this.normalizeTag(e),this._tag_attributes={};break;case WYMeditor.LEXER_SPECIAL:this._callOpenTagListener(this.normalizeTag(e));break;case WYMeditor.LEXER_EXIT:this._callOpenTagListener(this._tag,this._tag_attributes)}return!0},WYMeditor.XhtmlParser.prototype.ClosingTag=function(e,t){return this._callCloseTagListener(this.normalizeTag(e)),!0},WYMeditor.XhtmlParser.prototype._callOpenTagListener=function(e,t){var t=t||{};this.autoCloseUnclosedBeforeNewOpening(e),this._Listener.isBlockTag(e)?(this._Listener._tag_stack.push(e),this._Listener.fixNestingBeforeOpeningBlockTag(e,t),this._Listener.openBlockTag(e,t),this._increaseOpenTagCounter(e)):this._Listener.isInlineTag(e)?this._Listener.inlineTag(e,t):(this._Listener.openUnknownTag(e,t),this._increaseOpenTagCounter(e)),this._Listener.last_tag=e,this._Listener.last_tag_opened=!0,this._Listener.last_tag_attributes=t},WYMeditor.XhtmlParser.prototype._callCloseTagListener=function(e){if(this._decreaseOpenTagCounter(e))if(this.autoCloseUnclosedBeforeTagClosing(e),this._Listener.isBlockTag(e)){var t=this._Listener._tag_stack.pop();if(0==t)return;t!=e&&(e=t),this._Listener.closeBlockTag(e)}else this._Listener.closeUnknownTag(e);else this._Listener.closeUnopenedTag(e);this._Listener.last_tag=e,this._Listener.last_tag_opened=!1},WYMeditor.XhtmlParser.prototype._increaseOpenTagCounter=function(e){this._Listener._open_tags[e]=this._Listener._open_tags[e]||0,this._Listener._open_tags[e]++},WYMeditor.XhtmlParser.prototype._decreaseOpenTagCounter=function(e){return!!this._Listener._open_tags[e]&&(this._Listener._open_tags[e]--,0==this._Listener._open_tags[e]&&(this._Listener._open_tags[e]=void 0),!0)},WYMeditor.XhtmlParser.prototype.autoCloseUnclosedBeforeNewOpening=function(e){this._autoCloseUnclosed(e,!1)},WYMeditor.XhtmlParser.prototype.autoCloseUnclosedBeforeTagClosing=function(e){this._autoCloseUnclosed(e,!0)},WYMeditor.XhtmlParser.prototype._autoCloseUnclosed=function(e,t){var t=t||!1;if(this._Listener._open_tags)for(var n in this._Listener._open_tags){var i=this._Listener._open_tags[n];i>0&&this._Listener.shouldCloseTagAutomatically(n,e,t)&&this._callCloseTagListener(n,!0)}},WYMeditor.XhtmlParser.prototype.getTagReplacements=function(){return this._Listener.getTagReplacements()},WYMeditor.XhtmlParser.prototype.normalizeTag=function(e){e=e.replace(/^([\s<\/>]*)|([\s<\/>]*)$/gm,"").toLowerCase();var t=this._Listener.getTagReplacements();return t[e]?t[e]:e},WYMeditor.XhtmlParser.prototype.TagAttributes=function(e,t){return WYMeditor.LEXER_SPECIAL==t&&(this._current_attribute=e),!0},WYMeditor.XhtmlParser.prototype.DoubleQuotedAttribute=function(e,t){return WYMeditor.LEXER_UNMATCHED==t&&(this._tag_attributes[this._current_attribute]=e),!0},WYMeditor.XhtmlParser.prototype.SingleQuotedAttribute=function(e,t){return WYMeditor.LEXER_UNMATCHED==t&&(this._tag_attributes[this._current_attribute]=e),!0},WYMeditor.XhtmlParser.prototype.UnquotedAttribute=function(e,t){return this._tag_attributes[this._current_attribute]=e.replace(/^=/,""),!0},WYMeditor.XhtmlSaxListener=function(){return this.output="",this.helper=new WYMeditor.XmlHelper,this._open_tags={},this.validator=WYMeditor.XhtmlValidator,this._tag_stack=[],this.avoided_tags=[],this.entities={"&nbsp;":"&#160;","&iexcl;":"&#161;","&cent;":"&#162;","&pound;":"&#163;","&curren;":"&#164;","&yen;":"&#165;","&brvbar;":"&#166;","&sect;":"&#167;","&uml;":"&#168;","&copy;":"&#169;","&ordf;":"&#170;","&laquo;":"&#171;","&not;":"&#172;","&shy;":"&#173;","&reg;":"&#174;","&macr;":"&#175;","&deg;":"&#176;","&plusmn;":"&#177;","&sup2;":"&#178;","&sup3;":"&#179;","&acute;":"&#180;","&micro;":"&#181;","&para;":"&#182;","&middot;":"&#183;","&cedil;":"&#184;","&sup1;":"&#185;","&ordm;":"&#186;","&raquo;":"&#187;","&frac14;":"&#188;","&frac12;":"&#189;","&frac34;":"&#190;","&iquest;":"&#191;","&Agrave;":"&#192;","&Aacute;":"&#193;","&Acirc;":"&#194;","&Atilde;":"&#195;","&Auml;":"&#196;","&Aring;":"&#197;","&AElig;":"&#198;","&Ccedil;":"&#199;","&Egrave;":"&#200;","&Eacute;":"&#201;","&Ecirc;":"&#202;","&Euml;":"&#203;","&Igrave;":"&#204;","&Iacute;":"&#205;","&Icirc;":"&#206;","&Iuml;":"&#207;","&ETH;":"&#208;","&Ntilde;":"&#209;","&Ograve;":"&#210;","&Oacute;":"&#211;","&Ocirc;":"&#212;","&Otilde;":"&#213;","&Ouml;":"&#214;","&times;":"&#215;","&Oslash;":"&#216;","&Ugrave;":"&#217;","&Uacute;":"&#218;","&Ucirc;":"&#219;","&Uuml;":"&#220;","&Yacute;":"&#221;","&THORN;":"&#222;","&szlig;":"&#223;","&agrave;":"&#224;","&aacute;":"&#225;","&acirc;":"&#226;","&atilde;":"&#227;","&auml;":"&#228;","&aring;":"&#229;","&aelig;":"&#230;","&ccedil;":"&#231;","&egrave;":"&#232;","&eacute;":"&#233;","&ecirc;":"&#234;","&euml;":"&#235;","&igrave;":"&#236;","&iacute;":"&#237;","&icirc;":"&#238;","&iuml;":"&#239;","&eth;":"&#240;","&ntilde;":"&#241;","&ograve;":"&#242;","&oacute;":"&#243;","&ocirc;":"&#244;","&otilde;":"&#245;","&ouml;":"&#246;","&divide;":"&#247;","&oslash;":"&#248;","&ugrave;":"&#249;","&uacute;":"&#250;","&ucirc;":"&#251;","&uuml;":"&#252;","&yacute;":"&#253;","&thorn;":"&#254;","&yuml;":"&#255;","&OElig;":"&#338;","&oelig;":"&#339;","&Scaron;":"&#352;","&scaron;":"&#353;","&Yuml;":"&#376;","&fnof;":"&#402;","&circ;":"&#710;","&tilde;":"&#732;","&Alpha;":"&#913;","&Beta;":"&#914;","&Gamma;":"&#915;","&Delta;":"&#916;","&Epsilon;":"&#917;","&Zeta;":"&#918;","&Eta;":"&#919;","&Theta;":"&#920;","&Iota;":"&#921;","&Kappa;":"&#922;","&Lambda;":"&#923;","&Mu;":"&#924;","&Nu;":"&#925;","&Xi;":"&#926;","&Omicron;":"&#927;","&Pi;":"&#928;","&Rho;":"&#929;","&Sigma;":"&#931;","&Tau;":"&#932;","&Upsilon;":"&#933;","&Phi;":"&#934;","&Chi;":"&#935;","&Psi;":"&#936;","&Omega;":"&#937;","&alpha;":"&#945;","&beta;":"&#946;","&gamma;":"&#947;","&delta;":"&#948;","&epsilon;":"&#949;","&zeta;":"&#950;","&eta;":"&#951;","&theta;":"&#952;","&iota;":"&#953;","&kappa;":"&#954;","&lambda;":"&#955;","&mu;":"&#956;","&nu;":"&#957;","&xi;":"&#958;","&omicron;":"&#959;","&pi;":"&#960;","&rho;":"&#961;","&sigmaf;":"&#962;","&sigma;":"&#963;","&tau;":"&#964;","&upsilon;":"&#965;","&phi;":"&#966;","&chi;":"&#967;","&psi;":"&#968;","&omega;":"&#969;","&thetasym;":"&#977;","&upsih;":"&#978;","&piv;":"&#982;","&ensp;":"&#8194;","&emsp;":"&#8195;","&thinsp;":"&#8201;","&zwnj;":"&#8204;","&zwj;":"&#8205;","&lrm;":"&#8206;","&rlm;":"&#8207;","&ndash;":"&#8211;","&mdash;":"&#8212;","&lsquo;":"&#8216;","&rsquo;":"&#8217;","&sbquo;":"&#8218;","&ldquo;":"&#8220;","&rdquo;":"&#8221;","&bdquo;":"&#8222;","&dagger;":"&#8224;","&Dagger;":"&#8225;","&bull;":"&#8226;","&hellip;":"&#8230;","&permil;":"&#8240;","&prime;":"&#8242;","&Prime;":"&#8243;","&lsaquo;":"&#8249;","&rsaquo;":"&#8250;","&oline;":"&#8254;","&frasl;":"&#8260;","&euro;":"&#8364;","&image;":"&#8465;","&weierp;":"&#8472;","&real;":"&#8476;","&trade;":"&#8482;","&alefsym;":"&#8501;","&larr;":"&#8592;","&uarr;":"&#8593;","&rarr;":"&#8594;","&darr;":"&#8595;","&harr;":"&#8596;","&crarr;":"&#8629;","&lArr;":"&#8656;","&uArr;":"&#8657;","&rArr;":"&#8658;","&dArr;":"&#8659;","&hArr;":"&#8660;","&forall;":"&#8704;","&part;":"&#8706;","&exist;":"&#8707;","&empty;":"&#8709;","&nabla;":"&#8711;","&isin;":"&#8712;","&notin;":"&#8713;","&ni;":"&#8715;","&prod;":"&#8719;","&sum;":"&#8721;","&minus;":"&#8722;","&lowast;":"&#8727;","&radic;":"&#8730;","&prop;":"&#8733;","&infin;":"&#8734;","&ang;":"&#8736;","&and;":"&#8743;","&or;":"&#8744;","&cap;":"&#8745;","&cup;":"&#8746;","&int;":"&#8747;","&there4;":"&#8756;","&sim;":"&#8764;","&cong;":"&#8773;","&asymp;":"&#8776;","&ne;":"&#8800;","&equiv;":"&#8801;","&le;":"&#8804;","&ge;":"&#8805;","&sub;":"&#8834;","&sup;":"&#8835;","&nsub;":"&#8836;","&sube;":"&#8838;","&supe;":"&#8839;","&oplus;":"&#8853;","&otimes;":"&#8855;","&perp;":"&#8869;","&sdot;":"&#8901;","&lceil;":"&#8968;","&rceil;":"&#8969;","&lfloor;":"&#8970;","&rfloor;":"&#8971;","&lang;":"&#9001;","&rang;":"&#9002;","&loz;":"&#9674;","&spades;":"&#9824;","&clubs;":"&#9827;","&hearts;":"&#9829;","&diams;":"&#9830;"},this.block_tags=["a","abbr","acronym","address","area","b","base","bdo","big","blockquote","body","button","caption","cite","code","col","colgroup","dd","del","div","dfn","dl","dt","em","fieldset","form","head","h1","h2","h3","h4","h5","h6","html","i","ins","kbd","label","legend","li","map","noscript","object","ol","optgroup","option","p","param","pre","q","samp","script","select","small","span","strong","style","sub","sup","table","tbody","td","textarea","tfoot","th","thead","title","tr","tt","ul","var","extends"],this.inline_tags=["br","hr","img","input"],this},WYMeditor.XhtmlSaxListener.prototype.shouldCloseTagAutomatically=function(e,t,n){var n=n||!1;return!("td"!=e||!(n&&"tr"==t||!n&&"td"==t))||!("option"!=e||!(n&&"select"==t||!n&&"option"==t))},WYMeditor.XhtmlSaxListener.prototype.beforeParsing=function(e){return this.output="",e},WYMeditor.XhtmlSaxListener.prototype.afterParsing=function(e){return e=this.replaceNamedEntities(e),e=this.joinRepeatedEntities(e),e=this.removeEmptyTags(e),e=this.removeBrInPre(e)},WYMeditor.XhtmlSaxListener.prototype.replaceNamedEntities=function(e){for(var t in this.entities)e=e.replace(new RegExp(t,"g"),this.entities[t]);return e},WYMeditor.XhtmlSaxListener.prototype.joinRepeatedEntities=function(e){var t="em|strong|sub|sup|acronym|pre|del|address";return e.replace(new RegExp("</("+t+")><\\1>",""),"").replace(new RegExp("(s*<("+t+")>s*){2}(.*)(s*</\\2>s*){2}",""),"<$2>$3<$2>")},WYMeditor.XhtmlSaxListener.prototype.removeEmptyTags=function(e){return e.replace(new RegExp("<("+this.block_tags.join("|").replace(/\|td/,"").replace(/\|p/,"").replace(/\|th/,"")+")>(<br />|&#160;|&nbsp;|\\s)*</\\1>","g"),"")},WYMeditor.XhtmlSaxListener.prototype.removeBrInPre=function(e){var t=e.match(new RegExp("<pre[^>]*>(.*?)</pre>","gmi"));if(t)for(var n=0;n<t.length;n++)e=e.replace(t[n],t[n].replace(new RegExp("<br />","g"),String.fromCharCode(13,10)));return e},WYMeditor.XhtmlSaxListener.prototype.getResult=function(){return this.output},WYMeditor.XhtmlSaxListener.prototype.getTagReplacements=function(){return{b:"strong",i:"em"}},WYMeditor.XhtmlSaxListener.prototype.addContent=function(e){this.output+=e},WYMeditor.XhtmlSaxListener.prototype.addComment=function(e){this.remove_comments&&(this.output+=e)},WYMeditor.XhtmlSaxListener.prototype.addScript=function(e){this.remove_scripts||(this.output+=e)},WYMeditor.XhtmlSaxListener.prototype.addCss=function(e){this.remove_embeded_styles||(this.output+=e)},WYMeditor.XhtmlSaxListener.prototype.openBlockTag=function(e,t){this.output+=this.helper.tag(e,this.validator.getValidTagAttributes(e,t),!0)},WYMeditor.XhtmlSaxListener.prototype.inlineTag=function(e,t){this.output+=this.helper.tag(e,this.validator.getValidTagAttributes(e,t))},WYMeditor.XhtmlSaxListener.prototype.openUnknownTag=function(e,t){},WYMeditor.XhtmlSaxListener.prototype.closeBlockTag=function(e){this.output=this.output.replace(/<br \/>$/,"")+this._getClosingTagContent("before",e)+"</"+e+">"+this._getClosingTagContent("after",e)},WYMeditor.XhtmlSaxListener.prototype.closeUnknownTag=function(e){},WYMeditor.XhtmlSaxListener.prototype.closeUnopenedTag=function(e){this.output+="</"+e+">"},WYMeditor.XhtmlSaxListener.prototype.avoidStylingTagsAndAttributes=function(){this.avoided_tags=["div","span"],this.validator.skiped_attributes=["style"],this.validator.skiped_attribute_values=["MsoNormal","main1"],this._avoiding_tags_implicitly=!0},WYMeditor.XhtmlSaxListener.prototype.allowStylingTagsAndAttributes=function(){this.avoided_tags=[],this.validator.skiped_attributes=[],this.validator.skiped_attribute_values=[],this._avoiding_tags_implicitly=!1},WYMeditor.XhtmlSaxListener.prototype.isBlockTag=function(e){return!WYMeditor.Helper.contains(this.avoided_tags,e)&&WYMeditor.Helper.contains(this.block_tags,e)},WYMeditor.XhtmlSaxListener.prototype.isInlineTag=function(e){return!WYMeditor.Helper.contains(this.avoided_tags,e)&&WYMeditor.Helper.contains(this.inline_tags,e)},WYMeditor.XhtmlSaxListener.prototype.insertContentAfterClosingTag=function(e,t){this._insertContentWhenClosingTag("after",e,t)},WYMeditor.XhtmlSaxListener.prototype.insertContentBeforeClosingTag=function(e,t){this._insertContentWhenClosingTag("before",e,t)},WYMeditor.XhtmlSaxListener.prototype.fixNestingBeforeOpeningBlockTag=function(e,t){"li"==e||"ul"!=e&&"ol"!=e||!this.last_tag||this.last_tag_opened||"li"!=this.last_tag||(this.output=this.output.replace(/<\/li>$/,""),this.insertContentAfterClosingTag(e,"</li>"))},WYMeditor.XhtmlSaxListener.prototype._insertContentWhenClosingTag=function(e,t,n){this["_insert_"+e+"_closing"]||(this["_insert_"+e+"_closing"]=[]),this["_insert_"+e+"_closing"][t]||(this["_insert_"+e+"_closing"][t]=[]),this["_insert_"+e+"_closing"][t].push(n)},WYMeditor.XhtmlSaxListener.prototype._getClosingTagContent=function(e,t){return this["_insert_"+e+"_closing"]&&this["_insert_"+e+"_closing"][t]&&this["_insert_"+e+"_closing"][t].length>0?this["_insert_"+e+"_closing"][t].pop():""},WYMeditor.WymCssLexer=function(e,t){var t=void 0===t||t;return jQuery.extend(this,new WYMeditor.Lexer(e,t?"Ignore":"WymCss")),this.mapHandler("WymCss","Ignore"),1==t&&(this.addEntryPattern("/\\*[<\\s]*WYMeditor[>\\s]*\\*/","Ignore","WymCss"),this.addExitPattern("/\\*[</\\s]*WYMeditor[>\\s]*\\*/","WymCss")),this.addSpecialPattern("[\\sa-z1-6]*\\.[a-z-_0-9]+","WymCss","WymCssStyleDeclaration"),this.addEntryPattern("/\\*","WymCss","WymCssComment"),this.addExitPattern("\\*/","WymCssComment"),this.addEntryPattern("{","WymCss","WymCssStyle"),this.addExitPattern("}","WymCssStyle"),this.addEntryPattern("/\\*","WymCssStyle","WymCssFeedbackStyle"),this.addExitPattern("\\*/","WymCssFeedbackStyle"),this},WYMeditor.WymCssParser=function(){return this._in_style=!1,this._has_title=!1,this.only_wym_blocks=!0,this.css_settings={classesItems:[],editorStyles:[],dialogStyles:[]},this},WYMeditor.WymCssParser.prototype.parse=function(e,t){var t=void 0===t?this.only_wym_blocks:t;this._Lexer=new WYMeditor.WymCssLexer(this,t),this._Lexer.parse(e)},WYMeditor.WymCssParser.prototype.Ignore=function(e,t){return!0},WYMeditor.WymCssParser.prototype.WymCssComment=function(e,t){return!e.match(/end[a-z0-9\s]*wym[a-z0-9\s]*/im)&&(t==WYMeditor.LEXER_UNMATCHED&&(this._in_style?this._current_item[this._current_element]&&(this._current_item[this._current_element].expressions?this._current_item[this._current_element].expressions.push(e):this._current_item[this._current_element].expressions=[e]):(this._has_title=!0,this._current_item={title:WYMeditor.Helper.trim(e)}),this._in_style=!0),!0)},WYMeditor.WymCssParser.prototype.WymCssStyle=function(e,t){return t==WYMeditor.LEXER_UNMATCHED?""!=(e=WYMeditor.Helper.trim(e))&&(this._current_item[this._current_element].style=e):t==WYMeditor.LEXER_EXIT&&(this._in_style=!1,this._has_title=!1,this.addStyleSetting(this._current_item)),!0},WYMeditor.WymCssParser.prototype.WymCssFeedbackStyle=function(e,t){return t==WYMeditor.LEXER_UNMATCHED&&(this._current_item[this._current_element].feedback_style=e.replace(/^([\s\/\*]*)|([\s\/\*]*)$/gm,"")),!0},WYMeditor.WymCssParser.prototype.WymCssStyleDeclaration=function(e){e=e.replace(/^([\s\.]*)|([\s\.*]*)$/gm,"");var t="";if(e.indexOf(".")>0){var n=e.split(".");this._current_element=n[1];var t=n[0]}else this._current_element=e;return this._has_title||(this._current_item={title:(t?t.toUpperCase()+": ":"")+this._current_element},this._has_title=!0),this._current_item[this._current_element]||(this._current_item[this._current_element]={name:this._current_element}),t&&(this._current_item[this._current_element].tags?this._current_item[this._current_element].tags.push(t):this._current_item[this._current_element].tags=[t]),!0},WYMeditor.WymCssParser.prototype.addStyleSetting=function(e){for(var t in e){var n=e[t];"object"==typeof n&&"title"!=t&&(this.css_settings.classesItems.push({name:WYMeditor.Helper.trim(n.name),title:e.title,expr:WYMeditor.Helper.trim((n.expressions||n.tags).join(", "))}),n.feedback_style&&this.css_settings.editorStyles.push({name:"."+WYMeditor.Helper.trim(n.name),css:n.feedback_style}),n.style&&this.css_settings.dialogStyles.push({name:"."+WYMeditor.Helper.trim(n.name),css:n.style}))}},jQuery.fn.isPhantomNode=function(){return 3==this[0].nodeType&&!/[^\t\n\r ]/.test(this[0].data)},WYMeditor.isPhantomNode=function(e){return 3==e.nodeType&&!/[^\t\n\r ]/.test(e.data)},WYMeditor.isPhantomString=function(e){return!/[^\t\n\r ]/.test(e)},jQuery.fn.parentsOrSelf=function(e){var t=this;return 3==t[0].nodeType&&(t=t.parents().slice(0,1)),1==t.filter(e).size()?t:t.parents(e).slice(0,1)},WYMeditor.Helper={replaceAll:function(e,t,n){var i=new RegExp(t,"g");return e.replace(i,n)},insertAt:function(e,t,n){return e.substr(0,n)+t+e.substring(n)},trim:function(e){return e.replace(/^(\s*)|(\s*)$/gm,"")},contains:function(e,t){for(var n=0;n<e.length;n++)if(e[n]===t)return!0;return!1},indexOf:function(e,t){for(var n=-1,i=0;i<e.length;i++)if(e[i]==t){n=i;break}return n},findByName:function(e,t){for(var n=0;n<e.length;n++){var i=e[n];if(i.name==t)return i}return null}},WYMeditor.WymClassExplorer=function(e){this._wym=e,this._class="className",this._newLine="\r\n"},WYMeditor.WymClassExplorer.prototype.initIframe=function(iframe){this._iframe=iframe,this._doc=iframe.contentWindow.document;var styles=this._doc.styleSheets[0],aCss=eval(this._options.editorStyles);this.addCssRules(this._doc,aCss),this._doc.title=this._wym._index,jQuery("html",this._doc).attr("dir",this._options.direction),jQuery(this._doc.body).html(this._wym._html);var wym=this;this._doc.body.onfocus=function(){wym._doc.designMode="on",wym._doc=iframe.contentWindow.document},this._doc.onbeforedeactivate=function(){wym.saveCaret()},this._doc.onkeyup=function(){wym.saveCaret(),wym.keyup()},this._doc.onclick=function(){wym.saveCaret()},this._doc.body.onbeforepaste=function(){wym._iframe.contentWindow.event.returnValue=!1},this._doc.body.onpaste=function(){wym._iframe.contentWindow.event.returnValue=!1,wym.paste(window.clipboardData.getData("Text"))},this._initialized&&(jQuery.isFunction(this._options.preBind)&&this._options.preBind(this),this._wym.bindEvents(),jQuery.isFunction(this._options.postInit)&&this._options.postInit(this),this.listen()),this._initialized=!0,this._doc.designMode="on";try{this._doc=iframe.contentWindow.document}catch(e){}},WYMeditor.WymClassExplorer.prototype._exec=function(e,t){switch(e){case WYMeditor.INDENT:case WYMeditor.OUTDENT:var n=this.findUp(this.container(),WYMeditor.LI);if(n){var i=n.parentNode.parentNode;(n.parentNode.childNodes.length>1||i.tagName.toLowerCase()==WYMeditor.OL||i.tagName.toLowerCase()==WYMeditor.UL)&&this._doc.execCommand(e)}break;default:t?this._doc.execCommand(e,!1,t):this._doc.execCommand(e)}this.listen()},WYMeditor.WymClassExplorer.prototype.selected=function(){var e=this._iframe.contentWindow.document.caretPos;if(null!=e&&void 0!=e.parentElement)return e.parentElement()},WYMeditor.WymClassExplorer.prototype.saveCaret=function(){this._doc.caretPos=this._doc.selection.createRange()},WYMeditor.WymClassExplorer.prototype.addCssRule=function(e,t){e.addRule(t.name,t.css)},WYMeditor.WymClassExplorer.prototype.insert=function(e){var t=this._doc.selection.createRange();if(jQuery(t.parentElement()).parents(this._options.iframeBodySelector).is("*"))try{t.pasteHTML(e)}catch(e){}else this.paste(e)},WYMeditor.WymClassExplorer.prototype.wrap=function(e,t){var n=this._doc.selection.createRange();if(jQuery(n.parentElement()).parents(this._options.iframeBodySelector).is("*"))try{n.pasteHTML(e+n.text+t)}catch(e){}},WYMeditor.WymClassExplorer.prototype.unwrap=function(){var e=this._doc.selection.createRange();if(jQuery(e.parentElement()).parents(this._options.iframeBodySelector).is("*"))try{var t=e.text;this._exec("Cut"),e.pasteHTML(t)}catch(e){}},WYMeditor.WymClassExplorer.prototype.keyup=function(){this._selected_image=null},WYMeditor.WymClassExplorer.prototype.setFocusToNode=function(e){var t=this._doc.selection.createRange();t.moveToElementText(e),t.collapse(!1),t.move("character",-1),t.select(),e.focus()},WYMeditor.WymClassMozilla=function(e){this._wym=e,this._class="class",this._newLine="\n"},WYMeditor.WymClassMozilla.prototype.initIframe=function(iframe){this._iframe=iframe,this._doc=iframe.contentDocument;var styles=this._doc.styleSheets[0],aCss=eval(this._options.editorStyles);this.addCssRules(this._doc,aCss),this._doc.title=this._wym._index,jQuery("html",this._doc).attr("dir",this._options.direction),this.html(this._wym._html),this.enableDesignMode(),jQuery.isFunction(this._options.preBind)&&this._options.preBind(this),this._wym.bindEvents(),jQuery(this._doc).bind("keydown",this.keydown),jQuery(this._doc).bind("keyup",this.keyup),jQuery(this._doc).bind("focus",this.enableDesignMode),jQuery.isFunction(this._options.postInit)&&this._options.postInit(this),this.listen()},WYMeditor.WymClassMozilla.prototype.html=function(e){if("string"!=typeof e)return jQuery(this._doc.body).html();try{this._doc.designMode="off"}catch(e){}e=e.replace(/<em(\b[^>]*)>/gi,"<i$1>").replace(/<\/em>/gi,"</i>").replace(/<strong(\b[^>]*)>/gi,"<b$1>").replace(/<\/strong>/gi,"</b>"),jQuery(this._doc.body).html(e),this.enableDesignMode()},WYMeditor.WymClassMozilla.prototype._exec=function(e,t){if(!this.selected())return!1;switch(e){case WYMeditor.INDENT:case WYMeditor.OUTDENT:var n=this.selected(),i=this._iframe.contentWindow.getSelection(),r=i.anchorNode;if("#text"==r.nodeName&&(r=r.parentNode),n=this.findUp(n,WYMeditor.BLOCKS),r=this.findUp(r,WYMeditor.BLOCKS),n&&n==r&&n.tagName.toLowerCase()==WYMeditor.LI){var a=n.parentNode.parentNode;(n.parentNode.childNodes.length>1||a.tagName.toLowerCase()==WYMeditor.OL||a.tagName.toLowerCase()==WYMeditor.UL)&&this._doc.execCommand(e,"",null)}break;default:t?this._doc.execCommand(e,"",t):this._doc.execCommand(e,"",null)}this.selected().tagName.toLowerCase()==WYMeditor.BODY&&this._exec(WYMeditor.FORMAT_BLOCK,WYMeditor.P),this.listen()},WYMeditor.WymClassMozilla.prototype.selected=function(){var e=this._iframe.contentWindow.getSelection(),t=e.focusNode;return t?"#text"==t.nodeName?t.parentNode:t:null},WYMeditor.WymClassMozilla.prototype.addCssRule=function(e,t){e.insertRule(t.name+" {"+t.css+"}",e.cssRules.length)},WYMeditor.WymClassMozilla.prototype.keydown=function(e){var t=WYMeditor.INSTANCES[this.title],n=null;if(e.keyCode===WYMeditor.KEY.ENTER&&(n=t.selected())){var i=$(n),r=(i.parent(),i.parents(".embedded-item"));if(r.size()){var a=$("<p/>");return i.hasClass("title")?r.before(a):i.hasClass("content")&&r.after(a),t.setFocusToNode(a.get(0)),!1}}if(e.ctrlKey){if(66==e.keyCode)return t._exec(WYMeditor.BOLD),!1;if(73==e.keyCode)return t._exec(WYMeditor.ITALIC),!1}else 13==e.keyCode&&(e.shiftKey||(n=t.selected())&&n.tagName.toLowerCase()==WYMeditor.PRE&&(e.preventDefault(),t.insert("<p></p>")))},WYMeditor.WymClassMozilla.prototype.keyup=function(e){var t=WYMeditor.INSTANCES[this.title];t._selected_image=null;var n=null;if(13!=e.keyCode||e.shiftKey){if(8!=e.keyCode&&17!=e.keyCode&&46!=e.keyCode&&224!=e.keyCode&&!e.metaKey&&!e.ctrlKey){n=t.selected();var i=n.tagName.toLowerCase();"strong"!=i&&"b"!=i&&"em"!=i&&"i"!=i&&"sub"!=i&&"sup"!=i&&"a"!=i||(i=n.parentNode.tagName.toLowerCase()),i==WYMeditor.BODY&&t._exec(WYMeditor.FORMAT_BLOCK,WYMeditor.P)}}else jQuery(t._doc.body).children(WYMeditor.BR).remove()},WYMeditor.WymClassMozilla.prototype.enableDesignMode=function(){if("off"==this.designMode)try{this.designMode="on",this.execCommand("styleWithCSS","",!1)}catch(e){}},WYMeditor.WymClassMozilla.prototype.setFocusToNode=function(e){var t=document.createRange();t.selectNode(e);var n=this._iframe.contentWindow.getSelection();n.addRange(t),n.collapse(e,e.childNodes.length),this._iframe.contentWindow.focus()},WYMeditor.WymClassMozilla.prototype.openBlockTag=function(e,t){var t=this.validator.getValidTagAttributes(e,t);if("span"==e&&t.style){var n=this.getTagForStyle(t.style);if(!n)return;this._tag_stack.pop();var e=n;this._tag_stack.push(n),t.style=""}this.output+=this.helper.tag(e,t,!0)},WYMeditor.WymClassMozilla.prototype.getTagForStyle=function(e){return/bold/.test(e)?"strong":/italic/.test(e)?"em":/sub/.test(e)?"sub":!!/sub/.test(e)&&"super"},WYMeditor.WymClassOpera=function(e){this._wym=e,this._class="class",this._newLine="\r\n"},WYMeditor.WymClassOpera.prototype.initIframe=function(iframe){this._iframe=iframe,this._doc=iframe.contentWindow.document;var styles=this._doc.styleSheets[0],aCss=eval(this._options.editorStyles);this.addCssRules(this._doc,aCss),this._doc.title=this._wym._index,jQuery("html",this._doc).attr("dir",this._options.direction),this._doc.designMode="on",this.html(this._wym._html),jQuery.isFunction(this._options.preBind)&&this._options.preBind(this),this._wym.bindEvents(),jQuery(this._doc).bind("keydown",this.keydown),jQuery(this._doc).bind("keyup",this.keyup),jQuery.isFunction(this._options.postInit)&&this._options.postInit(this),this.listen()},WYMeditor.WymClassOpera.prototype._exec=function(e,t){t?this._doc.execCommand(e,!1,t):this._doc.execCommand(e),this.listen()},WYMeditor.WymClassOpera.prototype.selected=function(){var e=this._iframe.contentWindow.getSelection(),t=e.focusNode;return t?"#text"==t.nodeName?t.parentNode:t:null},WYMeditor.WymClassOpera.prototype.addCssRule=function(e,t){e.insertRule(t.name+" {"+t.css+"}",e.cssRules.length)},WYMeditor.WymClassOpera.prototype.keydown=function(e){var t=WYMeditor.INSTANCES[this.title],n=t._iframe.contentWindow.getSelection();startNode=n.getRangeAt(0).startContainer,jQuery(startNode).parentsOrSelf(WYMeditor.MAIN_CONTAINERS.join(","))[0]||jQuery(startNode).parentsOrSelf("li")||e.keyCode==WYMeditor.KEY.ENTER||e.keyCode==WYMeditor.KEY.LEFT||e.keyCode==WYMeditor.KEY.UP||e.keyCode==WYMeditor.KEY.RIGHT||e.keyCode==WYMeditor.KEY.DOWN||e.keyCode==WYMeditor.KEY.BACKSPACE||e.keyCode==WYMeditor.KEY.DELETE||t._exec(WYMeditor.FORMAT_BLOCK,WYMeditor.P)},WYMeditor.WymClassOpera.prototype.keyup=function(e){WYMeditor.INSTANCES[this.title]._selected_image=null},WYMeditor.WymClassOpera.prototype.setFocusToNode=function(e){},WYMeditor.WymClassSafari=function(e){this._wym=e,this._class="class",this._newLine="\n"},WYMeditor.WymClassSafari.prototype.initIframe=function(iframe){this._iframe=iframe,this._doc=iframe.contentDocument;var styles=this._doc.styleSheets[0],aCss=eval(this._options.editorStyles);this.addCssRules(this._doc,aCss),this._doc.title=this._wym._index,jQuery("html",this._doc).attr("dir",this._options.direction),this._doc.designMode="on",this.html(this._wym._html),jQuery.isFunction(this._options.preBind)&&this._options.preBind(this),this._wym.bindEvents(),jQuery(this._doc).bind("keydown",this.keydown),jQuery(this._doc).bind("keyup",this.keyup),jQuery.isFunction(this._options.postInit)&&this._options.postInit(this),this.listen()},WYMeditor.WymClassSafari.prototype._exec=function(e,t){if(!this.selected())return!1;switch(e){case WYMeditor.INDENT:case WYMeditor.OUTDENT:var n=this.selected(),i=this._iframe.contentWindow.getSelection(),r=i.anchorNode;if("#text"==r.nodeName&&(r=r.parentNode),n=this.findUp(n,WYMeditor.BLOCKS),r=this.findUp(r,WYMeditor.BLOCKS),n&&n==r&&n.tagName.toLowerCase()==WYMeditor.LI){var a=n.parentNode.parentNode;(n.parentNode.childNodes.length>1||a.tagName.toLowerCase()==WYMeditor.OL||a.tagName.toLowerCase()==WYMeditor.UL)&&this._doc.execCommand(e,"",null)}break;case WYMeditor.INSERT_ORDEREDLIST:case WYMeditor.INSERT_UNORDEREDLIST:this._doc.execCommand(e,"",null);var n=this.selected(),o=this.findUp(n,WYMeditor.MAIN_CONTAINERS);o&&jQuery(o).replaceWith(jQuery(o).html());break;default:t?this._doc.execCommand(e,"",t):this._doc.execCommand(e,"",null)}var o=this.selected();o&&o.tagName.toLowerCase()==WYMeditor.BODY&&this._exec(WYMeditor.FORMAT_BLOCK,WYMeditor.P),this.listen()},WYMeditor.WymClassSafari.prototype.selected=function(){var e=this._iframe.contentWindow.getSelection(),t=e.focusNode;return t?"#text"==t.nodeName?t.parentNode:t:null},WYMeditor.WymClassSafari.prototype.addCssRule=function(e,t){e.insertRule(t.name+" {"+t.css+"}",e.cssRules.length)},WYMeditor.WymClassSafari.prototype.keydown=function(e){var t=WYMeditor.INSTANCES[this.title];if(e.keyCode===WYMeditor.KEY.ENTER){var n=t.selected();if(n){var i=$(n),r=(i.parent(),i.parents(".embedded-item"));if(r.size()){var a=$("<p/>");return i.hasClass("title")?r.before(a):i.hasClass("content")&&r.after(a),t.setFocusToNode(a.get(0)),!1}}}if(e.ctrlKey){if(66==e.keyCode)return t._exec(WYMeditor.BOLD),!1;if(73==e.keyCode)return t._exec(WYMeditor.ITALIC),!1}},WYMeditor.WymClassSafari.prototype.keyup=function(e){var t=WYMeditor.INSTANCES[this.title];t._selected_image=null;var n=null;if(13!=e.keyCode||e.shiftKey||(jQuery(t._doc.body).children(WYMeditor.BR).remove(),(n=t.selected())&&n.tagName.toLowerCase()==WYMeditor.PRE&&t._exec(WYMeditor.FORMAT_BLOCK,WYMeditor.P)),13==e.keyCode&&e.shiftKey&&t._exec("InsertLineBreak"),8!=e.keyCode&&17!=e.keyCode&&46!=e.keyCode&&224!=e.keyCode&&!e.metaKey&&!e.ctrlKey){n=t.selected();var i=n.tagName.toLowerCase();"strong"!=i&&"b"!=i&&"em"!=i&&"i"!=i&&"sub"!=i&&"sup"!=i&&"a"!=i&&"span"!=i||(i=n.parentNode.tagName.toLowerCase()),i!=WYMeditor.BODY&&i!=WYMeditor.DIV||t._exec(WYMeditor.FORMAT_BLOCK,WYMeditor.P)}},WYMeditor.WymClassSafari.prototype.setFocusToNode=function(e){var t=this._iframe.contentDocument.createRange();t.selectNode(e);var n=this._iframe.contentWindow.getSelection();n.addRange(t),n.collapse(e,e.childNodes.length),this._iframe.contentWindow.focus()},WYMeditor.WymClassSafari.prototype.openBlockTag=function(e,t){var t=this.validator.getValidTagAttributes(e,t);if("span"==e&&t.style){var n=this.getTagForStyle(t.style);if(!n)return;this._tag_stack.pop();var e=n;this._tag_stack.push(n),t.style="","string"==typeof t.class&&(t.class=t.class.replace(/apple-style-span/gi,""))}this.output+=this.helper.tag(e,t,!0)},WYMeditor.WymClassSafari.prototype.getTagForStyle=function(e){return/bold/.test(e)?"strong":/italic/.test(e)?"em":/sub/.test(e)?"sub":!!/super/.test(e)&&"sup"},window.WYMeditor=WYMeditor}).call(exports,__webpack_require__(0),__webpack_require__(0))},function(e,t,n){"use strict";(function(e,i,r,a){function o(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var s=n(336),l=o(s),c=n(338),d=o(c),u=n(339),h=o(u),f=n(17),p=o(f),g=n(4),m=o(g),_=n(3);o(_);n(76);window.JobDAG=l.default;var v=e.View.extend(m.default.LoggableMixin).extend({_logNamespace:"history",className:"history-structure-component",_INITIAL_ZOOM_LEVEL:1,_MIN_ZOOM_LEVEL:.25,_LINK_ID_SEP:"-to-",_VERTEX_NAME_DATA_KEY:"vertex-name",JobItemClass:h.default.JobListItemView,ContentItemClass:p.default.DatasetListItemView,initialize:function(e){this.log(this+"(HistoryStructureComponent).initialize:",e),this.component=e.component,this._liMap={},this._createVertexItems(),this.zoomLevel=e.zoomLevel||this._INITIAL_ZOOM_LEVEL,this.layout=this._createLayout(e.layoutOptions)},_createVertexItems:function(){var e=this;e.component.eachVertex(function(t){var n,i=t.data.job?"job":"copy";"job"===i?n=e._createJobListItem(t):"copy"===i&&(n=e._createContentListItem(t)),e._liMap[t.name]=n}),e.debug("_liMap:",e._liMap)},_createJobListItem:function(e){this.debug("_createJobListItem:",e);var t=this,n=e.data,r=new d.default.Job(n.job),a=i.map(r.get("outputs"),function(e){return t.model.contents.get(e.type_id)});r.outputCollection.reset(a),r.outputCollection.historyId=t.model.id;var o=new t.JobItemClass({model:r,tool:n.tool,jobData:n});return t.listenTo(o,"expanding expanded collapsing collapsed",t.renderGraph),t.listenTo(o.foldout,"view:expanding view:expanded view:collapsing view:collapsed",t.renderGraph),o},_createContentListItem:function(e){this.debug("_createContentListItem:",e);var t=this,n=e.data;n=t.model.contents.get(n.type_id);var i=new t.ContentItemClass({model:n});return t.listenTo(i,"expanding expanded collapsing collapsed",t.renderGraph),i},layoutDefaults:{linkSpacing:16,linkWidth:0,linkHeight:0,jobWidth:300,jobHeight:300,jobSpacing:12,linkAdjX:4,linkAdjY:0},_createLayout:function(e){e=i.defaults(i.clone(e||{}),this.layoutDefaults);var t=this,n=i.values(t.component.vertices),r=i.extend(e,{nodeMap:{},links:[],svg:{width:0,height:0}});return n.forEach(function(e,t){var n={name:e.name,x:0,y:0};r.nodeMap[e.name]=n}),t.component.edges(function(e){var t={source:e.source,target:e.target};r.links.push(t)}),r},render:function(e){this.debug(this+".render:",e);var t=this;t.$el.html(["<header></header>",'<nav class="controls"></nav>','<figure class="graph"></figure>',"<footer></footer>"].join(""));var n=t.$graph();return t.component.eachVertex(function(e){t._liMap[e.name].render(0).$el.appendTo(n).data(t._VERTEX_NAME_DATA_KEY,e.name)}),t.renderGraph(),this},$graph:function(){return this.$(".graph")},renderGraph:function(e){function t(){n._updateLayout(),n.$graph().css("transform",["scale(",n.zoomLevel,",",n.zoomLevel,")"].join("")).width(n.layout.svg.width).height(n.layout.svg.height),n.renderSVG(),n.component.eachVertex(function(e){var t=n._liMap[e.name],i=n.layout.nodeMap[e.name];t.$el.css({top:i.y,left:i.x})})}this.debug(this+".renderGraph:",e);var n=this;return this.$el.is(":visible")?t():i.delay(t,0),this},_updateLayout:function(){this.debug(this+"._updateLayout:");var e=this,t=e.layout;t.linkHeight=t.linkSpacing*i.size(t.nodeMap),t.svg.height=t.linkHeight+t.jobHeight,t.svg.width=0;var n=0,r=t.linkHeight;return i.each(t.nodeMap,function(e,i){e.x=n,e.y=r,n+=t.jobWidth+t.jobSpacing}),t.svg.width=t.linkWidth=Math.max(t.svg.width,n),t.links.forEach(function(e){var n=t.nodeMap[e.source],i=t.nodeMap[e.target];e.x1=n.x+t.linkAdjX,e.y1=n.y+t.linkAdjY,e.x2=i.x+t.linkAdjX,e.y2=i.y+t.linkAdjY}),this.debug(JSON.stringify(t,null,"  ")),this.layout},renderSVG:function(){function e(e){d3.select(this).classed("highlighted",!0),n._liMap[e.source].$el.addClass("highlighted"),n._liMap[e.target].$el.addClass("highlighted")}function t(e){d3.select(this).classed("highlighted",!1),n._liMap[e.source].$el.removeClass("highlighted"),n._liMap[e.target].$el.removeClass("highlighted")}this.debug(this+".renderSVG:");var n=this,i=n.layout,r=d3.select(this.$graph().get(0)).select("svg");r.empty()&&(r=d3.select(this.$graph().get(0)).append("svg")),r.attr("width",i.svg.width).attr("height",i.svg.height);var a=r.selectAll(".connection").data(i.links);return a.enter().append("path").attr("class","connection").attr("id",function(e){return[e.source,e.target].join(n._LINK_ID_SEP)}).on("mouseover",e).on("mouseout",t),a.attr("d",function(e){return n._connectionPath(e)}),r.node()},_connectionPath:function(e){var t=(e.x2-e.x1)/this.layout.svg.width*this.layout.linkHeight;return["M",e.x1,",",e.y1," ","C",e.x1+0,",",e.y1-t," ",e.x2-0,",",e.y2-t," ",e.x2,",",e.y2].join("")},events:{"mouseover .graph > .list-item":function(e){this.highlightConnected(e.currentTarget,!0)},"mouseout  .graph > .list-item":function(e){this.highlightConnected(e.currentTarget,!1)}},highlightConnected:function(e,t){this.debug("highlightConnected",e,t),t=void 0===t||t;var n=this,i=n.component,o=t?r.prototype.addClass:r.prototype.removeClass,s=t?"connection highlighted":"connection",l=o.call(a(e),"highlighted"),c=l.data(n._VERTEX_NAME_DATA_KEY);i.edges({target:c}).forEach(function(e){var t=e.source,i=n._liMap[t];o.call(i.$el,"highlighted"),n.$("#"+t+n._LINK_ID_SEP+c).attr("class",s)}),i.vertices[c].eachEdge(function(e){var t=e.target,i=n._liMap[t];o.call(i.$el,"highlighted"),n.$("#"+c+n._LINK_ID_SEP+t).attr("class",s)})},zoom:function(e){return this.zoomLevel=Math.min(1,Math.max(this._MIN_ZOOM_LEVEL,e)),this.renderGraph()},toString:function(){return"HistoryStructureComponent("+this.model.id+")"}}),y=v.extend({className:v.prototype.className+" vertical",layoutDefaults:i.extend(i.clone(v.prototype.layoutDefaults),{linkAdjX:0,linkAdjY:4}),_updateLayout:function(){this.debug(this+"._updateLayout:");var e=this,t=e.layout;t.linkWidth=t.linkSpacing*i.size(t.nodeMap),t.svg.width=t.linkWidth+t.jobWidth,t.svg.height=0;var n=t.linkWidth,r=0;return i.each(t.nodeMap,function(i,a){i.x=n,i.y=r;var o=e._liMap[a];r+=o.$el.height()+t.jobSpacing}),t.linkHeight=t.svg.height=Math.max(t.svg.height,r),t.links.forEach(function(e){var n=t.nodeMap[e.source],i=t.nodeMap[e.target];e.x1=n.x+t.linkAdjX,e.y1=n.y+t.linkAdjY,e.x2=i.x+t.linkAdjX,e.y2=i.y+t.linkAdjY}),this.debug(JSON.stringify(t,null,"  ")),t},_connectionPath:function(e){var t=(e.y2-e.y1)/this.layout.svg.height*this.layout.linkWidth;return["M",e.x1,",",e.y1," ","C",e.x1-t,",",e.y1+0," ",e.x2-t,",",e.y2-0," ",e.x2,",",e.y2].join("")},toString:function(){return"VerticalHistoryStructureComponent("+this.model.id+")"}}),b=e.View.extend(m.default.LoggableMixin).extend({_logNamespace:"history",className:"history-structure",_layoutToComponentClass:{horizontal:v,vertical:y},_DEFAULT_LAYOUT:"vertical",initialize:function(e){this.layout=i.contains(e.layout,i.keys(this._layoutToComponentClass))?e.layout:this._DEFAULT_LAYOUT,this.log(this+"(HistoryStructureView).initialize:",e,this.model),this._processTools(e.tools),this._processJobs(e.jobs),this._createDAG()},_processTools:function(e){return this.tools=e||{},this.tools},_processJobs:function(e){return this.jobs=e||[],this.jobs},_createDAG:function(){this.dag=new l.default({historyContents:this.model.contents.toJSON(),tools:this.tools,jobs:this.jobs,excludeSetMetadata:!0,excludeErroredJobs:!0}),this.debug(this+".dag:",this.dag),this._createComponents()},_createComponents:function(){this.log(this+"._createComponents");var e=this;return e.componentViews=e.dag.weakComponentGraphArray().map(function(t){return e._createComponent(t)}),e.componentViews},_createComponent:function(e){return this.log(this+"._createComponent:",e),new(0,this._layoutToComponentClass[this.layout])({model:this.model,component:e})},render:function(e){this.log(this+".render:",e);var t=this;return t.$el.addClass("clear").html(['<div class="controls"></div>','<div class="components"></div>'].join("")),t.componentViews.forEach(function(e){e.render().$el.appendTo(t.$components())}),t},$components:function(){return this.$(".components")},changeLayout:function(e){if(!(e in this._layoutToComponentClass))throw new Error(this+": unknown layout: "+e);return this.layout=e,this._createComponents(),this.render()},toString:function(){return"HistoryStructureView("+this.model.id+")"}});t.default=b}).call(t,n(2),n(1),n(0),n(0))},function(e,t,n){"use strict";(function(e){function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var r=n(337),a=i(r),o=n(66),s=i(o),l=a.default.Graph,c=function(t){t=t||{};var n=this;n.filters=[],n._jobsData=[],n._historyContentsMap={},n._toolMap={},n._outputIdToJobMap={},n.noInputJobs=[],n.noOutputJobs=[],n.filteredSetMetadata=[],n.filteredErroredJobs=[],n.dataKeys=["jobs","historyContents","tools"],l.call(n,!0,e.pick(t,n.dataKeys),e.omit(t,n.dataKeys))};c.prototype=new a.default.Graph,c.prototype.constructor=c,(0,s.default)(c),c.prototype.init=function(t){t=t||{};var n=this;return n.options=e.defaults(t,{excludeSetMetadata:!1}),n.filters=n._initFilters(),l.prototype.init.call(n,t),n},c.prototype._initFilters=function(){var t=this,n=[];return t.options.excludeSetMetadata&&(t.filteredSetMetadata=[],n.push(function(e){return"__SET_METADATA__"!==e.job.tool_id||(t.filteredSetMetadata.push(e.job.id),!1)})),t.options.excludeErroredJobs&&(t.filteredErroredJobs=[],n.push(function(e){return"error"!==e.job.state||(t.filteredErroredJobs.push(e.job.id),!1)})),e.isArray(t.options.filters)&&(n=n.concat(t.options.filters)),t.debug("filters len:",n.length),n},c.prototype.read=function(t){var n=this;return e.has(t,"historyContents")&&e.has(t,"jobs")&&e.has(t,"tools")?(n.preprocessHistoryContents(t.historyContents||[]).preprocessTools(t.tools||{}).preprocessJobs(t.jobs||[]),n.createGraph(n._filterJobs()),n):l.prototype.read.call(this,t)},c.prototype.preprocessHistoryContents=function(t){this.info("processing history");var n=this;return n._historyContentsMap={},t.forEach(function(t,i){n._historyContentsMap[t.id]=e.clone(t)}),n},c.prototype.preprocessTools=function(t){this.info("processing tools");var n=this;return n._toolMap={},e.each(t,function(t,i){n._toolMap[i]=e.clone(t)}),n},c.prototype.preprocessJobs=function(t){this.info("processing jobs");var n=this;return n._outputIdToJobMap={},n._jobsData=n.sort(t).map(function(t){return n.preprocessJob(e.clone(t))}),n},c.prototype.sort=function(e){function t(e,t){return e.create_time>t.create_time?1:e.create_time<t.create_time?-1:0}return e.sort(t)},c.prototype.preprocessJob=function(t,n){var i=this,r={job:t};return r.inputs=i._processInputs(t),0===e.size(r.inputs)&&i.noInputJobs.push(t.id),r.outputs=i._processOutputs(t),0===e.size(r.outputs)&&i.noOutputJobs.push(t.id),r.tool=i._toolMap[t.tool_id],r},c.prototype._processInputs=function(t){var n=this,i=t.inputs,r={};return e.each(i,function(t,i){t=e.clone(n._validateInputOutput(t)),t.name=i,t.content=n._historyContentsMap[t.id],r[t.id]=t}),r},c.prototype._validateInputOutput=function(e){if(!e.id)throw new Error("No id on job input/output: ",JSON.stringify(e));if(!e.src||"hda"!==e.src)throw new Error("Bad src on job input/output: ",JSON.stringify(e));return e},c.prototype._processOutputs=function(t){var n=this,i=t.outputs,r={};return e.each(i,function(i,a){i=e.clone(n._validateInputOutput(i)),i.name=a,i.content=n._historyContentsMap[i.id],r[i.id]=i,n._outputIdToJobMap[i.id]=t.id}),r},c.prototype._filterJobs=function(){var e=this;return e._jobsData.filter(function(t,n){return e._filterJob(t,n)})},c.prototype._filterJob=function(e,t){for(var n=this,i=0;i<n.filters.length;i++)if(!n.filters[i].call(n,e))return n.debug("\t job",e.job.id," has been filtered out by function:\n",n.filters[i]),!1;return!0},c.prototype.createGraph=function(t){var n=this;return n.debug("connections:"),e.each(t,function(e){var t=e.job.id;n.debug("\t",t,e),n.createVertex(t,e)}),e.each(t,function(t){var i=t.job.id;e.each(t.inputs,function(e,t){var r=n._outputIdToJobMap[t];if(!r){r=n.createJobLessVertex(t).name}n.createEdge(r,i,n.directed,{dataset:t})})}),n.debug("final graph: ",JSON.stringify(n.toVerticesAndEdges(),null,"  ")),n},c.prototype.createJobLessVertex=function(e){var t="copy-"+e;return this.createVertex(t,this._historyContentsMap[e])},c.prototype.weakComponentGraphArray=function(){var e=this;return this.weakComponents().map(function(t){return t.vertices.sort(function(e,t){var n=e.data.job?e.data.job.create_time:e.data.create_time,i=t.data.job?t.data.job.create_time:t.data.create_time;return n>i?1:n<i?-1:0}),new Graph(e.directed,t)})},c.prototype._jobsDataMap=function(){var e={};return this._jobsData.forEach(function(t){e[t.job.id]=t}),e},t.default=c}).call(t,n(1))},function(e,t,n){"use strict";function i(e,t){for(var n in t)if(t.hasOwnProperty(n)&&(!e.hasOwnProperty(n)||e[n]!==t[n]))return!1;return!0}function r(e,t){var n="function"==typeof t?t:void 0,r="object"===(void 0===t?"undefined":c(t))?t:void 0,a=[],o=0;for(var s in e)if(e.hasOwnProperty(s)){var l=e[s];n?a.push(n.call(l,l,s,o)):r?"object"===(void 0===l?"undefined":c(l))&&i(l,r)&&a.push(l):a.push(l),o+=1}return a}function a(e,t,n){var i=this;return i.source=void 0!==e?e:null,i.target=void 0!==t?t:null,i.data=n||null,i}function o(e,t){var n=this;return n.name=void 0!==e?e:"(unnamed)",n.data=t||null,n.edges={},n.degree=0,n}function s(e,t,n){return this.directed=e||!1,this.init(n).read(t)}function l(e,t,n){function i(e){return Math.floor(Math.random()*e)}for(var r={nodes:[],links:[]},a=0;a<t;a++)r.nodes.push({name:a});for(a=0;a<n;a++)r.links.push({source:i(t),target:i(t)});return new s(e,r)}Object.defineProperty(t,"__esModule",{value:!0});var c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};a.prototype.toString=function(){return this.source+"->"+this.target},a.prototype.toJSON=function(){var e={source:this.source,target:this.target};return this.data&&(e.data=this.data),e},o.prototype.toString=function(){return"Vertex("+this.name+")"},o.prototype.eachEdge=function(e){return r(this.edges,e)},o.prototype.toJSON=function(){return{name:this.name,data:this.data}};var d=function(e,t){var n=this;return n.graph=e,n.processFns=t||{vertexEarly:function(e,t){},edge:function(e,t,n){},vertexLate:function(e,t){}},n._cache={},n};d.prototype.search=function(e){var t=this;return e in t._cache?t._cache[e]:(e instanceof o||(e=t.graph.vertices[e]),t._cache[e.name]=t._search(e))},d.prototype._search=function(e,t){return t=t||{discovered:{},edges:[]}},d.prototype.searchTree=function(e){return this._searchTree(this.search(e))},d.prototype._searchTree=function(e){var t=this;return new s(!0,{edges:e.edges,vertices:Object.keys(e.discovered).map(function(e){return t.graph.vertices[e].toJSON()})})};var u=function(e,t){var n=this;return d.call(this,e,t),n};u.prototype=new d,u.prototype.constructor=u,u.prototype._search=function(e,t){function n(e,n){var a=this;i.processFns.edge&&i.processFns.edge.call(i,a,n,t),t.discovered[e.name]||(t.discovered[e.name]=!0,t.edges.push({source:a.name,target:e.name}),r.push(e))}t=t||{discovered:{},edges:[]};var i=this,r=[];for(t.discovered[e.name]=!0,r.push(e);r.length;){var a=r.shift();i.processFns.vertexEarly&&i.processFns.vertexEarly.call(i,a,t),i.graph.eachAdjacent(a,n),i.processFns.vertexLate&&i.processFns.vertexLate.call(i,a,t)}return t};var h=function(e,t){var n=this;return d.call(this,e,t),n};h.prototype=new d,h.prototype.constructor=h,h.prototype._search=function(e,t){function n(e,n){var a=this;r.processFns.edge&&r.processFns.edge.call(r,a,n,t),t.discovered[e.name]||(t.edges.push({source:a.name,target:e.name}),i(e))}function i(e){t.discovered[e.name]=!0,r.processFns.vertexEarly&&r.processFns.vertexEarly.call(r,e,t),t.entryTimes[e.name]=a++,r.graph.eachAdjacent(e,n),r.processFns.vertexLate&&r.processFns.vertexLate.call(r,e,t),t.exitTimes[e.name]=a++}t=t||{discovered:{},edges:[],entryTimes:{},exitTimes:{}};var r=this,a=0;return i(e),t},window.Graph=s,s.prototype.init=function(e){e=e||{};var t=this;return t.allowReflexiveEdges=e.allowReflexiveEdges||!1,t.vertices={},t.numEdges=0,t},s.prototype.read=function(e){if(!e)return this;var t=this;return e.hasOwnProperty("nodes")?t.readNodesAndLinks(e):e.hasOwnProperty("vertices")?t.readVerticesAndEdges(e):t},s.prototype.readNodesAndLinks=function(e){if(!e||!e.hasOwnProperty("nodes"))return this;var t=this;return e.nodes.forEach(function(e){t.createVertex(e.name,e.data)}),(e.links||[]).forEach(function(n,i){var r=e.nodes[n.source].name,a=e.nodes[n.target].name;t.createEdge(r,a,t.directed)}),t},s.prototype.readVerticesAndEdges=function(e){if(!e||!e.hasOwnProperty("vertices"))return this;var t=this;return e.vertices.forEach(function(e){t.createVertex(e.name,e.data)}),(e.edges||[]).forEach(function(e,n){t.createEdge(e.source,e.target,t.directed)}),t},s.prototype.createVertex=function(e,t){return this.vertices[e]?this.vertices[e]:this.vertices[e]=new o(e,t)},s.prototype.createEdge=function(e,t,n,i){var r=e===t;if(!this.allowReflexiveEdges&&r)return null;var o=this.vertices[e],s=this.vertices[t];if(!o||!s)return null;var l=this,c=new a(e,t,i);return o.edges[t]=c,o.degree+=1,l.numEdges+=1,r||n||l.createEdge(t,e,!0),c},s.prototype.edges=function(e){return Array.prototype.concat.apply([],this.eachVertex(function(t){return t.eachEdge(e)}))},s.prototype.eachVertex=function(e){return r(this.vertices,e)},s.prototype.adjacent=function(e){var t=this;return r(e.edges,function(e){return t.vertices[e.target]})},s.prototype.eachAdjacent=function(e,t){var n=this;return r(e.edges,function(i){var r=n.vertices[i.target];return t.call(e,r,i)})},s.prototype.print=function(){var e=this;return console.log("Graph has "+Object.keys(e.vertices).length+" vertices"),e.eachVertex(function(e){console.log(e.toString()),e.eachEdge(function(e){console.log("\t "+e)})}),e},s.prototype.toDOT=function(){var e=this,t=[];return t.push("graph bler {"),e.edges(function(e){t.push("\t"+e.from+" -- "+e.to+";")}),t.push("}"),t.join("\n")},s.prototype.toNodesAndLinks=function(){var e=this,t={};return{nodes:e.eachVertex(function(e,n,i){return t[e.name]=i,e.toJSON()}),links:e.edges(function(e){var n=e.toJSON();return n.source=t[e.source],n.target=t[e.target],n})}},s.prototype.toVerticesAndEdges=function(){var e=this;return{vertices:e.eachVertex(function(e,t){return e.toJSON()}),edges:e.edges(function(e){return e.toJSON()})}},s.prototype.breadthFirstSearch=function(e,t){return new u(this).search(e)},s.prototype.breadthFirstSearchTree=function(e,t){return new u(this).searchTree(e)},s.prototype.depthFirstSearch=function(e,t){return new h(this).search(e)},s.prototype.depthFirstSearchTree=function(e,t){return new h(this).searchTree(e)},s.prototype.weakComponents=function(){var e,t=this,n=this,i=[];for(t.directed&&(n=new s(!1,t.toNodesAndLinks())),e=Object.keys(n.vertices);e.length;){var r=n.vertices[e.shift()];i.push(function(i){var r=new h(n)._search(i);return e=e.filter(function(e){return!(e in r.discovered)}),{vertices:Object.keys(r.discovered).map(function(e){return t.vertices[e].toJSON()}),edges:r.edges.map(function(e){var n=void 0!==t.vertices[e.target].edges[e.source];if(t.directed&&n){var i=e.source;e.source=e.target,e.target=i}return e})}}(r))}return i},s.prototype.weakComponentGraph=function(){var e=this.weakComponents();return new s(this.directed,{vertices:e.reduce(function(e,t){return e.concat(t.vertices)},[]),edges:e.reduce(function(e,t){return e.concat(t.edges)},[])})},s.prototype.weakComponentGraphArray=function(){var e=this;return this.weakComponents().map(function(t){return new s(e.directed,t)})},t.default={Vertex:o,Edge:a,BreadthFirstSearch:u,DepthFirstSearch:h,Graph:s,randGraph:l}},function(e,t,n){"use strict";(function(e,i){function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var a=n(16),o=r(a),s=n(8),l=r(s),c=n(21),d=r(c),u=n(4),h=r(u),f=n(3),p=(r(f),h.default.SearchableModelMixin),g=e.Model.extend(h.default.LoggableMixin).extend(h.default.mixin(p,{_logNamespace:"jobs",defaults:{model_class:"Job",tool_id:null,exit_code:null,inputs:{},outputs:{},params:{},create_time:null,update_time:null,state:l.default.NEW},parse:function(e,t){return e.params=this.parseParams(e.params),e},parseParams:function(e){var t={};return i.each(e,function(e,n){t[n]=JSON.parse(e)}),t},initialize:function(e,t){this.debug(this+"(Job).initialize",e,t),this.set("params",this.parseParams(this.get("params")),{silent:!0}),this.outputCollection=e.outputCollection||new o.default.HistoryContents([]),this._setUpListeners()},_setUpListeners:function(){this.on("change:state",function(e,t){this.log(this+" has changed state:",e,t),this.inReadyState()&&this.trigger("state:ready",e,t,this.previous("state"))})},inReadyState:function(){return i.contains(l.default.READY_STATES,this.get("state"))},hasDetails:function(){return!i.isEmpty(this.get("outputs"))},urlRoot:Galaxy.root+"api/jobs",toString:function(){return["Job(",this.get("id"),":",this.get("tool_id"),")"].join("")}})),m=e.Collection.extend(h.default.LoggableMixin).extend({_logNamespace:"jobs",model:g,urlRoot:Galaxy.root+"api/jobs",url:function(){return this.urlRoot},intialize:function(e,t){console.debug(e,t)},ids:function(){return this.map(function(e){return e.get("id")})},notReady:function(){return this.filter(function(e){return!e.inReadyState()})},haveDetails:function(){return this.all(function(e){return e.hasDetails()})},queueDetailFetching:function(){var e=this,t=new d.default.AjaxQueue(this.map(function(e){return function(){return e.fetch({silent:!0})}}));return t.done(function(){e.trigger("details-loaded")}),t},matches:function(e){return this.filter(function(t){return t.matches(e)})},toString:function(){return["JobCollection(",this.length,")"].join("")}},{fromHistory:function(e){console.debug(this);var t=this,n=new t([]);return n.fetch({data:{history_id:e}}).done(function(){window.queue=n.queueDetailFetching()}),n}});t.default={Job:g,JobCollection:m}}).call(t,n(2),n(1))},function(e,t,n){"use strict";(function(e){function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var r=n(22),a=i(r),o=n(340),s=i(o),l=n(4),c=i(l),d=n(3),u=i(d),h=a.default.FoldoutListItemView,f=h.extend({className:h.prototype.className+" job",id:function(){return["job",this.model.get("id")].join("-")},foldoutPanelClass:s.default.DatasetList,initialize:function(e){e.logger&&(this.logger=this.model.logger=e.logger),this.log(this+".initialize:",e),h.prototype.initialize.call(this,e),this.tool=e.tool||{},this.jobData=e.jobData||{},this.linkTarget=e.linkTarget||"_blank"},_swapNewRender:function(e){return h.prototype._swapNewRender.call(this,e),this.model.has("state")&&this.$el.addClass("state-"+this.model.get("state")),this.$el},_getFoldoutPanelOptions:function(){var t=h.prototype._getFoldoutPanelOptions.call(this);return e.extend(t,{collection:this.model.outputCollection,selecting:!1})},_labelParamMap:function(){var t=this.model.get("params"),n={};return e.each(this.tool.inputs,function(e){e.label&&"DataToolParameter"!==e.model_class&&(n[e.label]=t[e.name])}),n},_labelInputMap:function(){var t=this,n={};return e.each(this.jobData.inputs,function(e){var i=t._findToolInput(e.name);i&&(n[i.label]=e)}),n},_findToolInput:function(t){var n=this.tool.inputs,i=e.findWhere(n,{name:t});return i||this._findRepeatToolInput(t,n)},_findRepeatToolInput:function(t,n){n=n||this.tool.inputs;var i=e.find(n,function(e){return 0===t.indexOf(e.name)});if(i){return e.find(i.inputs,function(e){return-1!==t.indexOf(e.name)})}},toString:function(){return"JobListItemView("+this.model+")"}});f.prototype.templates=function(){var t=(c.default.wrapTemplate(['<div class="list-element">','<div class="id"><%- model.id %></div>','<div class="warnings"></div>','<div class="selector">','<span class="fa fa-2x fa-square-o"></span>',"</div>",'<div class="primary-actions"></div>','<div class="title-bar"></div>','<div class="details"></div>',"</div>"]),c.default.wrapTemplate(['<div class="title-bar clear" tabindex="0">','<div class="title">','<span class="name"><%- view.tool.name %></span>',"</div>",'<div class="subtitle">','<span class="description"><%- view.tool.description %></span','<span class="create-time">'," ",(0,u.default)("Created"),": <%= new Date( job.create_time ).toString() %>, ","</span","</div>","</div>"],"job")),n=c.default.wrapTemplate(['<div class="subtitle">','<span class="description"><%- view.tool.description %></span',"</div>"],"job"),i=c.default.wrapTemplate(['<div class="details">','<div class="params">',"<% _.each( view._labelInputMap(), function( input, label ){ %>",'<div class="input" data-input-name="<%- input.name %>" data-input-id="<%- input.id %>">','<label class="prompt"><%- label %></label>','<span class="value"><%- input.content.name %></span>',"</div>","<% }) %>","<% _.each( view._labelParamMap(), function( param, label ){ %>",'<div class="param" data-input-name="<%- param.name %>">','<label class="prompt"><%- label %></label>','<span class="value"><%- param %></span>',"</div>","<% }) %>","</div>","</div>"],"job");return e.extend({},h.prototype.templates,{titleBar:t,subtitle:n,details:i})}(),t.default={JobListItemView:f}}).call(t,n(1))},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var r=n(39),a=i(r),o=n(17),s=i(o),l=n(4),c=(i(l),n(3)),d=i(c),u=a.default.ListPanel,h=u.extend({_logNamespace:"dataset",viewClass:s.default.DatasetListItemView,className:u.prototype.className+" dataset-list",noneFoundMsg:(0,d.default)("No matching datasets found"),initialize:function(e){u.prototype.initialize.call(this,e)},toString:function(){return"DatasetList("+this.collection+")"}});t.default={DatasetList:h}},function(e,t,n){"use strict";(function(e){function i(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var a=n(3),o=r(a),s=n(1),l=i(s),c=n(2),d=i(c),u=n(31),h=r(u),f=n(72),p=r(f),g=n(71),m=r(g),_=n(55),v=r(_),y=n(37),b=r(y),w=n(4),x=r(w),k=n(21),M=r(k);n(342),n(40);var C=d.View.extend(x.default.LoggableMixin).extend({_logNamespace:"history",tagName:"div",className:"history-column flex-column flex-row-container",id:function(){return this.model?"history-column-"+this.model.get("id"):""},initialize:function(e){e=e||{},this.purgeAllowed=!l.isUndefined(e.purgeAllowed)&&e.purgeAllowed,this.panel=e.panel||this.createPanel(e),this.setUpListeners()},createPanel:function(e){return new p.default.HistoryViewEdit(l.defaults(e,{model:this.model,purgeAllowed:this.purgeAllowed,dragItems:!0,$scrollContainer:function(){return this.$el}}))},setUpListeners:function(){var e=this;this.once("rendered",function(){e.trigger("rendered:initial",e)}),this.setUpPanelListeners()},setUpPanelListeners:function(){var e=this;this.listenTo(this.panel,{rendered:function(){e.trigger("rendered",e)},"view:expanded view:rendered":function(e){e.$(".rerun-btn").off()}},this)},inView:function(e,t){var n=this.$el.offset().left;return!(n+this.$el.width()<e||n>t)},$panel:function(){return this.$(".history-panel")},render:function(e){e=void 0!==e?e:"fast";var t=this.model?this.model.toJSON():{};return this.$el.html(this.template(t)),this.renderPanel(e),this.panel.$el.css("display","flex"),this.setUpBehaviors(),this},setUpBehaviors:function(){},template:function(t){return t=l.extend(t||{},{isCurrentHistory:this.currentHistory}),e(['<div class="panel-controls clear flex-row">',this.controlsLeftTemplate({history:t,view:this}),this.controlsRightTemplate({history:t,view:this}),"</div>",'<div class="inner flex-row flex-column-container">','<div id="history-',t.id,'" class="history-column history-panel flex-column"></div>',"</div>"].join(""))},renderPanel:function(e){return e=void 0!==e?e:"fast",this.panel.setElement(this.$panel()).render(e),this.currentHistory&&this.panel.$list().before(this.panel._renderDropTargetHelp()),this},events:{"click .switch-to.btn":function(){this.model.setAsCurrent()},"click .delete-history":function(){var e=this;this.model._delete().done(function(t){e.render()})},"click .undelete-history":function(){var e=this;this.model.undelete().done(function(t){e.render()})},"click .purge-history":function(){var e=this;confirm((0,o.default)("This will permanently remove the data. Are you sure?"))&&this.model.purge().done(function(t){e.render()})},"click .copy-history":"copy"},copy:function(){(0,v.default)(this.model)},controlsLeftTemplate:l.template(['<div class="pull-left">',"<% if( data.history.isCurrentHistory ){ %>",'<strong class="current-label">',(0,o.default)("Current History"),"</strong>","<% } else { %>",'<button class="switch-to btn btn-default">',(0,o.default)("Switch to"),"</button>","<% } %>","</div>"].join(""),{variable:"data"}),controlsRightTemplate:l.template(['<div class="pull-right">',"<% if( !data.history.purged ){ %>",'<div class="panel-menu btn-group">','<button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">','<span class="caret"></span>',"</button>",'<ul class="dropdown-menu pull-right" role="menu">',"<% if( !data.history.deleted ){ %>",'<li><a href="javascript:void(0);" class="copy-history">',(0,o.default)("Copy"),"</a></li>",'<li><a href="javascript:void(0);" class="delete-history">',(0,o.default)("Delete"),"</a></li>","<% } else /* if is deleted */ { %>",'<li><a href="javascript:void(0);" class="undelete-history">',(0,o.default)("Undelete"),"</a></li>","<% } %>","<% if( data.view.purgeAllowed ){ %>",'<li><a href="javascript:void(0);" class="purge-history">',(0,o.default)("Purge"),"</a></li>","<% } %>","</ul>","</div>","<% } %>","</div>"].join(""),{variable:"data"}),toString:function(){return"HistoryViewColumn("+(this.panel?this.panel:"")+")"}}),S=d.View.extend(x.default.LoggableMixin).extend({_logNamespace:"history",className:"multi-panel-history",initialize:function(e){e=e||{},this.log(this+".init",e),this.$el.addClass(this.className),this.options={columnWidth:312,borderWidth:1,columnGap:8,headerHeight:29,footerHeight:0,controlsHeight:20},this.perPage=e.perPage||10,this.hdaQueue=new M.default.NamedAjaxQueue([],!1),this.collection=null,this.columnMap={},this.columnOptions=e.columnOptions||{},this.historySearch=null,this.datasetSearch=null,this.setCollection(e.histories),this.setUpListeners()},setUpListeners:function(){var e=this;this.on("end-of-scroll",function(){e.collection.fetchMore()})},setCollection:function(e){return this.stopListening(this.collection),this.collection=e||new h.default.HistoryCollection,this.setUpCollectionListeners(),this.createColumns(),this.hdaQueue.clear(),this.trigger("new-collection",this),this},addModels:function(e,t,n){var i=this;return n=n||{},e=l.isArray(e)?e:[e],e.forEach(function(e){i.addColumn(e,!1)}),this},setUpCollectionListeners:function(){this.listenTo(this.collection,{error:this.errorHandler,add:this.addModels,"all-fetched":this._postFetchAll,"new-current":this.addAsCurrentColumn,"set-as-current":this.setCurrentHistory,"change:deleted change:purged":this.handleDeletedHistory,sort:function(){this.renderColumns(0)}})},_postFetchAll:function(e){if(this.$(".histories-loading-indicator").remove(),!this.historySearch){var t=this.$(".outer-middle");t.scrollLeft(t.scrollLeft()+24)}},setCurrentHistory:function(e){this.log("setCurrentHistory:",e);var t=l.findWhere(this.columnMap,{currentHistory:!0});t&&(t.currentHistory=!1,t.$el.height(""));var n=this.columnMap[this.collection.currentHistoryId];return n.currentHistory=!0,this.collection.sort(),this._recalcFirstColumnHeight(),n},handleDeletedHistory:function(e){if(e.get("deleted")||e.get("purged")){this.log("handleDeletedHistory",this.collection.includeDeleted,e);var t=this.columnMap[e.id];if(!t)return;t.model.id===this.collection.currentHistoryId||this.collection.includeDeleted||this.removeColumn(t)}},errorHandler:function(e,t,n){if(!t||0!==t.status||0!==t.readyState){if(this.error(e,t,n),l.isString(e)&&l.isString(t)){var i=e,r=t;return b.default.errorModal(i,r,n)}return t&&502===t.status?b.default.badGatewayErrorModal():b.default.ajaxErrorModal(e,t,n)}},_ajaxErrorHandler:function(){b.default.ajaxErrorModal.apply(null,l.toArray(arguments))},create:function(e){return this.collection.create({current:!0})},createColumns:function(e,t){var n=this;t=t||this.options.columnOptions,this.columnMap={},this.collection.each(function(e,i){n.columnMap[e.id]=n.createColumn(e,t)})},createColumn:function(e,t){t=l.extend({},t,{model:e,purgeAllowed:Galaxy.config.allow_user_dataset_purge});var n=new C(t);return e.id===this.collection.currentHistoryId&&(n.currentHistory=!0),this.setUpColumnListeners(n),this.datasetSearch&&(n.panel.searchItems(this.datasetSearch),this.queueHdaFetchDetails(n)),n},addColumn:function(e,t){t=void 0===t||t;var n=this.createColumn(e);return this.columnMap[e.id]=n,t&&this.renderColumns(),n},addAsCurrentColumn:function(e,t,n){var i=this,r=this.addColumn(e,!1);return this.setCurrentHistory(e),r.once("rendered",function(){i.queueHdaFetch(r)}),r},removeColumn:function(t,n){var i=this;if(n=void 0===n||n,this.log("removeColumn",t),t){var r=this.options.columnWidth+this.options.columnGap;t.$el.fadeOut("fast",function(){n&&(e(i).remove(),i.$(".middle").width(i.$(".middle").width()-r),i.checkColumnsInView(),i._recalcFirstColumnHeight()),i.stopListening(t.panel),i.stopListening(t),delete i.columnMap[t.model.id],t.remove()})}},setUpColumnListeners:function(e){var t=this;this.listenTo(e,{"in-view":this.queueHdaFetch}),this.listenTo(e.panel,{"view:draggable:dragstart":function(e,n,i,r){t._dropData=JSON.parse(e.dataTransfer.getData("text")),t.currentColumnDropTargetOn()},"view:draggable:dragend":function(e,n,i,r){t._dropData=null,t.currentColumnDropTargetOff()},"droptarget:drop":function(e,n,i){var r=t._dropData.filter(function(e){return i.model.contents.isCopyable(e)});t._dropData=null;var a=new M.default.NamedAjaxQueue;0!==i.model.contents.currentPage&&a.add({name:"fetch-front-page",fn:function(){return i.model.contents.fetchPage(0)}}),r.reverse().forEach(function(e){a.add({name:"copy-"+e.id,fn:function(){return i.model.contents.copy(e)}})}),a.start(),a.done(function(e){i.model.fetch()})}})},columnMapLength:function(){return Object.keys(this.columnMap).length},sortedFilteredColumns:function(e){return e=e||this.filters,e&&e.length?this.sortedColumns().filter(function(t,n){return t.currentHistory||l.every(e.map(function(e){return e.call(t)}))}):this.sortedColumns()},sortedColumns:function(){var e=this;return this.collection.map(function(t,n){return e.columnMap[t.id]})},render:function(e){return e=void 0!==e?e:this.fxSpeed,this.log(this+".render"),this.$el.html(this.mainTemplate(this)),this.renderColumns(e),this.setUpBehaviors(),this.trigger("rendered",this),this},renderColumns:function(e){e=l.isNumber(e)?e:this.fxSpeed;var t=this.sortedFilteredColumns(),n=this.$(".middle").empty();return this._addColumns(t,e),this.collection.allFetched||n.append(this.loadingIndicatorTemplate(this)),this.trigger("columns-rendered",t,this),(!this.datasetSearch||t.length>1)&&(this.checkColumnsInView(),this._recalcFirstColumnHeight()),t},_addColumns:function(e,t){t=l.isNumber(t)?t:this.fxSpeed;var n=this.$(".middle"),i=n.children(".history-column").length;n.width(this._calcMiddleWidth(e.length+i)),e.forEach(function(e,i){e.delegateEvents().render(t).$el.appendTo(n)})},_calcMiddleWidth:function(e){return e*(this.options.columnWidth+this.options.columnGap)+this.options.columnGap+16},queueHdaFetch:function(e){var t=e.model.contents;if(0===t.length&&e.model.contentsShown()){var n={silent:!0},i=l.values(t.storage.allExpanded()).join();i&&(n.details=i),this.hdaQueue.add({name:e.model.id,fn:function(){return t.fetchCurrentPage(n).done(function(){e.panel.renderItems()}).done(function(){m.default.FETCH_STATE_ON_ADD||t.jobStateSummariesCollection.fetch()})}}),this.hdaQueue.running||this.hdaQueue.start()}},queueHdaFetchDetails:function(e){var t=e.model.contents;!(0===t.length&&e.model.contentsShown())&&t.haveDetails()||(this.hdaQueue.add({name:e.model.id,fn:function(){return t.progressivelyFetchDetails().done(function(){e.panel._renderEmptyMessage()})}}),this.hdaQueue.running||this.hdaQueue.start())},renderInfo:function(e){return this.$(".header .header-info").text(e)},events:{"click .done.btn":"close","click .create-new.btn":"create","click #include-deleted":"_clickToggleDeletedHistories","click .order .set-order":"_chooseOrder","click #toggle-deleted":"_clickToggleDeletedDatasets","click #toggle-hidden":"_clickToggleHiddenDatasets"},close:function(e){window.location=Galaxy.root},_clickToggleDeletedHistories:function(t){this.toggleDeletedHistories(e(t.currentTarget).is(":checked")),this.toggleOptionsPopover()},toggleDeletedHistories:function(e){window.location=e?Galaxy.root+"history/view_multiple?include_deleted_histories=True":Galaxy.root+"history/view_multiple"},_clickToggleDeletedDatasets:function(t){this.toggleDeletedDatasets(e(t.currentTarget).is(":checked")),this.toggleOptionsPopover()},toggleDeletedDatasets:function(e){e=void 0!==e&&e,this.sortedFilteredColumns().forEach(function(t,n){l.delay(function(){t.panel.toggleShowDeleted(e,!1)},200*n)})},_clickToggleHiddenDatasets:function(t){this.toggleHiddenDatasets(e(t.currentTarget).is(":checked")),this.toggleOptionsPopover()},toggleHiddenDatasets:function(e){e=void 0!==e&&e,this.sortedFilteredColumns().forEach(function(t,n){l.delay(function(){t.panel.toggleShowHidden(e,!1)},200*n)})},_chooseOrder:function(t){var n=this,i=this.collection,r=e(t.currentTarget).data("order");this.$(".current-order").text(this.orderDescriptions[r]),this.toggleOptionsPopover(),i.setOrder(r);var a=i.slice(0,1);i.fetchFirst().done(function(){i.unshift(a,{silent:!0}),n.createColumns(),n.hdaQueue.clear(),n.render()}),this.once("columns-rendered",this._scrollLeft)},_scrollLeft:function(e){e=l.isNumber(e)?e:0,this.$(".outer-middle").scrollLeft(e)},setUpBehaviors:function(){var t=this;this._moreOptionsPopover(),this.$("#search-histories").searchInput({name:"search-histories",placeholder:(0,o.default)("search histories"),onfirstsearch:function(e){t.$("#search-histories").searchInput("toggle-loading"),t.renderInfo((0,o.default)("loading all histories for search")),t.collection.fetchAll().done(function(){t.$("#search-histories").searchInput("toggle-loading"),t.renderInfo("")})},onsearch:function(e){t.historySearch=e,t.filters=[function(){return t.model.matchesAll(t.historySearch)}],t.renderColumns(0)},onclear:function(e){t.historySearch=null,t.filters=[],t.renderColumns(0)}}),this.$("#search-datasets").searchInput({name:"search-datasets",placeholder:(0,o.default)("search all datasets"),onfirstsearch:function(e){t.hdaQueue.clear(),t.$("#search-datasets").searchInput("toggle-loading"),t.datasetSearch=e,t.sortedFilteredColumns().forEach(function(n){n.panel.searchItems(e),t.queueHdaFetchDetails(n)}),t.hdaQueue.progress(function(e){t.renderInfo([(0,o.default)("searching"),e.curr+1,(0,o.default)("of"),e.total].join(" "))}),t.hdaQueue.deferred.done(function(){t.renderInfo(""),t.$("#search-datasets").searchInput("toggle-loading")})},onsearch:function(e){t.datasetSearch=e,t.sortedFilteredColumns().forEach(function(t){t.panel.searchItems(e)})},onclear:function(e){t.datasetSearch=null,t.sortedFilteredColumns().forEach(function(e){e.panel.clearSearch()})}}),e(window).resize(function(){t._recalcFirstColumnHeight()});var n=l.debounce(function(){var e=t._viewport();t.checkColumnsInView(e),t.checkForEndOfScroll(e)},100);this.$(".middle").parent().scroll(n)},_moreOptionsPopover:function(){return this.$(".open-more-options.btn").popover({container:".header",placement:"bottom",html:!0,content:e(this.optionsPopoverTemplate(this))})},toggleOptionsPopover:function(e){this.$(".open-more-options.btn").popover("toggle")},_recalcFirstColumnHeight:function(){var e=this.$(".history-column").first(),t=this.$(".middle").height(),n=e.find(".panel-controls").height();e.height(t).find(".inner").height(t-n)},_viewport:function(){var e=this.$(".middle").parent(),t=e.offset().left;return{left:t,right:t+e.width()}},columnsInView:function(e){var t=e||this._viewport();return this.sortedFilteredColumns().filter(function(e){return e.currentHistory||e.inView(t.left,t.right)})},checkColumnsInView:function(){this.columnsInView().forEach(function(e){e.trigger("in-view",e)})},checkForEndOfScroll:function(e){e=e||this._viewport();var t=this.$(".middle");t.parent().scrollLeft()+e.right>=t.width()-16&&this.trigger("end-of-scroll")},currentColumnDropTargetOn:function(){var e=this.columnMap[this.collection.currentHistoryId];e&&(e.panel.dataDropped=function(e){},e.panel.dropTargetOn())},currentColumnDropTargetOff:function(){var e=this.columnMap[this.collection.currentHistoryId];e&&(e.panel.dataDropped=p.default.HistoryViewEdit.prototype.dataDrop,e.panel.dropTarget=!1,e.panel.$(".history-drop-target").remove())},toString:function(){return"MultiPanelColumns("+(this.columns?this.columns.length:0)+")"},mainTemplate:l.template(['<div class="header flex-column-container">','<div class="control-column control-column-left flex-column">','<button class="done btn btn-default" tabindex="1">',(0,o.default)("Done"),"</button>",'<div id="search-histories" class="search-control"></div>','<div id="search-datasets" class="search-control"></div>','<a class="open-more-options btn btn-default" tabindex="3">','<span class="fa fa-ellipsis-h"></span>',"</a>","</div>",'<div class="control-column control-column-center flex-column">','<div class="header-info">',"</div>","</div>",'<div class="control-column control-column-right flex-column">','<button class="create-new btn btn-default" tabindex="4">',(0,o.default)("Create new"),"</button> ","</div>","</div>",'<div class="outer-middle flex-row flex-row-container">','<div class="middle flex-column-container flex-row"></div>',"</div>",'<div class="footer flex-column-container"></div>'].join(""),{variable:"view"}),loadingIndicatorTemplate:l.template(['<div class="histories-loading-indicator">','<span class="fa fa-spin fa-spinner"></span>',(0,o.default)("Loading histories"),"...","</div>"].join(""),{variable:"view"}),orderDescriptions:{update_time:(0,o.default)("most recent first"),"update_time-asc":(0,o.default)("least recent first"),name:(0,o.default)("name, a to z"),"name-dsc":(0,o.default)("name, z to a"),size:(0,o.default)("size, large to small"),"size-asc":(0,o.default)("size, small to large")},optionsPopoverTemplate:l.template(['<div class="more-options">','<div class="order btn-group">','<button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">',(0,o.default)("Order histories by")+" ",'<span class="current-order"><%- view.orderDescriptions[ view.collection.order ] %></span> ','<span class="caret"></span>',"</button>",'<ul class="dropdown-menu" role="menu">',"<% _.each( view.orderDescriptions, function( text, order ){ %>",'<li><a href="javascript:void(0);" class="set-order" data-order="<%- order %>">',"<%- text %>","</a></li>","<% }); %>","</ul>","</div>",'<div class="checkbox"><label><input id="include-deleted" type="checkbox"','<%= view.collection.includeDeleted? " checked" : "" %>>',(0,o.default)("Include deleted histories"),"</label></div>","<hr />",'<div class="checkbox"><label><input id="toggle-deleted" type="checkbox">',(0,o.default)("Include deleted datasets"),"</label></div>",'<div class="checkbox"><label><input id="toggle-hidden" type="checkbox">',(0,o.default)("Include hidden datasets"),"</label></div>","</div>"].join(""),{variable:"view"})});t.default={MultiPanelColumns:S}}).call(t,n(0))},function(e,t,n){"use strict";function i(e,t){return this.currModeIndex=0,this._init(e,t)}var r=n(0),a=function(e){return e&&e.__esModule?e:{default:e}}(r),o=a.default;i.prototype.DATA_KEY="mode-button",i.prototype.defaults={switchModesOnClick:!0},i.prototype._init=function(e,t){if(t=t||{},this.$element=o(e),this.options=o.extend(!0,{},this.defaults,t),!t.modes)throw new Error('ModeButton requires a "modes" array');var n=this;return this.$element.click(function(e){n.callModeFn(),n.options.switchModesOnClick&&n._incModeIndex(),o(this).html(n.options.modes[n.currModeIndex].html)}),this.reset()},i.prototype._incModeIndex=function(){return this.currModeIndex+=1,this.currModeIndex>=this.options.modes.length&&(this.currModeIndex=0),this},i.prototype._getModeIndex=function(e){for(var t=0;t<this.options.modes.length;t+=1)if(this.options.modes[t].mode===e)return t;throw new Error("mode not found: "+e)},i.prototype._setModeByIndex=function(e){var t=this.options.modes[e];if(!t)throw new Error("mode index not found: "+e);return this.currModeIndex=e,t.html&&this.$element.html(t.html),this},i.prototype.currentMode=function(){return this.options.modes[this.currModeIndex]},i.prototype.current=function(){return this.currentMode().mode},i.prototype.getMode=function(e){return e?this.options.modes[this._getModeIndex(e)]:this.currentMode()},i.prototype.hasMode=function(e){try{return!!this.getMode(e)}catch(e){}return!1},i.prototype.setMode=function(e){return this._setModeByIndex(this._getModeIndex(e))},i.prototype.reset=function(){return this.currModeIndex=0,this.options.initialMode&&(this.currModeIndex=this._getModeIndex(this.options.initialMode)),this._setModeByIndex(this.currModeIndex)},i.prototype.callModeFn=function(e){var t=this.getMode(e).onclick;if(t&&o.type("function"===t))return t.call(this.$element.get(0))},o.fn.modeButton=function(e){if(!this.length)return this;if("object"===o.type(e))return this.map(function(){var t=o(this);return t.data("mode-button",new i(t,e)),this});var t=o(this[0]),n=t.data("mode-button");if(!n)throw new Error("modeButton needs an options object or string name of a function");if(n&&"string"===o.type(e)){var r=e;if(n&&"function"===o.type(n[r]))return n[r].apply(n,o.makeArray(arguments).slice(1))}return n}},function(e,t,n){"use strict";(function(e,i){function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var a=n(58),o=r(a),s=n(41),l=(r(s),n(42)),c=(r(l),n(4)),d=(r(c),n(3)),u=r(d),h=o.default.HistoryView,f=h.extend({className:h.prototype.className+" annotated-history-panel",_buildNewRender:function(){var e=h.prototype._buildNewRender.call(this);return this.renderHistoryAnnotation(e),e},renderHistoryAnnotation:function(e){var t=this.model.get("annotation");t&&e.find("> .controls .subtitle").text(t)},renderItems:function(t){t=t||this.$el,h.prototype.renderItems.call(this,t);var n=t.find("> .controls");n.find(".contents-container.headers").remove();e('<div class="contents-container headers"/>').append([e('<div class="history-content header"/>').text((0,u.default)("Dataset")),e('<div class="additional-info header"/>').text((0,u.default)("Annotation"))]).appendTo(n);return self.views},_renderItemView$el:function(t){return e('<div class="contents-container"/>').append([t.render(0).$el,e('<div class="additional-info"/>').text(t.model.get("annotation")||"")])},events:i.extend(i.clone(h.prototype.events),{"click .contents-container":function(t){t.stopPropagation(),e(t.currentTarget).find(".list-item .title-bar").click()},"click .icon-btn":function(t){t.stopPropagation();var n=e(t.currentTarget);n.length&&"dropdown"===n.attr("data-toggle")&&n.dropdown("toggle")}}),_clickSectionLink:function(t){var n=e(t.currentTarget).parent().parent().data("section");this.openSection(n)},toString:function(){return"AnnotatedHistoryView("+(this.model?this.model.get("name"):"")+")"}});t.default={AnnotatedHistoryView:f}}).call(t,n(0),n(1))},function(e,t,n){"use strict";(function(e,i,r,a){function o(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var s=n(5),l=o(s),c=n(345),d=o(c),u=n(346),h=o(u),f=n(47),p=o(f);e.ajaxSettings.traditional=!0,t.default=i.View.extend({grid:null,initialize:function(e){this.grid=new d.default,this.dict_format=e.dict_format,this.title=e.title;var t=this;if(window.add_tag_to_grid_filter=function(e,n){var i=e+(void 0!==n&&""!==n?":"+n:"");r("#advanced-search").is(":visible")||(r("#standard-search").slideToggle("fast"),r("#advanced-search").slideToggle("fast")),t.add_filter_condition("tags",i)},this.dict_format)if(this.setElement("<div/>"),e.url_base&&!e.items){var n=e.url_data||{};a.each(e.filters,function(e,t){n["f-"+t]=e}),r.ajax({url:e.url_base+"?"+r.param(n),success:function(n){n.embedded=e.embedded,n.filters=e.filters||{},t.init_grid(n)}})}else this.init_grid(e);else this.setElement("#grid-container"),this.init_grid(e);e.use_panels&&r("#center").css({padding:"10px",overflow:"auto"})},handle_refresh:function(e){e&&r.inArray("history",e)>-1&&window.top.Galaxy&&window.top.Galaxy.currHistoryPanel&&window.top.Galaxy.currHistoryPanel.loadCurrentHistory()},init_grid:function(e){this.grid.set(e);var t=this.grid.attributes;this.allow_title_display&&t.title&&l.default.setWindowTitle(t.title),this.handle_refresh(t.refresh_frames);var n=this.grid.get("url_base");if(n=n.replace(/^.*\/\/[^\/]+/,""),this.grid.set("url_base",n),this.$el.html(h.default.grid(t)),this.$el.find("#grid-table-header").html(h.default.header(t)),this.$el.find("#grid-table-body").html(h.default.body(t)),this.$el.find("#grid-table-footer").html(h.default.footer(t)),t.message){this.$el.find("#grid-message").html(h.default.message(t));var i=this;t.use_hide_message&&setTimeout(function(){i.$el.find("#grid-message").html("")},5e3)}this.init_grid_elements(),this.init_grid_controls(),window.init_refresh_on_change&&window.init_refresh_on_change()},init_grid_controls:function(){var e=this;this.$el.find(".operation-button").each(function(){r(this).off(),r(this).click(function(){return e.submit_operation(this),!1})}),this.$el.find("input[type=text]").each(function(){r(this).off(),r(this).click(function(){r(this).select()}).keyup(function(){r(this).css("font-style","normal")})}),this.$el.find(".sort-link").each(function(){r(this).off(),r(this).click(function(){return e.set_sort_condition(r(this).attr("sort_key")),!1})}),this.$el.find(".text-filter-form").each(function(){r(this).off(),r(this).submit(function(){var t=r(this).attr("column_key"),n=r("#input-"+t+"-filter"),i=n.val();return n.val(""),e.add_filter_condition(t,i),!1})}),this.$el.find(".text-filter-val > a").each(function(){r(this).off(),r(this).click(function(){return r(this).parent().remove(),e.remove_filter_condition(r(this).attr("filter_key"),r(this).attr("filter_val")),!1})}),this.$el.find(".categorical-filter > a").each(function(){r(this).off(),r(this).click(function(){return e.set_categorical_filter(r(this).attr("filter_key"),r(this).attr("filter_val")),!1})}),this.$el.find(".advanced-search-toggle").each(function(){r(this).off(),r(this).click(function(){return e.$el.find("#standard-search").slideToggle("fast"),e.$el.find("#advanced-search").slideToggle("fast"),!1})}),this.$el.find("#check_all").off(),this.$el.find("#check_all").on("click",function(){e.check_all_items()})},init_grid_elements:function(){this.$el.find(".grid").each(function(){var e=r(this).find("input.grid-row-select-checkbox"),t=r(this).find("span.grid-selected-count"),n=function(){t.text(r(e).filter(":checked").length)};r(e).each(function(){r(this).change(n)}),n()}),0!==this.$el.find(".community_rating_star").length&&this.$el.find(".community_rating_star").rating({});var e=this.grid.attributes,t=this;this.$el.find(".page-link > a").each(function(){r(this).click(function(){return t.set_page(r(this).attr("page_num")),!1})}),this.$el.find(".use-target").each(function(){r(this).click(function(){return t.execute({href:r(this).attr("href"),target:r(this).attr("target")}),!1})}),0!==e.items.length&&a.each(e.items,function(n,i){var r=t.$("#grid-"+n.encode_id+"-popup").off(),o=new p.default(r);a.each(e.operations,function(e){t._add_operation(o,e,n)})})},_add_operation:function(e,t,n){var i=this,a=n.operation_config[t.label];a.allowed&&t.allow_popup&&e.addItem({html:t.label,href:a.url_args,target:a.target,confirmation_text:t.confirm,func:function(e){e.preventDefault();var a=r(e.target).html();t.onclick?t.onclick(n.encode_id):i.execute(this.findItemByHtml(a))}})},add_filter_condition:function(e,t){if(""===t)return!1;this.grid.add_filter(e,t,!0);var n=r(h.default.filter_element(e,t)),i=this;n.click(function(){r(this).remove(),i.remove_filter_condition(e,t)}),this.$el.find("#"+e+"-filtering-criteria").append(n),this.go_page_one(),this.execute()},remove_filter_condition:function(e,t){this.grid.remove_filter(e,t),this.go_page_one(),this.execute()},set_sort_condition:function(e){var t=this.grid.get("sort_key"),n=e;-1!==t.indexOf(e)&&"-"!==t.substring(0,1)&&(n="-"+e),this.$el.find(".sort-arrow").remove();var i="-"==n.substring(0,1)?"&uarr;":"&darr;",a=r("<span>"+i+"</span>").addClass("sort-arrow");this.$el.find("#"+e+"-header").append(a),this.grid.set("sort_key",n),this.go_page_one(),this.execute()},set_categorical_filter:function(e,t){var n=this.grid.get("categorical_filters")[e],i=this.grid.get("filters")[e],a=this;this.$el.find("."+e+"-filter").each(function(){var o=r.trim(r(this).text()),s=n[o],l=s[e];if(l==t)r(this).empty(),r(this).addClass("current-filter"),r(this).append(o);else if(l==i){r(this).empty();var c=r('<a href="#">'+o+"</a>");c.click(function(){a.set_categorical_filter(e,l)}),r(this).removeClass("current-filter"),r(this).append(c)}}),this.grid.add_filter(e,t),this.go_page_one(),this.execute()},set_page:function(e){var t=this;this.$el.find(".page-link").each(function(){var n,i=r(this).attr("id"),a=parseInt(i.split("-")[2],10),o=t.grid.get("cur_page");if(a===e)n=r(this).children().text(),r(this).empty(),r(this).addClass("inactive-link"),r(this).text(n);else if(a===o){n=r(this).text(),r(this).empty(),r(this).removeClass("inactive-link");var s=r('<a href="#">'+n+"</a>");s.click(function(){t.set_page(a)}),r(this).append(s)}}),"all"===e?this.grid.set("cur_page",e):this.grid.set("cur_page",parseInt(e,10)),this.execute()},submit_operation:function(e,t){var n=r(e).val();if(this.$el.find('input[name="id"]:checked').length<1)return!1;var i=a.findWhere(this.grid.attributes.operations,{label:n});i&&!t&&(t=i.confirm||"");var o=[];this.$el.find("input[name=id]:checked").each(function(){o.push(r(this).val())});var s={operation:n,id:o,confirmation_text:t};return"top"!=i.target&&"center"!=i.target||(s=a.extend(s,{href:i.href,target:i.target})),this.execute(s),!0},check_all_items:function(){var e=this.$(".grid-row-select-checkbox"),t=this.$("#check_all").prop("checked");a.each(e,function(e){r(e).prop("checked",t)}),this.init_grid_elements()},go_page_one:function(){var e=this.grid.get("cur_page");null!==e&&void 0!==e&&"all"!==e&&this.grid.set("cur_page",1)},execute:function(e){var t=null,n=null,i=null,a=null,o=null;if(e&&(n=e.href,i=e.operation,t=e.id,a=e.confirmation_text,o=e.target,void 0!==n&&-1!=n.indexOf("operation="))){var s=n.split("?");if(s.length>1)for(var l=s[1],c=l.split("&"),d=0;d<c.length;d++)-1!=c[d].indexOf("operation")?(i=c[d].split("=")[1],i=i.replace(/\+/g," ")):-1!=c[d].indexOf("id")&&(t=c[d].split("=")[1])}return i&&t?!(a&&""!==a&&"None"!=a&&"null"!=a&&!confirm(a))&&(i=i.toLowerCase(),this.grid.set({operation:i,item_ids:t}),"top"==o?window.top.location=n+"?"+r.param(this.grid.get_url_data()):"center"==o?r("#galaxy_main").attr("src",n+"?"+r.param(this.grid.get_url_data())):this.grid.can_async_op(i)||this.dict_format?this.update_grid():this.go_to(o,n),!1):n?(this.go_to(o,n),!1):(this.grid.get("async")||this.dict_format?this.update_grid():this.go_to(o,n),!1)},go_to:function(e,t){var n=this.grid.get("async");this.grid.set("async",!1);var i=this.$el.find("#advanced-search").is(":visible");switch(this.grid.set("advanced_search",i),t||(t=this.grid.get("url_base")+"?"+r.param(this.grid.get_url_data())),this.grid.set({operation:void 0,item_ids:void 0,async:n}),e){case"center":r("#galaxy_main").attr("src",t);break;case"top":window.top.location=t;break;default:window.location=t}},update_grid:function(){var e=this.grid.get("operation")?"POST":"GET";this.$el.find(".loading-elt-overlay").show();var t=this;r.ajax({type:e,url:t.grid.get("url_base"),data:t.grid.get_url_data(),error:function(){alert("Grid refresh failed")},success:function(e){var n=t.grid.get("embedded"),i=t.grid.get("insert"),a=t.$el.find("#advanced-search").is(":visible"),o=t.dict_format?e:r.parseJSON(e);o.embedded=n,o.insert=i,o.advanced_search=a,t.init_grid(o),t.$el.find(".loading-elt-overlay").hide()},complete:function(){t.grid.set({operation:void 0,item_ids:void 0})}})}})}).call(t,n(0),n(2),n(0),n(1))},function(e,t,n){"use strict";(function(e,n,i){Object.defineProperty(t,"__esModule",{value:!0}),t.default=e.Model.extend({defaults:{url_base:"",async:!1,async_ops:[],categorical_filters:[],filters:{},sort_key:null,show_item_checkboxes:!1,advanced_search:!1,cur_page:1,num_pages:1,operation:void 0,item_ids:void 0},can_async_op:function(e){return-1!==n.indexOf(this.attributes.async_ops,e)},add_filter:function(e,t,n){if(n){var i,r=this.attributes.filters[e];if(null===r||void 0===r)i=t;else if("string"==typeof r)if("All"==r||r==t)i=t;else{var a=[];a[0]=r,a[1]=t,i=a}else i=r,-1===i.indexOf(t)&&i.push(t);this.attributes.filters[e]=i}else this.attributes.filters[e]=t},remove_filter:function(e,t){var i=this.attributes.filters[e];if(null===i||void 0===i)return!1;if("string"==typeof i)this.attributes.filters[e]="";else{var r=n.indexOf(i,t);-1!==r&&(i[r]="")}},get_url_data:function(){var e={async:this.attributes.async,sort:this.attributes.sort_key,page:this.attributes.cur_page,show_item_checkboxes:this.attributes.show_item_checkboxes,advanced_search:this.attributes.advanced_search};this.attributes.operation&&(e.operation=this.attributes.operation),this.attributes.item_ids&&(e.id=this.attributes.item_ids);var t=this;return n.each(n.pairs(t.attributes.filters),function(t){e["f-"+t[0]]=t[1]}),e},get_url:function(e){return this.get("url_base")+"?"+i.param(this.get_url_data())+"&"+i.param(e)}})}).call(t,n(2),n(1),n(0))},function(e,t,n){"use strict";(function(e,i){Object.defineProperty(t,"__esModule",{value:!0});var r=n(5),a=function(e){return e&&e.__esModule?e:{default:e}}(r);t.default={grid:function(e){var t="";return t=e.embedded?this.grid_header(e)+this.grid_table(e):'<div class="loading-elt-overlay"></div><table><tr><td width="75%">'+this.grid_header(e)+'</td><td></td><td></td></tr><tr><td width="100%" id="grid-message" valign="top"></td><td></td><td></td></tr></table>'+this.grid_table(e),e.info_text&&(t+='<br><div class="toolParamHelp" style="clear: both;">'+e.info_text+"</div>"),t},grid_table:function(){return'\n            <form method="post" onsubmit="return false;">\n                <table id="grid-table" class="grid">\n                    <thead id="grid-table-header"></thead>\n                    <tbody id="grid-table-body"></tbody>\n                    <tfoot id="grid-table-footer"></tfoot>\n                </table>\n            </form>'},grid_header:function(e){var t='<div class="grid-header">';if(e.embedded||(t+="<h2>"+e.title+"</h2>"),e.global_actions){t+='<ul class="manage-table-actions">';var n=e.global_actions.length>=3;n&&(t+='<li><a class="action-button" id="popup-global-actions" class="menubutton">Actions</a></li><div popupmenu="popup-global-actions">');var i=!0,r=!1,a=void 0;try{for(var o,s=e.global_actions[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){var l=o.value;t+='<li><a class="action-button use-target" target="'+l.target+'" href="'+l.url_args+'" onclick="return false;" >'+l.label+"</a></li>"}}catch(e){r=!0,a=e}finally{try{!i&&s.return&&s.return()}finally{if(r)throw a}}n&&(t+="</div>"),t+="</ul>"}return e.insert&&(t+=e.insert),t+=this.grid_filters(e),t+="</div>"},header:function(e){var t="<tr>";e.show_item_checkboxes&&(t+="<th>",e.items.length>0&&(t+='<input type="checkbox" id="check_all" name=select_all_checkbox value="true"><input type="hidden" name=select_all_checkbox value="true">'),t+="</th>");var n=!0,i=!1,r=void 0;try{for(var a,o=e.columns[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){var s=a.value;s.visible&&(t+='<th id="'+s.key+'-header">',s.href?t+='<a href="'+s.href+'" class="sort-link" sort_key="'+s.key+'">'+s.label+"</a>":t+=s.label,t+='<span class="sort-arrow">'+s.extra+"</span></th>")}}catch(e){i=!0,r=e}finally{try{!n&&o.return&&o.return()}finally{if(i)throw r}}return t+="</tr>"},body:function(t){var n="";0===t.items.length&&(n+='<tr><td colspan="100"><em>No Items</em></td></tr>');var i=!0,r=!1,a=void 0;try{for(var o,s=t.items[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){var l=o.value;n+="<tr ",t.current_item_id==l.id&&(n+='class="current"'),n+=">",t.show_item_checkboxes&&(n+='<td style="width: 1.5em;"><input type="checkbox" name="id" value="'+l.encode_id+'" id="'+l.encode_id+'" class="grid-row-select-checkbox" /></td>');var c=!0,d=!1,u=void 0;try{for(var h,f=t.columns[Symbol.iterator]();!(c=(h=f.next()).done);c=!0){var p=h.value;if(p.visible){var g="";p.nowrap&&(g='style="white-space:nowrap;"');var m=l.column_config[p.label],_=m.link,v=m.value,y=m.target;"string"===e.type(v)&&(v=v.replace(/\/\//g,"/"));var b="",w="";p.attach_popup&&(b="grid-"+l.encode_id+"-popup",w="menubutton",""!==_&&(w+=" split"),w+=" popup"),n+="<td "+g+">",_?(0!==t.operations.length&&(n+='<div id="'+b+'" class="'+w+'" style="float: left;">'),n+='<a class="menubutton-label use-target" target="'+y+'" href="'+_+'" onclick="return false;">'+v+"</a>",0!==t.operations.length&&(n+="</div>")):n+='<div id="'+b+'" class="'+w+'"><label id="'+p.label_id_prefix+l.encode_id+'" for="'+l.encode_id+'">'+(v||"")+"</label></div>",n+="</td>"}}}catch(e){d=!0,u=e}finally{try{!c&&f.return&&f.return()}finally{if(d)throw u}}n+="</tr>"}}catch(e){r=!0,a=e}finally{try{!i&&s.return&&s.return()}finally{if(r)throw a}}return n},footer:function(e){var t="";if(e.use_paging&&e.num_pages>1){var n=e.num_page_links,i=e.cur_page_num,r=e.num_pages,a=n/2,o=i-a,s=0;o<=0&&(o=1,s=a-(i-o));var l,c=a+s,d=i+c;d<=r?l=0:(d=r,l=c-(d+1-i)),0!==l&&(o-=l)<1&&(o=1),t+='<tr id="page-links-row">',e.show_item_checkboxes&&(t+="<td></td>"),t+='<td colspan="100"><span id="page-link-container">Page:',o>1&&(t+='<span class="page-link" id="page-link-1"><a href="javascript:void(0);" page_num="1" onclick="return false;">1</a></span> ...');for(var u=o;u<d+1;u++)u==e.cur_page_num?t+='<span class="page-link inactive-link" id="page-link-'+u+'">'+u+"</span>":t+='<span class="page-link" id="page-link-'+u+'"><a href="javascript:void(0);" onclick="return false;" page_num="'+u+'">'+u+"</a></span>";d<r&&(t+='...<span class="page-link" id="page-link-'+r+'"><a href="javascript:void(0);" onclick="return false;" page_num="'+r+'">'+r+"</a></span>"),t+="</span>",t+='\n                    <span class="page-link" id="show-all-link-span"> | <a href="javascript:void(0);" onclick="return false;" page_num="all">Show All</a></span>\n                    </td>\n                </tr>'}if(e.show_item_checkboxes){t+='\n                <tr>\n                    <input type="hidden" id="operation" name="operation" value="">\n                    <td></td>\n                    <td colspan="100">\n                        For <span class="grid-selected-count"></span> selected items: \n            ';var h=!0,f=!1,p=void 0;try{for(var g,m=e.operations[Symbol.iterator]();!(h=(g=m.next()).done);h=!0){var _=g.value;_.allow_multiple&&(t+='<input type="button" value="'+_.label+'" class="operation-button action-button">&nbsp;')}}catch(e){f=!0,p=e}finally{try{!h&&m.return&&m.return()}finally{if(f)throw p}}t+="</td></tr>"}var v=!1,y=!0,b=!1,w=void 0;try{for(var x,k=e.operations[Symbol.iterator]();!(y=(x=k.next()).done);y=!0){if(x.value.global_operation){v=!0;break}}}catch(e){b=!0,w=e}finally{try{!y&&k.return&&k.return()}finally{if(b)throw w}}if(v){t+='<tr><td colspan="100">';var M=!0,C=!1,S=void 0;try{for(var T,E=e.operations[Symbol.iterator]();!(M=(T=E.next()).done);M=!0){var j=T.value;j.global_operation&&(t+='<a class="action-button" href="'+j.global_operation+'">'+j.label+"</a>")}}catch(e){C=!0,S=e}finally{try{!M&&E.return&&E.return()}finally{if(C)throw S}}t+="</td></tr>"}return e.legend&&(t+='<tr><td colspan="100">'+e.legend+"</td></tr>"),t},message:function(e){var t=e.status;return-1!=["success","ok"].indexOf(t)&&(t="done"),'<p><div class="'+t+'message transient-message">'+i.escape(e.message)+'</div><div style="clear: both"></div></p>'},grid_filters:function(e){var t=e.default_filter_dict,n=e.filters,i="none";e.advanced_search&&(i="block");var r=!1,a=!0,o=!1,s=void 0;try{for(var l,c=e.columns[Symbol.iterator]();!(a=(l=c.next()).done);a=!0){var d=l.value;if("advanced"==d.filterable){var u=d.key,h=n[u],f=t[u];h&&f&&h!=f&&(i="block"),r=!0}}}catch(e){o=!0,s=e}finally{try{!a&&c.return&&c.return()}finally{if(o)throw s}}var p="block";"block"==i&&(p="none");var g='<div id="standard-search" style="display: '+p+';"><table><tr><td style="padding: 0;"><table>',m=!0,_=!1,v=void 0;try{for(var y,b=e.columns[Symbol.iterator]();!(m=(y=b.next()).done);m=!0){var w=y.value;"standard"==w.filterable&&(g+=this.grid_column_filter(e,w))}}catch(e){_=!0,v=e}finally{try{!m&&b.return&&b.return()}finally{if(_)throw v}}g+="</table></td></tr><tr><td>",r&&(g+='<a href="" class="advanced-search-toggle">Advanced Search</a>'),g+="</td></tr></table></div>",g+='<div id="advanced-search" style="display: '+i+'; margin-top: 5px; border: 1px solid #ccc;"><table><tr><td style="text-align: left" colspan="100"><a href="" class="advanced-search-toggle">Close Advanced Search</a></td></tr>';var x=!0,k=!1,M=void 0;try{for(var C,S=e.columns[Symbol.iterator]();!(x=(C=S.next()).done);x=!0){var T=C.value;"advanced"==T.filterable&&(g+=this.grid_column_filter(e,T))}}catch(e){k=!0,M=e}finally{try{!x&&S.return&&S.return()}finally{if(k)throw M}}return g+="</table></div>"},grid_column_filter:function(t,n){var i=t.filters,r=n.label,a=n.key;"advanced"==n.filterable&&(r=r.toLowerCase());var o="<tr>";if("advanced"==n.filterable&&(o+='<td align="left" style="padding-left: 10px">'+r+":</td>"),o+='<td style="padding-bottom: 1px;">',n.is_text){o+='<form class="text-filter-form" column_key="'+a+'" action="'+t.url+'" method="get" >';var s=!0,l=!1,c=void 0;try{for(var d,u=t.columns[Symbol.iterator]();!(s=(d=u.next()).done);s=!0){var h=d.value,f=i[h.key];f&&"All"!=f&&(h.is_text&&(f=JSON.stringify(f)),o+='<input type="hidden" id="'+h.key+'" name="f-'+h.key+'" value="'+f+'"/>')}}catch(e){l=!0,c=e}finally{try{!s&&u.return&&u.return()}finally{if(l)throw c}}o+='<span id="'+a+'-filtering-criteria">';var p=i[a];if(p){var g=e.type(p);if("string"==g&&"All"!=p&&(o+=this.filter_element(a,p)),"array"==g)for(var m in p){var _=p;_=_.slice(m),o+=this.filter_element(a,p[m])}}o+="</span>";var v="",y=20;"standard"==n.filterable&&(v=n.label.toLowerCase(),v.length<20&&(y=v.length),y+=4),o+='\n                <span class="search-box">\n                    <input class="search-box-input" id="input-'+a+'-filter" name="f-'+a+'" type="text" placeholder="'+v+'" size="'+y+'"/>\n                    <button type="submit" style="background: transparent; border: none; padding: 4px; margin: 0px;">\n                        <i class="fa fa-search"></i>\n                    </button>\n                </span>\n            </form>'}else{o+='<span id="'+a+'-filtering-criteria">';var b=!1;for(var w in t.categorical_filters[a]){var x=t.categorical_filters[a][w],k="",M="";for(var C in x)k=C,M=x[C];b&&(o+=" | "),b=!0;var S=i[a];S&&x[a]&&S==M?o+='<span class="categorical-filter '+a+'-filter current-filter">'+w+"</span>":o+='<span class="categorical-filter '+a+'-filter"><a href="javascript:void(0);" filter_key="'+k+'" filter_val="'+M+'">'+w+"</a></span>"}o+="</span>"}return o+="</td></tr>"},filter_element:function(e,t){return'<span class="text-filter-val">'+(t=a.default.sanitize(t))+'<a href="javascript:void(0);" filter_key="'+e+'" filter_val="'+t+'"><i class="fa fa-times" style="padding-left: 5px; padding-bottom: 6px;"/></a></span>'}}}).call(t,n(0),n(1))},function(e,t,n){"use strict";(function(e){function i(e,t){return new Date(e.getFullYear(),e.getMonth(),e.getDate()-t,e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds())}function r(e,t){return new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours()-t,e.getMinutes(),e.getSeconds(),e.getMilliseconds())}function a(){var e=new Date;return new Date(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate(),e.getUTCHours(),0,0)}function o(t,n,o,s){function d(){var e=c.select(this).attr("class");e=e.split(" "),c.selectAll("."+e[0]).filter("."+e[1]).style("cursor","zoom-in").transition().duration(750).attr("height",w).attr("width",y),c.select(this).style("cursor","default").transition().duration(750).attr("height",w*b).attr("width",y*b)}var u,h=t,f=[],p=a();for(u=0;u<24;u++)f.push(r(p,u));var g=[];for(u=0;u<30;u++)g.push(i(p,u));var m={top:60,right:30,bottom:50,left:60},_=0;"hours"==o?_=12.5:"days"==o&&(_=10);var v,y=300+m.left+m.right,b=1.75;v=0!==c.max(h)?150/c.max(h):1;var w=150+m.top+m.bottom;e(".charts").css("height",w*b);var x=c.select("#"+n).attr("width",y).attr("height",w).attr("preserveAspectRatio","xMidYMin").attr("viewBox","0 0 "+y+" "+w).on("click",d),k=x.selectAll("g").data(h).enter().append("g").attr("transform",function(e,t){var n=m.left;return"translate("+(n+=+t*_)+","+m.top+")"}).on("mouseenter",function(e){for(var t=1,n=e;n>=10;)n/=10,t++;var i=4*t+10;c.select(l.event.target.parentElement).select(".tool_tip").select("text").attr("transform","translate( "+(m.left-5)+", "+(150-e*v+m.top+10)+" )").attr("visibility","visible").text(e),c.select(l.event.target.parentElement).select(".tool_tip").attr("width",i+"px").attr("height","15px").select("rect").attr("transform","translate( "+(m.left-i)+", "+(150-e*v+m.top)+" )").attr("width",i+"px").attr("height","15px").attr("fill","#ebd9b2")}).on("mouseleave",function(e){c.select(l.event.target.parentElement).select(".tool_tip").select("text").attr("visibility","hidden"),c.select(l.event.target.parentElement).select(".tool_tip").select("rect").attr("width","0").attr("height","0").attr("fill","").text(e)});x.append("g").append("text").attr("class","title").attr("text-anchor","end").attr("transform",function(){return"translate( 300,15 )"}).text(s),x.append("g").attr("class","axis").append("path").attr("class","x").attr("d",function(){var e=m.left,t=m.top+150;return"M"+e+" "+t+" L "+(e+300)+" "+t});var M=c.scale.linear().range([150,0]),C=c.svg.axis().scale(M).orient("left").tickFormat(function(e){return c.round(e*c.max(h),0)});x.append("g").attr("class","y axis").attr("id","y_"+n).attr("text-anchor","end").attr("transform","translate( "+m.left+","+m.top+")").call(C).select(".domain"),x.append("g").append("text").attr("class","ax_title").attr("transform",function(){var e=c.select("#y_"+n).node();return"translate("+(m.left-e.getBoundingClientRect().width-5)+","+(m.top+e.getBoundingClientRect().height/2-30)+")rotate(-90)"}).text("Number of Jobs"),k.append("rect").attr("y",function(e){return 150-e*v}).attr("height",function(e){return e*v}).attr("width",_-1);var S=!1;if("hours"==o){k.append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",3).attr("stroke","black").attr("stroke-width",1).attr("pointer-events","none").attr("transform",function(){return"translate( "+_/2+", 150)"}),k.append("text").attr("fill","rgb(0,0,0)").attr("transform","translate( 10, 160 )").text(function(e,t){return f[t].getHours()<10?"0"+String(f[t].getHours()):f[t].getHours()});var T="";S=!1,k.append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",function(e,t){var n=0;return f[t].getDate()!=T&&(S?n=20:(n=27,S=!0),T=f[t].getDate()),n}).attr("stroke","black").attr("stroke-width",1).attr("pointer-events","none").attr("transform",function(){return"translate( 0, 150)"}),T="";var E="";S=!1,k.append("text").attr("fill","rgb(0,0,0)").attr("pointer-events","none").text(function(e,t){var n="";return f[t].getDate()!=E&&(n=String(f[t].toLocaleString("en-us",{month:"long"})),n+=" "+String(f[t].getDate()),E=f[t].getDate()),n}).attr("transform",function(e,t){var n=150,i=c.select(this).node().getBBox().width;return f[t].getDate()!=T&&(S?n+=18:(n+=26,S=!0),T=f[t].getDate()),"translate( "+(i+2)+", "+n+" )"})}else if("days"==o){k.append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",3).attr("stroke","black").attr("stroke-width",1).attr("pointer-events","none").attr("transform",function(){return"translate( "+_/2+", 150)"}),k.append("text").attr("fill","rgb(0,0,0)").attr("transform","translate( 9, 160 )").text(function(e,t){return g[t].getDate()<10?"0"+String(g[t].getDate()):g[t].getDate()});var j="";S=!1,k.append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",function(e,t){var n=0;return g[t].getMonth()!=j&&(S?n=20:(n=27,S=!0),j=g[t].getMonth()),n}).attr("stroke","black").attr("stroke-width",1).attr("pointer-events","none").attr("transform",function(){return"translate( 0, 150)"}),j="";var A="";S=!1,k.append("text").attr("fill","rgb(0,100,0)").attr("pointer-events","none").text(function(e,t){var n="";return g[t].getMonth()!=A&&(n=String(g[t].toLocaleString("en-us",{month:"long"})),n+=" "+String(g[t].getFullYear()),A=g[t].getMonth()),n}).attr("transform",function(e,t){var n=150,i=c.select(this).node().getBBox().width;return g[t].getMonth()!=j&&(S?n+=18:(n+=26,S=!0),j=g[t].getMonth()),"translate( "+(i+2)+", "+n+" )"})}x.append("g").attr("class","tool_tip").append("rect"),x.select(".tool_tip").append("text"),"jc_dy_chart"!=n&&"jc_hr_chart"!=n||c.select("#"+n).attr("height",w*b).attr("width",y*b).style("cursor","default")}function s(e,t,n){function i(){var e=c.select(this).attr("class");e=e.split(" "),c.selectAll("."+e[0]).filter("."+e[1]).style("cursor","zoom-in").transition().duration(750).attr("height",s).attr("width",d),c.select(this).style("cursor","default").transition().duration(750).attr("height",s*a).attr("width",d*a)}var r=e,a=1.75,o={top:60,right:30,bottom:50,left:60},s=150+o.top+o.bottom,d=300+o.left+o.right,u=c.scale.linear().domain([0,c.max(r)]).range([0,300]);r=c.layout.histogram().bins(u.ticks(20))(r);for(var h=[],f=0;f<r.length;f++)h.push(r[f].length);var p;p=0!==c.max(r)?150/c.max(h):1;var g=c.scale.linear().domain([0,c.max(r,function(e){return e.y})]).range([150,0]),m=function(e){var t=Math.floor(e/60),n=Math.floor(e-60*t);return t<10&&(t="0"+t),n<10&&(n="0"+n),t+":"+n},_=c.select("#"+t).attr("viewBox","0 0 "+d+" "+s).attr("width",d).attr("height",s).attr("preserveAspectRatio","xMidYMin").on("click",i);_.append("g").append("text").attr("class","title").attr("transform",function(){return"translate( 300,15 )"}).text(n);var v,y=_.selectAll(".bar").data(r).enter().append("g").attr("class","bar").attr("transform",function(e){return"translate("+(+u(e.x)+o.left)+","+(+g(e.y)+o.top)+")"}).on("mouseenter",function(e){for(var t=0,n=e.length;n>=1;)n/=10,t++;var i=4*t+10;c.select(l.event.target.parentElement).select(".tool_tip").select("text").attr("transform","translate( "+(o.left-5)+", "+(150-e.length*p+o.top+10)+" )").attr("visibility","visible").text(e.length),c.select(l.event.target.parentElement).select(".tool_tip").attr("width",i+"px").attr("height","15px").select("rect").attr("transform","translate( "+(o.left-i)+", "+(150-e.length*p+o.top)+" )").attr("width",i+"px").attr("height","15px").attr("fill","#ebd9b2")}).on("mouseleave",function(){c.select(l.event.target.parentElement).select(".tool_tip").select("text").attr("visibility","hidden"),c.select(l.event.target.parentElement).select(".tool_tip").select("rect").attr("width","0").attr("height","0").attr("fill","")});v=void 0===r[0]?1:u(r[0].dx),y.append("rect").attr("x",1).attr("width",v-1).attr("height",function(e){return 150-g(e.y)});var b=c.svg.axis().scale(u).orient("bottom").tickFormat(m);_.append("g").attr("class","x axis").attr("id","x_"+t).attr("transform","translate( "+o.left+","+(150+o.top)+")").call(b),_.append("g").append("text").attr("class","ax_title").attr("transform",function(){var e=c.select("#x_"+t).node();return"translate("+(o.left+e.getBoundingClientRect().width/2+30)+","+(o.top+150+e.getBoundingClientRect().height+10)+")"}).text("ETA - hrs:mins");var w=c.svg.axis().scale(g).orient("left");_.append("g").attr("class","y axis").attr("id","y_"+t).attr("transform","translate( "+o.left+","+o.top+")").call(w),_.append("g").append("text").attr("class","ax_title").attr("transform",function(){var e=c.select("#y_"+t).node();return"translate("+(o.left-e.getBoundingClientRect().width-5)+","+(o.top+e.getBoundingClientRect().height/2-30)+")rotate(-90)"}).text("Number of Jobs"),_.append("g").attr("class","tool_tip").append("rect"),_.select(".tool_tip").append("text")}Object.defineProperty(t,"__esModule",{value:!0}),t.create_chart=o,t.create_histogram=s;var l=n(76),c=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(l)}).call(t,n(0))},function(e,t,n){"use strict";(function(e){function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var r=n(349),a=i(r),o=n(351),s=i(o),l=e.Router.extend({routes:{"":"groups",":group_id":"group_page"}}),c=e.View.extend({groupListView:null,groupDetailView:null,collection:null,initialize:function(){window.globalTS.groups=this,this.ts_router=new l,this.ts_router.on("route:groups",function(){window.globalTS.groups.groupListView=new a.default.GroupListView}),this.ts_router.on("route:group_page",function(e){window.globalTS.groups.groupDetailView=new s.default.GroupDetailView({group_id:e})}),e.history.start({pushState:!1})}});t.default={ToolshedGroups:c}}).call(t,n(2))},function(e,t,n){"use strict";(function(e,i,r){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(7),s=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(o),l=n(140),c=a(l),d=n(350),u=a(d),h=e.View.extend({el:"#groups_element",defaults:{},initialize:function(e){this.options=i.defaults(this.options||{},this.defaults,e);var t=this;window.globalTS.groups.collection=new c.default.Groups,window.globalTS.groups.collection.fetch({success:function(e){console.log("received data: "),console.log(e),t.render()},error:function(e,t){void 0!==t.responseJSON?s.error(t.responseJSON.err_msg):s.error("An error occurred.")}})},fetch:function(){},render:function(e){this.options=i.extend(this.options,e),r(".tooltip").hide();var t=this.templateGroupsList();this.$el.html(t({length:window.globalTS.groups.collection.models.length})),this.renderRows(window.globalTS.groups.collection.models),r("#center [data-toggle]").tooltip(),r("#center").css("overflow","auto")},renderRows:function(e){for(var t=0;t<e.length;t++){var n=e[t];this.renderOne({group:n})}},renderOne:function(e){var t=new u.default.GroupListRowView(e);this.$el.find("#group_list_body").append(t.el)},templateGroupsList:function(){var e=[];return e.push('<div id="groups">'),e.push("</div>"),e.push('<div class="groups_container table-responsive">'),e.push("<% if(length === 0) { %>"),e.push("<div>There are no groups yet.</div>"),e.push("<% } else{ %>"),e.push('<table class="grid table table-condensed">'),e.push("   <thead>"),e.push("     <th>Name</th>"),e.push("     <th>Members</th> "),e.push("     <th>Repositories</th>"),e.push("   </thead>"),e.push('   <tbody id="group_list_body">'),e.push("   </tbody>"),e.push("</table>"),e.push("<% }%>"),e.push("</div>"),i.template(e.join(""))}});t.default={GroupListView:h}}).call(t,n(2),n(1),n(0))},function(e,t,n){"use strict";(function(e,n){Object.defineProperty(t,"__esModule",{value:!0});var i=e.View.extend({events:{},initialize:function(e){this.render(e.group)},render:function(e){var t=this.templateRow();return this.setElement(t({group:e})),this.$el.show(),this},templateRow:function(){return n.template(['<tr class="" data-id="<%- group.get("id") %>">','<td><a href="groups#/<%= group.get("id") %>"><%= _.escape(group.get("name")) %></a></td>','<td><%= group.get("total_members") %></td>','<td><%= group.get("total_repos") %></td>',"</tr>"].join(""))}});t.default={GroupListRowView:i}}).call(t,n(2),n(1))},function(e,t,n){"use strict";(function(e,i,r){Object.defineProperty(t,"__esModule",{value:!0});var a=n(7),o=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(a),s=n(140),l=function(e){return e&&e.__esModule?e:{default:e}}(s),c=e.View.extend({el:"#groups_element",options:{},app:null,initialize:function(e){this.options=i.extend(this.options,e),this.app=window.globalTS.groups,null!==this.app.collection?(this.model=this.app.collection.get(this.options.group_id),this.render()):this.fetchGroup()},fetchGroup:function(e){var t=this;this.options=i.extend(this.options,e),this.model=new l.default.Group({id:this.options.group_id}),this.model.fetch({success:function(e){console.log("received data: "),console.log(e),t.render()},error:function(e,t){void 0!==t.responseJSON?o.error(t.responseJSON.err_msg):o.error("An error occurred.")}})},render:function(){var e=this.templateRow();this.$el.html(e({group:this.model})),r("#center [data-toggle]").tooltip(),r("#center").css("overflow","auto")},templateRow:function(){return i.template(["<div>",'<h3><%= _.escape(group.get("name")) %></h3>','<p class="" style="color:gray;">','A group of <%= group.get("members").length %> members with <%= group.get("repositories").length %> repositories and a total of <%= group.get("total_downloads") %> combined repository clones.</p>',"<h3>Members</h3>",'<table class="grid table table-condensed">',"<thead>","<th>Name</th>","<th>Repositories</th>","<th>Registered</th>","</thead>","<tbody>",'<% _.each(group.get("members"), function(member) { %>',"<tr>","<td>","<%= _.escape(member.username) %>","</td>","<td>",'<a data-toggle="tooltip" data-placement="top" title="Repositories of <%= _.escape(member.username) %>" href="/repository/browse_repositories_by_user?user_id=<%= member.id %>&use_panels=true" id="<%= member.id %>"><%= member.user_repos_count %></a>',"</td>","<td>","<%= member.time_created %>","</td>","</tr>","<% }); %>","</tbody>","</table>","<h3>Repositories</h3>",'<table class="grid table table-condensed">',"<thead>","<th>Name</th>","<th>Description</th>","<th>Clones</th>","<th>Owner</th>","<th>Categories</th>","<th>Created</th>","<th>Updated</th>","<th>Rating</th>","<th>Verified</th>","</thead>","<tbody>",'<% _.each(group.get("repositories"), function(repo) { %>',"<tr>","<td>",'<a data-toggle="tooltip" data-placement="top" title="Details of <%= _.escape(repo.name) %>" href="/view/<%= _.escape(repo.owner) %>/<%= _escape(repo.name) %>" id="<%= repo.id %>"><%= _.escape(repo.name) %></a>',"</td>","<td>","<%= _.escape(repo.description) %>","</td>","<td>","<%= repo.times_downloaded %>","</td>","<td>","<%= _.escape(repo.owner) %>","</td>","<td>","<% _.each((repo.categories), function(cat) { %>",'<a data-toggle="tooltip" data-placement="top" title="Repositories in <%= cat.name %>" href="/repository/browse_repositories_in_category?id=<%= cat.id %>&use_panels=true"><%= cat.name %></a><br/>',"<% }); %>","</td>",'<td data-toggle="tooltip" data-placement="top" title="<%= repo.time_created_full %>">',"<%= repo.time_created %>","</td>",'<td data-toggle="tooltip" data-placement="top" title="<%= repo.time_updated_full %>">',"<%= repo.time_updated %>","</td>","<td>","<%= repo.ratings_mean %>","</td>","<td>","<%= repo.approved %>","</td>","</tr>","<% }); %>","</tbody>","</table>","</div>"].join(""))}});t.default={GroupDetailView:c}}).call(t,n(2),n(1),n(0))}],[301]);
//# sourceMappingURL=extended.bundled.js.map