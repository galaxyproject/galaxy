webpackJsonp([4],{10:function(t,e,n){"use strict";(function(t,i,r){function a(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var o=n(9),s=(a(o),n(16)),l=(a(s),n(14)),u=a(l),c=t.Model.extend({}),h=t.Model.extend({defaults:{id:"",type:"",name:"",hda_ldda:"hda",metadata:null},initialize:function(){this.get("metadata")||this._set_metadata(),this.on("change",this._set_metadata,this)},_set_metadata:function(){var t=new c;i.each(i.keys(this.attributes),function(e){if(0===e.indexOf("metadata_")){var n=e.split("metadata_")[1];t.set(n,this.attributes[e]),delete this.attributes[e]}},this),this.set("metadata",t,{silent:!0})},get_metadata:function(t){return this.attributes.metadata.get(t)},urlRoot:Galaxy.root+"api/datasets"}),d=h.extend({defaults:i.extend({},h.prototype.defaults,{chunk_url:null,first_data_chunk:null,offset:0,at_eof:!1}),initialize:function(t){h.prototype.initialize.call(this),this.attributes.first_data_chunk&&(this.attributes.offset=this.attributes.first_data_chunk.offset),this.attributes.chunk_url=Galaxy.root+"dataset/display?dataset_id="+this.id,this.attributes.url_viz=Galaxy.root+"visualization"},get_next_chunk:function(){if(this.attributes.at_eof)return null;var t=this,e=r.Deferred();return r.getJSON(this.attributes.chunk_url,{offset:t.attributes.offset}).success(function(n){var i;""!==n.ck_data?(i=n,t.attributes.offset=n.offset):(t.attributes.at_eof=!0,i=null),e.resolve(i)}),e}}),f=t.Collection.extend({model:h}),_=t.View.extend({initialize:function(t){this.row_count=0,this.loading_chunk=!1,new g({model:t.model,$el:this.$el})},expand_to_container:function(){this.$el.height()<this.scroll_elt.height()&&this.attempt_to_fetch()},attempt_to_fetch:function(t){var e=this;!this.loading_chunk&&this.scrolled_to_bottom()&&(this.loading_chunk=!0,this.loading_indicator.show(),r.when(e.model.get_next_chunk()).then(function(t){t&&(e._renderChunk(t),e.loading_chunk=!1),e.loading_indicator.hide(),e.expand_to_container()}))},render:function(){this.loading_indicator=r("<div/>").attr("id","loading_indicator"),this.$el.append(this.loading_indicator);var t=r("<table/>").attr({id:"content_table",cellpadding:0});this.$el.append(t);var e=this.model.get_metadata("column_names"),n=r("<thead/>").appendTo(t),i=r("<tr/>").appendTo(n);if(e)i.append("<th>"+e.join("</th><th>")+"</th>");else for(var a=1;a<=this.model.get_metadata("columns");a++)i.append("<th>"+a+"</th>");var o=this,s=this.model.get("first_data_chunk");s?this._renderChunk(s):r.when(o.model.get_next_chunk()).then(function(t){o._renderChunk(t)}),this.scroll_elt.scroll(function(){o.attempt_to_fetch()})},scrolled_to_bottom:function(){return!1},_renderCell:function(t,e,n){var i=r("<td>").text(t),a=this.model.get_metadata("column_types");return void 0!==n?i.attr("colspan",n).addClass("stringalign"):a&&e<a.length&&("str"!==a[e]&&"list"!==a[e]||i.addClass("stringalign")),i},_renderRow:function(t){var e=t.split("\t"),n=r("<tr>"),a=this.model.get_metadata("columns");return this.row_count%2!=0&&n.addClass("dark_row"),e.length===a?i.each(e,function(t,e){n.append(this._renderCell(t,e))},this):e.length>a?(i.each(e.slice(0,a-1),function(t,e){n.append(this._renderCell(t,e))},this),n.append(this._renderCell(e.slice(a-1).join("\t"),a-1))):1===e.length?n.append(this._renderCell(t,0,a)):(i.each(e,function(t,e){n.append(this._renderCell(t,e))},this),i.each(i.range(a-e.length),function(){n.append(r("<td>"))})),this.row_count++,n},_renderChunk:function(t){var e=this.$el.find("table");i.each(t.ck_data.split("\n"),function(t,n){""!==t&&e.append(this._renderRow(t))},this)}}),p=_.extend({initialize:function(t){_.prototype.initialize.call(this,t);var e=i.find(this.$el.parents(),function(t){return"auto"===r(t).css("overflow")});e||(e=window),this.scroll_elt=r(e)},scrolled_to_bottom:function(){return this.$el.height()-this.scroll_elt.scrollTop()-this.scroll_elt.height()<=0}}),v=_.extend({initialize:function(t){_.prototype.initialize.call(this,t),this.scroll_elt=this.$el.css({position:"relative",overflow:"scroll",height:t.height||"500px"})},scrolled_to_bottom:function(){return this.$el.scrollTop()+this.$el.innerHeight()>=this.el.scrollHeight}}),g=t.View.extend({col:{chrom:null,start:null,end:null},url_viz:null,dataset_id:null,genome_build:null,file_ext:null,initialize:function(t){var e=parent.Galaxy;if(e&&e.modal&&(this.modal=e.modal),e&&e.frame&&(this.frame=e.frame),this.modal&&this.frame){var n=t.model,i=n.get("metadata");if(n.get("file_ext")){if(this.file_ext=n.get("file_ext"),"bed"==this.file_ext){if(!(i.get("chromCol")&&i.get("startCol")&&i.get("endCol")))return void console.log("TabularButtonTrackster : Bed-file metadata incomplete.");this.col.chrom=i.get("chromCol")-1,this.col.start=i.get("startCol")-1,this.col.end=i.get("endCol")-1}if("vcf"==this.file_ext){var r=function(t,e){for(var n=0;n<e.length;n++)if(e[n].match(t))return n;return-1};if(this.col.chrom=r("Chrom",i.get("column_names")),this.col.start=r("Pos",i.get("column_names")),this.col.end=null,-1==this.col.chrom||-1==this.col.start)return void console.log("TabularButtonTrackster : VCF-file metadata incomplete.")}if(void 0!==this.col.chrom){if(!n.id)return void console.log("TabularButtonTrackster : Dataset identification is missing.");if(this.dataset_id=n.id,!n.get("url_viz"))return void console.log("TabularButtonTrackster : Url for visualization controller is missing.");this.url_viz=n.get("url_viz"),n.get("genome_build")&&(this.genome_build=n.get("genome_build"));var a=new u.default.IconButtonView({model:new u.default.IconButton({title:"Visualize",icon_class:"chart_curve",id:"btn_viz"})});this.setElement(t.$el),this.$el.append(a.render().$el),this.hide()}}}},events:{"mouseover tr":"show",mouseleave:"hide"},show:function(t){var e=this;if(null!==this.col.chrom){var n=r(t.target).parent(),i=n.children().eq(this.col.chrom).html(),a=n.children().eq(this.col.start).html(),o=this.col.end?n.children().eq(this.col.end).html():a;if(!i.match("^#")&&""!==i&&function(t){return!isNaN(parseFloat(t))&&isFinite(t)}(a)){var s={dataset_id:this.dataset_id,gene_region:i+":"+a+"-"+o},l=n.offset(),u=l.left-10,c=l.top-r(window).scrollTop()+3;r("#btn_viz").css({position:"fixed",top:c+"px",left:u+"px"}),r("#btn_viz").off("click"),r("#btn_viz").click(function(){e.frame.add({title:"Trackster",url:e.url_viz+"/trackster?"+r.param(s)})}),r("#btn_viz").show()}else r("#btn_viz").hide()}},hide:function(){this.$("#btn_viz").hide()}}),m=function(t){t.model||(t.model=new d(t.dataset_config));var e=t.parent_elt,n=t.embedded;delete t.embedded,delete t.parent_elt,delete t.dataset_config;var i=n?new v(t):new p(t);return i.render(),e&&(e.append(i.$el),i.expand_to_container()),i};e.default={Dataset:h,TabularDataset:d,DatasetCollection:f,TabularDatasetChunkedView:_,createTabularDatasetChunkedView:m}}).call(e,n(2),n(1),n(0))},11:function(t,e,n){"use strict";(function(t,i){function r(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var a=n(1),o=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(a),s=n(8),l=r(s),u=n(11),c=(r(u),t.Model.extend({initialize:function(t){var e=this.get("key");this.set("id",e);var n=o.find([{key:"name",label:"Name",type:"text",default_value:""},{key:"color",label:"Color",type:"color",default_value:null},{key:"min_value",label:"Min Value",type:"float",default_value:null},{key:"max_value",label:"Max Value",type:"float",default_value:null},{key:"mode",type:"string",default_value:this.mode,hidden:!0},{key:"height",type:"int",default_value:32,hidden:!0},{key:"pos_color",label:"Positive Color",type:"color",default_value:"#FF8C00"},{key:"neg_color",label:"Negative Color",type:"color",default_value:"#4169E1"},{key:"block_color",label:"Block color",type:"color",default_value:null},{key:"label_color",label:"Label color",type:"color",default_value:"black"},{key:"show_insertions",label:"Show insertions",type:"bool",default_value:!1},{key:"show_counts",label:"Show summary counts",type:"bool",default_value:!0},{key:"reverse_strand_color",label:"Antisense strand color",type:"color",default_value:null},{key:"show_differences",label:"Show differences only",type:"bool",default_value:!0}],function(t){return t.key===e});n&&this.set(o.extend({},n,t)),void 0===this.get("value")&&void 0!==this.get("default_value")&&(this.set_value(this.get("default_value")),this.get("value")||"color"!==this.get("type")||this.set("value",l.default.get_random_color()))},set_value:function(t,e){var n=this.get("type");"float"===n?t=parseFloat(t):"int"===n&&(t=parseInt(t,10)),this.set({value:t},e)}})),h=t.Collection.extend({model:c,to_key_value_dict:function(){var t={};return this.each(function(e){t[e.get("key")]=e.get("value")}),t},get_value:function(t){var e=this.get(t);if(e)return e.get("value")},set_value:function(t,e,n){var i=this.get(t);if(i)return i.set_value(e,n)},set_default_value:function(t,e){var n=this.get(t);if(n)return n.set("default_value",e)}},{from_models_and_saved_values:function(t,e){return e&&(t=o.map(t,function(t){return o.extend({},t,{value:e[t.key]})})),new h(t)}}),d=t.View.extend({className:"config-settings-view",render:function(){var t=this.$el;return this.collection.each(function(e,n){if(!e.get("hidden")){var r="param_"+n,a=e.get("type"),s=e.get("value"),u=i("<div class='form-row' />").appendTo(t);if(u.append(i("<label />").attr("for",r).text(e.get("label")+":")),"bool"===a)u.append(i('<input type="checkbox" />').attr("id",r).attr("name",r).attr("checked",s));else if("text"===a)u.append(i('<input type="text"/>').attr("id",r).val(s).click(function(){i(this).select()}));else if("select"===a){var c=i("<select />").attr("id",r);o.each(e.get("options"),function(t){i("<option/>").text(t.label).attr("value",t.value).appendTo(c)}),c.val(s),u.append(c)}else if("color"===a){var h=i("<div/>").appendTo(u),d=i("<input />").attr("id",r).attr("name",r).val(s).css("float","left").appendTo(h).click(function(t){i(".tooltip").removeClass("in");var e=i(this).siblings(".tooltip").addClass("in");e.css({left:i(this).position().left+i(this).width()+5,top:i(this).position().top-i(e).height()/2+i(this).height()/2}).show(),e.click(function(t){t.stopPropagation()}),i(document).bind("click.color-picker",function(){e.hide(),i(document).unbind("click.color-picker")}),t.stopPropagation()}),f=i("<a href='javascript:void(0)'/>").addClass("icon-button arrow-circle").appendTo(h).attr("title","Set new random color").tooltip(),_=i("<div class='tooltip right' style='position: absolute;' />").appendTo(h).hide(),p=i("<div class='tooltip-inner' style='text-align: inherit'></div>").appendTo(_),v=(i("<div class='tooltip-arrow'></div>").appendTo(_),i.farbtastic(p,{width:100,height:100,callback:d,color:s}));h.append(i("<div/>").css("clear","both")),function(t){f.click(function(){t.setColor(l.default.get_random_color())})}(v)}else u.append(i("<input />").attr("id",r).attr("name",r).val(s));e.help&&u.append(i("<div class='help'/>").text(e.help))}}),this},render_in_modal:function(t){var e=this,n=function(){Galaxy.modal.hide(),i(window).unbind("keypress.check_enter_esc")},r=function(){Galaxy.modal.hide(),i(window).unbind("keypress.check_enter_esc"),e.update_from_form()},a=function(t){27===(t.keyCode||t.which)?n():13===(t.keyCode||t.which)&&r()};i(window).bind("keypress.check_enter_esc",a),0===this.$el.children().length&&this.render(),Galaxy.modal.show({title:t||"Configure",body:this.$el,buttons:{Cancel:n,OK:r}})},update_from_form:function(){var t=this;this.collection.each(function(e,n){if(!e.get("hidden")){var i="param_"+n,r=t.$el.find("#"+i).val();"bool"===e.get("type")&&(r=t.$el.find("#"+i).is(":checked")),e.set_value(r)}})}});e.default={ConfigSetting:c,ConfigSettingCollection:h,ConfigSettingCollectionView:d}}).call(e,n(2),n(0))},12:function(t,e,n){"use strict";(function(t,i,r,a){function o(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var s=n(3),l=o(s),u=n(24),c=o(u),h=n(25),d=o(h),f=n(19),_=o(f);t.ajaxSettings.traditional=!0,e.default=i.View.extend({grid:null,initialize:function(t){this.grid=new c.default,this.dict_format=t.dict_format,this.title=t.title;var e=this;if(window.add_tag_to_grid_filter=function(t,n){var i=t+(void 0!==n&&""!==n?":"+n:"");r("#advanced-search").is(":visible")||(r("#standard-search").slideToggle("fast"),r("#advanced-search").slideToggle("fast")),e.add_filter_condition("tags",i)},this.dict_format)if(this.setElement("<div/>"),t.url_base&&!t.items){var n=t.url_data||{};a.each(t.filters,function(t,e){n["f-"+e]=t}),r.ajax({url:t.url_base+"?"+r.param(n),success:function(n){n.embedded=t.embedded,n.filters=t.filters||{},e.init_grid(n)}})}else this.init_grid(t);else this.setElement("#grid-container"),this.init_grid(t);t.use_panels&&r("#center").css({padding:"10px",overflow:"auto"})},handle_refresh:function(t){t&&r.inArray("history",t)>-1&&window.top.Galaxy&&window.top.Galaxy.currHistoryPanel&&window.top.Galaxy.currHistoryPanel.loadCurrentHistory()},init_grid:function(t){this.grid.set(t);var e=this.grid.attributes;this.allow_title_display&&e.title&&l.default.setWindowTitle(e.title),this.handle_refresh(e.refresh_frames);var n=this.grid.get("url_base");if(n=n.replace(/^.*\/\/[^\/]+/,""),this.grid.set("url_base",n),this.$el.html(d.default.grid(e)),this.$el.find("#grid-table-header").html(d.default.header(e)),this.$el.find("#grid-table-body").html(d.default.body(e)),this.$el.find("#grid-table-footer").html(d.default.footer(e)),e.message){this.$el.find("#grid-message").html(d.default.message(e));var i=this;e.use_hide_message&&setTimeout(function(){i.$el.find("#grid-message").html("")},5e3)}this.init_grid_elements(),this.init_grid_controls(),init_refresh_on_change()},init_grid_controls:function(){var t=this;this.$el.find(".operation-button").each(function(){r(this).off(),r(this).click(function(){return t.submit_operation(this),!1})}),this.$el.find("input[type=text]").each(function(){r(this).off(),r(this).click(function(){r(this).select()}).keyup(function(){r(this).css("font-style","normal")})}),this.$el.find(".sort-link").each(function(){r(this).off(),r(this).click(function(){return t.set_sort_condition(r(this).attr("sort_key")),!1})}),this.$el.find(".text-filter-form").each(function(){r(this).off(),r(this).submit(function(){var e=r(this).attr("column_key"),n=r("#input-"+e+"-filter"),i=n.val();return n.val(""),t.add_filter_condition(e,i),!1})}),this.$el.find(".text-filter-val > a").each(function(){r(this).off(),r(this).click(function(){return r(this).parent().remove(),t.remove_filter_condition(r(this).attr("filter_key"),r(this).attr("filter_val")),!1})}),this.$el.find(".categorical-filter > a").each(function(){r(this).off(),r(this).click(function(){return t.set_categorical_filter(r(this).attr("filter_key"),r(this).attr("filter_val")),!1})}),this.$el.find(".advanced-search-toggle").each(function(){r(this).off(),r(this).click(function(){return t.$el.find("#standard-search").slideToggle("fast"),t.$el.find("#advanced-search").slideToggle("fast"),!1})}),this.$el.find("#check_all").off(),this.$el.find("#check_all").on("click",function(){t.check_all_items()})},init_grid_elements:function(){this.$el.find(".grid").each(function(){var t=r(this).find("input.grid-row-select-checkbox"),e=r(this).find("span.grid-selected-count"),n=function(){e.text(r(t).filter(":checked").length)};r(t).each(function(){r(this).change(n)}),n()}),0!==this.$el.find(".community_rating_star").length&&this.$el.find(".community_rating_star").rating({});var t=this.grid.attributes,e=this;this.$el.find(".page-link > a").each(function(){r(this).click(function(){return e.set_page(r(this).attr("page_num")),!1})}),this.$el.find(".use-target").each(function(){r(this).click(function(t){return e.execute({href:r(this).attr("href"),target:r(this).attr("target")}),!1})}),0!=t.items.length&&a.each(t.items,function(n,i){var r=e.$("#grid-"+i+"-popup").off(),o=new _.default(r);a.each(t.operations,function(t){e._add_operation(o,t,n)})})},_add_operation:function(t,e,n){var i=this,a=n.operation_config[e.label];a.allowed&&e.allow_popup&&t.addItem({html:e.label,href:a.url_args,target:a.target,confirmation_text:e.confirm,func:function(t){t.preventDefault();var a=r(t.target).html();e.onclick?e.onclick(n.encode_id):i.execute(this.findItemByHtml(a))}})},add_filter_condition:function(t,e){if(""===e)return!1;this.grid.add_filter(t,e,!0);var n=r(d.default.filter_element(t,e)),i=this;n.click(function(){r(this).remove(),i.remove_filter_condition(t,e)}),this.$el.find("#"+t+"-filtering-criteria").append(n),this.go_page_one(),this.execute()},remove_filter_condition:function(t,e){this.grid.remove_filter(t,e),this.go_page_one(),this.execute()},set_sort_condition:function(t){var e=this.grid.get("sort_key"),n=t;-1!==e.indexOf(t)&&"-"!==e.substring(0,1)&&(n="-"+t),this.$el.find(".sort-arrow").remove();var i="-"==n.substring(0,1)?"&uarr;":"&darr;",a=r("<span>"+i+"</span>").addClass("sort-arrow");this.$el.find("#"+t+"-header").append(a),this.grid.set("sort_key",n),this.go_page_one(),this.execute()},set_categorical_filter:function(t,e){var n=this.grid.get("categorical_filters")[t],i=this.grid.get("filters")[t],a=this;this.$el.find("."+t+"-filter").each(function(){var o=r.trim(r(this).text()),s=n[o],l=s[t];if(l==e)r(this).empty(),r(this).addClass("current-filter"),r(this).append(o);else if(l==i){r(this).empty();var u=r('<a href="#">'+o+"</a>");u.click(function(){a.set_categorical_filter(t,l)}),r(this).removeClass("current-filter"),r(this).append(u)}}),this.grid.add_filter(t,e),this.go_page_one(),this.execute()},set_page:function(t){var e=this;this.$el.find(".page-link").each(function(){var n,i=r(this).attr("id"),a=parseInt(i.split("-")[2],10),o=e.grid.get("cur_page");if(a===t)n=r(this).children().text(),r(this).empty(),r(this).addClass("inactive-link"),r(this).text(n);else if(a===o){n=r(this).text(),r(this).empty(),r(this).removeClass("inactive-link");var s=r('<a href="#">'+n+"</a>");s.click(function(){e.set_page(a)}),r(this).append(s)}}),"all"===t?this.grid.set("cur_page",t):this.grid.set("cur_page",parseInt(t,10)),this.execute()},submit_operation:function(t,e){var n=r(t).val();if(!this.$el.find('input[name="id"]:checked').length>0)return!1;var i=a.findWhere(this.grid.attributes.operations,{label:n});i&&!e&&(e=i.confirm||"");var o=[];this.$el.find("input[name=id]:checked").each(function(){o.push(r(this).val())});var s={operation:n,id:o,confirmation_text:e};return"top"!=i.target&&"center"!=i.target||(s=a.extend(s,{href:i.href,target:i.target})),this.execute(s),!0},check_all_items:function(){var t=this.$(".grid-row-select-checkbox"),e=this.$("#check_all").prop("checked");a.each(t,function(t){r(t).prop("checked",e)}),this.init_grid_elements()},go_page_one:function(){var t=this.grid.get("cur_page");null!==t&&void 0!==t&&"all"!==t&&this.grid.set("cur_page",1)},execute:function(t){var e=null,n=null,i=null,a=null,o=null;if(t&&(n=t.href,i=t.operation,e=t.id,a=t.confirmation_text,o=t.target,void 0!==n&&-1!=n.indexOf("operation="))){var s=n.split("?");if(s.length>1)for(var l=s[1],u=l.split("&"),c=0;c<u.length;c++)-1!=u[c].indexOf("operation")?(i=u[c].split("=")[1],i=i.replace(/\+/g," ")):-1!=u[c].indexOf("id")&&(e=u[c].split("=")[1])}return i&&e?!(a&&""!=a&&"None"!=a&&"null"!=a&&!confirm(a))&&(i=i.toLowerCase(),this.grid.set({operation:i,item_ids:e}),"top"==o?window.top.location=n+"?"+r.param(this.grid.get_url_data()):"center"==o?r("#galaxy_main").attr("src",n+"?"+r.param(this.grid.get_url_data())):this.grid.can_async_op(i)||this.dict_format?this.update_grid():this.go_to(o,n),!1):n?(this.go_to(o,n),!1):(this.grid.get("async")||this.dict_format?this.update_grid():this.go_to(o,n),!1)},go_to:function(t,e){var n=this.grid.get("async");this.grid.set("async",!1);var i=this.$el.find("#advanced-search").is(":visible");switch(this.grid.set("advanced_search",i),e||(e=this.grid.get("url_base")+"?"+r.param(this.grid.get_url_data())),this.grid.set({operation:void 0,item_ids:void 0,async:n}),t){case"center":r("#galaxy_main").attr("src",e);break;case"top":window.top.location=e;break;default:window.location=e}},update_grid:function(){var t=this.grid.get("operation")?"POST":"GET";this.$el.find(".loading-elt-overlay").show();var e=this;r.ajax({type:t,url:e.grid.get("url_base"),data:e.grid.get_url_data(),error:function(t){alert("Grid refresh failed")},success:function(t){var n=e.grid.get("embedded"),i=e.grid.get("insert"),a=e.$el.find("#advanced-search").is(":visible"),o=e.dict_format?t:r.parseJSON(t);o.embedded=n,o.insert=i,o.advanced_search=a,e.init_grid(o),e.$el.find(".loading-elt-overlay").hide()},complete:function(){e.grid.set({operation:void 0,item_ids:void 0})}})}})}).call(e,n(0),n(2),n(0),n(1))},13:function(t,e,n){"use strict";(function(t,n){Object.defineProperty(e,"__esModule",{value:!0});var i=t.Model.extend({defaults:{activate:!1}}),r=t.Collection.extend({model:i}),a=t.View.extend({el:"#webhook-view",initialize:function(t){var e=this,n=t.toolId||"",r=t.toolVersion||"";this.$el.attr("tool_id",n),this.$el.attr("tool_version",r),this.model=new i,this.model.urlRoot=t.urlRoot,this.model.fetch({success:function(){e.render()}})},render:function(){var t=this.model.toJSON();return this.$el.html('<div id="'+t.name+'"></div>'),t.styles&&n("<style/>",{type:"text/css"}).text(t.styles).appendTo("head"),t.script&&n("<script/>",{type:"text/javascript"}).text(t.script).appendTo("head"),this}}),o=function(t){var e=new r;e.url=Galaxy.root+t.url,e.fetch({async:!t.async||t.async,success:t.callback})};e.default={Webhooks:r,WebhookView:a,add:o}}).call(e,n(2),n(0))},14:function(t,e,n){"use strict";(function(t,n,i){Object.defineProperty(e,"__esModule",{value:!0});var r=t.Model.extend({defaults:{title:"",icon_class:"",on_click:null,menu_options:null,is_menu_button:!0,id:null,href:null,target:null,enabled:!0,visible:!0,tooltip_config:{}}}),a=t.View.extend({initialize:function(){this.model.attributes.tooltip_config={placement:"bottom"},this.model.bind("change",this.render,this)},render:function(){this.$el.tooltip("hide");var t=this.template(this.model.toJSON());return t.tooltip(this.model.get("tooltip_config")),this.$el.replaceWith(t),this.setElement(t),this},events:{click:"click"},click:function(t){return!n.isFunction(this.model.get("on_click"))||(this.model.get("on_click")(t),!1)},template:function(t){var e='title="'+t.title+'" class="icon-button';return t.is_menu_button&&(e+=" menu-button"),e+=" "+t.icon_class,t.enabled||(e+="_disabled"),e+='"',t.id&&(e+=' id="'+t.id+'"'),e+=' href="'+t.href+'"',t.target&&(e+=' target="'+t.target+'"'),t.visible||(e+=' style="display: none;"'),e=t.enabled?"<a "+e+"/>":"<span "+e+"/>",i(e)}}),o=t.Collection.extend({model:r}),s=t.View.extend({tagName:"div",initialize:function(){this.render()},render:function(){var t=this;return this.collection.each(function(e){var n=i("<a/>").attr("href","javascript:void(0)").attr("title",e.attributes.title).addClass("icon-button menu-button").addClass(e.attributes.icon_class).appendTo(t.$el).click(e.attributes.on_click);e.attributes.tooltip_config&&n.tooltip(e.attributes.tooltip_config);var r=e.get("options");r&&make_popupmenu(n,r)}),this}}),l=function(t,e){e||(e={});var i=new o(n.map(t,function(t){return new r(n.extend(t,e))}));return new s({collection:i})};e.default={IconButton:r,IconButtonView:a,IconButtonCollection:o,IconButtonMenuView:s,create_icon_buttons_menu:l}}).call(e,n(2),n(1),n(0))},16:function(t,e,n){"use strict";(function(t,n,i){Object.defineProperty(e,"__esModule",{value:!0});var r=t.View.extend({initialize:function(e){this.model=e&&e.model||new t.Model(e),this.setElement(n("<div/>").addClass("corner frame")),this.$el.append(n("<div/>").addClass("f-header corner").append(n("<div/>").addClass("f-title")).append(n("<div/>").addClass("f-icon f-close fa fa-close").tooltip({title:"Close",placement:"bottom"}))).append(n("<div/>").addClass("f-content")).append(n("<div/>").addClass("f-resize f-icon corner fa fa-expand").tooltip({title:"Resize"})).append(n("<div/>").addClass("f-cover")),this.$header=this.$(".f-header"),this.$title=this.$(".f-title"),this.$content=this.$(".f-content"),this.render(),this.listenTo(this.model,"change",this.render,this)},render:function(){var t=this,e=this.model.attributes;this.$title.html(e.title||""),this.$header.find(".f-icon-left").remove(),i.each(e.menu,function(e){var r=n("<div/>").addClass("f-icon-left").addClass(e.icon);i.isFunction(e.disabled)&&e.disabled()?r.attr("disabled",!0):r.on("click",function(){e.onclick(t)}).tooltip({title:e.tooltip,placement:"bottom"}),t.$header.append(r)}),e.url?this.$content.html(n("<iframe/>").addClass("f-iframe").attr("scrolling","auto").attr("src",e.url+(-1===e.url.indexOf("?")?"?":"&")+"widget=True")):e.content&&(i.isFunction(e.content)?e.content(t.$content):t.$content.html(e.content))}}),a=t.View.extend({defaultOptions:{frame:{cols:6,rows:3},rows:1e3,cell:130,margin:5,scroll:5,top_min:40,frame_max:9,visible:!0},cols:0,top:0,top_max:0,frame_z:0,frame_counter:0,frame_uid:0,frame_list:{},frame_shadow:null,visible:!1,event:{},initialize:function(e){var r=this;this.options=i.defaults(e||{},this.defaultOptions),this.visible=this.options.visible,this.top=this.top_max=this.options.top_min,this.setElement(n("<div/>").addClass("galaxy-frame").append(n("<div/>").addClass("frame-background")).append(n("<div/>").addClass("frame-menu frame-scroll-up fa fa-chevron-up fa-2x")).append(n("<div/>").addClass("frame-menu frame-scroll-down fa fa-chevron-down fa-2x"))),this.frame_shadow=new t.View({el:n("<div/>").addClass("corner frame-shadow")}),this.$el.append(this.frame_shadow.$el),this._frameInit(this.frame_shadow,"#frame-shadow"),this._frameResize(this.frame_shadow,{width:0,height:0}),this.frame_list["#frame-shadow"]=this.frame_shadow,this.visible?this.show():this.hide(),this._panelRefresh(),n(window).resize(function(){r.visible&&r._panelRefresh()})},render:function(){this.$(".frame-scroll-up")[this.top!=this.options.top_min&&"show"||"hide"](),this.$(".frame-scroll-down")[this.top!=this.top_max&&"show"||"hide"]()},add:function(t){if(this.frame_counter>=this.options.frame_max)Galaxy.modal.show({title:"Warning",body:"You have reached the maximum number of allowed frames ("+this.options.frame_max+").",buttons:{Close:function(){Galaxy.modal.hide()}}});else{var e="#frame-"+this.frame_uid++;if(0!==n(e).length)Galaxy.modal.show({title:"Error",body:"This frame already exists. This page might contain multiple frame managers.",buttons:{Close:function(){Galaxy.modal.hide()}}});else{this.top=this.options.top_min;var i=new r(t);this.$el.append(i.$el),t.width=this._toPixelCoord("width",this.options.frame.cols),t.height=this._toPixelCoord("height",this.options.frame.rows),this.frame_z=parseInt(i.$el.css("z-index")),this.frame_list[e]=i,this.frame_counter++,this._frameInit(i,e),this._frameResize(i,{width:t.width,height:t.height}),this._frameInsert(i,{top:0,left:0},!0),!this.visible&&this.show(),this.trigger("add")}}},del:function(t){var e=this,n=t.$el;n.fadeOut("fast",function(){n.remove(),delete e.frame_list[t.id],e.frame_counter--,e._panelRefresh(!0),e._panelAnimationComplete(),e.trigger("remove")})},show:function(){this.visible=!0,this.$el.fadeIn("fast"),this.trigger("show")},hide:function(){this.event.type||(this.visible=!1,this.$el.fadeOut("fast",function(){n(this).hide()}),this.trigger("hide"))},length:function(){return this.frame_counter},events:{mousemove:"_eventFrameMouseMove",mouseup:"_eventFrameMouseUp",mouseleave:"_eventFrameMouseUp",mousewheel:"_eventPanelScroll",DOMMouseScroll:"_eventPanelScroll","mousedown .frame":"_eventFrameMouseDown","mousedown .frame-background":"_eventHide","mousedown .frame-scroll-up":"_eventPanelScroll_up","mousedown .frame-scroll-down":"_eventPanelScroll_down","mousedown .f-close":"_eventFrameClose"},_eventFrameMouseDown:function(t){n(".tooltip").hide(),this.event.type||((n(t.target).hasClass("f-header")||n(t.target).hasClass("f-title"))&&(this.event.type="drag"),n(t.target).hasClass("f-resize")&&(this.event.type="resize"),this.event.type&&(t.preventDefault(),this.event.target=this._frameIdentify(t.target),this.event.xy={x:t.originalEvent.pageX,y:t.originalEvent.pageY},this._frameDragStart(this.event.target)))},_eventFrameMouseMove:function(t){if(this.event.type){var e={x:t.originalEvent.pageX,y:t.originalEvent.pageY},n={x:e.x-this.event.xy.x,y:e.y-this.event.xy.y};this.event.xy=e;var i=this._frameScreen(this.event.target);if("resize"==this.event.type){i.width+=n.x,i.height+=n.y;var r=this.options.cell-this.options.margin-1;i.width=Math.max(i.width,r),i.height=Math.max(i.height,r),this._frameResize(this.event.target,i),i.width=this._toGridCoord("width",i.width)+1,i.height=this._toGridCoord("height",i.height)+1,i.width=this._toPixelCoord("width",i.width),i.height=this._toPixelCoord("height",i.height),this._frameResize(this.frame_shadow,i),this._frameInsert(this.frame_shadow,{top:this._toGridCoord("top",i.top),left:this._toGridCoord("left",i.left)})}else if("drag"==this.event.type){i.left+=n.x,i.top+=n.y,this._frameOffset(this.event.target,i);var a={top:this._toGridCoord("top",i.top),left:this._toGridCoord("left",i.left)};0!==a.left&&a.left++,this._frameInsert(this.frame_shadow,a)}}},_eventFrameMouseUp:function(t){this.event.type&&(this._frameDragStop(this.event.target),this.event.type=null)},_eventFrameClose:function(t){this.event.type||(t.preventDefault(),this.del(this._frameIdentify(t.target)))},_eventHide:function(t){!this.event.type&&this.hide()},_eventPanelScroll:function(t){if(!this.event.type&&this.visible){0!==n(t.srcElement).parents(".frame").length?t.stopPropagation():(t.preventDefault(),this._panelScroll(t.originalEvent.detail?t.originalEvent.detail:t.originalEvent.wheelDelta/-3))}},_eventPanelScroll_up:function(t){this.event.type||(t.preventDefault(),this._panelScroll(-this.options.scroll))},_eventPanelScroll_down:function(t){this.event.type||(t.preventDefault(),this._panelScroll(this.options.scroll))},_frameIdentify:function(t){return this.frame_list["#"+n(t).closest(".frame").attr("id")]},_frameDragStart:function(t){this._frameFocus(t,!0);var e=this._frameScreen(t);this._frameResize(this.frame_shadow,e),this._frameGrid(this.frame_shadow,t.grid_location),t.grid_location=null,this.frame_shadow.$el.show(),n(".f-cover").show()},_frameDragStop:function(t){this._frameFocus(t,!1);var e=this._frameScreen(this.frame_shadow);this._frameResize(t,e),this._frameGrid(t,this.frame_shadow.grid_location,!0),this.frame_shadow.grid_location=null,this.frame_shadow.$el.hide(),n(".f-cover").hide(),this._panelAnimationComplete()},_toGridCoord:function(t,e){var n="width"==t||"height"==t?1:-1;return"top"==t&&(e-=this.top),parseInt((e+n*this.options.margin)/this.options.cell,10)},_toPixelCoord:function(t,e){var n="width"==t||"height"==t?1:-1,i=e*this.options.cell-n*this.options.margin;return"top"==t&&(i+=this.top),i},_toGrid:function(t){return{top:this._toGridCoord("top",t.top),left:this._toGridCoord("left",t.left),width:this._toGridCoord("width",t.width),height:this._toGridCoord("height",t.height)}},_toPixel:function(t){return{top:this._toPixelCoord("top",t.top),left:this._toPixelCoord("left",t.left),width:this._toPixelCoord("width",t.width),height:this._toPixelCoord("height",t.height)}},_isCollision:function(t){for(var e in this.frame_list){var n=this.frame_list[e];if(null!==n.grid_location&&function(t,e){return!(t.left>e.left+e.width-1||t.left+t.width-1<e.left||t.top>e.top+e.height-1||t.top+t.height-1<e.top)}(t,n.grid_location))return!0}return!1},_locationRank:function(t){return t.top*this.cols+t.left},_panelRefresh:function(t){this.cols=parseInt(n(window).width()/this.options.cell,10)+1,this._frameInsert(null,null,t)},_panelAnimationComplete:function(){var t=this;n(".frame").promise().done(function(){t._panelScroll(0,!0)})},_panelScroll:function(t,e){var n=this.top-this.options.scroll*t;if(n=Math.max(n,this.top_max),n=Math.min(n,this.options.top_min),this.top!=n){for(var i in this.frame_list){var r=this.frame_list[i];if(null!==r.grid_location){var a={top:r.screen_location.top-(this.top-n),left:r.screen_location.left};this._frameOffset(r,a,e)}}this.top=n}this.render()},_frameInit:function(t,e){t.id=e,t.screen_location={},t.grid_location={},t.grid_rank=null,t.$el.attr("id",e.substring(1))},_frameInsert:function(t,e,r){var a=this,o=[];t&&(t.grid_location=null,o.push([t,this._locationRank(e)])),i.each(this.frame_list,function(t){null!==t.grid_location&&(t.grid_location=null,o.push([t,t.grid_rank]))}),o.sort(function(t,e){return t[1]<e[1]?-1:t[1]>e[1]?1:0}),i.each(o,function(t){a._framePlace(t[0],r)}),this.top_max=0,i.each(this.frame_list,function(t){null!==t.grid_location&&(a.top_max=Math.max(a.top_max,t.grid_location.top+t.grid_location.height))}),this.top_max=n(window).height()-this.top_max*this.options.cell-2*this.options.margin,this.top_max=Math.min(this.top_max,this.options.top_min),this.render()},_framePlace:function(t,e){t.grid_location=null;for(var n=this._toGrid(this._frameScreen(t)),i=!1,r=0;r<this.options.rows;r++){for(var a=0;a<Math.max(1,this.cols-n.width);a++)if(n.top=r,n.left=a,!this._isCollision(n)){i=!0;break}if(i)break}i?this._frameGrid(t,n,e):console.log("Grid dimensions exceeded.")},_frameFocus:function(t,e){t.$el.css("z-index",this.frame_z+(e?1:0))},_frameOffset:function(t,e,n){if(t.screen_location.left=e.left,t.screen_location.top=e.top,n){this._frameFocus(t,!0);var i=this;t.$el.animate({top:e.top,left:e.left},"fast",function(){i._frameFocus(t,!1)})}else t.$el.css({top:e.top,left:e.left})},_frameResize:function(t,e){t.$el.css({width:e.width,height:e.height}),t.screen_location.width=e.width,t.screen_location.height=e.height},_frameGrid:function(t,e,n){t.grid_location=e,this._frameOffset(t,this._toPixel(e),n),t.grid_rank=this._locationRank(e)},_frameScreen:function(t){var e=t.screen_location;return{top:e.top,left:e.left,width:e.width,height:e.height}}});e.default={View:a}}).call(e,n(2),n(0),n(1))},19:function(t,e,n){"use strict";(function(t,n,i,r){Object.defineProperty(e,"__esModule",{value:!0});var a=t.View.extend({initialize:function(t,e){this.$button=t,this.$button.length||(this.$button=n("<div/>")),this.options=e||[],this.$button.data("popupmenu",this);var i=this;this.$button.click(function(t){return n(".popmenu-wrapper").remove(),i._renderAndShow(t),!1})},_renderAndShow:function(t){this.render(),this.$el.appendTo("body").css(this._getShownPosition(t)).show(),this._setUpCloseBehavior()},render:function(){if(this.$el.addClass("popmenu-wrapper").hide().css({position:"absolute"}).html(this.template(this.$button.attr("id"),this.options)),this.options.length){var t=this;this.$el.find("li").each(function(e,i){var r=t.options[e];r.func&&n(this).children("a.popupmenu-option").click(function(e){r.func.call(t,e,r),e.preventDefault()})})}return this},template:function(t,e){return['<ul id="',t,'-menu" class="dropdown-menu">',this._templateOptions(e),"</ul>"].join("")},_templateOptions:function(t){return t.length?i.map(t,function(t){return t.divider?'<li class="divider"></li>':t.header?['<li class="head"><a href="javascript:void(0);">',t.html,"</a></li>"].join(""):['<li><a class="popupmenu-option" href="',t.href||"javascript:void(0);",'"',t.target?' target="'+t.target+'"':"",">",t.checked?'<span class="fa fa-check"></span>':"",t.html,"</a></li>"].join("")}).join(""):"<li>(no options)</li>"},_getShownPosition:function(t){var e=this.$el.width(),i=t.pageX-e/2;return i=Math.min(i,n(document).scrollLeft()+n(window).width()-e-5),i=Math.max(i,n(document).scrollLeft()+5),{top:t.pageY,left:i}},_setUpCloseBehavior:function(){function t(t){if(n(document).off("click.close_popup"),window&&window.parent!==window)try{n(window.parent.document).off("click.close_popup")}catch(t){}else try{n("iframe#galaxy_main").contents().off("click.close_popup")}catch(t){}e.remove()}var e=this;if(n("html").one("click.close_popup",t),window&&window.parent!==window)try{n(window.parent.document).find("html").one("click.close_popup",t)}catch(t){}else try{n("iframe#galaxy_main").contents().one("click.close_popup",t)}catch(t){}},addItem:function(t,e){return e=e>=0?e:this.options.length,this.options.splice(e,0,t),this},removeItem:function(t){return t>=0&&this.options.splice(t,1),this},findIndexByHtml:function(t){for(var e=0;e<this.options.length;e++)if(i.has(this.options[e],"html")&&this.options[e].html===t)return e;return null},findItemByHtml:function(t){return this.options[this.findIndexByHtml(t)]},toString:function(){return"PopupMenu"}});a.create=function(t,e){return new a(t,e)},a.make_popupmenu=function(t,e){var o=[];return i.each(e,function(t,e){var n={html:e};null===t?n.header=!0:"function"===r.type(t)&&(n.func=t),o.push(n)}),new a(n(t),o)},a.convertLinksToOptions=function(t,e){t=n(t),e=e||"a";var i=[];return t.find(e).each(function(t,e){var r={},a=n(t);if(r.html=a.text(),a.attr("href")){var o=a.attr("href"),s=a.attr("target"),l=a.attr("confirm");r.func=function(){if(!l||confirm(l))switch(s){case"_parent":window.parent.location=o;break;case"_top":window.top.location=o;break;default:window.location=o}}}i.push(r)}),i},a.fromExistingDom=function(t,e,i){t=n(t),e=n(e);var r=a.convertLinksToOptions(e,i);return e.remove(),new a(t,r)},a.make_popup_menus=function(t,e,i){t=t||document,e=e||"div[popupmenu]",i=i||function(t,e){return"#"+t.attr("popupmenu")};var r=[];return n(t).find(e).each(function(){var e=n(this),o=n(t).find(i(e,t));r.push(a.fromDom(o,e)),o.addClass("popup")}),r},e.default=a}).call(e,n(2),n(0),n(1),n(0))},20:function(t,e,n){"use strict";(function(t,i){Object.defineProperty(e,"__esModule",{value:!0});var r=n(3),a=(function(t){t&&t.__esModule}(r),t.View.extend({initialize:function(e){this.collection=new t.Collection,this.model=e&&e.model||new t.Model({onchange:null,visible:!0}).set(e),this.setElement(i(this._template())),this.$nav=this.$(".tab-navigation"),this.$content=this.$(".tab-content"),this.$el.on("click",function(){i(".tooltip").hide()}),this.render(),this.listenTo(this.model,"change",this.render,this),this.listenTo(this.collection,"add",this._add,this),this.listenTo(this.collection,"remove",this._remove,this),this.listenTo(this.collection,"change",this._change,this),this.listenTo(this.collection,"reset",this._reset,this),this.listenTo(this.collection,"add remove reset",this.render,this)},render:function(){var t=this.model.get("current");t=this.$("#"+t).length>0?t:this.first(),t&&(this.$nav.children().removeClass("active"),this.$content.children().removeClass("active"),this.$("#tab-"+t).addClass("active"),this.$("#"+t).addClass("active")),this.$el[this.model.get("visible")?"fadeIn":"fadeOut"]("fast"),this.$nav[this.size()>1?"show":"hide"]()},current:function(){return this.model.get("current")},show:function(t){t&&(this.model.set({current:t,visible:!0}),this.model.get("onchange")&&this.model.get("onchange")(t))},hide:function(){this.model.set("visible",!1)},first:function(){var t=this.collection.first();return t&&t.id},size:function(){return this.collection.length},add:function(t){this.collection.add(t)},del:function(t){this.collection.remove(t)},delAll:function(){this.collection.reset()},showTab:function(t){this.collection.get(t).set("hidden",!1)},hideTab:function(t){this.collection.get(t).set("hidden",!0)},_add:function(t){var e=this,n=t.attributes;this.$content.append(i("<div/>").attr("id",n.id).addClass("tab-pane").append(n.$el)),this.$nav.append(i(this._template_tab(n)).show().tooltip({title:n.tooltip,placement:"bottom",container:e.$el}).on("click",function(t){t.preventDefault(),e.show(n.id)})),1==this.size()&&this.show(n.id)},_remove:function(t){this.$("#tab-"+t.id).remove(),this.$("#"+t.id).remove()},_reset:function(){this.$nav.empty(),this.$content.empty()},_change:function(t){this.$("#tab-"+t.id)[t.get("hidden")?"hide":"show"]()},_template:function(){return i("<div/>").addClass("ui-tabs tabbable tabs-left").append(i("<ul/>").addClass("tab-navigation nav nav-tabs")).append(i("<div/>").addClass("tab-content"))},_template_tab:function(t){var e=i("<li/>").addClass("tab-element").attr("id","tab-"+t.id).append(i("<a/>").attr("id","tab-title-link-"+t.id)),n=e.find("a");return t.icon&&n.append(i("<i/>").addClass("tab-icon fa").addClass(t.icon)),n.append(i("<span/>").attr("id","tab-title-text-"+t.id).addClass("tab-title-text").append(t.title)),e}}));e.default={View:a}}).call(e,n(2),n(0))},22:function(t,e,n){"use strict";(function(t,i){function r(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var a=n(1),o=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(a),s=n(8),l=r(s),u=n(10),c=r(u),h=n(23),d=(r(h),{hidden:!1,show:function(){this.set("hidden",!1)},hide:function(){this.set("hidden",!0)},toggle:function(){this.set("hidden",!this.get("hidden"))},is_visible:function(){return!this.attributes.hidden}}),f=t.Model.extend({defaults:{name:null,label:null,type:null,value:null,html:null,num_samples:5},initialize:function(t){this.attributes.html=unescape(this.attributes.html)},copy:function(){return new f(this.toJSON())},set_value:function(t){this.set("value",t||"")}}),_=t.Collection.extend({model:f}),p=f.extend({}),v=f.extend({set_value:function(t){this.set("value",parseInt(t,10))},get_samples:function(){return d3.scale.linear().domain([this.get("min"),this.get("max")]).ticks(this.get("num_samples"))}}),g=v.extend({set_value:function(t){this.set("value",parseFloat(t))}}),m=f.extend({get_samples:function(){return o.map(this.get("options"),function(t){return t[0]})}});f.subModelTypes={integer:v,float:g,data:p,select:m};var y=t.Model.extend({defaults:{id:null,name:null,description:null,target:null,inputs:[],outputs:[]},urlRoot:Galaxy.root+"api/tools",initialize:function(t){this.set("inputs",new _(o.map(t.inputs,function(t){return new(f.subModelTypes[t.type]||f)(t)})))},toJSON:function(){var e=t.Model.prototype.toJSON.call(this);return e.inputs=this.get("inputs").map(function(t){return t.toJSON()}),e},remove_inputs:function(t){var e=this,n=e.get("inputs").filter(function(e){return-1!==t.indexOf(e.get("type"))});e.get("inputs").remove(n)},copy:function(e){var n=new y(this.toJSON());if(e){var i=new t.Collection;n.get("inputs").each(function(t){t.get_samples()&&i.push(t)}),n.set("inputs",i)}return n},apply_search_results:function(t){return-1!==o.indexOf(t,this.attributes.id)?this.show():this.hide(),this.is_visible()},set_input_value:function(t,e){this.get("inputs").find(function(e){return e.get("name")===t}).set("value",e)},set_input_values:function(t){var e=this;o.each(o.keys(t),function(n){e.set_input_value(n,t[n])})},run:function(){return this._run()},rerun:function(t,e){return this._run({action:"rerun",target_dataset_id:t.id,regions:e})},get_inputs_dict:function(){var t={};return this.get("inputs").each(function(e){t[e.get("name")]=e.get("value")}),t},_run:function(t){var e=o.extend({tool_id:this.id,inputs:this.get_inputs_dict()},t),n=i.Deferred(),r=new l.default.ServerStateDeferred({ajax_settings:{url:this.urlRoot,data:JSON.stringify(e),dataType:"json",contentType:"application/json",type:"POST"},interval:2e3,success_fn:function(t){return"pending"!==t}});return i.when(r.go()).then(function(t){n.resolve(new c.default.DatasetCollection(t))}),n}});o.extend(y.prototype,d);var w=(t.View.extend({}),t.Collection.extend({model:y})),b=t.Model.extend(d),x=t.Model.extend({defaults:{elems:[],open:!1},clear_search_results:function(){o.each(this.attributes.elems,function(t){t.show()}),this.show(),this.set("open",!1)},apply_search_results:function(t){var e,n=!0;o.each(this.attributes.elems,function(i){i instanceof b?(e=i,e.hide()):i instanceof y&&i.apply_search_results(t)&&(n=!1,e&&e.show())}),n?this.hide():(this.show(),this.set("open",!0))}});o.extend(x.prototype,d);var k=t.Model.extend({defaults:{search_hint_string:"search tools",min_chars_for_search:3,clear_btn_url:"",visible:!0,query:"",results:null,clear_key:27},urlRoot:Galaxy.root+"api/tools",initialize:function(){this.on("change:query",this.do_search)},do_search:function(){var t=this.attributes.query;if(t.length<this.attributes.min_chars_for_search)return void this.set("results",null);var e=t;this.timer&&clearTimeout(this.timer),i("#search-clear-btn").hide(),i("#search-spinner").show();var n=this;this.timer=setTimeout(function(){"undefined"!=typeof ga&&ga("send","pageview",Galaxy.root+"?q="+e),i.get(n.urlRoot,{q:e},function(t){n.set("results",t),i("#search-spinner").hide(),i("#search-clear-btn").show()},"json")},400)},clear_search:function(){this.set("query",""),this.set("results",null)}});o.extend(k.prototype,d);var M=t.Model.extend({initialize:function(e){this.attributes.tool_search=e.tool_search,this.attributes.tool_search.on("change:results",this.apply_search_results,this),this.attributes.tools=e.tools,this.attributes.layout=new t.Collection(this.parse(e.layout))},parse:function(t){var e=this,n=function t(n){var i=n.model_class;if(i.indexOf("Tool")===i.length-4)return e.attributes.tools.get(n.id);if("ToolSection"===i){var r=o.map(n.elems,t);return n.elems=r,new x(n)}return"ToolSectionLabel"===i?new b(n):void 0};return o.map(t,n)},clear_search_results:function(){this.get("layout").each(function(t){t instanceof x?t.clear_search_results():t.show()})},apply_search_results:function(){var t=this.get("tool_search").get("results");if(null===t)return void this.clear_search_results();var e=null;this.get("layout").each(function(n){n instanceof b?(e=n,e.hide()):n instanceof y?n.apply_search_results(t)&&e&&e.show():(e=null,n.apply_search_results(t))})}}),C=t.View.extend({initialize:function(){this.model.on("change:hidden",this.update_visible,this),this.update_visible()},update_visible:function(){this.model.attributes.hidden?this.$el.hide():this.$el.show()}}),S=C.extend({tagName:"div",render:function(){var t=i("<div/>");t.append(R.tool_link(this.model.toJSON()));var e=this.model.get("form_style",null);if("upload1"===this.model.id)t.find("a").on("click",function(t){t.preventDefault(),Galaxy.upload.show()});else if("regular"===e){var n=this;t.find("a").on("click",function(t){t.preventDefault(),Galaxy.router.push("/",{tool_id:n.model.id,version:n.model.get("version")})})}return this.$el.append(t),this}}),T=C.extend({tagName:"div",className:"toolPanelLabel",render:function(){return this.$el.append(i("<span/>").text(this.model.attributes.text)),this}}),A=C.extend({tagName:"div",className:"toolSectionWrapper",initialize:function(){C.prototype.initialize.call(this),this.model.on("change:open",this.update_open,this)},render:function(){this.$el.append(R.panel_section(this.model.toJSON()));var t=this.$el.find(".toolSectionBody");return o.each(this.model.attributes.elems,function(e){if(e instanceof y){var n=new S({model:e,className:"toolTitle"});n.render(),t.append(n.$el)}else if(e instanceof b){var i=new T({model:e});i.render(),t.append(i.$el)}}),this},events:{"click .toolSectionTitle > a":"toggle"},toggle:function(){this.model.set("open",!this.model.attributes.open)},update_open:function(){this.model.attributes.open?this.$el.children(".toolSectionBody").slideDown("fast"):this.$el.children(".toolSectionBody").slideUp("fast")}}),z=t.View.extend({tagName:"div",id:"tool-search",className:"bar",events:{click:"focus_and_select","keyup :input":"query_changed","change :input":"query_changed","click #search-clear-btn":"clear"},render:function(){return this.$el.append(R.tool_search(this.model.toJSON())),this.model.is_visible()||this.$el.hide(),i("#messagebox").is(":visible")&&this.$el.css("top","95px"),this.$el.find("[title]").tooltip(),this},focus_and_select:function(){this.$el.find(":input").focus().select()},clear:function(){return this.model.clear_search(),this.$el.find(":input").val(""),this.focus_and_select(),!1},query_changed:function(t){if(this.model.attributes.clear_key&&this.model.attributes.clear_key===t.which)return this.clear(),!1;this.model.set("query",this.$el.find(":input").val())}}),N=t.View.extend({tagName:"div",className:"toolMenu",initialize:function(){this.model.get("tool_search").on("change:results",this.handle_search_results,this)},render:function(){var t=this,e=new z({model:this.model.get("tool_search")});return e.render(),t.$el.append(e.$el),this.model.get("layout").each(function(e){if(e instanceof x){var n=new A({model:e});n.render(),t.$el.append(n.$el)}else if(e instanceof y){var i=new S({model:e,className:"toolTitleNoSection"});i.render(),t.$el.append(i.$el)}else if(e instanceof b){var r=new T({model:e});r.render(),t.$el.append(r.$el)}}),t.$el.find("a.tool-link").click(function(e){var n=i(this).attr("class").split(/\s+/)[0],r=t.model.get("tools").get(n);t.trigger("tool_link_click",e,r)}),this},handle_search_results:function(){var t=this.model.get("tool_search").get("results");t&&0===t.length?i("#search-no-results").show():i("#search-no-results").hide()}}),E=t.View.extend({className:"toolForm",render:function(){this.$el.children().remove(),this.$el.append(R.tool_form(this.model.toJSON()))}}),R=(t.View.extend({className:"toolMenuAndView",initialize:function(){this.tool_panel_view=new N({collection:this.collection}),this.tool_form_view=new E},render:function(){this.tool_panel_view.render(),this.tool_panel_view.$el.css("float","left"),this.$el.append(this.tool_panel_view.$el),this.tool_form_view.$el.hide(),this.$el.append(this.tool_form_view.$el);var t=this;this.tool_panel_view.on("tool_link_click",function(e,n){e.preventDefault(),t.show_tool(n)})},show_tool:function(t){var e=this;t.fetch().done(function(){e.tool_form_view.model=t,e.tool_form_view.render(),e.tool_form_view.$el.show(),i("#left").width("650px")})}}),{tool_search:o.template(['<input id="tool-search-query" class="search-query parent-width" name="query" ','placeholder="<%- search_hint_string %>" autocomplete="off" type="text" />','<a id="search-clear-btn" title="clear search (esc)"> </a>','<span id="search-spinner" class="search-spinner fa fa-spinner fa-spin"></span>'].join("")),panel_section:o.template(['<div class="toolSectionTitle" id="title_<%- id %>">','<a href="javascript:void(0)"><span><%- name %></span></a>',"</div>",'<div id="<%- id %>" class="toolSectionBody" style="display: none;">','<div class="toolSectionBg"></div>',"<div>"].join("")),tool_link:o.template(['<a class="<%- id %> tool-link" href="<%= link %>" target="<%- target %>" minsizehint="<%- min_width %>">','<span class="labels">',"<% _.each( labels, function( label ){ %>",'<span class="label label-default label-<%- label %>">',"<%- label %>","</span>","<% }); %>","</span>",'<span class="tool-old-link">',"<%- name %>","</span>"," <%- description %>","</a>"].join("")),tool_form:o.template(['<div class="toolFormTitle"><%- tool.name %> (version <%- tool.version %>)</div>','<div class="toolFormBody">',"<% _.each( tool.inputs, function( input ){ %>",'<div class="form-row">','<label for="<%- input.name %>"><%- input.label %>:</label>','<div class="form-row-input">',"<%= input.html %>","</div>",'<div class="toolParamHelp" style="clear: both;">',"<%- input.help %>","</div>",'<div style="clear: both;"></div>',"</div>","<% }); %>","</div>",'<div class="form-row form-actions">','<input type="submit" class="btn btn-primary" name="runtool_btn" value="Execute" />',"</div>",'<div class="toolHelp">','<div class="toolHelpBody"><% tool.help %></div>',"</div>"].join(""),{variable:"tool"})});e.default={ToolParameter:f,IntegerToolParameter:v,SelectToolParameter:m,Tool:y,ToolCollection:w,ToolSearch:k,ToolPanel:M,ToolPanelView:N,ToolFormView:E}}).call(e,n(2),n(0))},23:function(t,e,n){"use strict";(function(t,i,r){function a(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var o=n(3),s=a(o),l=n(6),u=a(l),c=n(9),h=a(c),d=n(45),f=a(d),_=n(13),p=a(_),v=t.View.extend({initialize:function(t){var e=this;this.modal=parent.Galaxy.modal||new h.default.View,this.form=new f.default(s.default.merge({listen_to_history:!0,always_refresh:!1,buildmodel:function(t,n){var r=n.model.attributes,a="",o={},l=r.job_id;l?a=Galaxy.root+"api/jobs/"+l+"/build_for_rerun":(a=Galaxy.root+"api/tools/"+r.id+"/build",o=i.extend({},Galaxy.params),o.tool_id&&delete o.tool_id),r.version&&(o.tool_version=r.version),s.default.get({url:a,data:o,success:function(i){if(!i.display)return void(window.location=Galaxy.root);n.model.set(i),e._customize(n),Galaxy.emit.debug("tool-form-base::_buildModel()","Initial tool model ready.",i),t.resolve()},error:function(e,a){var o=e&&e.err_msg||"Uncaught error.";401==a?window.location=Galaxy.root+"user/login?"+i.param({redirect:Galaxy.root+"?tool_id="+r.id}):n.$el.is(":empty")?n.$el.prepend(new u.default.Message({message:o,status:"danger",persistent:!0,large:!0}).$el):Galaxy.modal&&Galaxy.modal.show({title:"Tool request failed",body:o,buttons:{Close:function(){Galaxy.modal.hide()}}}),Galaxy.emit.debug("tool-form-base::_buildModel()","Initial tool model request failed.",e),t.reject()}})},postchange:function(t,e){var n={tool_id:e.model.get("id"),tool_version:e.model.get("version"),inputs:i.extend(!0,{},e.data.create())};e.wait(!0),Galaxy.emit.debug("tool-form::postchange()","Sending current state.",n),s.default.request({type:"POST",url:Galaxy.root+"api/tools/"+e.model.get("id")+"/build",data:n,success:function(n){e.update(n),e.wait(!1),Galaxy.emit.debug("tool-form::postchange()","Received new model.",n),t.resolve()},error:function(e){Galaxy.emit.debug("tool-form::postchange()","Refresh request failed.",e),t.reject()}})}},t)),this.deferred=this.form.deferred,this.setElement("<div/>"),this.$el.append(this.form.$el)},_customize:function(t){var e=this,n=t.model.attributes,i=new u.default.Button({icon:"fa-check",tooltip:"Execute: "+n.name+" ("+n.version+")",title:"Execute",cls:"btn btn-primary ui-clear-float",wait_cls:"btn btn-info ui-clear-float",onclick:function(){i.wait(),t.portlet.disable(),e.submit(n,function(){i.unwait(),t.portlet.enable()})}});n.buttons={execute:i},n.job_id&&n.job_remap&&n.inputs.push({label:"Resume dependencies from this job",name:"rerun_remap_job_id",type:"select",display:"radio",ignore:"__ignore__",value:"__ignore__",options:[["Yes",n.job_id],["No","__ignore__"]],help:"The previous run of this tool failed and other tools were waiting for it to finish successfully. Use this option to resume those tools using the new output(s) of this tool run."})},submit:function(t,e){var n=this,a={tool_id:t.id,tool_version:t.version,inputs:this.form.data.create()};if(this.form.trigger("reset"),!n.validate(a))return Galaxy.emit.debug("tool-form::submit()","Submission canceled. Validation failed."),void(e&&e());if(t.action!==Galaxy.root+"tool_runner/index"){var o=i("<form/>").attr({action:t.action,method:t.method,enctype:t.enctype});return r.each(a.inputs,function(t,e){o.append(i("<input/>").attr({name:e,value:t}))}),o.hide().appendTo("body").submit().remove(),void(e&&e())}Galaxy.emit.debug("tool-form::submit()","Validation complete.",a),s.default.request({type:"POST",url:Galaxy.root+"api/tools",data:a,success:function(t){if(e&&e(),n.$el.children().hide(),n.$el.append(n._templateSuccess(t)),t.jobs&&t.jobs.length>0){n.$el.append(i("<div/>",{id:"webhook-view"}));new p.default.WebhookView({urlRoot:Galaxy.root+"api/webhooks/tool",toolId:a.tool_id})}parent.Galaxy&&parent.Galaxy.currHistoryPanel&&parent.Galaxy.currHistoryPanel.refreshContents()},error:function(t){e&&e(),Galaxy.emit.debug("tool-form::submit","Submission failed.",t);var i=!1;if(t&&t.err_data){var r=n.form.data.matchResponse(t.err_data);for(var o in r){n.form.highlight(o,r[o]),i=!0;break}}i||n.modal.show({title:"Job submission failed",body:n._templateError(a,t&&t.err_msg),buttons:{Close:function(){n.modal.hide()}}})}})},validate:function(t){var e=t.inputs,n=-1,i=null;for(var r in e){var a=e[r],o=this.form.data.match(r),s=this.form.field_list[o],l=this.form.input_list[o];if(o&&l&&s){if(!l.optional&&null==a)return this.form.highlight(o),!1;if(a&&a.batch){var u=a.values.length,c=u>0&&a.values[0]&&a.values[0].src;if(c)if(null===i)i=c;else if(i!==c)return this.form.highlight(o,"Please select either dataset or dataset list fields for all batch mode fields."),!1;if(-1===n)n=u;else if(n!==u)return this.form.highlight(o,"Please make sure that you select the same number of inputs for all batch mode fields. This field contains <b>"+u+"</b> selection(s) while a previous field contains <b>"+n+"</b>."),!1}}else Galaxy.emit.debug("tool-form::validate()","Retrieving input objects failed.")}return!0},_templateSuccess:function(t){if(t.jobs&&t.jobs.length>0){var e=t.jobs.length,n=1==e?"1 job has":e+" jobs have",a=i("<div/>").addClass("donemessagelarge").append(i("<p/>").text(n+" been successfully added to the queue - resulting in the following datasets:"));return r.each(t.outputs,function(t){a.append(i("<p/>").addClass("messagerow").append(i("<b/>").text(t.hid+": "+t.name)))}),a.append(i("<p/>").append("<b/>").text("You can check the status of queued jobs and view the resulting data by refreshing the History pane. When the job has been run the status will change from 'running' to 'finished' if completed successfully or 'error' if problems were encountered.")),a}return this._templateError(t,"Invalid success response. No jobs found.")},_templateError:function(t,e){return i("<div/>").addClass("errormessagelarge").append(i("<p/>").text("The server could not complete the request. Please contact the Galaxy Team if this error persists. "+(e||""))).append(i("<pre/>").text(JSON.stringify(t,null,4)))}});e.default={View:v}}).call(e,n(2),n(0),n(1))},24:function(t,e,n){"use strict";(function(t,n,i){Object.defineProperty(e,"__esModule",{value:!0}),e.default=t.Model.extend({defaults:{url_base:"",async:!1,async_ops:[],categorical_filters:[],filters:{},sort_key:null,show_item_checkboxes:!1,advanced_search:!1,cur_page:1,num_pages:1,operation:void 0,item_ids:void 0},can_async_op:function(t){return-1!==n.indexOf(this.attributes.async_ops,t)},add_filter:function(t,e,n){if(n){var i,r=this.attributes.filters[t];if(null===r||void 0===r)i=e;else if("string"==typeof r)if("All"==r||r==e)i=e;else{var a=[];a[0]=r,a[1]=e,i=a}else i=r,-1===i.indexOf(e)&&i.push(e);this.attributes.filters[t]=i}else this.attributes.filters[t]=e},remove_filter:function(t,e){var i=this.attributes.filters[t];if(null===i||void 0===i)return!1;if("string"==typeof i)this.attributes.filters[t]="";else{var r=n.indexOf(i,e);-1!==r&&(i[r]="")}},get_url_data:function(){var t={async:this.attributes.async,sort:this.attributes.sort_key,page:this.attributes.cur_page,show_item_checkboxes:this.attributes.show_item_checkboxes,advanced_search:this.attributes.advanced_search};this.attributes.operation&&(t.operation=this.attributes.operation),this.attributes.item_ids&&(t.id=this.attributes.item_ids);var e=this;return n.each(n.pairs(e.attributes.filters),function(e){t["f-"+e[0]]=e[1]}),t},get_url:function(t){return this.get("url_base")+"?"+i.param(this.get_url_data())+"&"+i.param(t)}})}).call(e,n(2),n(1),n(0))},25:function(t,e,n){"use strict";(function(t,i){Object.defineProperty(e,"__esModule",{value:!0});var r=n(3),a=function(t){return t&&t.__esModule?t:{default:t}}(r);e.default={grid:function(t){var e="";return e=t.embedded?this.grid_header(t)+this.grid_table(t):'<div class="loading-elt-overlay"></div><table><tr><td width="75%">'+this.grid_header(t)+'</td><td></td><td></td></tr><tr><td width="100%" id="grid-message" valign="top"></td><td></td><td></td></tr></table>'+this.grid_table(t),t.info_text&&(e+='<br><div class="toolParamHelp" style="clear: both;">'+t.info_text+"</div>"),e},grid_table:function(t){return'<form method="post" onsubmit="return false;"><table id="grid-table" class="grid"><thead id="grid-table-header"></thead><tbody id="grid-table-body"></tbody><tfoot id="grid-table-footer"></tfoot></table></form>'},grid_header:function(t){var e='<div class="grid-header">';if(t.embedded||(e+="<h2>"+t.title+"</h2>"),t.global_actions){e+='<ul class="manage-table-actions">';var n=t.global_actions.length>=3;n&&(e+='<li><a class="action-button" id="popup-global-actions" class="menubutton">Actions</a></li><div popupmenu="popup-global-actions">');for(var i in t.global_actions){var r=t.global_actions[i];e+='<li><a class="action-button use-target" target="'+r.target+'" href="'+r.url_args+'" onclick="return false;" >'+r.label+"</a></li>"}n&&(e+="</div>"),e+="</ul>"}return t.insert&&(e+=t.insert),e+=this.grid_filters(t),e+="</div>"},header:function(t){var e="<tr>";t.show_item_checkboxes&&(e+="<th>",t.items.length>0&&(e+='<input type="checkbox" id="check_all" name=select_all_checkbox value="true"><input type="hidden" name=select_all_checkbox value="true">'),e+="</th>");for(var n in t.columns){var i=t.columns[n];i.visible&&(e+='<th id="'+i.key+'-header">',i.href?e+='<a href="'+i.href+'" class="sort-link" sort_key="'+i.key+'">'+i.label+"</a>":e+=i.label,e+='<span class="sort-arrow">'+i.extra+"</span></th>")}return e+="</tr>"},body:function(e){var n="",i=0;0==e.items.length&&(n+='<tr><td colspan="100"><em>No Items</em></td></tr>',i=1);for(var r in e.items){var a=e.items[r],o=a.encode_id;n+="<tr ",e.current_item_id==a.id&&(n+='class="current"'),n+=">",e.show_item_checkboxes&&(n+='<td style="width: 1.5em;"><input type="checkbox" name="id" value="'+o+'" id="'+o+'" class="grid-row-select-checkbox" /></td>');for(var s in e.columns){var l=e.columns[s];if(l.visible){var u="";l.nowrap&&(u='style="white-space:nowrap;"');var c=a.column_config[l.label],h=c.link,d=c.value,f=c.target;"string"===t.type(d)&&(d=d.replace(/\/\//g,"/"));var _="",p="";l.attach_popup&&(_="grid-"+r+"-popup",p="menubutton",""!=h&&(p+=" split"),p+=" popup"),n+="<td "+u+">",h?(0!=e.operations.length&&(n+='<div id="'+_+'" class="'+p+'" style="float: left;">'),n+='<a class="menubutton-label use-target" target="'+f+'" href="'+h+'" onclick="return false;">'+d+"</a>",0!=e.operations.length&&(n+="</div>")):n+='<div id="'+_+'" class="'+p+'"><label id="'+l.label_id_prefix+o+'" for="'+o+'">'+(d||"")+"</label></div>",n+="</td>"}}n+="</tr>",i++}return n},footer:function(t){var e="";if(t.use_paging&&t.num_pages>1){var n=t.num_page_links,i=t.cur_page_num,r=t.num_pages,a=n/2,o=i-a,s=0;o<=0&&(o=1,s=a-(i-o));var l,u=a+s,c=i+u;c<=r?l=0:(c=r,l=u-(c+1-i)),0!=l&&(o-=l)<1&&(o=1),e+='<tr id="page-links-row">',t.show_item_checkboxes&&(e+="<td></td>"),e+='<td colspan="100"><span id="page-link-container">Page:',o>1&&(e+='<span class="page-link" id="page-link-1"><a href="javascript:void(0);" page_num="1" onclick="return false;">1</a></span> ...');for(var h=o;h<c+1;h++)h==t.cur_page_num?e+='<span class="page-link inactive-link" id="page-link-'+h+'">'+h+"</span>":e+='<span class="page-link" id="page-link-'+h+'"><a href="javascript:void(0);" onclick="return false;" page_num="'+h+'">'+h+"</a></span>";c<r&&(e+='...<span class="page-link" id="page-link-'+r+'"><a href="javascript:void(0);" onclick="return false;" page_num="'+r+'">'+r+"</a></span>"),e+="</span>",e+='<span class="page-link" id="show-all-link-span"> | <a href="javascript:void(0);" onclick="return false;" page_num="all">Show All</a></span></td></tr>'}if(t.show_item_checkboxes){e+='<tr><input type="hidden" id="operation" name="operation" value=""><td></td><td colspan="100">For <span class="grid-selected-count"></span> selected items: ';for(var d in t.operations){var f=t.operations[d];f.allow_multiple&&(e+='<input type="button" value="'+f.label+'" class="operation-button action-button">&nbsp;')}e+="</td></tr>"}var _=!1;for(d in t.operations)if(t.operations[d].global_operation){_=!0;break}if(_){e+='<tr><td colspan="100">';for(d in t.operations){var f=t.operations[d];f.global_operation&&(e+='<a class="action-button" href="'+f.global_operation+'">'+f.label+"</a>")}e+="</td></tr>"}return t.legend&&(e+='<tr><td colspan="100">'+t.legend+"</td></tr>"),e},message:function(t){var e=t.status;return-1!=["success","ok"].indexOf(e)&&(e="done"),'<p><div class="'+e+'message transient-message">'+i.escape(t.message)+'</div><div style="clear: both"></div></p>'},grid_filters:function(t){var e=t.default_filter_dict,n=t.filters,i="none";t.advanced_search&&(i="block");var r=!1;for(var a in t.columns){var o=t.columns[a];if("advanced"==o.filterable){var s=o.key,l=n[s],u=e[s];l&&u&&l!=u&&(i="block"),r=!0}}var c="block";"block"==i&&(c="none");var h='<div id="standard-search" style="display: '+c+';"><table><tr><td style="padding: 0;"><table>';for(var a in t.columns){var o=t.columns[a];"standard"==o.filterable&&(h+=this.grid_column_filter(t,o))}h+="</table></td></tr><tr><td>",r&&(h+='<a href="" class="advanced-search-toggle">Advanced Search</a>'),h+="</td></tr></table></div>",h+='<div id="advanced-search" style="display: '+i+'; margin-top: 5px; border: 1px solid #ccc;"><table><tr><td style="text-align: left" colspan="100"><a href="" class="advanced-search-toggle">Close Advanced Search</a></td></tr>';for(var a in t.columns){var o=t.columns[a];"advanced"==o.filterable&&(h+=this.grid_column_filter(t,o))}return h+="</table></div>"},grid_column_filter:function(e,n){var i=(e.default_filter_dict,e.filters),r=n.label,a=n.key;"advanced"==n.filterable&&(r=r.toLowerCase());var o="<tr>";if("advanced"==n.filterable&&(o+='<td align="left" style="padding-left: 10px">'+r+":</td>"),o+='<td style="padding-bottom: 1px;">',n.is_text){o+='<form class="text-filter-form" column_key="'+a+'" action="'+e.url+'" method="get" >';for(h in e.columns){var s=e.columns[h],l=i[s.key];l&&"All"!=l&&(s.is_text&&(l=JSON.stringify(l)),o+='<input type="hidden" id="'+s.key+'" name="f-'+s.key+'" value="'+l+'"/>')}o+='<span id="'+a+'-filtering-criteria">';var u=i[a];if(u){var c=t.type(u);if("string"==c&&"All"!=u&&(o+=this.filter_element(a,u)),"array"==c)for(var h in u){var d=u[h],f=u;f=f.slice(h),o+=this.filter_element(a,d)}}o+="</span>";var _="";if("standard"==n.filterable){_=n.label.toLowerCase();var p=_.length;p<20&&(p=20),p+=4}o+='<span class="search-box"><input class="search-box-input" id="input-'+a+'-filter" name="f-'+a+'" type="text" placeholder="'+_+'" size="'+p+'"/><button type="submit" style="background: transparent; border: none; padding: 4px; margin: 0px;"><i class="fa fa-search"></i></button></span></form>'}else{o+='<span id="'+a+'-filtering-criteria">';var v=!1;for(var g in e.categorical_filters[a]){var m=e.categorical_filters[a][g],y="",w="";for(var b in m)y=b,w=m[b];v&&(o+=" | "),v=!0;var d=i[a];d&&m[a]&&d==w?o+='<span class="categorical-filter '+a+'-filter current-filter">'+g+"</span>":o+='<span class="categorical-filter '+a+'-filter"><a href="javascript:void(0);" filter_key="'+y+'" filter_val="'+w+'">'+g+"</a></span>"}o+="</span>"}return o+="</td></tr>"},filter_element:function(t,e){return'<span class="text-filter-val">'+(e=a.default.sanitize(e))+'<a href="javascript:void(0);" filter_key="'+t+'" filter_val="'+e+'"><i class="fa fa-times" style="padding-left: 5px; padding-bottom: 6px;"/></a></span>'}}}).call(e,n(0),n(1))},26:function(t,e,n){"use strict";(function(t,i){function r(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var a=n(1),o=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(a),s=n(27),l=r(s),u=n(7),c=r(u),h=n(14),d=r(h),f=n(17),_=r(f),p=n(12),v=r(p),g=n(3),m=r(g);n(50),n(49),n(51),n(55),n(54),n(40),n(52),n(53),n(15);var y=null,w=null,b=function(){this.initialize&&this.initialize.apply(this,arguments)};b.extend=t.Model.extend;var x=b.extend({initialize:function(t){m.default.cssLoadFile("static/style/jquery.rating.css"),m.default.cssLoadFile("static/style/autocomplete_tagging.css"),m.default.cssLoadFile("static/style/jquery-ui/smoothness/jquery-ui.css"),m.default.cssLoadFile("static/style/library.css"),m.default.cssLoadFile("static/style/trackster.css"),this.baseURL=t},save_viz:function(){Galaxy.modal.show({title:"Saving...",body:"progress"});var t=[];i(".bookmark").each(function(){t.push({position:i(this).children(".position").text(),annotation:i(this).children(".annotation").text()})});var e=w.overview_drawable?w.overview_drawable.config.get_value("name"):null,n={view:w.to_dict(),viewport:{chrom:w.chrom,start:w.low,end:w.high,overview:e},bookmarks:t};return i.ajax({url:Galaxy.root+"visualization/save",type:"POST",dataType:"json",data:{id:w.vis_id,title:w.config.get_value("name"),dbkey:w.dbkey,type:"trackster",vis_json:JSON.stringify(n)}}).success(function(t){Galaxy.modal.hide(),w.vis_id=t.vis_id,w.has_changes=!1,window.history.pushState({},"",t.url+window.location.hash)}).error(function(){Galaxy.modal.show({title:"Could Not Save",body:"Could not save visualization. Please try again later.",buttons:{Cancel:function(){Galaxy.modal.hide()}}})})},createButtonMenu:function(){var t=this,e=d.default.create_icon_buttons_menu([{icon_class:"plus-button",title:"Add tracks",on_click:function(){c.default.select_datasets({dbkey:w.dbkey},function(t){o.each(t,function(t){w.add_drawable(l.default.object_from_template(t,w,w))})})}},{icon_class:"block--plus",title:"Add group",on_click:function(){w.add_drawable(new l.default.DrawableGroup(w,w,{name:"New Group"}))}},{icon_class:"bookmarks",title:"Bookmarks",on_click:function(){force_right_panel("0px"==i("div#right").css("right")?"hide":"show")}},{icon_class:"globe",title:"Circster",on_click:function(){window.location=t.baseURL+"visualization/circster?id="+w.vis_id}},{icon_class:"disk--arrow",title:"Save",on_click:function(){t.save_viz()}},{icon_class:"cross-circle",title:"Close",on_click:function(){t.handle_unsaved_changes(w)}}],{tooltip_config:{placement:"bottom"}});return this.buttonMenu=e,e},add_bookmark:function(t,e,n){var r=i("#right .unified-panel-body"),a=i("<div/>").addClass("bookmark").appendTo(r),o=i("<div/>").addClass("position").appendTo(a),s=(i("<a href=''/>").text(t).appendTo(o).click(function(){return w.go_to(t),!1}),i("<div/>").text(e).appendTo(a));if(n){var l=i("<div/>").addClass("delete-icon-container").prependTo(a).click(function(){return a.slideUp("fast"),a.remove(),w.has_changes=!0,!1});i("<a href=''/>").addClass("icon-button delete").appendTo(l);s.make_text_editable({num_rows:3,use_textarea:!0,help_text:"Edit bookmark note"}).addClass("annotation")}return w.has_changes=!0,a},create_visualization:function(t,e,n,r,a){var s=this,u=new l.default.TracksterView(o.extend(t,{header:!1}));return u.editor=!0,i.when(u.load_chroms_deferred).then(function(t){if(e){var i=e.chrom,o=e.start,c=e.end,h=e.overview;i&&void 0!==o&&c?u.change_chrom(i,o,c):u.change_chrom(t[0].chrom)}else u.change_chrom(t[0].chrom);if(n)for(var d=0;d<n.length;d++)u.add_drawable(l.default.object_from_template(n[d],u,u));for(var d=0;d<u.drawables.length;d++)if(u.drawables[d].config.get_value("name")===h){u.set_overview(u.drawables[d]);break}if(r)for(var f,d=0;d<r.length;d++)f=r[d],s.add_bookmark(f.position,f.annotation,a);u.has_changes=!1}),this.set_up_router({view:u}),u},set_up_router:function(e){new c.default.TrackBrowserRouter(e),t.history.start()},init_keyboard_nav:function(t){i(document).keyup(function(e){if(!i(e.srcElement).is(":input"))switch(e.which){case 37:t.move_fraction(.25);break;case 38:Math.round(t.viewport_container.height()/15);t.viewport_container.scrollTop(t.viewport_container.scrollTop()-20);break;case 39:t.move_fraction(-.25);break;case 40:Math.round(t.viewport_container.height()/15);t.viewport_container.scrollTop(t.viewport_container.scrollTop()+20)}})},handle_unsaved_changes:function(t){if(t.has_changes){var e=this;Galaxy.modal.show({title:"Close visualization",body:"There are unsaved changes to your visualization which will be lost if you do not save them.",buttons:{Cancel:function(){Galaxy.modal.hide()},"Leave without Saving":function(){i(window).off("beforeunload"),window.location=Galaxy.root+"visualization"},Save:function(){i.when(e.save_viz()).then(function(){window.location=Galaxy.root+"visualization"})}}})}else window.location=Galaxy.root+"visualization"}}),k=t.View.extend({initialize:function(){y=new x(Galaxy.root),y.createButtonMenu(),y.buttonMenu.$el.attr("style","float: right"),i("#center .unified-panel-header-inner").append(y.buttonMenu.$el),i("#right .unified-panel-title").append("Bookmarks"),i("#right .unified-panel-icons").append("<a id='add-bookmark-button' class='icon-button menu-button plus-button' href='javascript:void(0);' title='Add bookmark'></a>"),i("#right-border").click(function(){w.resize_window()}),force_right_panel("hide"),galaxy_config.app.id?this.view_existing():_.default.get("dataset_id")?this.choose_existing_or_new():this.view_new()},choose_existing_or_new:function(){var t=this,e=_.default.get("dbkey"),n={},i={dbkey:e,dataset_id:_.default.get("dataset_id"),hda_ldda:_.default.get("hda_ldda"),gene_region:_.default.get("gene_region")};e&&(n["f-dbkey"]=e),Galaxy.modal.show({title:"View Data in a New or Saved Visualization?",body:"<p><ul style='list-style: disc inside none'>You can add this dataset as:<li>a new track to one of your existing, saved Trackster sessions if they share the genome build: <b>"+(e||"Not available.")+"</b></li><li>or create a new session with this dataset as the only track</li></ul></p>",buttons:{Cancel:function(){window.location=Galaxy.root+"visualizations/list"},"View in saved visualization":function(){t.view_in_saved(i)},"View in new visualization":function(){t.view_new()}}})},view_in_saved:function(t){var e=new v.default({url_base:Galaxy.root+"visualization/list_tracks",dict_format:!0,embedded:!0});Galaxy.modal.show({title:"Add Data to Saved Visualization",body:e.$el,buttons:{Cancel:function(){window.location=Galaxy.root+"visualizations/list"},"Add to visualization":function(){i(parent.document).find("input[name=id]:checked").each(function(){t.id=i(this).val(),window.location=Galaxy.root+"visualization/trackster?"+i.param(t)})}}})},view_existing:function(){var t=galaxy_config.app.viz_config;w=y.create_visualization({container:i("#center .unified-panel-body"),name:t.title,vis_id:t.vis_id,dbkey:t.dbkey},t.viewport,t.tracks,t.bookmarks,!0),this.init_editor()},view_new:function(){var t=this;i.ajax({url:Galaxy.root+"api/genomes?chrom_info=True",data:{},error:function(){alert("Couldn't create new browser.")},success:function(e){Galaxy.modal.show({title:"New Visualization",body:t.template_view_new(e),buttons:{Cancel:function(){window.location=Galaxy.root+"visualizations/list"},Create:function(){t.create_browser(i("#new-title").val(),i("#new-dbkey").val()),Galaxy.modal.hide()}}});var n=e.map(function(t){return t[1]});galaxy_config.app.default_dbkey&&o.contains(n,galaxy_config.app.default_dbkey)&&i("#new-dbkey").val(galaxy_config.app.default_dbkey),i("#new-title").focus(),i("select[name='dbkey']").select2(),i("#overlay").css("overflow","auto")}})},template_view_new:function(t){for(var e='<form id="new-browser-form" action="javascript:void(0);" method="post" onsubmit="return false;"><div class="form-row"><label for="new-title">Browser name:</label><div class="form-row-input"><input type="text" name="title" id="new-title" value="Unnamed"></input></div><div style="clear: both;"></div></div><div class="form-row"><label for="new-dbkey">Reference genome build (dbkey): </label><div class="form-row-input"><select name="dbkey" id="new-dbkey">',n=0;n<t.length;n++)e+='<option value="'+t[n][1]+'">'+t[n][0]+"</option>";return e+='</select></div><div style="clear: both;"></div></div><div class="form-row">Is the build not listed here? <a href="'+Galaxy.root+'user/dbkeys?use_panels=True">Add a Custom Build</a></div></form>'},create_browser:function(t,e){i(document).trigger("convert_to_values"),w=y.create_visualization({container:i("#center .unified-panel-body"),name:t,dbkey:e},galaxy_config.app.gene_region),this.init_editor(),w.editor=!0},init_editor:function(){i("#center .unified-panel-title").text(w.config.get_value("name")+" ("+w.dbkey+")"),galaxy_config.app.add_dataset&&i.ajax({url:Galaxy.root+"api/datasets/"+galaxy_config.app.add_dataset,data:{hda_ldda:"hda",data_type:"track_config"},dataType:"json",success:function(t){w.add_drawable(l.default.object_from_template(t,w,w))}}),i("#add-bookmark-button").click(function(){var t=w.chrom+":"+w.low+"-"+w.high;return y.add_bookmark(t,"Bookmark description",!0)}),y.init_keyboard_nav(w),i(window).on("beforeunload",function(){if(w.has_changes)return"There are unsaved changes to your visualization that will be lost if you leave this page."})}});e.default={TracksterUI:x,GalaxyApp:k}}).call(e,n(2),n(0))},27:function(t,e,n){"use strict";(function(t,i){function r(t){return t&&t.__esModule?t:{default:t}}function a(t,e){e||(e=0);var n=Math.pow(10,e);return Math.round(t*n)/n}function o(e){var n=t.Deferred();return t.ajax({type:"HEAD",url:e,beforeSend:function(t){t.setRequestHeader("Range","bytes=0-10")},success:function(t,e,i){n.resolve(206===i.status)}}),n}Object.defineProperty(e,"__esModule",{value:!0});var s=n(1),l=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(s),u=n(7),c=r(u),h=n(28),d=r(h),f=n(8),_=r(f),p=n(29),v=r(p),g=n(30),m=r(g),y=n(31),w=r(y),b=n(10),x=r(b),k=n(22),M=r(k),C=n(11),S=r(C),T=n(34),A=r(T);n(15);var z=l.extend,N={},E=function(t,e){N[t.attr("id")]=e},R=function(e,n,i,r){i=".group",N[e.attr("id")]=r,e.bind("drag",{handle:"."+n,relative:!0},function(e,n){var r,a,o,s,l,u=(t(this),t(this).parent()),c=u.children(".track,.group"),h=N[t(this).attr("id")];if(a=t(this).parents(i),0!==a.length){o=a.position().top,s=o+a.outerHeight();var d=N[a.attr("id")];if(n.offsetY<o)return t(this).insertBefore(a),d.remove_drawable(h),void d.container.add_drawable_before(h,d);if(n.offsetY>s)return t(this).insertAfter(a),d.remove_drawable(h),void d.container.add_drawable(h)}for(a=null,l=0;l<c.length;l++)if(r=t(c.get(l)),o=r.position().top,s=o+r.outerHeight(),r.is(i)&&this!==r.get(0)&&n.offsetY>=o&&n.offsetY<=s)return n.offsetY-o<s-n.offsetY?r.find(".content-div").prepend(this):r.find(".content-div").append(this),h.container&&h.container.remove_drawable(h),void N[r.attr("id")].add_drawable(h);for(l=0;l<c.length&&(r=t(c.get(l)),!(n.offsetY<r.position().top)||r.hasClass("reference-track")||r.hasClass("intro"));l++);l===c.length?this!==c.get(l-1)&&(u.append(this),N[u.attr("id")].move_drawable(h,l)):this!==c.get(l)&&(t(this).insertBefore(c.get(l)),N[u.attr("id")].move_drawable(h,n.deltaY>0?l-1:l))}).bind("dragstart",function(){t(this).addClass("dragging")}).bind("dragend",function(){t(this).removeClass("dragging")})},O="A converter for this dataset is not installed. Please check your datatypes_conf.xml file.",D=["Histogram","Line","Filled","Intensity"],P=function t(e,n,i){if(t.id_counter||(t.id_counter=0),this.id=t.id_counter++,this.view=e,this.container=n,this.drag_handle_class=i.drag_handle_class,this.is_overview=!1,this.action_icons={},this.config=S.default.ConfigSettingCollection.from_models_and_saved_values(this.config_params,i.prefs),this.config.get_value("name")||this.config.set_value("name",i.name),this.config_onchange&&this.config.on("change",this.config_onchange,this),this.container_div=this.build_container_div(),this.header_div=null,!1!==i.header){var r=new d.default.TrackHeaderView({model:this,id:this.id});this.header_div=r.$el,this.container_div.append(this.header_div);var a=r.icons_div;this.action_icons=r.action_icons,this.container_div.hover(function(){a.show()},function(){a.hide()})}};P.prototype.action_icons_def=[{name:"toggle_icon",title:"Hide/show content",css_class:"toggle",on_click_fn:function(t){t.config.get_value("content_visible")?(t.action_icons.toggle_icon.addClass("toggle-expand").removeClass("toggle"),t.hide_contents(),t.config.set_value("content_visible",!1)):(t.action_icons.toggle_icon.addClass("toggle").removeClass("toggle-expand"),t.config.set_value("content_visible",!0),t.show_contents())}},{name:"settings_icon",title:"Edit settings",css_class:"gear",on_click_fn:function(t){new S.default.ConfigSettingCollectionView({collection:t.config}).render_in_modal("Configure Track")}},{name:"remove_icon",title:"Remove",css_class:"remove-icon",on_click_fn:function(e){t(".tooltip").remove(),e.remove()}}],z(P.prototype,{config_params:[{key:"name",label:"Name",type:"text",default_value:""},{key:"content_visible",type:"bool",default_value:!0,hidden:!0}],config_onchange:function(){},init:function(){},changed:function(){this.view.changed()},can_draw:function(){return!(!this.enabled||!this.config.get_value("content_visible"))},request_draw:function(){},_draw:function(t){},to_dict:function(){},set_name:function(t){this.old_name=this.config.get_value("name"),this.config.set_value("name",t)},revert_name:function(){this.old_name&&this.config.set_value("name",this.old_name)},remove:function(){this.changed(),this.container.remove_drawable(this);var e=this.view;this.container_div.hide(0,function(){t(this).remove(),e.update_intro_div()})},build_container_div:function(){},update_icons:function(){},hide_contents:function(){},show_contents:function(){},get_drawables:function(){}});var j=function(t,e,n){P.call(this,t,e,n),this.obj_type=n.obj_type,this.drawables=[]};z(j.prototype,P.prototype,{unpack_drawables:function(t){this.drawables=[];for(var e,n=0;n<t.length;n++)e=it(t[n],this.view,this),this.add_drawable(e)},init:function(){for(var t=0;t<this.drawables.length;t++)this.drawables[t].init()},_draw:function(t){for(var e=0;e<this.drawables.length;e++)this.drawables[e]._draw(t)},to_dict:function(){for(var t=[],e=0;e<this.drawables.length;e++)t.push(this.drawables[e].to_dict());return{prefs:this.config.to_key_value_dict(),obj_type:this.obj_type,drawables:t}},add_drawable:function(t){this.drawables.push(t),t.container=this,this.changed()},add_drawable_before:function(t,e){this.changed();var n=this.drawables.indexOf(e);return-1!==n&&(this.drawables.splice(n,0,t),!0)},replace_drawable:function(t,e,n){var i=this.drawables.indexOf(t);return-1!==i&&(this.drawables[i]=e,n&&t.container_div.replaceWith(e.container_div),this.changed()),i},remove_drawable:function(t){var e=this.drawables.indexOf(t);return-1!==e&&(this.drawables.splice(e,1),t.container=null,this.changed(),!0)},move_drawable:function(t,e){var n=this.drawables.indexOf(t);return-1!==n&&(this.drawables.splice(n,1),this.drawables.splice(e,0,t),this.changed(),!0)},get_drawables:function(){return this.drawables},get_tracks:function(t){for(var e,n=this.drawables.slice(0),i=[];0!==n.length;)e=n.shift(),e instanceof t?i.push(e):e.drawables&&(n=n.concat(e.drawables));return i}});var $=function(e,n,i){if(z(i,{obj_type:"DrawableGroup",drag_handle_class:"group-handle"}),j.call(this,e,n,i),this.content_div=t("<div/>").addClass("content-div").attr("id","group_"+this.id+"_content_div").appendTo(this.container_div),E(this.container_div,this),E(this.content_div,this),R(this.container_div,this.drag_handle_class,".group",this),this.filters_manager=new w.default.FiltersManager(this),this.header_div.after(this.filters_manager.parent_div),this.filters_manager.parent_div.after(t("<div style='clear: both'/>")),this.saved_filters_managers=[],"drawables"in i&&this.unpack_drawables(i.drawables),"filters"in i){var r=this.filters_manager;this.filters_manager=new w.default.FiltersManager(this,i.filters),r.parent_div.replaceWith(this.filters_manager.parent_div),i.filters.visible&&this.setup_multitrack_filtering()}};z($.prototype,P.prototype,j.prototype,{action_icons_def:[P.prototype.action_icons_def[0],P.prototype.action_icons_def[1],{name:"composite_icon",title:"Show composite track",css_class:"layers-stack",on_click_fn:function(e){t(".tooltip").remove(),e.show_composite_track()}},{name:"filters_icon",title:"Filters",css_class:"ui-slider-050",on_click_fn:function(t){t.filters_manager.visible()?(t.filters_manager.clear_filters(),t._restore_filter_managers()):(t.setup_multitrack_filtering(),t.request_draw({clear_tile_cache:!0})),t.filters_manager.toggle()}},P.prototype.action_icons_def[2]],build_container_div:function(){var e=t("<div/>").addClass("group").attr("id","group_"+this.id);return this.container&&this.container.content_div.append(e),e},hide_contents:function(){this.tiles_div.hide()},show_contents:function(){this.tiles_div.show(),this.request_draw()},update_icons:function(){var e=this.drawables.length;if(0===e)this.action_icons.composite_icon.hide(),this.action_icons.filters_icon.hide();else if(1===e)this.action_icons.composite_icon.toggle(this.drawables[0]instanceof J),this.action_icons.filters_icon.hide();else{var n,i,r,a=this.drawables[0].get_type(),o=0;for(n=0;n<e;n++){if(r=this.drawables[n],r.get_type()!==a){can_composite=!1;break}r instanceof K&&o++}if(this.drawables[0]instanceof Z?this.action_icons.composite_icon.show():(this.action_icons.composite_icon.hide(),t(".tooltip").remove()),o>1&&o===this.drawables.length){var s,l={};for(r=this.drawables[0],i=0;i<r.filters_manager.filters.length;i++)s=r.filters_manager.filters[i],l[s.name]=[s];for(n=1;n<this.drawables.length;n++)for(r=this.drawables[n],i=0;i<r.filters_manager.filters.length;i++)s=r.filters_manager.filters[i],s.name in l&&l[s.name].push(s);this.filters_manager.remove_all();var u,c;for(var h in l)u=l[h],u.length===o&&(c=new w.default.NumberFilter({name:u[0].name,index:u[0].index}),this.filters_manager.add_filter(c));this.action_icons.filters_icon.toggle(this.filters_manager.filters.length>0)}else this.action_icons.filters_icon.hide()}},_restore_filter_managers:function(){for(var t=0;t<this.drawables.length;t++)this.drawables[t].filters_manager=this.saved_filters_managers[t];this.saved_filters_managers=[]},setup_multitrack_filtering:function(){if(this.filters_manager.filters.length>0){this.saved_filters_managers=[];for(var t=0;t<this.drawables.length;t++){var e=this.drawables[t];this.saved_filters_managers.push(e.filters_manager),e.filters_manager=this.filters_manager}}this.filters_manager.init_filters()},show_composite_track:function(){var t=new J(this.view,this.view,{name:this.config.get_value("name"),drawables:this.drawables});this.container.replace_drawable(this,t,!0);t.request_draw()},add_drawable:function(t){j.prototype.add_drawable.call(this,t),this.update_icons()},remove_drawable:function(t){j.prototype.remove_drawable.call(this,t),this.update_icons()},to_dict:function(){this.filters_manager.visible()&&this._restore_filter_managers();var t=z(j.prototype.to_dict.call(this),{filters:this.filters_manager.to_dict()});return this.filters_manager.visible()&&this.setup_multitrack_filtering(),t},request_draw:function(t){l.each(this.drawables,function(e){e.request_draw(t)})}});var q=i.View.extend({initialize:function(t){z(t,{obj_type:"View"}),j.call(this,"View",t.container,t),this.chrom=null,this.vis_id=t.vis_id,this.dbkey=t.dbkey,this.stand_alone=void 0===t.stand_alone||t.stand_alone,this.label_tracks=[],this.tracks_to_be_redrawn=[],this.max_low=0,this.max_high=0,this.zoom_factor=3,this.min_separation=30,this.has_changes=!1,this.load_chroms_deferred=null,this.render(),this.canvas_manager=new c.default.CanvasManager(this.container.get(0).ownerDocument),this.reset(),this.config=S.default.ConfigSettingCollection.from_models_and_saved_values([{key:"name",label:"Name",type:"text",default_value:""},{key:"a_color",label:"A Color",type:"color",default_value:"#FF0000"},{key:"c_color",label:"C Color",type:"color",default_value:"#00FF00"},{key:"g_color",label:"G Color",type:"color",default_value:"#0000FF"},{key:"t_color",label:"T Color",type:"color",default_value:"#FF00FF"},{key:"n_color",label:"N Color",type:"color",default_value:"#AAAAAA"}],{name:t.name})},render:function(){this.requested_redraw=!1;var e=this.container,n=this;this.top_container=t("<div/>").addClass("top-container").appendTo(e),this.browser_content_div=t("<div/>").addClass("content").appendTo(e),this.bottom_container=t("<div/>").addClass("bottom-container").appendTo(e),this.top_labeltrack=t("<div/>").addClass("top-labeltrack").appendTo(this.top_container),this.viewport_container=t("<div/>").addClass("viewport-container").attr("id","viewport-container").appendTo(this.browser_content_div),this.content_div=this.viewport_container,E(this.viewport_container,n),this.intro_div=t("<div/>").addClass("intro").appendTo(this.viewport_container);t("<div/>").text("Add Datasets to Visualization").addClass("action-button").appendTo(this.intro_div).click(function(){c.default.select_datasets({dbkey:n.dbkey},function(t){l.each(t,function(t){n.add_drawable(it(t,n,n))})})});this.nav_container=t("<div/>").addClass("trackster-nav-container").prependTo(this.top_container),this.nav=t("<div/>").addClass("trackster-nav").appendTo(this.nav_container),this.stand_alone&&(this.nav_container.addClass("stand-alone"),this.nav.addClass("stand-alone")),this.overview=t("<div/>").addClass("overview").appendTo(this.bottom_container),this.overview_viewport=t("<div/>").addClass("overview-viewport").appendTo(this.overview),this.overview_close=t("<a/>").attr("title","Close overview").addClass("icon-button overview-close tooltip").hide().appendTo(this.overview_viewport),this.overview_highlight=t("<div/>").addClass("overview-highlight").hide().appendTo(this.overview_viewport),this.overview_box_background=t("<div/>").addClass("overview-boxback").appendTo(this.overview_viewport),this.overview_box=t("<div/>").addClass("overview-box").appendTo(this.overview_viewport),this.default_overview_height=this.overview_box.height(),this.nav_controls=t("<div/>").addClass("nav-controls").appendTo(this.nav),this.chrom_select=t("<select/>").attr({name:"chrom"}).addClass("chrom-nav").append("<option value=''>Loading</option>").appendTo(this.nav_controls);var i=function(e){"focusout"!==e.type&&13!==(e.keyCode||e.which)&&27!==(e.keyCode||e.which)||(27!==(e.keyCode||e.which)&&n.go_to(t(this).val()),t(this).hide(),t(this).val(""),n.location_span.show(),n.chrom_select.show()),e.stopPropagation()};this.nav_input=t("<input/>").addClass("nav-input").hide().bind("keyup focusout",i).appendTo(this.nav_controls),this.location_span=t("<span/>").addClass("location").attr("title","Click to change location").tooltip({placement:"bottom"}).appendTo(this.nav_controls),this.location_span.click(function(){n.location_span.hide(),n.chrom_select.hide(),n.nav_input.val(n.chrom+":"+n.low+"-"+n.high),n.nav_input.css("display","inline-block"),n.nav_input.select(),n.nav_input.focus(),n.nav_input.autocomplete({source:function(e,i){var r=[],a=t.map(n.get_tracks(K),function(t){return t.data_manager.search_features(e.term).success(function(t){r=r.concat(t)})});t.when.apply(t,a).done(function(){i(t.map(r,function(t){return{label:t[0],value:t[1]}}))})},minLength:2})}),void 0!==this.vis_id&&(this.hidden_input=t("<input/>").attr("type","hidden").val(this.vis_id).appendTo(this.nav_controls)),this.zo_link=t("<a/>").attr("id","zoom-out").attr("title","Zoom out").tooltip({placement:"bottom"}).click(function(){n.zoom_out()}).appendTo(this.nav_controls),this.zi_link=t("<a/>").attr("id","zoom-in").attr("title","Zoom in").tooltip({placement:"bottom"}).click(function(){n.zoom_in()}).appendTo(this.nav_controls),this.load_chroms_deferred=this.load_chroms({low:0}),this.chrom_select.bind("change",function(){n.change_chrom(n.chrom_select.val())}),this.browser_content_div.click(function(e){t(this).find("input").trigger("blur")}),this.browser_content_div.bind("dblclick",function(t){n.zoom_in(t.pageX,this.viewport_container)}),this.overview_box.bind("dragstart",function(t,e){this.current_x=e.offsetX}).bind("drag",function(t,e){var i=e.offsetX-this.current_x;this.current_x=e.offsetX;var r=Math.round(i/n.viewport_container.width()*(n.max_high-n.max_low));n.move_delta(-r)}),this.overview_close.click(function(){n.reset_overview()}),this.viewport_container.bind("draginit",function(t,e){if(t.clientX>n.viewport_container.width()-16)return!1}).bind("dragstart",function(t,e){e.original_low=n.low,e.current_height=t.clientY,e.current_x=e.offsetX}).bind("drag",function(e,i){var r=t(this),a=i.offsetX-i.current_x,o=r.scrollTop()-(e.clientY-i.current_height);r.scrollTop(o),i.current_height=e.clientY,i.current_x=i.offsetX;var s=Math.round(a/n.viewport_container.width()*(n.high-n.low));n.move_delta(s)}),this.top_labeltrack.bind("dragstart",function(e,i){return t("<div/>").addClass("zoom-area").css("height",n.browser_content_div.height()+n.top_labeltrack.height()+1).appendTo(t(this))}).bind("drag",function(e,i){t(i.proxy).css({left:Math.min(e.pageX,i.startX)-n.container.offset().left,width:Math.abs(e.pageX-i.startX)});var r=Math.min(e.pageX,i.startX)-n.container.offset().left,a=Math.max(e.pageX,i.startX)-n.container.offset().left,o=n.high-n.low,s=n.viewport_container.width();n.update_location(Math.round(r/s*o)+n.low,Math.round(a/s*o)+n.low)}).bind("dragend",function(e,i){var r=Math.min(e.pageX,i.startX),a=Math.max(e.pageX,i.startX),o=n.high-n.low,s=n.viewport_container.width(),l=n.low;n.low=Math.round(r/s*o)+l,n.high=Math.round(a/s*o)+l,t(i.proxy).remove(),n.request_redraw()}),this.add_label_track(new X(this,{content_div:this.top_labeltrack})),t(window).bind("resize",function(){this.resize_timer&&clearTimeout(this.resize_timer),this.resize_timer=setTimeout(function(){n.resize_window()},500)}),t(document).bind("redraw",function(){n.redraw()}),this.reset(),t(window).trigger("resize")},get_base_color:function(t){return this.config.get_value(t.toLowerCase()+"_color")||this.config.get_value("n_color")}});z(q.prototype,j.prototype,{changed:function(){this.has_changes=!0},update_intro_div:function(){this.intro_div.toggle(0===this.drawables.length)},trigger_navigate:function(t,e,n,i){if(this.timer&&clearTimeout(this.timer),i){var r=this;this.timer=setTimeout(function(){r.trigger("navigate",t+":"+e+"-"+n)},500)}else view.trigger("navigate",t+":"+e+"-"+n)},update_location:function(t,e){this.location_span.text(_.default.commatize(t)+" - "+_.default.commatize(e)),this.nav_input.val(this.chrom+":"+_.default.commatize(t)+"-"+_.default.commatize(e));var n=this.chrom_select.val();""!==n&&this.trigger_navigate(n,this.low,this.high,!0)},load_chroms:function(e){e.num=100;var n=this,i=t.Deferred();return t.ajax({url:Galaxy.root+"api/genomes/"+this.dbkey,data:e,dataType:"json",success:function(e){if(0!==e.chrom_info.length){if(e.reference){var r=new W(n);n.add_label_track(r),n.reference_track=r}n.chrom_data=e.chrom_info,n.chrom_select.html(""),n.chrom_select.append(t('<option value="">Select Chrom/Contig</option>'));for(var a=0,o=n.chrom_data.length;a<o;a++){var s=n.chrom_data[a].chrom,l=t("<option>");l.text(s),l.val(s),n.chrom_select.append(l)}e.prev_chroms&&n.chrom_select.append(t('<option value="previous">Previous 100</option>')),e.next_chroms&&n.chrom_select.append(t('<option value="next">Next 100</option>')),n.chrom_start_index=e.start_index,i.resolve(e.chrom_info)}},error:function(){alert("Could not load chroms for this dbkey: "+n.dbkey)}}),i},change_chrom:function(e,n,i){var r=this;if(!r.chrom_data)return void r.load_chroms_deferred.then(function(){r.change_chrom(e,n,i)});if(e&&"None"!==e){if("previous"===e)return void r.load_chroms({low:this.chrom_start_index-100});if("next"===e)return void r.load_chroms({low:this.chrom_start_index+100});var a=t.grep(r.chrom_data,function(t,n){return t.chrom===e})[0];if(void 0===a)return void r.load_chroms({chrom:e},function(){r.change_chrom(e,n,i)});if(e!==r.chrom){r.chrom=e,r.chrom_select.val(r.chrom),r.max_high=a.len-1,r.reset();for(var o=0,s=r.drawables.length;o<s;o++){var l=r.drawables[o];l.init&&l.init()}r.reference_track&&r.reference_track.init()}void 0===n&&void 0===i?(r.low=0,r.high=r.max_high):(r.low=void 0!==n?Math.max(n,0):0,void 0===i?(r.low=Math.max(r.low-15,0),r.high=r.low+30):r.high=Math.min(i,r.max_high)),r.request_redraw()}},go_to:function(t){t=t.replace(/,/g,""),t=t.replace(/:|\-/g," ");var e=t.split(/\s+/),n=e[0],i=e[1]?parseInt(e[1],10):void 0,r=e[2]?parseInt(e[2],10):void 0;this.change_chrom(n,i,r)},move_fraction:function(t){var e=this,n=e.high-e.low;this.move_delta(t*n)},move_delta:function(t){var e=this,n=e.high-e.low;e.low-t<e.max_low?(e.low=e.max_low,e.high=e.max_low+n):e.high-t>e.max_high?(e.high=e.max_high,e.low=e.max_high-n):(e.high-=t,e.low-=t),e.request_redraw({data_fetch:!1}),this.redraw_on_move_fn&&clearTimeout(this.redraw_on_move_fn),this.redraw_on_move_fn=setTimeout(function(){e.request_redraw()},200);var i=e.chrom_select.val();this.trigger_navigate(i,e.low,e.high,!0)},add_drawable:function(t){j.prototype.add_drawable.call(this,t),t.init(),this.changed(),this.update_intro_div();var e=this;t.config.on("change",function(){e.changed()})},add_label_track:function(t){t.view=this,t.init(),this.label_tracks.push(t)},remove_drawable:function(e,n){if(j.prototype.remove_drawable.call(this,e),n){var i=this;e.container_div.hide(0,function(){t(this).remove(),i.update_intro_div()})}},reset:function(){this.low=this.max_low,this.high=this.max_high,this.viewport_container.find(".yaxislabel").remove()},request_redraw:function(t,e){var n=this,i=e?[e]:n.drawables;l.each(i,function(e){var i=l.find(n.tracks_to_be_redrawn,function(t){return t[0]===e});i?i[1]=t:n.tracks_to_be_redrawn.push([e,t])}),this.requested_redraw||(requestAnimationFrame(function(){n._redraw()}),this.requested_redraw=!0)},_redraw:function(){this.requested_redraw=!1;var t=this.low,e=this.high;t<this.max_low&&(t=this.max_low),e>this.max_high&&(e=this.max_high);var n=this.high-this.low;0!==this.high&&n<this.min_separation&&(e=t+this.min_separation),this.low=Math.floor(t),this.high=Math.ceil(e),this.update_location(this.low,this.high),this.resolution_px_b=this.viewport_container.width()/(this.high-this.low);var i=this.low/(this.max_high-this.max_low)*this.overview_viewport.width()||0,r=(this.high-this.low)/(this.max_high-this.max_low)*this.overview_viewport.width()||0;this.overview_box.css({left:i,width:Math.max(13,r)}).show(),r<13&&this.overview_box.css("left",i-(13-r)/2),this.overview_highlight&&this.overview_highlight.css({left:i,width:r}),l.each(this.tracks_to_be_redrawn,function(t){var e=t[0],n=t[1];e&&e._draw(n)}),this.tracks_to_be_redrawn=[],l.each(this.label_tracks,function(t){t._draw()})},zoom_in:function(t,e){if(!(0===this.max_high||this.high-this.low<=this.min_separation)){var n=this.high-this.low,i=n/2+this.low,r=n/this.zoom_factor/2;t&&(i=t/this.viewport_container.width()*(this.high-this.low)+this.low),this.low=Math.round(i-r),this.high=Math.round(i+r),this.changed(),this.request_redraw()}},zoom_out:function(){if(0!==this.max_high){var t=this.high-this.low,e=t/2+this.low,n=t*this.zoom_factor/2;this.low=Math.round(e-n),this.high=Math.round(e+n),this.changed(),this.request_redraw()}},resize_viewport:function(){this.viewport_container.height(this.container.height()-this.top_container.height()-this.bottom_container.height())},resize_window:function(){this.resize_viewport(),this.request_redraw()},set_overview:function(t){if(this.overview_drawable){if(this.overview_drawable.dataset.id===t.dataset.id)return;this.overview_viewport.find(".track").remove()}var e=t.copy({content_div:this.overview_viewport}),n=this;e.header_div.hide(),e.is_overview=!0,n.overview_drawable=e,this.overview_drawable.postdraw_actions=function(){n.overview_highlight.show().height(n.overview_drawable.content_div.height()),n.overview_viewport.height(n.overview_drawable.content_div.height()+n.overview_box.outerHeight()),n.overview_close.show(),n.resize_window()},n.overview_drawable.request_draw(),this.changed()},reset_overview:function(){t(".tooltip").remove(),this.overview_viewport.find(".track-tile").remove(),this.overview_viewport.height(this.default_overview_height),this.overview_box.height(this.default_overview_height),this.overview_close.hide(),this.overview_highlight.hide(),view.resize_window(),view.overview_drawable=null}});var I=M.default.Tool.extend({defaults:{track:null},initialize:function(t){M.default.Tool.prototype.initialize.call(this,t);var e=!0;void 0!==t.tool_state&&void 0!==t.tool_state.hidden&&(e=t.tool_state.hidden),this.set("hidden",e),this.remove_inputs(["data","hidden_data","conditional"])},state_dict:function(t){return l.extend(this.get_inputs_dict(),{hidden:!this.is_visible()})}}),F=i.View.extend({events:{"change :input":"update_value"},render:function(){var e=this.$el.addClass("param-row"),n=this.model;t("<div>").addClass("param-label").text(n.get("label")).appendTo(e);t("<div/>").addClass("param-input").html(n.get("html")).appendTo(e).find(":input").val(n.get("value")),t("<div style='clear: both;'/>").appendTo(e)},update_value:function(e){this.model.set_value(t(e.target).val())}}),L=i.View.extend({initialize:function(t){this.model.on("change:hidden",this.set_visible,this)},render:function(){var e=this,n=this.model,i=this.$el.addClass("dynamic-tool").hide();i.bind("drag",function(t){t.stopPropagation()}).click(function(t){t.stopPropagation()}).bind("dblclick",function(t){t.stopPropagation()}).keydown(function(t){t.stopPropagation()});t("<div class='tool-name'>").appendTo(i).text(n.get("name"));n.get("inputs").each(function(t){var e=new F({model:t});e.render(),i.append(e.$el)}),i.find("input").click(function(){t(this).select()});var r=t("<div>").addClass("param-row").appendTo(i),a=t("<input type='submit'>").attr("value","Run on complete dataset").appendTo(r);t("<input type='submit'>").attr("value","Run on visible region").appendTo(r).click(function(){e.run_on_region()}),a.click(function(){e.run_on_dataset()}),n.is_visible()&&this.$el.show()},set_visible:function(){this.$el.toggle(this.model.is_visible())},update_params:function(){for(var t=0;t<this.params.length;t++)this.params[t].update_value()},run_on_dataset:function(){var t=this.model;this.run({target_dataset_id:this.model.get("track").dataset.id,action:"rerun",tool_id:t.id},null,function(e){Galaxy.modal.show({title:t.get("name")+" is Running",body:t.get("name")+" is running on the complete dataset. Tool outputs are in dataset's history.",buttons:{Close:function(){Galaxy.modal.hide()}}})})},run_on_region:function(){var t,e=this.model.get("track"),n=this.model,i=new c.default.GenomeRegion({chrom:e.view.chrom,start:e.view.low,end:e.view.high}),r={target_dataset_id:e.dataset.id,action:"rerun",tool_id:n.id,regions:[i.toJSON()]},a=e,o=n.get("name")+a.tool_region_and_parameters_str(i);if(a.container===view){var s=new $(view,view,{name:e.config.get_value("name")}),l=a.container.replace_drawable(a,s,!1);s.container_div.insertBefore(a.view.content_div.children()[l]),s.add_drawable(a),a.container_div.appendTo(s.content_div),t=s}else t=a.container;var u=new a.constructor(view,t,{name:o,hda_ldda:"hda"});u.init_for_tool_data(),u.change_mode(a.mode),u.set_filters_manager(a.filters_manager.copy(u)),u.update_icons(),t.add_drawable(u),u.tiles_div.text("Starting job."),this.run(r,u,function(t){u.set_dataset(new x.default.Dataset(t)),u.tiles_div.text("Running job."),u.init()})},run:function(e,n,i){e.inputs=this.model.get_inputs_dict();var r=new _.default.ServerStateDeferred({ajax_settings:{url:Galaxy.root+"api/tools",data:JSON.stringify(e),dataType:"json",contentType:"application/json",type:"POST"},interval:2e3,success_fn:function(t){return"pending"!==t}});t.when(r.go()).then(function(t){"no converter"===t?(n.container_div.addClass("error"),n.content_div.text(O)):t.error?(n.container_div.addClass("error"),n.content_div.text("Tool cannot be rerun: "+t.message)):i(t)})}}),G=function(t,e){m.default.Scaler.call(this,e),this.filter=t};G.prototype.gen_val=function(t){return this.filter.high===Number.MAX_VALUE||this.filter.low===-Number.MAX_VALUE||this.filter.low===this.filter.high?this.default_val:(parseFloat(t[this.filter.index])-this.filter.low)/(this.filter.high-this.filter.low)};var V=function(e,n,i,r,a){this.track=e,this.region=n,this.low=n.get("start"),this.high=n.get("end"),this.w_scale=i,this.canvas=r,this.html_elt=t("<div class='track-tile'/>").append(r),this.data=a,this.stale=!1};V.prototype.predisplay_actions=function(){};var H=function(t,e,n,i,r){V.call(this,t,e,n,i,r)};H.prototype.predisplay_actions=function(){};var U=function(t,e,n,i,r,a,o,s,l,u,c){V.call(this,t,e,n,i,r),this.mode=a,this.all_slotted=s,this.feature_mapper=l,this.has_icons=!1,this.incomplete_features=u,this.other_tiles_features_drawn={},this.seq_data=c};z(U.prototype,V.prototype),U.prototype.predisplay_actions=function(){};var B=function(e,n,r){z(r,{drag_handle_class:"draghandle"}),P.call(this,e,n,r),this.dataset=null,r.dataset&&(this.dataset=r.dataset instanceof i.Model?r.dataset:new x.default.Dataset(r.dataset)),this.dataset_check_type="converted_datasets_state",this.data_url_extra_params={},this.data_query_wait="data_query_wait"in r?r.data_query_wait:5e3,this.data_manager="data_manager"in r?r.data_manager:new c.default.GenomeDataManager({dataset:this.dataset,genome:new c.default.Genome({key:e.dbkey,chroms_info:{chrom_info:e.chrom_data}}),data_mode_compatible:this.data_and_mode_compatible,can_subset:this.can_subset}),this.min_height_px=16,this.max_height_px=800,this.visible_height_px=this.config.get_value("height"),this.content_div=t("<div class='track-content'>").appendTo(this.container_div),this.container&&(this.container.content_div.append(this.container_div),"resize"in r&&!r.resize||this.add_resize_handle())};z(B.prototype,P.prototype,{action_icons_def:[{name:"mode_icon",title:"Set display mode",css_class:"chevron-expand",on_click_fn:function(){}},P.prototype.action_icons_def[0],{name:"overview_icon",title:"Set as overview",css_class:"application-dock-270",on_click_fn:function(t){t.view.set_overview(t)}},P.prototype.action_icons_def[1],{name:"filters_icon",title:"Filters",css_class:"ui-slider-050",on_click_fn:function(t){t.filters_manager.visible()?t.filters_manager.clear_filters():t.filters_manager.init_filters(),t.filters_manager.toggle()}},{name:"tools_icon",title:"Tool",css_class:"hammer",on_click_fn:function(e){e.tool.toggle(),e.tool.is_visible()?e.set_name(e.config.get_value("name")+e.tool_region_and_parameters_str()):e.revert_name(),t(".tooltip").remove()}},{name:"param_space_viz_icon",title:"Tool parameter space visualization",css_class:"arrow-split",on_click_fn:function(e){var n="<strong>Tool</strong>:"+e.tool.get("name")+"<br/><strong>Dataset</strong>:"+e.config.get_value("name")+'<br/><strong>Region(s)</strong>: <select name="regions"><option value="cur">current viewing area</option><option value="bookmarks">bookmarks</option><option value="both">current viewing area and bookmarks</option></select>',r=function(){Galaxy.modal.hide(),t(window).unbind("keypress.check_enter_esc")},a=function(){var n,r=t('select[name="regions"] option:selected').val(),a=new c.default.GenomeRegion({chrom:view.chrom,start:view.low,end:view.high}),o=l.map(t(".bookmark"),function(e){return new c.default.GenomeRegion({from_str:t(e).children(".position").text()})});n="cur"===r?[a]:"bookmarks"===r?o:[a].concat(o),Galaxy.modal.hide(),window.location.href=Galaxy.root+"visualization/sweepster?"+t.param({dataset_id:e.dataset.id,hda_ldda:e.dataset.get("hda_ldda"),regions:JSON.stringify(new i.Collection(n).toJSON())})};Galaxy.modal.show({title:"Visualize tool parameter space and output from different parameter settings?",body:n,buttons:{No:r,Yes:a}})}},P.prototype.action_icons_def[2]],can_draw:function(){return this.dataset&&P.prototype.can_draw.call(this)},build_container_div:function(){return t("<div/>").addClass("track").attr("id","track_"+this.id)},set_dataset:function(t){this.dataset=t,this.data_manager.set("dataset",t)},on_resize:function(){this.request_draw({clear_tile_cache:!0})},add_resize_handle:function(){var e=this,n=!1,i=!1,r=t("<div class='track-resize'>");t(e.container_div).hover(function(){e.config.get_value("content_visible")&&(n=!0,r.show())},function(){n=!1,i||r.hide()}),r.hide().bind("dragstart",function(n,r){i=!0,r.original_height=t(e.content_div).height()}).bind("drag",function(n,i){var r=Math.min(Math.max(i.original_height+i.deltaY,e.min_height_px),e.max_height_px);t(e.tiles_div).css("height",r),e.visible_height_px=e.max_height_px===r?0:r,e.on_resize()}).bind("dragend",function(t,a){e.tile_cache.clear(),i=!1,n||r.hide(),e.config.set_value("height",e.visible_height_px),e.changed()}).appendTo(e.container_div)},hide_contents:function(){this.tiles_div.hide(),this.container_div.find(".yaxislabel, .track-resize").hide()},show_contents:function(){this.tiles_div.show(),this.container_div.find(".yaxislabel, .track-resize").show(),this.request_draw()},get_type:function(){return this instanceof X?"LabelTrack":this instanceof W?"ReferenceTrack":this instanceof Z?"LineTrack":this instanceof et?"ReadTrack":this instanceof tt?"VariantTrack":this instanceof J?"CompositeTrack":this instanceof K?"FeatureTrack":""},show_message:function(e){return this.tiles_div.remove(),t("<span/>").addClass("message").html(e).appendTo(this.content_div)},init:function(e){var n=this;if(n.enabled=!1,n.tile_cache.clear(),n.data_manager.clear(),n.content_div.children().remove(),n.container_div.removeClass("nodata error pending"),n.tiles_div=t("<div/>").addClass("tiles").appendTo(n.content_div),n.dataset.id){var i=t.Deferred(),r={hda_ldda:n.dataset.get("hda_ldda"),data_type:this.dataset_check_type,chrom:n.view.chrom,retry:e};return t.getJSON(this.dataset.url(),r,function(e){if(e&&"error"!==e&&"error"!==e.kind)"no converter"===e?(n.container_div.addClass("error"),n.show_message(O)):"no data"===e||void 0!==e.data&&(null===e.data||0===e.data.length)?(n.container_div.addClass("nodata"),n.show_message("No data for this chrom/contig.")):"pending"===e?(n.container_div.addClass("pending"),n.show_message("Preparing data. This can take a while for a large dataset. If the visualization is saved and closed, preparation will continue in the background."),setTimeout(function(){n.init()},n.data_query_wait)):"data"!==e&&"data"!==e.status||(e.valid_chroms&&(n.valid_chroms=e.valid_chroms,n.update_icons()),n.tiles_div.text("Ready for display"),n.view.chrom?(n.tiles_div.text(""),n.tiles_div.css("height",n.visible_height_px+"px"),n.enabled=!0,t.when.apply(t,n.predraw_init()).done(function(){i.resolve(),n.container_div.removeClass("nodata error pending"),n.request_draw()})):i.resolve());else{n.container_div.addClass("error");var r=n.show_message("Cannot display dataset due to an error. ");e.message&&(r.append(t("<a href='javascript:void(0);'></a>").text("View error").click(function(){Galaxy.modal.show({title:"Trackster Error",body:"<pre>"+e.message+"</pre>",buttons:{Close:function(){Galaxy.modal.hide()}}})})),r.append(t("<span/>").text(" ")),r.append(t("<a href='javascript:void(0);'></a>").text("Try again").click(function(){n.init(!0)})))}}),this.update_icons(),i}},predraw_init:function(){var e=this;return t.getJSON(e.dataset.url(),{data_type:"data",stats:!0,chrom:e.view.chrom,low:0,high:e.view.max_high,hda_ldda:e.dataset.get("hda_ldda")},function(t){var n=t.data;if(n&&void 0!==n.min&&void 0!==n.max){var i=n.min,r=n.max;i=Math.floor(Math.min(0,Math.max(i,n.mean-2*n.sd))),r=Math.ceil(Math.max(0,Math.min(r,n.mean+2*n.sd))),e.config.set_default_value("min_value",i),e.config.set_default_value("max_value",r),e.config.set_value("min_value",i),e.config.set_value("max_value",r)}})},get_drawables:function(){return this}});var Y=function(e,n,i){B.call(this,e,n,i);var r=this;if(R(r.container_div,r.drag_handle_class,".group",r),this.filters_manager=new w.default.FiltersManager(this,"filters"in i?i.filters:null),this.data_manager.set("filters_manager",this.filters_manager),this.filters_available=!1,this.tool=i.tool?new I(l.extend(i.tool,{track:this,tool_state:i.tool_state})):null,this.tile_cache=new c.default.Cache(10),this.left_offset=0,this.header_div&&(this.set_filters_manager(this.filters_manager),this.tool)){var a=new L({model:this.tool});a.render(),this.dynamic_tool_div=a.$el,this.header_div.after(this.dynamic_tool_div)}this.tiles_div=t("<div/>").addClass("tiles").appendTo(this.content_div),this.config.get_value("content_visible")||this.tiles_div.hide(),this.overlay_div=t("<div/>").addClass("overlay").appendTo(this.content_div),i.mode&&this.change_mode(i.mode)};z(Y.prototype,P.prototype,B.prototype,{action_icons_def:B.prototype.action_icons_def.concat([{name:"show_more_rows_icon",title:"To minimize track height, not all feature rows are displayed. Click to display more rows.",css_class:"exclamation",on_click_fn:function(e){t(".tooltip").remove(),e.slotters[e.view.resolution_px_b].max_rows*=2,e.request_draw({clear_tile_cache:!0})},hide:!0}]),copy:function(t){var e=this.to_dict();z(e,{data_manager:this.data_manager});var n=new this.constructor(this.view,t,e);return n.change_mode(this.mode),n.enabled=this.enabled,n},set_filters_manager:function(t){this.filters_manager=t,this.header_div.after(this.filters_manager.parent_div)},to_dict:function(){return{track_type:this.get_type(),dataset:{id:this.dataset.id,hda_ldda:this.dataset.get("hda_ldda")},prefs:this.config.to_key_value_dict(),mode:this.mode,filters:this.filters_manager.to_dict(),tool_state:this.tool?this.tool.state_dict():{}}},set_min_max:function(){var e=this;return t.getJSON(e.dataset.url(),{data_type:"data",stats:!0,chrom:e.view.chrom,low:0,high:e.view.max_high,hda_ldda:e.dataset.get("hda_ldda")},function(t){var n=t.data;if(isNaN(parseFloat(e.config.get_value("min_value")))||isNaN(parseFloat(e.config.get_value("max_value")))){var i=n.min,r=n.max;i=Math.floor(Math.min(0,Math.max(i,n.mean-2*n.sd))),r=Math.ceil(Math.max(0,Math.min(r,n.mean+2*n.sd))),e.config.set_value("min_value",i),e.config.set_value("max_value",r)}})},change_mode:function(t){var e=this;return e.mode=t,e.config.set_value("mode",t),"Auto"===t&&this.data_manager.clear(),e.request_draw({clear_tile_cache:!0}),this.action_icons.mode_icon.attr("title","Set display mode (now: "+e.mode+")"),e},update_icons:function(){var t=this;t.action_icons.filters_icon.toggle(t.filters_available),t.action_icons.tools_icon.toggle(null!==t.tool),t.action_icons.param_space_viz_icon.toggle(null!==t.tool)},_gen_tile_cache_key:function(t,e){return t+"_"+e},request_draw:function(t){t&&t.clear_tile_cache&&this.tile_cache.clear(),this.view.request_redraw(t,this)},before_draw:function(){this.max_height_px=0},_draw:function(e){if(this.can_draw()){var n=e&&e.clear_after,i=this.view.low,r=this.view.high,a=this.view.container.width(),o=this.view.resolution_px_b,s=1/o;this.is_overview&&(i=this.view.max_low,r=this.view.max_high,o=a/(view.max_high-view.max_low),s=1/o),this.before_draw(),this.tiles_div.children().addClass("remove");for(var u,h,d=Math.floor(400*s),f=Math.floor(i/d),_=[],p=[];f*d<r;)u=new c.default.GenomeRegion({chrom:this.view.chrom,start:f*d,end:Math.min((f+1)*d,this.view.max_high)}),h=this.draw_helper(u,o,e),_.push(h),t.when(h).then(function(t){p.push(t)}),f+=1;n||this.tiles_div.children(".remove").removeClass("remove").remove();var v=this;t.when.apply(t,_).then(function(){v.tiles_div.children(".remove").remove(),p=l.filter(p,function(t){return null!==t}),0!==p.length&&v.postdraw_actions(p,a,o,n)})}},_add_yaxis_label:function(e,n){var i=this,r="max"===e?"top":"bottom",o="max"===e?"max":"min",s="max"===e?"max_value":"min_value",l=this.container_div.find(".yaxislabel."+r),u=a(i.config.get_value(s),1);n=n||function(){i.request_draw({clear_tile_cache:!0})},0!==l.length?l.text(u):(l=t("<div/>").text(u).make_text_editable({num_cols:12,on_finish:function(e){t(".tooltip").remove(),i.config.set_value(s,a(e,1)),n()},help_text:"Set "+o+" value"}).addClass("yaxislabel "+r).css("color",this.config.get_value("label_color")),this.container_div.prepend(l))},postdraw_actions:function(t,e,n,i){if(l.filter(t,function(t){return t instanceof H}).length>0){this.max_height_px=0;var r=this;l.each(t,function(t){t instanceof H||(t.html_elt.remove(),r.draw_helper(t.region,n,{force:!0,mode:"Coverage"}))}),r._add_yaxis_label("max")}else this.container_div.find(".yaxislabel").remove(),l.find(t,function(t){return t.has_icons})&&l.each(t,function(t){t.has_icons||t.html_elt.css("padding-top",20)})},get_mode:function(t){return this.mode},update_auto_mode:function(t){},_get_drawables:function(){return[this]},draw_helper:function(e,n,i){i||(i={});var r=i.force,a=i.mode||this.mode,o=1/n,s=this,u=this._get_drawables(),c=this._gen_tile_cache_key(n,e),h=r?void 0:s.tile_cache.get_elt(c);if(h)return function(t){return t&&"track"in t}(h)&&s.show_tile(h,n),h;if(!1===i.data_fetch)return null;var d=function(){var t=l.find(D,function(t){return t===a})?"Coverage":a,n=l.map(u,function(n){return n.data_manager.get_data(e,t,o,s.data_url_extra_params)});return view.reference_track&&n.push(view.reference_track.data_manager.get_data(e,a,o,view.reference_track.data_url_extra_params)),n},f=t.Deferred();return s.tile_cache.set_elt(c,f),t.when.apply(t,d()).then(function(){var r,a=d(),o=a;if(l.find(a,function(t){return _.default.is_deferred(t)}))return s.tile_cache.set_elt(c,void 0),void t.when(s.draw_helper(e,n,i)).then(function(t){f.resolve(t)});view.reference_track&&(r=view.reference_track.data_manager.subset_entry(a.pop(),e));var h=[],p=[];l.each(u,function(t,e){var i=t.mode,r=o[e];"Auto"===i&&(i=t.get_mode(r),t.update_auto_mode(i)),h.push(i),p.push(t.get_canvas_height(r,i,n,w))});var v,g=s.view.canvas_manager.new_canvas(),m=e.get("start"),y=e.get("end"),w=Math.ceil((y-m)*n)+s.left_offset,b=l.max(p);g.width=w,g.height=i.height||b;var x=g.getContext("2d");x.translate(s.left_offset,0),u.length>1&&(x.globalAlpha=.5,x.globalCompositeOperation="source-over"),l.each(u,function(t,i){v=t.draw_tile(o[i],x,h[i],e,n,r)}),void 0!==v&&(s.tile_cache.set_elt(c,v),s.show_tile(v,n)),f.resolve(v)}),f},get_canvas_height:function(t,e,n,i){return this.visible_height_px},_draw_line_track_tile:function(t,e,n,i,r){-1!==[void 0,null].indexOf(this.config.get_value("min_value"))&&this.config.set_value("min_value",0),-1!==[void 0,null,0].indexOf(this.config.get_value("max_value"))&&this.config.set_value("max_value",l.max(l.map(t.data,function(t){return t[1]}))||0);var a=e.canvas;return new m.default.LinePainter(t.data,i.get("start"),i.get("end"),this.config.to_key_value_dict(),n).draw(e,a.width,a.height,r),new H(this,i,r,a,t.data)},draw_tile:function(t,e,n,i,r,a){},show_tile:function(t,e){var n=t.html_elt;t.predisplay_actions();var i=Math.round((t.low-(this.is_overview?this.view.max_low:this.view.low))*e);this.left_offset&&(i-=this.left_offset),n.css("left",i),n.hasClass("remove")?n.removeClass("remove"):this.tiles_div.append(n),n.css("height","auto"),this.max_height_px=Math.max(this.max_height_px,n.height()-2),n.parent().children().css("height",this.max_height_px+"px");var r=this.max_height_px;0!==this.visible_height_px&&(r=Math.min(this.max_height_px,this.visible_height_px)),this.tiles_div.css("height",r+"px")},tool_region_and_parameters_str:function(t){var e=this;return" - region=["+(void 0!==t?t.toString():"all")+"], parameters=["+l.values(e.tool.get_inputs_dict()).join(", ")+"]"},data_and_mode_compatible:function(t,e){return"Auto"===e||("Coverage"===e?"bigwig"===t.dataset_type:"bigwig"!==t.dataset_type&&"no_detail"!==t.extra_info)},can_subset:function(t){return!t.message&&"no_detail"!==t.extra_info&&("bigwig"!==t.dataset_type||t.data[1][0]-t.data[0][0]==1)},init_for_tool_data:function(){this.data_manager.set("data_type","raw_data"),this.data_query_wait=1e3,this.dataset_check_type="state"}});var X=function(t,e){B.call(this,t,e,{resize:!1,header:!1}),this.container_div.addClass("label-track")};z(X.prototype,B.prototype,{init:function(){this.enabled=!0},predraw_init:function(){},_draw:function(e){for(var n=this.view,i=n.high-n.low,r=Math.floor(Math.pow(10,Math.floor(Math.log(i)/Math.log(10)))),a=Math.floor(n.low/r)*r,o=this.view.container.width(),s=t("<div/>").addClass("label-container");a<n.high;){var l=Math.floor((a-n.low)/i*o);s.append(t("<div/>").addClass("pos-label").text(_.default.commatize(a)).css({left:l})),a+=r}this.content_div.children(":first").remove(),this.content_div.append(s)}});var J=function(t,e,n){if(Y.call(this,t,e,n),this.drawables=[],"drawables"in n){for(var i,r=0;r<n.drawables.length;r++)i=n.drawables[r],this.drawables[r]=it(i,t,null),i.left_offset>this.left_offset&&(this.left_offset=i.left_offset);this.enabled=!0}l.each(this.drawables,function(t){(t instanceof K||t instanceof et)&&t.change_mode("Coverage")}),this.update_icons(),this.obj_type="CompositeTrack"};z(J.prototype,Y.prototype,{display_modes:D,build_config_params:function(){return l.union(P.prototype.config_params,[{key:"min_value",label:"Min Value",type:"float",default_value:void 0},{key:"max_value",label:"Max Value",type:"float",default_value:void 0},{key:"mode",type:"string",default_value:this.mode,hidden:!0},{key:"height",type:"int",default_value:30,hidden:!0}])},action_icons_def:[{name:"composite_icon",title:"Show individual tracks",css_class:"layers-stack",on_click_fn:function(e){t(".tooltip").remove(),e.show_group()}}].concat(Y.prototype.action_icons_def),to_dict:j.prototype.to_dict,add_drawable:j.prototype.add_drawable,unpack_drawables:j.prototype.unpack_drawables,config_onchange:function(){this.set_name(this.config.get_value("name")),this.request_draw({clear_tile_cache:!0})},on_resize:function(){var t=this.visible_height_px;l.each(this.drawables,function(e){e.visible_height_px=t}),B.prototype.on_resize.call(this)},change_mode:function(t){Y.prototype.change_mode.call(this,t);for(var e=0;e<this.drawables.length;e++)this.drawables[e].change_mode(t)},init:function(){for(var e=[],n=0;n<this.drawables.length;n++)e.push(this.drawables[n].init());var i=this;t.when.apply(t,e).then(function(){i.enabled=!0,i.request_draw()})},update_icons:function(){this.action_icons.filters_icon.hide(),this.action_icons.tools_icon.hide(),this.action_icons.param_space_viz_icon.hide()},can_draw:P.prototype.can_draw,_get_drawables:function(){return this.drawables},show_group:function(){for(var t,e=new $(this.view,this.container,{name:this.config.get_value("name")}),n=0;n<this.drawables.length;n++)t=this.drawables[n],t.update_icons(),e.add_drawable(t),t.container=e,e.content_div.append(t.container_div);this.container.replace_drawable(this,e,!0);e.request_draw({clear_tile_cache:!0})},before_draw:function(){var t=l.min(l.map(this.drawables,function(t){return t.config.get_value("min_value")})),e=l.max(l.map(this.drawables,function(t){return t.config.get_value("max_value")}));this.config.set_value("min_value",t),this.config.set_value("max_value",e),l.each(this.drawables,function(n){n.config.set_value("min_value",t),n.config.set_value("max_value",e)})},update_all_min_max:function(){var t=this.config.get_value("min_value"),e=this.config.get_value("max_value");l.each(this.drawables,function(n){n.config.set_value("min_value",t),n.config.set_value("max_value",e)}),this.request_draw({clear_tile_cache:!0})},postdraw_actions:function(t,e,n,i){var r,a=-1;for(r=0;r<t.length;r++){var o=t[r].html_elt.find("canvas").height();o>a&&(a=o)}for(r=0;r<t.length;r++){var s=t[r];s.html_elt.find("canvas").height()!==a&&(this.draw_helper(s.region,n,{force:!0,height:a}),s.html_elt.remove())}var l=this,u=function(){l.update_all_min_max()};this._add_yaxis_label("min",u),this._add_yaxis_label("max",u)}});var W=function(t){Y.call(this,t,{content_div:t.top_labeltrack},{resize:!1,header:!1}),this.left_offset=t.canvas_manager.char_width_px,this.container_div.addClass("reference-track"),this.data_url=Galaxy.root+"api/genomes/"+this.view.dbkey,this.data_url_extra_params={reference:!0},this.data_manager=new c.default.GenomeReferenceDataManager({data_url:this.data_url,can_subset:this.can_subset}),this.hide_contents()};z(W.prototype,P.prototype,Y.prototype,{build_config_params:function(){return l.union(P.prototype.config_params,[{key:"height",type:"int",default_value:13,hidden:!0}])},init:function(){this.data_manager.clear(),this.enabled=!0},predraw_init:function(){},can_draw:P.prototype.can_draw,draw_helper:function(t,e,n){var i,r=this.tiles_div.is(":visible"),a=null;return e>this.view.canvas_manager.char_width_px?(this.tiles_div.show(),i=!0,a=Y.prototype.draw_helper.call(this,t,e,n)):(i=!1,this.tiles_div.hide()),r!==i&&this.view.resize_viewport(),a},can_subset:function(t){return!0},draw_tile:function(t,e,n,i,r){var a=this.data_manager.subset_entry(t,i),o=a.data,s=e.canvas;e.font=e.canvas.manager.default_font,e.textAlign="center";for(var l=0,u=o.length;l<u;l++)e.fillStyle=this.view.get_base_color(o[l]),e.fillText(o[l],Math.floor(l*r),10);return new V(this,i,r,s,a)}});var Z=function(e,n,i){this.mode="Histogram",Y.call(this,e,n,i),this.left_offset=30;var r=this;t.when(o(Galaxy.root+"datasets/"+this.dataset.id+"/display")).then(function(t){t&&(r.data_manager=new A.default.BBIDataManager({dataset:r.dataset}))})};z(Z.prototype,P.prototype,Y.prototype,{display_modes:D,build_config_params:function(){return l.union(P.prototype.config_params,[{key:"color",label:"Color",type:"color"},{key:"min_value",label:"Min Value",type:"float",default_value:void 0},{key:"max_value",label:"Max Value",type:"float",default_value:void 0},{key:"mode",type:"string",default_value:this.mode,hidden:!0},{key:"height",type:"int",default_value:30,hidden:!0}])},config_onchange:function(){this.set_name(this.config.get_value("name")),this.request_draw({clear_tile_cache:!0})},before_draw:function(){},draw_tile:function(t,e,n,i,r){return this._draw_line_track_tile(t,e,n,i,r)},can_subset:function(t){return t.data[1][0]-t.data[0][0]==1},postdraw_actions:function(t,e,n,i){this._add_yaxis_label("max"),this._add_yaxis_label("min")}});var Q=function(t,e,n){this.mode="Heatmap",Y.call(this,t,e,n)};z(Q.prototype,P.prototype,Y.prototype,{display_modes:["Heatmap"],build_config_params:function(){return l.union(P.prototype.config_params,[{key:"pos_color",label:"Positive Color",type:"color",default_value:"#FF8C00"},{key:"neg_color",label:"Negative Color",type:"color",default_value:"#4169E1"},{key:"min_value",label:"Min Value",type:"int",default_value:void 0},{key:"max_value",label:"Max Value",type:"int",default_value:void 0},{key:"mode",type:"string",default_value:this.mode,hidden:!0},{key:"height",type:"int",default_value:500,hidden:!0}])},config_onchange:function(){this.set_name(this.config.get_value("name")),this.request_draw({clear_tile_cache:!0})},predraw_init:function(){var e=this;return t.getJSON(e.dataset.url(),{data_type:"data",stats:!0,chrom:e.view.chrom,low:0,high:e.view.max_high,hda_ldda:e.dataset.get("hda_ldda")},function(t){t.data})},draw_tile:function(t,e,n,i,r){var a=e.canvas;return new m.default.DiagonalHeatmapPainter(t.data,i.get("start"),i.get("end"),this.config.to_key_value_dict(),n).draw(e,a.width,a.height,r),new V(this,i,r,a,t.data)}});var K=function(t,e,n){Y.call(this,t,e,n),this.container_div.addClass("feature-track"),this.summary_draw_height=30,this.slotters={},this.start_end_dct={},this.left_offset=200,this.set_painter_from_config()};z(K.prototype,P.prototype,Y.prototype,{display_modes:["Auto","Coverage","Dense","Squish","Pack"],build_config_params:function(){return l.union(P.prototype.config_params,[{key:"block_color",label:"Block color",type:"color"},{key:"reverse_strand_color",label:"Antisense strand color",type:"color"},{key:"label_color",label:"Label color",type:"color",default_value:"black"},{key:"show_counts",label:"Show summary counts",type:"bool",default_value:!0,help:"Show the number of items in each bin when drawing summary histogram"},{key:"min_value",label:"Histogram minimum",type:"float",default_value:void 0,help:"clear value to set automatically"},{key:"max_value",label:"Histogram maximum",type:"float",default_value:void 0,help:"clear value to set automatically"},{key:"connector_style",label:"Connector style",type:"select",default_value:"fishbones",options:[{label:"Line with arrows",value:"fishbone"},{label:"Arcs",value:"arcs"}]},{key:"mode",type:"string",default_value:this.mode,hidden:!0},{key:"height",type:"int",default_value:0,hidden:!0}])},config_onchange:function(){this.set_name(this.config.get_value("name")),this.set_painter_from_config(),this.request_draw({clear_tile_cache:!0})},set_painter_from_config:function(){"arcs"===this.config.get_value("connector_style")?this.painter=m.default.ArcLinkedFeaturePainter:this.painter=m.default.LinkedFeaturePainter},postdraw_actions:function(e,n,i,r){Y.prototype.postdraw_actions.call(this,e,n,i,r);var a,o=this;if(0===l.filter(e,function(t){return t instanceof H}).length){var s={};l.each(l.pluck(e,"incomplete_features"),function(t){l.each(t,function(t){s[t[0]]=t})});var u=this;l.each(e,function(e){var n=l.omit(s,l.map(e.incomplete_features,function(t){return t[0]}));if(n=l.omit(n,l.keys(e.other_tiles_features_drawn)),0!==l.size(n)){var i={data:l.values(n)},r=u.view.canvas_manager.new_canvas(),a=r.getContext("2d");r.height=Math.max(e.canvas.height,u.get_canvas_height(i,e.mode,e.w_scale,100)),r.width=e.canvas.width,a.drawImage(e.canvas,0,0),a.translate(o.left_offset,0);var c=u.draw_tile(i,a,e.mode,e.region,e.w_scale,e.seq_data);t(e.canvas).replaceWith(t(c.canvas)),e.canvas=r,l.extend(e.other_tiles_features_drawn,s)}})}if(o.filters_manager){var c,h=o.filters_manager.filters;for(c=0;c<h.length;c++)h[c].update_ui_elt();var d,f,_=!1;for(a=0;a<e.length;a++)if(e[a].data.length)for(d=e[a].data[0],c=0;c<h.length;c++)if(f=h[c],f.applies_to(d)&&f.min!==f.max){_=!0;break}o.filters_available!==_&&(o.filters_available=_,o.filters_available||o.filters_manager.hide(),o.update_icons())}if(e[0]instanceof U){var p=!0;for(a=0;a<e.length;a++)if(!e[a].all_slotted){p=!1;break}this.action_icons.show_more_rows_icon.toggle(!p)}else this.action_icons.show_more_rows_icon.hide()},update_auto_mode:function(t){"Auto"===this.mode&&("no_detail"===t&&(t="feature spans"),this.action_icons.mode_icon.attr("title","Set display mode (now: Auto/"+t+")"))},incremental_slots:function(t,e,n){var i=this.view.canvas_manager.dummy_context,r=this.slotters[t];return r&&r.mode===n||(r=new v.default.FeatureSlotter(t,n,100,function(t){return i.measureText(t)}),this.slotters[t]=r),r.slot_features(e)},get_mode:function(t){return"no_detail"===t.extra_info||this.is_overview?"no_detail":this.view.high-this.view.low>12e3?"Squish":"Pack"},get_canvas_height:function(t,e,n,i){if("Coverage"===e||"bigwig"===t.dataset_type)return this.summary_draw_height;var r=this.incremental_slots(n,t.data,e),a=new this.painter(null,null,null,this.config.to_key_value_dict(),e);return Math.max(this.min_height_px,a.get_required_height(r,i))},draw_tile:function(t,e,n,i,r,a,o){var s=this,l=e.canvas,u=i.get("start"),c=i.get("end"),h=this.left_offset;if("bigwig"===t.dataset_type)return this._draw_line_track_tile(t,e,n,i,r);var d=[],f=this.slotters[r].slots,_=!0;if(t.data)for(var p=this.filters_manager.filters,v=0,g=t.data.length;v<g;v++){for(var m,y=t.data[v],w=!1,b=0,x=p.length;b<x;b++)if(m=p[b],m.update_attrs(y),!m.keep(y)){w=!0;break}w||(d.push(y),y[0]in f||(_=!1))}var k=this.filters_manager.alpha_filter?new G(this.filters_manager.alpha_filter):null,M=this.filters_manager.height_filter?new G(this.filters_manager.height_filter):null,C=new this.painter(d,u,c,this.config.to_key_value_dict(),n,k,M,a,function(t){return s.view.get_base_color(t)}),S=null;if(e.fillStyle=this.config.get_value("block_color"),e.font=e.canvas.manager.default_font,e.textAlign="right",t.data){var T=C.draw(e,l.width,l.height,r,f);S=T.feature_mapper,incomplete_features=T.incomplete_features,S.translation=-h}return o?void 0:new U(s,i,r,l,t.data,n,t.message,_,S,incomplete_features,a)}});var tt=function(t,e,n){Y.call(this,t,e,n),this.painter=m.default.VariantPainter,this.summary_draw_height=30,this.left_offset=30};z(tt.prototype,P.prototype,Y.prototype,{display_modes:["Auto","Coverage","Dense","Squish","Pack"],build_config_params:function(){return l.union(P.prototype.config_params,[{key:"color",label:"Histogram color",type:"color"},{key:"show_sample_data",label:"Show sample data",type:"bool",default_value:!0},{key:"show_labels",label:"Show summary and sample labels",type:"bool",default_value:!0},{key:"summary_height",label:"Locus summary height",type:"float",default_value:20},{key:"mode",type:"string",default_value:this.mode,hidden:!0},{key:"height",type:"int",default_value:0,hidden:!0}])},config_onchange:function(){this.set_name(this.config.get_value("name")),this.request_draw({clear_tile_cache:!0})},draw_tile:function(t,e,n,i,r){if("bigwig"===t.dataset_type)return this._draw_line_track_tile(t,e,"Histogram",i,r);var a=this.view;return new this.painter(t.data,i.get("start"),i.get("end"),this.config.to_key_value_dict(),n,function(t){return a.get_base_color(t)}).draw(e,e.canvas.width,e.canvas.height,r),new V(this,i,r,e.canvas,t.data)},get_canvas_height:function(t,e,n,i){if("bigwig"===t.dataset_type)return this.summary_draw_height;var r=this.dataset.get_metadata("sample_names")?this.dataset.get_metadata("sample_names").length:0;return 0===r&&0!==t.data.length&&(r=t.data[0][7].match(/,/g),r=null===r?1:r.length+1),new this.painter(null,null,null,this.config.to_key_value_dict(),e).get_required_height(r)},predraw_init:function(){var t=[B.prototype.predraw_init.call(this)];return this.dataset.get_metadata("sample_names")||t.push(this.dataset.fetch()),t},postdraw_actions:function(e,n,i,r){Y.prototype.postdraw_actions.call(this,e,n,i,r);var a=l.filter(e,function(t){return t instanceof H}),o=this.dataset.get_metadata("sample_names");if(0===a.length&&this.config.get_value("show_labels")&&o&&o.length>1){var s;if(0===this.container_div.find(".yaxislabel.variant").length&&(s=this.config.get_value("summary_height")/2,this.tiles_div.prepend(t("<div/>").text("Summary").addClass("yaxislabel variant top").css({"font-size":s+"px",top:(this.config.get_value("summary_height")-s)/2+"px"})),this.config.get_value("show_sample_data"))){var u=o.join("<br/>");this.tiles_div.prepend(t("<div/>").html(u).addClass("yaxislabel variant top sample").css({top:this.config.get_value("summary_height")}))}s=("Squish"===this.mode?5:10)+"px",t(this.tiles_div).find(".sample").css({"font-size":s,"line-height":s}),t(this.tiles_div).find(".yaxislabel").css("color",this.config.get_value("label_color"))}else this.container_div.find(".yaxislabel.variant").remove()}});var et=function(t,e,n){K.call(this,t,e,n),this.painter=m.default.ReadPainter,this.update_icons()};z(et.prototype,P.prototype,Y.prototype,K.prototype,{build_config_params:function(){return l.union(P.prototype.config_params,[{key:"block_color",label:"Histogram color",type:"color"},{key:"detail_block_color",label:"Sense strand block color",type:"color",default_value:"#AAAAAA"},{key:"reverse_strand_color",label:"Antisense strand block color",type:"color",default_value:"#DDDDDD"},{key:"label_color",label:"Label color",type:"color",default_value:"black"},{key:"show_insertions",label:"Show insertions",type:"bool",default_value:!1},{key:"show_differences",label:"Show differences only",type:"bool",default_value:!0},{key:"show_counts",label:"Show summary counts",type:"bool",default_value:!0},{key:"mode",type:"string",default_value:this.mode,hidden:!0},{key:"min_value",label:"Histogram minimum",type:"float",default_value:void 0,help:"clear value to set automatically"},{key:"max_value",label:"Histogram maximum",type:"float",default_value:void 0,help:"clear value to set automatically"},{key:"height",type:"int",default_value:0,hidden:!0}])},config_onchange:function(){this.set_name(this.config.get_value("name")),this.request_draw({clear_tile_cache:!0})}});var nt={CompositeTrack:J,DrawableGroup:$,DiagonalHeatmapTrack:Q,FeatureTrack:K,LineTrack:Z,ReadTrack:et,VariantTrack:tt,VcfTrack:tt},it=function(t,e,n){if("copy"in t)return t.copy(n);var i=t.obj_type;return i||(i=t.track_type),new nt[i](e,n,t)};e.default={TracksterView:q,DrawableGroup:$,LineTrack:Z,FeatureTrack:K,DiagonalHeatmapTrack:Q,ReadTrack:et,VariantTrack:tt,CompositeTrack:J,object_from_template:it}}).call(e,n(0),n(2))},28:function(t,e,n){"use strict";(function(t,i){Object.defineProperty(e,"__esModule",{value:!0});var r=n(1),a=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(r),o=t.View.extend({className:"track-header",initialize:function(){this.model.config.get("name").on("change:value",this.update_name,this),this.render()},render:function(){this.$el.append(i("<div/>").addClass(this.model.drag_handle_class)),this.$el.append(i("<div/>").addClass("track-name").text(this.model.config.get_value("name"))),this.action_icons={},this.render_action_icons(),this.$el.dblclick(function(t){t.stopPropagation()}),this.$el.append(i("<div style='clear: both'/>"))},update_name:function(){this.$el.find(".track-name").text(this.model.config.get_value("name"))},render_action_icons:function(){var t=this;this.icons_div=i("<div/>").addClass("track-icons").hide().appendTo(this.$el),a.each(this.model.action_icons_def,function(e){t.add_action_icon(e.name,e.title,e.css_class,e.on_click_fn,e.prepend,e.hide)}),this.set_display_modes(this.model.display_modes)},add_action_icon:function(t,e,n,r,a,o){var s=this;this.action_icons[t]=i("<a/>").attr("title",e).addClass("icon-button").addClass(n).tooltip().click(function(){r(s.model)}).appendTo(this.icons_div),o&&this.action_icons[t].hide()},set_display_modes:function(t,e){if(t){this.model.display_modes=t,this.model.mode=e||this.model.config.get_value("mode")||this.model.display_modes[0],this.action_icons.mode_icon.attr("title","Set display mode (now: "+this.mode+")");for(var n=this.model,i={},r=0,a=n.display_modes.length;r<a;r++){var o=n.display_modes[r];i[o]=function(t){return function(){n.change_mode(t)}}(o)}make_popupmenu(this.action_icons.mode_icon,i)}}});e.default={TrackHeaderView:o}}).call(e,n(2),n(0))},284:function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function r(t){new s.default.GalaxyApp(t)}function a(t){new u.default.GalaxyApp(t)}Object.defineProperty(e,"__esModule",{value:!0}),e.tracksterApp=r,e.circsterApp=a;var o=n(26),s=i(o),l=n(285),u=i(l);window.tracksterApp=r,window.circsterApp=a},285:function(t,e,n){"use strict";(function(t,i){function r(t){return t&&t.__esModule?t:{default:t}}function a(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var o=n(1),s=a(o),l=n(286),u=a(l),c=n(7),h=r(c),d=n(3),f=r(d),_=n(11),p=r(_),v=n(14),g=r(v);n(40);var m=t.Model.extend({is_visible:function(t,e){var n=t.getBoundingClientRect(),r=i("svg")[0].getBoundingClientRect();return!(n.right<0||n.left>r.right||n.bottom<0||n.top>r.bottom)}}),y={drawTicks:function(t,e,n,i,r){var a=t.append("g").selectAll("g").data(e).enter().append("g").selectAll("g").data(n).enter().append("g").attr("class","tick").attr("transform",function(t){return"rotate("+(180*t.angle/Math.PI-90)+")translate("+t.radius+",0)"}),o=[],s=[],l=function(t){return t.angle>Math.PI?"end":null};return r?(o=[0,0,0,-4],s=[4,0,"",".35em"],l=null):(o=[1,0,4,0],s=[0,4,".35em",""]),a.append("line").attr("x1",o[0]).attr("y1",o[1]).attr("x2",o[2]).attr("y1",o[3]).style("stroke","#000"),a.append("text").attr("x",s[0]).attr("y",s[1]).attr("dx",s[2]).attr("dy",s[3]).attr("text-anchor",l).attr("transform",i).text(function(t){return t.label})},formatNum:function(t,e){if(void 0===e&&(e=2),null===t)return null;var n=null;if(Math.abs(t)<1)n=t.toPrecision(e);else{var i=Math.round(t.toPrecision(e));t=Math.abs(t),t<1e3?n=i:t<1e6?n=Math.round((i/1e3).toPrecision(3)).toFixed(0)+"K":t<1e9&&(n=Math.round((i/1e6).toPrecision(3)).toFixed(0)+"M")}return n}},w=t.Model.extend({}),b=t.View.extend({className:"circster",initialize:function(t){this.genome=t.genome,this.label_arc_height=50,this.scale=1,this.circular_views=null,this.chords_views=null,this.model.get("drawables").on("add",this.add_track,this),this.model.get("drawables").on("remove",this.remove_track,this);var e=this.model.get("config");e.get("arc_dataset_height").on("change:value",this.update_track_bounds,this),e.get("track_gap").on("change:value",this.update_track_bounds,this)},get_circular_tracks:function(){return this.model.get("drawables").filter(function(t){return"DiagonalHeatmapTrack"!==t.get("track_type")})},get_chord_tracks:function(){return this.model.get("drawables").filter(function(t){return"DiagonalHeatmapTrack"===t.get("track_type")})},get_tracks_bounds:function(){var t=this.get_circular_tracks(),e=this.model.get("config").get_value("arc_dataset_height"),n=this.model.get("config").get_value("track_gap"),i=Math.min(this.$el.width(),this.$el.height())-20,r=i/2-t.length*(e+n)+n-this.label_arc_height,a=u.range(r,i/2,e+n);return s.map(a,function(t){return[t,t+e]})},render:function(){var t=this,e=t.$el.width(),n=t.$el.height(),i=this.get_circular_tracks(),r=this.get_chord_tracks(),a=t.model.get("config").get_value("total_gap"),o=this.get_tracks_bounds(),s=u.select(t.$el[0]).append("svg").attr("width",e).attr("height",n).attr("pointer-events","all").append("svg:g").call(u.behavior.zoom().on("zoom",function(){var e=u.event.scale;s.attr("transform","translate("+u.event.translate+") scale("+e+")"),t.scale!==e&&(t.zoom_drag_timeout&&clearTimeout(t.zoom_drag_timeout),t.zoom_drag_timeout=setTimeout(function(){},400))})).attr("transform","translate("+e/2+","+n/2+")").append("svg:g").attr("class","tracks");this.circular_views=i.map(function(e,n){var i=new C({el:s.append("g")[0],track:e,radius_bounds:o[n],genome:t.genome,total_gap:a});return i.render(),i}),this.chords_views=r.map(function(e){var n=new S({el:s.append("g")[0],track:e,radius_bounds:o[0],genome:t.genome,total_gap:a});return n.render(),n});var l=this.circular_views[this.circular_views.length-1].radius_bounds[1],c=[l,l+this.label_arc_height];this.label_track_view=new k({el:s.append("g")[0],track:new w,radius_bounds:c,genome:t.genome,total_gap:a}),this.label_track_view.render()},add_track:function(t){var e=this.model.get("config").get_value("total_gap");if("DiagonalHeatmapTrack"===t.get("track_type")){var n=this.circular_views[0].radius_bounds,i=new S({el:u.select("g.tracks").append("g")[0],track:t,radius_bounds:n,genome:this.genome,total_gap:e});i.render(),this.chords_views.push(i)}else{var r=this.get_tracks_bounds();s.each(this.circular_views,function(t,e){t.update_radius_bounds(r[e])}),s.each(this.chords_views,function(t){t.update_radius_bounds(r[0])});var a=this.circular_views.length,o=new C({el:u.select("g.tracks").append("g")[0],track:t,radius_bounds:r[a],genome:this.genome,total_gap:e});o.render(),this.circular_views.push(o)}},remove_track:function(t,e,n){var i=this.circular_views[n.index];this.circular_views.splice(n.index,1),i.$el.remove();var r=this.get_tracks_bounds();s.each(this.circular_views,function(t,e){t.update_radius_bounds(r[e])})},update_track_bounds:function(){var t=this.get_tracks_bounds();s.each(this.circular_views,function(e,n){e.update_radius_bounds(t[n])}),s.each(this.chords_views,function(e){e.update_radius_bounds(t[0])})}}),x=t.View.extend({tagName:"g",initialize:function(t){this.bg_stroke="#ddd",this.loading_bg_fill="#ffc",this.bg_fill="#ddd",this.total_gap=t.total_gap,this.track=t.track,this.radius_bounds=t.radius_bounds,this.genome=t.genome,this.chroms_layout=this._chroms_layout(),this.data_bounds=[],this.scale=1,this.parent_elt=u.select(this.$el[0])},get_fill_color:function(){var t=this.track.get("config").get_value("block_color");return t||(t=this.track.get("config").get_value("color")),t},render:function(){var t=this.parent_elt,e=this.chroms_layout,n=u.svg.arc().innerRadius(this.radius_bounds[0]).outerRadius(this.radius_bounds[1]),r=t.selectAll("g").data(e).enter().append("svg:g"),a=r.append("path").attr("d",n).attr("class","chrom-background").style("stroke",this.bg_stroke).style("fill",this.loading_bg_fill);a.append("title").text(function(t){return t.data.chrom});var o=this,s=o.track.get("data_manager"),l=!s||s.data_is_ready();i.when(l).then(function(){i.when(o._render_data(t)).then(function(){a.style("fill",o.bg_fill),o.render_labels()})})},render_labels:function(){},update_radius_bounds:function(t){this.radius_bounds=t;var e=u.svg.arc().innerRadius(this.radius_bounds[0]).outerRadius(this.radius_bounds[1]);this.parent_elt.selectAll("g>path.chrom-background").transition().duration(1e3).attr("d",e),this._transition_chrom_data(),this._transition_labels()},update_scale:function(t){var e=this.scale;if(this.scale=t,!(t<=e)){var n=this,r=new m;return this.parent_elt.selectAll("path.chrom-data").filter(function(t,e){return r.is_visible(this)}).each(function(e,r){var a,o=u.select(this),l=o.attr("chrom"),c=n.genome.get_chrom_region(l),h=n.track.get("data_manager");h.can_get_more_detailed_data(c)&&(a=n.track.get("data_manager").get_more_detailed_data(c,"Coverage",0,t),i.when(a).then(function(t){o.remove(),n._update_data_bounds();var e=s.find(n.chroms_layout,function(t){return t.data.chrom===l}),i=n.get_fill_color();n._render_chrom_data(n.parent_elt,e,t).style("stroke",i).style("fill",i)}))}),n}},_transition_chrom_data:function(){var t=this.track,e=this.chroms_layout,n=this.parent_elt.selectAll("g>path.chrom-data");if(n[0].length>0){var r=this;i.when(t.get("data_manager").get_genome_wide_data(this.genome)).then(function(i){var a=s.reject(s.map(i,function(t,n){var i=null,a=r._get_path_function(e[n],t);return a&&(i=a(t.data)),i}),function(t){return null===t}),o=t.get("config").get_value("color");n.each(function(t,e){u.select(this).transition().duration(1e3).style("stroke",o).style("fill",o).attr("d",a[e])})})}},_transition_labels:function(){},_update_data_bounds:function(t){this.data_bounds;this.data_bounds=t||this.get_data_bounds(this.track.get("data_manager").get_genome_wide_data(this.genome)),this._transition_chrom_data()},_render_data:function(t){var e=this,n=this.chroms_layout,r=this.track,a=i.Deferred();return i.when(r.get("data_manager").get_genome_wide_data(this.genome)).then(function(i){e.data_bounds=e.get_data_bounds(i),r.get("config").set_value("min_value",e.data_bounds[0],{silent:!0}),r.get("config").set_value("max_value",e.data_bounds[1],{silent:!0});var o=s.zip(n,i);s.each(o,function(n){var i=n[0],r=n[1];return e._render_chrom_data(t,i,r)});var l=e.get_fill_color();e.parent_elt.selectAll("path.chrom-data").style("stroke",l).style("fill",l),a.resolve(t)}),a},_render_chrom_data:function(t,e,n){},_get_path_function:function(t,e){},_chroms_layout:function(){var t=this.genome.get_chroms_info(),e=u.layout.pie().value(function(t){return t.len}).sort(null),n=e(t),i=2*Math.PI*this.total_gap/t.length;return s.map(n,function(t,e){var n=t.endAngle-i;return t.endAngle=n>t.startAngle?n:t.startAngle,t})}}),k=x.extend({initialize:function(t){x.prototype.initialize.call(this,t),this.innerRadius=this.radius_bounds[0],this.radius_bounds[0]=this.radius_bounds[1],this.bg_stroke="#fff",this.bg_fill="#fff",this.min_arc_len=.05},_render_data:function(t){var e=this,n=t.selectAll("g");n.selectAll("path").attr("id",function(t){return"label-"+t.data.chrom}),n.append("svg:text").filter(function(t){return t.endAngle-t.startAngle>e.min_arc_len}).attr("text-anchor","middle").append("svg:textPath").attr("class","chrom-label").attr("xlink:href",function(t){return"#label-"+t.data.chrom}).attr("startOffset","25%").text(function(t){return t.data.chrom});var i=function(t){var n=(t.endAngle-t.startAngle)/t.value,i=u.range(0,t.value,25e6).map(function(i,r){return{radius:e.innerRadius,angle:i*n+t.startAngle,label:0===r?0:r%3?null:e.formatNum(i)}});return i.length<4&&(i[i.length-1].label=e.formatNum(Math.round((i[i.length-1].angle-t.startAngle)/n))),i},r=function(t){return t.angle>Math.PI?"rotate(180)translate(-16)":null},a=s.filter(this.chroms_layout,function(t){return t.endAngle-t.startAngle>e.min_arc_len});this.drawTicks(this.parent_elt,a,i,r)}});s.extend(k.prototype,y);var M=x.extend({initialize:function(t){x.prototype.initialize.call(this,t);var e=this.track.get("config");e.get("min_value").on("change:value",this._update_min_max,this),e.get("max_value").on("change:value",this._update_min_max,this),e.get("color").on("change:value",this._transition_chrom_data,this)},_update_min_max:function(){var t=this.track.get("config"),e=[t.get_value("min_value"),t.get_value("max_value")];this._update_data_bounds(e),this.parent_elt.selectAll(".min_max").text(function(t,n){return e[n]})},_quantile:function(t,e){return t.sort(u.ascending),u.quantile(t,e)},_render_chrom_data:function(t,e,n){var i=this._get_path_function(e,n);return i?t.datum(n.data).append("path").attr("class","chrom-data").attr("chrom",e.data.chrom).attr("d",i):null},_get_path_function:function(t,e){if("string"==typeof e||!e.data||0===e.data.length)return null;var n=u.scale.linear().domain(this.data_bounds).range(this.radius_bounds).clamp(!0),i=u.scale.linear().domain([0,e.data.length]).range([t.startAngle,t.endAngle]),r=u.svg.line.radial().interpolate("linear").radius(function(t){return n(t[1])}).angle(function(t,e){return i(e)});return u.svg.area.radial().interpolate(r.interpolate()).innerRadius(n(0)).outerRadius(r.radius()).angle(r.angle())},render_labels:function(){var t=this,e=function(){return"rotate(90)"},n=this.drawTicks(this.parent_elt,[this.chroms_layout[0]],this._data_bounds_ticks_fn(),e,!0).classed("min_max",!0);s.each(n,function(e){i(e).click(function(){new p.default.ConfigSettingCollectionView({collection:t.track.get("config")}).render_in_modal("Configure Track")})})},_transition_labels:function(){if(0!==this.data_bounds.length){var t=this,e=s.filter(this.chroms_layout,function(t){return t.endAngle-t.startAngle>.08}),n=s.filter(e,function(t,e){return e%3==0}),i=s.flatten(s.map(n,function(e){return t._data_bounds_ticks_fn()(e)}));this.parent_elt.selectAll("g.tick").data(i).transition().attr("transform",function(t){return"rotate("+(180*t.angle/Math.PI-90)+")translate("+t.radius+",0)"})}},_data_bounds_ticks_fn:function(){var t=this;return visibleChroms=0,function(e){return[{radius:t.radius_bounds[0],angle:e.startAngle,label:t.formatNum(t.data_bounds[0])},{radius:t.radius_bounds[1],angle:e.startAngle,label:t.formatNum(t.data_bounds[1])}]}},get_data_bounds:function(t){}});s.extend(M.prototype,y);var C=M.extend({get_data_bounds:function(t){var e=s.flatten(s.map(t,function(t){return t?s.map(t.data,function(t){return parseInt(t[1],10)||0}):0}));return[s.min(e),this._quantile(e,.98)||s.max(e)]}}),S=x.extend({render:function(){var t=this;i.when(t.track.get("data_manager").data_is_ready()).then(function(){i.when(t.track.get("data_manager").get_genome_wide_data(t.genome)).then(function(e){var n=[],i=t.genome.get_chroms_info();s.each(e,function(e,r){var a=i[r].chrom,o=s.map(e.data,function(e){var n=t._get_region_angle(a,e[1]),i=t._get_region_angle(e[3],e[4]);return{source:{startAngle:n,endAngle:n+.01},target:{startAngle:i,endAngle:i+.01}}});n=n.concat(o)}),t.parent_elt.append("g").attr("class","chord").selectAll("path").data(n).enter().append("path").style("fill",t.get_fill_color()).attr("d",u.svg.chord().radius(t.radius_bounds[0])).style("opacity",1)})})},update_radius_bounds:function(t){this.radius_bounds=t,this.parent_elt.selectAll("path").transition().attr("d",u.svg.chord().radius(this.radius_bounds[0]))},_get_region_angle:function(t,e){var n=s.find(this.chroms_layout,function(e){return e.data.chrom===t});return n.endAngle-(n.endAngle-n.startAngle)*(n.data.len-e)/n.data.len}}),T=t.View.extend({initialize:function(){f.default.cssLoadFile("static/style/circster.css");var t=new h.default.Genome(galaxy_config.app.genome),e=new h.default.GenomeVisualization(galaxy_config.app.viz_config);e.get("config").add([{key:"arc_dataset_height",label:"Arc Dataset Height",type:"int",value:25,view:"circster"},{key:"track_gap",label:"Gap Between Tracks",type:"int",value:5,view:"circster"},{key:"total_gap",label:"Gap [0-1]",type:"float",value:.4,view:"circster",hidden:!0}]),new b({el:i("#center .unified-panel-body"),genome:t,model:e}).render(),i("#center .unified-panel-header-inner").append(galaxy_config.app.viz_config.title+" "+galaxy_config.app.viz_config.dbkey);var n=g.default.create_icon_buttons_menu([{icon_class:"plus-button",title:"Add tracks",on_click:function(){h.default.select_datasets({dbkey:e.get("dbkey")},function(t){e.add_tracks(t)})}},{icon_class:"gear",title:"Settings",on_click:function(){new p.default.ConfigSettingCollectionView({collection:e.get("config")}).render_in_modal("Configure Visualization")}},{icon_class:"disk--arrow",title:"Save",on_click:function(){Galaxy.modal.show({title:"Saving...",body:"progress"}),i.ajax({url:Galaxy.root+"visualization/save",type:"POST",dataType:"json",data:{id:e.get("vis_id"),title:e.get("title"),dbkey:e.get("dbkey"),type:"trackster",vis_json:JSON.stringify(e)}}).success(function(t){Galaxy.modal.hide(),e.set("vis_id",t.vis_id)}).error(function(){Galaxy.modal.show({title:"Could Not Save",body:"Could not save visualization. Please try again later.",buttons:{Cancel:function(){Galaxy.modal.hide()}}})})}},{icon_class:"cross-circle",title:"Close",on_click:function(){window.location=Galaxy.root+"visualizations/list"}}],{tooltip_config:{placement:"bottom"}});n.$el.attr("style","float: right"),i("#center .unified-panel-header-inner").append(n.$el),i(".menu-button").tooltip({placement:"bottom"})}});e.default={GalaxyApp:T}}).call(e,n(2),n(0))},286:function(t,e,n){var i,r;!function(){function a(t){return t&&(t.ownerDocument||t.document||t).documentElement}function o(t){return t&&(t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView)}function s(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function l(t){return null===t?NaN:+t}function u(t){return!isNaN(t)}function c(t){return{left:function(e,n,i,r){for(arguments.length<3&&(i=0),arguments.length<4&&(r=e.length);i<r;){var a=i+r>>>1;t(e[a],n)<0?i=a+1:r=a}return i},right:function(e,n,i,r){for(arguments.length<3&&(i=0),arguments.length<4&&(r=e.length);i<r;){var a=i+r>>>1;t(e[a],n)>0?r=a:i=a+1}return i}}}function h(t){return t.length}function d(t){for(var e=1;t*e%1;)e*=10;return e}function f(t,e){for(var n in e)Object.defineProperty(t.prototype,n,{value:e[n],enumerable:!1})}function _(){this._=Object.create(null)}function p(t){return(t+="")===Mo||t[0]===Co?Co+t:t}function v(t){return(t+="")[0]===Co?t.slice(1):t}function g(t){return p(t)in this._}function m(t){return(t=p(t))in this._&&delete this._[t]}function y(){var t=[];for(var e in this._)t.push(v(e));return t}function w(){var t=0;for(var e in this._)++t;return t}function b(){for(var t in this._)return!1;return!0}function x(){this._=Object.create(null)}function k(t){return t}function M(t,e,n){return function(){var i=n.apply(e,arguments);return i===e?t:i}}function C(t,e){if(e in t)return e;e=e.charAt(0).toUpperCase()+e.slice(1);for(var n=0,i=So.length;n<i;++n){var r=So[n]+e;if(r in t)return r}}function S(){}function T(){}function A(t){function e(){for(var e,i=n,r=-1,a=i.length;++r<a;)(e=i[r].on)&&e.apply(this,arguments);return t}var n=[],i=new _;return e.on=function(e,r){var a,o=i.get(e);return arguments.length<2?o&&o.on:(o&&(o.on=null,n=n.slice(0,a=n.indexOf(o)).concat(n.slice(a+1)),i.remove(e)),r&&n.push(i.set(e,{on:r})),t)},e}function z(){fo.event.preventDefault()}function N(){for(var t,e=fo.event;t=e.sourceEvent;)e=t;return e}function E(t){for(var e=new T,n=0,i=arguments.length;++n<i;)e[arguments[n]]=A(e);return e.of=function(n,i){return function(r){try{var a=r.sourceEvent=fo.event;r.target=t,fo.event=r,e[r.type].apply(n,i)}finally{fo.event=a}}},e}function R(t){return Ao(t,Ro),t}function O(t){return"function"==typeof t?t:function(){return zo(t,this)}}function D(t){return"function"==typeof t?t:function(){return No(t,this)}}function P(t,e){function n(){this.removeAttribute(t)}function i(){this.removeAttributeNS(t.space,t.local)}function r(){this.setAttribute(t,e)}function a(){this.setAttributeNS(t.space,t.local,e)}function o(){var n=e.apply(this,arguments);null==n?this.removeAttribute(t):this.setAttribute(t,n)}function s(){var n=e.apply(this,arguments);null==n?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,n)}return t=fo.ns.qualify(t),null==e?t.local?i:n:"function"==typeof e?t.local?s:o:t.local?a:r}function j(t){return t.trim().replace(/\s+/g," ")}function $(t){return new RegExp("(?:^|\\s+)"+fo.requote(t)+"(?:\\s+|$)","g")}function q(t){return(t+"").trim().split(/^|\s+/)}function I(t,e){function n(){for(var n=-1;++n<r;)t[n](this,e)}function i(){for(var n=-1,i=e.apply(this,arguments);++n<r;)t[n](this,i)}t=q(t).map(F);var r=t.length;return"function"==typeof e?i:n}function F(t){var e=$(t);return function(n,i){if(r=n.classList)return i?r.add(t):r.remove(t);var r=n.getAttribute("class")||"";i?(e.lastIndex=0,e.test(r)||n.setAttribute("class",j(r+" "+t))):n.setAttribute("class",j(r.replace(e," ")))}}function L(t,e,n){function i(){this.style.removeProperty(t)}function r(){this.style.setProperty(t,e,n)}function a(){var i=e.apply(this,arguments);null==i?this.style.removeProperty(t):this.style.setProperty(t,i,n)}return null==e?i:"function"==typeof e?a:r}function G(t,e){function n(){delete this[t]}function i(){this[t]=e}function r(){var n=e.apply(this,arguments);null==n?delete this[t]:this[t]=n}return null==e?n:"function"==typeof e?r:i}function V(t){function e(){var e=this.ownerDocument,n=this.namespaceURI;return n===Oo&&e.documentElement.namespaceURI===Oo?e.createElement(t):e.createElementNS(n,t)}function n(){return this.ownerDocument.createElementNS(t.space,t.local)}return"function"==typeof t?t:(t=fo.ns.qualify(t)).local?n:e}function H(){var t=this.parentNode;t&&t.removeChild(this)}function U(t){return{__data__:t}}function B(t){return function(){return Eo(this,t)}}function Y(t){return arguments.length||(t=s),function(e,n){return e&&n?t(e.__data__,n.__data__):!e-!n}}function X(t,e){for(var n=0,i=t.length;n<i;n++)for(var r,a=t[n],o=0,s=a.length;o<s;o++)(r=a[o])&&e(r,o,n);return t}function J(t){return Ao(t,Po),t}function W(t){var e,n;return function(i,r,a){var o,s=t[a].update,l=s.length;for(a!=n&&(n=a,e=0),r>=e&&(e=r+1);!(o=s[e])&&++e<l;);return o}}function Z(t,e,n){function i(){var e=this[o];e&&(this.removeEventListener(t,e,e.$),delete this[o])}function r(){var r=l(e,po(arguments));i.call(this),this.addEventListener(t,this[o]=r,r.$=n),r._=e}function a(){var e,n=new RegExp("^__on([^.]+)"+fo.requote(t)+"$");for(var i in this)if(e=i.match(n)){var r=this[i];this.removeEventListener(e[1],r,r.$),delete this[i]}}var o="__on"+t,s=t.indexOf("."),l=Q;s>0&&(t=t.slice(0,s));var u=jo.get(t);return u&&(t=u,l=K),s?e?r:i:e?S:a}function Q(t,e){return function(n){var i=fo.event;fo.event=n,e[0]=this.__data__;try{t.apply(this,e)}finally{fo.event=i}}}function K(t,e){var n=Q(t,e);return function(t){var e=this,i=t.relatedTarget;i&&(i===e||8&i.compareDocumentPosition(e))||n.call(e,t)}}function tt(t){var e=".dragsuppress-"+ ++qo,n="click"+e,i=fo.select(o(t)).on("touchmove"+e,z).on("dragstart"+e,z).on("selectstart"+e,z);if(null==$o&&($o=!("onselectstart"in t)&&C(t.style,"userSelect")),$o){var r=a(t).style,s=r[$o];r[$o]="none"}return function(t){if(i.on(e,null),$o&&(r[$o]=s),t){var a=function(){i.on(n,null)};i.on(n,function(){z(),a()},!0),setTimeout(a,0)}}}function et(t,e){e.changedTouches&&(e=e.changedTouches[0]);var n=t.ownerSVGElement||t;if(n.createSVGPoint){var i=n.createSVGPoint();if(Io<0){var r=o(t);if(r.scrollX||r.scrollY){n=fo.select("body").append("svg").style({position:"absolute",top:0,left:0,margin:0,padding:0,border:"none"},"important");var a=n[0][0].getScreenCTM();Io=!(a.f||a.e),n.remove()}}return Io?(i.x=e.pageX,i.y=e.pageY):(i.x=e.clientX,i.y=e.clientY),i=i.matrixTransform(t.getScreenCTM().inverse()),[i.x,i.y]}var s=t.getBoundingClientRect();return[e.clientX-s.left-t.clientLeft,e.clientY-s.top-t.clientTop]}function nt(){return fo.event.changedTouches[0].identifier}function it(t){return t>0?1:t<0?-1:0}function rt(t,e,n){return(e[0]-t[0])*(n[1]-t[1])-(e[1]-t[1])*(n[0]-t[0])}function at(t){return t>1?0:t<-1?Go:Math.acos(t)}function ot(t){return t>1?Uo:t<-1?-Uo:Math.asin(t)}function st(t){return((t=Math.exp(t))-1/t)/2}function lt(t){return((t=Math.exp(t))+1/t)/2}function ut(t){return((t=Math.exp(2*t))-1)/(t+1)}function ct(t){return(t=Math.sin(t/2))*t}function ht(){}function dt(t,e,n){return this instanceof dt?(this.h=+t,this.s=+e,void(this.l=+n)):arguments.length<2?t instanceof dt?new dt(t.h,t.s,t.l):St(""+t,Tt,dt):new dt(t,e,n)}function ft(t,e,n){function i(t){return t>360?t-=360:t<0&&(t+=360),t<60?a+(o-a)*t/60:t<180?o:t<240?a+(o-a)*(240-t)/60:a}function r(t){return Math.round(255*i(t))}var a,o;return t=isNaN(t)?0:(t%=360)<0?t+360:t,e=isNaN(e)?0:e<0?0:e>1?1:e,n=n<0?0:n>1?1:n,o=n<=.5?n*(1+e):n+e-n*e,a=2*n-o,new xt(r(t+120),r(t),r(t-120))}function _t(t,e,n){return this instanceof _t?(this.h=+t,this.c=+e,void(this.l=+n)):arguments.length<2?t instanceof _t?new _t(t.h,t.c,t.l):t instanceof vt?mt(t.l,t.a,t.b):mt((t=At((t=fo.rgb(t)).r,t.g,t.b)).l,t.a,t.b):new _t(t,e,n)}function pt(t,e,n){return isNaN(t)&&(t=0),isNaN(e)&&(e=0),new vt(n,Math.cos(t*=Bo)*e,Math.sin(t)*e)}function vt(t,e,n){return this instanceof vt?(this.l=+t,this.a=+e,void(this.b=+n)):arguments.length<2?t instanceof vt?new vt(t.l,t.a,t.b):t instanceof _t?pt(t.h,t.c,t.l):At((t=xt(t)).r,t.g,t.b):new vt(t,e,n)}function gt(t,e,n){var i=(t+16)/116,r=i+e/500,a=i-n/200;return r=yt(r)*es,i=yt(i)*ns,a=yt(a)*is,new xt(bt(3.2404542*r-1.5371385*i-.4985314*a),bt(-.969266*r+1.8760108*i+.041556*a),bt(.0556434*r-.2040259*i+1.0572252*a))}function mt(t,e,n){return t>0?new _t(Math.atan2(n,e)*Yo,Math.sqrt(e*e+n*n),t):new _t(NaN,NaN,t)}function yt(t){return t>.206893034?t*t*t:(t-4/29)/7.787037}function wt(t){return t>.008856?Math.pow(t,1/3):7.787037*t+4/29}function bt(t){return Math.round(255*(t<=.00304?12.92*t:1.055*Math.pow(t,1/2.4)-.055))}function xt(t,e,n){return this instanceof xt?(this.r=~~t,this.g=~~e,void(this.b=~~n)):arguments.length<2?t instanceof xt?new xt(t.r,t.g,t.b):St(""+t,xt,ft):new xt(t,e,n)}function kt(t){return new xt(t>>16,t>>8&255,255&t)}function Mt(t){return kt(t)+""}function Ct(t){return t<16?"0"+Math.max(0,t).toString(16):Math.min(255,t).toString(16)}function St(t,e,n){var i,r,a,o=0,s=0,l=0;if(i=/([a-z]+)\((.*)\)/.exec(t=t.toLowerCase()))switch(r=i[2].split(","),i[1]){case"hsl":return n(parseFloat(r[0]),parseFloat(r[1])/100,parseFloat(r[2])/100);case"rgb":return e(Nt(r[0]),Nt(r[1]),Nt(r[2]))}return(a=os.get(t))?e(a.r,a.g,a.b):(null==t||"#"!==t.charAt(0)||isNaN(a=parseInt(t.slice(1),16))||(4===t.length?(o=(3840&a)>>4,o|=o>>4,s=240&a,s|=s>>4,l=15&a,l|=l<<4):7===t.length&&(o=(16711680&a)>>16,s=(65280&a)>>8,l=255&a)),e(o,s,l))}function Tt(t,e,n){var i,r,a=Math.min(t/=255,e/=255,n/=255),o=Math.max(t,e,n),s=o-a,l=(o+a)/2;return s?(r=l<.5?s/(o+a):s/(2-o-a),i=t==o?(e-n)/s+(e<n?6:0):e==o?(n-t)/s+2:(t-e)/s+4,i*=60):(i=NaN,r=l>0&&l<1?0:i),new dt(i,r,l)}function At(t,e,n){t=zt(t),e=zt(e),n=zt(n);var i=wt((.4124564*t+.3575761*e+.1804375*n)/es),r=wt((.2126729*t+.7151522*e+.072175*n)/ns);return vt(116*r-16,500*(i-r),200*(r-wt((.0193339*t+.119192*e+.9503041*n)/is)))}function zt(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function Nt(t){var e=parseFloat(t);return"%"===t.charAt(t.length-1)?Math.round(2.55*e):e}function Et(t){return"function"==typeof t?t:function(){return t}}function Rt(t){return function(e,n,i){return 2===arguments.length&&"function"==typeof n&&(i=n,n=null),Ot(e,n,t,i)}}function Ot(t,e,n,i){function r(){var t,e=l.status;if(!e&&Pt(l)||e>=200&&e<300||304===e){try{t=n.call(a,l)}catch(t){return void o.error.call(a,t)}o.load.call(a,t)}else o.error.call(a,l)}var a={},o=fo.dispatch("beforesend","progress","load","error"),s={},l=new XMLHttpRequest,u=null;return!this.XDomainRequest||"withCredentials"in l||!/^(http(s)?:)?\/\//.test(t)||(l=new XDomainRequest),"onload"in l?l.onload=l.onerror=r:l.onreadystatechange=function(){l.readyState>3&&r()},l.onprogress=function(t){var e=fo.event;fo.event=t;try{o.progress.call(a,l)}finally{fo.event=e}},a.header=function(t,e){return t=(t+"").toLowerCase(),arguments.length<2?s[t]:(null==e?delete s[t]:s[t]=e+"",a)},a.mimeType=function(t){return arguments.length?(e=null==t?null:t+"",a):e},a.responseType=function(t){return arguments.length?(u=t,a):u},a.response=function(t){return n=t,a},["get","post"].forEach(function(t){a[t]=function(){return a.send.apply(a,[t].concat(po(arguments)))}}),a.send=function(n,i,r){if(2===arguments.length&&"function"==typeof i&&(r=i,i=null),l.open(n,t,!0),null==e||"accept"in s||(s.accept=e+",*/*"),l.setRequestHeader)for(var c in s)l.setRequestHeader(c,s[c]);return null!=e&&l.overrideMimeType&&l.overrideMimeType(e),null!=u&&(l.responseType=u),null!=r&&a.on("error",r).on("load",function(t){r(null,t)}),o.beforesend.call(a,l),l.send(null==i?null:i),a},a.abort=function(){return l.abort(),a},fo.rebind(a,o,"on"),null==i?a:a.get(Dt(i))}function Dt(t){return 1===t.length?function(e,n){t(null==e?n:null)}:t}function Pt(t){var e=t.responseType;return e&&"text"!==e?t.response:t.responseText}function jt(t,e,n){var i=arguments.length;i<2&&(e=0),i<3&&(n=Date.now());var r=n+e,a={c:t,t:r,n:null};return ls?ls.n=a:ss=a,ls=a,us||(cs=clearTimeout(cs),us=1,hs($t)),a}function $t(){var t=qt(),e=It()-t;e>24?(isFinite(e)&&(clearTimeout(cs),cs=setTimeout($t,e)),us=0):(us=1,hs($t))}function qt(){for(var t=Date.now(),e=ss;e;)t>=e.t&&e.c(t-e.t)&&(e.c=null),e=e.n;return t}function It(){for(var t,e=ss,n=1/0;e;)e.c?(e.t<n&&(n=e.t),e=(t=e).n):e=t?t.n=e.n:ss=e.n;return ls=t,n}function Ft(t,e){return e-(t?Math.ceil(Math.log(t)/Math.LN10):1)}function Lt(t,e){var n=Math.pow(10,3*ko(8-e));return{scale:e>8?function(t){return t/n}:function(t){return t*n},symbol:t}}function Gt(t){var e=t.decimal,n=t.thousands,i=t.grouping,r=t.currency,a=i&&n?function(t,e){for(var r=t.length,a=[],o=0,s=i[0],l=0;r>0&&s>0&&(l+s+1>e&&(s=Math.max(1,e-l)),a.push(t.substring(r-=s,r+s)),!((l+=s+1)>e));)s=i[o=(o+1)%i.length];return a.reverse().join(n)}:k;return function(t){var n=fs.exec(t),i=n[1]||" ",o=n[2]||">",s=n[3]||"-",l=n[4]||"",u=n[5],c=+n[6],h=n[7],d=n[8],f=n[9],_=1,p="",v="",g=!1,m=!0;switch(d&&(d=+d.substring(1)),(u||"0"===i&&"="===o)&&(u=i="0",o="="),f){case"n":h=!0,f="g";break;case"%":_=100,v="%",f="f";break;case"p":_=100,v="%",f="r";break;case"b":case"o":case"x":case"X":"#"===l&&(p="0"+f.toLowerCase());case"c":m=!1;case"d":g=!0,d=0;break;case"s":_=-1,f="r"}"$"===l&&(p=r[0],v=r[1]),"r"!=f||d||(f="g"),null!=d&&("g"==f?d=Math.max(1,Math.min(21,d)):"e"!=f&&"f"!=f||(d=Math.max(0,Math.min(20,d)))),f=_s.get(f)||Vt;var y=u&&h;return function(t){var n=v;if(g&&t%1)return"";var r=t<0||0===t&&1/t<0?(t=-t,"-"):"-"===s?"":s;if(_<0){var l=fo.formatPrefix(t,d);t=l.scale(t),n=l.symbol+v}else t*=_;t=f(t,d);var w,b,x=t.lastIndexOf(".");if(x<0){var k=m?t.lastIndexOf("e"):-1;k<0?(w=t,b=""):(w=t.substring(0,k),b=t.substring(k))}else w=t.substring(0,x),b=e+t.substring(x+1);!u&&h&&(w=a(w,1/0));var M=p.length+w.length+b.length+(y?0:r.length),C=M<c?new Array(M=c-M+1).join(i):"";return y&&(w=a(C+w,C.length?c-b.length:1/0)),r+=p,t=w+b,("<"===o?r+t+C:">"===o?C+r+t:"^"===o?C.substring(0,M>>=1)+r+t+C.substring(M):r+(y?t:C+t))+n}}}function Vt(t){return t+""}function Ht(){this._=new Date(arguments.length>1?Date.UTC.apply(this,arguments):arguments[0])}function Ut(t,e,n){function i(e){var n=t(e),i=a(n,1);return e-n<i-e?n:i}function r(n){return e(n=t(new vs(n-1)),1),n}function a(t,n){return e(t=new vs(+t),n),t}function o(t,i,a){var o=r(t),s=[];if(a>1)for(;o<i;)n(o)%a||s.push(new Date(+o)),e(o,1);else for(;o<i;)s.push(new Date(+o)),e(o,1);return s}function s(t,e,n){try{vs=Ht;var i=new Ht;return i._=t,o(i,e,n)}finally{vs=Date}}t.floor=t,t.round=i,t.ceil=r,t.offset=a,t.range=o;var l=t.utc=Bt(t);return l.floor=l,l.round=Bt(i),l.ceil=Bt(r),l.offset=Bt(a),l.range=s,t}function Bt(t){return function(e,n){try{vs=Ht;var i=new Ht;return i._=e,t(i,n)._}finally{vs=Date}}}function Yt(t){function e(t){function e(e){for(var n,r,a,o=[],s=-1,l=0;++s<i;)37===t.charCodeAt(s)&&(o.push(t.slice(l,s)),null!=(r=ms[n=t.charAt(++s)])&&(n=t.charAt(++s)),(a=A[n])&&(n=a(e,null==r?"e"===n?" ":"0":r)),o.push(n),l=s+1);return o.push(t.slice(l,s)),o.join("")}var i=t.length;return e.parse=function(e){var i={y:1900,m:0,d:1,H:0,M:0,S:0,L:0,Z:null};if(n(i,t,e,0)!=e.length)return null;"p"in i&&(i.H=i.H%12+12*i.p);var r=null!=i.Z&&vs!==Ht,a=new(r?Ht:vs);return"j"in i?a.setFullYear(i.y,0,i.j):"W"in i||"U"in i?("w"in i||(i.w="W"in i?1:0),a.setFullYear(i.y,0,1),a.setFullYear(i.y,0,"W"in i?(i.w+6)%7+7*i.W-(a.getDay()+5)%7:i.w+7*i.U-(a.getDay()+6)%7)):a.setFullYear(i.y,i.m,i.d),a.setHours(i.H+(i.Z/100|0),i.M+i.Z%100,i.S,i.L),r?a._:a},e.toString=function(){return t},e}function n(t,e,n,i){for(var r,a,o,s=0,l=e.length,u=n.length;s<l;){if(i>=u)return-1;if(37===(r=e.charCodeAt(s++))){if(o=e.charAt(s++),!(a=z[o in ms?e.charAt(s++):o])||(i=a(t,n,i))<0)return-1}else if(r!=n.charCodeAt(i++))return-1}return i}function i(t,e,n){x.lastIndex=0;var i=x.exec(e.slice(n));return i?(t.w=k.get(i[0].toLowerCase()),n+i[0].length):-1}function r(t,e,n){w.lastIndex=0;var i=w.exec(e.slice(n));return i?(t.w=b.get(i[0].toLowerCase()),n+i[0].length):-1}function a(t,e,n){S.lastIndex=0;var i=S.exec(e.slice(n));return i?(t.m=T.get(i[0].toLowerCase()),n+i[0].length):-1}function o(t,e,n){M.lastIndex=0;var i=M.exec(e.slice(n));return i?(t.m=C.get(i[0].toLowerCase()),n+i[0].length):-1}function s(t,e,i){return n(t,A.c.toString(),e,i)}function l(t,e,i){return n(t,A.x.toString(),e,i)}function u(t,e,i){return n(t,A.X.toString(),e,i)}function c(t,e,n){var i=y.get(e.slice(n,n+=2).toLowerCase());return null==i?-1:(t.p=i,n)}var h=t.dateTime,d=t.date,f=t.time,_=t.periods,p=t.days,v=t.shortDays,g=t.months,m=t.shortMonths;e.utc=function(t){function n(t){try{vs=Ht;var e=new vs;return e._=t,i(e)}finally{vs=Date}}var i=e(t);return n.parse=function(t){try{vs=Ht;var e=i.parse(t);return e&&e._}finally{vs=Date}},n.toString=i.toString,n},e.multi=e.utc.multi=fe;var y=fo.map(),w=Jt(p),b=Wt(p),x=Jt(v),k=Wt(v),M=Jt(g),C=Wt(g),S=Jt(m),T=Wt(m);_.forEach(function(t,e){y.set(t.toLowerCase(),e)});var A={a:function(t){return v[t.getDay()]},A:function(t){return p[t.getDay()]},b:function(t){return m[t.getMonth()]},B:function(t){return g[t.getMonth()]},c:e(h),d:function(t,e){return Xt(t.getDate(),e,2)},e:function(t,e){return Xt(t.getDate(),e,2)},H:function(t,e){return Xt(t.getHours(),e,2)},I:function(t,e){return Xt(t.getHours()%12||12,e,2)},j:function(t,e){return Xt(1+ps.dayOfYear(t),e,3)},L:function(t,e){return Xt(t.getMilliseconds(),e,3)},m:function(t,e){return Xt(t.getMonth()+1,e,2)},M:function(t,e){return Xt(t.getMinutes(),e,2)},p:function(t){return _[+(t.getHours()>=12)]},S:function(t,e){return Xt(t.getSeconds(),e,2)},U:function(t,e){return Xt(ps.sundayOfYear(t),e,2)},w:function(t){return t.getDay()},W:function(t,e){return Xt(ps.mondayOfYear(t),e,2)},x:e(d),X:e(f),y:function(t,e){return Xt(t.getFullYear()%100,e,2)},Y:function(t,e){return Xt(t.getFullYear()%1e4,e,4)},Z:he,"%":function(){return"%"}},z={a:i,A:r,b:a,B:o,c:s,d:ae,e:ae,H:se,I:se,j:oe,L:ce,m:re,M:le,p:c,S:ue,U:Qt,w:Zt,W:Kt,x:l,X:u,y:ee,Y:te,Z:ne,"%":de};return e}function Xt(t,e,n){var i=t<0?"-":"",r=(i?-t:t)+"",a=r.length;return i+(a<n?new Array(n-a+1).join(e)+r:r)}function Jt(t){return new RegExp("^(?:"+t.map(fo.requote).join("|")+")","i")}function Wt(t){for(var e=new _,n=-1,i=t.length;++n<i;)e.set(t[n].toLowerCase(),n);return e}function Zt(t,e,n){ys.lastIndex=0;var i=ys.exec(e.slice(n,n+1));return i?(t.w=+i[0],n+i[0].length):-1}function Qt(t,e,n){ys.lastIndex=0;var i=ys.exec(e.slice(n));return i?(t.U=+i[0],n+i[0].length):-1}function Kt(t,e,n){ys.lastIndex=0;var i=ys.exec(e.slice(n));return i?(t.W=+i[0],n+i[0].length):-1}function te(t,e,n){ys.lastIndex=0;var i=ys.exec(e.slice(n,n+4));return i?(t.y=+i[0],n+i[0].length):-1}function ee(t,e,n){ys.lastIndex=0;var i=ys.exec(e.slice(n,n+2));return i?(t.y=ie(+i[0]),n+i[0].length):-1}function ne(t,e,n){return/^[+-]\d{4}$/.test(e=e.slice(n,n+5))?(t.Z=-e,n+5):-1}function ie(t){return t+(t>68?1900:2e3)}function re(t,e,n){ys.lastIndex=0;var i=ys.exec(e.slice(n,n+2));return i?(t.m=i[0]-1,n+i[0].length):-1}function ae(t,e,n){ys.lastIndex=0;var i=ys.exec(e.slice(n,n+2));return i?(t.d=+i[0],n+i[0].length):-1}function oe(t,e,n){ys.lastIndex=0;var i=ys.exec(e.slice(n,n+3));return i?(t.j=+i[0],n+i[0].length):-1}function se(t,e,n){ys.lastIndex=0;var i=ys.exec(e.slice(n,n+2));return i?(t.H=+i[0],n+i[0].length):-1}function le(t,e,n){ys.lastIndex=0;var i=ys.exec(e.slice(n,n+2));return i?(t.M=+i[0],n+i[0].length):-1}function ue(t,e,n){ys.lastIndex=0;var i=ys.exec(e.slice(n,n+2));return i?(t.S=+i[0],n+i[0].length):-1}function ce(t,e,n){ys.lastIndex=0;var i=ys.exec(e.slice(n,n+3));return i?(t.L=+i[0],n+i[0].length):-1}function he(t){var e=t.getTimezoneOffset(),n=e>0?"-":"+",i=ko(e)/60|0,r=ko(e)%60;return n+Xt(i,"0",2)+Xt(r,"0",2)}function de(t,e,n){ws.lastIndex=0;var i=ws.exec(e.slice(n,n+1));return i?n+i[0].length:-1}function fe(t){for(var e=t.length,n=-1;++n<e;)t[n][0]=this(t[n][0]);return function(e){for(var n=0,i=t[n];!i[1](e);)i=t[++n];return i[0](e)}}function _e(){}function pe(t,e,n){var i=n.s=t+e,r=i-t,a=i-r;n.t=t-a+(e-r)}function ve(t,e){t&&Ms.hasOwnProperty(t.type)&&Ms[t.type](t,e)}function ge(t,e,n){var i,r=-1,a=t.length-n;for(e.lineStart();++r<a;)i=t[r],e.point(i[0],i[1],i[2]);e.lineEnd()}function me(t,e){var n=-1,i=t.length;for(e.polygonStart();++n<i;)ge(t[n],e,1);e.polygonEnd()}function ye(){function t(t,e){t*=Bo,e=e*Bo/2+Go/4;var n=t-i,o=n>=0?1:-1,s=o*n,l=Math.cos(e),u=Math.sin(e),c=a*u,h=r*l+c*Math.cos(s),d=c*o*Math.sin(s);Ss.add(Math.atan2(d,h)),i=t,r=l,a=u}var e,n,i,r,a;Ts.point=function(o,s){Ts.point=t,i=(e=o)*Bo,r=Math.cos(s=(n=s)*Bo/2+Go/4),a=Math.sin(s)},Ts.lineEnd=function(){t(e,n)}}function we(t){var e=t[0],n=t[1],i=Math.cos(n);return[i*Math.cos(e),i*Math.sin(e),Math.sin(n)]}function be(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function xe(t,e){return[t[1]*e[2]-t[2]*e[1],t[2]*e[0]-t[0]*e[2],t[0]*e[1]-t[1]*e[0]]}function ke(t,e){t[0]+=e[0],t[1]+=e[1],t[2]+=e[2]}function Me(t,e){return[t[0]*e,t[1]*e,t[2]*e]}function Ce(t){var e=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]/=e,t[1]/=e,t[2]/=e}function Se(t){return[Math.atan2(t[1],t[0]),ot(t[2])]}function Te(t,e){return ko(t[0]-e[0])<Fo&&ko(t[1]-e[1])<Fo}function Ae(t,e){t*=Bo;var n=Math.cos(e*=Bo);ze(n*Math.cos(t),n*Math.sin(t),Math.sin(e))}function ze(t,e,n){++As,Ns+=(t-Ns)/As,Es+=(e-Es)/As,Rs+=(n-Rs)/As}function Ne(){function t(t,r){t*=Bo;var a=Math.cos(r*=Bo),o=a*Math.cos(t),s=a*Math.sin(t),l=Math.sin(r),u=Math.atan2(Math.sqrt((u=n*l-i*s)*u+(u=i*o-e*l)*u+(u=e*s-n*o)*u),e*o+n*s+i*l);zs+=u,Os+=u*(e+(e=o)),Ds+=u*(n+(n=s)),Ps+=u*(i+(i=l)),ze(e,n,i)}var e,n,i;Is.point=function(r,a){r*=Bo;var o=Math.cos(a*=Bo);e=o*Math.cos(r),n=o*Math.sin(r),i=Math.sin(a),Is.point=t,ze(e,n,i)}}function Ee(){Is.point=Ae}function Re(){function t(t,e){t*=Bo;var n=Math.cos(e*=Bo),o=n*Math.cos(t),s=n*Math.sin(t),l=Math.sin(e),u=r*l-a*s,c=a*o-i*l,h=i*s-r*o,d=Math.sqrt(u*u+c*c+h*h),f=i*o+r*s+a*l,_=d&&-at(f)/d,p=Math.atan2(d,f);js+=_*u,$s+=_*c,qs+=_*h,zs+=p,Os+=p*(i+(i=o)),Ds+=p*(r+(r=s)),Ps+=p*(a+(a=l)),ze(i,r,a)}var e,n,i,r,a;Is.point=function(o,s){e=o,n=s,Is.point=t,o*=Bo;var l=Math.cos(s*=Bo);i=l*Math.cos(o),r=l*Math.sin(o),a=Math.sin(s),ze(i,r,a)},Is.lineEnd=function(){t(e,n),Is.lineEnd=Ee,Is.point=Ae}}function Oe(t,e){function n(n,i){return n=t(n,i),e(n[0],n[1])}return t.invert&&e.invert&&(n.invert=function(n,i){return(n=e.invert(n,i))&&t.invert(n[0],n[1])}),n}function De(){return!0}function Pe(t,e,n,i,r){var a=[],o=[];if(t.forEach(function(t){if(!((e=t.length-1)<=0)){var e,n=t[0],i=t[e];if(Te(n,i)){r.lineStart();for(var s=0;s<e;++s)r.point((n=t[s])[0],n[1]);return void r.lineEnd()}var l=new $e(n,t,null,!0),u=new $e(n,null,l,!1);l.o=u,a.push(l),o.push(u),l=new $e(i,t,null,!1),u=new $e(i,null,l,!0),l.o=u,a.push(l),o.push(u)}}),o.sort(e),je(a),je(o),a.length){for(var s=0,l=n,u=o.length;s<u;++s)o[s].e=l=!l;for(var c,h,d=a[0];;){for(var f=d,_=!0;f.v;)if((f=f.n)===d)return;c=f.z,r.lineStart();do{if(f.v=f.o.v=!0,f.e){if(_)for(var s=0,u=c.length;s<u;++s)r.point((h=c[s])[0],h[1]);else i(f.x,f.n.x,1,r);f=f.n}else{if(_){c=f.p.z;for(var s=c.length-1;s>=0;--s)r.point((h=c[s])[0],h[1])}else i(f.x,f.p.x,-1,r);f=f.p}f=f.o,c=f.z,_=!_}while(!f.v);r.lineEnd()}}}function je(t){if(e=t.length){for(var e,n,i=0,r=t[0];++i<e;)r.n=n=t[i],n.p=r,r=n;r.n=n=t[0],n.p=r}}function $e(t,e,n,i){this.x=t,this.z=e,this.o=n,this.e=i,this.v=!1,this.n=this.p=null}function qe(t,e,n,i){return function(r,a){function o(e,n){var i=r(e,n);t(e=i[0],n=i[1])&&a.point(e,n)}function s(t,e){var n=r(t,e);v.point(n[0],n[1])}function l(){m.point=s,v.lineStart()}function u(){m.point=o,v.lineEnd()}function c(t,e){p.push([t,e]);var n=r(t,e);w.point(n[0],n[1])}function h(){w.lineStart(),p=[]}function d(){c(p[0][0],p[0][1]),w.lineEnd();var t,e=w.clean(),n=y.buffer(),i=n.length;if(p.pop(),_.push(p),p=null,i)if(1&e){t=n[0];var r,i=t.length-1,o=-1;if(i>0){for(b||(a.polygonStart(),b=!0),a.lineStart();++o<i;)a.point((r=t[o])[0],r[1]);a.lineEnd()}}else i>1&&2&e&&n.push(n.pop().concat(n.shift())),f.push(n.filter(Ie))}var f,_,p,v=e(a),g=r.invert(i[0],i[1]),m={point:o,lineStart:l,lineEnd:u,polygonStart:function(){m.point=c,m.lineStart=h,m.lineEnd=d,f=[],_=[]},polygonEnd:function(){m.point=o,m.lineStart=l,m.lineEnd=u,f=fo.merge(f);var t=Ue(g,_);f.length?(b||(a.polygonStart(),b=!0),Pe(f,Le,t,n,a)):t&&(b||(a.polygonStart(),b=!0),a.lineStart(),n(null,null,1,a),a.lineEnd()),b&&(a.polygonEnd(),b=!1),f=_=null},sphere:function(){a.polygonStart(),a.lineStart(),n(null,null,1,a),a.lineEnd(),a.polygonEnd()}},y=Fe(),w=e(y),b=!1;return m}}function Ie(t){return t.length>1}function Fe(){var t,e=[];return{lineStart:function(){e.push(t=[])},point:function(e,n){t.push([e,n])},lineEnd:S,buffer:function(){var n=e;return e=[],t=null,n},rejoin:function(){e.length>1&&e.push(e.pop().concat(e.shift()))}}}function Le(t,e){return((t=t.x)[0]<0?t[1]-Uo-Fo:Uo-t[1])-((e=e.x)[0]<0?e[1]-Uo-Fo:Uo-e[1])}function Ge(t){var e,n=NaN,i=NaN,r=NaN;return{lineStart:function(){t.lineStart(),e=1},point:function(a,o){var s=a>0?Go:-Go,l=ko(a-n);ko(l-Go)<Fo?(t.point(n,i=(i+o)/2>0?Uo:-Uo),t.point(r,i),t.lineEnd(),t.lineStart(),t.point(s,i),t.point(a,i),e=0):r!==s&&l>=Go&&(ko(n-r)<Fo&&(n-=r*Fo),ko(a-s)<Fo&&(a-=s*Fo),i=Ve(n,i,a,o),t.point(r,i),t.lineEnd(),t.lineStart(),t.point(s,i),e=0),t.point(n=a,i=o),r=s},lineEnd:function(){t.lineEnd(),n=i=NaN},clean:function(){return 2-e}}}function Ve(t,e,n,i){var r,a,o=Math.sin(t-n);return ko(o)>Fo?Math.atan((Math.sin(e)*(a=Math.cos(i))*Math.sin(n)-Math.sin(i)*(r=Math.cos(e))*Math.sin(t))/(r*a*o)):(e+i)/2}function He(t,e,n,i){var r;if(null==t)r=n*Uo,i.point(-Go,r),i.point(0,r),i.point(Go,r),i.point(Go,0),i.point(Go,-r),i.point(0,-r),i.point(-Go,-r),i.point(-Go,0),i.point(-Go,r);else if(ko(t[0]-e[0])>Fo){var a=t[0]<e[0]?Go:-Go;r=n*a/2,i.point(-a,r),i.point(0,r),i.point(a,r)}else i.point(e[0],e[1])}function Ue(t,e){var n=t[0],i=t[1],r=[Math.sin(n),-Math.cos(n),0],a=0,o=0;Ss.reset();for(var s=0,l=e.length;s<l;++s){var u=e[s],c=u.length;if(c)for(var h=u[0],d=h[0],f=h[1]/2+Go/4,_=Math.sin(f),p=Math.cos(f),v=1;;){v===c&&(v=0),t=u[v];var g=t[0],m=t[1]/2+Go/4,y=Math.sin(m),w=Math.cos(m),b=g-d,x=b>=0?1:-1,k=x*b,M=k>Go,C=_*y;if(Ss.add(Math.atan2(C*x*Math.sin(k),p*w+C*Math.cos(k))),a+=M?b+x*Vo:b,M^d>=n^g>=n){var S=xe(we(h),we(t));Ce(S);var T=xe(r,S);Ce(T);var A=(M^b>=0?-1:1)*ot(T[2]);(i>A||i===A&&(S[0]||S[1]))&&(o+=M^b>=0?1:-1)}if(!v++)break;d=g,_=y,p=w,h=t}}return(a<-Fo||a<Fo&&Ss<-Fo)^1&o}function Be(t){function e(t,e){return Math.cos(t)*Math.cos(e)>a}function n(t){var n,a,l,u,c;return{lineStart:function(){u=l=!1,c=1},point:function(h,d){var f,_=[h,d],p=e(h,d),v=o?p?0:r(h,d):p?r(h+(h<0?Go:-Go),d):0;if(!n&&(u=l=p)&&t.lineStart(),p!==l&&(f=i(n,_),(Te(n,f)||Te(_,f))&&(_[0]+=Fo,_[1]+=Fo,p=e(_[0],_[1]))),p!==l)c=0,p?(t.lineStart(),f=i(_,n),t.point(f[0],f[1])):(f=i(n,_),t.point(f[0],f[1]),t.lineEnd()),n=f;else if(s&&n&&o^p){var g;v&a||!(g=i(_,n,!0))||(c=0,o?(t.lineStart(),t.point(g[0][0],g[0][1]),t.point(g[1][0],g[1][1]),t.lineEnd()):(t.point(g[1][0],g[1][1]),t.lineEnd(),t.lineStart(),t.point(g[0][0],g[0][1])))}!p||n&&Te(n,_)||t.point(_[0],_[1]),n=_,l=p,a=v},lineEnd:function(){l&&t.lineEnd(),n=null},clean:function(){return c|(u&&l)<<1}}}function i(t,e,n){var i=we(t),r=we(e),o=[1,0,0],s=xe(i,r),l=be(s,s),u=s[0],c=l-u*u;if(!c)return!n&&t;var h=a*l/c,d=-a*u/c,f=xe(o,s),_=Me(o,h);ke(_,Me(s,d));var p=f,v=be(_,p),g=be(p,p),m=v*v-g*(be(_,_)-1);if(!(m<0)){var y=Math.sqrt(m),w=Me(p,(-v-y)/g);if(ke(w,_),w=Se(w),!n)return w;var b,x=t[0],k=e[0],M=t[1],C=e[1];k<x&&(b=x,x=k,k=b);var S=k-x,T=ko(S-Go)<Fo,A=T||S<Fo;if(!T&&C<M&&(b=M,M=C,C=b),A?T?M+C>0^w[1]<(ko(w[0]-x)<Fo?M:C):M<=w[1]&&w[1]<=C:S>Go^(x<=w[0]&&w[0]<=k)){var z=Me(p,(-v+y)/g);return ke(z,_),[w,Se(z)]}}}function r(e,n){var i=o?t:Go-t,r=0;return e<-i?r|=1:e>i&&(r|=2),n<-i?r|=4:n>i&&(r|=8),r}var a=Math.cos(t),o=a>0,s=ko(a)>Fo;return qe(e,n,wn(t,6*Bo),o?[0,-t]:[-Go,t-Go])}function Ye(t,e,n,i){return function(r){var a,o=r.a,s=r.b,l=o.x,u=o.y,c=s.x,h=s.y,d=0,f=1,_=c-l,p=h-u;if(a=t-l,_||!(a>0)){if(a/=_,_<0){if(a<d)return;a<f&&(f=a)}else if(_>0){if(a>f)return;a>d&&(d=a)}if(a=n-l,_||!(a<0)){if(a/=_,_<0){if(a>f)return;a>d&&(d=a)}else if(_>0){if(a<d)return;a<f&&(f=a)}if(a=e-u,p||!(a>0)){if(a/=p,p<0){if(a<d)return;a<f&&(f=a)}else if(p>0){if(a>f)return;a>d&&(d=a)}if(a=i-u,p||!(a<0)){if(a/=p,p<0){if(a>f)return;a>d&&(d=a)}else if(p>0){if(a<d)return;a<f&&(f=a)}return d>0&&(r.a={x:l+d*_,y:u+d*p}),f<1&&(r.b={x:l+f*_,y:u+f*p}),r}}}}}}function Xe(t,e,n,i){function r(i,r){return ko(i[0]-t)<Fo?r>0?0:3:ko(i[0]-n)<Fo?r>0?2:1:ko(i[1]-e)<Fo?r>0?1:0:r>0?3:2}function a(t,e){return o(t.x,e.x)}function o(t,e){var n=r(t,1),i=r(e,1);return n!==i?n-i:0===n?e[1]-t[1]:1===n?t[0]-e[0]:2===n?t[1]-e[1]:e[0]-t[0]}return function(s){function l(t){for(var e=0,n=v.length,i=t[1],r=0;r<n;++r)for(var a,o=1,s=v[r],l=s.length,u=s[0];o<l;++o)a=s[o],u[1]<=i?a[1]>i&&rt(u,a,t)>0&&++e:a[1]<=i&&rt(u,a,t)<0&&--e,u=a;return 0!==e}function u(a,s,l,u){var c=0,h=0;if(null==a||(c=r(a,l))!==(h=r(s,l))||o(a,s)<0^l>0)do{u.point(0===c||3===c?t:n,c>1?i:e)}while((c=(c+l+4)%4)!==h);else u.point(s[0],s[1])}function c(r,a){return t<=r&&r<=n&&e<=a&&a<=i}function h(t,e){c(t,e)&&s.point(t,e)}function d(){z.point=_,v&&v.push(g=[]),M=!0,k=!1,b=x=NaN}function f(){p&&(_(m,y),w&&k&&T.rejoin(),p.push(T.buffer())),z.point=h,k&&s.lineEnd()}function _(t,e){t=Math.max(-Ls,Math.min(Ls,t)),e=Math.max(-Ls,Math.min(Ls,e));var n=c(t,e);if(v&&g.push([t,e]),M)m=t,y=e,w=n,M=!1,n&&(s.lineStart(),s.point(t,e));else if(n&&k)s.point(t,e);else{var i={a:{x:b,y:x},b:{x:t,y:e}};A(i)?(k||(s.lineStart(),s.point(i.a.x,i.a.y)),s.point(i.b.x,i.b.y),n||s.lineEnd(),C=!1):n&&(s.lineStart(),s.point(t,e),C=!1)}b=t,x=e,k=n}var p,v,g,m,y,w,b,x,k,M,C,S=s,T=Fe(),A=Ye(t,e,n,i),z={point:h,lineStart:d,lineEnd:f,polygonStart:function(){s=T,p=[],v=[],C=!0},polygonEnd:function(){s=S,p=fo.merge(p);var e=l([t,i]),n=C&&e,r=p.length;(n||r)&&(s.polygonStart(),n&&(s.lineStart(),u(null,null,1,s),s.lineEnd()),r&&Pe(p,a,e,u,s),s.polygonEnd()),p=v=g=null}};return z}}function Je(t){var e=0,n=Go/3,i=dn(t),r=i(e,n);return r.parallels=function(t){return arguments.length?i(e=t[0]*Go/180,n=t[1]*Go/180):[e/Go*180,n/Go*180]},r}function We(t,e){function n(t,e){var n=Math.sqrt(a-2*r*Math.sin(e))/r;return[n*Math.sin(t*=r),o-n*Math.cos(t)]}var i=Math.sin(t),r=(i+Math.sin(e))/2,a=1+i*(2*r-i),o=Math.sqrt(a)/r;return n.invert=function(t,e){var n=o-e;return[Math.atan2(t,n)/r,ot((a-(t*t+n*n)*r*r)/(2*r))]},n}function Ze(){function t(t,e){Vs+=r*t-i*e,i=t,r=e}var e,n,i,r;Xs.point=function(a,o){Xs.point=t,e=i=a,n=r=o},Xs.lineEnd=function(){t(e,n)}}function Qe(t,e){t<Hs&&(Hs=t),t>Bs&&(Bs=t),e<Us&&(Us=e),e>Ys&&(Ys=e)}function Ke(){function t(t,e){o.push("M",t,",",e,a)}function e(t,e){o.push("M",t,",",e),s.point=n}function n(t,e){o.push("L",t,",",e)}function i(){s.point=t}function r(){o.push("Z")}var a=tn(4.5),o=[],s={point:t,lineStart:function(){s.point=e},lineEnd:i,polygonStart:function(){s.lineEnd=r},polygonEnd:function(){s.lineEnd=i,s.point=t},pointRadius:function(t){return a=tn(t),s},result:function(){if(o.length){var t=o.join("");return o=[],t}}};return s}function tn(t){return"m0,"+t+"a"+t+","+t+" 0 1,1 0,"+-2*t+"a"+t+","+t+" 0 1,1 0,"+2*t+"z"}function en(t,e){Ns+=t,Es+=e,++Rs}function nn(){function t(t,i){var r=t-e,a=i-n,o=Math.sqrt(r*r+a*a);Os+=o*(e+t)/2,Ds+=o*(n+i)/2,Ps+=o,en(e=t,n=i)}var e,n;Ws.point=function(i,r){Ws.point=t,en(e=i,n=r)}}function rn(){Ws.point=en}function an(){function t(t,e){var n=t-i,a=e-r,o=Math.sqrt(n*n+a*a);Os+=o*(i+t)/2,Ds+=o*(r+e)/2,Ps+=o,o=r*t-i*e,js+=o*(i+t),$s+=o*(r+e),qs+=3*o,en(i=t,r=e)}var e,n,i,r;Ws.point=function(a,o){Ws.point=t,en(e=i=a,n=r=o)},Ws.lineEnd=function(){t(e,n)}}function on(t){function e(e,n){t.moveTo(e+o,n),t.arc(e,n,o,0,Vo)}function n(e,n){t.moveTo(e,n),s.point=i}function i(e,n){t.lineTo(e,n)}function r(){s.point=e}function a(){t.closePath()}var o=4.5,s={point:e,lineStart:function(){s.point=n},lineEnd:r,polygonStart:function(){s.lineEnd=a},polygonEnd:function(){s.lineEnd=r,s.point=e},pointRadius:function(t){return o=t,s},result:S};return s}function sn(t){function e(t){return(s?i:n)(t)}function n(e){return cn(e,function(n,i){n=t(n,i),e.point(n[0],n[1])})}function i(e){function n(n,i){n=t(n,i),e.point(n[0],n[1])}function i(){y=NaN,M.point=a,e.lineStart()}function a(n,i){var a=we([n,i]),o=t(n,i);r(y,w,m,b,x,k,y=o[0],w=o[1],m=n,b=a[0],x=a[1],k=a[2],s,e),e.point(y,w)}function o(){M.point=n,e.lineEnd()}function l(){i(),M.point=u,M.lineEnd=c}function u(t,e){a(h=t,d=e),f=y,_=w,p=b,v=x,g=k,M.point=a}function c(){r(y,w,m,b,x,k,f,_,h,p,v,g,s,e),M.lineEnd=o,o()}var h,d,f,_,p,v,g,m,y,w,b,x,k,M={point:n,lineStart:i,lineEnd:o,polygonStart:function(){e.polygonStart(),M.lineStart=l},polygonEnd:function(){e.polygonEnd(),M.lineStart=i}};return M}function r(e,n,i,s,l,u,c,h,d,f,_,p,v,g){var m=c-e,y=h-n,w=m*m+y*y;if(w>4*a&&v--){var b=s+f,x=l+_,k=u+p,M=Math.sqrt(b*b+x*x+k*k),C=Math.asin(k/=M),S=ko(ko(k)-1)<Fo||ko(i-d)<Fo?(i+d)/2:Math.atan2(x,b),T=t(S,C),A=T[0],z=T[1],N=A-e,E=z-n,R=y*N-m*E;(R*R/w>a||ko((m*N+y*E)/w-.5)>.3||s*f+l*_+u*p<o)&&(r(e,n,i,s,l,u,A,z,S,b/=M,x/=M,k,v,g),g.point(A,z),r(A,z,S,b,x,k,c,h,d,f,_,p,v,g))}}var a=.5,o=Math.cos(30*Bo),s=16;return e.precision=function(t){return arguments.length?(s=(a=t*t)>0&&16,e):Math.sqrt(a)},e}function ln(t){var e=sn(function(e,n){return t([e*Yo,n*Yo])});return function(t){return fn(e(t))}}function un(t){this.stream=t}function cn(t,e){return{point:e,sphere:function(){t.sphere()},lineStart:function(){t.lineStart()},lineEnd:function(){t.lineEnd()},polygonStart:function(){t.polygonStart()},polygonEnd:function(){t.polygonEnd()}}}function hn(t){return dn(function(){return t})()}function dn(t){function e(t){return t=s(t[0]*Bo,t[1]*Bo),[t[0]*d+l,u-t[1]*d]}function n(t){return(t=s.invert((t[0]-l)/d,(u-t[1])/d))&&[t[0]*Yo,t[1]*Yo]}function i(){s=Oe(o=vn(g,m,y),a);var t=a(p,v);return l=f-t[0]*d,u=_+t[1]*d,r()}function r(){return c&&(c.valid=!1,c=null),e}var a,o,s,l,u,c,h=sn(function(t,e){return t=a(t,e),[t[0]*d+l,u-t[1]*d]}),d=150,f=480,_=250,p=0,v=0,g=0,m=0,y=0,w=Fs,b=k,x=null,M=null;return e.stream=function(t){return c&&(c.valid=!1),c=fn(w(o,h(b(t)))),c.valid=!0,c},e.clipAngle=function(t){return arguments.length?(w=null==t?(x=t,Fs):Be((x=+t)*Bo),r()):x},e.clipExtent=function(t){return arguments.length?(M=t,b=t?Xe(t[0][0],t[0][1],t[1][0],t[1][1]):k,r()):M},e.scale=function(t){return arguments.length?(d=+t,i()):d},e.translate=function(t){return arguments.length?(f=+t[0],_=+t[1],i()):[f,_]},e.center=function(t){return arguments.length?(p=t[0]%360*Bo,v=t[1]%360*Bo,i()):[p*Yo,v*Yo]},e.rotate=function(t){return arguments.length?(g=t[0]%360*Bo,m=t[1]%360*Bo,y=t.length>2?t[2]%360*Bo:0,i()):[g*Yo,m*Yo,y*Yo]},fo.rebind(e,h,"precision"),function(){return a=t.apply(this,arguments),e.invert=a.invert&&n,i()}}function fn(t){return cn(t,function(e,n){t.point(e*Bo,n*Bo)})}function _n(t,e){return[t,e]}function pn(t,e){return[t>Go?t-Vo:t<-Go?t+Vo:t,e]}function vn(t,e,n){return t?e||n?Oe(mn(t),yn(e,n)):mn(t):e||n?yn(e,n):pn}function gn(t){return function(e,n){return e+=t,[e>Go?e-Vo:e<-Go?e+Vo:e,n]}}function mn(t){var e=gn(t);return e.invert=gn(-t),e}function yn(t,e){function n(t,e){var n=Math.cos(e),s=Math.cos(t)*n,l=Math.sin(t)*n,u=Math.sin(e),c=u*i+s*r;return[Math.atan2(l*a-c*o,s*i-u*r),ot(c*a+l*o)]}var i=Math.cos(t),r=Math.sin(t),a=Math.cos(e),o=Math.sin(e);return n.invert=function(t,e){var n=Math.cos(e),s=Math.cos(t)*n,l=Math.sin(t)*n,u=Math.sin(e),c=u*a-l*o;return[Math.atan2(l*a+u*o,s*i+c*r),ot(c*i-s*r)]},n}function wn(t,e){var n=Math.cos(t),i=Math.sin(t);return function(r,a,o,s){var l=o*e;null!=r?(r=bn(n,r),a=bn(n,a),(o>0?r<a:r>a)&&(r+=o*Vo)):(r=t+o*Vo,a=t-.5*l);for(var u,c=r;o>0?c>a:c<a;c-=l)s.point((u=Se([n,-i*Math.cos(c),-i*Math.sin(c)]))[0],u[1])}}function bn(t,e){var n=we(e);n[0]-=t,Ce(n);var i=at(-n[1]);return((-n[2]<0?-i:i)+2*Math.PI-Fo)%(2*Math.PI)}function xn(t,e,n){var i=fo.range(t,e-Fo,n).concat(e);return function(t){return i.map(function(e){return[t,e]})}}function kn(t,e,n){var i=fo.range(t,e-Fo,n).concat(e);return function(t){return i.map(function(e){return[e,t]})}}function Mn(t){return t.source}function Cn(t){return t.target}function Sn(t,e,n,i){var r=Math.cos(e),a=Math.sin(e),o=Math.cos(i),s=Math.sin(i),l=r*Math.cos(t),u=r*Math.sin(t),c=o*Math.cos(n),h=o*Math.sin(n),d=2*Math.asin(Math.sqrt(ct(i-e)+r*o*ct(n-t))),f=1/Math.sin(d),_=d?function(t){var e=Math.sin(t*=d)*f,n=Math.sin(d-t)*f,i=n*l+e*c,r=n*u+e*h,o=n*a+e*s;return[Math.atan2(r,i)*Yo,Math.atan2(o,Math.sqrt(i*i+r*r))*Yo]}:function(){return[t*Yo,e*Yo]};return _.distance=d,_}function Tn(){function t(t,r){var a=Math.sin(r*=Bo),o=Math.cos(r),s=ko((t*=Bo)-e),l=Math.cos(s);Zs+=Math.atan2(Math.sqrt((s=o*Math.sin(s))*s+(s=i*a-n*o*l)*s),n*a+i*o*l),e=t,n=a,i=o}var e,n,i;Qs.point=function(r,a){e=r*Bo,n=Math.sin(a*=Bo),i=Math.cos(a),Qs.point=t},Qs.lineEnd=function(){Qs.point=Qs.lineEnd=S}}function An(t,e){function n(e,n){var i=Math.cos(e),r=Math.cos(n),a=t(i*r);return[a*r*Math.sin(e),a*Math.sin(n)]}return n.invert=function(t,n){var i=Math.sqrt(t*t+n*n),r=e(i),a=Math.sin(r),o=Math.cos(r);return[Math.atan2(t*a,i*o),Math.asin(i&&n*a/i)]},n}function zn(t,e){function n(t,e){o>0?e<-Uo+Fo&&(e=-Uo+Fo):e>Uo-Fo&&(e=Uo-Fo);var n=o/Math.pow(r(e),a);return[n*Math.sin(a*t),o-n*Math.cos(a*t)]}var i=Math.cos(t),r=function(t){return Math.tan(Go/4+t/2)},a=t===e?Math.sin(t):Math.log(i/Math.cos(e))/Math.log(r(e)/r(t)),o=i*Math.pow(r(t),a)/a;return a?(n.invert=function(t,e){var n=o-e,i=it(a)*Math.sqrt(t*t+n*n);return[Math.atan2(t,n)/a,2*Math.atan(Math.pow(o/i,1/a))-Uo]},n):En}function Nn(t,e){function n(t,e){var n=a-e;return[n*Math.sin(r*t),a-n*Math.cos(r*t)]}var i=Math.cos(t),r=t===e?Math.sin(t):(i-Math.cos(e))/(e-t),a=i/r+t;return ko(r)<Fo?_n:(n.invert=function(t,e){var n=a-e;return[Math.atan2(t,n)/r,a-it(r)*Math.sqrt(t*t+n*n)]},n)}function En(t,e){return[t,Math.log(Math.tan(Go/4+e/2))]}function Rn(t){var e,n=hn(t),i=n.scale,r=n.translate,a=n.clipExtent;return n.scale=function(){var t=i.apply(n,arguments);return t===n?e?n.clipExtent(null):n:t},n.translate=function(){var t=r.apply(n,arguments);return t===n?e?n.clipExtent(null):n:t},n.clipExtent=function(t){var o=a.apply(n,arguments);if(o===n){if(e=null==t){var s=Go*i(),l=r();a([[l[0]-s,l[1]-s],[l[0]+s,l[1]+s]])}}else e&&(o=null);return o},n.clipExtent(null)}function On(t,e){return[Math.log(Math.tan(Go/4+e/2)),-t]}function Dn(t){return t[0]}function Pn(t){return t[1]}function jn(t){for(var e=t.length,n=[0,1],i=2,r=2;r<e;r++){for(;i>1&&rt(t[n[i-2]],t[n[i-1]],t[r])<=0;)--i;n[i++]=r}return n.slice(0,i)}function $n(t,e){return t[0]-e[0]||t[1]-e[1]}function qn(t,e,n){return(n[0]-e[0])*(t[1]-e[1])<(n[1]-e[1])*(t[0]-e[0])}function In(t,e,n,i){var r=t[0],a=n[0],o=e[0]-r,s=i[0]-a,l=t[1],u=n[1],c=e[1]-l,h=i[1]-u,d=(s*(l-u)-h*(r-a))/(h*o-s*c);return[r+d*o,l+d*c]}function Fn(t){var e=t[0],n=t[t.length-1];return!(e[0]-n[0]||e[1]-n[1])}function Ln(){li(this),this.edge=this.site=this.circle=null}function Gn(t){var e=cl.pop()||new Ln;return e.site=t,e}function Vn(t){Kn(t),sl.remove(t),cl.push(t),li(t)}function Hn(t){var e=t.circle,n=e.x,i=e.cy,r={x:n,y:i},a=t.P,o=t.N,s=[t];Vn(t);for(var l=a;l.circle&&ko(n-l.circle.x)<Fo&&ko(i-l.circle.cy)<Fo;)a=l.P,s.unshift(l),Vn(l),l=a;s.unshift(l),Kn(l);for(var u=o;u.circle&&ko(n-u.circle.x)<Fo&&ko(i-u.circle.cy)<Fo;)o=u.N,s.push(u),Vn(u),u=o;s.push(u),Kn(u);var c,h=s.length;for(c=1;c<h;++c)u=s[c],l=s[c-1],ai(u.edge,l.site,u.site,r);l=s[0],u=s[h-1],u.edge=ii(l.site,u.site,null,r),Qn(l),Qn(u)}function Un(t){for(var e,n,i,r,a=t.x,o=t.y,s=sl._;s;)if((i=Bn(s,o)-a)>Fo)s=s.L;else{if(!((r=a-Yn(s,o))>Fo)){i>-Fo?(e=s.P,n=s):r>-Fo?(e=s,n=s.N):e=n=s;break}if(!s.R){e=s;break}s=s.R}var l=Gn(t);if(sl.insert(e,l),e||n){if(e===n)return Kn(e),n=Gn(e.site),sl.insert(l,n),l.edge=n.edge=ii(e.site,l.site),Qn(e),void Qn(n);if(!n)return void(l.edge=ii(e.site,l.site));Kn(e),Kn(n);var u=e.site,c=u.x,h=u.y,d=t.x-c,f=t.y-h,_=n.site,p=_.x-c,v=_.y-h,g=2*(d*v-f*p),m=d*d+f*f,y=p*p+v*v,w={x:(v*m-f*y)/g+c,y:(d*y-p*m)/g+h};ai(n.edge,u,_,w),l.edge=ii(u,t,null,w),n.edge=ii(t,_,null,w),Qn(e),Qn(n)}}function Bn(t,e){var n=t.site,i=n.x,r=n.y,a=r-e;if(!a)return i;var o=t.P;if(!o)return-1/0;n=o.site;var s=n.x,l=n.y,u=l-e;if(!u)return s;var c=s-i,h=1/a-1/u,d=c/u;return h?(-d+Math.sqrt(d*d-2*h*(c*c/(-2*u)-l+u/2+r-a/2)))/h+i:(i+s)/2}function Yn(t,e){var n=t.N;if(n)return Bn(n,e);var i=t.site;return i.y===e?i.x:1/0}function Xn(t){this.site=t,this.edges=[]}function Jn(t){for(var e,n,i,r,a,o,s,l,u,c,h=t[0][0],d=t[1][0],f=t[0][1],_=t[1][1],p=ol,v=p.length;v--;)if((a=p[v])&&a.prepare())for(s=a.edges,l=s.length,o=0;o<l;)c=s[o].end(),i=c.x,r=c.y,u=s[++o%l].start(),e=u.x,n=u.y,(ko(i-e)>Fo||ko(r-n)>Fo)&&(s.splice(o,0,new oi(ri(a.site,c,ko(i-h)<Fo&&_-r>Fo?{x:h,y:ko(e-h)<Fo?n:_}:ko(r-_)<Fo&&d-i>Fo?{x:ko(n-_)<Fo?e:d,y:_}:ko(i-d)<Fo&&r-f>Fo?{x:d,y:ko(e-d)<Fo?n:f}:ko(r-f)<Fo&&i-h>Fo?{x:ko(n-f)<Fo?e:h,y:f}:null),a.site,null)),++l)}function Wn(t,e){return e.angle-t.angle}function Zn(){li(this),this.x=this.y=this.arc=this.site=this.cy=null}function Qn(t){var e=t.P,n=t.N;if(e&&n){var i=e.site,r=t.site,a=n.site;if(i!==a){var o=r.x,s=r.y,l=i.x-o,u=i.y-s,c=a.x-o,h=a.y-s,d=2*(l*h-u*c);if(!(d>=-Lo)){var f=l*l+u*u,_=c*c+h*h,p=(h*f-u*_)/d,v=(l*_-c*f)/d,h=v+s,g=hl.pop()||new Zn;g.arc=t,g.site=r,g.x=p+o,g.y=h+Math.sqrt(p*p+v*v),g.cy=h,t.circle=g;for(var m=null,y=ul._;y;)if(g.y<y.y||g.y===y.y&&g.x<=y.x){if(!y.L){m=y.P;break}y=y.L}else{if(!y.R){m=y;break}y=y.R}ul.insert(m,g),m||(ll=g)}}}}function Kn(t){var e=t.circle;e&&(e.P||(ll=e.N),ul.remove(e),hl.push(e),li(e),t.circle=null)}function ti(t){for(var e,n=al,i=Ye(t[0][0],t[0][1],t[1][0],t[1][1]),r=n.length;r--;)e=n[r],(!ei(e,t)||!i(e)||ko(e.a.x-e.b.x)<Fo&&ko(e.a.y-e.b.y)<Fo)&&(e.a=e.b=null,n.splice(r,1))}function ei(t,e){var n=t.b;if(n)return!0;var i,r,a=t.a,o=e[0][0],s=e[1][0],l=e[0][1],u=e[1][1],c=t.l,h=t.r,d=c.x,f=c.y,_=h.x,p=h.y,v=(d+_)/2,g=(f+p)/2;if(p===f){if(v<o||v>=s)return;if(d>_){if(a){if(a.y>=u)return}else a={x:v,y:l};n={x:v,y:u}}else{if(a){if(a.y<l)return}else a={x:v,y:u};n={x:v,y:l}}}else if(i=(d-_)/(p-f),r=g-i*v,i<-1||i>1)if(d>_){if(a){if(a.y>=u)return}else a={x:(l-r)/i,y:l};n={x:(u-r)/i,y:u}}else{if(a){if(a.y<l)return}else a={x:(u-r)/i,y:u};n={x:(l-r)/i,y:l}}else if(f<p){if(a){if(a.x>=s)return}else a={x:o,y:i*o+r};n={x:s,y:i*s+r}}else{if(a){if(a.x<o)return}else a={x:s,y:i*s+r};n={x:o,y:i*o+r}}return t.a=a,t.b=n,!0}function ni(t,e){this.l=t,this.r=e,this.a=this.b=null}function ii(t,e,n,i){var r=new ni(t,e);return al.push(r),n&&ai(r,t,e,n),i&&ai(r,e,t,i),ol[t.i].edges.push(new oi(r,t,e)),ol[e.i].edges.push(new oi(r,e,t)),r}function ri(t,e,n){var i=new ni(t,null);return i.a=e,i.b=n,al.push(i),i}function ai(t,e,n,i){t.a||t.b?t.l===n?t.b=i:t.a=i:(t.a=i,t.l=e,t.r=n)}function oi(t,e,n){var i=t.a,r=t.b;this.edge=t,this.site=e,this.angle=n?Math.atan2(n.y-e.y,n.x-e.x):t.l===e?Math.atan2(r.x-i.x,i.y-r.y):Math.atan2(i.x-r.x,r.y-i.y)}function si(){this._=null}function li(t){t.U=t.C=t.L=t.R=t.P=t.N=null}function ui(t,e){var n=e,i=e.R,r=n.U;r?r.L===n?r.L=i:r.R=i:t._=i,i.U=r,n.U=i,n.R=i.L,n.R&&(n.R.U=n),i.L=n}function ci(t,e){var n=e,i=e.L,r=n.U;r?r.L===n?r.L=i:r.R=i:t._=i,i.U=r,n.U=i,n.L=i.R,n.L&&(n.L.U=n),i.R=n}function hi(t){for(;t.L;)t=t.L;return t}function di(t,e){var n,i,r,a=t.sort(fi).pop();for(al=[],ol=new Array(t.length),sl=new si,ul=new si;;)if(r=ll,a&&(!r||a.y<r.y||a.y===r.y&&a.x<r.x))a.x===n&&a.y===i||(ol[a.i]=new Xn(a),Un(a),n=a.x,i=a.y),a=t.pop();else{if(!r)break;Hn(r.arc)}e&&(ti(e),Jn(e));var o={cells:ol,edges:al};return sl=ul=al=ol=null,o}function fi(t,e){return e.y-t.y||e.x-t.x}function _i(t,e,n){return(t.x-n.x)*(e.y-t.y)-(t.x-e.x)*(n.y-t.y)}function pi(t){return t.x}function vi(t){return t.y}function gi(){return{leaf:!0,nodes:[],point:null,x:null,y:null}}function mi(t,e,n,i,r,a){if(!t(e,n,i,r,a)){var o=.5*(n+r),s=.5*(i+a),l=e.nodes;l[0]&&mi(t,l[0],n,i,o,s),l[1]&&mi(t,l[1],o,i,r,s),l[2]&&mi(t,l[2],n,s,o,a),l[3]&&mi(t,l[3],o,s,r,a)}}function yi(t,e,n,i,r,a,o){var s,l=1/0;return function t(u,c,h,d,f){if(!(c>a||h>o||d<i||f<r)){if(_=u.point){var _,p=e-u.x,v=n-u.y,g=p*p+v*v;if(g<l){var m=Math.sqrt(l=g);i=e-m,r=n-m,a=e+m,o=n+m,s=_}}for(var y=u.nodes,w=.5*(c+d),b=.5*(h+f),x=e>=w,k=n>=b,M=k<<1|x,C=M+4;M<C;++M)if(u=y[3&M])switch(3&M){case 0:t(u,c,h,w,b);break;case 1:t(u,w,h,d,b);break;case 2:t(u,c,b,w,f);break;case 3:t(u,w,b,d,f)}}}(t,i,r,a,o),s}function wi(t,e){t=fo.rgb(t),e=fo.rgb(e);var n=t.r,i=t.g,r=t.b,a=e.r-n,o=e.g-i,s=e.b-r;return function(t){return"#"+Ct(Math.round(n+a*t))+Ct(Math.round(i+o*t))+Ct(Math.round(r+s*t))}}function bi(t,e){var n,i={},r={};for(n in t)n in e?i[n]=Mi(t[n],e[n]):r[n]=t[n];for(n in e)n in t||(r[n]=e[n]);return function(t){for(n in i)r[n]=i[n](t);return r}}function xi(t,e){return t=+t,e=+e,function(n){return t*(1-n)+e*n}}function ki(t,e){var n,i,r,a=fl.lastIndex=_l.lastIndex=0,o=-1,s=[],l=[];for(t+="",e+="";(n=fl.exec(t))&&(i=_l.exec(e));)(r=i.index)>a&&(r=e.slice(a,r),s[o]?s[o]+=r:s[++o]=r),(n=n[0])===(i=i[0])?s[o]?s[o]+=i:s[++o]=i:(s[++o]=null,l.push({i:o,x:xi(n,i)})),a=_l.lastIndex;return a<e.length&&(r=e.slice(a),s[o]?s[o]+=r:s[++o]=r),s.length<2?l[0]?(e=l[0].x,function(t){return e(t)+""}):function(){return e}:(e=l.length,function(t){for(var n,i=0;i<e;++i)s[(n=l[i]).i]=n.x(t);return s.join("")})}function Mi(t,e){for(var n,i=fo.interpolators.length;--i>=0&&!(n=fo.interpolators[i](t,e)););return n}function Ci(t,e){var n,i=[],r=[],a=t.length,o=e.length,s=Math.min(t.length,e.length);for(n=0;n<s;++n)i.push(Mi(t[n],e[n]));for(;n<a;++n)r[n]=t[n];for(;n<o;++n)r[n]=e[n];return function(t){for(n=0;n<s;++n)r[n]=i[n](t);return r}}function Si(t){return function(e){return e<=0?0:e>=1?1:t(e)}}function Ti(t){return function(e){return 1-t(1-e)}}function Ai(t){return function(e){return.5*(e<.5?t(2*e):2-t(2-2*e))}}function zi(t){return t*t}function Ni(t){return t*t*t}function Ei(t){if(t<=0)return 0;if(t>=1)return 1;var e=t*t,n=e*t;return 4*(t<.5?n:3*(t-e)+n-.75)}function Ri(t){return function(e){return Math.pow(e,t)}}function Oi(t){return 1-Math.cos(t*Uo)}function Di(t){return Math.pow(2,10*(t-1))}function Pi(t){return 1-Math.sqrt(1-t*t)}function ji(t,e){var n;return arguments.length<2&&(e=.45),arguments.length?n=e/Vo*Math.asin(1/t):(t=1,n=e/4),function(i){return 1+t*Math.pow(2,-10*i)*Math.sin((i-n)*Vo/e)}}function $i(t){return t||(t=1.70158),function(e){return e*e*((t+1)*e-t)}}function qi(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375}function Ii(t,e){t=fo.hcl(t),e=fo.hcl(e);var n=t.h,i=t.c,r=t.l,a=e.h-n,o=e.c-i,s=e.l-r;return isNaN(o)&&(o=0,i=isNaN(i)?e.c:i),isNaN(a)?(a=0,n=isNaN(n)?e.h:n):a>180?a-=360:a<-180&&(a+=360),function(t){return pt(n+a*t,i+o*t,r+s*t)+""}}function Fi(t,e){t=fo.hsl(t),e=fo.hsl(e);var n=t.h,i=t.s,r=t.l,a=e.h-n,o=e.s-i,s=e.l-r;return isNaN(o)&&(o=0,i=isNaN(i)?e.s:i),isNaN(a)?(a=0,n=isNaN(n)?e.h:n):a>180?a-=360:a<-180&&(a+=360),function(t){return ft(n+a*t,i+o*t,r+s*t)+""}}function Li(t,e){t=fo.lab(t),e=fo.lab(e);var n=t.l,i=t.a,r=t.b,a=e.l-n,o=e.a-i,s=e.b-r;return function(t){return gt(n+a*t,i+o*t,r+s*t)+""}}function Gi(t,e){return e-=t,function(n){return Math.round(t+e*n)}}function Vi(t){var e=[t.a,t.b],n=[t.c,t.d],i=Ui(e),r=Hi(e,n),a=Ui(Bi(n,e,-r))||0;e[0]*n[1]<n[0]*e[1]&&(e[0]*=-1,e[1]*=-1,i*=-1,r*=-1),this.rotate=(i?Math.atan2(e[1],e[0]):Math.atan2(-n[0],n[1]))*Yo,this.translate=[t.e,t.f],this.scale=[i,a],this.skew=a?Math.atan2(r,a)*Yo:0}function Hi(t,e){return t[0]*e[0]+t[1]*e[1]}function Ui(t){var e=Math.sqrt(Hi(t,t));return e&&(t[0]/=e,t[1]/=e),e}function Bi(t,e,n){return t[0]+=n*e[0],t[1]+=n*e[1],t}function Yi(t){return t.length?t.pop()+",":""}function Xi(t,e,n,i){if(t[0]!==e[0]||t[1]!==e[1]){var r=n.push("translate(",null,",",null,")");i.push({i:r-4,x:xi(t[0],e[0])},{i:r-2,x:xi(t[1],e[1])})}else(e[0]||e[1])&&n.push("translate("+e+")")}function Ji(t,e,n,i){t!==e?(t-e>180?e+=360:e-t>180&&(t+=360),i.push({i:n.push(Yi(n)+"rotate(",null,")")-2,x:xi(t,e)})):e&&n.push(Yi(n)+"rotate("+e+")")}function Wi(t,e,n,i){t!==e?i.push({i:n.push(Yi(n)+"skewX(",null,")")-2,x:xi(t,e)}):e&&n.push(Yi(n)+"skewX("+e+")")}function Zi(t,e,n,i){if(t[0]!==e[0]||t[1]!==e[1]){var r=n.push(Yi(n)+"scale(",null,",",null,")");i.push({i:r-4,x:xi(t[0],e[0])},{i:r-2,x:xi(t[1],e[1])})}else 1===e[0]&&1===e[1]||n.push(Yi(n)+"scale("+e+")")}function Qi(t,e){var n=[],i=[];return t=fo.transform(t),e=fo.transform(e),Xi(t.translate,e.translate,n,i),Ji(t.rotate,e.rotate,n,i),Wi(t.skew,e.skew,n,i),Zi(t.scale,e.scale,n,i),t=e=null,function(t){for(var e,r=-1,a=i.length;++r<a;)n[(e=i[r]).i]=e.x(t);return n.join("")}}function Ki(t,e){return e=(e-=t=+t)||1/e,function(n){return(n-t)/e}}function tr(t,e){return e=(e-=t=+t)||1/e,function(n){return Math.max(0,Math.min(1,(n-t)/e))}}function er(t){for(var e=t.source,n=t.target,i=ir(e,n),r=[e];e!==i;)e=e.parent,r.push(e);for(var a=r.length;n!==i;)r.splice(a,0,n),n=n.parent;return r}function nr(t){for(var e=[],n=t.parent;null!=n;)e.push(t),t=n,n=n.parent;return e.push(t),e}function ir(t,e){if(t===e)return t;for(var n=nr(t),i=nr(e),r=n.pop(),a=i.pop(),o=null;r===a;)o=r,r=n.pop(),a=i.pop();return o}function rr(t){t.fixed|=2}function ar(t){t.fixed&=-7}function or(t){t.fixed|=4,t.px=t.x,t.py=t.y}function sr(t){t.fixed&=-5}function lr(t,e,n){var i=0,r=0;if(t.charge=0,!t.leaf)for(var a,o=t.nodes,s=o.length,l=-1;++l<s;)null!=(a=o[l])&&(lr(a,e,n),t.charge+=a.charge,i+=a.charge*a.cx,r+=a.charge*a.cy);if(t.point){t.leaf||(t.point.x+=Math.random()-.5,t.point.y+=Math.random()-.5);var u=e*n[t.point.index];t.charge+=t.pointCharge=u,i+=u*t.point.x,r+=u*t.point.y}t.cx=i/t.charge,t.cy=r/t.charge}function ur(t,e){return fo.rebind(t,e,"sort","children","value"),t.nodes=t,t.links=pr,t}function cr(t,e){for(var n=[t];null!=(t=n.pop());)if(e(t),(r=t.children)&&(i=r.length))for(var i,r;--i>=0;)n.push(r[i])}function hr(t,e){for(var n=[t],i=[];null!=(t=n.pop());)if(i.push(t),(a=t.children)&&(r=a.length))for(var r,a,o=-1;++o<r;)n.push(a[o]);for(;null!=(t=i.pop());)e(t)}function dr(t){return t.children}function fr(t){return t.value}function _r(t,e){return e.value-t.value}function pr(t){return fo.merge(t.map(function(t){return(t.children||[]).map(function(e){return{source:t,target:e}})}))}function vr(t){return t.x}function gr(t){return t.y}function mr(t,e,n){t.y0=e,t.y=n}function yr(t){return fo.range(t.length)}function wr(t){for(var e=-1,n=t[0].length,i=[];++e<n;)i[e]=0;return i}function br(t){for(var e,n=1,i=0,r=t[0][1],a=t.length;n<a;++n)(e=t[n][1])>r&&(i=n,r=e);return i}function xr(t){return t.reduce(kr,0)}function kr(t,e){return t+e[1]}function Mr(t,e){return Cr(t,Math.ceil(Math.log(e.length)/Math.LN2+1))}function Cr(t,e){for(var n=-1,i=+t[0],r=(t[1]-i)/e,a=[];++n<=e;)a[n]=r*n+i;return a}function Sr(t){return[fo.min(t),fo.max(t)]}function Tr(t,e){return t.value-e.value}function Ar(t,e){var n=t._pack_next;t._pack_next=e,e._pack_prev=t,e._pack_next=n,n._pack_prev=e}function zr(t,e){t._pack_next=e,e._pack_prev=t}function Nr(t,e){var n=e.x-t.x,i=e.y-t.y,r=t.r+e.r;return.999*r*r>n*n+i*i}function Er(t){function e(t){c=Math.min(t.x-t.r,c),h=Math.max(t.x+t.r,h),d=Math.min(t.y-t.r,d),f=Math.max(t.y+t.r,f)}if((n=t.children)&&(u=n.length)){var n,i,r,a,o,s,l,u,c=1/0,h=-1/0,d=1/0,f=-1/0;if(n.forEach(Rr),i=n[0],i.x=-i.r,i.y=0,e(i),u>1&&(r=n[1],r.x=r.r,r.y=0,e(r),u>2))for(a=n[2],Pr(i,r,a),e(a),Ar(i,a),i._pack_prev=a,Ar(a,r),r=i._pack_next,o=3;o<u;o++){Pr(i,r,a=n[o]);var _=0,p=1,v=1;for(s=r._pack_next;s!==r;s=s._pack_next,p++)if(Nr(s,a)){_=1;break}if(1==_)for(l=i._pack_prev;l!==s._pack_prev&&!Nr(l,a);l=l._pack_prev,v++);_?(p<v||p==v&&r.r<i.r?zr(i,r=s):zr(i=l,r),o--):(Ar(i,a),r=a,e(a))}var g=(c+h)/2,m=(d+f)/2,y=0;for(o=0;o<u;o++)a=n[o],a.x-=g,a.y-=m,y=Math.max(y,a.r+Math.sqrt(a.x*a.x+a.y*a.y));t.r=y,n.forEach(Or)}}function Rr(t){t._pack_next=t._pack_prev=t}function Or(t){delete t._pack_next,delete t._pack_prev}function Dr(t,e,n,i){var r=t.children;if(t.x=e+=i*t.x,t.y=n+=i*t.y,t.r*=i,r)for(var a=-1,o=r.length;++a<o;)Dr(r[a],e,n,i)}function Pr(t,e,n){var i=t.r+n.r,r=e.x-t.x,a=e.y-t.y;if(i&&(r||a)){var o=e.r+n.r,s=r*r+a*a;o*=o,i*=i;var l=.5+(i-o)/(2*s),u=Math.sqrt(Math.max(0,2*o*(i+s)-(i-=s)*i-o*o))/(2*s);n.x=t.x+l*r+u*a,n.y=t.y+l*a-u*r}else n.x=t.x+i,n.y=t.y}function jr(t,e){return t.parent==e.parent?1:2}function $r(t){var e=t.children;return e.length?e[0]:t.t}function qr(t){var e,n=t.children;return(e=n.length)?n[e-1]:t.t}function Ir(t,e,n){var i=n/(e.i-t.i);e.c-=i,e.s+=n,t.c+=i,e.z+=n,e.m+=n}function Fr(t){for(var e,n=0,i=0,r=t.children,a=r.length;--a>=0;)e=r[a],e.z+=n,e.m+=n,n+=e.s+(i+=e.c)}function Lr(t,e,n){return t.a.parent===e.parent?t.a:n}function Gr(t){return 1+fo.max(t,function(t){return t.y})}function Vr(t){return t.reduce(function(t,e){return t+e.x},0)/t.length}function Hr(t){var e=t.children;return e&&e.length?Hr(e[0]):t}function Ur(t){var e,n=t.children;return n&&(e=n.length)?Ur(n[e-1]):t}function Br(t){return{x:t.x,y:t.y,dx:t.dx,dy:t.dy}}function Yr(t,e){var n=t.x+e[3],i=t.y+e[0],r=t.dx-e[1]-e[3],a=t.dy-e[0]-e[2];return r<0&&(n+=r/2,r=0),a<0&&(i+=a/2,a=0),{x:n,y:i,dx:r,dy:a}}function Xr(t){var e=t[0],n=t[t.length-1];return e<n?[e,n]:[n,e]}function Jr(t){return t.rangeExtent?t.rangeExtent():Xr(t.range())}function Wr(t,e,n,i){var r=n(t[0],t[1]),a=i(e[0],e[1]);return function(t){return a(r(t))}}function Zr(t,e){var n,i=0,r=t.length-1,a=t[i],o=t[r];return o<a&&(n=i,i=r,r=n,n=a,a=o,o=n),t[i]=e.floor(a),t[r]=e.ceil(o),t}function Qr(t){return t?{floor:function(e){return Math.floor(e/t)*t},ceil:function(e){return Math.ceil(e/t)*t}}:Cl}function Kr(t,e,n,i){var r=[],a=[],o=0,s=Math.min(t.length,e.length)-1;for(t[s]<t[0]&&(t=t.slice().reverse(),e=e.slice().reverse());++o<=s;)r.push(n(t[o-1],t[o])),a.push(i(e[o-1],e[o]));return function(e){var n=fo.bisect(t,e,1,s)-1;return a[n](r[n](e))}}function ta(t,e,n,i){function r(){var r=Math.min(t.length,e.length)>2?Kr:Wr,l=i?tr:Ki;return o=r(t,e,l,n),s=r(e,t,l,Mi),a}function a(t){return o(t)}var o,s;return a.invert=function(t){return s(t)},a.domain=function(e){return arguments.length?(t=e.map(Number),r()):t},a.range=function(t){return arguments.length?(e=t,r()):e},a.rangeRound=function(t){return a.range(t).interpolate(Gi)},a.clamp=function(t){return arguments.length?(i=t,r()):i},a.interpolate=function(t){return arguments.length?(n=t,r()):n},a.ticks=function(e){return ra(t,e)},a.tickFormat=function(e,n){return aa(t,e,n)},a.nice=function(e){return na(t,e),r()},a.copy=function(){return ta(t,e,n,i)},r()}function ea(t,e){return fo.rebind(t,e,"range","rangeRound","interpolate","clamp")}function na(t,e){return Zr(t,Qr(ia(t,e)[2])),Zr(t,Qr(ia(t,e)[2])),t}function ia(t,e){null==e&&(e=10);var n=Xr(t),i=n[1]-n[0],r=Math.pow(10,Math.floor(Math.log(i/e)/Math.LN10)),a=e/i*r;return a<=.15?r*=10:a<=.35?r*=5:a<=.75&&(r*=2),n[0]=Math.ceil(n[0]/r)*r,n[1]=Math.floor(n[1]/r)*r+.5*r,n[2]=r,n}function ra(t,e){return fo.range.apply(fo,ia(t,e))}function aa(t,e,n){var i=ia(t,e);if(n){var r=fs.exec(n);if(r.shift(),"s"===r[8]){var a=fo.formatPrefix(Math.max(ko(i[0]),ko(i[1])));return r[7]||(r[7]="."+oa(a.scale(i[2]))),r[8]="f",n=fo.format(r.join("")),function(t){return n(a.scale(t))+a.symbol}}r[7]||(r[7]="."+sa(r[8],i)),n=r.join("")}else n=",."+oa(i[2])+"f";return fo.format(n)}function oa(t){return-Math.floor(Math.log(t)/Math.LN10+.01)}function sa(t,e){var n=oa(e[2]);return t in Sl?Math.abs(n-oa(Math.max(ko(e[0]),ko(e[1]))))+ +("e"!==t):n-2*("%"===t)}function la(t,e,n,i){function r(t){return(n?Math.log(t<0?0:t):-Math.log(t>0?0:-t))/Math.log(e)}function a(t){return n?Math.pow(e,t):-Math.pow(e,-t)}function o(e){return t(r(e))}return o.invert=function(e){return a(t.invert(e))},o.domain=function(e){return arguments.length?(n=e[0]>=0,t.domain((i=e.map(Number)).map(r)),o):i},o.base=function(n){return arguments.length?(e=+n,t.domain(i.map(r)),o):e},o.nice=function(){var e=Zr(i.map(r),n?Math:Al);return t.domain(e),i=e.map(a),o},o.ticks=function(){var t=Xr(i),o=[],s=t[0],l=t[1],u=Math.floor(r(s)),c=Math.ceil(r(l)),h=e%1?2:e;if(isFinite(c-u)){if(n){for(;u<c;u++)for(var d=1;d<h;d++)o.push(a(u)*d);o.push(a(u))}else for(o.push(a(u));u++<c;)for(var d=h-1;d>0;d--)o.push(a(u)*d);for(u=0;o[u]<s;u++);for(c=o.length;o[c-1]>l;c--);o=o.slice(u,c)}return o},o.tickFormat=function(t,n){if(!arguments.length)return Tl;arguments.length<2?n=Tl:"function"!=typeof n&&(n=fo.format(n));var i=Math.max(1,e*t/o.ticks().length);return function(t){var o=t/a(Math.round(r(t)));return o*e<e-.5&&(o*=e),o<=i?n(t):""}},o.copy=function(){return la(t.copy(),e,n,i)},ea(o,t)}function ua(t,e,n){function i(e){return t(r(e))}var r=ca(e),a=ca(1/e);return i.invert=function(e){return a(t.invert(e))},i.domain=function(e){return arguments.length?(t.domain((n=e.map(Number)).map(r)),i):n},i.ticks=function(t){return ra(n,t)},i.tickFormat=function(t,e){return aa(n,t,e)},i.nice=function(t){return i.domain(na(n,t))},i.exponent=function(o){return arguments.length?(r=ca(e=o),a=ca(1/e),t.domain(n.map(r)),i):e},i.copy=function(){return ua(t.copy(),e,n)},ea(i,t)}function ca(t){return function(e){return e<0?-Math.pow(-e,t):Math.pow(e,t)}}function ha(t,e){function n(n){return a[((r.get(n)||("range"===e.t?r.set(n,t.push(n)):NaN))-1)%a.length]}function i(e,n){return fo.range(t.length).map(function(t){return e+n*t})}var r,a,o;return n.domain=function(i){if(!arguments.length)return t;t=[],r=new _;for(var a,o=-1,s=i.length;++o<s;)r.has(a=i[o])||r.set(a,t.push(a));return n[e.t].apply(n,e.a)},n.range=function(t){return arguments.length?(a=t,o=0,e={t:"range",a:arguments},n):a},n.rangePoints=function(r,s){arguments.length<2&&(s=0);var l=r[0],u=r[1],c=t.length<2?(l=(l+u)/2,0):(u-l)/(t.length-1+s);return a=i(l+c*s/2,c),o=0,e={t:"rangePoints",a:arguments},n},n.rangeRoundPoints=function(r,s){arguments.length<2&&(s=0);var l=r[0],u=r[1],c=t.length<2?(l=u=Math.round((l+u)/2),0):(u-l)/(t.length-1+s)|0;return a=i(l+Math.round(c*s/2+(u-l-(t.length-1+s)*c)/2),c),o=0,e={t:"rangeRoundPoints",a:arguments},n},n.rangeBands=function(r,s,l){arguments.length<2&&(s=0),arguments.length<3&&(l=s);var u=r[1]<r[0],c=r[u-0],h=r[1-u],d=(h-c)/(t.length-s+2*l);return a=i(c+d*l,d),u&&a.reverse(),o=d*(1-s),e={t:"rangeBands",a:arguments},n},n.rangeRoundBands=function(r,s,l){arguments.length<2&&(s=0),arguments.length<3&&(l=s);var u=r[1]<r[0],c=r[u-0],h=r[1-u],d=Math.floor((h-c)/(t.length-s+2*l));return a=i(c+Math.round((h-c-(t.length-s)*d)/2),d),u&&a.reverse(),o=Math.round(d*(1-s)),e={t:"rangeRoundBands",a:arguments},n},n.rangeBand=function(){return o},n.rangeExtent=function(){return Xr(e.a[0])},n.copy=function(){return ha(t,e)},n.domain(t)}function da(t,e){function n(){var n=0,a=e.length;for(r=[];++n<a;)r[n-1]=fo.quantile(t,n/a);return i}function i(t){if(!isNaN(t=+t))return e[fo.bisect(r,t)]}var r;return i.domain=function(e){return arguments.length?(t=e.map(l).filter(u).sort(s),n()):t},i.range=function(t){return arguments.length?(e=t,n()):e},i.quantiles=function(){return r},i.invertExtent=function(n){return n=e.indexOf(n),n<0?[NaN,NaN]:[n>0?r[n-1]:t[0],n<r.length?r[n]:t[t.length-1]]},i.copy=function(){return da(t,e)},n()}function fa(t,e,n){function i(e){return n[Math.max(0,Math.min(o,Math.floor(a*(e-t))))]}function r(){return a=n.length/(e-t),o=n.length-1,i}var a,o;return i.domain=function(n){return arguments.length?(t=+n[0],e=+n[n.length-1],r()):[t,e]},i.range=function(t){return arguments.length?(n=t,r()):n},i.invertExtent=function(e){return e=n.indexOf(e),e=e<0?NaN:e/a+t,[e,e+1/a]},i.copy=function(){return fa(t,e,n)},r()}function _a(t,e){function n(n){if(n<=n)return e[fo.bisect(t,n)]}return n.domain=function(e){return arguments.length?(t=e,n):t},n.range=function(t){return arguments.length?(e=t,n):e},n.invertExtent=function(n){return n=e.indexOf(n),[t[n-1],t[n]]},n.copy=function(){return _a(t,e)},n}function pa(t){function e(t){return+t}return e.invert=e,e.domain=e.range=function(n){return arguments.length?(t=n.map(e),e):t},e.ticks=function(e){return ra(t,e)},e.tickFormat=function(e,n){return aa(t,e,n)},e.copy=function(){return pa(t)},e}function va(){return 0}function ga(t){return t.innerRadius}function ma(t){return t.outerRadius}function ya(t){return t.startAngle}function wa(t){return t.endAngle}function ba(t){return t&&t.padAngle}function xa(t,e,n,i){return(t-n)*e-(e-i)*t>0?0:1}function ka(t,e,n,i,r){var a=t[0]-e[0],o=t[1]-e[1],s=(r?i:-i)/Math.sqrt(a*a+o*o),l=s*o,u=-s*a,c=t[0]+l,h=t[1]+u,d=e[0]+l,f=e[1]+u,_=(c+d)/2,p=(h+f)/2,v=d-c,g=f-h,m=v*v+g*g,y=n-i,w=c*f-d*h,b=(g<0?-1:1)*Math.sqrt(Math.max(0,y*y*m-w*w)),x=(w*g-v*b)/m,k=(-w*v-g*b)/m,M=(w*g+v*b)/m,C=(-w*v+g*b)/m,S=x-_,T=k-p,A=M-_,z=C-p;return S*S+T*T>A*A+z*z&&(x=M,k=C),[[x-l,k-u],[x*n/y,k*n/y]]}function Ma(t){function e(e){function o(){u.push("M",a(t(c),s))}for(var l,u=[],c=[],h=-1,d=e.length,f=Et(n),_=Et(i);++h<d;)r.call(this,l=e[h],h)?c.push([+f.call(this,l,h),+_.call(this,l,h)]):c.length&&(o(),c=[]);return c.length&&o(),u.length?u.join(""):null}var n=Dn,i=Pn,r=De,a=Ca,o=a.key,s=.7;return e.x=function(t){return arguments.length?(n=t,e):n},e.y=function(t){return arguments.length?(i=t,e):i},e.defined=function(t){return arguments.length?(r=t,e):r},e.interpolate=function(t){return arguments.length?(o="function"==typeof t?a=t:(a=Dl.get(t)||Ca).key,e):o},e.tension=function(t){return arguments.length?(s=t,e):s},e}function Ca(t){return t.length>1?t.join("L"):t+"Z"}function Sa(t){return t.join("L")+"Z"}function Ta(t){for(var e=0,n=t.length,i=t[0],r=[i[0],",",i[1]];++e<n;)r.push("H",(i[0]+(i=t[e])[0])/2,"V",i[1]);return n>1&&r.push("H",i[0]),r.join("")}function Aa(t){for(var e=0,n=t.length,i=t[0],r=[i[0],",",i[1]];++e<n;)r.push("V",(i=t[e])[1],"H",i[0]);return r.join("")}function za(t){for(var e=0,n=t.length,i=t[0],r=[i[0],",",i[1]];++e<n;)r.push("H",(i=t[e])[0],"V",i[1]);return r.join("")}function Na(t,e){return t.length<4?Ca(t):t[1]+Oa(t.slice(1,-1),Da(t,e))}function Ea(t,e){return t.length<3?Sa(t):t[0]+Oa((t.push(t[0]),t),Da([t[t.length-2]].concat(t,[t[1]]),e))}function Ra(t,e){return t.length<3?Ca(t):t[0]+Oa(t,Da(t,e))}function Oa(t,e){if(e.length<1||t.length!=e.length&&t.length!=e.length+2)return Ca(t);var n=t.length!=e.length,i="",r=t[0],a=t[1],o=e[0],s=o,l=1;if(n&&(i+="Q"+(a[0]-2*o[0]/3)+","+(a[1]-2*o[1]/3)+","+a[0]+","+a[1],r=t[1],l=2),e.length>1){s=e[1],a=t[l],l++,i+="C"+(r[0]+o[0])+","+(r[1]+o[1])+","+(a[0]-s[0])+","+(a[1]-s[1])+","+a[0]+","+a[1];for(var u=2;u<e.length;u++,l++)a=t[l],s=e[u],i+="S"+(a[0]-s[0])+","+(a[1]-s[1])+","+a[0]+","+a[1]}if(n){var c=t[l];i+="Q"+(a[0]+2*s[0]/3)+","+(a[1]+2*s[1]/3)+","+c[0]+","+c[1]}return i}function Da(t,e){for(var n,i=[],r=(1-e)/2,a=t[0],o=t[1],s=1,l=t.length;++s<l;)n=a,a=o,o=t[s],i.push([r*(o[0]-n[0]),r*(o[1]-n[1])]);return i}function Pa(t){if(t.length<3)return Ca(t);var e=1,n=t.length,i=t[0],r=i[0],a=i[1],o=[r,r,r,(i=t[1])[0]],s=[a,a,a,i[1]],l=[r,",",a,"L",Ia($l,o),",",Ia($l,s)];for(t.push(t[n-1]);++e<=n;)i=t[e],o.shift(),o.push(i[0]),s.shift(),s.push(i[1]),Fa(l,o,s);return t.pop(),l.push("L",i),l.join("")}function ja(t){if(t.length<4)return Ca(t);for(var e,n=[],i=-1,r=t.length,a=[0],o=[0];++i<3;)e=t[i],a.push(e[0]),o.push(e[1]);for(n.push(Ia($l,a)+","+Ia($l,o)),--i;++i<r;)e=t[i],a.shift(),a.push(e[0]),o.shift(),o.push(e[1]),Fa(n,a,o);return n.join("")}function $a(t){for(var e,n,i=-1,r=t.length,a=r+4,o=[],s=[];++i<4;)n=t[i%r],o.push(n[0]),s.push(n[1]);for(e=[Ia($l,o),",",Ia($l,s)],--i;++i<a;)n=t[i%r],o.shift(),o.push(n[0]),s.shift(),s.push(n[1]),Fa(e,o,s);return e.join("")}function qa(t,e){var n=t.length-1;if(n)for(var i,r,a=t[0][0],o=t[0][1],s=t[n][0]-a,l=t[n][1]-o,u=-1;++u<=n;)i=t[u],r=u/n,i[0]=e*i[0]+(1-e)*(a+r*s),i[1]=e*i[1]+(1-e)*(o+r*l);return Pa(t)}function Ia(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}function Fa(t,e,n){t.push("C",Ia(Pl,e),",",Ia(Pl,n),",",Ia(jl,e),",",Ia(jl,n),",",Ia($l,e),",",Ia($l,n))}function La(t,e){return(e[1]-t[1])/(e[0]-t[0])}function Ga(t){for(var e=0,n=t.length-1,i=[],r=t[0],a=t[1],o=i[0]=La(r,a);++e<n;)i[e]=(o+(o=La(r=a,a=t[e+1])))/2;return i[e]=o,i}function Va(t){for(var e,n,i,r,a=[],o=Ga(t),s=-1,l=t.length-1;++s<l;)e=La(t[s],t[s+1]),ko(e)<Fo?o[s]=o[s+1]=0:(n=o[s]/e,i=o[s+1]/e,(r=n*n+i*i)>9&&(r=3*e/Math.sqrt(r),o[s]=r*n,o[s+1]=r*i));for(s=-1;++s<=l;)r=(t[Math.min(l,s+1)][0]-t[Math.max(0,s-1)][0])/(6*(1+o[s]*o[s])),a.push([r||0,o[s]*r||0]);return a}function Ha(t){return t.length<3?Ca(t):t[0]+Oa(t,Va(t))}function Ua(t){for(var e,n,i,r=-1,a=t.length;++r<a;)e=t[r],n=e[0],i=e[1]-Uo,e[0]=n*Math.cos(i),e[1]=n*Math.sin(i);return t}function Ba(t){function e(e){function l(){p.push("M",s(t(g),h),c,u(t(v.reverse()),h),"Z")}for(var d,f,_,p=[],v=[],g=[],m=-1,y=e.length,w=Et(n),b=Et(r),x=n===i?function(){return f}:Et(i),k=r===a?function(){return _}:Et(a);++m<y;)o.call(this,d=e[m],m)?(v.push([f=+w.call(this,d,m),_=+b.call(this,d,m)]),g.push([+x.call(this,d,m),+k.call(this,d,m)])):v.length&&(l(),v=[],g=[]);return v.length&&l(),p.length?p.join(""):null}var n=Dn,i=Dn,r=0,a=Pn,o=De,s=Ca,l=s.key,u=s,c="L",h=.7;return e.x=function(t){return arguments.length?(n=i=t,e):i},e.x0=function(t){return arguments.length?(n=t,e):n},e.x1=function(t){return arguments.length?(i=t,e):i},e.y=function(t){return arguments.length?(r=a=t,e):a},e.y0=function(t){return arguments.length?(r=t,e):r},e.y1=function(t){return arguments.length?(a=t,e):a},e.defined=function(t){return arguments.length?(o=t,e):o},e.interpolate=function(t){return arguments.length?(l="function"==typeof t?s=t:(s=Dl.get(t)||Ca).key,u=s.reverse||s,c=s.closed?"M":"L",e):l},e.tension=function(t){return arguments.length?(h=t,e):h},e}function Ya(t){return t.radius}function Xa(t){return[t.x,t.y]}function Ja(t){return function(){var e=t.apply(this,arguments),n=e[0],i=e[1]-Uo;return[n*Math.cos(i),n*Math.sin(i)]}}function Wa(){return 64}function Za(){return"circle"}function Qa(t){var e=Math.sqrt(t/Go);return"M0,"+e+"A"+e+","+e+" 0 1,1 0,"+-e+"A"+e+","+e+" 0 1,1 0,"+e+"Z"}function Ka(t){return function(){var e,n,i;(e=this[t])&&(i=e[n=e.active])&&(i.timer.c=null,i.timer.t=NaN,--e.count?delete e[n]:delete this[t],e.active+=.5,i.event&&i.event.interrupt.call(this,this.__data__,i.index))}}function to(t,e,n){return Ao(t,Hl),t.namespace=e,t.id=n,t}function eo(t,e,n,i){var r=t.id,a=t.namespace;return X(t,"function"==typeof n?function(t,o,s){t[a][r].tween.set(e,i(n.call(t,t.__data__,o,s)))}:(n=i(n),function(t){t[a][r].tween.set(e,n)}))}function no(t){return null==t&&(t=""),function(){this.textContent=t}}function io(t){return null==t?"__transition__":"__transition_"+t+"__"}function ro(t,e,n,i,r){function a(t){var e=p.delay;if(u.t=e+l,e<=t)return o(t-e);u.c=o}function o(n){var r=f.active,a=f[r];a&&(a.timer.c=null,a.timer.t=NaN,--f.count,delete f[r],a.event&&a.event.interrupt.call(t,t.__data__,a.index));for(var o in f)if(+o<i){var _=f[o];_.timer.c=null,_.timer.t=NaN,--f.count,delete f[o]}u.c=s,jt(function(){return u.c&&s(n||1)&&(u.c=null,u.t=NaN),1},0,l),f.active=i,p.event&&p.event.start.call(t,t.__data__,e),d=[],p.tween.forEach(function(n,i){(i=i.call(t,t.__data__,e))&&d.push(i)}),h=p.ease,c=p.duration}function s(r){for(var a=r/c,o=h(a),s=d.length;s>0;)d[--s].call(t,o);if(a>=1)return p.event&&p.event.end.call(t,t.__data__,e),--f.count?delete f[i]:delete t[n],1}var l,u,c,h,d,f=t[n]||(t[n]={active:0,count:0}),p=f[i];p||(l=r.time,u=jt(a,0,l),p=f[i]={tween:new _,time:l,timer:u,delay:r.delay,duration:r.duration,ease:r.ease,index:e},r=null,++f.count)}function ao(t,e,n){t.attr("transform",function(t){var i=e(t);return"translate("+(isFinite(i)?i:n(t))+",0)"})}function oo(t,e,n){t.attr("transform",function(t){var i=e(t);return"translate(0,"+(isFinite(i)?i:n(t))+")"})}function so(t){return t.toISOString()}function lo(t,e,n){function i(e){return t(e)}function r(t,n){var i=t[1]-t[0],r=i/n,a=fo.bisect(Kl,r);return a==Kl.length?[e.year,ia(t.map(function(t){return t/31536e6}),n)[2]]:a?e[r/Kl[a-1]<Kl[a]/r?a-1:a]:[nu,ia(t,n)[2]]}return i.invert=function(e){return uo(t.invert(e))},i.domain=function(e){return arguments.length?(t.domain(e),i):t.domain().map(uo)},i.nice=function(t,e){function n(n){return!isNaN(n)&&!t.range(n,uo(+n+1),e).length}var a=i.domain(),o=Xr(a),s=null==t?r(o,10):"number"==typeof t&&r(o,t);return s&&(t=s[0],e=s[1]),i.domain(Zr(a,e>1?{floor:function(e){for(;n(e=t.floor(e));)e=uo(e-1);return e},ceil:function(e){for(;n(e=t.ceil(e));)e=uo(+e+1);return e}}:t))},i.ticks=function(t,e){var n=Xr(i.domain()),a=null==t?r(n,10):"number"==typeof t?r(n,t):!t.range&&[{range:t},e];return a&&(t=a[0],e=a[1]),t.range(n[0],uo(+n[1]+1),e<1?1:e)},i.tickFormat=function(){return n},i.copy=function(){return lo(t.copy(),e,n)},ea(i,t)}function uo(t){return new Date(t)}function co(t){return JSON.parse(t.responseText)}function ho(t){var e=vo.createRange();return e.selectNode(vo.body),e.createContextualFragment(t.responseText)}var fo={version:"3.5.17"},_o=[].slice,po=function(t){return _o.call(t)},vo=this.document;if(vo)try{po(vo.documentElement.childNodes)[0].nodeType}catch(t){po=function(t){for(var e=t.length,n=new Array(e);e--;)n[e]=t[e];return n}}if(Date.now||(Date.now=function(){return+new Date}),vo)try{vo.createElement("DIV").style.setProperty("opacity",0,"")}catch(t){var go=this.Element.prototype,mo=go.setAttribute,yo=go.setAttributeNS,wo=this.CSSStyleDeclaration.prototype,bo=wo.setProperty;go.setAttribute=function(t,e){mo.call(this,t,e+"")},go.setAttributeNS=function(t,e,n){yo.call(this,t,e,n+"")},wo.setProperty=function(t,e,n){bo.call(this,t,e+"",n)}}fo.ascending=s,fo.descending=function(t,e){return e<t?-1:e>t?1:e>=t?0:NaN},fo.min=function(t,e){var n,i,r=-1,a=t.length;if(1===arguments.length){for(;++r<a;)if(null!=(i=t[r])&&i>=i){n=i;break}for(;++r<a;)null!=(i=t[r])&&n>i&&(n=i)}else{for(;++r<a;)if(null!=(i=e.call(t,t[r],r))&&i>=i){n=i;break}for(;++r<a;)null!=(i=e.call(t,t[r],r))&&n>i&&(n=i)}return n},fo.max=function(t,e){var n,i,r=-1,a=t.length;if(1===arguments.length){for(;++r<a;)if(null!=(i=t[r])&&i>=i){n=i;break}for(;++r<a;)null!=(i=t[r])&&i>n&&(n=i)}else{for(;++r<a;)if(null!=(i=e.call(t,t[r],r))&&i>=i){n=i;break}for(;++r<a;)null!=(i=e.call(t,t[r],r))&&i>n&&(n=i)}return n},fo.extent=function(t,e){var n,i,r,a=-1,o=t.length;if(1===arguments.length){for(;++a<o;)if(null!=(i=t[a])&&i>=i){n=r=i;break}for(;++a<o;)null!=(i=t[a])&&(n>i&&(n=i),r<i&&(r=i))}else{for(;++a<o;)if(null!=(i=e.call(t,t[a],a))&&i>=i){n=r=i;break}for(;++a<o;)null!=(i=e.call(t,t[a],a))&&(n>i&&(n=i),r<i&&(r=i))}return[n,r]},fo.sum=function(t,e){var n,i=0,r=t.length,a=-1;if(1===arguments.length)for(;++a<r;)u(n=+t[a])&&(i+=n);else for(;++a<r;)u(n=+e.call(t,t[a],a))&&(i+=n);return i},fo.mean=function(t,e){var n,i=0,r=t.length,a=-1,o=r;if(1===arguments.length)for(;++a<r;)u(n=l(t[a]))?i+=n:--o;else for(;++a<r;)u(n=l(e.call(t,t[a],a)))?i+=n:--o;if(o)return i/o},fo.quantile=function(t,e){var n=(t.length-1)*e+1,i=Math.floor(n),r=+t[i-1],a=n-i;return a?r+a*(t[i]-r):r},fo.median=function(t,e){var n,i=[],r=t.length,a=-1;if(1===arguments.length)for(;++a<r;)u(n=l(t[a]))&&i.push(n);else for(;++a<r;)u(n=l(e.call(t,t[a],a)))&&i.push(n);if(i.length)return fo.quantile(i.sort(s),.5)},fo.variance=function(t,e){var n,i,r=t.length,a=0,o=0,s=-1,c=0;if(1===arguments.length)for(;++s<r;)u(n=l(t[s]))&&(i=n-a,a+=i/++c,o+=i*(n-a));else for(;++s<r;)u(n=l(e.call(t,t[s],s)))&&(i=n-a,a+=i/++c,o+=i*(n-a));if(c>1)return o/(c-1)},fo.deviation=function(){var t=fo.variance.apply(this,arguments);return t?Math.sqrt(t):t};var xo=c(s);fo.bisectLeft=xo.left,fo.bisect=fo.bisectRight=xo.right,fo.bisector=function(t){return c(1===t.length?function(e,n){return s(t(e),n)}:t)},fo.shuffle=function(t,e,n){(a=arguments.length)<3&&(n=t.length,a<2&&(e=0));for(var i,r,a=n-e;a;)r=Math.random()*a--|0,i=t[a+e],t[a+e]=t[r+e],t[r+e]=i;return t},fo.permute=function(t,e){for(var n=e.length,i=new Array(n);n--;)i[n]=t[e[n]];return i},fo.pairs=function(t){for(var e=0,n=t.length-1,i=t[0],r=new Array(n<0?0:n);e<n;)r[e]=[i,i=t[++e]];return r},fo.transpose=function(t){if(!(r=t.length))return[];for(var e=-1,n=fo.min(t,h),i=new Array(n);++e<n;)for(var r,a=-1,o=i[e]=new Array(r);++a<r;)o[a]=t[a][e];return i},fo.zip=function(){return fo.transpose(arguments)},fo.keys=function(t){var e=[];for(var n in t)e.push(n);return e},fo.values=function(t){var e=[];for(var n in t)e.push(t[n]);return e},fo.entries=function(t){var e=[];for(var n in t)e.push({key:n,value:t[n]});return e},fo.merge=function(t){for(var e,n,i,r=t.length,a=-1,o=0;++a<r;)o+=t[a].length;for(n=new Array(o);--r>=0;)for(i=t[r],e=i.length;--e>=0;)n[--o]=i[e];return n};var ko=Math.abs;fo.range=function(t,e,n){if(arguments.length<3&&(n=1,arguments.length<2&&(e=t,t=0)),(e-t)/n==1/0)throw new Error("infinite range");var i,r=[],a=d(ko(n)),o=-1;if(t*=a,e*=a,n*=a,n<0)for(;(i=t+n*++o)>e;)r.push(i/a);else for(;(i=t+n*++o)<e;)r.push(i/a);return r},fo.map=function(t,e){var n=new _;if(t instanceof _)t.forEach(function(t,e){n.set(t,e)});else if(Array.isArray(t)){var i,r=-1,a=t.length;if(1===arguments.length)for(;++r<a;)n.set(r,t[r]);else for(;++r<a;)n.set(e.call(t,i=t[r],r),i)}else for(var o in t)n.set(o,t[o]);return n};var Mo="__proto__",Co="\0";f(_,{has:g,get:function(t){return this._[p(t)]},set:function(t,e){return this._[p(t)]=e},remove:m,keys:y,values:function(){var t=[];for(var e in this._)t.push(this._[e]);return t},entries:function(){var t=[];for(var e in this._)t.push({key:v(e),value:this._[e]});return t},size:w,empty:b,forEach:function(t){for(var e in this._)t.call(this,v(e),this._[e])}}),fo.nest=function(){function t(e,o,s){if(s>=a.length)return i?i.call(r,o):n?o.sort(n):o;for(var l,u,c,h,d=-1,f=o.length,p=a[s++],v=new _;++d<f;)(h=v.get(l=p(u=o[d])))?h.push(u):v.set(l,[u]);return e?(u=e(),c=function(n,i){u.set(n,t(e,i,s))}):(u={},c=function(n,i){u[n]=t(e,i,s)}),v.forEach(c),u}function e(t,n){if(n>=a.length)return t;var i=[],r=o[n++];return t.forEach(function(t,r){i.push({key:t,values:e(r,n)})}),r?i.sort(function(t,e){return r(t.key,e.key)}):i}var n,i,r={},a=[],o=[];return r.map=function(e,n){return t(n,e,0)},r.entries=function(n){return e(t(fo.map,n,0),0)},r.key=function(t){return a.push(t),r},r.sortKeys=function(t){return o[a.length-1]=t,r},r.sortValues=function(t){return n=t,r},r.rollup=function(t){return i=t,r},r},fo.set=function(t){var e=new x;if(t)for(var n=0,i=t.length;n<i;++n)e.add(t[n]);return e},f(x,{has:g,add:function(t){return this._[p(t+="")]=!0,t},remove:m,values:y,size:w,empty:b,forEach:function(t){for(var e in this._)t.call(this,v(e))}}),fo.behavior={},fo.rebind=function(t,e){for(var n,i=1,r=arguments.length;++i<r;)t[n=arguments[i]]=M(t,e,e[n]);return t};var So=["webkit","ms","moz","Moz","o","O"];fo.dispatch=function(){for(var t=new T,e=-1,n=arguments.length;++e<n;)t[arguments[e]]=A(t);return t},T.prototype.on=function(t,e){var n=t.indexOf("."),i="";if(n>=0&&(i=t.slice(n+1),t=t.slice(0,n)),t)return arguments.length<2?this[t].on(i):this[t].on(i,e);if(2===arguments.length){if(null==e)for(t in this)this.hasOwnProperty(t)&&this[t].on(i,null);return this}},fo.event=null,fo.requote=function(t){return t.replace(To,"\\$&")};var To=/[\\\^\$\*\+\?\|\[\]\(\)\.\{\}]/g,Ao={}.__proto__?function(t,e){t.__proto__=e}:function(t,e){for(var n in e)t[n]=e[n]},zo=function(t,e){return e.querySelector(t)},No=function(t,e){return e.querySelectorAll(t)},Eo=function(t,e){var n=t.matches||t[C(t,"matchesSelector")];return(Eo=function(t,e){return n.call(t,e)})(t,e)};"function"==typeof Sizzle&&(zo=function(t,e){return Sizzle(t,e)[0]||null},No=Sizzle,Eo=Sizzle.matchesSelector),fo.selection=function(){return fo.select(vo.documentElement)};var Ro=fo.selection.prototype=[];Ro.select=function(t){var e,n,i,r,a=[];t=O(t);for(var o=-1,s=this.length;++o<s;){a.push(e=[]),e.parentNode=(i=this[o]).parentNode;for(var l=-1,u=i.length;++l<u;)(r=i[l])?(e.push(n=t.call(r,r.__data__,l,o)),n&&"__data__"in r&&(n.__data__=r.__data__)):e.push(null)}return R(a)},Ro.selectAll=function(t){var e,n,i=[];t=D(t);for(var r=-1,a=this.length;++r<a;)for(var o=this[r],s=-1,l=o.length;++s<l;)(n=o[s])&&(i.push(e=po(t.call(n,n.__data__,s,r))),e.parentNode=n);return R(i)};var Oo="http://www.w3.org/1999/xhtml",Do={svg:"http://www.w3.org/2000/svg",xhtml:Oo,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};fo.ns={prefix:Do,qualify:function(t){var e=t.indexOf(":"),n=t;return e>=0&&"xmlns"!==(n=t.slice(0,e))&&(t=t.slice(e+1)),Do.hasOwnProperty(n)?{space:Do[n],local:t}:t}},Ro.attr=function(t,e){if(arguments.length<2){if("string"==typeof t){var n=this.node();return t=fo.ns.qualify(t),t.local?n.getAttributeNS(t.space,t.local):n.getAttribute(t)}for(e in t)this.each(P(e,t[e]));return this}return this.each(P(t,e))},Ro.classed=function(t,e){if(arguments.length<2){if("string"==typeof t){var n=this.node(),i=(t=q(t)).length,r=-1;if(e=n.classList){for(;++r<i;)if(!e.contains(t[r]))return!1}else for(e=n.getAttribute("class");++r<i;)if(!$(t[r]).test(e))return!1;return!0}for(e in t)this.each(I(e,t[e]));return this}return this.each(I(t,e))},Ro.style=function(t,e,n){var i=arguments.length;if(i<3){if("string"!=typeof t){i<2&&(e="");for(n in t)this.each(L(n,t[n],e));return this}if(i<2){var r=this.node();return o(r).getComputedStyle(r,null).getPropertyValue(t)}n=""}return this.each(L(t,e,n))},Ro.property=function(t,e){if(arguments.length<2){if("string"==typeof t)return this.node()[t];for(e in t)this.each(G(e,t[e]));return this}return this.each(G(t,e))},Ro.text=function(t){return arguments.length?this.each("function"==typeof t?function(){var e=t.apply(this,arguments);this.textContent=null==e?"":e}:null==t?function(){this.textContent=""}:function(){this.textContent=t}):this.node().textContent},Ro.html=function(t){return arguments.length?this.each("function"==typeof t?function(){var e=t.apply(this,arguments);this.innerHTML=null==e?"":e}:null==t?function(){this.innerHTML=""}:function(){this.innerHTML=t}):this.node().innerHTML},Ro.append=function(t){return t=V(t),this.select(function(){return this.appendChild(t.apply(this,arguments))})},Ro.insert=function(t,e){return t=V(t),e=O(e),this.select(function(){return this.insertBefore(t.apply(this,arguments),e.apply(this,arguments)||null)})},Ro.remove=function(){return this.each(H)},Ro.data=function(t,e){function n(t,n){var i,r,a,o=t.length,c=n.length,h=Math.min(o,c),d=new Array(c),f=new Array(c),p=new Array(o);if(e){var v,g=new _,m=new Array(o);for(i=-1;++i<o;)(r=t[i])&&(g.has(v=e.call(r,r.__data__,i))?p[i]=r:g.set(v,r),m[i]=v);for(i=-1;++i<c;)(r=g.get(v=e.call(n,a=n[i],i)))?!0!==r&&(d[i]=r,r.__data__=a):f[i]=U(a),g.set(v,!0);for(i=-1;++i<o;)i in m&&!0!==g.get(m[i])&&(p[i]=t[i])}else{for(i=-1;++i<h;)r=t[i],a=n[i],r?(r.__data__=a,d[i]=r):f[i]=U(a);for(;i<c;++i)f[i]=U(n[i]);for(;i<o;++i)p[i]=t[i]}f.update=d,f.parentNode=d.parentNode=p.parentNode=t.parentNode,s.push(f),l.push(d),u.push(p)}var i,r,a=-1,o=this.length;if(!arguments.length){for(t=new Array(o=(i=this[0]).length);++a<o;)(r=i[a])&&(t[a]=r.__data__);return t}var s=J([]),l=R([]),u=R([]);if("function"==typeof t)for(;++a<o;)n(i=this[a],t.call(i,i.parentNode.__data__,a));else for(;++a<o;)n(i=this[a],t);return l.enter=function(){return s},l.exit=function(){return u},l},Ro.datum=function(t){return arguments.length?this.property("__data__",t):this.property("__data__")},Ro.filter=function(t){var e,n,i,r=[];"function"!=typeof t&&(t=B(t));for(var a=0,o=this.length;a<o;a++){r.push(e=[]),e.parentNode=(n=this[a]).parentNode;for(var s=0,l=n.length;s<l;s++)(i=n[s])&&t.call(i,i.__data__,s,a)&&e.push(i)}return R(r)},Ro.order=function(){for(var t=-1,e=this.length;++t<e;)for(var n,i=this[t],r=i.length-1,a=i[r];--r>=0;)(n=i[r])&&(a&&a!==n.nextSibling&&a.parentNode.insertBefore(n,a),a=n);return this},Ro.sort=function(t){t=Y.apply(this,arguments);for(var e=-1,n=this.length;++e<n;)this[e].sort(t);return this.order()},Ro.each=function(t){return X(this,function(e,n,i){t.call(e,e.__data__,n,i)})},Ro.call=function(t){var e=po(arguments);return t.apply(e[0]=this,e),this},Ro.empty=function(){return!this.node()},Ro.node=function(){for(var t=0,e=this.length;t<e;t++)for(var n=this[t],i=0,r=n.length;i<r;i++){var a=n[i];if(a)return a}return null},Ro.size=function(){var t=0;return X(this,function(){++t}),t};var Po=[];fo.selection.enter=J,fo.selection.enter.prototype=Po,Po.append=Ro.append,Po.empty=Ro.empty,Po.node=Ro.node,Po.call=Ro.call,Po.size=Ro.size,Po.select=function(t){for(var e,n,i,r,a,o=[],s=-1,l=this.length;++s<l;){i=(r=this[s]).update,o.push(e=[]),e.parentNode=r.parentNode;for(var u=-1,c=r.length;++u<c;)(a=r[u])?(e.push(i[u]=n=t.call(r.parentNode,a.__data__,u,s)),n.__data__=a.__data__):e.push(null)}return R(o)},Po.insert=function(t,e){return arguments.length<2&&(e=W(this)),Ro.insert.call(this,t,e)},fo.select=function(t){var e;return"string"==typeof t?(e=[zo(t,vo)],e.parentNode=vo.documentElement):(e=[t],e.parentNode=a(t)),R([e])},fo.selectAll=function(t){var e;return"string"==typeof t?(e=po(No(t,vo)),e.parentNode=vo.documentElement):(e=po(t),e.parentNode=null),R([e])},Ro.on=function(t,e,n){var i=arguments.length;if(i<3){if("string"!=typeof t){i<2&&(e=!1);for(n in t)this.each(Z(n,t[n],e));return this}if(i<2)return(i=this.node()["__on"+t])&&i._;n=!1}return this.each(Z(t,e,n))};var jo=fo.map({mouseenter:"mouseover",mouseleave:"mouseout"});vo&&jo.forEach(function(t){"on"+t in vo&&jo.remove(t)});var $o,qo=0;fo.mouse=function(t){return et(t,N())};var Io=this.navigator&&/WebKit/.test(this.navigator.userAgent)?-1:0;fo.touch=function(t,e,n){if(arguments.length<3&&(n=e,e=N().changedTouches),e)for(var i,r=0,a=e.length;r<a;++r)if((i=e[r]).identifier===n)return et(t,i)},fo.behavior.drag=function(){function t(){this.on("mousedown.drag",r).on("touchstart.drag",a)}function e(t,e,r,a,o){return function(){function s(){var t,n,i=e(d,p);i&&(t=i[0]-y[0],n=i[1]-y[1],_|=t|n,y=i,f({type:"drag",x:i[0]+u[0],y:i[1]+u[1],dx:t,dy:n}))}function l(){e(d,p)&&(g.on(a+v,null).on(o+v,null),m(_),f({type:"dragend"}))}var u,c=this,h=fo.event.target.correspondingElement||fo.event.target,d=c.parentNode,f=n.of(c,arguments),_=0,p=t(),v=".drag"+(null==p?"":"-"+p),g=fo.select(r(h)).on(a+v,s).on(o+v,l),m=tt(h),y=e(d,p);i?(u=i.apply(c,arguments),u=[u.x-y[0],u.y-y[1]]):u=[0,0],f({type:"dragstart"})}}var n=E(t,"drag","dragstart","dragend"),i=null,r=e(S,fo.mouse,o,"mousemove","mouseup"),a=e(nt,fo.touch,k,"touchmove","touchend");return t.origin=function(e){return arguments.length?(i=e,t):i},fo.rebind(t,n,"on")},fo.touches=function(t,e){return arguments.length<2&&(e=N().touches),e?po(e).map(function(e){var n=et(t,e);return n.identifier=e.identifier,n}):[]};var Fo=1e-6,Lo=Fo*Fo,Go=Math.PI,Vo=2*Go,Ho=Vo-Fo,Uo=Go/2,Bo=Go/180,Yo=180/Go,Xo=Math.SQRT2;fo.interpolateZoom=function(t,e){var n,i,r=t[0],a=t[1],o=t[2],s=e[0],l=e[1],u=e[2],c=s-r,h=l-a,d=c*c+h*h;if(d<Lo)i=Math.log(u/o)/Xo,n=function(t){return[r+t*c,a+t*h,o*Math.exp(Xo*t*i)]};else{var f=Math.sqrt(d),_=(u*u-o*o+4*d)/(2*o*2*f),p=(u*u-o*o-4*d)/(2*u*2*f),v=Math.log(Math.sqrt(_*_+1)-_),g=Math.log(Math.sqrt(p*p+1)-p);i=(g-v)/Xo,n=function(t){var e=t*i,n=lt(v),s=o/(2*f)*(n*ut(Xo*e+v)-st(v));return[r+s*c,a+s*h,o*n/lt(Xo*e+v)]}}return n.duration=1e3*i,n},fo.behavior.zoom=function(){function t(t){t.on(N,h).on(Wo+".zoom",f).on("dblclick.zoom",_).on(D,d)}function e(t){return[(t[0]-M.x)/M.k,(t[1]-M.y)/M.k]}function n(t){return[t[0]*M.k+M.x,t[1]*M.k+M.y]}function i(t){M.k=Math.max(S[0],Math.min(S[1],t))}function r(t,e){e=n(e),M.x+=t[0]-e[0],M.y+=t[1]-e[1]}function a(e,n,a,o){e.__chart__={x:M.x,y:M.y,k:M.k},i(Math.pow(2,o)),r(v=n,a),e=fo.select(e),T>0&&(e=e.transition().duration(T)),e.call(t.event)}function s(){b&&b.domain(w.range().map(function(t){return(t-M.x)/M.k}).map(w.invert)),k&&k.domain(x.range().map(function(t){return(t-M.y)/M.k}).map(x.invert))}function l(t){A++||t({type:"zoomstart"})}function u(t){s(),t({type:"zoom",scale:M.k,translate:[M.x,M.y]})}function c(t){--A||(t({type:"zoomend"}),v=null)}function h(){function t(){s=1,r(fo.mouse(i),d),u(a)}function n(){h.on(R,null).on(O,null),f(s),c(a)}var i=this,a=P.of(i,arguments),s=0,h=fo.select(o(i)).on(R,t).on(O,n),d=e(fo.mouse(i)),f=tt(i);Vl.call(i),l(a)}function d(){function t(){var t=fo.touches(_);return f=M.k,t.forEach(function(t){t.identifier in v&&(v[t.identifier]=e(t))}),t}function n(){var e=fo.event.target;fo.select(e).on(w,o).on(b,s),x.push(e);for(var n=fo.event.changedTouches,i=0,r=n.length;i<r;++i)v[n[i].identifier]=null;var l=t(),u=Date.now();if(1===l.length){if(u-y<500){var c=l[0];a(_,c,v[c.identifier],Math.floor(Math.log(M.k)/Math.LN2)+1),z()}y=u}else if(l.length>1){var c=l[0],h=l[1],d=c[0]-h[0],f=c[1]-h[1];g=d*d+f*f}}function o(){var t,e,n,a,o=fo.touches(_);Vl.call(_);for(var s=0,l=o.length;s<l;++s,a=null)if(n=o[s],a=v[n.identifier]){if(e)break;t=n,e=a}if(a){var c=(c=n[0]-t[0])*c+(c=n[1]-t[1])*c,h=g&&Math.sqrt(c/g);t=[(t[0]+n[0])/2,(t[1]+n[1])/2],e=[(e[0]+a[0])/2,(e[1]+a[1])/2],i(h*f)}y=null,r(t,e),u(p)}function s(){if(fo.event.touches.length){for(var e=fo.event.changedTouches,n=0,i=e.length;n<i;++n)delete v[e[n].identifier];for(var r in v)return void t()}fo.selectAll(x).on(m,null),k.on(N,h).on(D,d),C(),c(p)}var f,_=this,p=P.of(_,arguments),v={},g=0,m=".zoom-"+fo.event.changedTouches[0].identifier,w="touchmove"+m,b="touchend"+m,x=[],k=fo.select(_),C=tt(_);n(),l(p),k.on(N,null).on(D,n)}function f(){var t=P.of(this,arguments);m?clearTimeout(m):(Vl.call(this),p=e(v=g||fo.mouse(this)),l(t)),m=setTimeout(function(){m=null,c(t)},50),z(),i(Math.pow(2,.002*Jo())*M.k),r(v,p),u(t)}function _(){var t=fo.mouse(this),n=Math.log(M.k)/Math.LN2;a(this,t,e(t),fo.event.shiftKey?Math.ceil(n)-1:Math.floor(n)+1)}var p,v,g,m,y,w,b,x,k,M={x:0,y:0,k:1},C=[960,500],S=Zo,T=250,A=0,N="mousedown.zoom",R="mousemove.zoom",O="mouseup.zoom",D="touchstart.zoom",P=E(t,"zoomstart","zoom","zoomend");return Wo||(Wo="onwheel"in vo?(Jo=function(){return-fo.event.deltaY*(fo.event.deltaMode?120:1)},"wheel"):"onmousewheel"in vo?(Jo=function(){return fo.event.wheelDelta},"mousewheel"):(Jo=function(){return-fo.event.detail},"MozMousePixelScroll")),t.event=function(t){t.each(function(){var t=P.of(this,arguments),e=M;Ll?fo.select(this).transition().each("start.zoom",function(){M=this.__chart__||{x:0,y:0,k:1},l(t)}).tween("zoom:zoom",function(){var n=C[0],i=C[1],r=v?v[0]:n/2,a=v?v[1]:i/2,o=fo.interpolateZoom([(r-M.x)/M.k,(a-M.y)/M.k,n/M.k],[(r-e.x)/e.k,(a-e.y)/e.k,n/e.k]);return function(e){var i=o(e),s=n/i[2];this.__chart__=M={x:r-i[0]*s,y:a-i[1]*s,k:s},u(t)}}).each("interrupt.zoom",function(){c(t)}).each("end.zoom",function(){c(t)}):(this.__chart__=M,l(t),u(t),c(t))})},t.translate=function(e){return arguments.length?(M={x:+e[0],y:+e[1],k:M.k},s(),t):[M.x,M.y]},t.scale=function(e){return arguments.length?(M={x:M.x,y:M.y,k:null},i(+e),s(),t):M.k},t.scaleExtent=function(e){return arguments.length?(S=null==e?Zo:[+e[0],+e[1]],t):S},t.center=function(e){return arguments.length?(g=e&&[+e[0],+e[1]],t):g},t.size=function(e){return arguments.length?(C=e&&[+e[0],+e[1]],t):C},t.duration=function(e){return arguments.length?(T=+e,t):T},t.x=function(e){return arguments.length?(b=e,w=e.copy(),M={x:0,y:0,k:1},t):b},t.y=function(e){return arguments.length?(k=e,x=e.copy(),M={x:0,y:0,k:1},t):k},fo.rebind(t,P,"on")};var Jo,Wo,Zo=[0,1/0];fo.color=ht,ht.prototype.toString=function(){return this.rgb()+""},fo.hsl=dt;var Qo=dt.prototype=new ht;Qo.brighter=function(t){return t=Math.pow(.7,arguments.length?t:1),new dt(this.h,this.s,this.l/t)},Qo.darker=function(t){return t=Math.pow(.7,arguments.length?t:1),new dt(this.h,this.s,t*this.l)},Qo.rgb=function(){return ft(this.h,this.s,this.l)},fo.hcl=_t;var Ko=_t.prototype=new ht;Ko.brighter=function(t){return new _t(this.h,this.c,Math.min(100,this.l+ts*(arguments.length?t:1)))},Ko.darker=function(t){return new _t(this.h,this.c,Math.max(0,this.l-ts*(arguments.length?t:1)))},Ko.rgb=function(){return pt(this.h,this.c,this.l).rgb()},fo.lab=vt;var ts=18,es=.95047,ns=1,is=1.08883,rs=vt.prototype=new ht;rs.brighter=function(t){return new vt(Math.min(100,this.l+ts*(arguments.length?t:1)),this.a,this.b)},rs.darker=function(t){return new vt(Math.max(0,this.l-ts*(arguments.length?t:1)),this.a,this.b)},rs.rgb=function(){return gt(this.l,this.a,this.b)},fo.rgb=xt;var as=xt.prototype=new ht;as.brighter=function(t){t=Math.pow(.7,arguments.length?t:1);var e=this.r,n=this.g,i=this.b,r=30;return e||n||i?(e&&e<r&&(e=r),n&&n<r&&(n=r),i&&i<r&&(i=r),new xt(Math.min(255,e/t),Math.min(255,n/t),Math.min(255,i/t))):new xt(r,r,r)},as.darker=function(t){return t=Math.pow(.7,arguments.length?t:1),new xt(t*this.r,t*this.g,t*this.b)},as.hsl=function(){return Tt(this.r,this.g,this.b)},as.toString=function(){return"#"+Ct(this.r)+Ct(this.g)+Ct(this.b)};var os=fo.map({aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074});os.forEach(function(t,e){os.set(t,kt(e))}),fo.functor=Et,fo.xhr=Rt(k),fo.dsv=function(t,e){function n(t,n,a){arguments.length<3&&(a=n,n=null);var o=Ot(t,e,null==n?i:r(n),a);return o.row=function(t){return arguments.length?o.response(null==(n=t)?i:r(t)):n},o}function i(t){return n.parse(t.responseText)}function r(t){return function(e){return n.parse(e.responseText,t)}}function a(e){return e.map(o).join(t)}function o(t){return s.test(t)?'"'+t.replace(/\"/g,'""')+'"':t}var s=new RegExp('["'+t+"\n]"),l=t.charCodeAt(0);return n.parse=function(t,e){var i;return n.parseRows(t,function(t,n){if(i)return i(t,n-1);var r=new Function("d","return {"+t.map(function(t,e){return JSON.stringify(t)+": d["+e+"]"}).join(",")+"}");i=e?function(t,n){return e(r(t),n)}:r})},n.parseRows=function(t,e){function n(){if(c>=u)return o;if(r)return r=!1,a;var e=c;if(34===t.charCodeAt(e)){for(var n=e;n++<u;)if(34===t.charCodeAt(n)){if(34!==t.charCodeAt(n+1))break;++n}c=n+2;var i=t.charCodeAt(n+1);return 13===i?(r=!0,10===t.charCodeAt(n+2)&&++c):10===i&&(r=!0),t.slice(e+1,n).replace(/""/g,'"')}for(;c<u;){var i=t.charCodeAt(c++),s=1;if(10===i)r=!0;else if(13===i)r=!0,10===t.charCodeAt(c)&&(++c,++s);else if(i!==l)continue;return t.slice(e,c-s)}return t.slice(e)}for(var i,r,a={},o={},s=[],u=t.length,c=0,h=0;(i=n())!==o;){for(var d=[];i!==a&&i!==o;)d.push(i),i=n();e&&null==(d=e(d,h++))||s.push(d)}return s},n.format=function(e){if(Array.isArray(e[0]))return n.formatRows(e);var i=new x,r=[];return e.forEach(function(t){for(var e in t)i.has(e)||r.push(i.add(e))}),[r.map(o).join(t)].concat(e.map(function(e){return r.map(function(t){return o(e[t])}).join(t)})).join("\n")},n.formatRows=function(t){return t.map(a).join("\n")},n},fo.csv=fo.dsv(",","text/csv"),fo.tsv=fo.dsv("\t","text/tab-separated-values");var ss,ls,us,cs,hs=this[C(this,"requestAnimationFrame")]||function(t){setTimeout(t,17)};fo.timer=function(){jt.apply(this,arguments)},fo.timer.flush=function(){qt(),It()},fo.round=function(t,e){return e?Math.round(t*(e=Math.pow(10,e)))/e:Math.round(t)};var ds=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"].map(Lt);fo.formatPrefix=function(t,e){var n=0;return(t=+t)&&(t<0&&(t*=-1),e&&(t=fo.round(t,Ft(t,e))),n=1+Math.floor(1e-12+Math.log(t)/Math.LN10),n=Math.max(-24,Math.min(24,3*Math.floor((n-1)/3)))),ds[8+n/3]};var fs=/(?:([^{])?([<>=^]))?([+\- ])?([$#])?(0)?(\d+)?(,)?(\.-?\d+)?([a-z%])?/i,_s=fo.map({b:function(t){return t.toString(2)},c:function(t){return String.fromCharCode(t)},o:function(t){return t.toString(8)},x:function(t){return t.toString(16)},X:function(t){return t.toString(16).toUpperCase()},g:function(t,e){return t.toPrecision(e)},e:function(t,e){return t.toExponential(e)},f:function(t,e){return t.toFixed(e)},r:function(t,e){return(t=fo.round(t,Ft(t,e))).toFixed(Math.max(0,Math.min(20,Ft(t*(1+1e-15),e))))}}),ps=fo.time={},vs=Date;Ht.prototype={getDate:function(){return this._.getUTCDate()},getDay:function(){return this._.getUTCDay()},getFullYear:function(){return this._.getUTCFullYear()},getHours:function(){return this._.getUTCHours()},getMilliseconds:function(){return this._.getUTCMilliseconds()},getMinutes:function(){return this._.getUTCMinutes()},getMonth:function(){return this._.getUTCMonth()},getSeconds:function(){return this._.getUTCSeconds()},getTime:function(){return this._.getTime()},getTimezoneOffset:function(){return 0},valueOf:function(){return this._.valueOf()},setDate:function(){gs.setUTCDate.apply(this._,arguments)},setDay:function(){gs.setUTCDay.apply(this._,arguments)},setFullYear:function(){gs.setUTCFullYear.apply(this._,arguments)},setHours:function(){gs.setUTCHours.apply(this._,arguments)},setMilliseconds:function(){gs.setUTCMilliseconds.apply(this._,arguments)},setMinutes:function(){gs.setUTCMinutes.apply(this._,arguments)},setMonth:function(){gs.setUTCMonth.apply(this._,arguments)},setSeconds:function(){gs.setUTCSeconds.apply(this._,arguments)},setTime:function(){gs.setTime.apply(this._,arguments)}};var gs=Date.prototype;ps.year=Ut(function(t){return t=ps.day(t),t.setMonth(0,1),t},function(t,e){t.setFullYear(t.getFullYear()+e)},function(t){return t.getFullYear()}),ps.years=ps.year.range,ps.years.utc=ps.year.utc.range,ps.day=Ut(function(t){var e=new vs(2e3,0);return e.setFullYear(t.getFullYear(),t.getMonth(),t.getDate()),e},function(t,e){t.setDate(t.getDate()+e)},function(t){return t.getDate()-1}),ps.days=ps.day.range,ps.days.utc=ps.day.utc.range,ps.dayOfYear=function(t){var e=ps.year(t);return Math.floor((t-e-6e4*(t.getTimezoneOffset()-e.getTimezoneOffset()))/864e5)},["sunday","monday","tuesday","wednesday","thursday","friday","saturday"].forEach(function(t,e){e=7-e;var n=ps[t]=Ut(function(t){return(t=ps.day(t)).setDate(t.getDate()-(t.getDay()+e)%7),t},function(t,e){t.setDate(t.getDate()+7*Math.floor(e))},function(t){var n=ps.year(t).getDay();return Math.floor((ps.dayOfYear(t)+(n+e)%7)/7)-(n!==e)});ps[t+"s"]=n.range,ps[t+"s"].utc=n.utc.range,ps[t+"OfYear"]=function(t){var n=ps.year(t).getDay();return Math.floor((ps.dayOfYear(t)+(n+e)%7)/7)}}),ps.week=ps.sunday,ps.weeks=ps.sunday.range,ps.weeks.utc=ps.sunday.utc.range,ps.weekOfYear=ps.sundayOfYear;var ms={"-":"",_:" ",0:"0"},ys=/^\s*\d+/,ws=/^%/;fo.locale=function(t){return{numberFormat:Gt(t),timeFormat:Yt(t)}};var bs=fo.locale({decimal:".",thousands:",",grouping:[3],currency:["$",""],dateTime:"%a %b %e %X %Y",date:"%m/%d/%Y",time:"%H:%M:%S",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});fo.format=bs.numberFormat,fo.geo={},_e.prototype={s:0,t:0,add:function(t){pe(t,this.t,xs),pe(xs.s,this.s,this),this.s?this.t+=xs.t:this.s=xs.t},reset:function(){this.s=this.t=0},valueOf:function(){return this.s}};var xs=new _e;fo.geo.stream=function(t,e){t&&ks.hasOwnProperty(t.type)?ks[t.type](t,e):ve(t,e)};var ks={Feature:function(t,e){ve(t.geometry,e)},FeatureCollection:function(t,e){for(var n=t.features,i=-1,r=n.length;++i<r;)ve(n[i].geometry,e)}},Ms={Sphere:function(t,e){e.sphere()},Point:function(t,e){t=t.coordinates,e.point(t[0],t[1],t[2])},MultiPoint:function(t,e){for(var n=t.coordinates,i=-1,r=n.length;++i<r;)t=n[i],e.point(t[0],t[1],t[2])},LineString:function(t,e){ge(t.coordinates,e,0)},MultiLineString:function(t,e){for(var n=t.coordinates,i=-1,r=n.length;++i<r;)ge(n[i],e,0)},Polygon:function(t,e){me(t.coordinates,e)},MultiPolygon:function(t,e){for(var n=t.coordinates,i=-1,r=n.length;++i<r;)me(n[i],e)},GeometryCollection:function(t,e){for(var n=t.geometries,i=-1,r=n.length;++i<r;)ve(n[i],e)}};fo.geo.area=function(t){return Cs=0,fo.geo.stream(t,Ts),Cs};var Cs,Ss=new _e,Ts={sphere:function(){Cs+=4*Go},point:S,lineStart:S,lineEnd:S,polygonStart:function(){Ss.reset(),Ts.lineStart=ye},polygonEnd:function(){var t=2*Ss;Cs+=t<0?4*Go+t:t,Ts.lineStart=Ts.lineEnd=Ts.point=S}};fo.geo.bounds=function(){function t(t,e){y.push(w=[c=t,d=t]),e<h&&(h=e),e>f&&(f=e)}function e(e,n){var i=we([e*Bo,n*Bo]);if(g){var r=xe(g,i),a=[r[1],-r[0],0],o=xe(a,r);Ce(o),o=Se(o);var l=e-_,u=l>0?1:-1,p=o[0]*Yo*u,v=ko(l)>180;if(v^(u*_<p&&p<u*e)){var m=o[1]*Yo;m>f&&(f=m)}else if(p=(p+360)%360-180,v^(u*_<p&&p<u*e)){var m=-o[1]*Yo;m<h&&(h=m)}else n<h&&(h=n),n>f&&(f=n);v?e<_?s(c,e)>s(c,d)&&(d=e):s(e,d)>s(c,d)&&(c=e):d>=c?(e<c&&(c=e),e>d&&(d=e)):e>_?s(c,e)>s(c,d)&&(d=e):s(e,d)>s(c,d)&&(c=e)}else t(e,n);g=i,_=e}function n(){b.point=e}function i(){w[0]=c,w[1]=d,b.point=t,g=null}function r(t,n){if(g){var i=t-_;m+=ko(i)>180?i+(i>0?360:-360):i}else p=t,v=n;Ts.point(t,n),e(t,n)}function a(){Ts.lineStart()}function o(){r(p,v),Ts.lineEnd(),ko(m)>Fo&&(c=-(d=180)),w[0]=c,w[1]=d,g=null}function s(t,e){return(e-=t)<0?e+360:e}function l(t,e){return t[0]-e[0]}function u(t,e){return e[0]<=e[1]?e[0]<=t&&t<=e[1]:t<e[0]||e[1]<t}var c,h,d,f,_,p,v,g,m,y,w,b={point:t,lineStart:n,lineEnd:i,polygonStart:function(){b.point=r,b.lineStart=a,b.lineEnd=o,m=0,Ts.polygonStart()},polygonEnd:function(){Ts.polygonEnd(),b.point=t,b.lineStart=n,b.lineEnd=i,Ss<0?(c=-(d=180),h=-(f=90)):m>Fo?f=90:m<-Fo&&(h=-90),w[0]=c,w[1]=d}};return function(t){f=d=-(c=h=1/0),y=[],fo.geo.stream(t,b);var e=y.length;if(e){y.sort(l);for(var n,i=1,r=y[0],a=[r];i<e;++i)n=y[i],u(n[0],r)||u(n[1],r)?(s(r[0],n[1])>s(r[0],r[1])&&(r[1]=n[1]),s(n[0],r[1])>s(r[0],r[1])&&(r[0]=n[0])):a.push(r=n);for(var o,n,_=-1/0,e=a.length-1,i=0,r=a[e];i<=e;r=n,++i)n=a[i],(o=s(r[1],n[0]))>_&&(_=o,c=n[0],d=r[1])}return y=w=null,c===1/0||h===1/0?[[NaN,NaN],[NaN,NaN]]:[[c,h],[d,f]]}}(),fo.geo.centroid=function(t){As=zs=Ns=Es=Rs=Os=Ds=Ps=js=$s=qs=0,fo.geo.stream(t,Is);var e=js,n=$s,i=qs,r=e*e+n*n+i*i;return r<Lo&&(e=Os,n=Ds,i=Ps,zs<Fo&&(e=Ns,n=Es,i=Rs),(r=e*e+n*n+i*i)<Lo)?[NaN,NaN]:[Math.atan2(n,e)*Yo,ot(i/Math.sqrt(r))*Yo]};var As,zs,Ns,Es,Rs,Os,Ds,Ps,js,$s,qs,Is={sphere:S,point:Ae,lineStart:Ne,lineEnd:Ee,polygonStart:function(){Is.lineStart=Re},polygonEnd:function(){Is.lineStart=Ne}},Fs=qe(De,Ge,He,[-Go,-Go/2]),Ls=1e9;fo.geo.clipExtent=function(){var t,e,n,i,r,a,o={stream:function(t){return r&&(r.valid=!1),r=a(t),r.valid=!0,r},extent:function(s){return arguments.length?(a=Xe(t=+s[0][0],e=+s[0][1],n=+s[1][0],i=+s[1][1]),r&&(r.valid=!1,r=null),o):[[t,e],[n,i]]}};return o.extent([[0,0],[960,500]])},(fo.geo.conicEqualArea=function(){return Je(We)}).raw=We,fo.geo.albers=function(){return fo.geo.conicEqualArea().rotate([96,0]).center([-.6,38.7]).parallels([29.5,45.5]).scale(1070)},fo.geo.albersUsa=function(){function t(t){var a=t[0],o=t[1];return e=null,n(a,o),e||(i(a,o),e)||r(a,o),e}var e,n,i,r,a=fo.geo.albers(),o=fo.geo.conicEqualArea().rotate([154,0]).center([-2,58.5]).parallels([55,65]),s=fo.geo.conicEqualArea().rotate([157,0]).center([-3,19.9]).parallels([8,18]),l={point:function(t,n){e=[t,n]}};return t.invert=function(t){var e=a.scale(),n=a.translate(),i=(t[0]-n[0])/e,r=(t[1]-n[1])/e;return(r>=.12&&r<.234&&i>=-.425&&i<-.214?o:r>=.166&&r<.234&&i>=-.214&&i<-.115?s:a).invert(t)},t.stream=function(t){var e=a.stream(t),n=o.stream(t),i=s.stream(t);return{point:function(t,r){e.point(t,r),n.point(t,r),i.point(t,r)},sphere:function(){e.sphere(),n.sphere(),i.sphere()},lineStart:function(){e.lineStart(),n.lineStart(),i.lineStart()},lineEnd:function(){e.lineEnd(),n.lineEnd(),i.lineEnd()},polygonStart:function(){e.polygonStart(),n.polygonStart(),i.polygonStart()},polygonEnd:function(){e.polygonEnd(),n.polygonEnd(),i.polygonEnd()}}},t.precision=function(e){return arguments.length?(a.precision(e),o.precision(e),s.precision(e),t):a.precision()},t.scale=function(e){return arguments.length?(a.scale(e),o.scale(.35*e),s.scale(e),t.translate(a.translate())):a.scale()},t.translate=function(e){if(!arguments.length)return a.translate();var u=a.scale(),c=+e[0],h=+e[1];return n=a.translate(e).clipExtent([[c-.455*u,h-.238*u],[c+.455*u,h+.238*u]]).stream(l).point,i=o.translate([c-.307*u,h+.201*u]).clipExtent([[c-.425*u+Fo,h+.12*u+Fo],[c-.214*u-Fo,h+.234*u-Fo]]).stream(l).point,r=s.translate([c-.205*u,h+.212*u]).clipExtent([[c-.214*u+Fo,h+.166*u+Fo],[c-.115*u-Fo,h+.234*u-Fo]]).stream(l).point,t},t.scale(1070)};var Gs,Vs,Hs,Us,Bs,Ys,Xs={point:S,lineStart:S,lineEnd:S,polygonStart:function(){Vs=0,Xs.lineStart=Ze},polygonEnd:function(){Xs.lineStart=Xs.lineEnd=Xs.point=S,Gs+=ko(Vs/2)}},Js={point:Qe,lineStart:S,lineEnd:S,polygonStart:S,polygonEnd:S},Ws={point:en,lineStart:nn,lineEnd:rn,polygonStart:function(){Ws.lineStart=an},polygonEnd:function(){Ws.point=en,Ws.lineStart=nn,Ws.lineEnd=rn}};fo.geo.path=function(){function t(t){return t&&("function"==typeof s&&a.pointRadius(+s.apply(this,arguments)),o&&o.valid||(o=r(a)),fo.geo.stream(t,o)),a.result()}function e(){return o=null,t}var n,i,r,a,o,s=4.5;return t.area=function(t){return Gs=0,fo.geo.stream(t,r(Xs)),Gs},t.centroid=function(t){return Ns=Es=Rs=Os=Ds=Ps=js=$s=qs=0,fo.geo.stream(t,r(Ws)),qs?[js/qs,$s/qs]:Ps?[Os/Ps,Ds/Ps]:Rs?[Ns/Rs,Es/Rs]:[NaN,NaN]},t.bounds=function(t){return Bs=Ys=-(Hs=Us=1/0),fo.geo.stream(t,r(Js)),[[Hs,Us],[Bs,Ys]]},t.projection=function(t){return arguments.length?(r=(n=t)?t.stream||ln(t):k,e()):n},t.context=function(t){return arguments.length?(a=null==(i=t)?new Ke:new on(t),"function"!=typeof s&&a.pointRadius(s),e()):i},t.pointRadius=function(e){return arguments.length?(s="function"==typeof e?e:(a.pointRadius(+e),+e),t):s},t.projection(fo.geo.albersUsa()).context(null)},fo.geo.transform=function(t){return{stream:function(e){var n=new un(e);for(var i in t)n[i]=t[i];return n}}},un.prototype={point:function(t,e){this.stream.point(t,e)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}},fo.geo.projection=hn,fo.geo.projectionMutator=dn,(fo.geo.equirectangular=function(){return hn(_n)}).raw=_n.invert=_n,fo.geo.rotation=function(t){function e(e){return e=t(e[0]*Bo,e[1]*Bo),e[0]*=Yo,e[1]*=Yo,e}return t=vn(t[0]%360*Bo,t[1]*Bo,t.length>2?t[2]*Bo:0),e.invert=function(e){return e=t.invert(e[0]*Bo,e[1]*Bo),e[0]*=Yo,e[1]*=Yo,e},e},pn.invert=_n,fo.geo.circle=function(){function t(){var t="function"==typeof i?i.apply(this,arguments):i,e=vn(-t[0]*Bo,-t[1]*Bo,0).invert,r=[];return n(null,null,1,{point:function(t,n){r.push(t=e(t,n)),t[0]*=Yo,t[1]*=Yo}}),{type:"Polygon",coordinates:[r]}}var e,n,i=[0,0],r=6;return t.origin=function(e){return arguments.length?(i=e,t):i},t.angle=function(i){return arguments.length?(n=wn((e=+i)*Bo,r*Bo),t):e},t.precision=function(i){return arguments.length?(n=wn(e*Bo,(r=+i)*Bo),t):r},t.angle(90)},fo.geo.distance=function(t,e){var n,i=(e[0]-t[0])*Bo,r=t[1]*Bo,a=e[1]*Bo,o=Math.sin(i),s=Math.cos(i),l=Math.sin(r),u=Math.cos(r),c=Math.sin(a),h=Math.cos(a);return Math.atan2(Math.sqrt((n=h*o)*n+(n=u*c-l*h*s)*n),l*c+u*h*s)},fo.geo.graticule=function(){function t(){return{type:"MultiLineString",coordinates:e()}}function e(){return fo.range(Math.ceil(a/v)*v,r,v).map(d).concat(fo.range(Math.ceil(u/g)*g,l,g).map(f)).concat(fo.range(Math.ceil(i/_)*_,n,_).filter(function(t){return ko(t%v)>Fo}).map(c)).concat(fo.range(Math.ceil(s/p)*p,o,p).filter(function(t){return ko(t%g)>Fo}).map(h))}var n,i,r,a,o,s,l,u,c,h,d,f,_=10,p=_,v=90,g=360,m=2.5;return t.lines=function(){return e().map(function(t){return{type:"LineString",coordinates:t}})},t.outline=function(){return{type:"Polygon",coordinates:[d(a).concat(f(l).slice(1),d(r).reverse().slice(1),f(u).reverse().slice(1))]}},t.extent=function(e){return arguments.length?t.majorExtent(e).minorExtent(e):t.minorExtent()},t.majorExtent=function(e){return arguments.length?(a=+e[0][0],r=+e[1][0],u=+e[0][1],l=+e[1][1],a>r&&(e=a,a=r,r=e),u>l&&(e=u,u=l,l=e),t.precision(m)):[[a,u],[r,l]]},t.minorExtent=function(e){return arguments.length?(i=+e[0][0],n=+e[1][0],s=+e[0][1],o=+e[1][1],i>n&&(e=i,i=n,n=e),s>o&&(e=s,s=o,o=e),t.precision(m)):[[i,s],[n,o]]},t.step=function(e){return arguments.length?t.majorStep(e).minorStep(e):t.minorStep()},t.majorStep=function(e){return arguments.length?(v=+e[0],g=+e[1],t):[v,g]},t.minorStep=function(e){return arguments.length?(_=+e[0],p=+e[1],t):[_,p]},t.precision=function(e){return arguments.length?(m=+e,c=xn(s,o,90),h=kn(i,n,m),d=xn(u,l,90),f=kn(a,r,m),t):m},t.majorExtent([[-180,-90+Fo],[180,90-Fo]]).minorExtent([[-180,-80-Fo],[180,80+Fo]])},fo.geo.greatArc=function(){function t(){return{type:"LineString",coordinates:[e||i.apply(this,arguments),n||r.apply(this,arguments)]}}var e,n,i=Mn,r=Cn;return t.distance=function(){return fo.geo.distance(e||i.apply(this,arguments),n||r.apply(this,arguments))},t.source=function(n){return arguments.length?(i=n,e="function"==typeof n?null:n,t):i},t.target=function(e){return arguments.length?(r=e,n="function"==typeof e?null:e,t):r},t.precision=function(){return arguments.length?t:0},t},fo.geo.interpolate=function(t,e){return Sn(t[0]*Bo,t[1]*Bo,e[0]*Bo,e[1]*Bo)},fo.geo.length=function(t){return Zs=0,fo.geo.stream(t,Qs),Zs};var Zs,Qs={sphere:S,point:S,lineStart:Tn,lineEnd:S,polygonStart:S,polygonEnd:S},Ks=An(function(t){return Math.sqrt(2/(1+t))},function(t){return 2*Math.asin(t/2)});(fo.geo.azimuthalEqualArea=function(){return hn(Ks)}).raw=Ks;var tl=An(function(t){var e=Math.acos(t);return e&&e/Math.sin(e)},k);(fo.geo.azimuthalEquidistant=function(){return hn(tl)}).raw=tl,(fo.geo.conicConformal=function(){return Je(zn)}).raw=zn,(fo.geo.conicEquidistant=function(){return Je(Nn)}).raw=Nn;var el=An(function(t){return 1/t},Math.atan);(fo.geo.gnomonic=function(){return hn(el)}).raw=el,En.invert=function(t,e){return[t,2*Math.atan(Math.exp(e))-Uo]},(fo.geo.mercator=function(){return Rn(En)}).raw=En;var nl=An(function(){return 1},Math.asin);(fo.geo.orthographic=function(){return hn(nl)}).raw=nl;var il=An(function(t){return 1/(1+t)},function(t){return 2*Math.atan(t)});(fo.geo.stereographic=function(){return hn(il)}).raw=il,On.invert=function(t,e){return[-e,2*Math.atan(Math.exp(t))-Uo]},(fo.geo.transverseMercator=function(){var t=Rn(On),e=t.center,n=t.rotate;return t.center=function(t){return t?e([-t[1],t[0]]):(t=e(),[t[1],-t[0]])},t.rotate=function(t){return t?n([t[0],t[1],t.length>2?t[2]+90:90]):(t=n(),[t[0],t[1],t[2]-90])},n([0,0,90])}).raw=On,fo.geom={},fo.geom.hull=function(t){function e(t){if(t.length<3)return[];var e,r=Et(n),a=Et(i),o=t.length,s=[],l=[];for(e=0;e<o;e++)s.push([+r.call(this,t[e],e),+a.call(this,t[e],e),e]);for(s.sort($n),e=0;e<o;e++)l.push([s[e][0],-s[e][1]]);var u=jn(s),c=jn(l),h=c[0]===u[0],d=c[c.length-1]===u[u.length-1],f=[];for(e=u.length-1;e>=0;--e)f.push(t[s[u[e]][2]]);for(e=+h;e<c.length-d;++e)f.push(t[s[c[e]][2]]);return f}var n=Dn,i=Pn;return arguments.length?e(t):(e.x=function(t){return arguments.length?(n=t,e):n},e.y=function(t){return arguments.length?(i=t,e):i},e)},fo.geom.polygon=function(t){return Ao(t,rl),t};var rl=fo.geom.polygon.prototype=[];rl.area=function(){for(var t,e=-1,n=this.length,i=this[n-1],r=0;++e<n;)t=i,i=this[e],r+=t[1]*i[0]-t[0]*i[1];return.5*r},rl.centroid=function(t){var e,n,i=-1,r=this.length,a=0,o=0,s=this[r-1];for(arguments.length||(t=-1/(6*this.area()));++i<r;)e=s,s=this[i],n=e[0]*s[1]-s[0]*e[1],a+=(e[0]+s[0])*n,o+=(e[1]+s[1])*n;return[a*t,o*t]},rl.clip=function(t){for(var e,n,i,r,a,o,s=Fn(t),l=-1,u=this.length-Fn(this),c=this[u-1];++l<u;){for(e=t.slice(),t.length=0,r=this[l],a=e[(i=e.length-s)-1],n=-1;++n<i;)o=e[n],qn(o,c,r)?(qn(a,c,r)||t.push(In(a,o,c,r)),t.push(o)):qn(a,c,r)&&t.push(In(a,o,c,r)),a=o;s&&t.push(t[0]),c=r}return t};var al,ol,sl,ll,ul,cl=[],hl=[];Xn.prototype.prepare=function(){for(var t,e=this.edges,n=e.length;n--;)t=e[n].edge,t.b&&t.a||e.splice(n,1);return e.sort(Wn),e.length},oi.prototype={start:function(){return this.edge.l===this.site?this.edge.a:this.edge.b},end:function(){return this.edge.l===this.site?this.edge.b:this.edge.a}},si.prototype={insert:function(t,e){var n,i,r;if(t){if(e.P=t,e.N=t.N,t.N&&(t.N.P=e),t.N=e,t.R){for(t=t.R;t.L;)t=t.L;t.L=e}else t.R=e;n=t}else this._?(t=hi(this._),e.P=null,e.N=t,t.P=t.L=e,n=t):(e.P=e.N=null,this._=e,n=null);for(e.L=e.R=null,e.U=n,e.C=!0,t=e;n&&n.C;)i=n.U,n===i.L?(r=i.R,r&&r.C?(n.C=r.C=!1,i.C=!0,t=i):(t===n.R&&(ui(this,n),t=n,n=t.U),n.C=!1,i.C=!0,ci(this,i))):(r=i.L,r&&r.C?(n.C=r.C=!1,i.C=!0,t=i):(t===n.L&&(ci(this,n),t=n,n=t.U),n.C=!1,i.C=!0,ui(this,i))),n=t.U;this._.C=!1},remove:function(t){t.N&&(t.N.P=t.P),t.P&&(t.P.N=t.N),t.N=t.P=null;var e,n,i,r=t.U,a=t.L,o=t.R;if(n=a?o?hi(o):a:o,r?r.L===t?r.L=n:r.R=n:this._=n,a&&o?(i=n.C,n.C=t.C,n.L=a,a.U=n,n!==o?(r=n.U,n.U=t.U,t=n.R,r.L=t,n.R=o,o.U=n):(n.U=r,r=n,t=n.R)):(i=t.C,t=n),t&&(t.U=r),!i){if(t&&t.C)return void(t.C=!1);do{if(t===this._)break;if(t===r.L){if(e=r.R,e.C&&(e.C=!1,r.C=!0,ui(this,r),e=r.R),e.L&&e.L.C||e.R&&e.R.C){e.R&&e.R.C||(e.L.C=!1,e.C=!0,ci(this,e),e=r.R),e.C=r.C,r.C=e.R.C=!1,ui(this,r),t=this._;break}}else if(e=r.L,e.C&&(e.C=!1,r.C=!0,ci(this,r),e=r.L),e.L&&e.L.C||e.R&&e.R.C){e.L&&e.L.C||(e.R.C=!1,e.C=!0,ui(this,e),e=r.L),e.C=r.C,r.C=e.L.C=!1,ci(this,r),t=this._;break}e.C=!0,t=r,r=r.U}while(!t.C);t&&(t.C=!1)}}},fo.geom.voronoi=function(t){function e(t){var e=new Array(t.length),i=s[0][0],r=s[0][1],a=s[1][0],o=s[1][1];return di(n(t),s).cells.forEach(function(n,s){var l=n.edges,u=n.site;(e[s]=l.length?l.map(function(t){var e=t.start();return[e.x,e.y]}):u.x>=i&&u.x<=a&&u.y>=r&&u.y<=o?[[i,o],[a,o],[a,r],[i,r]]:[]).point=t[s]}),e}function n(t){return t.map(function(t,e){return{x:Math.round(a(t,e)/Fo)*Fo,y:Math.round(o(t,e)/Fo)*Fo,i:e}})}var i=Dn,r=Pn,a=i,o=r,s=dl;return t?e(t):(e.links=function(t){return di(n(t)).edges.filter(function(t){return t.l&&t.r}).map(function(e){return{source:t[e.l.i],target:t[e.r.i]}})},e.triangles=function(t){var e=[];return di(n(t)).cells.forEach(function(n,i){for(var r,a=n.site,o=n.edges.sort(Wn),s=-1,l=o.length,u=o[l-1].edge,c=u.l===a?u.r:u.l;++s<l;)u,r=c,u=o[s].edge,c=u.l===a?u.r:u.l,i<r.i&&i<c.i&&_i(a,r,c)<0&&e.push([t[i],t[r.i],t[c.i]])}),e},e.x=function(t){return arguments.length?(a=Et(i=t),e):i},e.y=function(t){return arguments.length?(o=Et(r=t),e):r},e.clipExtent=function(t){return arguments.length?(s=null==t?dl:t,e):s===dl?null:s},e.size=function(t){return arguments.length?e.clipExtent(t&&[[0,0],t]):s===dl?null:s&&s[1]},e)};var dl=[[-1e6,-1e6],[1e6,1e6]];fo.geom.delaunay=function(t){return fo.geom.voronoi().triangles(t)},fo.geom.quadtree=function(t,e,n,i,r){function a(t){function a(t,e,n,i,r,a,o,s){if(!isNaN(n)&&!isNaN(i))if(t.leaf){var l=t.x,c=t.y;if(null!=l)if(ko(l-n)+ko(c-i)<.01)u(t,e,n,i,r,a,o,s);else{var h=t.point;t.x=t.y=t.point=null,u(t,h,l,c,r,a,o,s),u(t,e,n,i,r,a,o,s)}else t.x=n,t.y=i,t.point=e}else u(t,e,n,i,r,a,o,s)}function u(t,e,n,i,r,o,s,l){var u=.5*(r+s),c=.5*(o+l),h=n>=u,d=i>=c,f=d<<1|h;t.leaf=!1,t=t.nodes[f]||(t.nodes[f]=gi()),h?r=u:s=u,d?o=c:l=c,a(t,e,n,i,r,o,s,l)}var c,h,d,f,_,p,v,g,m,y=Et(s),w=Et(l);if(null!=e)p=e,v=n,g=i,m=r;else if(g=m=-(p=v=1/0),h=[],d=[],_=t.length,o)for(f=0;f<_;++f)c=t[f],c.x<p&&(p=c.x),c.y<v&&(v=c.y),c.x>g&&(g=c.x),c.y>m&&(m=c.y),h.push(c.x),d.push(c.y);else for(f=0;f<_;++f){var b=+y(c=t[f],f),x=+w(c,f);b<p&&(p=b),x<v&&(v=x),b>g&&(g=b),x>m&&(m=x),h.push(b),d.push(x)}var k=g-p,M=m-v;k>M?m=v+k:g=p+M;var C=gi();if(C.add=function(t){a(C,t,+y(t,++f),+w(t,f),p,v,g,m)},C.visit=function(t){mi(t,C,p,v,g,m)},C.find=function(t){return yi(C,t[0],t[1],p,v,g,m)},f=-1,null==e){for(;++f<_;)a(C,t[f],h[f],d[f],p,v,g,m);--f}else t.forEach(C.add);return h=d=t=c=null,C}var o,s=Dn,l=Pn;return(o=arguments.length)?(s=pi,l=vi,3===o&&(r=n,i=e,n=e=0),a(t)):(a.x=function(t){return arguments.length?(s=t,a):s},a.y=function(t){return arguments.length?(l=t,a):l},a.extent=function(t){return arguments.length?(null==t?e=n=i=r=null:(e=+t[0][0],n=+t[0][1],i=+t[1][0],r=+t[1][1]),a):null==e?null:[[e,n],[i,r]]},a.size=function(t){return arguments.length?(null==t?e=n=i=r=null:(e=n=0,i=+t[0],r=+t[1]),a):null==e?null:[i-e,r-n]},a)},fo.interpolateRgb=wi,fo.interpolateObject=bi,fo.interpolateNumber=xi,fo.interpolateString=ki;var fl=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,_l=new RegExp(fl.source,"g");fo.interpolate=Mi,fo.interpolators=[function(t,e){var n=typeof e;return("string"===n?os.has(e.toLowerCase())||/^(#|rgb\(|hsl\()/i.test(e)?wi:ki:e instanceof ht?wi:Array.isArray(e)?Ci:"object"===n&&isNaN(e)?bi:xi)(t,e)}],fo.interpolateArray=Ci;var pl=function(){return k},vl=fo.map({linear:pl,poly:Ri,quad:function(){return zi},cubic:function(){return Ni},sin:function(){return Oi},exp:function(){return Di},circle:function(){return Pi},elastic:ji,back:$i,bounce:function(){return qi}}),gl=fo.map({in:k,out:Ti,"in-out":Ai,"out-in":function(t){return Ai(Ti(t))}});fo.ease=function(t){var e=t.indexOf("-"),n=e>=0?t.slice(0,e):t,i=e>=0?t.slice(e+1):"in";return n=vl.get(n)||pl,i=gl.get(i)||k,Si(i(n.apply(null,_o.call(arguments,1))))},fo.interpolateHcl=Ii,fo.interpolateHsl=Fi,fo.interpolateLab=Li,fo.interpolateRound=Gi,fo.transform=function(t){var e=vo.createElementNS(fo.ns.prefix.svg,"g");return(fo.transform=function(t){if(null!=t){e.setAttribute("transform",t);var n=e.transform.baseVal.consolidate()}return new Vi(n?n.matrix:ml)})(t)},Vi.prototype.toString=function(){return"translate("+this.translate+")rotate("+this.rotate+")skewX("+this.skew+")scale("+this.scale+")"};var ml={a:1,b:0,c:0,d:1,e:0,f:0};fo.interpolateTransform=Qi,fo.layout={},fo.layout.bundle=function(){return function(t){for(var e=[],n=-1,i=t.length;++n<i;)e.push(er(t[n]));return e}},fo.layout.chord=function(){function t(){var t,u,h,d,f,_={},p=[],v=fo.range(a),g=[];for(n=[],i=[],t=0,d=-1;++d<a;){for(u=0,f=-1;++f<a;)u+=r[d][f];p.push(u),g.push(fo.range(a)),t+=u}for(o&&v.sort(function(t,e){return o(p[t],p[e])}),s&&g.forEach(function(t,e){t.sort(function(t,n){return s(r[e][t],r[e][n])})}),t=(Vo-c*a)/t,u=0,d=-1;++d<a;){for(h=u,f=-1;++f<a;){var m=v[d],y=g[m][f],w=r[m][y],b=u,x=u+=w*t;_[m+"-"+y]={index:m,subindex:y,startAngle:b,endAngle:x,value:w}}i[m]={index:m,startAngle:h,endAngle:u,value:p[m]},u+=c}for(d=-1;++d<a;)for(f=d-1;++f<a;){var k=_[d+"-"+f],M=_[f+"-"+d];(k.value||M.value)&&n.push(k.value<M.value?{source:M,target:k}:{source:k,target:M})}l&&e()}function e(){n.sort(function(t,e){return l((t.source.value+t.target.value)/2,(e.source.value+e.target.value)/2)})}var n,i,r,a,o,s,l,u={},c=0;return u.matrix=function(t){return arguments.length?(a=(r=t)&&r.length,n=i=null,u):r},u.padding=function(t){return arguments.length?(c=t,n=i=null,u):c},u.sortGroups=function(t){return arguments.length?(o=t,n=i=null,u):o},u.sortSubgroups=function(t){return arguments.length?(s=t,n=null,u):s},u.sortChords=function(t){return arguments.length?(l=t,n&&e(),u):l},u.chords=function(){return n||t(),n},u.groups=function(){return i||t(),i},u},fo.layout.force=function(){function t(t){return function(e,n,i,r){if(e.point!==t){var a=e.cx-t.x,o=e.cy-t.y,s=r-n,l=a*a+o*o;if(s*s/g<l){if(l<p){var u=e.charge/l;t.px-=a*u,t.py-=o*u}return!0}if(e.point&&l&&l<p){var u=e.pointCharge/l;t.px-=a*u,t.py-=o*u}}return!e.charge}}function e(t){t.px=fo.event.x,t.py=fo.event.y,l.resume()}var n,i,r,a,o,s,l={},u=fo.dispatch("start","tick","end"),c=[1,1],h=.9,d=yl,f=wl,_=-30,p=bl,v=.1,g=.64,m=[],y=[];return l.tick=function(){if((r*=.99)<.005)return n=null,u.end({type:"end",alpha:r=0}),!0;var e,i,l,d,f,p,g,w,b,x=m.length,k=y.length;for(i=0;i<k;++i)l=y[i],d=l.source,f=l.target,w=f.x-d.x,b=f.y-d.y,(p=w*w+b*b)&&(p=r*o[i]*((p=Math.sqrt(p))-a[i])/p,w*=p,b*=p,f.x-=w*(g=d.weight+f.weight?d.weight/(d.weight+f.weight):.5),f.y-=b*g,d.x+=w*(g=1-g),d.y+=b*g);if((g=r*v)&&(w=c[0]/2,b=c[1]/2,i=-1,g))for(;++i<x;)l=m[i],l.x+=(w-l.x)*g,l.y+=(b-l.y)*g;if(_)for(lr(e=fo.geom.quadtree(m),r,s),i=-1;++i<x;)(l=m[i]).fixed||e.visit(t(l));for(i=-1;++i<x;)l=m[i],l.fixed?(l.x=l.px,l.y=l.py):(l.x-=(l.px-(l.px=l.x))*h,l.y-=(l.py-(l.py=l.y))*h);u.tick({type:"tick",alpha:r})},l.nodes=function(t){return arguments.length?(m=t,l):m},l.links=function(t){return arguments.length?(y=t,l):y},l.size=function(t){return arguments.length?(c=t,l):c},l.linkDistance=function(t){return arguments.length?(d="function"==typeof t?t:+t,l):d},l.distance=l.linkDistance,l.linkStrength=function(t){return arguments.length?(f="function"==typeof t?t:+t,l):f},l.friction=function(t){return arguments.length?(h=+t,l):h},l.charge=function(t){return arguments.length?(_="function"==typeof t?t:+t,l):_},l.chargeDistance=function(t){return arguments.length?(p=t*t,l):Math.sqrt(p)},l.gravity=function(t){return arguments.length?(v=+t,l):v},l.theta=function(t){return arguments.length?(g=t*t,l):Math.sqrt(g)},l.alpha=function(t){return arguments.length?(t=+t,r?t>0?r=t:(n.c=null,n.t=NaN,n=null,u.end({type:"end",alpha:r=0})):t>0&&(u.start({type:"start",alpha:r=t}),n=jt(l.tick)),l):r},l.start=function(){function t(t,i){if(!n){for(n=new Array(r),l=0;l<r;++l)n[l]=[];for(l=0;l<u;++l){var a=y[l];n[a.source.index].push(a.target),n[a.target.index].push(a.source)}}for(var o,s=n[e],l=-1,c=s.length;++l<c;)if(!isNaN(o=s[l][t]))return o;return Math.random()*i}var e,n,i,r=m.length,u=y.length,h=c[0],p=c[1];for(e=0;e<r;++e)(i=m[e]).index=e,i.weight=0;for(e=0;e<u;++e)i=y[e],"number"==typeof i.source&&(i.source=m[i.source]),"number"==typeof i.target&&(i.target=m[i.target]),++i.source.weight,++i.target.weight;for(e=0;e<r;++e)i=m[e],isNaN(i.x)&&(i.x=t("x",h)),isNaN(i.y)&&(i.y=t("y",p)),isNaN(i.px)&&(i.px=i.x),isNaN(i.py)&&(i.py=i.y);if(a=[],"function"==typeof d)for(e=0;e<u;++e)a[e]=+d.call(this,y[e],e);else for(e=0;e<u;++e)a[e]=d;if(o=[],"function"==typeof f)for(e=0;e<u;++e)o[e]=+f.call(this,y[e],e);else for(e=0;e<u;++e)o[e]=f;if(s=[],"function"==typeof _)for(e=0;e<r;++e)s[e]=+_.call(this,m[e],e);else for(e=0;e<r;++e)s[e]=_;return l.resume()},l.resume=function(){return l.alpha(.1)},l.stop=function(){return l.alpha(0)},l.drag=function(){if(i||(i=fo.behavior.drag().origin(k).on("dragstart.force",rr).on("drag.force",e).on("dragend.force",ar)),!arguments.length)return i;this.on("mouseover.force",or).on("mouseout.force",sr).call(i)},fo.rebind(l,u,"on")};var yl=20,wl=1,bl=1/0;fo.layout.hierarchy=function(){function t(r){var a,o=[r],s=[];for(r.depth=0;null!=(a=o.pop());)if(s.push(a),(u=n.call(t,a,a.depth))&&(l=u.length)){for(var l,u,c;--l>=0;)o.push(c=u[l]),c.parent=a,c.depth=a.depth+1;i&&(a.value=0),a.children=u}else i&&(a.value=+i.call(t,a,a.depth)||0),delete a.children;return hr(r,function(t){var n,r;e&&(n=t.children)&&n.sort(e),i&&(r=t.parent)&&(r.value+=t.value)}),s}var e=_r,n=dr,i=fr;return t.sort=function(n){return arguments.length?(e=n,t):e},t.children=function(e){return arguments.length?(n=e,t):n},t.value=function(e){return arguments.length?(i=e,t):i},t.revalue=function(e){return i&&(cr(e,function(t){t.children&&(t.value=0)}),hr(e,function(e){var n;e.children||(e.value=+i.call(t,e,e.depth)||0),(n=e.parent)&&(n.value+=e.value)})),e},t},fo.layout.partition=function(){function t(e,n,i,r){var a=e.children;if(e.x=n,e.y=e.depth*r,e.dx=i,e.dy=r,a&&(o=a.length)){var o,s,l,u=-1;for(i=e.value?i/e.value:0;++u<o;)t(s=a[u],n,l=s.value*i,r),n+=l}}function e(t){var n=t.children,i=0;if(n&&(r=n.length))for(var r,a=-1;++a<r;)i=Math.max(i,e(n[a]));return 1+i}function n(n,a){var o=i.call(this,n,a);return t(o[0],0,r[0],r[1]/e(o[0])),o}var i=fo.layout.hierarchy(),r=[1,1];return n.size=function(t){return arguments.length?(r=t,n):r},ur(n,i)},fo.layout.pie=function(){function t(o){var s,l=o.length,u=o.map(function(n,i){return+e.call(t,n,i)}),c=+("function"==typeof i?i.apply(this,arguments):i),h=("function"==typeof r?r.apply(this,arguments):r)-c,d=Math.min(Math.abs(h)/l,+("function"==typeof a?a.apply(this,arguments):a)),f=d*(h<0?-1:1),_=fo.sum(u),p=_?(h-l*f)/_:0,v=fo.range(l),g=[];return null!=n&&v.sort(n===xl?function(t,e){return u[e]-u[t]}:function(t,e){return n(o[t],o[e])}),v.forEach(function(t){g[t]={data:o[t],value:s=u[t],startAngle:c,endAngle:c+=s*p+f,padAngle:d}}),g}var e=Number,n=xl,i=0,r=Vo,a=0;return t.value=function(n){return arguments.length?(e=n,t):e},t.sort=function(e){return arguments.length?(n=e,t):n},t.startAngle=function(e){return arguments.length?(i=e,t):i},t.endAngle=function(e){return arguments.length?(r=e,t):r},t.padAngle=function(e){return arguments.length?(a=e,t):a},t};var xl={};fo.layout.stack=function(){function t(s,l){if(!(d=s.length))return s;var u=s.map(function(n,i){return e.call(t,n,i)}),c=u.map(function(e){return e.map(function(e,n){return[a.call(t,e,n),o.call(t,e,n)]})}),h=n.call(t,c,l);u=fo.permute(u,h),c=fo.permute(c,h);var d,f,_,p,v=i.call(t,c,l),g=u[0].length;for(_=0;_<g;++_)for(r.call(t,u[0][_],p=v[_],c[0][_][1]),f=1;f<d;++f)r.call(t,u[f][_],p+=c[f-1][_][1],c[f][_][1]);return s}var e=k,n=yr,i=wr,r=mr,a=vr,o=gr;return t.values=function(n){return arguments.length?(e=n,t):e},t.order=function(e){return arguments.length?(n="function"==typeof e?e:kl.get(e)||yr,t):n},t.offset=function(e){return arguments.length?(i="function"==typeof e?e:Ml.get(e)||wr,t):i},t.x=function(e){return arguments.length?(a=e,t):a},t.y=function(e){return arguments.length?(o=e,t):o},t.out=function(e){return arguments.length?(r=e,t):r},t};var kl=fo.map({"inside-out":function(t){var e,n,i=t.length,r=t.map(br),a=t.map(xr),o=fo.range(i).sort(function(t,e){return r[t]-r[e]}),s=0,l=0,u=[],c=[];for(e=0;e<i;++e)n=o[e],s<l?(s+=a[n],u.push(n)):(l+=a[n],c.push(n));return c.reverse().concat(u)},reverse:function(t){return fo.range(t.length).reverse()},default:yr}),Ml=fo.map({silhouette:function(t){var e,n,i,r=t.length,a=t[0].length,o=[],s=0,l=[];for(n=0;n<a;++n){for(e=0,i=0;e<r;e++)i+=t[e][n][1];i>s&&(s=i),o.push(i)}for(n=0;n<a;++n)l[n]=(s-o[n])/2;return l},wiggle:function(t){var e,n,i,r,a,o,s,l,u,c=t.length,h=t[0],d=h.length,f=[];for(f[0]=l=u=0,n=1;n<d;++n){for(e=0,r=0;e<c;++e)r+=t[e][n][1];for(e=0,a=0,s=h[n][0]-h[n-1][0];e<c;++e){for(i=0,o=(t[e][n][1]-t[e][n-1][1])/(2*s);i<e;++i)o+=(t[i][n][1]-t[i][n-1][1])/s;a+=o*t[e][n][1]}f[n]=l-=r?a/r*s:0,l<u&&(u=l)}for(n=0;n<d;++n)f[n]-=u;return f},expand:function(t){var e,n,i,r=t.length,a=t[0].length,o=1/r,s=[];for(n=0;n<a;++n){for(e=0,i=0;e<r;e++)i+=t[e][n][1];if(i)for(e=0;e<r;e++)t[e][n][1]/=i;else for(e=0;e<r;e++)t[e][n][1]=o}for(n=0;n<a;++n)s[n]=0;return s},zero:wr});fo.layout.histogram=function(){function t(t,a){for(var o,s,l=[],u=t.map(n,this),c=i.call(this,u,a),h=r.call(this,c,u,a),a=-1,d=u.length,f=h.length-1,_=e?1:1/d;++a<f;)o=l[a]=[],o.dx=h[a+1]-(o.x=h[a]),o.y=0;if(f>0)for(a=-1;++a<d;)(s=u[a])>=c[0]&&s<=c[1]&&(o=l[fo.bisect(h,s,1,f)-1],o.y+=_,o.push(t[a]));return l}var e=!0,n=Number,i=Sr,r=Mr;return t.value=function(e){return arguments.length?(n=e,t):n},t.range=function(e){return arguments.length?(i=Et(e),t):i},t.bins=function(e){return arguments.length?(r="number"==typeof e?function(t){return Cr(t,e)}:Et(e),t):r},t.frequency=function(n){return arguments.length?(e=!!n,t):e},t},fo.layout.pack=function(){function t(t,a){var o=n.call(this,t,a),s=o[0],l=r[0],u=r[1],c=null==e?Math.sqrt:"function"==typeof e?e:function(){return e};if(s.x=s.y=0,hr(s,function(t){t.r=+c(t.value)}),hr(s,Er),i){var h=i*(e?1:Math.max(2*s.r/l,2*s.r/u))/2;hr(s,function(t){t.r+=h}),hr(s,Er),hr(s,function(t){t.r-=h})}return Dr(s,l/2,u/2,e?1:1/Math.max(2*s.r/l,2*s.r/u)),o}var e,n=fo.layout.hierarchy().sort(Tr),i=0,r=[1,1];return t.size=function(e){return arguments.length?(r=e,t):r},t.radius=function(n){return arguments.length?(e=null==n||"function"==typeof n?n:+n,t):e},t.padding=function(e){return arguments.length?(i=+e,t):i},ur(t,n)},fo.layout.tree=function(){function t(t,r){var c=o.call(this,t,r),h=c[0],d=e(h);if(hr(d,n),d.parent.m=-d.z,cr(d,i),u)cr(h,a);else{var f=h,_=h,p=h;cr(h,function(t){t.x<f.x&&(f=t),t.x>_.x&&(_=t),t.depth>p.depth&&(p=t)});var v=s(f,_)/2-f.x,g=l[0]/(_.x+s(_,f)/2+v),m=l[1]/(p.depth||1);cr(h,function(t){t.x=(t.x+v)*g,t.y=t.depth*m})}return c}function e(t){for(var e,n={A:null,children:[t]},i=[n];null!=(e=i.pop());)for(var r,a=e.children,o=0,s=a.length;o<s;++o)i.push((a[o]=r={_:a[o],parent:e,children:(r=a[o].children)&&r.slice()||[],A:null,a:null,z:0,m:0,c:0,s:0,t:null,i:o}).a=r);return n.children[0]}function n(t){var e=t.children,n=t.parent.children,i=t.i?n[t.i-1]:null;if(e.length){Fr(t);var a=(e[0].z+e[e.length-1].z)/2;i?(t.z=i.z+s(t._,i._),t.m=t.z-a):t.z=a}else i&&(t.z=i.z+s(t._,i._));t.parent.A=r(t,i,t.parent.A||n[0])}function i(t){t._.x=t.z+t.parent.m,t.m+=t.parent.m}function r(t,e,n){if(e){for(var i,r=t,a=t,o=e,l=r.parent.children[0],u=r.m,c=a.m,h=o.m,d=l.m;o=qr(o),r=$r(r),o&&r;)l=$r(l),a=qr(a),a.a=t,i=o.z+h-r.z-u+s(o._,r._),i>0&&(Ir(Lr(o,t,n),t,i),u+=i,c+=i),h+=o.m,u+=r.m,d+=l.m,c+=a.m;o&&!qr(a)&&(a.t=o,a.m+=h-c),r&&!$r(l)&&(l.t=r,l.m+=u-d,n=t)}return n}function a(t){t.x*=l[0],t.y=t.depth*l[1]}var o=fo.layout.hierarchy().sort(null).value(null),s=jr,l=[1,1],u=null;return t.separation=function(e){return arguments.length?(s=e,t):s},t.size=function(e){return arguments.length?(u=null==(l=e)?a:null,t):u?null:l},t.nodeSize=function(e){return arguments.length?(u=null==(l=e)?null:a,t):u?l:null},ur(t,o)},fo.layout.cluster=function(){function t(t,a){var o,s=e.call(this,t,a),l=s[0],u=0;hr(l,function(t){var e=t.children;e&&e.length?(t.x=Vr(e),t.y=Gr(e)):(t.x=o?u+=n(t,o):0,t.y=0,o=t)});var c=Hr(l),h=Ur(l),d=c.x-n(c,h)/2,f=h.x+n(h,c)/2;return hr(l,r?function(t){t.x=(t.x-l.x)*i[0],t.y=(l.y-t.y)*i[1]}:function(t){t.x=(t.x-d)/(f-d)*i[0],t.y=(1-(l.y?t.y/l.y:1))*i[1]}),s}var e=fo.layout.hierarchy().sort(null).value(null),n=jr,i=[1,1],r=!1;return t.separation=function(e){return arguments.length?(n=e,t):n},t.size=function(e){return arguments.length?(r=null==(i=e),t):r?null:i},t.nodeSize=function(e){return arguments.length?(r=null!=(i=e),t):r?i:null},ur(t,e)},fo.layout.treemap=function(){function t(t,e){for(var n,i,r=-1,a=t.length;++r<a;)i=(n=t[r]).value*(e<0?0:e),n.area=isNaN(i)||i<=0?0:i}function e(n){var a=n.children;if(a&&a.length){var o,s,l,u=h(n),c=[],d=a.slice(),_=1/0,p="slice"===f?u.dx:"dice"===f?u.dy:"slice-dice"===f?1&n.depth?u.dy:u.dx:Math.min(u.dx,u.dy);for(t(d,u.dx*u.dy/n.value),c.area=0;(l=d.length)>0;)c.push(o=d[l-1]),c.area+=o.area,"squarify"!==f||(s=i(c,p))<=_?(d.pop(),_=s):(c.area-=c.pop().area,r(c,p,u,!1),p=Math.min(u.dx,u.dy),c.length=c.area=0,_=1/0);c.length&&(r(c,p,u,!0),c.length=c.area=0),a.forEach(e)}}function n(e){var i=e.children;if(i&&i.length){var a,o=h(e),s=i.slice(),l=[];for(t(s,o.dx*o.dy/e.value),l.area=0;a=s.pop();)l.push(a),l.area+=a.area,null!=a.z&&(r(l,a.z?o.dx:o.dy,o,!s.length),l.length=l.area=0);i.forEach(n)}}function i(t,e){for(var n,i=t.area,r=0,a=1/0,o=-1,s=t.length;++o<s;)(n=t[o].area)&&(n<a&&(a=n),n>r&&(r=n));return i*=i,e*=e,i?Math.max(e*r*_/i,i/(e*a*_)):1/0}function r(t,e,n,i){var r,a=-1,o=t.length,s=n.x,u=n.y,c=e?l(t.area/e):0;if(e==n.dx){for((i||c>n.dy)&&(c=n.dy);++a<o;)r=t[a],r.x=s,r.y=u,r.dy=c,s+=r.dx=Math.min(n.x+n.dx-s,c?l(r.area/c):0);r.z=!0,r.dx+=n.x+n.dx-s,n.y+=c,n.dy-=c}else{for((i||c>n.dx)&&(c=n.dx);++a<o;)r=t[a],r.x=s,r.y=u,r.dx=c,u+=r.dy=Math.min(n.y+n.dy-u,c?l(r.area/c):0);r.z=!1,r.dy+=n.y+n.dy-u,n.x+=c,n.dx-=c}}function a(i){var r=o||s(i),a=r[0];return a.x=a.y=0,a.value?(a.dx=u[0],a.dy=u[1]):a.dx=a.dy=0,o&&s.revalue(a),t([a],a.dx*a.dy/a.value),(o?n:e)(a),d&&(o=r),r}var o,s=fo.layout.hierarchy(),l=Math.round,u=[1,1],c=null,h=Br,d=!1,f="squarify",_=.5*(1+Math.sqrt(5));return a.size=function(t){return arguments.length?(u=t,a):u},a.padding=function(t){function e(e){var n=t.call(a,e,e.depth);return null==n?Br(e):Yr(e,"number"==typeof n?[n,n,n,n]:n)}function n(e){return Yr(e,t)}if(!arguments.length)return c;var i;return h=null==(c=t)?Br:"function"==(i=typeof t)?e:"number"===i?(t=[t,t,t,t],n):n,a},a.round=function(t){return arguments.length?(l=t?Math.round:Number,a):l!=Number},a.sticky=function(t){return arguments.length?(d=t,o=null,a):d},a.ratio=function(t){return arguments.length?(_=t,a):_},a.mode=function(t){return arguments.length?(f=t+"",a):f},ur(a,s)},fo.random={normal:function(t,e){var n=arguments.length;return n<2&&(e=1),n<1&&(t=0),function(){var n,i,r;do{n=2*Math.random()-1,i=2*Math.random()-1,r=n*n+i*i}while(!r||r>1);return t+e*n*Math.sqrt(-2*Math.log(r)/r)}},logNormal:function(){var t=fo.random.normal.apply(fo,arguments);return function(){return Math.exp(t())}},bates:function(t){var e=fo.random.irwinHall(t);return function(){return e()/t}},irwinHall:function(t){return function(){for(var e=0,n=0;n<t;n++)e+=Math.random();return e}}},fo.scale={};var Cl={floor:k,ceil:k};fo.scale.linear=function(){return ta([0,1],[0,1],Mi,!1)};var Sl={s:1,g:1,p:1,r:1,e:1};fo.scale.log=function(){return la(fo.scale.linear().domain([0,1]),10,!0,[1,10])};var Tl=fo.format(".0e"),Al={floor:function(t){return-Math.ceil(-t)},ceil:function(t){return-Math.floor(-t)}};fo.scale.pow=function(){return ua(fo.scale.linear(),1,[0,1])},fo.scale.sqrt=function(){return fo.scale.pow().exponent(.5)},fo.scale.ordinal=function(){return ha([],{t:"range",a:[[]]})},fo.scale.category10=function(){return fo.scale.ordinal().range(zl)},fo.scale.category20=function(){return fo.scale.ordinal().range(Nl)},fo.scale.category20b=function(){return fo.scale.ordinal().range(El)},fo.scale.category20c=function(){return fo.scale.ordinal().range(Rl)};var zl=[2062260,16744206,2924588,14034728,9725885,9197131,14907330,8355711,12369186,1556175].map(Mt),Nl=[2062260,11454440,16744206,16759672,2924588,10018698,14034728,16750742,9725885,12955861,9197131,12885140,14907330,16234194,8355711,13092807,12369186,14408589,1556175,10410725].map(Mt),El=[3750777,5395619,7040719,10264286,6519097,9216594,11915115,13556636,9202993,12426809,15186514,15190932,8666169,11356490,14049643,15177372,8077683,10834324,13528509,14589654].map(Mt),Rl=[3244733,7057110,10406625,13032431,15095053,16616764,16625259,16634018,3253076,7652470,10607003,13101504,7695281,10394312,12369372,14342891,6513507,9868950,12434877,14277081].map(Mt);fo.scale.quantile=function(){return da([],[])},fo.scale.quantize=function(){return fa(0,1,[0,1])},fo.scale.threshold=function(){return _a([.5],[0,1])},fo.scale.identity=function(){return pa([0,1])},fo.svg={},fo.svg.arc=function(){function t(){var t=Math.max(0,+n.apply(this,arguments)),u=Math.max(0,+i.apply(this,arguments)),c=o.apply(this,arguments)-Uo,h=s.apply(this,arguments)-Uo,d=Math.abs(h-c),f=c>h?0:1;if(u<t&&(_=u,u=t,t=_),d>=Ho)return e(u,f)+(t?e(t,1-f):"")+"Z";var _,p,v,g,m,y,w,b,x,k,M,C,S=0,T=0,A=[];if((g=(+l.apply(this,arguments)||0)/2)&&(v=a===Ol?Math.sqrt(t*t+u*u):+a.apply(this,arguments),f||(T*=-1),u&&(T=ot(v/u*Math.sin(g))),t&&(S=ot(v/t*Math.sin(g)))),u){m=u*Math.cos(c+T),y=u*Math.sin(c+T),w=u*Math.cos(h-T),b=u*Math.sin(h-T);var z=Math.abs(h-c-2*T)<=Go?0:1;if(T&&xa(m,y,w,b)===f^z){var N=(c+h)/2;m=u*Math.cos(N),y=u*Math.sin(N),w=b=null}}else m=y=0;if(t){x=t*Math.cos(h-S),k=t*Math.sin(h-S),M=t*Math.cos(c+S),C=t*Math.sin(c+S);var E=Math.abs(c-h+2*S)<=Go?0:1;if(S&&xa(x,k,M,C)===1-f^E){var R=(c+h)/2;x=t*Math.cos(R),k=t*Math.sin(R),M=C=null}}else x=k=0;if(d>Fo&&(_=Math.min(Math.abs(u-t)/2,+r.apply(this,arguments)))>.001){p=t<u^f?0:1;var O=_,D=_;if(d<Go){var P=null==M?[x,k]:null==w?[m,y]:In([m,y],[M,C],[w,b],[x,k]),j=m-P[0],$=y-P[1],q=w-P[0],I=b-P[1],F=1/Math.sin(Math.acos((j*q+$*I)/(Math.sqrt(j*j+$*$)*Math.sqrt(q*q+I*I)))/2),L=Math.sqrt(P[0]*P[0]+P[1]*P[1]);D=Math.min(_,(t-L)/(F-1)),O=Math.min(_,(u-L)/(F+1))}if(null!=w){var G=ka(null==M?[x,k]:[M,C],[m,y],u,O,f),V=ka([w,b],[x,k],u,O,f);_===O?A.push("M",G[0],"A",O,",",O," 0 0,",p," ",G[1],"A",u,",",u," 0 ",1-f^xa(G[1][0],G[1][1],V[1][0],V[1][1]),",",f," ",V[1],"A",O,",",O," 0 0,",p," ",V[0]):A.push("M",G[0],"A",O,",",O," 0 1,",p," ",V[0])}else A.push("M",m,",",y);if(null!=M){var H=ka([m,y],[M,C],t,-D,f),U=ka([x,k],null==w?[m,y]:[w,b],t,-D,f);_===D?A.push("L",U[0],"A",D,",",D," 0 0,",p," ",U[1],"A",t,",",t," 0 ",f^xa(U[1][0],U[1][1],H[1][0],H[1][1]),",",1-f," ",H[1],"A",D,",",D," 0 0,",p," ",H[0]):A.push("L",U[0],"A",D,",",D," 0 0,",p," ",H[0])}else A.push("L",x,",",k)}else A.push("M",m,",",y),null!=w&&A.push("A",u,",",u," 0 ",z,",",f," ",w,",",b),A.push("L",x,",",k),null!=M&&A.push("A",t,",",t," 0 ",E,",",1-f," ",M,",",C);return A.push("Z"),A.join("")}function e(t,e){return"M0,"+t+"A"+t+","+t+" 0 1,"+e+" 0,"+-t+"A"+t+","+t+" 0 1,"+e+" 0,"+t}var n=ga,i=ma,r=va,a=Ol,o=ya,s=wa,l=ba;return t.innerRadius=function(e){return arguments.length?(n=Et(e),t):n},t.outerRadius=function(e){return arguments.length?(i=Et(e),t):i},t.cornerRadius=function(e){return arguments.length?(r=Et(e),t):r},t.padRadius=function(e){return arguments.length?(a=e==Ol?Ol:Et(e),t):a},t.startAngle=function(e){return arguments.length?(o=Et(e),t):o},t.endAngle=function(e){return arguments.length?(s=Et(e),t):s},t.padAngle=function(e){return arguments.length?(l=Et(e),t):l},t.centroid=function(){var t=(+n.apply(this,arguments)+ +i.apply(this,arguments))/2,e=(+o.apply(this,arguments)+ +s.apply(this,arguments))/2-Uo;return[Math.cos(e)*t,Math.sin(e)*t]},t};var Ol="auto";fo.svg.line=function(){return Ma(k)};var Dl=fo.map({linear:Ca,"linear-closed":Sa,step:Ta,"step-before":Aa,"step-after":za,basis:Pa,"basis-open":ja,"basis-closed":$a,bundle:qa,cardinal:Ra,"cardinal-open":Na,"cardinal-closed":Ea,monotone:Ha});Dl.forEach(function(t,e){e.key=t,e.closed=/-closed$/.test(t)});var Pl=[0,2/3,1/3,0],jl=[0,1/3,2/3,0],$l=[0,1/6,2/3,1/6];fo.svg.line.radial=function(){var t=Ma(Ua);return t.radius=t.x,delete t.x,t.angle=t.y,delete t.y,t},Aa.reverse=za,za.reverse=Aa,fo.svg.area=function(){return Ba(k)},fo.svg.area.radial=function(){var t=Ba(Ua);return t.radius=t.x,delete t.x,t.innerRadius=t.x0,delete t.x0,t.outerRadius=t.x1,delete t.x1,t.angle=t.y,delete t.y,t.startAngle=t.y0,delete t.y0,t.endAngle=t.y1,delete t.y1,t},fo.svg.chord=function(){function t(t,s){var l=e(this,a,t,s),u=e(this,o,t,s);return"M"+l.p0+i(l.r,l.p1,l.a1-l.a0)+(n(l,u)?r(l.r,l.p1,l.r,l.p0):r(l.r,l.p1,u.r,u.p0)+i(u.r,u.p1,u.a1-u.a0)+r(u.r,u.p1,l.r,l.p0))+"Z"}function e(t,e,n,i){var r=e.call(t,n,i),a=s.call(t,r,i),o=l.call(t,r,i)-Uo,c=u.call(t,r,i)-Uo;return{r:a,a0:o,a1:c,p0:[a*Math.cos(o),a*Math.sin(o)],p1:[a*Math.cos(c),a*Math.sin(c)]}}function n(t,e){return t.a0==e.a0&&t.a1==e.a1}function i(t,e,n){return"A"+t+","+t+" 0 "+ +(n>Go)+",1 "+e}function r(t,e,n,i){return"Q 0,0 "+i}var a=Mn,o=Cn,s=Ya,l=ya,u=wa;return t.radius=function(e){return arguments.length?(s=Et(e),t):s},t.source=function(e){return arguments.length?(a=Et(e),t):a},t.target=function(e){return arguments.length?(o=Et(e),t):o},t.startAngle=function(e){return arguments.length?(l=Et(e),t):l},t.endAngle=function(e){return arguments.length?(u=Et(e),t):u},t},fo.svg.diagonal=function(){function t(t,r){var a=e.call(this,t,r),o=n.call(this,t,r),s=(a.y+o.y)/2,l=[a,{x:a.x,y:s},{x:o.x,y:s},o];return l=l.map(i),"M"+l[0]+"C"+l[1]+" "+l[2]+" "+l[3]}var e=Mn,n=Cn,i=Xa;return t.source=function(n){return arguments.length?(e=Et(n),t):e},t.target=function(e){return arguments.length?(n=Et(e),t):n},t.projection=function(e){return arguments.length?(i=e,t):i},t},fo.svg.diagonal.radial=function(){var t=fo.svg.diagonal(),e=Xa,n=t.projection;return t.projection=function(t){return arguments.length?n(Ja(e=t)):e},t},fo.svg.symbol=function(){function t(t,i){return(ql.get(e.call(this,t,i))||Qa)(n.call(this,t,i))}var e=Za,n=Wa;return t.type=function(n){return arguments.length?(e=Et(n),t):e},t.size=function(e){return arguments.length?(n=Et(e),t):n},t};var ql=fo.map({circle:Qa,cross:function(t){var e=Math.sqrt(t/5)/2;return"M"+-3*e+","+-e+"H"+-e+"V"+-3*e+"H"+e+"V"+-e+"H"+3*e+"V"+e+"H"+e+"V"+3*e+"H"+-e+"V"+e+"H"+-3*e+"Z"},diamond:function(t){var e=Math.sqrt(t/(2*Fl)),n=e*Fl;return"M0,"+-e+"L"+n+",0 0,"+e+" "+-n+",0Z"},square:function(t){var e=Math.sqrt(t)/2;return"M"+-e+","+-e+"L"+e+","+-e+" "+e+","+e+" "+-e+","+e+"Z"},"triangle-down":function(t){var e=Math.sqrt(t/Il),n=e*Il/2;return"M0,"+n+"L"+e+","+-n+" "+-e+","+-n+"Z"},"triangle-up":function(t){var e=Math.sqrt(t/Il),n=e*Il/2;return"M0,"+-n+"L"+e+","+n+" "+-e+","+n+"Z"}});fo.svg.symbolTypes=ql.keys();var Il=Math.sqrt(3),Fl=Math.tan(30*Bo);Ro.transition=function(t){for(var e,n,i=Ll||++Ul,r=io(t),a=[],o=Gl||{time:Date.now(),ease:Ei,delay:0,duration:250},s=-1,l=this.length;++s<l;){a.push(e=[]);for(var u=this[s],c=-1,h=u.length;++c<h;)(n=u[c])&&ro(n,c,r,i,o),e.push(n)}return to(a,r,i)},Ro.interrupt=function(t){return this.each(null==t?Vl:Ka(io(t)))};var Ll,Gl,Vl=Ka(io()),Hl=[],Ul=0;Hl.call=Ro.call,Hl.empty=Ro.empty,Hl.node=Ro.node,Hl.size=Ro.size,fo.transition=function(t,e){return t&&t.transition?Ll?t.transition(e):t:fo.selection().transition(t)},fo.transition.prototype=Hl,Hl.select=function(t){var e,n,i,r=this.id,a=this.namespace,o=[];t=O(t);for(var s=-1,l=this.length;++s<l;){o.push(e=[]);for(var u=this[s],c=-1,h=u.length;++c<h;)(i=u[c])&&(n=t.call(i,i.__data__,c,s))?("__data__"in i&&(n.__data__=i.__data__),ro(n,c,a,r,i[a][r]),e.push(n)):e.push(null)}return to(o,a,r)},Hl.selectAll=function(t){var e,n,i,r,a,o=this.id,s=this.namespace,l=[];t=D(t);for(var u=-1,c=this.length;++u<c;)for(var h=this[u],d=-1,f=h.length;++d<f;)if(i=h[d]){a=i[s][o],n=t.call(i,i.__data__,d,u),l.push(e=[]);for(var _=-1,p=n.length;++_<p;)(r=n[_])&&ro(r,_,s,o,a),e.push(r)}return to(l,s,o)},Hl.filter=function(t){var e,n,i,r=[];"function"!=typeof t&&(t=B(t));for(var a=0,o=this.length;a<o;a++){r.push(e=[]);for(var n=this[a],s=0,l=n.length;s<l;s++)(i=n[s])&&t.call(i,i.__data__,s,a)&&e.push(i)}return to(r,this.namespace,this.id)},Hl.tween=function(t,e){var n=this.id,i=this.namespace;return arguments.length<2?this.node()[i][n].tween.get(t):X(this,null==e?function(e){e[i][n].tween.remove(t)}:function(r){r[i][n].tween.set(t,e)})},Hl.attr=function(t,e){function n(){this.removeAttribute(s)}function i(){this.removeAttributeNS(s.space,s.local)}function r(t){return null==t?n:(t+="",function(){var e,n=this.getAttribute(s);return n!==t&&(e=o(n,t),function(t){this.setAttribute(s,e(t))})})}function a(t){return null==t?i:(t+="",function(){var e,n=this.getAttributeNS(s.space,s.local);return n!==t&&(e=o(n,t),function(t){this.setAttributeNS(s.space,s.local,e(t))})})}if(arguments.length<2){for(e in t)this.attr(e,t[e]);return this}var o="transform"==t?Qi:Mi,s=fo.ns.qualify(t);return eo(this,"attr."+t,e,s.local?a:r)},Hl.attrTween=function(t,e){function n(t,n){var i=e.call(this,t,n,this.getAttribute(r));return i&&function(t){this.setAttribute(r,i(t))}}function i(t,n){var i=e.call(this,t,n,this.getAttributeNS(r.space,r.local));return i&&function(t){this.setAttributeNS(r.space,r.local,i(t))}}var r=fo.ns.qualify(t);return this.tween("attr."+t,r.local?i:n)},Hl.style=function(t,e,n){function i(){this.style.removeProperty(t)}function r(e){return null==e?i:(e+="",function(){var i,r=o(this).getComputedStyle(this,null).getPropertyValue(t);return r!==e&&(i=Mi(r,e),function(e){this.style.setProperty(t,i(e),n)})})}var a=arguments.length;if(a<3){if("string"!=typeof t){a<2&&(e="");for(n in t)this.style(n,t[n],e);return this}n=""}return eo(this,"style."+t,e,r)},Hl.styleTween=function(t,e,n){function i(i,r){var a=e.call(this,i,r,o(this).getComputedStyle(this,null).getPropertyValue(t));return a&&function(e){this.style.setProperty(t,a(e),n)}}return arguments.length<3&&(n=""),this.tween("style."+t,i)},Hl.text=function(t){return eo(this,"text",t,no)},Hl.remove=function(){var t=this.namespace;return this.each("end.transition",function(){var e;this[t].count<2&&(e=this.parentNode)&&e.removeChild(this)})},Hl.ease=function(t){var e=this.id,n=this.namespace;return arguments.length<1?this.node()[n][e].ease:("function"!=typeof t&&(t=fo.ease.apply(fo,arguments)),X(this,function(i){i[n][e].ease=t}))},Hl.delay=function(t){var e=this.id,n=this.namespace;return arguments.length<1?this.node()[n][e].delay:X(this,"function"==typeof t?function(i,r,a){i[n][e].delay=+t.call(i,i.__data__,r,a)}:(t=+t,function(i){i[n][e].delay=t}))},Hl.duration=function(t){var e=this.id,n=this.namespace;return arguments.length<1?this.node()[n][e].duration:X(this,"function"==typeof t?function(i,r,a){i[n][e].duration=Math.max(1,t.call(i,i.__data__,r,a))}:(t=Math.max(1,t),function(i){i[n][e].duration=t}))},Hl.each=function(t,e){var n=this.id,i=this.namespace;if(arguments.length<2){var r=Gl,a=Ll;try{Ll=n,X(this,function(e,r,a){Gl=e[i][n],t.call(e,e.__data__,r,a)})}finally{Gl=r,Ll=a}}else X(this,function(r){var a=r[i][n];(a.event||(a.event=fo.dispatch("start","end","interrupt"))).on(t,e)});return this},Hl.transition=function(){for(var t,e,n,i,r=this.id,a=++Ul,o=this.namespace,s=[],l=0,u=this.length;l<u;l++){s.push(t=[]);for(var e=this[l],c=0,h=e.length;c<h;c++)(n=e[c])&&(i=n[o][r],ro(n,c,o,a,{time:i.time,ease:i.ease,delay:i.delay+i.duration,duration:i.duration})),t.push(n)}return to(s,o,a)},fo.svg.axis=function(){function t(t){t.each(function(){var t,u=fo.select(this),c=this.__chart__||n,h=this.__chart__=n.copy(),d=null==l?h.ticks?h.ticks.apply(h,s):h.domain():l,f=null==e?h.tickFormat?h.tickFormat.apply(h,s):k:e,_=u.selectAll(".tick").data(d,h),p=_.enter().insert("g",".domain").attr("class","tick").style("opacity",Fo),v=fo.transition(_.exit()).style("opacity",Fo).remove(),g=fo.transition(_.order()).style("opacity",1),m=Math.max(r,0)+o,y=Jr(h),w=u.selectAll(".domain").data([0]),b=(w.enter().append("path").attr("class","domain"),fo.transition(w));p.append("line"),p.append("text");var x,M,C,S,T=p.select("line"),A=g.select("line"),z=_.select("text").text(f),N=p.select("text"),E=g.select("text"),R="top"===i||"left"===i?-1:1;if("bottom"===i||"top"===i?(t=ao,x="x",C="y",M="x2",S="y2",z.attr("dy",R<0?"0em":".71em").style("text-anchor","middle"),b.attr("d","M"+y[0]+","+R*a+"V0H"+y[1]+"V"+R*a)):(t=oo,x="y",C="x",M="y2",S="x2",z.attr("dy",".32em").style("text-anchor",R<0?"end":"start"),b.attr("d","M"+R*a+","+y[0]+"H0V"+y[1]+"H"+R*a)),T.attr(S,R*r),N.attr(C,R*m),A.attr(M,0).attr(S,R*r),E.attr(x,0).attr(C,R*m),h.rangeBand){var O=h,D=O.rangeBand()/2;c=h=function(t){return O(t)+D}}else c.rangeBand?c=h:v.call(t,h,c);p.call(t,c,h),g.call(t,h,h)})}var e,n=fo.scale.linear(),i=Bl,r=6,a=6,o=3,s=[10],l=null;return t.scale=function(e){return arguments.length?(n=e,t):n},t.orient=function(e){return arguments.length?(i=e in Yl?e+"":Bl,t):i},t.ticks=function(){return arguments.length?(s=po(arguments),t):s},t.tickValues=function(e){return arguments.length?(l=e,t):l},t.tickFormat=function(n){return arguments.length?(e=n,t):e},t.tickSize=function(e){var n=arguments.length;return n?(r=+e,a=+arguments[n-1],t):r},t.innerTickSize=function(e){return arguments.length?(r=+e,t):r},t.outerTickSize=function(e){return arguments.length?(a=+e,t):a},t.tickPadding=function(e){return arguments.length?(o=+e,t):o},t.tickSubdivide=function(){return arguments.length&&t},t};var Bl="bottom",Yl={top:1,right:1,bottom:1,left:1};fo.svg.brush=function(){function t(a){a.each(function(){var a=fo.select(this).style("pointer-events","all").style("-webkit-tap-highlight-color","rgba(0,0,0,0)").on("mousedown.brush",r).on("touchstart.brush",r),o=a.selectAll(".background").data([0]);o.enter().append("rect").attr("class","background").style("visibility","hidden").style("cursor","crosshair"),a.selectAll(".extent").data([0]).enter().append("rect").attr("class","extent").style("cursor","move");var s=a.selectAll(".resize").data(p,k);s.exit().remove(),s.enter().append("g").attr("class",function(t){return"resize "+t}).style("cursor",function(t){return Xl[t]}).append("rect").attr("x",function(t){return/[ew]$/.test(t)?-3:null}).attr("y",function(t){return/^[ns]/.test(t)?-3:null}).attr("width",6).attr("height",6).style("visibility","hidden"),s.style("display",t.empty()?"none":null);var l,h=fo.transition(a),d=fo.transition(o);u&&(l=Jr(u),d.attr("x",l[0]).attr("width",l[1]-l[0]),n(h)),c&&(l=Jr(c),d.attr("y",l[0]).attr("height",l[1]-l[0]),i(h)),e(h)})}function e(t){t.selectAll(".resize").attr("transform",function(t){return"translate("+h[+/e$/.test(t)]+","+d[+/^s/.test(t)]+")"})}function n(t){t.select(".extent").attr("x",h[0]),t.selectAll(".extent,.n>rect,.s>rect").attr("width",h[1]-h[0])}function i(t){t.select(".extent").attr("y",d[0]),t.selectAll(".extent,.e>rect,.w>rect").attr("height",d[1]-d[0])}function r(){function r(){32==fo.event.keyCode&&(A||(y=null,E[0]-=h[1],E[1]-=d[1],A=2),z())}function p(){32==fo.event.keyCode&&2==A&&(E[0]+=h[1],E[1]+=d[1],A=0,z())}function v(){var t=fo.mouse(b),r=!1;w&&(t[0]+=w[0],t[1]+=w[1]),A||(fo.event.altKey?(y||(y=[(h[0]+h[1])/2,(d[0]+d[1])/2]),E[0]=h[+(t[0]<y[0])],E[1]=d[+(t[1]<y[1])]):y=null),S&&g(t,u,0)&&(n(M),r=!0),T&&g(t,c,1)&&(i(M),r=!0),r&&(e(M),k({type:"brush",mode:A?"move":"resize"}))}function g(t,e,n){var i,r,o=Jr(e),l=o[0],u=o[1],c=E[n],p=n?d:h,v=p[1]-p[0];if(A&&(l-=c,u-=v+c),i=(n?_:f)?Math.max(l,Math.min(u,t[n])):t[n],A?r=(i+=c)+v:(y&&(c=Math.max(l,Math.min(u,2*y[n]-i))),c<i?(r=i,i=c):r=c),p[0]!=i||p[1]!=r)return n?s=null:a=null,p[0]=i,p[1]=r,!0}function m(){v(),M.style("pointer-events","all").selectAll(".resize").style("display",t.empty()?"none":null),fo.select("body").style("cursor",null),R.on("mousemove.brush",null).on("mouseup.brush",null).on("touchmove.brush",null).on("touchend.brush",null).on("keydown.brush",null).on("keyup.brush",null),N(),k({type:"brushend"})}var y,w,b=this,x=fo.select(fo.event.target),k=l.of(b,arguments),M=fo.select(b),C=x.datum(),S=!/^(n|s)$/.test(C)&&u,T=!/^(e|w)$/.test(C)&&c,A=x.classed("extent"),N=tt(b),E=fo.mouse(b),R=fo.select(o(b)).on("keydown.brush",r).on("keyup.brush",p);if(fo.event.changedTouches?R.on("touchmove.brush",v).on("touchend.brush",m):R.on("mousemove.brush",v).on("mouseup.brush",m),M.interrupt().selectAll("*").interrupt(),A)E[0]=h[0]-E[0],E[1]=d[0]-E[1];else if(C){var O=+/w$/.test(C),D=+/^n/.test(C);w=[h[1-O]-E[0],d[1-D]-E[1]],E[0]=h[O],E[1]=d[D]}else fo.event.altKey&&(y=E.slice());M.style("pointer-events","none").selectAll(".resize").style("display",null),fo.select("body").style("cursor",x.style("cursor")),k({type:"brushstart"}),v()}var a,s,l=E(t,"brushstart","brush","brushend"),u=null,c=null,h=[0,0],d=[0,0],f=!0,_=!0,p=Jl[0];return t.event=function(t){t.each(function(){var t=l.of(this,arguments),e={x:h,y:d,i:a,j:s},n=this.__chart__||e;this.__chart__=e,Ll?fo.select(this).transition().each("start.brush",function(){a=n.i,s=n.j,h=n.x,d=n.y,t({type:"brushstart"})}).tween("brush:brush",function(){var n=Ci(h,e.x),i=Ci(d,e.y);return a=s=null,function(r){h=e.x=n(r),d=e.y=i(r),t({type:"brush",mode:"resize"})}}).each("end.brush",function(){a=e.i,s=e.j,t({type:"brush",mode:"resize"}),t({type:"brushend"})}):(t({type:"brushstart"}),t({type:"brush",mode:"resize"}),t({type:"brushend"}))})},t.x=function(e){return arguments.length?(u=e,p=Jl[!u<<1|!c],t):u},t.y=function(e){return arguments.length?(c=e,p=Jl[!u<<1|!c],t):c},t.clamp=function(e){return arguments.length?(u&&c?(f=!!e[0],_=!!e[1]):u?f=!!e:c&&(_=!!e),t):u&&c?[f,_]:u?f:c?_:null},t.extent=function(e){var n,i,r,o,l;return arguments.length?(u&&(n=e[0],i=e[1],c&&(n=n[0],i=i[0]),a=[n,i],u.invert&&(n=u(n),i=u(i)),i<n&&(l=n,n=i,i=l),n==h[0]&&i==h[1]||(h=[n,i])),c&&(r=e[0],o=e[1],u&&(r=r[1],o=o[1]),s=[r,o],c.invert&&(r=c(r),o=c(o)),o<r&&(l=r,r=o,o=l),r==d[0]&&o==d[1]||(d=[r,o])),t):(u&&(a?(n=a[0],i=a[1]):(n=h[0],i=h[1],u.invert&&(n=u.invert(n),i=u.invert(i)),i<n&&(l=n,n=i,i=l))),c&&(s?(r=s[0],o=s[1]):(r=d[0],o=d[1],c.invert&&(r=c.invert(r),o=c.invert(o)),o<r&&(l=r,r=o,o=l))),u&&c?[[n,r],[i,o]]:u?[n,i]:c&&[r,o])},t.clear=function(){return t.empty()||(h=[0,0],d=[0,0],a=s=null),t},t.empty=function(){return!!u&&h[0]==h[1]||!!c&&d[0]==d[1]},fo.rebind(t,l,"on")};var Xl={n:"ns-resize",e:"ew-resize",s:"ns-resize",w:"ew-resize",nw:"nwse-resize",ne:"nesw-resize",se:"nwse-resize",sw:"nesw-resize"},Jl=[["n","e","s","w","nw","ne","se","sw"],["e","w"],["n","s"],[]],Wl=ps.format=bs.timeFormat,Zl=Wl.utc,Ql=Zl("%Y-%m-%dT%H:%M:%S.%LZ");Wl.iso=Date.prototype.toISOString&&+new Date("2000-01-01T00:00:00.000Z")?so:Ql,so.parse=function(t){var e=new Date(t);return isNaN(e)?null:e},so.toString=Ql.toString,ps.second=Ut(function(t){return new vs(1e3*Math.floor(t/1e3))},function(t,e){t.setTime(t.getTime()+1e3*Math.floor(e))},function(t){return t.getSeconds()}),ps.seconds=ps.second.range,ps.seconds.utc=ps.second.utc.range,ps.minute=Ut(function(t){return new vs(6e4*Math.floor(t/6e4))},function(t,e){t.setTime(t.getTime()+6e4*Math.floor(e))},function(t){return t.getMinutes()}),ps.minutes=ps.minute.range,ps.minutes.utc=ps.minute.utc.range,ps.hour=Ut(function(t){var e=t.getTimezoneOffset()/60;return new vs(36e5*(Math.floor(t/36e5-e)+e))},function(t,e){t.setTime(t.getTime()+36e5*Math.floor(e))},function(t){return t.getHours()}),ps.hours=ps.hour.range,ps.hours.utc=ps.hour.utc.range,ps.month=Ut(function(t){return t=ps.day(t),t.setDate(1),t},function(t,e){t.setMonth(t.getMonth()+e)},function(t){return t.getMonth()}),ps.months=ps.month.range,ps.months.utc=ps.month.utc.range;var Kl=[1e3,5e3,15e3,3e4,6e4,3e5,9e5,18e5,36e5,108e5,216e5,432e5,864e5,1728e5,6048e5,2592e6,7776e6,31536e6],tu=[[ps.second,1],[ps.second,5],[ps.second,15],[ps.second,30],[ps.minute,1],[ps.minute,5],[ps.minute,15],[ps.minute,30],[ps.hour,1],[ps.hour,3],[ps.hour,6],[ps.hour,12],[ps.day,1],[ps.day,2],[ps.week,1],[ps.month,1],[ps.month,3],[ps.year,1]],eu=Wl.multi([[".%L",function(t){return t.getMilliseconds()}],[":%S",function(t){return t.getSeconds()}],["%I:%M",function(t){return t.getMinutes()}],["%I %p",function(t){return t.getHours()}],["%a %d",function(t){return t.getDay()&&1!=t.getDate()}],["%b %d",function(t){return 1!=t.getDate()}],["%B",function(t){return t.getMonth()}],["%Y",De]]),nu={range:function(t,e,n){return fo.range(Math.ceil(t/n)*n,+e,n).map(uo)},floor:k,ceil:k};tu.year=ps.year,ps.scale=function(){return lo(fo.scale.linear(),tu,eu)};var iu=tu.map(function(t){return[t[0].utc,t[1]]}),ru=Zl.multi([[".%L",function(t){return t.getUTCMilliseconds()}],[":%S",function(t){return t.getUTCSeconds()}],["%I:%M",function(t){return t.getUTCMinutes()}],["%I %p",function(t){return t.getUTCHours()}],["%a %d",function(t){return t.getUTCDay()&&1!=t.getUTCDate()}],["%b %d",function(t){return 1!=t.getUTCDate()}],["%B",function(t){return t.getUTCMonth()}],["%Y",De]]);iu.year=ps.year.utc,ps.scale.utc=function(){return lo(fo.scale.linear(),iu,ru)},fo.text=Rt(function(t){return t.responseText}),fo.json=function(t,e){return Ot(t,"application/json",co,e)},fo.html=function(t,e){return Ot(t,"text/html",ho,e)},fo.xml=Rt(function(t){return t.responseXML}),this.d3=fo,i=fo,void 0!==(r="function"==typeof i?i.call(e,n,e,t):i)&&(t.exports=r)}()},29:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(1),r=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(i),a=r.extend,o=function(t,e){this.slot=t,this.feature=e},s=function(t,e,n,i){this.slots={},this.start_end_dct={},this.w_scale=t,this.mode=e,this.include_label="Pack"===e,this.max_rows=n,this.measureText=i};a(s.prototype,{_get_draw_coords:function(t){var e=Math.floor(t[1]*this.w_scale),n=Math.ceil(t[2]*this.w_scale),i=t[3];if(void 0!==i&&this.include_label){var r=this.measureText(i).width+7;e-r>=0?(e-=r,"left"):(n+=r,"right")}return[e,n]},_find_slot:function(t){for(var e=t[0],n=t[1],i=0;i<=this.max_rows;i++){var r=!1,a=this.start_end_dct[i];if(void 0!==a)for(var o=0,s=a.length;o<s;o++){var l=a[o];if(n>l[0]&&e<l[1]){r=!0;break}}if(!r)return i}return-1},slot_features:function(t){for(var e,n,i=this.start_end_dct,r=[],a=0,s=0,l=t.length;s<l;s++){e=t[s],n=e[0];var u=this.slots[n];if(u){if(e[1]<u.feature[1]||u.feature[2]<e[2])for(var c=this._get_draw_coords(u.feature),h=this._get_draw_coords(e),d=this.start_end_dct[u.slot],f=0;f<d.length;f++){var _=d[f];_[0]===c[0]&&_[1]===c[1]&&(d[f]=h)}a=Math.max(a,this.slots[n].slot)}else r.push(s)}for(var s=0,l=r.length;s<l;s++){e=t[r[s]],n=e[0];var p=this._get_draw_coords(e),v=this._find_slot(p);v>=0&&(void 0===i[v]&&(i[v]=[]),i[v].push(p),this.slots[n]=new o(v,e),a=Math.max(a,v))}return a+1}}),e.default={FeatureSlotter:s}},30:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(1),r=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(i),a=function(t,e){var n=t[0],i=t[1],r=e[0],a=e[1];return n<r?i<=r?1001:i<=a?1003:1002:n>a?1006:i<=a?1005:1004},o=function(t,e){var n=a(t,e);return 1001!==n&&1006!==n},s=function(t,e,n,i,r,a){void 0===a&&(a=4);var o,s=i-e,l=r-n,u=Math.floor(Math.sqrt(s*s+l*l)/a),c=s/u,h=l/u;for(o=0;o<u;o++,e+=c,n+=h)o%2==0&&t.fillRect(e,n,a,1)},l=function(t,e,n,i){var r=e-i/2,a=e+i/2,o=n-Math.sqrt(3*i/2);t.beginPath(),t.moveTo(r,o),t.lineTo(a,o),t.lineTo(e,n),t.lineTo(r,o),t.strokeStyle=this.fillStyle,t.fill(),t.stroke(),t.closePath()},u=function(t){this.default_val=t||1};u.prototype.gen_val=function(t){return this.default_val};var c=function(t){this.incomplete_features=t.incomplete_features,this.feature_mapper=t.feature_mapper},h=function(t,e,n,i,a){this.data=t,this.view_start=e,this.view_end=n,this.prefs=r.extend({},this.default_prefs,i),this.mode=a};h.prototype.default_prefs={},h.prototype.draw=function(t,e,n,i){},h.prototype.get_start_draw_pos=function(t,e){return this._chrom_pos_to_draw_pos(t,e,-.5)},h.prototype.get_end_draw_pos=function(t,e){return this._chrom_pos_to_draw_pos(t,e,.5)},h.prototype.get_draw_pos=function(t,e){return this._chrom_pos_to_draw_pos(t,e,0)},h.prototype._chrom_pos_to_draw_pos=function(t,e,n){return Math.floor(e*(Math.max(0,t-this.view_start)+n))};var d=function(t,e,n,i,r){h.call(this,t,e,n,i,r)};d.prototype.default_prefs={min_value:void 0,max_value:void 0,mode:"Histogram",color:"#000",overflow_color:"#F66"},d.prototype.draw=function(t,e,n,i){var a=!1,o=this.prefs.min_value,s=this.prefs.max_value,l=s-o,u=n,c=this.view_start,h=this.mode,d=this.data;t.save();var f=Math.round(n+o/l*n);"Intensity"!==h&&(t.fillStyle="#aaa",t.fillRect(0,f,e,1)),t.beginPath();var _,p,v;v=d.length>1?r.map(d.slice(0,-1),function(t,e){return Math.ceil((d[e+1][0]-d[e][0])*i)}):[10];for(var g,m=this.prefs.block_color||this.prefs.color,y=parseInt(m.slice(1),16),w=(16711680&y)>>16,b=(65280&y)>>8,x=255&y,k=!1,M=!1,C=0,S=d.length;C<S;C++)if(t.fillStyle=t.strokeStyle=m,k=M=!1,g=v[C],_=Math.floor((d[C][0]-c-.5)*i),null!==(p=d[C][1])){if(p<o?(M=!0,p=o):p>s&&(k=!0,p=s),"Histogram"===h)p=Math.round(p/l*u),t.fillRect(_,f,g,-p);else if("Intensity"===h){var T=(p-o)/l,A=Math.round(w+(255-w)*(1-T)),z=Math.round(b+(255-b)*(1-T)),N=Math.round(x+(255-x)*(1-T));t.fillStyle="rgb("+A+","+z+","+N+")",t.fillRect(_,0,g,u)}else p=Math.round(u-(p-o)/l*u),a?t.lineTo(_,p):(a=!0,"Filled"===h?(t.moveTo(_,u),t.lineTo(_,p)):t.moveTo(_,p));if(t.fillStyle=this.prefs.overflow_color,k||M){var E;"Histogram"===h||"Intensity"===h?E=g:(_-=2,E=4),k&&t.fillRect(_,0,E,3),M&&t.fillRect(_,u-3,E,3)}t.fillStyle=m}else a&&"Filled"===h&&t.lineTo(_,u),a=!1;"Filled"===h?(a&&(t.lineTo(_,f),t.lineTo(0,f)),t.fill()):t.stroke(),t.restore()};var f=function(t){this.feature_positions={},this.slot_height=t,this.translation=0,this.y_translation=0};f.prototype.map_feature_data=function(t,e,n,i){this.feature_positions[e]||(this.feature_positions[e]=[]),this.feature_positions[e].push({data:t,x_start:n,x_end:i})},f.prototype.get_feature_data=function(t,e){var n,i=Math.floor((e-this.y_translation)/this.slot_height);if(!this.feature_positions[i])return null;t+=this.translation;for(var r=0;r<this.feature_positions[i].length;r++)if(n=this.feature_positions[i][r],t>=n.x_start&&t<=n.x_end)return n.data};var _=function(t,e,n,i,r,a,o){h.call(this,t,e,n,i,r),this.alpha_scaler=a||new u,this.height_scaler=o||new u,this.max_label_length=200};_.prototype.default_prefs={block_color:"#FFF",connector_color:"#FFF"},r.extend(_.prototype,{get_required_height:function(t,e){var n=this.get_row_height(),i=n,r=this.mode;return"no_detail"!==r&&"Squish"!==r&&"Pack"!==r||(n=t*i),n+this.get_top_padding(e)},get_top_padding:function(t){return 0},draw:function(t,e,n,i,r){var a=this.data,o=this.view_start,s=this.view_end;t.save(),t.fillStyle=this.prefs.block_color,t.textAlign="right";for(var l,u=this.get_row_height(),h=new f(u),d=[],_=0,p=a.length;_<p;_++){var v=a[_],g=v[0],m=v[1],y=v[2],w=r&&void 0!==r[g]?r[g].slot:null;("Dense"===this.mode||null!==w)&&m<s&&y>o&&(l=this.draw_element(t,this.mode,v,w,o,s,i,u,e),h.map_feature_data(v,w,l[0],l[1]),(m<o||y>s)&&d.push(v))}return t.restore(),h.y_translation=this.get_top_padding(e),new c({incomplete_features:d,feature_mapper:h})},draw_element:function(t,e,n,i,r,a,o,s,l){return[0,0]}});var p=function(t,e,n,i,r,a,o){_.call(this,t,e,n,i,r,a,o),this.draw_background_connector=!0,this.draw_individual_connectors=!1};r.extend(p.prototype,_.prototype,{get_row_height:function(){var t=this.mode;return"Dense"===t?10:"no_detail"===t?3:"Squish"===t?5:10},draw_element:function(t,e,n,i,r,a,o,s,l){var u,c=(n[0],n[1]),h=n[2],d=n[3],f=n[4],_=Math.floor(Math.max(0,(c-r-.5)*o)),p=Math.ceil(Math.min(l,Math.max(0,(h-r-.5)*o))),v=_,g=p,u=("Dense"===e?0:0+i)*s+this.get_top_padding(l),m=null,y=null,w=f&&"+"!==f&&"."!==f?this.prefs.reverse_strand_color:this.prefs.block_color,b=this.prefs.label_color;if(t.globalAlpha=this.alpha_scaler.gen_val(n),"Dense"===e&&(i=1),"no_detail"===e)t.fillStyle=w,t.fillRect(_,u+5,p-_,1);else{var x=n[5],k=n[6],M=n[7],C=!0;x&&k&&(m=Math.floor(Math.max(0,(x-r)*o)),y=Math.ceil(Math.min(l,Math.max(0,(k-r)*o))));var S,T;if("Squish"===e?(S=1,T=3,C=!1):(S=5,T=9),M){var A,z;"Squish"===e||"Dense"===e?(A=u+Math.floor(1.5)+1,z=1):f?(A=u,z=T):(A+=2.5,z=1),this.draw_background_connector&&("Squish"===e||"Dense"===e?t.fillStyle="#ccc":f?"+"===f?t.fillStyle=t.canvas.manager.get_pattern("right_strand"):"-"===f&&(t.fillStyle=t.canvas.manager.get_pattern("left_strand")):t.fillStyle="#ccc",t.fillRect(_,A,p-_,z));for(var N=0,E=M.length;N<E;N++){var R,O,D=M[N],P=Math.floor(Math.max(0,(D[0]-r-.5)*o)),j=Math.ceil(Math.min(l,Math.max((D[1]-r-.5)*o)));if(!(P>j)){if(t.fillStyle=w,t.fillRect(P,u+(T-S)/2+1,j-P,S),void 0!==m&&k>x&&!(P>y||j<m)){var $=Math.max(P,m),q=Math.min(j,y);t.fillRect($,u+1,q-$,T),1===M.length&&"Pack"===e&&("+"===f?t.fillStyle=t.canvas.manager.get_pattern("right_strand_inv"):"-"===f&&(t.fillStyle=t.canvas.manager.get_pattern("left_strand_inv")),$+14<q&&($+=2,q-=2),t.fillRect($,u+1,q-$,T))}this.draw_individual_connectors&&R&&this.draw_connector(t,R,O,P,j,u),R=P,O=j}}if("Pack"===e){t.globalAlpha=1,t.fillStyle="white";var I=this.height_scaler.gen_val(n),F=Math.ceil(T*I),L=Math.round((T-F)/2);1!==I&&(t.fillRect(_,A+1,p-_,L),t.fillRect(_,A+T-L+1,p-_,L))}}else t.fillStyle=w,t.fillRect(_,u+1,p-_,T),f&&C&&("+"===f?t.fillStyle=t.canvas.manager.get_pattern("right_strand_inv"):"-"===f&&(t.fillStyle=t.canvas.manager.get_pattern("left_strand_inv")),t.fillRect(_,u+1,p-_,T));t.globalAlpha=1,d&&"Pack"===e&&c>r&&(t.fillStyle=b,0===r&&_-t.measureText(d).width<0?(t.textAlign="left",t.fillText(d,p+2,u+8,this.max_label_length),g+=t.measureText(d).width+2):(t.textAlign="right",t.fillText(d,_-2,u+8,this.max_label_length),v-=t.measureText(d).width+2))}return t.globalAlpha=1,[v,g]}});var v=function(t,e,n,i,r,a,o,s,l){_.call(this,t,e,n,i,r,a,o),this.ref_seq=s?s.data:null,this.base_color_fn=l};r.extend(v.prototype,_.prototype,{get_row_height:function(){var t,e=this.mode;return"Dense"===e?t=10:"Squish"===e?t=5:(t=10,this.prefs.show_insertions&&(t*=2)),t},_parse_cigar:function(t){var e="MIDNSHP=X",n=[[0,0]],i=n[0],a=0,o=r.map(t.match(/[0-9]+[MIDNSHP=X]/g),function(t){var r=parseInt(t.slice(0,-1),10),o=t.slice(-1);return"N"===o?0!==i[1]&&(i=[a+r,a+r],n.push(i)):-1==="ISHP".indexOf(o)&&(i[1]+=r,a+=r),[e.indexOf(o),r]});return{blocks:n,cigar:o}},draw_read:function(t,e,n,i,r,s,u,c,h,d){var f=function(t){return Math.floor(Math.max(0,(t-r-.5)*n))};t.textAlign="center";var _,p,v=[r,s],g=0,m=0,y=Math.round(n/2),w=t.canvas.manager.char_width_px,b="+"===h?this.prefs.detail_block_color:this.prefs.reverse_strand_color,k="Pack"===e,M=k?9:3,C=i+1,S=new x(t,M,n,e),T=[],A=[],z=this._parse_cigar(c);c=z.cigar,T=z.blocks;for(var N=0;N<T.length;N++){var E=T[N];o([u+E[0],u+E[1]],v)&&(_=f(u+E[0]),p=f(u+E[1]),_===p&&(p+=1),t.fillStyle=b,t.fillRect(_,C,p-_,M))}for(var R=0,O=c.length;R<O;R++){var D=c[R],P="MIDNSHP=X"[D[0]],j=D[1],$=u+g;if(_=f($),p=f($+j),o([$,$+j],v))switch(_===p&&(p+=1),P){case"H":case"S":case"P":break;case"M":g+=j;break;case"=":case"X":var q="";"X"===P?q=d.slice(m,m+j):this.ref_seq&&(q=this.ref_seq.slice(Math.max(0,$-r),Math.min($-r+j,s-r)));for(var I=Math.max($,r),F=0;F<q.length;F++)if(q&&!this.prefs.show_differences||"X"===P){var L=Math.floor(Math.max(0,(I+F-r)*n));t.fillStyle=this.base_color_fn(q[F]),k&&n>w?t.fillText(q[F],L,i+9):n>.05&&t.fillRect(L-y,C,Math.max(1,Math.round(n)),M)}"X"===P&&(m+=j),g+=j;break;case"N":t.fillStyle="#ccc",t.fillRect(_,C+(M-1)/2,p-_,1),g+=j;break;case"D":S.draw_deletion(_,C,j),g+=j;break;case"I":var G=_-y;if(o([$,$+j],v)){var V=d.slice(m,m+j);if(this.prefs.show_insertions){var H=_-(p-_)/2;if(("Pack"===e||"Auto"===this.mode)&&void 0!==d&&n>w){switch(t.fillStyle="yellow",t.fillRect(H-y,i-9,p-_,9),A[A.length]={type:"triangle",data:[G,i+4,5]},t.fillStyle="#ccc",a([$,$+j],v)){case 1003:V=V.slice(r-$);break;case 1004:V=V.slice(0,$-s);break;case 1005:break;case 1002:V=V.slice(r-$,$-s)}for(var F=0,U=V.length;F<U;F++){var L=Math.floor(Math.max(0,($+F-r)*n));t.fillText(V[F],L-(p-_)/2,i)}}else t.fillStyle="yellow",t.fillRect(H,i+("Dense"!==this.mode?2:5),p-_,"Dense"!==e?3:9)}else("Pack"===e||"Auto"===this.mode)&&void 0!==d&&n>w&&A.push({type:"text",data:[V.length,G,i+9]})}m+=j}else g=function(t,e,n){return-1!=="M=NXD".indexOf(e)&&(t+=n),t}(g,P,j),m=function(t,e,n){return-1!=="IX".indexOf(e)&&(t+=n),t}(m,P,j)}t.fillStyle="yellow";for(var B,Y,X,N=0;N<A.length;N++)B=A[N],Y=B.type,X=B.data,"text"===Y?(t.save(),t.font="bold "+t.font,t.fillText(X[0],X[1],X[2]),t.restore()):"triangle"===Y&&l(t,X[0],X[1],X[2])},draw_element:function(t,e,n,i,r,a,o,l,u){var c=(n[0],n[1]),h=n[2],d=n[3],f=Math.floor(Math.max(-.5*o,(c-r-.5)*o)),_=Math.ceil(Math.min(u,Math.max(0,(h-r-.5)*o))),p=("Dense"===e?0:0+i)*l,v="Pack"===e?9:3;this.prefs.label_color;if(n[5]instanceof Array){var g=!0;n[4][1]>=r&&n[4][0]<=a&&n[4][2]?this.draw_read(t,e,o,p,r,a,n[4][0],n[4][2],n[4][3],n[4][4]):g=!1,n[5][1]>=r&&n[5][0]<=a&&n[5][2]?this.draw_read(t,e,o,p,r,a,n[5][0],n[5][2],n[5][3],n[5][4]):g=!1;var m=Math.ceil(Math.min(u,Math.max(-.5*o,(n[4][1]-r-.5)*o))),y=Math.floor(Math.max(-.5*o,(n[5][0]-r-.5)*o));if(g&&y>m){t.fillStyle="#ccc";var w=p+1+(v-1)/2;s(t,m,w,y,w)}}else this.draw_read(t,e,o,p,r,a,c,n[4],n[5],n[6]);return"Pack"===e&&c>=r&&"."!==d&&(t.fillStyle=this.prefs.label_color,0===r&&f-t.measureText(d).width<0?(t.textAlign="left",t.fillText(d,_+2,p+9,this.max_label_length)):(t.textAlign="right",t.fillText(d,f-2,p+9,this.max_label_length))),[0,0]}});var g=function(t,e,n,i,r,a,o){p.call(this,t,e,n,i,r,a,o),this.longest_feature_length=this.calculate_longest_feature_length(),this.draw_background_connector=!1,this.draw_individual_connectors=!0};r.extend(g.prototype,_.prototype,p.prototype,{calculate_longest_feature_length:function(){for(var t=0,e=0,n=this.data.length;e<n;e++){var i=this.data[e],r=i[1],a=i[2];t=Math.max(t,a-r)}return t},get_top_padding:function(t){var e=this.view_end-this.view_start,n=t/e;return Math.min(128,Math.ceil(this.longest_feature_length/2*n))},draw_connector:function(t,e,n,i,r,a){var o=(n+i)/2,s=i-o;Math.PI;s>0&&(t.beginPath(),t.arc(o,a,i-o,Math.PI,0),t.stroke())}});var m=function(t,e){Array.isArray(t)?this.rgb=t:6==t.length?this.rgb=t.match(/.{2}/g).map(function(t){return parseInt(t,16)}):7==t.length?this.rgb=t.substring(1,7).match(/.{2}/g).map(function(t){return parseInt(t,16)}):this.rgb=t.split("").map(function(t){return parseInt(t+t,16)}),this.alpha="number"==typeof e?e:1};m.prototype={eval:function(){return this},toCSS:function(){return this.alpha<1?"rgba("+this.rgb.map(function(t){return Math.round(t)}).concat(this.alpha).join(", ")+")":"#"+this.rgb.map(function(t){return t=Math.round(t),t=(t>255?255:t<0?0:t).toString(16),1===t.length?"0"+t:t}).join("")},toHSL:function(){var t,e,n=this.rgb[0]/255,i=this.rgb[1]/255,r=this.rgb[2]/255,a=this.alpha,o=Math.max(n,i,r),s=Math.min(n,i,r),l=(o+s)/2,u=o-s;if(o===s)t=e=0;else{switch(e=l>.5?u/(2-o-s):u/(o+s),o){case n:t=(i-r)/u+(i<r?6:0);break;case i:t=(r-n)/u+2;break;case r:t=(n-i)/u+4}t/=6}return{h:360*t,s:e,l:l,a:a}},toARGB:function(){return"#"+[Math.round(255*this.alpha)].concat(this.rgb).map(function(t){return t=Math.round(t),t=(t>255?255:t<0?0:t).toString(16),1===t.length?"0"+t:t}).join("")},mix:function(t,e){var n=this,i=e,r=2*i-1,a=n.toHSL().a-t.toHSL().a,o=((r*a==-1?r:(r+a)/(1+r*a))+1)/2,s=1-o,l=[n.rgb[0]*o+t.rgb[0]*s,n.rgb[1]*o+t.rgb[1]*s,n.rgb[2]*o+t.rgb[2]*s],u=n.alpha*i+t.alpha*(1-i);return new m(l,u)}};var y=function(t,e,n,i){this.start_color=new m(t),this.end_color=new m(e),this.start_value=n,this.end_value=i,this.value_range=i-n};y.prototype.map_value=function(t){return t=Math.max(t,this.start_value),t=Math.min(t,this.end_value),t=(t-this.start_value)/this.value_range,this.start_color.mix(this.end_color,1-t).toCSS()};var w=function(t,e,n,i,r){this.positive_ramp=new y(e,n,0,r),this.negative_ramp=new y(e,t,0,-i),this.start_value=i,this.end_value=r};w.prototype.map_value=function(t){return t=Math.max(t,this.start_value),t=Math.min(t,this.end_value),t>=0?this.positive_ramp.map_value(t):this.negative_ramp.map_value(-t)};var b=function(t,e,n,i,r){h.call(this,t,e,n,i,r);var a,o;if(void 0===this.prefs.min_value){var s=1/0;for(a=0,o=this.data.length;a<o;a++)s=Math.min(s,this.data[a][6]);this.prefs.min_value=s}if(void 0===this.prefs.max_value){var l=-1/0;for(a=0,o=this.data.length;a<o;a++)l=Math.max(l,this.data[a][6]);this.prefs.max_value=l}};b.prototype.default_prefs={min_value:void 0,max_value:void 0,mode:"Heatmap",pos_color:"#FF8C00",neg_color:"#4169E1"},b.prototype.draw=function(t,e,n,i){var r,a,o,s,l,u,c=this.prefs.min_value,h=this.prefs.max_value,d=this.view_start,f=(this.mode,this.data),_=1/Math.sqrt(2),p=new w(this.prefs.neg_color,"#FFFFFF",this.prefs.pos_color,c,h),v=function(t){return(t-d)*i};t.save(),t.rotate(-45*Math.PI/180),t.scale(_,_);for(var g=0,m=f.length;g<m;g++)r=f[g],a=v(r[1]),o=v(r[2]),s=v(r[4]),l=v(r[5]),u=r[6],t.fillStyle=p.map_value(u),t.fillRect(a,s,o-a,l-s);t.restore()};var x=function(t,e,n,i){this.ctx=t,this.row_height=e,this.px_per_base=n,this.draw_details=("Pack"===i||"Auto"===i)&&n>=t.canvas.manager.char_width_px,this.delete_details_thickness=.2};r.extend(x.prototype,{draw_deletion:function(t,e,n){this.ctx.fillStyle="black";var i=(this.draw_details?this.delete_details_thickness:1)*this.row_height;e+=.5*(this.row_height-i),this.ctx.fillRect(t,e,n*this.px_per_base,i)}});var k=function(t,e,n,i,r,a){h.call(this,t,e,n,i,r),this.base_color_fn=a,this.divider_height=1};r.extend(k.prototype,h.prototype,{get_row_height:function(){var t=this.mode;return"Dense"===t?10:"Squish"===t?5:10},get_required_height:function(t){var e=this.prefs.summary_height;return t>1&&this.prefs.show_sample_data&&(e+=this.divider_height+t*this.get_row_height()),e},draw:function(t,e,n,i){t.save();var a,o,s,l,u,c,h,d,f,_,p,v=function(t,e){var n=t.length,i=e.length,r=0,a=1,o=null;return"-"===e?(o="deletion",a=t.length):0===t.indexOf(e)&&n>i?(o="deletion",a=n-i,r=i):0===e.indexOf(t)&&n<i&&(o="insertion",a=i-n,r=i),null!==o?{type:o,start:r,len:a}:{}},g=Math.max(1,Math.floor(i)),m=this.data.length?this.data[0][7].split(",").length:0,y="Squish"===this.mode?5:10,w=i<.1?y:"Squish"===this.mode?3:9,b=!0,k=new x(t,y,i,this.mode);1===m&&(y=w=i<t.canvas.manager.char_width_px?this.prefs.summary_height:y,k.row_height=y,b=!1),this.prefs.show_sample_data&&b&&(t.fillStyle="#F3F3F3",t.globalAlpha=1,t.fillRect(0,this.prefs.summary_height-this.divider_height,e,this.divider_height)),t.textAlign="center";for(var M=0;M<this.data.length;M++)if(a=this.data[M],o=a[1],s=a[3],l=[a[4].split(",")],u=a[7].split(","),c=a.slice(8),l=r.map(r.flatten(l),function(t){var e={type:"snp",value:t,start:0},n=v(s,t);return r.extend(e,n)}),!(o<this.view_start||o>this.view_end)){if(b)for(t.fillStyle="#999999",t.globalAlpha=1,p=0;p<l.length;p++)for(d=this.get_start_draw_pos(o+l[p].start,i),t.fillRect(d,0,g,this.prefs.summary_height),f=this.prefs.summary_height,p=0;p<l.length;p++){t.fillStyle="deletion"===l[p].type?"black":this.base_color_fn(l[p].value);var C=c/u.length,S=Math.ceil(this.prefs.summary_height*C);t.fillRect(d,f-S,g,S),f-=S}if(this.prefs.show_sample_data)for(f=b?this.prefs.summary_height+this.divider_height:0,p=0;p<u.length;p++,f+=y)if(_=u[p]?u[p].split(/\/|\|/):["0","0"],h=null,_[0]===_[1]?"."===_[0]||"0"!==_[0]&&(h=l[parseInt(_[0],10)-1],t.globalAlpha=1):(h="0"!==_[0]?_[0]:_[1],h=l[parseInt(h,10)-1],t.globalAlpha=.5),h)if(d=this.get_start_draw_pos(o+h.start,i),"snp"===h.type){var T=h.value;t.fillStyle=this.base_color_fn(T),k.draw_details?t.fillText(T,this.get_draw_pos(o,i),f+y):t.fillRect(d,f+1,g,w)}else"deletion"===h.type&&k.draw_deletion(d,f+1,h.len)}t.restore()}}),e.default={Scaler:u,LinePainter:d,LinkedFeaturePainter:p,ReadPainter:v,ArcLinkedFeaturePainter:g,DiagonalHeatmapPainter:b,VariantPainter:k}},31:function(t,e,n){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0});var i=n(1),r=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(i),a=r.extend,o=function(t){this.manager=null,this.name=t.name,this.index=t.index,this.tool_id=t.tool_id,this.tool_exp_name=t.tool_exp_name};a(o.prototype,{to_dict:function(){return{name:this.name,index:this.index,tool_id:this.tool_id,tool_exp_name:this.tool_exp_name}}});var s=function(e,n,i){return t("<a/>").attr("href","javascript:void(0);").attr("title",e).addClass("icon-button").addClass(n).tooltip().click(i)},l=function(e){o.call(this,e),this.low="low"in e?e.low:-Number.MAX_VALUE,this.high="high"in e?e.high:Number.MAX_VALUE,this.min="min"in e?e.min:Number.MAX_VALUE,this.max="max"in e?e.max:-Number.MAX_VALUE,this.container=null,this.slider=null,this.slider_label=null;var n=this;n.parent_div=t("<div/>").addClass("filter-row slider-row");var i=t("<div/>").addClass("elt-label").appendTo(n.parent_div),r=(t("<span/>").addClass("slider-name").text(n.name+"  ").appendTo(i),t("<span/>").text(this.low+"-"+this.high)),a=t("<span/>").addClass("slider-value").appendTo(i).append("[").append(r).append("]");n.values_span=r;var l=t("<div/>").addClass("slider").appendTo(n.parent_div);n.control_element=t("<div/>").attr("id",n.name+"-filter-control").appendTo(l),n.control_element.slider({range:!0,min:this.min,max:this.max,step:this.get_slider_step(this.min,this.max),values:[this.low,this.high],slide:function(t,e){n.slide(t,e)},change:function(t,e){n.control_element.slider("option","slide").call(n.control_element,t,e)}}),n.slider=n.control_element,n.slider_label=r,function(e,n,i){e.click(function(){var e=n.text(),r=parseFloat(i.slider("option","max")),a=r<=1?4:r<=1e6?r.toString().length:6,o=!1,s=t(this).parents(".slider-row");s.addClass("input"),i.slider("option","values")&&(a=2*a+1,o=!0),n.text(""),t("<input type='text'/>").attr("size",a).attr("maxlength",a).attr("value",e).appendTo(n).focus().select().click(function(t){t.stopPropagation()}).blur(function(){t(this).remove(),n.text(e),s.removeClass("input")}).keyup(function(e){if(27===e.keyCode)t(this).trigger("blur");else if(13===e.keyCode){var n=i.slider("option","min"),r=i.slider("option","max"),a=function(t){return isNaN(t)||t>r||t<n},l=t(this).val();if(o){if(l=l.split("-"),l=[parseFloat(l[0]),parseFloat(l[1])],a(l[0])||a(l[1]))return alert("Parameter value must be in the range ["+n+"-"+r+"]"),t(this)}else if(l=parseFloat(l),a(l))return alert("Parameter value must be in the range ["+n+"-"+r+"]"),t(this);i.slider(o?"values":"value",l),s.removeClass("input")}})})}(a,r,n.control_element);var u=t("<div/>").addClass("display-controls").appendTo(n.parent_div);this.transparency_icon=s("Use filter for data transparency","layer-transparent",function(){n.manager.alpha_filter!==n?(n.manager.alpha_filter=n,n.manager.parent_div.find(".layer-transparent").removeClass("active").hide(),n.transparency_icon.addClass("active").show()):(n.manager.alpha_filter=null,n.transparency_icon.removeClass("active")),n.manager.track.request_draw({force:!0,clear_after:!0})}).appendTo(u).hide(),this.height_icon=s("Use filter for data height","arrow-resize-090",function(){n.manager.height_filter!==n?(n.manager.height_filter=n,n.manager.parent_div.find(".arrow-resize-090").removeClass("active").hide(),n.height_icon.addClass("active").show()):(n.manager.height_filter=null,n.height_icon.removeClass("active")),n.manager.track.request_draw({force:!0,clear_after:!0})}).appendTo(u).hide(),n.parent_div.hover(function(){n.transparency_icon.show(),n.height_icon.show()},function(){n.manager.alpha_filter!==n&&n.transparency_icon.hide(),n.manager.height_filter!==n&&n.height_icon.hide()}),t("<div style='clear: both;'/>").appendTo(n.parent_div)};a(l.prototype,{to_dict:function(){var t=o.prototype.to_dict.call(this);return a(t,{type:"number",min:this.min,max:this.max,low:this.low,high:this.high})},copy:function(){return new l({name:this.name,index:this.index,tool_id:this.tool_id,tool_exp_name:this.tool_exp_name})},get_slider_step:function(t,e){return e-t<=2?.01:1},slide:function(t,e){var n=e.values;this.values_span.text(n[0]+"-"+n[1]),this.low=n[0],this.high=n[1];var i=this;setTimeout(function(){n[0]===i.low&&n[1]===i.high&&i.manager.track.request_draw({force:!0,clear_after:!0})},25)},applies_to:function(t){return t.length>this.index},_keep_val:function(t){return isNaN(t)||t>=this.low&&t<=this.high},keep:function(t){if(!this.applies_to(t))return!0;var e=t[this.index];if(e instanceof Array){for(var n=!0,i=0;i<e.length;i++)if(!this._keep_val(e[i])){n=!1;break}return n}return this._keep_val(t[this.index])},update_attrs:function(t){var e=!1;if(!this.applies_to(t))return e;var n=t[this.index];n instanceof Array||(n=[n]);for(var i=0;i<n.length;i++){var r=n[i];r<this.min&&(this.min=Math.floor(r),e=!0),r>this.max&&(this.max=Math.ceil(r),e=!0)}return e},update_ui_elt:function(){this.min<this.max?this.parent_div.show():this.parent_div.hide();var t=this.slider.slider("option","min"),e=this.slider.slider("option","max");(this.min<t||this.max>e)&&(this.slider.slider("option","min",this.min),this.slider.slider("option","max",this.max),this.slider.slider("option","step",this.get_slider_step(this.min,this.max)),this.slider.slider("option","values",[this.min,this.max]))}});var u=function(e,n){if(this.track=e,this.alpha_filter=null,this.height_filter=null,this.filters=[],this.parent_div=t("<div/>").addClass("filters").hide(),this.parent_div.bind("drag",function(t){t.stopPropagation()}).click(function(t){t.stopPropagation()}).bind("dblclick",function(t){t.stopPropagation()}).bind("keydown",function(t){t.stopPropagation()}),n&&"filters"in n){for(var i,r=("alpha_filter"in n?n.alpha_filter:null),a=("height_filter"in n?n.height_filter:null),o=n.filters,s=0;s<o.length;s++)"number"===o[s].type?(i=new l(o[s]),this.add_filter(i),i.name===r&&(this.alpha_filter=i,i.transparency_icon.addClass("active").show()),i.name===a&&(this.height_filter=i,i.height_icon.addClass("active").show())):console.log("ERROR: unsupported filter: ",name,type);"visible"in n&&n.visible&&this.parent_div.show()}if(0!==this.filters.length){var u=t("<div/>").addClass("param-row").appendTo(this.parent_div),c=this;t("<input type='submit'/>").attr("value","Run on complete dataset").appendTo(u).click(function(){c.run_on_dataset()})}};a(u.prototype,{show:function(){this.parent_div.show()},hide:function(){this.parent_div.hide()},toggle:function(){this.parent_div.toggle()},visible:function(){return this.parent_div.is(":visible")},to_dict:function(){for(var t,e={},n=[],i=0;i<this.filters.length;i++)t=this.filters[i],n.push(t.to_dict());return e.filters=n,e.alpha_filter=this.alpha_filter?this.alpha_filter.name:null,e.height_filter=this.height_filter?this.height_filter.name:null,e.visible=this.parent_div.is(":visible"),e},copy:function(t){for(var e=new u(t),n=0;n<this.filters.length;n++)e.add_filter(this.filters[n].copy());return e},add_filter:function(t){t.manager=this,this.parent_div.append(t.parent_div),this.filters.push(t)},remove_all:function(){this.filters=[],this.parent_div.children().remove()},init_filters:function(){for(var t=0;t<this.filters.length;t++){this.filters[t].update_ui_elt()}},clear_filters:function(){for(var t=0;t<this.filters.length;t++){var e=this.filters[t];e.slider.slider("option","values",[e.min,e.max])}this.alpha_filter=null,this.height_filter=null,this.parent_div.find(".icon-button").hide()},run_on_dataset:function(){for(var e,n,i=(function(t,e,n){return e in t||(t[e]=n),t[e]}),r={},a=0;a<this.filters.length;a++)e=this.filters[a],e.tool_id&&(e.min!==e.low&&(n=i(r,e.tool_id,[]),n[n.length]=e.tool_exp_name+" >= "+e.low),e.max!==e.high&&(n=i(r,e.tool_id,[]),n[n.length]=e.tool_exp_name+" <= "+e.high));var o=[];for(var s in r)o[o.length]=[s,r[s]];!function e(n,i){var r=i[0],a=r[0],o=r[1],s="("+o.join(") and (")+")",l={cond:s,input:n,target_dataset_id:n,tool_id:a};i=i.slice(1),t.getJSON(run_tool_url,l,function(t){t.error?Galaxy.modal.show({title:"Filter Dataset",body:"Error running tool "+a,buttons:{Close:Galaxy.modal.hide()}}):0===i.length?Galaxy.modal.show({title:"Filtering Dataset",body:"Filter(s) are running on the complete dataset. Outputs are in dataset's history.",buttons:{Close:Galaxy.modal.hide()}}):e(t.dataset_id,i)})}(this.track.dataset_id,o)}}),e.default={FiltersManager:u,NumberFilter:l}}).call(e,n(0))},34:function(t,e,n){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0});var i=n(7),r=function(t){return t&&t.__esModule?t:{default:t}}(i),a=n(35),o=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(a),s=r.default.GenomeDataManager.extend({load_data:function(e,n,i,r){var a=t.Deferred();this.set_data(e,a);var s=Galaxy.root+"datasets/"+this.get("dataset").id+"/display",l=this;new t.Deferred;return t.when(o.makeBwg(s)).then(function(n,i){t.when(n.readWigData(e.get("chrom"),e.get("start"),e.get("end"))).then(function(t){var n=[],i={max:Number.MIN_VALUE};t.forEach(function(t){i.max!==t.min-1&&(n.push([i.max+1,0]),n.push([t.min-2,0])),n.push([t.min-1,t.score]),n.push([t.max,t.score]),i=t});var r={data:n,region:e,dataset_type:"bigwig"};l.set_data(e,r),a.resolve(r)})}),a}});e.default={BBIDataManager:s}}).call(e,n(0))},35:function(t,e,n){(function(i){var r,a;r=[n(36),n(37),n(38)],void 0!==(a=function(t,e){"use strict";function n(){}function r(t){t&&(this.id=t)}function a(t,e){return t[e+3]<<24|t[e+2]<<16|t[e+1]<<8|t[e]}function o(t,e,n){Math.pow(10,6);return i.ajax({type:"GET",dataType:"native",url:t,timeout:5e3,beforeSend:function(t){t.setRequestHeader("Range","bytes="+e+"-"+(e+(n-1)))},xhrFields:{responseType:"arraybuffer"}})}function s(t,e){return t[e]+t[e+1]*b+t[e+2]*x+t[e+3]*k+t[e+4]*M}function l(){}function u(t,e,n,i){this.bwg=t,this.cirTreeOffset=e,this.cirTreeLength=n,this.isSummary=i}function c(t){var e=i.Deferred(),n=new l;return n.url=t,i.when(o(n.url,0,512)).then(function(t){if(!t)return e.resolve(null,"Couldn't fetch file");var r=t,a=new Uint8Array(r),o=new Int16Array(r),l=new Int32Array(r),u=a[0]+b*a[1]+x*a[2]+k*a[3];if(u==g)n.type="bigwig";else{if(u!=y)return u==m||u==w?e.resolve(null,"Currently don't support big-endian BBI files"):e.resolve(null,"Not a supported format, magic=0x"+u.toString(16));n.type="bigbed"}n.version=o[2],n.numZoomLevels=o[3],n.chromTreeOffset=s(a,8),n.unzoomedDataOffset=s(a,16),n.unzoomedIndexOffset=s(a,24),n.fieldCount=o[16],n.definedFieldCount=o[17],n.asOffset=s(a,36),n.totalSummaryOffset=s(a,44),n.uncompressBufSize=l[13],n.extHeaderOffset=s(a,56),n.zoomLevels=[];for(var c=0;c<n.numZoomLevels;++c){var h=l[6*c+16],d=s(a,24*c+72),f=s(a,24*c+80);n.zoomLevels.push({reduction:h,dataOffset:d,indexOffset:f})}i.when(n.readChromTree()).then(function(){n.getAutoSQL(function(t){return n.schema=t,e.resolve(n)})})}),e}function h(t,e,n,i,r){this.bbi=t,this.type=e,this.fieldCount=n,this.offset=i,this.field=r}var d=t.Range,f=t.union,_=t.intersection,p=e.inflateBuffer,v=e.arrayCopy,g=2291137574,m=654086024,y=2273964779,w=3958540679,b=256,x=65536,k=16777216,M=4294967296,C=new RegExp("^[0-9]+,[0-9]+,[0-9]+");return l.prototype.readChromTree=function(){var t=this;this.chromsToIDs={},this.idsToChroms={},this.maxID=0;var e=this.unzoomedDataOffset;return e=e+4-(e-this.chromTreeOffset&3),i.when(o(this.url,this.chromTreeOffset,e-this.chromTreeOffset)).then(function(e){var n=new Uint8Array(e),i=new Int16Array(e),r=new Int32Array(e),a=(r[0],r[1],r[2]),o=(r[3],s(n,16),function(e){var r=n[e],l=i[e/2+1];e+=4;for(var u=0;u<l;++u)if(0===r){e+=a;var c=s(n,e);e+=8,c-=t.chromTreeOffset,o(c)}else{for(var h="",d=0;d<a;++d){var f=n[e++];0!==f&&(h+=String.fromCharCode(f))}var _=n[e+3]<<24|n[e+2]<<16|n[e+1]<<8|n[e+0];n[e+7],n[e+6],n[e+5],n[e+4],e+=8,t.chromsToIDs[h]=_,0===h.indexOf("chr")&&(t.chromsToIDs[h.substr(3)]=_),t.idsToChroms[_]=h,t.maxID=Math.max(t.maxID,_)}});o(32)})},u.prototype.readWigData=function(t,e,n){var i=this.bwg.chromsToIDs[t];return void 0===i?[]:this.readWigDataById(i,e,n)},u.prototype.readWigDataById=function(t,e,n){var r=this,a=i.Deferred();if(!this.cirHeader)return i.when(o(r.bwg.url,this.cirTreeOffset,48)).then(function(o){r.cirHeader=o;var s=new Int32Array(r.cirHeader);r.cirBlockSize=s[1],i.when(r.readWigDataById(t,e,n)).then(function(t){a.resolve(t)})}),a;var l=[],u=0,c=(Date.now(),function(i,r,a,o){return(t<0||i==t)&&r<=n&&a>=e}),h=function(t,e){if(r.bwg.instrument&&console.log("level="+e+"; offset="+t+"; time="+(0|Date.now())),u+=t.length,1==t.length&&t[0]-r.cirTreeOffset==48&&r.cachedCirRoot)return p(r.cachedCirRoot,0,e),void(0===--u&&i.when(r.fetchFeatures(c,l)).then(function(t){a.resolve(t)}));for(var n,o=4+32*r.cirBlockSize,s=0;s<t.length;++s){var h=new d(t[s],t[s]+o);n=n?f(n,h):h}for(var v=n.ranges(),g=0;g<v.length;++g){var m=v[g];_(t,m,e)}},_=function(t,e,n,s){e.max(),e.min();i.when(o(r.bwg.url,e.min(),e.max()-e.min())).then(function(o){for(var s=0;s<t.length;++s)e.contains(t[s])&&(p(o,t[s]-e.min(),n),t[s]-r.cirTreeOffset==48&&t[s]-e.min()==0&&(r.cachedCirRoot=o),0===--u&&i.when(r.fetchFeatures(c,l)).then(function(t){a.resolve(t)}))})},p=function(i,r,a){var o=new Uint8Array(i),u=new Int16Array(i),c=new Int32Array(i),d=o[r],f=u[r/2+1];if(r+=4,0!==d)for(var _=0;_<f;++_){var p=r/4,v=c[p],g=c[p+1],m=c[p+2],y=c[p+3],w=s(o,r+16),b=s(o,r+24);(t<0||v<t||v==t&&g<=n)&&(t<0||m>t||m==t&&y>=e)&&l.push({offset:w,size:b}),r+=32}else{for(var x=[],_=0;_<f;++_){var p=r/4,v=c[p],g=c[p+1],m=c[p+2],y=c[p+3],w=s(o,r+16);(t<0||v<t||v==t&&g<=n)&&(t<0||m>t||m==t&&y>=e)&&x.push(w),r+=24}x.length>0&&h(x,a+1)}};return h([r.cirTreeOffset+48],1),a},u.prototype.fetchFeatures=function(t,e){var r=this,a=i.Deferred();if(e.sort(function(t,e){return(0|t.offset)-(0|e.offset)}),0===e.length)return[];var s=[],l=function(t,e,i,a){a||(a={});var o=new n;o._chromId=t,o.segment=r.bwg.idsToChroms[t],o.min=e,o.max=i,o.type=r.bwg.type;for(var l in a)o[l]=a[l];s.push(o)},u=function(){if(0===e.length){Date.now();return a.resolve(s)}var n=e[0];if(n.data)r.parseFeatures(n.data,l,t),e.splice(0,1),u();else{for(var c=n.offset,h=n.size,d=1;d<e.length&&e[d].offset==c+h;)h+=e[d].size,++d;i.when(o(r.bwg.url,c,h)).then(function(t){for(var n=0,i=0;n<h;){var a,o=e[i];if(r.bwg.uncompressBufSize>0)a=p(t,n+2,o.size-2);else{var s=new Uint8Array(o.size);v(new Uint8Array(t,n,o.size),0,s,0,o.size),a=s.buffer}o.data=a,n+=o.size,++i}u()})}};return u(),a},u.prototype.parseFeatures=function(t,e,n){var a=new Uint8Array(t);if(this.isSummary)for(var o=new Int16Array(t),s=new Int32Array(t),l=new Float32Array(t),u=t.byteLength/32,c=0;c<u;++c){var h=s[8*c],p=s[8*c+1],v=s[8*c+2],g=s[8*c+3],m=(l[8*c+4],l[8*c+5]),y=l[8*c+6];l[8*c+7];if(n(h,p+1,v)){var w={type:"bigwig",score:y/g,maxScore:m};"bigbed"==this.bwg.type&&(w.type="density"),e(h,p+1,v,w)}}else if("bigwig"==this.bwg.type){var o=new Int16Array(t),s=new Int32Array(t),l=new Float32Array(t),h=s[0],b=s[1],x=(s[2],s[3]),k=s[4],M=a[20],u=o[11];if(3==M)for(var c=0;c<u;++c){var S=l[c+6],T=b+c*x+1,A=b+c*x+k;n(h,T,A)&&e(h,T,A,{score:S})}else if(2==M)for(var c=0;c<u;++c){var p=s[2*c+6]+1,v=p+k-1,S=l[2*c+7];n(h,p,v)&&e(h,p,v,{score:S})}else if(1==M)for(var c=0;c<u;++c){var p=s[3*c+6]+1,v=s[3*c+7],S=l[3*c+8];p>v&&(p=v),n(h,p,v)&&e(h,p,v,{score:S})}else console.log("Currently not handling bwgType="+M)}else{if("bigbed"!=this.bwg.type)throw Error("Don't know what to do with "+this.bwg.type);for(var z=0,N=this.bwg.definedFieldCount,E=this.bwg.schema;z<a.length;){var h=a[z+3]<<24|a[z+2]<<16|a[z+1]<<8|a[z+0],p=a[z+7]<<24|a[z+6]<<16|a[z+5]<<8|a[z+4],v=a[z+11]<<24|a[z+10]<<16|a[z+9]<<8|a[z+8];z+=12;for(var R="";;){var O=a[z++];if(0==O)break;R+=String.fromCharCode(O)}var D,P={};if(D=R.length>0?R.split("\t"):[],D.length>0&&N>3&&(P.label=D[0]),D.length>1&&N>4){var S=parseInt(D[1]);isNaN(S)||(P.score=S)}if(D.length>2&&N>5&&(P.orientation=D[2]),D.length>5&&N>8){var j=D[5];C.test(j)&&(P.itemRgb="rgb("+j+")")}if(D.length>N-3&&E)for(var $=N-3;$<D.length;++$)P[E.fields[$+3].name]=D[$];if(n(h,p+1,v,D))if(N<12)e(h,p+1,v,P);else{var q=0|D[3],I=0|D[4],F=0|D[6],L=D[7].split(","),G=D[8].split(",");if(P.exonFrames){var V=P.exonFrames.split(",");P.exonFrames=void 0}P.type="transcript";var H=new r;for(var U in P)H[U]=P[U];if(H.id=D[0],H.segment=this.bwg.idsToChroms[h],H.min=p+1,H.max=v,H.notes=[],P.groups=[H],D.length>9){var B=P.geneName||D[9],Y=B;D.length>10&&(Y=D[10]),P.geneName2&&(Y=P.geneName2);var X=i.extend({},H);X.id=B,X.label=Y,X.type="gene",P.groups.push(X)}for(var J=[],W=0;W<F;++W){var Z=(0|G[W])+p,Q=Z+(0|L[W]),K=new d(Z,Q);J.push(K)}for(var tt=f(J),et=tt.ranges(),nt=0;nt<et.length;++nt){var it=et[nt];e(h,it.min()+1,it.max(),P)}if(I>q){var rt="+"==P.orientation?new d(q,I+3):new d(q-3,I),at=_(tt,rt);if(at){P.type="translation";for(var ot=at.ranges(),st=0,lt=0;ot[0].min()>et[lt].max();)lt++;for(var nt=0;nt<ot.length;++nt){var ut=nt;"-"==P.orientation&&(ut=ot.length-nt-1);var it=ot[ut];if(P.readframe=st,V){var ct=parseInt(V[ut+lt]);"number"==typeof ct&&ct>=0&&ct<=2&&(P.readframe=ct,P.readframeExplicit=!0)}var ht=it.max()-it.min();st=(st+ht)%3,e(h,it.min()+1,it.max(),P)}}}}}}},u.prototype.getFirstAdjacent=function(t,e,n,i){var r=this.bwg.chromsToIDs[t];if(void 0===r)return i([]);this.getFirstAdjacentById(r,e,n,i)},u.prototype.getFirstAdjacentById=function(t,e,n,i){var r=this;if(!this.cirHeader)return void this.bwg.data.slice(this.cirTreeOffset,48).fetch(function(a){r.cirHeader=a;var o=new Int32Array(r.cirHeader);r.cirBlockSize=o[1],r.getFirstAdjacentById(t,e,n,i)});var a=null,o=-1,l=-1,u=0,c=(Date.now(),function(t,e){u+=t.length;for(var n,i=4+32*r.cirBlockSize,a=0;a<t.length;++a){var o=new d(t[a],t[a]+i);n=n?f(n,o):o}for(var s=n.ranges(),l=0;l<s.length;++l){var c=s[l];h(t,c,e)}}),h=function(o,s,l,c){s.max(),s.min();r.bwg.data.slice(s.min(),s.max()-s.min()).fetch(function(c){for(var h=0;h<o.length;++h)if(s.contains(o[h])&&(_(c,o[h]-s.min(),l),0==--u)){if(!a)return n>0&&(0!=t||e>0)?r.getFirstAdjacentById(0,0,n,i):n<0&&(t!=r.bwg.maxID||e<1e9)?r.getFirstAdjacentById(r.bwg.maxID,1e9,n,i):i([]);r.fetchFeatures(function(i,r,a,o){return n<0&&(i<t||a<e)||n>0&&(i>t||r>e)},[a],function(t){for(var e=null,r=-1,a=-1,o=0;o<t.length;++o){var s=t[o],l=s._chromId,u=s.min,c=s.max;(null==e||n<0&&(l>r||c>a)||n>0&&(l<r||u<a))&&(e=s,a=n<0?c:u,r=l)}return i(null!=e?[e]:[])})}})},_=function(i,u,h){var d=new Uint8Array(i),f=new Int16Array(i),_=new Int32Array(i),p=d[u],v=f[u/2+1];if(u+=4,0!=p)for(var g=0;g<v;++g){var m=u/4,y=_[m],w=_[m+1],b=_[m+2],x=_[m+3],k=s(d,u+16),M=s(d,u+24);(n<0&&(y<t||y==t&&w<=e)||n>0&&(b>t||b==t&&x>=e))&&(/_random/.exec(r.bwg.idsToChroms[y])||(null==a||n<0&&(b>o||b==o&&x>l)||n>0&&(y<o||y==o&&w<l))&&(a={offset:k,size:M},l=n<0?x:w,o=n<0?b:y)),u+=32}else{for(var C=-1,S=-1,g=0;g<v;++g){var m=u/4,y=_[m],w=_[m+1],b=_[m+2],x=_[m+3],k=_[m+4]<<32|_[m+5];(n<0&&(y<t||y==t&&w<=e)&&b>=t||n>0&&(b>t||b==t&&x>=e)&&y<=t)&&(C<0||x>S)&&(C=k,S=n<0?x:w,n<0?b:y),u+=24}C>=0&&c([C],h+1)}};c([r.cirTreeOffset+48],1)},l.prototype.readWigData=function(t,e,n){var i,r=n-e;if(r<=25e3||0===this.zoomLevels.length)i=this.getUnzoomedView();else for(var a=0;a<this.zoomLevels.length;a++)if(r/this.zoomLevels[a].reduction<25e3){i=this.getZoomedView(a);break}return i.readWigData(t,e,n)},l.prototype.getUnzoomedView=function(){if(!this.unzoomedView){var t=4e3;this.zoomLevels[0]&&(t=this.zoomLevels[0].dataOffset-this.unzoomedIndexOffset),this.unzoomedView=new u(this,this.unzoomedIndexOffset,t,!1)}return this.unzoomedView},l.prototype.getZoomedView=function(t){var e=this.zoomLevels[t];return e.view||(e.view=new u(this,e.indexOffset,4e3,!0)),e.view},l.prototype._tsFetch=function(t,e,n,i,r){var a=this;if(!(t>=this.zoomLevels.length-1)){var o;return o=t<0?this.getUnzoomedView():this.getZoomedView(t),o.readWigDataById(e,n,i,r)}if(this.topLevelReductionCache){for(var s=[],l=this.topLevelReductionCache,u=0;u<l.length;++u)l[u]._chromId==e&&s.push(l[u]);return r(s)}this.getZoomedView(this.zoomLevels.length-1).readWigDataById(-1,0,3e8,function(o){return a.topLevelReductionCache=o,a._tsFetch(t,e,n,i,r)})},l.prototype.thresholdSearch=function(t,e,n,i,r){function a(){if(0==l.length)return r(null);l.sort(function(t,e){var i=t.zoom-e.zoom;return 0!=i?i:(i=t.chrOrd-e.chrOrd,0!=i?i:t.min-e.min*n)});var t=l.splice(0,1)[0];o._tsFetch(t.zoom,t.chr,t.min,t.max,function(o){var s=n>0?0:3e8;t.fromRef&&(s=e);for(var u=0;u<o.length;++u){var c,h=o[u];if(c=void 0!=h.maxScore?h.maxScore:h.score,n>0){if(c>i)if(t.zoom<0){if(h.min>s)return r(h)}else h.max>s&&l.push({chr:t.chr,chrOrd:t.chrOrd,zoom:t.zoom-2,min:h.min,max:h.max,fromRef:t.fromRef})}else if(c>i)if(t.zoom<0){if(h.max<s)return r(h)}else h.min<s&&l.push({chr:t.chr,chrOrd:t.chrOrd,zoom:t.zoom-2,min:h.min,max:h.max,fromRef:t.fromRef})}a()})}n=n<0?-1:1;for(var o=this,s=this.chromsToIDs[t],l=[{chrOrd:0,chr:s,zoom:o.zoomLevels.length-4,min:0,max:3e8,fromRef:!0}],u=1;u<=this.maxID+1;++u){var c=(s+n*u)%(this.maxID+1);c<0&&(c+=this.maxID+1),l.push({chrOrd:u,chr:c,zoom:o.zoomLevels.length-1,min:0,max:3e8})}a()},l.prototype.getAutoSQL=function(t){if(!this.asOffset)return t(null);i.when(o(this.url,this.asOffset,2048)).then(function(e){for(var n=new Uint8Array(e),i="",r=0;r<n.length&&0!=n[r];++r)i+=String.fromCharCode(n[r]);var a=/(\w+)\s+(\w+)\s+("([^"]+)")?\s+\(\s*/,o=/([\w\[\]]+)\s+(\w+)\s*;\s*("([^"]+)")?\s*/g,s=a.exec(i);if(s){var l={declType:s[1],name:s[2],comment:s[4],fields:[]};i=i.substring(s[0]);for(var u=o.exec(i);null!=u;u=o.exec(i))l.fields.push({type:u[1],name:u[2],comment:u[4]});return t(l)}})},l.prototype.getExtraIndices=function(t){var e=this;if(this.version<4||0==this.extHeaderOffset||"bigbed"!=this.type)return t(null);this.data.slice(this.extHeaderOffset,64).fetch(function(n){if(!n)return t(null,"Couldn't fetch extension header");var i=new Uint8Array(n),r=new Int16Array(n),a=(new Int32Array(n),r[0],r[1]),o=s(i,4);if(0==a)return t(null);e.data.slice(o,20*a).fetch(function(n){if(!n)return t(null,"Couldn't fetch index info");for(var i=new Uint8Array(n),r=new Int16Array(n),o=(new Int32Array(n),[]),l=0;l<a;++l){var u=r[10*l],c=r[10*l+1],d=s(i,20*l+4),f=r[10*l+8],_=new h(e,u,c,d,f);o.push(_)}t(o)})})},h.prototype.lookup=function(t,e){var n=this;this.bbi.data.slice(this.offset,32).fetch(function(i){function r(i){n.bbi.data.slice(i,4+u*(c+h)).fetch(function(i){var o=new Uint8Array(i),l=new Uint16Array(i),u=(new Uint32Array(i),o[0]),d=l[1],f=4;if(0!=u){for(var _=0;_<d;++_){for(var p="",v=0;v<c;++v){var g=o[f++];0!=g&&(p+=String.fromCharCode(g))}if(p==t){var m=s(o,f),y=a(o,f+8);return n.bbi.getUnzoomedView().fetchFeatures(function(e,i,r,a){if(a&&a.length>n.field-3)return a[n.field-3]==t},[{offset:m,size:y}],e)}f+=h}return e([])}for(var w=null,_=0;_<d;++_){for(var p="",v=0;v<c;++v){var g=o[f++];0!=g&&(p+=String.fromCharCode(g))}var b=s(o,f);if(f+=8,t.localeCompare(p)<0&&w)return void r(w);w=b}r(w)})}var o=new Uint8Array(i),l=(new Int16Array(i),new Int32Array(i)),u=(l[0],l[1]),c=l[2],h=l[3];s(o,16);r(n.offset+32)})},{makeBwg:c}}.apply(e,r))&&(t.exports=a)}).call(e,n(0))},36:function(t,e,n){var i,r;i=[],void 0!==(r=function(){"use strict";function t(t,e){if("number"!=typeof t||"number"!=typeof e)throw"Bad range "+t+","+e;this._min=t,this._max=e}function e(t){var e=t.sort(o),n=[],i=e.shift();e.forEach(function(t){t._min<=i._max?t._max>i._max&&(i._max=t._max):(n.push(i),i=t)}),n.push(i),this._ranges=n}function n(t,n){return t instanceof e||(t instanceof Array||(t=[t]),t=new e(t)),n&&t.insertRange(n),t}function i(n,i){for(var r=n.ranges(),a=i.ranges(),o=r.length,s=a.length,l=0,u=0,c=[];l<o&&u<s;){var n=r[l],i=a[u],h=Math.max(n.min(),i.min()),d=Math.min(n.max(),i.max());d>=h&&c.push(new t(h,d)),n.max()>i.max()?++u:++l}return 0==c.length?null:1==c.length?c[0]:new e(c)}function r(t){for(var e=0,n=t.ranges(),i=0;i<n.length;++i){var r=n[i];e+=r.max()-r.min()+1}return e}function a(t,e){return t.min()<e.min()?-1:t.min()>e.min()?1:t.max()<e.max()?-1:e.max()>t.max()?1:0}function o(t,e){return t._min<e._min?-1:t._min>e._min?1:t._max<e._max?-1:e._max>t._max?1:0}return t.prototype.min=function(){return this._min},t.prototype.max=function(){return this._max},t.prototype.contains=function(t){return t>=this._min&&t<=this._max},t.prototype.isContiguous=function(){return!0},t.prototype.ranges=function(){return[this]},t.prototype._pushRanges=function(t){t.push(this)},t.prototype.toString=function(){return"["+this._min+"-"+this._max+"]"},e.prototype.min=function(){return this._ranges[0].min()},e.prototype.max=function(){return this._ranges[this._ranges.length-1].max()},e.prototype.lower_bound=function(t){var e=this.ranges();if(t>this.max())return e.length;if(t<this.min())return 0;for(var n=0,i=e.length-1;n<=i;){var r=Math.floor((n+i)/2);if(t>e[r]._max)n=r+1;else{if(!(t<e[r]._min))return r;i=r-1}}return n},e.prototype.contains=function(t){var e=this.lower_bound(t);return!!(e<this._ranges.length&&this._ranges[e].contains(t))},e.prototype.insertRange=function(t){var e=this.lower_bound(t._min);if(e===this._ranges.length)return void this._ranges.push(t);var n=this.ranges();if(t._max<n[e]._min)return void this._ranges.splice(e,0,t);n[e]._min<t._min&&(t._min=n[e]._min);for(var i=e+1;i<n.length&&n[i]._min<=t._max;)i++;i--,n[i]._max>t._max&&(t._max=n[i]._max),this._ranges.splice(e,i-e+1,t)},e.prototype.isContiguous=function(){return this._ranges.length>1},e.prototype.ranges=function(){return this._ranges},e.prototype._pushRanges=function(t){for(var e=0;e<this._ranges.length;++e)t.push(this._ranges[e])},e.prototype.toString=function(){for(var t="",e=0;e<this._ranges.length;++e)e>0&&(t+=","),t+=this._ranges[e].toString();return t},{Range:t,union:n,intersection:i,coverage:r,rangeOver:a,_rangeOrder:o}}.apply(e,i))&&(t.exports=r)},37:function(t,e,n){var i,r;i=[],void 0!==(r=function(){function t(){}function e(){this.was=[0]}function n(t,e,n){this.hufts=new Int32Array(3*h),this.window=new Uint8Array(n),this.end=n,this.checkfn=e,this.mode=g,this.reset(t,null),this.left=0,this.table=0,this.index=0,this.blens=null,this.bb=new Int32Array(1),this.tb=new Int32Array(1),this.codes=new i,this.last=0,this.bitk=0,this.bitb=0,this.read=0,this.write=0,this.check=0,this.inftree=new r}function i(){}function r(){}function a(t,e,n,i,r){return t[0]=m,e[0]=y,n[0]=w,i[0]=b,f}function o(t,e,n,i,r){if(0!=r){if(!t)throw"Undef src";if(!n)throw"Undef dest";0==e&&r==t.length?l(t,n,i):z?l(t.subarray(e,e+r),n,i):1==t.BYTES_PER_ELEMENT&&r>100?l(new Uint8Array(t.buffer,t.byteOffset+e,r),n,i):s(t,e,n,i,r)}}function s(t,e,n,i,r){for(var a=0;a<r;++a)n[i+a]=t[e+a]}function l(t,e,n){e.set(t,n)}function u(e,n,i,r){e=n?i?new Uint8Array(e,n,i):new Uint8Array(e,n,e.byteLength-n):new Uint8Array(e);var a=new t;a.inflateInit(c,!0),a.next_in=e,a.next_in_index=0,a.avail_in=e.length;for(var s=[],l=0;;){var u=new Uint8Array(32e3);a.next_out=u,a.next_out_index=0,a.avail_out=u.length;var h=a.inflate(d);if(h!=f&&h!=_&&h!=p)throw a.msg;if(0!=a.avail_out){var v=new Uint8Array(u.length-a.avail_out);o(u,0,v,0,u.length-a.avail_out),u=v}if(s.push(u),l+=u.length,h==_||h==p)break}if(r&&(r[0]=(n||0)+a.next_in_index),1==s.length)return s[0].buffer;for(var g=new Uint8Array(l),m=0,y=0;y<s.length;++y){var w=s[y];o(w,0,g,m,w.length),m+=w.length}return g.buffer}var c=15,h=1440,d=0,f=0,_=1,p=-5,v=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535],g=0,m=9,y=5,w=[96,7,256,0,8,80,0,8,16,84,8,115,82,7,31,0,8,112,0,8,48,0,9,192,80,7,10,0,8,96,0,8,32,0,9,160,0,8,0,0,8,128,0,8,64,0,9,224,80,7,6,0,8,88,0,8,24,0,9,144,83,7,59,0,8,120,0,8,56,0,9,208,81,7,17,0,8,104,0,8,40,0,9,176,0,8,8,0,8,136,0,8,72,0,9,240,80,7,4,0,8,84,0,8,20,85,8,227,83,7,43,0,8,116,0,8,52,0,9,200,81,7,13,0,8,100,0,8,36,0,9,168,0,8,4,0,8,132,0,8,68,0,9,232,80,7,8,0,8,92,0,8,28,0,9,152,84,7,83,0,8,124,0,8,60,0,9,216,82,7,23,0,8,108,0,8,44,0,9,184,0,8,12,0,8,140,0,8,76,0,9,248,80,7,3,0,8,82,0,8,18,85,8,163,83,7,35,0,8,114,0,8,50,0,9,196,81,7,11,0,8,98,0,8,34,0,9,164,0,8,2,0,8,130,0,8,66,0,9,228,80,7,7,0,8,90,0,8,26,0,9,148,84,7,67,0,8,122,0,8,58,0,9,212,82,7,19,0,8,106,0,8,42,0,9,180,0,8,10,0,8,138,0,8,74,0,9,244,80,7,5,0,8,86,0,8,22,192,8,0,83,7,51,0,8,118,0,8,54,0,9,204,81,7,15,0,8,102,0,8,38,0,9,172,0,8,6,0,8,134,0,8,70,0,9,236,80,7,9,0,8,94,0,8,30,0,9,156,84,7,99,0,8,126,0,8,62,0,9,220,82,7,27,0,8,110,0,8,46,0,9,188,0,8,14,0,8,142,0,8,78,0,9,252,96,7,256,0,8,81,0,8,17,85,8,131,82,7,31,0,8,113,0,8,49,0,9,194,80,7,10,0,8,97,0,8,33,0,9,162,0,8,1,0,8,129,0,8,65,0,9,226,80,7,6,0,8,89,0,8,25,0,9,146,83,7,59,0,8,121,0,8,57,0,9,210,81,7,17,0,8,105,0,8,41,0,9,178,0,8,9,0,8,137,0,8,73,0,9,242,80,7,4,0,8,85,0,8,21,80,8,258,83,7,43,0,8,117,0,8,53,0,9,202,81,7,13,0,8,101,0,8,37,0,9,170,0,8,5,0,8,133,0,8,69,0,9,234,80,7,8,0,8,93,0,8,29,0,9,154,84,7,83,0,8,125,0,8,61,0,9,218,82,7,23,0,8,109,0,8,45,0,9,186,0,8,13,0,8,141,0,8,77,0,9,250,80,7,3,0,8,83,0,8,19,85,8,195,83,7,35,0,8,115,0,8,51,0,9,198,81,7,11,0,8,99,0,8,35,0,9,166,0,8,3,0,8,131,0,8,67,0,9,230,80,7,7,0,8,91,0,8,27,0,9,150,84,7,67,0,8,123,0,8,59,0,9,214,82,7,19,0,8,107,0,8,43,0,9,182,0,8,11,0,8,139,0,8,75,0,9,246,80,7,5,0,8,87,0,8,23,192,8,0,83,7,51,0,8,119,0,8,55,0,9,206,81,7,15,0,8,103,0,8,39,0,9,174,0,8,7,0,8,135,0,8,71,0,9,238,80,7,9,0,8,95,0,8,31,0,9,158,84,7,99,0,8,127,0,8,63,0,9,222,82,7,27,0,8,111,0,8,47,0,9,190,0,8,15,0,8,143,0,8,79,0,9,254,96,7,256,0,8,80,0,8,16,84,8,115,82,7,31,0,8,112,0,8,48,0,9,193,80,7,10,0,8,96,0,8,32,0,9,161,0,8,0,0,8,128,0,8,64,0,9,225,80,7,6,0,8,88,0,8,24,0,9,145,83,7,59,0,8,120,0,8,56,0,9,209,81,7,17,0,8,104,0,8,40,0,9,177,0,8,8,0,8,136,0,8,72,0,9,241,80,7,4,0,8,84,0,8,20,85,8,227,83,7,43,0,8,116,0,8,52,0,9,201,81,7,13,0,8,100,0,8,36,0,9,169,0,8,4,0,8,132,0,8,68,0,9,233,80,7,8,0,8,92,0,8,28,0,9,153,84,7,83,0,8,124,0,8,60,0,9,217,82,7,23,0,8,108,0,8,44,0,9,185,0,8,12,0,8,140,0,8,76,0,9,249,80,7,3,0,8,82,0,8,18,85,8,163,83,7,35,0,8,114,0,8,50,0,9,197,81,7,11,0,8,98,0,8,34,0,9,165,0,8,2,0,8,130,0,8,66,0,9,229,80,7,7,0,8,90,0,8,26,0,9,149,84,7,67,0,8,122,0,8,58,0,9,213,82,7,19,0,8,106,0,8,42,0,9,181,0,8,10,0,8,138,0,8,74,0,9,245,80,7,5,0,8,86,0,8,22,192,8,0,83,7,51,0,8,118,0,8,54,0,9,205,81,7,15,0,8,102,0,8,38,0,9,173,0,8,6,0,8,134,0,8,70,0,9,237,80,7,9,0,8,94,0,8,30,0,9,157,84,7,99,0,8,126,0,8,62,0,9,221,82,7,27,0,8,110,0,8,46,0,9,189,0,8,14,0,8,142,0,8,78,0,9,253,96,7,256,0,8,81,0,8,17,85,8,131,82,7,31,0,8,113,0,8,49,0,9,195,80,7,10,0,8,97,0,8,33,0,9,163,0,8,1,0,8,129,0,8,65,0,9,227,80,7,6,0,8,89,0,8,25,0,9,147,83,7,59,0,8,121,0,8,57,0,9,211,81,7,17,0,8,105,0,8,41,0,9,179,0,8,9,0,8,137,0,8,73,0,9,243,80,7,4,0,8,85,0,8,21,80,8,258,83,7,43,0,8,117,0,8,53,0,9,203,81,7,13,0,8,101,0,8,37,0,9,171,0,8,5,0,8,133,0,8,69,0,9,235,80,7,8,0,8,93,0,8,29,0,9,155,84,7,83,0,8,125,0,8,61,0,9,219,82,7,23,0,8,109,0,8,45,0,9,187,0,8,13,0,8,141,0,8,77,0,9,251,80,7,3,0,8,83,0,8,19,85,8,195,83,7,35,0,8,115,0,8,51,0,9,199,81,7,11,0,8,99,0,8,35,0,9,167,0,8,3,0,8,131,0,8,67,0,9,231,80,7,7,0,8,91,0,8,27,0,9,151,84,7,67,0,8,123,0,8,59,0,9,215,82,7,19,0,8,107,0,8,43,0,9,183,0,8,11,0,8,139,0,8,75,0,9,247,80,7,5,0,8,87,0,8,23,192,8,0,83,7,51,0,8,119,0,8,55,0,9,207,81,7,15,0,8,103,0,8,39,0,9,175,0,8,7,0,8,135,0,8,71,0,9,239,80,7,9,0,8,95,0,8,31,0,9,159,84,7,99,0,8,127,0,8,63,0,9,223,82,7,27,0,8,111,0,8,47,0,9,191,0,8,15,0,8,143,0,8,79,0,9,255],b=[80,5,1,87,5,257,83,5,17,91,5,4097,81,5,5,89,5,1025,85,5,65,93,5,16385,80,5,3,88,5,513,84,5,33,92,5,8193,82,5,9,90,5,2049,86,5,129,192,5,24577,80,5,2,87,5,385,83,5,25,91,5,6145,81,5,7,89,5,1537,85,5,97,93,5,24577,80,5,4,88,5,769,84,5,49,92,5,12289,82,5,13,90,5,3073,86,5,193,192,5,24577],x=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],k=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,112,112],M=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],C=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13];t.prototype.inflateInit=function(t,n){return t||(t=c),n&&(n=!1),this.istate=new e,this.istate.inflateInit(this,n?-t:t)},t.prototype.inflate=function(t){return null==this.istate?-2:this.istate.inflate(this,t)},t.prototype.inflateEnd=function(){if(null==this.istate)return-2;var t=istate.inflateEnd(this);return this.istate=null,t},t.prototype.inflateSync=function(){return istate.inflateSync(this)},t.prototype.inflateSetDictionary=function(t,e){return istate.inflateSetDictionary(this,t,e)},e.prototype.inflateReset=function(t){return null==t||null==t.istate?-2:(t.total_in=t.total_out=0,t.msg=null,t.istate.mode=0!=t.istate.nowrap?7:0,t.istate.blocks.reset(t,null),f)},e.prototype.inflateEnd=function(t){return null!=this.blocks&&this.blocks.free(t),this.blocks=null,f},e.prototype.inflateInit=function(t,e){return t.msg=null,this.blocks=null,nowrap=0,e<0&&(e=-e,nowrap=1),e<8||e>15?(this.inflateEnd(t),-2):(this.wbits=e,t.istate.blocks=new n(t,0!=t.istate.nowrap?null:this,1<<e),this.inflateReset(t),f)},e.prototype.inflate=function(t,e){var n,i;if(null==t||null==t.istate||null==t.next_in)return-2;for(e=4==e?p:f,n=p;;)switch(t.istate.mode){case 0:if(0==t.avail_in)return n;if(n=e,t.avail_in--,t.total_in++,8!=(15&(t.istate.method=t.next_in[t.next_in_index++]))){t.istate.mode=13,t.msg="unknown compression method",t.istate.marker=5;break}if(8+(t.istate.method>>4)>t.istate.wbits){t.istate.mode=13,t.msg="invalid window size",t.istate.marker=5;break}t.istate.mode=1;case 1:if(0==t.avail_in)return n;if(n=e,t.avail_in--,t.total_in++,i=255&t.next_in[t.next_in_index++],((t.istate.method<<8)+i)%31!=0){t.istate.mode=13,t.msg="incorrect header check",t.istate.marker=5;break}if(0==(32&i)){t.istate.mode=7;break}t.istate.mode=2;case 2:if(0==t.avail_in)return n;n=e,t.avail_in--,t.total_in++,t.istate.need=(255&t.next_in[t.next_in_index++])<<24&4278190080,t.istate.mode=3;case 3:if(0==t.avail_in)return n;n=e,t.avail_in--,t.total_in++,t.istate.need+=(255&t.next_in[t.next_in_index++])<<16&16711680,t.istate.mode=4;case 4:if(0==t.avail_in)return n;n=e,t.avail_in--,t.total_in++,t.istate.need+=(255&t.next_in[t.next_in_index++])<<8&65280,t.istate.mode=5;case 5:return 0==t.avail_in?n:(n=e,t.avail_in--,t.total_in++,t.istate.need+=255&t.next_in[t.next_in_index++],t.adler=t.istate.need,t.istate.mode=6,2);case 6:return t.istate.mode=13,t.msg="need dictionary",t.istate.marker=0,-2;case 7:if(-3==(n=t.istate.blocks.proc(t,n))){t.istate.mode=13,t.istate.marker=0;break}if(n==f&&(n=e),n!=_)return n;if(n=e,t.istate.blocks.reset(t,t.istate.was),0!=t.istate.nowrap){t.istate.mode=12;break}t.istate.mode=8;case 8:if(0==t.avail_in)return n;n=e,t.avail_in--,t.total_in++,t.istate.need=(255&t.next_in[t.next_in_index++])<<24&4278190080,t.istate.mode=9;case 9:if(0==t.avail_in)return n;n=e,t.avail_in--,t.total_in++,t.istate.need+=(255&t.next_in[t.next_in_index++])<<16&16711680,t.istate.mode=10;case 10:if(0==t.avail_in)return n;n=e,t.avail_in--,t.total_in++,t.istate.need+=(255&t.next_in[t.next_in_index++])<<8&65280,t.istate.mode=11;case 11:if(0==t.avail_in)return n;if(n=e,t.avail_in--,t.total_in++,t.istate.need+=255&t.next_in[t.next_in_index++],t.istate.was[0]!=t.istate.need){t.istate.mode=13,t.msg="incorrect data check",t.istate.marker=5;break}t.istate.mode=12;case 12:return _;case 13:return-3;default:return-2}},e.prototype.inflateSetDictionary=function(t,e,n){var i=0,r=n;return null==t||null==t.istate||6!=t.istate.mode?-2:t._adler.adler32(1,e,0,n)!=t.adler?-3:(t.adler=t._adler.adler32(0,null,0,0),r>=1<<t.istate.wbits&&(r=(1<<t.istate.wbits)-1,i=n-r),t.istate.blocks.set_dictionary(e,i,r),t.istate.mode=7,f)};var S=[0,0,255,255];e.prototype.inflateSync=function(t){var e,n,i,r,a;if(null==t||null==t.istate)return-2;if(13!=t.istate.mode&&(t.istate.mode=13,t.istate.marker=0),0==(e=t.avail_in))return p;for(n=t.next_in_index,i=t.istate.marker;0!=e&&i<4;)t.next_in[n]==S[i]?i++:i=0!=t.next_in[n]?0:4-i,n++,e--;return t.total_in+=n-t.next_in_index,t.next_in_index=n,t.avail_in=e,t.istate.marker=i,4!=i?-3:(r=t.total_in,a=t.total_out,this.inflateReset(t),t.total_in=r,t.total_out=a,t.istate.mode=7,f)},e.prototype.inflateSyncPoint=function(t){return null==t||null==t.istate||null==t.istate.blocks?-2:t.istate.blocks.sync_point()};var T=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];n.prototype.reset=function(t,e){e&&(e[0]=this.check),6==this.mode&&this.codes.free(t),this.mode=g,this.bitk=0,this.bitb=0,this.read=this.write=0,this.checkfn&&(t.adler=this.check=t._adler.adler32(0,null,0,0))},n.prototype.proc=function(t,e){var n,i,r,s,l,u,c;for(s=t.next_in_index,l=t.avail_in,i=this.bitb,r=this.bitk,u=this.write,c=u<this.read?this.read-u-1:this.end-u;;)switch(this.mode){case g:for(;r<3;){if(0==l)return this.bitb=i,this.bitk=r,t.avail_in=l,t.total_in+=s-t.next_in_index,t.next_in_index=s,this.write=u,this.inflate_flush(t,e);e=f,l--,i|=(255&t.next_in[s++])<<r,r+=8}switch(n=7&i,this.last=1&n,n>>>1){case 0:i>>>=3,r-=3,n=7&r,i>>>=n,r-=n,this.mode=1;break;case 1:var h=new Int32Array(1),d=new Int32Array(1),p=[],m=[];a(h,d,p,m,t),this.codes.init(h[0],d[0],p[0],0,m[0],0,t),i>>>=3,r-=3,this.mode=6;break;case 2:i>>>=3,r-=3,this.mode=3;break;case 3:return i>>>=3,r-=3,this.mode=13,t.msg="invalid block type",e=-3,this.bitb=i,this.bitk=r,t.avail_in=l,t.total_in+=s-t.next_in_index,t.next_in_index=s,this.write=u,this.inflate_flush(t,e)}break;case 1:for(;r<32;){if(0==l)return this.bitb=i,this.bitk=r,t.avail_in=l,t.total_in+=s-t.next_in_index,t.next_in_index=s,this.write=u,this.inflate_flush(t,e);e=f,l--,i|=(255&t.next_in[s++])<<r,r+=8}if((~i>>>16&65535)!=(65535&i))return this.mode=13,t.msg="invalid stored block lengths",e=-3,this.bitb=i,this.bitk=r,t.avail_in=l,t.total_in+=s-t.next_in_index,t.next_in_index=s,this.write=u,this.inflate_flush(t,e);this.left=65535&i,i=r=0,this.mode=0!=this.left?2:0!=this.last?7:g;break;case 2:if(0==l)return this.bitb=i,this.bitk=r,t.avail_in=l,t.total_in+=s-t.next_in_index,t.next_in_index=s,write=u,this.inflate_flush(t,e);if(0==c&&(u==end&&0!=read&&(u=0,c=u<this.read?this.read-u-1:this.end-u),0==c&&(this.write=u,e=this.inflate_flush(t,e),u=this.write,c=u<this.read?this.read-u-1:this.end-u,u==this.end&&0!=this.read&&(u=0,c=u<this.read?this.read-u-1:this.end-u),0==c)))return this.bitb=i,this.bitk=r,t.avail_in=l,t.total_in+=s-t.next_in_index,t.next_in_index=s,this.write=u,this.inflate_flush(t,e);if(e=f,n=this.left,n>l&&(n=l),n>c&&(n=c),o(t.next_in,s,this.window,u,n),s+=n,l-=n,u+=n,c-=n,0!=(this.left-=n))break;this.mode=0!=this.last?7:g;break;case 3:for(;r<14;){if(0==l)return this.bitb=i,this.bitk=r,t.avail_in=l,t.total_in+=s-t.next_in_index,t.next_in_index=s,this.write=u,this.inflate_flush(t,e);e=f,l--,i|=(255&t.next_in[s++])<<r,r+=8}if(this.table=n=16383&i,(31&n)>29||(n>>5&31)>29)return this.mode=9,t.msg="too many length or distance symbols",e=-3,this.bitb=i,this.bitk=r,t.avail_in=l,t.total_in+=s-t.next_in_index,t.next_in_index=s,this.write=u,this.inflate_flush(t,e);if(n=258+(31&n)+(n>>5&31),null==this.blens||this.blens.length<n)this.blens=new Int32Array(n);else for(var y=0;y<n;y++)this.blens[y]=0;i>>>=14,r-=14,this.index=0,mode=4;case 4:for(;this.index<4+(this.table>>>10);){for(;r<3;){if(0==l)return this.bitb=i,this.bitk=r,t.avail_in=l,t.total_in+=s-t.next_in_index,t.next_in_index=s,this.write=u,this.inflate_flush(t,e);e=f,l--,i|=(255&t.next_in[s++])<<r,r+=8}this.blens[T[this.index++]]=7&i,i>>>=3,r-=3}for(;this.index<19;)this.blens[T[this.index++]]=0;if(this.bb[0]=7,(n=this.inftree.inflate_trees_bits(this.blens,this.bb,this.tb,this.hufts,t))!=f)return e=n,-3==e&&(this.blens=null,this.mode=9),this.bitb=i,this.bitk=r,t.avail_in=l,t.total_in+=s-t.next_in_index,t.next_in_index=s,write=u,this.inflate_flush(t,e);this.index=0,this.mode=5;case 5:for(;;){if(n=this.table,!(this.index<258+(31&n)+(n>>5&31)))break;var y,w,b;for(n=this.bb[0];r<n;){if(0==l)return this.bitb=i,this.bitk=r,t.avail_in=l,t.total_in+=s-t.next_in_index,t.next_in_index=s,this.write=u,this.inflate_flush(t,e);e=f,l--,i|=(255&t.next_in[s++])<<r,r+=8}if(n=this.hufts[3*(this.tb[0]+(i&v[n]))+1],(b=this.hufts[3*(this.tb[0]+(i&v[n]))+2])<16)i>>>=n,r-=n,this.blens[this.index++]=b;else{for(y=18==b?7:b-14,w=18==b?11:3;r<n+y;){if(0==l)return this.bitb=i,this.bitk=r,t.avail_in=l,t.total_in+=s-t.next_in_index,t.next_in_index=s,this.write=u,this.inflate_flush(t,e);e=f,l--,i|=(255&t.next_in[s++])<<r,r+=8}if(i>>>=n,r-=n,w+=i&v[y],i>>>=y,r-=y,y=this.index,n=this.table,y+w>258+(31&n)+(n>>5&31)||16==b&&y<1)return this.blens=null,this.mode=9,t.msg="invalid bit length repeat",e=-3,this.bitb=i,this.bitk=r,t.avail_in=l,t.total_in+=s-t.next_in_index,t.next_in_index=s,this.write=u,this.inflate_flush(t,e);b=16==b?this.blens[y-1]:0;do{this.blens[y++]=b}while(0!=--w);this.index=y}}this.tb[0]=-1;var h=new Int32Array(1),d=new Int32Array(1),p=new Int32Array(1),m=new Int32Array(1);if(h[0]=9,d[0]=6,n=this.table,(n=this.inftree.inflate_trees_dynamic(257+(31&n),1+(n>>5&31),this.blens,h,d,p,m,this.hufts,t))!=f)return-3==n&&(this.blens=null,this.mode=13),e=n,this.bitb=i,this.bitk=r,t.avail_in=l,t.total_in+=s-t.next_in_index,t.next_in_index=s,this.write=u,this.inflate_flush(t,e);this.codes.init(h[0],d[0],this.hufts,p[0],this.hufts,m[0],t),this.mode=6;case 6:if(this.bitb=i,this.bitk=r,t.avail_in=l,t.total_in+=s-t.next_in_index,t.next_in_index=s,this.write=u,(e=this.codes.proc(this,t,e))!=_)return this.inflate_flush(t,e);if(e=f,this.codes.free(t),s=t.next_in_index,l=t.avail_in,i=this.bitb,r=this.bitk,u=this.write,c=u<this.read?this.read-u-1:this.end-u,0==this.last){this.mode=g;break}this.mode=7;case 7:if(this.write=u,e=this.inflate_flush(t,e),u=this.write,c=u<this.read?this.read-u-1:this.end-u,this.read!=this.write)return this.bitb=i,this.bitk=r,t.avail_in=l,t.total_in+=s-t.next_in_index,t.next_in_index=s,this.write=u,this.inflate_flush(t,e);mode=12;case 8:return e=_,this.bitb=i,this.bitk=r,t.avail_in=l,t.total_in+=s-t.next_in_index,t.next_in_index=s,this.write=u,this.inflate_flush(t,e);case 9:return e=-3,this.bitb=i,this.bitk=r,t.avail_in=l,t.total_in+=s-t.next_in_index,t.next_in_index=s,this.write=u,this.inflate_flush(t,e);default:return e=-2,this.bitb=i,this.bitk=r,t.avail_in=l,t.total_in+=s-t.next_in_index,t.next_in_index=s,this.write=u,this.inflate_flush(t,e)}},n.prototype.free=function(t){this.reset(t,null),this.window=null,this.hufts=null},n.prototype.set_dictionary=function(t,e,n){o(t,e,window,0,n),this.read=this.write=n},n.prototype.sync_point=function(){return 1==this.mode},n.prototype.inflate_flush=function(t,e){var n,i,r;return i=t.next_out_index,r=this.read,n=(r<=this.write?this.write:this.end)-r,n>t.avail_out&&(n=t.avail_out),0!=n&&e==p&&(e=f),t.avail_out-=n,t.total_out+=n,null!=this.checkfn&&(t.adler=this.check=t._adler.adler32(this.check,this.window,r,n)),o(this.window,r,t.next_out,i,n),i+=n,r+=n,r==this.end&&(r=0,this.write==this.end&&(this.write=0),n=this.write-r,n>t.avail_out&&(n=t.avail_out),0!=n&&e==p&&(e=f),t.avail_out-=n,t.total_out+=n,null!=this.checkfn&&(t.adler=this.check=t._adler.adler32(this.check,this.window,r,n)),o(this.window,r,t.next_out,i,n),i+=n,r+=n),t.next_out_index=i,this.read=r,e};i.prototype.init=function(t,e,n,i,r,a,o){this.mode=0,this.lbits=t,this.dbits=e,this.ltree=n,this.ltree_index=i,this.dtree=r,this.dtree_index=a,this.tree=null},i.prototype.proc=function(t,e,n){var i,r,a,o,s,l,u,c=0,h=0,d=0;for(d=e.next_in_index,o=e.avail_in,c=t.bitb,h=t.bitk,s=t.write,l=s<t.read?t.read-s-1:t.end-s;;)switch(this.mode){case 0:if(l>=258&&o>=10&&(t.bitb=c,t.bitk=h,e.avail_in=o,e.total_in+=d-e.next_in_index,e.next_in_index=d,t.write=s,n=this.inflate_fast(this.lbits,this.dbits,this.ltree,this.ltree_index,this.dtree,this.dtree_index,t,e),d=e.next_in_index,o=e.avail_in,c=t.bitb,h=t.bitk,s=t.write,l=s<t.read?t.read-s-1:t.end-s,n!=f)){this.mode=n==_?7:9;break}this.need=this.lbits,this.tree=this.ltree,this.tree_index=this.ltree_index,this.mode=1;case 1:for(i=this.need;h<i;){if(0==o)return t.bitb=c,t.bitk=h,e.avail_in=o,e.total_in+=d-e.next_in_index,e.next_in_index=d,t.write=s,t.inflate_flush(e,n);n=f,o--,c|=(255&e.next_in[d++])<<h,h+=8}if(r=3*(this.tree_index+(c&v[i])),c>>>=this.tree[r+1],h-=this.tree[r+1],0==(a=this.tree[r])){this.lit=this.tree[r+2],this.mode=6;break}if(0!=(16&a)){this.get=15&a,this.len=this.tree[r+2],this.mode=2;break}if(0==(64&a)){this.need=a,this.tree_index=r/3+this.tree[r+2];break}if(0!=(32&a)){this.mode=7;break}return this.mode=9,e.msg="invalid literal/length code",n=-3,t.bitb=c,t.bitk=h,e.avail_in=o,e.total_in+=d-e.next_in_index,e.next_in_index=d,t.write=s,t.inflate_flush(e,n);case 2:for(i=this.get;h<i;){if(0==o)return t.bitb=c,t.bitk=h,e.avail_in=o,e.total_in+=d-e.next_in_index,e.next_in_index=d,t.write=s,t.inflate_flush(e,n);n=f,o--,c|=(255&e.next_in[d++])<<h,h+=8}this.len+=c&v[i],c>>=i,h-=i,this.need=this.dbits,this.tree=this.dtree,this.tree_index=this.dtree_index,this.mode=3;case 3:for(i=this.need;h<i;){if(0==o)return t.bitb=c,t.bitk=h,e.avail_in=o,e.total_in+=d-e.next_in_index,e.next_in_index=d,t.write=s,t.inflate_flush(e,n);n=f,o--,c|=(255&e.next_in[d++])<<h,h+=8}if(r=3*(this.tree_index+(c&v[i])),c>>=this.tree[r+1],h-=this.tree[r+1],0!=(16&(a=this.tree[r]))){this.get=15&a,this.dist=this.tree[r+2],this.mode=4;break}if(0==(64&a)){this.need=a,this.tree_index=r/3+this.tree[r+2];break}return this.mode=9,e.msg="invalid distance code",n=-3,t.bitb=c,t.bitk=h,e.avail_in=o,e.total_in+=d-e.next_in_index,e.next_in_index=d,t.write=s,t.inflate_flush(e,n);case 4:for(i=this.get;h<i;){if(0==o)return t.bitb=c,t.bitk=h,e.avail_in=o,e.total_in+=d-e.next_in_index,e.next_in_index=d,t.write=s,t.inflate_flush(e,n);n=f,o--,c|=(255&e.next_in[d++])<<h,h+=8}this.dist+=c&v[i],c>>=i,h-=i,this.mode=5;case 5:for(u=s-this.dist;u<0;)u+=t.end;for(;0!=this.len;){if(0==l&&(s==t.end&&0!=t.read&&(s=0,l=s<t.read?t.read-s-1:t.end-s),0==l&&(t.write=s,n=t.inflate_flush(e,n),s=t.write,l=s<t.read?t.read-s-1:t.end-s,s==t.end&&0!=t.read&&(s=0,l=s<t.read?t.read-s-1:t.end-s),0==l)))return t.bitb=c,t.bitk=h,e.avail_in=o,e.total_in+=d-e.next_in_index,e.next_in_index=d,t.write=s,t.inflate_flush(e,n);t.window[s++]=t.window[u++],l--,u==t.end&&(u=0),this.len--}this.mode=0;break;case 6:if(0==l&&(s==t.end&&0!=t.read&&(s=0,l=s<t.read?t.read-s-1:t.end-s),0==l&&(t.write=s,n=t.inflate_flush(e,n),s=t.write,l=s<t.read?t.read-s-1:t.end-s,s==t.end&&0!=t.read&&(s=0,l=s<t.read?t.read-s-1:t.end-s),0==l)))return t.bitb=c,t.bitk=h,e.avail_in=o,e.total_in+=d-e.next_in_index,e.next_in_index=d,t.write=s,t.inflate_flush(e,n);n=f,t.window[s++]=this.lit,l--,this.mode=0;break;case 7:if(h>7&&(h-=8,o++,d--),t.write=s,n=t.inflate_flush(e,n),s=t.write,l=s<t.read?t.read-s-1:t.end-s,t.read!=t.write)return t.bitb=c,t.bitk=h,e.avail_in=o,e.total_in+=d-e.next_in_index,e.next_in_index=d,t.write=s,t.inflate_flush(e,n);this.mode=8;case 8:return n=_,t.bitb=c,t.bitk=h,e.avail_in=o,e.total_in+=d-e.next_in_index,e.next_in_index=d,t.write=s,t.inflate_flush(e,n);case 9:return n=-3,t.bitb=c,t.bitk=h,e.avail_in=o,e.total_in+=d-e.next_in_index,e.next_in_index=d,t.write=s,t.inflate_flush(e,n);default:return n=-2,t.bitb=c,t.bitk=h,e.avail_in=o,e.total_in+=d-e.next_in_index,e.next_in_index=d,t.write=s,t.inflate_flush(e,n)}},i.prototype.free=function(t){},i.prototype.inflate_fast=function(t,e,n,i,r,a,s,l){var u,c,h,d,p,g,m,y,w,b,x,k,M,C,S,T;m=l.next_in_index,y=l.avail_in,p=s.bitb,g=s.bitk,w=s.write,b=w<s.read?s.read-w-1:s.end-w,x=v[t],k=v[e];do{for(;g<20;)y--,p|=(255&l.next_in[m++])<<g,g+=8;if(u=p&x,c=n,h=i,T=3*(h+u),0!=(d=c[T]))for(;;){if(p>>=c[T+1],g-=c[T+1],0!=(16&d)){for(d&=15,M=c[T+2]+(p&v[d]),p>>=d,g-=d;g<15;)y--,p|=(255&l.next_in[m++])<<g,g+=8;for(u=p&k,c=r,h=a,T=3*(h+u),d=c[T];;){if(p>>=c[T+1],g-=c[T+1],0!=(16&d)){for(d&=15;g<d;)y--,p|=(255&l.next_in[m++])<<g,g+=8;if(C=c[T+2]+(p&v[d]),p>>=d,g-=d,b-=M,w>=C)S=w-C,s.window[w++]=s.window[S++],s.window[w++]=s.window[S++],M-=2;else{S=w-C;do{S+=s.end}while(S<0);if(d=s.end-S,M>d){if(M-=d,w-S>0&&d>w-S)do{s.window[w++]=s.window[S++]}while(0!=--d);else o(s.window,S,s.window,w,d),w+=d,S+=d,d=0;S=0}}do{s.window[w++]=s.window[S++]}while(0!=--M);break}if(0!=(64&d))return l.msg="invalid distance code",M=l.avail_in-y,M=g>>3<M?g>>3:M,y+=M,m-=M,g-=M<<3,s.bitb=p,s.bitk=g,l.avail_in=y,l.total_in+=m-l.next_in_index,l.next_in_index=m,s.write=w,-3;u+=c[T+2],u+=p&v[d],T=3*(h+u),d=c[T]}break}if(0!=(64&d))return 0!=(32&d)?(M=l.avail_in-y,M=g>>3<M?g>>3:M,y+=M,m-=M,g-=M<<3,s.bitb=p,s.bitk=g,l.avail_in=y,l.total_in+=m-l.next_in_index,l.next_in_index=m,s.write=w,_):(l.msg="invalid literal/length code",M=l.avail_in-y,M=g>>3<M?g>>3:M,y+=M,m-=M,g-=M<<3,s.bitb=p,s.bitk=g,l.avail_in=y,l.total_in+=m-l.next_in_index,l.next_in_index=m,s.write=w,-3);if(u+=c[T+2],u+=p&v[d],T=3*(h+u),0==(d=c[T])){p>>=c[T+1],g-=c[T+1],s.window[w++]=c[T+2],b--;break}}else p>>=c[T+1],g-=c[T+1],s.window[w++]=c[T+2],b--}while(b>=258&&y>=10);return M=l.avail_in-y,M=g>>3<M?g>>3:M,y+=M,m-=M,g-=M<<3,s.bitb=p,s.bitk=g,l.avail_in=y,l.total_in+=m-l.next_in_index,l.next_in_index=m,s.write=w,f},r.prototype.huft_build=function(t,e,n,i,r,a,s,l,u,c,d){var _,v,g,m,y,w,b,x,k,M,C,S,T,A,z;M=0,y=n;do{this.c[t[e+M]]++,M++,y--}while(0!=y);if(this.c[0]==n)return s[0]=-1,l[0]=0,f;for(x=l[0],w=1;w<=15&&0==this.c[w];w++);for(b=w,x<w&&(x=w),y=15;0!=y&&0==this.c[y];y--);for(g=y,x>y&&(x=y),l[0]=x,A=1<<w;w<y;w++,A<<=1)if((A-=this.c[w])<0)return-3;if((A-=this.c[y])<0)return-3;for(this.c[y]+=A,this.x[1]=w=0,M=1,T=2;0!=--y;)this.x[T]=w+=this.c[M],T++,M++;y=0,M=0;do{0!=(w=t[e+M])&&(this.v[this.x[w]++]=y),M++}while(++y<n);for(n=this.x[g],this.x[0]=y=0,M=0,m=-1,S=-x,this.u[0]=0,C=0,z=0;b<=g;b++)for(_=this.c[b];0!=_--;){for(;b>S+x;){if(m++,S+=x,z=g-S,z=z>x?x:z,(v=1<<(w=b-S))>_+1&&(v-=_+1,T=b,w<z))for(;++w<z&&!((v<<=1)<=this.c[++T]);)v-=this.c[T];if(z=1<<w,this.hn[0]+z>h)return-3;this.u[m]=C=this.hn[0],this.hn[0]+=z,0!=m?(this.x[m]=y,this.r[0]=w,this.r[1]=x,w=y>>>S-x,this.r[2]=C-this.u[m-1]-w,o(this.r,0,u,3*(this.u[m-1]+w),3)):s[0]=C}for(this.r[1]=b-S,M>=n?this.r[0]=192:d[M]<i?(this.r[0]=this.v[M]<256?0:96,this.r[2]=this.v[M++]):(this.r[0]=a[this.v[M]-i]+16+64,this.r[2]=r[this.v[M++]-i]),v=1<<b-S,w=y>>>S;w<z;w+=v)o(this.r,0,u,3*(C+w),3);for(w=1<<b-1;0!=(y&w);w>>>=1)y^=w;for(y^=w,k=(1<<S)-1;(y&k)!=this.x[m];)m--,S-=x,k=(1<<S)-1}return 0!=A&&1!=g?p:f},r.prototype.inflate_trees_bits=function(t,e,n,i,r){var a;return this.initWorkArea(19),this.hn[0]=0,a=this.huft_build(t,0,19,19,null,null,n,e,i,this.hn,this.v),-3==a?r.msg="oversubscribed dynamic bit lengths tree":a!=p&&0!=e[0]||(r.msg="incomplete dynamic bit lengths tree",a=-3),a},r.prototype.inflate_trees_dynamic=function(t,e,n,i,r,a,o,s,l){var u;return this.initWorkArea(288),this.hn[0]=0,(u=this.huft_build(n,0,t,257,x,k,a,i,s,this.hn,this.v))!=f||0==i[0]?(-3==u?l.msg="oversubscribed literal/length tree":-4!=u&&(l.msg="incomplete literal/length tree",u=-3),u):(this.initWorkArea(288),u=this.huft_build(n,t,e,0,M,C,o,r,s,this.hn,this.v),u!=f||0==r[0]&&t>257?(-3==u?l.msg="oversubscribed distance tree":u==p?(l.msg="incomplete distance tree",u=-3):-4!=u&&(l.msg="empty distance tree with lengths",u=-3),u):f)},r.prototype.initWorkArea=function(t){null==this.hn&&(this.hn=new Int32Array(1),this.v=new Int32Array(t),this.c=new Int32Array(16),this.r=new Int32Array(3),this.u=new Int32Array(15),this.x=new Int32Array(16)),this.v.length<t&&(this.v=new Int32Array(t));for(var e=0;e<t;e++)this.v[e]=0;for(var e=0;e<16;e++)this.c[e]=0;for(var e=0;e<3;e++)this.r[e]=0;o(this.c,0,this.u,0,15),o(this.c,0,this.x,0,16)};var A=new Uint8Array(1),z="function"==typeof A.subarray;return{inflateBuffer:u,arrayCopy:o}}.apply(e,i))&&(t.exports=r)},38:function(t,e,n){(function(i){var r,a,o;!function(i,s){a=[n(0)],r=s,void 0!==(o="function"==typeof r?r.apply(e,a):r)&&(t.exports=o)}(0,function(t){var e=t.ajaxSettings;e.responseFields.native="responseNative",e.converters["* native"]=!0;var n={},r=0,a={0:200,1223:204},o={},s=i.ajaxSettings.xhr();window.ActiveXObject&&t(window).on("unload",function(){for(var t in o)o[t]()}),n.cors=!!s&&"withCredentials"in s,n.ajax=s=!!s,t.ajaxTransport("native",function(t){var e;if(n.cors||s&&!t.crossDomain)return{send:function(n,i){var s,l=t.xhr(),u=++r,c={};if(l.open(t.type,t.url,t.async,t.username,t.password),t.xhrFields)for(s in t.xhrFields)l[s]=t.xhrFields[s];t.mimeType&&l.overrideMimeType&&l.overrideMimeType(t.mimeType),t.crossDomain||n["X-Requested-With"]||(n["X-Requested-With"]="XMLHttpRequest");for(s in n)l.setRequestHeader(s,n[s]);e=function(t){return function(){e&&(delete o[u],e=l.onload=l.onerror=null,"abort"===t?l.abort():"error"===t?i(l.status,l.statusText):(l.response&&(c.native=l.response),i(a[l.status]||l.status,l.statusText,c,l.getAllResponseHeaders())))}},l.onload=e(),l.onerror=e("error"),e=o[u]=e("abort");try{l.send(t.hasContent&&t.data||null)}catch(t){if(e)throw t}},abort:function(){e&&e()}}}),t.getNative=function(e,n){return t.ajax({dataType:"native",url:e,xhrFields:{responseType:"arraybuffer"},success:n})}})}).call(e,n(0))},7:function(t,e,n){"use strict";(function(t,i){function r(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var a=n(1),o=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(a),s=n(10),l=r(s),u=n(8),c=r(u),h=n(11),d=r(h),f=n(12),_=r(f),p=n(20),v=r(p),g=n(6),m=(r(g),{toJSON:function(){var t=this,e={};return o.each(t.constructor.to_json_keys,function(n){var i=t.get(n);n in t.constructor.to_json_mappers&&(i=t.constructor.to_json_mappers[n](i,t)),e[n]=i}),e}}),y=function(e,n){var i=new _.default({url_base:Galaxy.root+"visualization/list_history_datasets",filters:e,dict_format:!0,embedded:!0}),r=new _.default({url_base:Galaxy.root+"visualization/list_library_datasets",dict_format:!0,embedded:!0}),a=new v.default.View;a.add({id:"histories",title:"Histories",$el:t("<div/>").append(i.$el)}),a.add({id:"libraries",title:"Libraries",$el:t("<div/>").append(r.$el)}),Galaxy.modal.show({title:"Select datasets for new tracks",body:a.$el,closing_events:!0,buttons:{Cancel:function(){Galaxy.modal.hide()},Add:function(){var e=[];a.$("input.grid-row-select-checkbox[name=id]:checked").each(function(){window.console.log(t(this).val()),e[e.length]=t.ajax({url:Galaxy.root+"api/datasets/"+t(this).val(),dataType:"json",data:{data_type:"track_config",hda_ldda:"histories"==a.current()?"hda":"ldda"}})}),t.when.apply(t,e).then(function(){var e=arguments[0]instanceof Array?t.map(arguments,function(t){return t[0]}):[arguments[0]];n(e)}),Galaxy.modal.hide()}}})},w=function(t){this.default_font=void 0!==t?t:"9px Monaco, Lucida Console, monospace",this.dummy_canvas=this.new_canvas(),this.dummy_context=this.dummy_canvas.getContext("2d"),this.dummy_context.font=this.default_font,this.char_width_px=this.dummy_context.measureText("A").width,this.patterns={},this.load_pattern("right_strand","/visualization/strand_right.png"),this.load_pattern("left_strand","/visualization/strand_left.png"),this.load_pattern("right_strand_inv","/visualization/strand_right_inv.png"),this.load_pattern("left_strand_inv","/visualization/strand_left_inv.png")};o.extend(w.prototype,{load_pattern:function(t,e){var n=this.patterns,i=this.dummy_context,r=new Image;r.src=Galaxy.root+"static/images"+e,r.onload=function(){n[t]=i.createPattern(r,"repeat")}},get_pattern:function(t){return this.patterns[t]},new_canvas:function(){var e=t("<canvas/>")[0];return e.manager=this,e}});var b=i.Model.extend({defaults:{num_elements:20,obj_cache:null,key_ary:null},initialize:function(t){this.clear()},get_elt:function(t){var e=this.attributes.obj_cache,n=this.attributes.key_ary,i=t.toString(),r=o.indexOf(n,function(t){return t.toString()===i});return-1!==r&&(e[i].stale?(n.splice(r,1),delete e[i]):this.move_key_to_end(t,r)),e[i]},set_elt:function(t,e){var n=this.attributes.obj_cache,i=this.attributes.key_ary,r=t.toString(),a=this.attributes.num_elements;if(!n[r]){if(i.length>=a){delete n[i.shift().toString()]}i.push(t)}return n[r]=e,e},move_key_to_end:function(t,e){this.attributes.key_ary.splice(e,1),this.attributes.key_ary.push(t)},clear:function(){this.attributes.obj_cache={},this.attributes.key_ary=[]},size:function(){return this.attributes.key_ary.length},most_recently_added:function(){return 0===this.size()?null:this.attributes.key_ary[this.attributes.key_ary.length-1]}}),x=b.extend({defaults:o.extend({},b.prototype.defaults,{dataset:null,genome:null,init_data:null,min_region_size:200,filters_manager:null,data_type:"data",data_mode_compatible:function(t,e){return!0},can_subset:function(t){return!1}}),initialize:function(t){b.prototype.initialize.call(this);var e=this.get("init_data");e&&this.add_data(e)},add_data:function(t){this.get("num_elements")<t.length&&this.set("num_elements",t.length);var e=this;o.each(t,function(t){e.set_data(t.region,t)})},data_is_ready:function(){var e=this.get("dataset"),n=t.Deferred(),i="raw_data"===this.get("data_type")?"state":"data"===this.get("data_type")?"converted_datasets_state":"error",r=new c.default.ServerStateDeferred({ajax_settings:{url:this.get("dataset").url(),data:{hda_ldda:e.get("hda_ldda"),data_type:i},dataType:"json"},interval:5e3,success_fn:function(t){return"pending"!==t}});return t.when(r.go()).then(function(t){n.resolve("ok"===t||"data"===t)}),n},search_features:function(e){var n=this.get("dataset"),i={query:e,hda_ldda:n.get("hda_ldda"),data_type:"features"};return t.getJSON(n.url(),i)},load_data:function(e,n,i,r){var a=this.get("dataset"),o={data_type:this.get("data_type"),chrom:e.get("chrom"),low:e.get("start"),high:e.get("end"),mode:n,resolution:i,hda_ldda:a.get("hda_ldda")};t.extend(o,r);var s=this.get("filters_manager");if(s){for(var l=[],u=s.filters,c=0;c<u.length;c++)l.push(u[c].name);o.filter_cols=JSON.stringify(l)}var h=this,d=t.getJSON(a.url(),o,function(t){t.region=e,h.set_data(e,t)});return this.set_data(e,d),d},get_data:function(t,e,n,i){var r=this.get_elt(t);if(r&&(c.default.is_deferred(r)||this.get("data_mode_compatible")(r,e)))return r;for(var a,o,s=this.get("key_ary"),l=this.get("obj_cache"),u=0;u<s.length;u++)if(a=s[u],a.contains(t)&&(o=!0,r=l[a.toString()],c.default.is_deferred(r)||this.get("data_mode_compatible")(r,e)&&this.get("can_subset")(r))){if(this.move_key_to_end(a,u),!c.default.is_deferred(r)){var h=this.subset_entry(r,t);this.set_data(t,h),r=h}return r}if(!o&&t.length()<this.attributes.min_region_size){t=t.copy();var d=this.most_recently_added();!d||t.get("start")>d.get("start")?t.set("end",t.get("start")+this.attributes.min_region_size):t.set("start",t.get("end")-this.attributes.min_region_size),t.set("genome",this.attributes.genome),t.trim()}return this.load_data(t,e,n,i)},set_data:function(t,e){this.set_elt(t,e)},DEEP_DATA_REQ:"deep",BROAD_DATA_REQ:"breadth",get_more_data:function(e,n,i,r,a){var o=this._mark_stale(e);if(!o||!this.get("data_mode_compatible")(o,n))return void console.log("ERROR: problem with getting more data: current data is not compatible");var s=e.get("start");a===this.DEEP_DATA_REQ?t.extend(r,{start_val:o.data.length+1}):a===this.BROAD_DATA_REQ&&(s=(o.max_high?o.max_high:o.data[o.data.length-1][2])+1);var l=e.copy().set("start",s),u=this,c=this.load_data(l,n,i,r),h=t.Deferred();return this.set_data(e,h),t.when(c).then(function(t){t.data&&(t.data=o.data.concat(t.data),t.max_low&&(t.max_low=o.max_low),t.message&&(t.message=t.message.replace(/[0-9]+/,t.data.length))),u.set_data(e,t),h.resolve(t)}),h},can_get_more_detailed_data:function(t){var e=this.get_elt(t);return"bigwig"===e.dataset_type&&e.data.length<8e3},get_more_detailed_data:function(t,e,n,i,r){var a=this._mark_stale(t);return a?(r||(r={}),"bigwig"===a.dataset_type&&(r.num_samples=1e3*i),this.load_data(t,e,n,r)):void console.log("ERROR getting more detailed data: no current data")},_mark_stale:function(t){var e=this.get_elt(t);return e||console.log("ERROR: no data to mark as stale: ",this.get("dataset"),t.toString()),e.stale=!0,e},get_genome_wide_data:function(e){var n=this,i=!0,r=o.map(e.get("chroms_info").chrom_info,function(t){var e=n.get_elt(new C({chrom:t.chrom,start:0,end:t.len}));return e||(i=!1),e});if(i)return r;var a=t.Deferred();return t.getJSON(this.get("dataset").url(),{data_type:"genome_data"},function(t){n.add_data(t.data),a.resolve(t.data)}),a},subset_entry:function(t,e){var n={bigwig:function(t,e){return o.filter(t,function(t){return t[0]>=e.get("start")&&t[0]<=e.get("end")})},refseq:function(e,n){var i=n.get("start")-t.region.get("start");return t.data.slice(i,i+n.length())}},i=t.data;return!t.region.same(e)&&t.dataset_type in n&&(i=n[t.dataset_type](t.data,e)),{region:e,data:i,dataset_type:t.dataset_type}}}),k=x.extend({initialize:function(t){var e=new i.Model;e.urlRoot=t.data_url,this.set("dataset",e)},load_data:function(t,e,n,i){return t.length()<=1e5?x.prototype.load_data.call(this,t,e,n,i):{data:null,region:t}}}),M=i.Model.extend({defaults:{name:null,key:null,chroms_info:null},initialize:function(t){this.id=t.dbkey},get_chroms_info:function(){return this.attributes.chroms_info.chrom_info},get_chrom_region:function(t){var e=o.find(this.get_chroms_info(),function(e){return e.chrom===t});return new C({chrom:e.chrom,end:e.len})},get_chrom_len:function(t){return o.find(this.get_chroms_info(),function(e){return e.chrom===t}).len}}),C=i.Model.extend({defaults:{chrom:null,start:0,end:0,str_val:null,genome:null},same:function(t){return this.attributes.chrom===t.get("chrom")&&this.attributes.start===t.get("start")&&this.attributes.end===t.get("end")},initialize:function(t){if(t.from_str){var e=t.from_str.split(":"),n=e[0],i=e[1].split("-");this.set({chrom:n,start:parseInt(i[0],10),end:parseInt(i[1],10)})}this.attributes.str_val=this.get("chrom")+":"+this.get("start")+"-"+this.get("end"),this.on("change",function(){this.attributes.str_val=this.get("chrom")+":"+this.get("start")+"-"+this.get("end")},this)},copy:function(){return new C({chrom:this.get("chrom"),start:this.get("start"),end:this.get("end")})},length:function(){return this.get("end")-this.get("start")},toString:function(){return this.attributes.str_val},toJSON:function(){return{chrom:this.get("chrom"),start:this.get("start"),end:this.get("end")}},compute_overlap:function(t){var e=this.get("chrom"),n=t.get("chrom"),i=this.get("start"),r=t.get("start"),a=this.get("end"),o=t.get("end");return e&&n&&e!==n?C.overlap_results.DIF_CHROMS:i<r?a<r?C.overlap_results.BEFORE:a<o?C.overlap_results.OVERLAP_START:C.overlap_results.CONTAINS:i>r?i>o?C.overlap_results.AFTER:a<=o?C.overlap_results.CONTAINED_BY:C.overlap_results.OVERLAP_END:a>=o?C.overlap_results.CONTAINS:C.overlap_results.CONTAINED_BY},trim:function(t){if(this.attributes.start<0&&(this.attributes.start=0),this.attributes.genome){var e=this.attributes.genome.get_chrom_len(this.attributes.chrom);this.attributes.end>e&&(this.attributes.end=e-1)}return this},contains:function(t){return this.compute_overlap(t)===C.overlap_results.CONTAINS},overlaps:function(t){return 0===o.intersection([this.compute_overlap(t)],[C.overlap_results.DIF_CHROMS,C.overlap_results.BEFORE,C.overlap_results.AFTER]).length}},{overlap_results:{DIF_CHROMS:1e3,BEFORE:1001,CONTAINS:1002,OVERLAP_START:1003,OVERLAP_END:1004,CONTAINED_BY:1005,AFTER:1006}}),S=i.Collection.extend({model:C}),T=i.Model.extend({defaults:{region:null,note:""},initialize:function(t){this.set("region",new C(t.region))}}),A=i.Collection.extend({model:T}),z=i.Model.extend(m).extend({defaults:{mode:"Auto"},initialize:function(t){this.set("dataset",new l.default.Dataset(t.dataset));var e=[{key:"name",default_value:this.get("dataset").get("name")},{key:"color"},{key:"min_value",label:"Min Value",type:"float",default_value:0},{key:"max_value",label:"Max Value",type:"float",default_value:1}];this.set("config",d.default.ConfigSettingCollection.from_models_and_saved_values(e,t.prefs));var n=this.get("preloaded_data");n=n?n.data:[],this.set("data_manager",new x({dataset:this.get("dataset"),init_data:n}))}},{to_json_keys:["track_type","dataset","prefs","mode","filters","tool_state"],to_json_mappers:{prefs:function(t,e){return 0===o.size(t)&&(t={name:e.get("config").get("name").get("value"),color:e.get("config").get("color").get("value")}),t},dataset:function(t){return{id:t.id,hda_ldda:t.get("hda_ldda")}}}}),N=i.Collection.extend({model:z}),E=i.Model.extend({defaults:{title:"",type:""},urlRoot:Galaxy.root+"api/visualizations",save:function(){return t.ajax({url:this.url(),type:"POST",dataType:"json",data:{vis_json:JSON.stringify(this)}})}}),R=E.extend(m).extend({defaults:o.extend({},E.prototype.defaults,{dbkey:"",drawables:null,bookmarks:null,viewport:null}),initialize:function(t){this.set("drawables",new N(t.tracks));var e=[];this.set("config",d.default.ConfigSettingCollection.from_models_and_saved_values(e,t.prefs)),this.unset("tracks"),this.get("drawables").each(function(t){t.unset("preloaded_data")})},add_tracks:function(t){this.get("drawables").add(t)}},{to_json_keys:["view","viewport","bookmarks"],to_json_mappers:{view:function(t,e){return{obj_type:"View",prefs:{name:e.get("title"),content_visible:!0},drawables:e.get("drawables")}}}}),O=i.Router.extend({initialize:function(t){this.view=t.view,this.route(/([\w]+)$/,"change_location"),this.route(/([\w\+]+\:[\d,]+-[\d,]+)$/,"change_location");var e=this;e.view.on("navigate",function(t){e.navigate(t)})},change_location:function(t){this.view.go_to(t)}});e.default={BackboneTrack:z,BrowserBookmark:T,BrowserBookmarkCollection:A,Cache:b,CanvasManager:w,Genome:M,GenomeDataManager:x,GenomeRegion:C,GenomeRegionCollection:S,GenomeVisualization:R,GenomeReferenceDataManager:k,TrackBrowserRouter:O,Visualization:E,select_datasets:y}}).call(e,n(0),n(2))},8:function(t,e,n){"use strict";(function(t,n){function i(t){t+="";for(var e=/(\d+)(\d{3})/;e.test(t);)t=t.replace(e,"$1,$2");return t}Object.defineProperty(e,"__esModule",{value:!0});var r=function(t){return"promise"in t},a=t.Model.extend({defaults:{ajax_settings:{},interval:1e3,success_fn:function(t){return!0}},go:function(){var t=n.Deferred(),e=this,i=e.get("ajax_settings"),r=e.get("success_fn"),a=e.get("interval");return function e(){n.ajax(i).success(function(n){r(n)?t.resolve(n):setTimeout(e,a)})}(),t}}),o=function(t){t||(t="#ffffff"),"string"==typeof t&&(t=[t]);for(var e=0;e<t.length;e++)t[e]=parseInt(t[e].slice(1),16);var n,i,r,a,o,s,l,u,c,h,d,f=function(t,e,n){return(299*t+587*e+114*n)/1e3},_=!1,p=0;do{for(n=Math.round(16777215*Math.random()),i=(16711680&n)>>16,r=(65280&n)>>8,a=255&n,c=f(i,r,a),_=!0,e=0;e<t.length;e++)if(o=t[e],s=(16711680&o)>>16,l=(65280&o)>>8,u=255&o,h=f(s,l,u),d=function(t,e,n,i,r,a){return Math.max(t,i)-Math.min(t,i)+(Math.max(e,r)-Math.min(e,r))+(Math.max(n,a)-Math.min(n,a))}(i,r,a,s,l,u),Math.abs(c-h)<40||d<200){_=!1;break}p++}while(!_&&p<=10);return"#"+(16777216+n).toString(16).substr(1,6)};e.default={commatize:i,is_deferred:r,ServerStateDeferred:a,get_random_color:o}}).call(e,n(2),n(0))}},[284]);
//# sourceMappingURL=viz.bundled.js.map